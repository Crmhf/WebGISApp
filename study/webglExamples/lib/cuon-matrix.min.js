var Matrix4=function(c){var a,b,e;if(c&&typeof c==="object"&&c.hasOwnProperty("elements")){b=c.elements;e=new Float32Array(16);for(a=0;a<16;++a){e[a]=b[a]}this.elements=e}else{this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}};Matrix4.prototype.setIdentity=function(){var a=this.elements;a[0]=1;a[4]=0;a[8]=0;a[12]=0;a[1]=0;a[5]=1;a[9]=0;a[13]=0;a[2]=0;a[6]=0;a[10]=1;a[14]=0;a[3]=0;a[7]=0;a[11]=0;a[15]=1;return this};Matrix4.prototype.set=function(e){var a,b,c;b=e.elements;c=this.elements;if(b===c){return}for(a=0;a<16;++a){c[a]=b[a]}return this};Matrix4.prototype.concat=function(k){var f,j,m,l,h,g,d,c;j=this.elements;m=this.elements;l=k.elements;if(j===l){l=new Float32Array(16);for(f=0;f<16;++f){l[f]=j[f]}}for(f=0;f<4;f++){h=m[f];g=m[f+4];d=m[f+8];c=m[f+12];j[f]=h*l[0]+g*l[1]+d*l[2]+c*l[3];j[f+4]=h*l[4]+g*l[5]+d*l[6]+c*l[7];j[f+8]=h*l[8]+g*l[9]+d*l[10]+c*l[11];j[f+12]=h*l[12]+g*l[13]+d*l[14]+c*l[15]}return this};Matrix4.prototype.multiply=Matrix4.prototype.concat;Matrix4.prototype.multiplyVector3=function(f){var d=this.elements;var c=f.elements;var b=new Vector3();var a=b.elements;a[0]=c[0]*d[0]+c[1]*d[4]+c[2]*d[8]+d[11];a[1]=c[0]*d[1]+c[1]*d[5]+c[2]*d[9]+d[12];a[2]=c[0]*d[2]+c[1]*d[6]+c[2]*d[10]+d[13];return b};Matrix4.prototype.multiplyVector4=function(f){var d=this.elements;var c=f.elements;var b=new Vector4();var a=b.elements;a[0]=c[0]*d[0]+c[1]*d[4]+c[2]*d[8]+c[3]*d[12];a[1]=c[0]*d[1]+c[1]*d[5]+c[2]*d[9]+c[3]*d[13];a[2]=c[0]*d[2]+c[1]*d[6]+c[2]*d[10]+c[3]*d[14];a[3]=c[0]*d[3]+c[1]*d[7]+c[2]*d[11]+c[3]*d[15];return b};Matrix4.prototype.transpose=function(){var b,a;b=this.elements;a=b[1];b[1]=b[4];b[4]=a;a=b[2];b[2]=b[8];b[8]=a;a=b[3];b[3]=b[12];b[12]=a;a=b[6];b[6]=b[9];b[9]=a;a=b[7];b[7]=b[13];b[13]=a;a=b[11];b[11]=b[14];b[14]=a;return this};Matrix4.prototype.setInverseOf=function(b){var e,f,g,a,c;f=b.elements;g=this.elements;a=new Float32Array(16);a[0]=f[5]*f[10]*f[15]-f[5]*f[11]*f[14]-f[9]*f[6]*f[15]+f[9]*f[7]*f[14]+f[13]*f[6]*f[11]-f[13]*f[7]*f[10];a[4]=-f[4]*f[10]*f[15]+f[4]*f[11]*f[14]+f[8]*f[6]*f[15]-f[8]*f[7]*f[14]-f[12]*f[6]*f[11]+f[12]*f[7]*f[10];a[8]=f[4]*f[9]*f[15]-f[4]*f[11]*f[13]-f[8]*f[5]*f[15]+f[8]*f[7]*f[13]+f[12]*f[5]*f[11]-f[12]*f[7]*f[9];a[12]=-f[4]*f[9]*f[14]+f[4]*f[10]*f[13]+f[8]*f[5]*f[14]-f[8]*f[6]*f[13]-f[12]*f[5]*f[10]+f[12]*f[6]*f[9];a[1]=-f[1]*f[10]*f[15]+f[1]*f[11]*f[14]+f[9]*f[2]*f[15]-f[9]*f[3]*f[14]-f[13]*f[2]*f[11]+f[13]*f[3]*f[10];a[5]=f[0]*f[10]*f[15]-f[0]*f[11]*f[14]-f[8]*f[2]*f[15]+f[8]*f[3]*f[14]+f[12]*f[2]*f[11]-f[12]*f[3]*f[10];a[9]=-f[0]*f[9]*f[15]+f[0]*f[11]*f[13]+f[8]*f[1]*f[15]-f[8]*f[3]*f[13]-f[12]*f[1]*f[11]+f[12]*f[3]*f[9];a[13]=f[0]*f[9]*f[14]-f[0]*f[10]*f[13]-f[8]*f[1]*f[14]+f[8]*f[2]*f[13]+f[12]*f[1]*f[10]-f[12]*f[2]*f[9];a[2]=f[1]*f[6]*f[15]-f[1]*f[7]*f[14]-f[5]*f[2]*f[15]+f[5]*f[3]*f[14]+f[13]*f[2]*f[7]-f[13]*f[3]*f[6];a[6]=-f[0]*f[6]*f[15]+f[0]*f[7]*f[14]+f[4]*f[2]*f[15]-f[4]*f[3]*f[14]-f[12]*f[2]*f[7]+f[12]*f[3]*f[6];a[10]=f[0]*f[5]*f[15]-f[0]*f[7]*f[13]-f[4]*f[1]*f[15]+f[4]*f[3]*f[13]+f[12]*f[1]*f[7]-f[12]*f[3]*f[5];a[14]=-f[0]*f[5]*f[14]+f[0]*f[6]*f[13]+f[4]*f[1]*f[14]-f[4]*f[2]*f[13]-f[12]*f[1]*f[6]+f[12]*f[2]*f[5];a[3]=-f[1]*f[6]*f[11]+f[1]*f[7]*f[10]+f[5]*f[2]*f[11]-f[5]*f[3]*f[10]-f[9]*f[2]*f[7]+f[9]*f[3]*f[6];a[7]=f[0]*f[6]*f[11]-f[0]*f[7]*f[10]-f[4]*f[2]*f[11]+f[4]*f[3]*f[10]+f[8]*f[2]*f[7]-f[8]*f[3]*f[6];a[11]=-f[0]*f[5]*f[11]+f[0]*f[7]*f[9]+f[4]*f[1]*f[11]-f[4]*f[3]*f[9]-f[8]*f[1]*f[7]+f[8]*f[3]*f[5];a[15]=f[0]*f[5]*f[10]-f[0]*f[6]*f[9]-f[4]*f[1]*f[10]+f[4]*f[2]*f[9]+f[8]*f[1]*f[6]-f[8]*f[2]*f[5];c=f[0]*a[0]+f[1]*a[4]+f[2]*a[8]+f[3]*a[12];if(c===0){return this}c=1/c;for(e=0;e<16;e++){g[e]=a[e]*c}return this};Matrix4.prototype.invert=function(){return this.setInverseOf(this)};Matrix4.prototype.setOrtho=function(c,j,a,h,f,d){var g,b,i,k;if(c===j||a===h||f===d){throw"null frustum"}b=1/(j-c);i=1/(h-a);k=1/(d-f);g=this.elements;g[0]=2*b;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2*i;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=-2*k;g[11]=0;g[12]=-(j+c)*b;g[13]=-(h+a)*i;g[14]=-(d+f)*k;g[15]=1;return this};Matrix4.prototype.ortho=function(f,c,b,e,d,a){return this.concat(new Matrix4().setOrtho(f,c,b,e,d,a))};Matrix4.prototype.setFrustum=function(c,j,a,h,f,d){var g,b,i,k;if(c===j||h===a||f===d){throw"null frustum"}if(f<=0){throw"near <= 0"}if(d<=0){throw"far <= 0"}b=1/(j-c);i=1/(h-a);k=1/(d-f);g=this.elements;g[0]=2*f*b;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2*f*i;g[6]=0;g[7]=0;g[8]=(j+c)*b;g[9]=(h+a)*i;g[10]=-(d+f)*k;g[11]=-1;g[12]=0;g[13]=0;g[14]=-2*f*d*k;g[15]=0;return this};Matrix4.prototype.frustum=function(f,c,b,e,d,a){return this.concat(new Matrix4().setFrustum(f,c,b,e,d,a))};Matrix4.prototype.setPerspective=function(c,b,g,a){var i,h,f,d;if(g===a||b===0){throw"null frustum"}if(g<=0){throw"near <= 0"}if(a<=0){throw"far <= 0"}c=Math.PI*c/180/2;f=Math.sin(c);if(f===0){throw"null frustum"}h=1/(a-g);d=Math.cos(c)/f;i=this.elements;i[0]=d/b;i[1]=0;i[2]=0;i[3]=0;i[4]=0;i[5]=d;i[6]=0;i[7]=0;i[8]=0;i[9]=0;i[10]=-(a+g)*h;i[11]=-1;i[12]=0;i[13]=0;i[14]=-2*g*a*h;i[15]=0;return this};Matrix4.prototype.perspective=function(c,b,d,a){return this.concat(new Matrix4().setPerspective(c,b,d,a))};Matrix4.prototype.setScale=function(a,d,c){var b=this.elements;b[0]=a;b[4]=0;b[8]=0;b[12]=0;b[1]=0;b[5]=d;b[9]=0;b[13]=0;b[2]=0;b[6]=0;b[10]=c;b[14]=0;b[3]=0;b[7]=0;b[11]=0;b[15]=1;return this};Matrix4.prototype.scale=function(a,d,c){var b=this.elements;b[0]*=a;b[4]*=d;b[8]*=c;b[1]*=a;b[5]*=d;b[9]*=c;b[2]*=a;b[6]*=d;b[10]*=c;b[3]*=a;b[7]*=d;b[11]*=c;return this};Matrix4.prototype.setTranslate=function(a,d,c){var b=this.elements;b[0]=1;b[4]=0;b[8]=0;b[12]=a;b[1]=0;b[5]=1;b[9]=0;b[13]=d;b[2]=0;b[6]=0;b[10]=1;b[14]=c;b[3]=0;b[7]=0;b[11]=0;b[15]=1;return this};Matrix4.prototype.translate=function(a,d,c){var b=this.elements;b[12]+=b[0]*a+b[4]*d+b[8]*c;b[13]+=b[1]*a+b[5]*d+b[9]*c;b[14]+=b[2]*a+b[6]*d+b[10]*c;b[15]+=b[3]*a+b[7]*d+b[11]*c;return this};Matrix4.prototype.setRotate=function(b,n,m,l){var j,r,k,h,o,f,q,i,d,a,p,g;b=Math.PI*b/180;j=this.elements;r=Math.sin(b);k=Math.cos(b);if(0!==n&&0===m&&0===l){if(n<0){r=-r}j[0]=1;j[4]=0;j[8]=0;j[12]=0;j[1]=0;j[5]=k;j[9]=-r;j[13]=0;j[2]=0;j[6]=r;j[10]=k;j[14]=0;j[3]=0;j[7]=0;j[11]=0;j[15]=1}else{if(0===n&&0!==m&&0===l){if(m<0){r=-r}j[0]=k;j[4]=0;j[8]=r;j[12]=0;j[1]=0;j[5]=1;j[9]=0;j[13]=0;j[2]=-r;j[6]=0;j[10]=k;j[14]=0;j[3]=0;j[7]=0;j[11]=0;j[15]=1}else{if(0===n&&0===m&&0!==l){if(l<0){r=-r}j[0]=k;j[4]=-r;j[8]=0;j[12]=0;j[1]=r;j[5]=k;j[9]=0;j[13]=0;j[2]=0;j[6]=0;j[10]=1;j[14]=0;j[3]=0;j[7]=0;j[11]=0;j[15]=1}else{h=Math.sqrt(n*n+m*m+l*l);if(h!==1){o=1/h;n*=o;m*=o;l*=o}f=1-k;q=n*m;i=m*l;d=l*n;a=n*r;p=m*r;g=l*r;j[0]=n*n*f+k;j[1]=q*f+g;j[2]=d*f-p;j[3]=0;j[4]=q*f-g;j[5]=m*m*f+k;j[6]=i*f+a;j[7]=0;j[8]=d*f+p;j[9]=i*f-a;j[10]=l*l*f+k;j[11]=0;j[12]=0;j[13]=0;j[14]=0;j[15]=1}}}return this};Matrix4.prototype.rotate=function(c,a,d,b){return this.concat(new Matrix4().setRotate(c,a,d,b))};Matrix4.prototype.setLookAt=function(n,m,l,k,j,h,v,u,t){var s,c,b,a,r,q,p,o,i,g,f,d;c=k-n;b=j-m;a=h-l;r=1/Math.sqrt(c*c+b*b+a*a);c*=r;b*=r;a*=r;q=b*t-a*u;p=a*v-c*t;o=c*u-b*v;i=1/Math.sqrt(q*q+p*p+o*o);q*=i;p*=i;o*=i;g=p*a-o*b;f=o*c-q*a;d=q*b-p*c;s=this.elements;s[0]=q;s[1]=g;s[2]=-c;s[3]=0;s[4]=p;s[5]=f;s[6]=-b;s[7]=0;s[8]=o;s[9]=d;s[10]=-a;s[11]=0;s[12]=0;s[13]=0;s[14]=0;s[15]=1;return this.translate(-n,-m,-l)};Matrix4.prototype.lookAt=function(i,h,g,c,b,a,f,e,d){return this.concat(new Matrix4().setLookAt(i,h,g,c,b,a,f,e,d))};Matrix4.prototype.dropShadow=function(b,a){var d=new Matrix4();var f=d.elements;var c=b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]*a[3];f[0]=c-a[0]*b[0];f[1]=-a[1]*b[0];f[2]=-a[2]*b[0];f[3]=-a[3]*b[0];f[4]=-a[0]*b[1];f[5]=c-a[1]*b[1];f[6]=-a[2]*b[1];f[7]=-a[3]*b[1];f[8]=-a[0]*b[2];f[9]=-a[1]*b[2];f[10]=c-a[2]*b[2];f[11]=-a[3]*b[2];f[12]=-a[0]*b[3];f[13]=-a[1]*b[3];f[14]=-a[2]*b[3];f[15]=c-a[3]*b[3];return this.concat(d)};Matrix4.prototype.dropShadowDirectionally=function(g,d,b,j,i,f,h,e,c){var k=j*g+i*d+f*b;return this.dropShadow([g,d,b,-k],[h,e,c,0])};var Vector3=function(b){var a=new Float32Array(3);if(b&&typeof b==="object"){a[0]=b[0];a[1]=b[1];a[2]=b[2]}this.elements=a};Vector3.prototype.normalize=function(){var a=this.elements;var i=a[0],h=a[1],f=a[2],b=Math.sqrt(i*i+h*h+f*f);if(b){if(b==1){return this}}else{a[0]=0;a[1]=0;a[2]=0;return this}b=1/b;a[0]=i*b;a[1]=h*b;a[2]=f*b;return this};var Vector4=function(b){var a=new Float32Array(4);if(b&&typeof b==="object"){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3]}this.elements=a};