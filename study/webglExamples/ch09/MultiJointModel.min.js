var VSHADER_SOURCE="attribute vec4 a_Position;\nattribute vec4 a_Normal;\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_NormalMatrix;\nvarying vec4 v_Color;\nvoid main() {\n  gl_Position = u_MvpMatrix * a_Position;\n  vec3 lightDirection = normalize(vec3(0.0, 0.5, 0.7));\n  vec4 color = vec4(1.0, 0.4, 0.0, 1.0);\n  vec3 normal = normalize((u_NormalMatrix * a_Normal).xyz);\n  float nDotL = max(dot(normal, lightDirection), 0.0);\n  v_Color = vec4(color.rgb * nDotL + vec3(0.1), color.a);\n}\n";var FSHADER_SOURCE="#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec4 v_Color;\nvoid main() {\n  gl_FragColor = v_Color;\n}\n";function main(){var b=document.getElementById("webgl");var e=getWebGLContext(b);if(!e){console.log("Failed to get the rendering context for WebGL");return}if(!initShaders(e,VSHADER_SOURCE,FSHADER_SOURCE)){console.log("Failed to intialize shaders.");return}var f=initVertexBuffers(e);if(f<0){console.log("Failed to set the vertex information");return}e.clearColor(0,0,0,1);e.enable(e.DEPTH_TEST);var d=e.getUniformLocation(e.program,"u_MvpMatrix");var a=e.getUniformLocation(e.program,"u_NormalMatrix");if(!d||!a){console.log("Failed to get the storage location");return}var c=new Matrix4();c.setPerspective(50,b.width/b.height,1,100);c.lookAt(20,10,30,0,0,0,0,1,0);document.onkeydown=function(g){keydown(g,e,f,c,d,a)};draw(e,f,c,d,a)}var ANGLE_STEP=3;var g_arm1Angle=90;var g_joint1Angle=45;var g_joint2Angle=0;var g_joint3Angle=0;function keydown(d,e,f,c,b,a){switch(d.keyCode){case 40:if(g_joint1Angle<135){g_joint1Angle+=ANGLE_STEP}break;case 38:if(g_joint1Angle>-135){g_joint1Angle-=ANGLE_STEP}break;case 39:g_arm1Angle=(g_arm1Angle+ANGLE_STEP)%360;break;case 37:g_arm1Angle=(g_arm1Angle-ANGLE_STEP)%360;break;case 90:g_joint2Angle=(g_joint2Angle+ANGLE_STEP)%360;break;case 88:g_joint2Angle=(g_joint2Angle-ANGLE_STEP)%360;break;case 86:if(g_joint3Angle<60){g_joint3Angle=(g_joint3Angle+ANGLE_STEP)%360}break;case 67:if(g_joint3Angle>-60){g_joint3Angle=(g_joint3Angle-ANGLE_STEP)%360}break;default:return}draw(e,f,c,b,a)}function initVertexBuffers(e){var b=new Float32Array([0.5,1,0.5,-0.5,1,0.5,-0.5,0,0.5,0.5,0,0.5,0.5,1,0.5,0.5,0,0.5,0.5,0,-0.5,0.5,1,-0.5,0.5,1,0.5,0.5,1,-0.5,-0.5,1,-0.5,-0.5,1,0.5,-0.5,1,0.5,-0.5,1,-0.5,-0.5,0,-0.5,-0.5,0,0.5,-0.5,0,-0.5,0.5,0,-0.5,0.5,0,0.5,-0.5,0,0.5,0.5,0,-0.5,-0.5,0,-0.5,-0.5,1,-0.5,0.5,1,-0.5]);var c=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1]);var d=new Uint8Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);if(!initArrayBuffer(e,"a_Position",b,e.FLOAT,3)){return -1}if(!initArrayBuffer(e,"a_Normal",c,e.FLOAT,3)){return -1}e.bindBuffer(e.ARRAY_BUFFER,null);var a=e.createBuffer();if(!a){console.log("Failed to create the buffer object");return -1}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a);e.bufferData(e.ELEMENT_ARRAY_BUFFER,d,e.STATIC_DRAW);return d.length}function initArrayBuffer(f,d,e,c,b){var a=f.createBuffer();if(!a){console.log("Failed to create the buffer object");return false}f.bindBuffer(f.ARRAY_BUFFER,a);f.bufferData(f.ARRAY_BUFFER,e,f.STATIC_DRAW);var g=f.getAttribLocation(f.program,d);if(g<0){console.log("Failed to get the storage location of "+d);return false}f.vertexAttribPointer(g,b,c,false,0,0);f.enableVertexAttribArray(g);return true}var g_modelMatrix=new Matrix4(),g_mvpMatrix=new Matrix4();function draw(f,c,h,b,g){f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT);var e=2;g_modelMatrix.setTranslate(0,-12,0);drawBox(f,c,10,e,10,h,b,g);var d=10;g_modelMatrix.translate(0,e,0);g_modelMatrix.rotate(g_arm1Angle,0,1,0);drawBox(f,c,3,d,3,h,b,g);var a=10;g_modelMatrix.translate(0,d,0);g_modelMatrix.rotate(g_joint1Angle,0,0,1);drawBox(f,c,4,a,4,h,b,g);var i=2;g_modelMatrix.translate(0,a,0);g_modelMatrix.rotate(g_joint2Angle,0,1,0);drawBox(f,c,2,i,6,h,b,g);g_modelMatrix.translate(0,i,0);pushMatrix(g_modelMatrix);g_modelMatrix.translate(0,0,2);g_modelMatrix.rotate(g_joint3Angle,1,0,0);drawBox(f,c,1,2,1,h,b,g);g_modelMatrix=popMatrix();g_modelMatrix.translate(0,0,-2);g_modelMatrix.rotate(-g_joint3Angle,1,0,0);drawBox(f,c,1,2,1,h,b,g)}var g_matrixStack=[];function pushMatrix(a){var b=new Matrix4(a);g_matrixStack.push(b)}function popMatrix(){return g_matrixStack.pop()}var g_normalMatrix=new Matrix4();function drawBox(g,h,e,b,f,d,c,a){pushMatrix(g_modelMatrix);g_modelMatrix.scale(e,b,f);g_mvpMatrix.set(d);g_mvpMatrix.multiply(g_modelMatrix);g.uniformMatrix4fv(c,false,g_mvpMatrix.elements);g_normalMatrix.setInverseOf(g_modelMatrix);g_normalMatrix.transpose();g.uniformMatrix4fv(a,false,g_normalMatrix.elements);g.drawElements(g.TRIANGLES,h,g.UNSIGNED_BYTE,0);g_modelMatrix=popMatrix()};