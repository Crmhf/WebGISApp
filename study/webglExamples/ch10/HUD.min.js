var VSHADER_SOURCE="attribute vec4 a_Position;\nattribute vec4 a_Color;\nuniform mat4 u_MvpMatrix;\nuniform bool u_Clicked;\nvarying vec4 v_Color;\nvoid main() {\n  gl_Position = u_MvpMatrix * a_Position;\n  if (u_Clicked) {\n    v_Color = vec4(1.0, 0.0, 0.0, 1.0);\n  } else {\n    v_Color = a_Color;\n  }\n}\n";var FSHADER_SOURCE="#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec4 v_Color;\nvoid main() {\n  gl_FragColor = v_Color;\n}\n";var ANGLE_STEP=20;function main(){var b=document.getElementById("webgl");var g=document.getElementById("hud");if(!b||!g){console.log("Failed to get HTML elements");return false}var f=getWebGLContext(b);var j=g.getContext("2d");if(!f||!j){console.log("Failed to get rendering context");return}if(!initShaders(f,VSHADER_SOURCE,FSHADER_SOURCE)){console.log("Failed to intialize shaders.");return}var c=initVertexBuffers(f);if(c<0){console.log("Failed to set the vertex information");return}f.clearColor(0,0,0,1);f.enable(f.DEPTH_TEST);var a=f.getUniformLocation(f.program,"u_MvpMatrix");var i=f.getUniformLocation(f.program,"u_Clicked");if(!a||!i){console.log("Failed to get the storage location of uniform variables");return}var h=new Matrix4();h.setPerspective(30,b.width/b.height,1,100);h.lookAt(0,0,7,0,0,0,0,1,0);f.uniform1i(i,0);var d=0;g.onmousedown=function(o){var l=o.clientX,q=o.clientY;var n=o.target.getBoundingClientRect();if(n.left<=l&&l<n.right&&n.top<=q&&q<n.bottom){var p=l-n.left,k=n.bottom-q;var m=check(f,c,p,k,d,i,h,a);if(m){alert("The cube was selected! ")}}};var e=function(){d=animate(d);draw2D(j,d);draw(f,c,d,h,a);requestAnimationFrame(e,b)};e()}function initVertexBuffers(e){var c=new Float32Array([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1]);var b=new Float32Array([0.2,0.58,0.82,0.2,0.58,0.82,0.2,0.58,0.82,0.2,0.58,0.82,0.5,0.41,0.69,0.5,0.41,0.69,0.5,0.41,0.69,0.5,0.41,0.69,0,0.32,0.61,0,0.32,0.61,0,0.32,0.61,0,0.32,0.61,0.78,0.69,0.84,0.78,0.69,0.84,0.78,0.69,0.84,0.78,0.69,0.84,0.32,0.18,0.56,0.32,0.18,0.56,0.32,0.18,0.56,0.32,0.18,0.56,0.73,0.82,0.93,0.73,0.82,0.93,0.73,0.82,0.93,0.73,0.82,0.93]);var d=new Uint8Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);if(!initArrayBuffer(e,c,3,e.FLOAT,"a_Position")){return -1}if(!initArrayBuffer(e,b,3,e.FLOAT,"a_Color")){return -1}var a=e.createBuffer();if(!a){return -1}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a);e.bufferData(e.ELEMENT_ARRAY_BUFFER,d,e.STATIC_DRAW);return d.length}function check(f,c,j,h,e,i,g,b){var a=false;f.uniform1i(i,1);draw(f,c,e,g,b);var d=new Uint8Array(4);f.readPixels(j,h,1,1,f.RGBA,f.UNSIGNED_BYTE,d);if(d[0]==255){a=true}f.uniform1i(i,0);draw(f,c,e,g,b);return a}var g_MvpMatrix=new Matrix4();function draw(d,e,c,b,a){g_MvpMatrix.set(b);g_MvpMatrix.rotate(c,1,0,0);g_MvpMatrix.rotate(c,0,1,0);g_MvpMatrix.rotate(c,0,0,1);d.uniformMatrix4fv(a,false,g_MvpMatrix.elements);d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT);d.drawElements(d.TRIANGLES,e,d.UNSIGNED_BYTE,0)}function draw2D(a,b){a.clearRect(0,0,400,400);a.beginPath();a.moveTo(120,10);a.lineTo(200,150);a.lineTo(40,150);a.closePath();a.strokeStyle="rgba(255, 255, 255, 1)";a.stroke();a.font='18px "Times New Roman"';a.fillStyle="rgba(255, 255, 255, 1)";a.fillText("HUD: Head Up Display",40,180);a.fillText("Triangle is drawn by Canvas 2D API.",40,200);a.fillText("Cube is drawn by WebGL API.",40,220);a.fillText("Current Angle: "+Math.floor(b),40,240)}var last=Date.now();function animate(c){var b=Date.now();var a=b-last;last=b;var d=c+(ANGLE_STEP*a)/1000;return d%360}function initArrayBuffer(f,e,b,c,d){var a=f.createBuffer();if(!a){console.log("Failed to create the buffer object");return false}f.bindBuffer(f.ARRAY_BUFFER,a);f.bufferData(f.ARRAY_BUFFER,e,f.STATIC_DRAW);var g=f.getAttribLocation(f.program,d);if(g<0){console.log("Failed to get the storage location of "+d);return false}f.vertexAttribPointer(g,b,c,false,0,0);f.enableVertexAttribArray(g);f.bindBuffer(f.ARRAY_BUFFER,null);return true};