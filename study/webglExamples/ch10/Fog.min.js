var VSHADER_SOURCE="attribute vec4 a_Position;\nattribute vec4 a_Color;\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_ModelMatrix;\nuniform vec4 u_Eye;\nvarying vec4 v_Color;\nvarying float v_Dist;\nvoid main() {\n  gl_Position = u_MvpMatrix * a_Position;\n  v_Color = a_Color;\n  v_Dist = distance(u_ModelMatrix * a_Position, u_Eye);\n}\n";var FSHADER_SOURCE="#ifdef GL_ES\nprecision mediump float;\n#endif\nuniform vec3 u_FogColor;\nuniform vec2 u_FogDist;\nvarying vec4 v_Color;\nvarying float v_Dist;\nvoid main() {\n  float fogFactor = clamp((u_FogDist.y - v_Dist) / (u_FogDist.y - u_FogDist.x), 0.0, 1.0);\n  vec3 color = mix(u_FogColor, vec3(v_Color), fogFactor);\n  gl_FragColor = vec4(color, v_Color.a);\n}\n";function main(){var b=document.getElementById("webgl");var e=getWebGLContext(b);if(!e){console.log("Failed to get the rendering context for WebGL");return}if(!initShaders(e,VSHADER_SOURCE,FSHADER_SOURCE)){console.log("Failed to intialize shaders.");return}var c=initVertexBuffers(e);if(c<1){console.log("Failed to set the vertex information");return}var k=new Float32Array([0.137,0.231,0.423]);var d=new Float32Array([55,80]);var f=new Float32Array([25,65,35,1]);var a=e.getUniformLocation(e.program,"u_MvpMatrix");var o=e.getUniformLocation(e.program,"u_ModelMatrix");var i=e.getUniformLocation(e.program,"u_Eye");var h=e.getUniformLocation(e.program,"u_FogColor");var l=e.getUniformLocation(e.program,"u_FogDist");if(!a||!o||!i||!h||!l){console.log("Failed to get the storage location");return}e.uniform3fv(h,k);e.uniform2fv(l,d);e.uniform4fv(i,f);e.clearColor(k[0],k[1],k[2],1);e.enable(e.DEPTH_TEST);var m=new Matrix4();m.setScale(10,10,10);e.uniformMatrix4fv(o,false,m.elements);var j=new Matrix4();j.setPerspective(30,b.width/b.height,1,1000);j.lookAt(f[0],f[1],f[2],0,2,0,0,1,0);j.multiply(m);e.uniformMatrix4fv(a,false,j.elements);document.onkeydown=function(n){keydown(n,e,c,l,d)};e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);e.drawElements(e.TRIANGLES,c,e.UNSIGNED_BYTE,0);var g=new Matrix4();g.setLookAt(f[0],f[1],f[2],0,2,0,0,1,0);g.multiply(m);g.multiplyVector4(new Vector4([1,1,1,1]));j.multiplyVector4(new Vector4([1,1,1,1]));g.multiplyVector4(new Vector4([-1,1,1,1]));j.multiplyVector4(new Vector4([-1,1,1,1]))}function keydown(c,d,e,b,a){switch(c.keyCode){case 38:a[1]+=1;break;case 40:if(a[1]>a[0]){a[1]-=1}break;default:return}d.uniform2fv(b,a);d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT);d.drawElements(d.TRIANGLES,e,d.UNSIGNED_BYTE,0)}function initVertexBuffers(e){var c=new Float32Array([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1]);var b=new Float32Array([0.4,0.4,1,0.4,0.4,1,0.4,0.4,1,0.4,0.4,1,0.4,1,0.4,0.4,1,0.4,0.4,1,0.4,0.4,1,0.4,1,0.4,0.4,1,0.4,0.4,1,0.4,0.4,1,0.4,0.4,1,1,0.4,1,1,0.4,1,1,0.4,1,1,0.4,1,1,1,1,1,1,1,1,1,1,1,1,0.4,1,1,0.4,1,1,0.4,1,1,0.4,1,1]);var d=new Uint8Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);var a=e.createBuffer();if(!a){return -1}if(!initArrayBuffer(e,c,3,e.FLOAT,"a_Position")){return -1}if(!initArrayBuffer(e,b,3,e.FLOAT,"a_Color")){return -1}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a);e.bufferData(e.ELEMENT_ARRAY_BUFFER,d,e.STATIC_DRAW);return d.length}function initArrayBuffer(f,e,b,c,d){var a=f.createBuffer();if(!a){console.log("Failed to create the buffer object");return false}f.bindBuffer(f.ARRAY_BUFFER,a);f.bufferData(f.ARRAY_BUFFER,e,f.STATIC_DRAW);var g=f.getAttribLocation(f.program,d);if(g<0){console.log("Failed to get the storage location of "+d);return false}f.vertexAttribPointer(g,b,c,false,0,0);f.enableVertexAttribArray(g);f.bindBuffer(f.ARRAY_BUFFER,null);return true};