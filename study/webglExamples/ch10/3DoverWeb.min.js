var VSHADER_SOURCE="attribute vec4 a_Position;\nattribute vec4 a_Color;\nuniform mat4 u_MvpMatrix;\nuniform bool u_Clicked;\nvarying vec4 v_Color;\nvoid main() {\n  gl_Position = u_MvpMatrix * a_Position;\n  if (u_Clicked) {\n    v_Color = vec4(1.0, 0.0, 0.0, 1.0);\n  } else {\n    v_Color = vec4(a_Color.rgb, 1.0);\n  }\n}\n";var FSHADER_SOURCE="#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec4 v_Color;\nvoid main() {\n  gl_FragColor = v_Color;\n}\n";var ANGLE_STEP=20;function main(){var a=document.getElementById("webgl");var g=getWebGLContext(a);if(!g){console.log("Failed to get the rendering context for WebGL");return}if(!initShaders(g,VSHADER_SOURCE,FSHADER_SOURCE)){console.log("Failed to intialize shaders.");return}var h=initVertexBuffers(g);if(h<0){console.log("Failed to set the vertex information");return}g.clearColor(0,0,0,0);g.enable(g.DEPTH_TEST);var d=g.getUniformLocation(g.program,"u_MvpMatrix");var e=g.getUniformLocation(g.program,"u_Clicked");if(!d||!e){console.log("Failed to get the storage location");return}var c=new Matrix4();c.setPerspective(30,a.width/a.height,1,100);c.lookAt(0,0,7,0,0,0,0,1,0);g.uniform1i(e,0);var f=0;a.onmousedown=function(l){var j=l.clientX,n=l.clientY;var k=l.target.getBoundingClientRect();if(k.left<=j&&j<k.right&&k.top<=n&&n<k.bottom){var m=j-k.left,i=k.bottom-n;check(g,h,m,i,f,e,c,d)}};var b=function(){f=animate(f);draw(g,h,f,c,d);requestAnimationFrame(b,a)};b()}function initVertexBuffers(e){var c=new Float32Array([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1]);var b=new Float32Array([0.2,0.58,0.82,0.2,0.58,0.82,0.2,0.58,0.82,0.2,0.58,0.82,0.5,0.41,0.69,0.5,0.41,0.69,0.5,0.41,0.69,0.5,0.41,0.69,0,0.32,0.61,0,0.32,0.61,0,0.32,0.61,0,0.32,0.61,0.78,0.69,0.84,0.78,0.69,0.84,0.78,0.69,0.84,0.78,0.69,0.84,0.32,0.18,0.56,0.32,0.18,0.56,0.32,0.18,0.56,0.32,0.18,0.56,0.73,0.82,0.93,0.73,0.82,0.93,0.73,0.82,0.93,0.73,0.82,0.93]);var d=new Uint8Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);if(!initArrayBuffer(e,c,e.FLOAT,3,"a_Position")){return -1}if(!initArrayBuffer(e,b,e.FLOAT,3,"a_Color")){return -1}var a=e.createBuffer();if(!a){return -1}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a);e.bufferData(e.ELEMENT_ARRAY_BUFFER,d,e.STATIC_DRAW);return d.length}function check(f,c,j,h,e,i,g,b){var a=false;f.uniform1i(i,1);draw(f,c,e,g,b);var d=new Uint8Array(4);f.readPixels(j,h,1,1,f.RGBA,f.UNSIGNED_BYTE,d);if(d[0]==255){a=true}f.uniform1i(i,0);draw(f,c,e,g,b);if(a){alert("The cube was selected! ")}}var g_MvpMatrix=new Matrix4();function draw(d,e,c,b,a){g_MvpMatrix.set(b);g_MvpMatrix.rotate(c,1,0,0);g_MvpMatrix.rotate(c,0,1,0);g_MvpMatrix.rotate(c,0,0,1);d.uniformMatrix4fv(a,false,g_MvpMatrix.elements);d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT);d.drawElements(d.TRIANGLES,e,d.UNSIGNED_BYTE,0)}var last=Date.now();function animate(c){var b=Date.now();var a=b-last;last=b;var d=c+(ANGLE_STEP*a)/1000;return d%360}function initArrayBuffer(f,e,c,b,d){var a=f.createBuffer();if(!a){console.log("Failed to create the buffer object");return false}f.bindBuffer(f.ARRAY_BUFFER,a);f.bufferData(f.ARRAY_BUFFER,e,f.STATIC_DRAW);var g=f.getAttribLocation(f.program,d);if(g<0){console.log("Failed to get the storage location of "+d);return false}f.vertexAttribPointer(g,b,c,false,0,0);f.enableVertexAttribArray(g);f.bindBuffer(f.ARRAY_BUFFER,null);return true};