var VSHADER_SOURCE="attribute vec4 a_Position;\nattribute vec4 a_Color;\nattribute float a_Face;\nuniform mat4 u_MvpMatrix;\nuniform int u_PickedFace;\nvarying vec4 v_Color;\nvoid main() {\n  gl_Position = u_MvpMatrix * a_Position;\n  int face = int(a_Face);\n  vec3 color = (face == u_PickedFace) ? vec3(1.0) : a_Color.rgb;\n  if(u_PickedFace == 0) {\n    v_Color = vec4(color, a_Face/255.0);\n  } else {\n    v_Color = vec4(color, a_Color.a);\n  }\n}\n";var FSHADER_SOURCE="#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec4 v_Color;\nvoid main() {\n  gl_FragColor = v_Color;\n}\n";var ANGLE_STEP=20;var g_currentAngle=0;function main(){var a=document.getElementById("webgl");var e=getWebGLContext(a);if(!e){console.log("Failed to get the rendering context for WebGL");return}if(!initShaders(e,VSHADER_SOURCE,FSHADER_SOURCE)){console.log("Failed to intialize shaders.");return}var g=initVertexBuffers(e);if(g<0){console.log("Failed to set the vertex information");return}e.clearColor(0,0,0,1);e.enable(e.DEPTH_TEST);var d=e.getUniformLocation(e.program,"u_MvpMatrix");var f=e.getUniformLocation(e.program,"u_PickedFace");if(!d||!f){console.log("Failed to get the storage location of uniform variable");return}var c=new Matrix4();c.setPerspective(30,a.width/a.height,1,100);c.lookAt(0,0,7,0,0,0,0,1,0);e.uniform1i(f,-1);a.onmousedown=function(j){var h=j.clientX,k=j.clientY;var i=j.target.getBoundingClientRect();if(i.left<=h&&h<i.right&&i.top<=k&&k<i.bottom){updatePickedFace(e,g,h-i.left,i.bottom-k,f,c,d)}};var b=function(){g_currentAngle=animate(g_currentAngle);draw(e,g,g_currentAngle,c,d);requestAnimationFrame(b,a)};b()}function initVertexBuffers(f){var d=new Float32Array([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1]);var c=new Float32Array([0.32,0.18,0.56,0.32,0.18,0.56,0.32,0.18,0.56,0.32,0.18,0.56,0.5,0.41,0.69,0.5,0.41,0.69,0.5,0.41,0.69,0.5,0.41,0.69,0.78,0.69,0.84,0.78,0.69,0.84,0.78,0.69,0.84,0.78,0.69,0.84,0,0.32,0.61,0,0.32,0.61,0,0.32,0.61,0,0.32,0.61,0.27,0.58,0.82,0.27,0.58,0.82,0.27,0.58,0.82,0.27,0.58,0.82,0.73,0.82,0.93,0.73,0.82,0.93,0.73,0.82,0.93,0.73,0.82,0.93]);var b=new Uint8Array([1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6]);var e=new Uint8Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);var a=f.createBuffer();if(!a){return -1}if(!initArrayBuffer(f,d,f.FLOAT,3,"a_Position")){return -1}if(!initArrayBuffer(f,c,f.FLOAT,3,"a_Color")){return -1}if(!initArrayBuffer(f,b,f.UNSIGNED_BYTE,1,"a_Face")){return -1}f.bindBuffer(f.ARRAY_BUFFER,null);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a);f.bufferData(f.ELEMENT_ARRAY_BUFFER,e,f.STATIC_DRAW);return e.length}function updatePickedFace(d,h,a,g,f,c,b){var e=new Uint8Array(4);d.uniform1i(f,0);draw(d,h,g_currentAngle,c,b);d.readPixels(a,g,1,1,d.RGBA,d.UNSIGNED_BYTE,e);d.uniform1i(f,e[3])}var g_MvpMatrix=new Matrix4();function draw(d,e,c,b,a){g_MvpMatrix.set(b);g_MvpMatrix.rotate(c,1,0,0);g_MvpMatrix.rotate(c,0,1,0);g_MvpMatrix.rotate(c,0,0,1);d.uniformMatrix4fv(a,false,g_MvpMatrix.elements);d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT);d.drawElements(d.TRIANGLES,e,d.UNSIGNED_BYTE,0)}var last=Date.now();function animate(c){var b=Date.now();var a=b-last;last=b;var d=c+(ANGLE_STEP*a)/1000;return d%360}function initArrayBuffer(f,e,c,b,d){var a=f.createBuffer();if(!a){console.log("Failed to create the buffer object");return false}f.bindBuffer(f.ARRAY_BUFFER,a);f.bufferData(f.ARRAY_BUFFER,e,f.STATIC_DRAW);var g=f.getAttribLocation(f.program,d);if(g<0){console.log("Failed to get the storage location of "+d);return false}f.vertexAttribPointer(g,b,c,false,0,0);f.enableVertexAttribArray(g);return true};