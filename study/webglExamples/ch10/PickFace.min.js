var VSHADER_SOURCE="attribute vec4 a_Position;\nattribute vec4 a_Color;\nattribute float a_Face;\nuniform mat4 u_MvpMatrix;\nuniform int u_PickedFace;\nvarying vec4 v_Color;\nvoid main() {\n  gl_Position = u_MvpMatrix * a_Position;\n  int face = int(a_Face);\n  vec3 color = (face == u_PickedFace) ? vec3(1.0) : a_Color.rgb;\n  if(u_PickedFace == 0) {\n    v_Color = vec4(color, a_Face/255.0);\n  } else {\n    v_Color = vec4(color, a_Color.a);\n  }\n}\n";var FSHADER_SOURCE="#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec4 v_Color;\nvoid main() {\n  gl_FragColor = v_Color;\n}\n";var ANGLE_STEP=20;function main(){var a=document.getElementById("webgl");var f=getWebGLContext(a);if(!f){console.log("Failed to get the rendering context for WebGL");return}if(!initShaders(f,VSHADER_SOURCE,FSHADER_SOURCE)){console.log("Failed to intialize shaders.");return}var h=initVertexBuffers(f);if(h<0){console.log("Failed to set the vertex information");return}f.clearColor(0,0,0,1);f.enable(f.DEPTH_TEST);var d=f.getUniformLocation(f.program,"u_MvpMatrix");var g=f.getUniformLocation(f.program,"u_PickedFace");if(!d||!g){console.log("Failed to get the storage location of uniform variable");return}var c=new Matrix4();c.setPerspective(30,a.width/a.height,1,100);c.lookAt(0,0,7,0,0,0,0,1,0);f.uniform1i(g,-1);var e=0;a.onmousedown=function(l){var j=l.clientX,o=l.clientY;var k=l.target.getBoundingClientRect();if(k.left<=j&&j<k.right&&k.top<=o&&o<k.bottom){var n=j-k.left,i=k.bottom-o;var m=checkFace(f,h,n,i,e,g,c,d);f.uniform1i(g,m);draw(f,h,e,c,d)}};var b=function(){e=animate(e);draw(f,h,e,c,d);requestAnimationFrame(b,a)};b()}function initVertexBuffers(f){var d=new Float32Array([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1]);var c=new Float32Array([0.32,0.18,0.56,0.32,0.18,0.56,0.32,0.18,0.56,0.32,0.18,0.56,0.5,0.41,0.69,0.5,0.41,0.69,0.5,0.41,0.69,0.5,0.41,0.69,0.78,0.69,0.84,0.78,0.69,0.84,0.78,0.69,0.84,0.78,0.69,0.84,0,0.32,0.61,0,0.32,0.61,0,0.32,0.61,0,0.32,0.61,0.27,0.58,0.82,0.27,0.58,0.82,0.27,0.58,0.82,0.27,0.58,0.82,0.73,0.82,0.93,0.73,0.82,0.93,0.73,0.82,0.93,0.73,0.82,0.93]);var b=new Uint8Array([1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6]);var e=new Uint8Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);var a=f.createBuffer();if(!a){return -1}if(!initArrayBuffer(f,d,f.FLOAT,3,"a_Position")){return -1}if(!initArrayBuffer(f,c,f.FLOAT,3,"a_Color")){return -1}if(!initArrayBuffer(f,b,f.UNSIGNED_BYTE,1,"a_Face")){return -1}f.bindBuffer(f.ARRAY_BUFFER,null);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a);f.bufferData(f.ELEMENT_ARRAY_BUFFER,e,f.STATIC_DRAW);return e.length}function checkFace(f,b,i,h,d,e,g,a){var c=new Uint8Array(4);f.uniform1i(e,0);draw(f,b,d,g,a);f.readPixels(i,h,1,1,f.RGBA,f.UNSIGNED_BYTE,c);return c[3]}var g_MvpMatrix=new Matrix4();function draw(d,e,c,b,a){g_MvpMatrix.set(b);g_MvpMatrix.rotate(c,1,0,0);g_MvpMatrix.rotate(c,0,1,0);g_MvpMatrix.rotate(c,0,0,1);d.uniformMatrix4fv(a,false,g_MvpMatrix.elements);d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT);d.drawElements(d.TRIANGLES,e,d.UNSIGNED_BYTE,0)}var last=Date.now();function animate(c){var b=Date.now();var a=b-last;last=b;var d=c+(ANGLE_STEP*a)/1000;return d%360}function initArrayBuffer(f,e,c,b,d){var a=f.createBuffer();if(!a){console.log("Failed to create the buffer object");return false}f.bindBuffer(f.ARRAY_BUFFER,a);f.bufferData(f.ARRAY_BUFFER,e,f.STATIC_DRAW);var g=f.getAttribLocation(f.program,d);if(g<0){console.log("Failed to get the storage location of "+d);return false}f.vertexAttribPointer(g,b,c,false,0,0);f.enableVertexAttribArray(g);return true};