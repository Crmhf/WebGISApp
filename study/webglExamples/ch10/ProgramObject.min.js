var SOLID_VSHADER_SOURCE="attribute vec4 a_Position;\nattribute vec4 a_Normal;\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_NormalMatrix;\nvarying vec4 v_Color;\nvoid main() {\n  vec3 lightDirection = vec3(0.0, 0.0, 1.0);\n  vec4 color = vec4(0.0, 1.0, 1.0, 1.0);\n  gl_Position = u_MvpMatrix * a_Position;\n  vec3 normal = normalize(vec3(u_NormalMatrix * a_Normal));\n  float nDotL = max(dot(normal, lightDirection), 0.0);\n  v_Color = vec4(color.rgb * nDotL, color.a);\n}\n";var SOLID_FSHADER_SOURCE="#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec4 v_Color;\nvoid main() {\n  gl_FragColor = v_Color;\n}\n";var TEXTURE_VSHADER_SOURCE="attribute vec4 a_Position;\nattribute vec4 a_Normal;\nattribute vec2 a_TexCoord;\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_NormalMatrix;\nvarying float v_NdotL;\nvarying vec2 v_TexCoord;\nvoid main() {\n  vec3 lightDirection = vec3(0.0, 0.0, 1.0);\n  gl_Position = u_MvpMatrix * a_Position;\n  vec3 normal = normalize(vec3(u_NormalMatrix * a_Normal));\n  v_NdotL = max(dot(normal, lightDirection), 0.0);\n  v_TexCoord = a_TexCoord;\n}\n";var TEXTURE_FSHADER_SOURCE="#ifdef GL_ES\nprecision mediump float;\n#endif\nuniform sampler2D u_Sampler;\nvarying vec2 v_TexCoord;\nvarying float v_NdotL;\nvoid main() {\n  vec4 color = texture2D(u_Sampler, v_TexCoord);\n  gl_FragColor = vec4(color.rgb * v_NdotL, color.a);\n}\n";function main(){var b=document.getElementById("webgl");var e=getWebGLContext(b);if(!e){console.log("Failed to get the rendering context for WebGL");return}var h=createProgram(e,SOLID_VSHADER_SOURCE,SOLID_FSHADER_SOURCE);var i=createProgram(e,TEXTURE_VSHADER_SOURCE,TEXTURE_FSHADER_SOURCE);if(!h||!i){console.log("Failed to intialize shaders.");return}h.a_Position=e.getAttribLocation(h,"a_Position");h.a_Normal=e.getAttribLocation(h,"a_Normal");h.u_MvpMatrix=e.getUniformLocation(h,"u_MvpMatrix");h.u_NormalMatrix=e.getUniformLocation(h,"u_NormalMatrix");i.a_Position=e.getAttribLocation(i,"a_Position");i.a_Normal=e.getAttribLocation(i,"a_Normal");i.a_TexCoord=e.getAttribLocation(i,"a_TexCoord");i.u_MvpMatrix=e.getUniformLocation(i,"u_MvpMatrix");i.u_NormalMatrix=e.getUniformLocation(i,"u_NormalMatrix");i.u_Sampler=e.getUniformLocation(i,"u_Sampler");if(h.a_Position<0||h.a_Normal<0||!h.u_MvpMatrix||!h.u_NormalMatrix||i.a_Position<0||i.a_Normal<0||i.a_TexCoord<0||!i.u_MvpMatrix||!i.u_NormalMatrix||!i.u_Sampler){console.log("Failed to get the storage location of attribute or uniform variable");return}var a=initVertexBuffers(e);if(!a){console.log("Failed to set the vertex information");return}var f=initTextures(e,i);if(!f){console.log("Failed to intialize the texture.");return}e.enable(e.DEPTH_TEST);e.clearColor(0,0,0,1);var g=new Matrix4();g.setPerspective(30,b.width/b.height,1,100);g.lookAt(0,0,15,0,0,0,0,1,0);var c=0;var d=function(){c=animate(c);e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);drawSolidCube(e,h,a,-2,c,g);drawTexCube(e,i,a,f,2,c,g);window.requestAnimationFrame(d,b)};d()}function initVertexBuffers(f){var a=new Float32Array([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1]);var c=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1]);var b=new Float32Array([1,1,0,1,0,0,1,0,0,1,0,0,1,0,1,1,1,0,1,1,0,1,0,0,1,1,0,1,0,0,1,0,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1]);var e=new Uint8Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);var d=new Object();d.vertexBuffer=initArrayBufferForLaterUse(f,a,3,f.FLOAT);d.normalBuffer=initArrayBufferForLaterUse(f,c,3,f.FLOAT);d.texCoordBuffer=initArrayBufferForLaterUse(f,b,2,f.FLOAT);d.indexBuffer=initElementArrayBufferForLaterUse(f,e,f.UNSIGNED_BYTE);if(!d.vertexBuffer||!d.normalBuffer||!d.texCoordBuffer||!d.indexBuffer){return null}d.numIndices=e.length;f.bindBuffer(f.ARRAY_BUFFER,null);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,null);return d}function initTextures(d,a){var b=d.createTexture();if(!b){console.log("Failed to create the texture object");return null}var c=new Image();if(!c){console.log("Failed to create the image object");return null}c.onload=function(){d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,1);d.activeTexture(d.TEXTURE0);d.bindTexture(d.TEXTURE_2D,b);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,c);d.useProgram(a);d.uniform1i(a.u_Sampler,0);d.bindTexture(d.TEXTURE_2D,null)};c.src="../resources/orange.jpg";return b}function drawSolidCube(f,b,e,a,d,c){f.useProgram(b);initAttributeVariable(f,b.a_Position,e.vertexBuffer);initAttributeVariable(f,b.a_Normal,e.normalBuffer);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,e.indexBuffer);drawCube(f,b,e,a,d,c)}function drawTexCube(g,b,f,d,a,e,c){g.useProgram(b);initAttributeVariable(g,b.a_Position,f.vertexBuffer);initAttributeVariable(g,b.a_Normal,f.normalBuffer);initAttributeVariable(g,b.a_TexCoord,f.texCoordBuffer);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,f.indexBuffer);g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D,d);drawCube(g,b,f,a,e,c)}function initAttributeVariable(b,c,a){b.bindBuffer(b.ARRAY_BUFFER,a);b.vertexAttribPointer(c,a.num,a.type,false,0,0);b.enableVertexAttribArray(c)}var g_modelMatrix=new Matrix4();var g_mvpMatrix=new Matrix4();var g_normalMatrix=new Matrix4();function drawCube(f,b,e,a,d,c){g_modelMatrix.setTranslate(a,0,0);g_modelMatrix.rotate(20,1,0,0);g_modelMatrix.rotate(d,0,1,0);g_normalMatrix.setInverseOf(g_modelMatrix);g_normalMatrix.transpose();f.uniformMatrix4fv(b.u_NormalMatrix,false,g_normalMatrix.elements);g_mvpMatrix.set(c);g_mvpMatrix.multiply(g_modelMatrix);f.uniformMatrix4fv(b.u_MvpMatrix,false,g_mvpMatrix.elements);f.drawElements(f.TRIANGLES,e.numIndices,e.indexBuffer.type,0)}function initArrayBufferForLaterUse(e,d,b,c){var a=e.createBuffer();if(!a){console.log("Failed to create the buffer object");return null}e.bindBuffer(e.ARRAY_BUFFER,a);e.bufferData(e.ARRAY_BUFFER,d,e.STATIC_DRAW);a.num=b;a.type=c;return a}function initElementArrayBufferForLaterUse(d,c,b){var a=d.createBuffer();if(!a){console.log("Failed to create the buffer object");return null}d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a);d.bufferData(d.ELEMENT_ARRAY_BUFFER,c,d.STATIC_DRAW);a.type=b;return a}var ANGLE_STEP=30;var last=Date.now();function animate(c){var b=Date.now();var a=b-last;last=b;var d=c+(ANGLE_STEP*a)/1000;return d%360};