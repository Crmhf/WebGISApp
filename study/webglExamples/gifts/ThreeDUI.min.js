var VSHADER_COLOR_SOURCE="attribute vec4 a_Position;\nattribute vec4 a_Color;\nuniform mat4 u_MvpMatrix;\nvarying vec4 v_Color;\nvoid main() {\n  gl_Position = u_MvpMatrix * a_Position;\n  v_Color = a_Color;\n}\n";var FSHADER_COLOR_SOURCE="#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec4 v_Color;\nvoid main() {\n  gl_FragColor = v_Color;\n}\n";var VSHADER_TEXTURE_SOURCE="attribute vec4 a_Position;\nattribute vec2 a_TexCoord;\nuniform mat4 u_MvpMatrix;\nvarying vec4 v_Color;\nvarying vec2 v_TexCoord;\nvoid main() {\n  gl_Position = u_MvpMatrix * a_Position;\n  v_TexCoord = a_TexCoord;\n}\n";var FSHADER_TEXTURE_SOURCE="#ifdef GL_ES\nprecision mediump float;\n#endif\nuniform sampler2D u_Sampler;\nvarying vec2 v_TexCoord;\nvoid main() {\n  gl_FragColor = texture2D(u_Sampler, v_TexCoord);\n}\n";var g_program_color;var g_program_texture;var a_Position;var a_Color;var a_TexCoord;var u_MvpMatrix;var u_Sampler;var u_IsTexture;var g_viewProjMatrix=new Matrix4();var g_panelDefaultMatrix=new Matrix4();var g_vertexColorBuffer;var g_vertexTexCoordBuffer;var picturePanel=null;var nextPicturePanel=null;var pictureInfos=new Array(new pictureItem("'../resources/7herbs.jpg',          'Nanakusa\n\nUse arrow keys!'"),new pictureItem("'../resources/blueflower.jpg',      'Blue\nFlower'"),new pictureItem("'../resources/blueflower2.jpg',     'Blue\nFlower2'"),new pictureItem("'../resources/lightblueflower.jpg', 'Light\nBlue\nFlower'"),new pictureItem("'../resources/orange.jpg',          'Orange'"),new pictureItem("'../resources/parasol.jpg',         'Parasol'"),new pictureItem("'../resources/pinkflower.jpg',      'Pink\nFlower'"),new pictureItem("'../resources/redflower.jpg',       'Red\nFlower'"),new pictureItem("'../resources/sky.jpg',             'Sky'"),new pictureItem("'../resources/sky_cloud.jpg',       'Sky\nCloud'"),new pictureItem("'../resources/sky_roof.jpg',        'Sky\nand\nRoof'"),new pictureItem("'../resources/yellowflower.jpg',    'Yellow\nFlower'"));function pictureItem(b){var a=b.indexOf(",");this.path=b.substring(0,a);this.path=trimTo(this.path,"'");this.path=trimFrom(this.path,"'");this.description=b.substring(a+1);this.description=trimTo(this.description,"'");this.description=trimFrom(this.description,"'")}function trimTo(c,b){var a=c.indexOf(b);return c.substring(a+1)}function trimFrom(c,b){var a=c.lastIndexOf(b);return c.substring(0,a)}function main(){var c=document.getElementById("webgl");var b=document.getElementById("hud");if(!c||!b){console.log("Failed to get HTML elements");return false}var e=getWebGLContext(c);var a=b.getContext("2d");if(!e||!a){console.log("Failed to get rendering context");return}g_program_color=createProgram(e,VSHADER_COLOR_SOURCE,FSHADER_COLOR_SOURCE);if(g_program_color==null){console.log("Failed to create the shader");return}g_program_texture=createProgram(e,VSHADER_TEXTURE_SOURCE,FSHADER_TEXTURE_SOURCE);if(g_program_texture==null){console.log("Failed to create the shader");return}g_vertexColorBuffer=e.createBuffer();if(!g_vertexColorBuffer){console.log("Failed to create a buffer object");return}g_vertexTexCoordBuffer=e.createBuffer();if(!g_vertexTexCoordBuffer){console.log("Failed to create a buffer object (for a texture)");return}g_viewProjMatrix.setPerspective(50,c.width/c.height,1,100);g_viewProjMatrix.lookAt(0,0,6,0,0,0,0,1,0);g_panelDefaultMatrix.setTranslate(-0.5,0.2,0);g_panelDefaultMatrix.rotate(52,0,1,0);g_panelDefaultMatrix.rotate(-12,1,0,0);g_panelDefaultMatrix.rotate(15,0,0,1);document.onkeydown=function(f){keydown(f,e)};e.clearColor(0,0,0,1);e.enable(e.DEPTH_TEST);picturePanel=new PicturePanel(e,pictureInfos);picturePanel.selectedIndex=0;var d=function(){if(!onUpdate(e,a)){return}requestAnimationFrame(d,c)};d()}var configLines;function useColorShader(a){a.useProgram(g_program_color);a.program=g_program_color;a_Position=a.getAttribLocation(a.program,"a_Position");if(a_Position<0){console.log("Failed to get the storage location of a_Position");return false}a_Color=a.getAttribLocation(a.program,"a_Color");if(a_Color<0){console.log("Failed to get the storage location of a_Color");return false}u_MvpMatrix=a.getUniformLocation(a.program,"u_MvpMatrix");if(!u_MvpMatrix){console.log("Failed to get the storage location of u_MvpMatrix");return false}return true}function useTextureShader(a){a.useProgram(g_program_texture);a.program=g_program_texture;a_Position=a.getAttribLocation(a.program,"a_Position");if(a_Position<0){console.log("Failed to get the storage location of a_Position");return false}a_TexCoord=a.getAttribLocation(a.program,"a_TexCoord");if(a_TexCoord<0){console.log("Failed to get the storage location of a_TexCoord");return false}u_MvpMatrix=a.getUniformLocation(a.program,"u_MvpMatrix");if(!u_MvpMatrix){console.log("Failed to get the storage location of u_MvpMatrix");return false}u_Sampler=a.getUniformLocation(a.program,"u_Sampler");if(!u_Sampler){console.log("Failed to get the storage location of u_Sampler");return false}return true}var selectedVerticesColors=new Float32Array([-0.55,0.55,0.88,0.09,0.09,-0.55,-0.55,0.88,0.09,0.09,0.55,0.55,0.88,0.09,0.09,0.55,-0.55,0.88,0.09,0.09]);var normalVerticesColors=new Float32Array([-0.55,0.55,1,1,1,-0.55,-0.55,1,1,1,0.55,0.55,1,1,1,0.55,-0.55,1,1,1]);function drawVerticesColors(d,b,c){var e=b.length/5;var a=b.BYTES_PER_ELEMENT;d.uniformMatrix4fv(u_MvpMatrix,false,c.elements);d.bindBuffer(d.ARRAY_BUFFER,g_vertexColorBuffer);d.bufferData(d.ARRAY_BUFFER,b,d.STATIC_DRAW);d.vertexAttribPointer(a_Position,2,d.FLOAT,false,a*5,0);d.enableVertexAttribArray(a_Position);d.vertexAttribPointer(a_Color,3,d.FLOAT,false,a*5,a*2);d.enableVertexAttribArray(a_Color);d.bindBuffer(d.ARRAY_BUFFER,null);d.drawArrays(d.TRIANGLE_STRIP,0,e)}function onUpdate(g,c){if(picturePanel==null){return}picturePanel.update();if(nextPicturePanel!=null){nextPicturePanel.update();if(nextPicturePanel.mode==5){nextPicturePanel.setMode(0);picturePanel=nextPicturePanel;nextPicturePanel=null;picturePanel.selectedIndex=0}}g.clear(g.COLOR_BUFFER_BIT);c.clearRect(0,0,400,400);picturePanel.draw(g,g_panelDefaultMatrix);if(nextPicturePanel!=null){nextPicturePanel.draw(g,g_panelDefaultMatrix)}if(picturePanel.selectedIndex>=0){var e=new Matrix4();var a=new Matrix4();useColorShader(g);e.setTranslate(1.2,1.2,2);a.set(g_viewProjMatrix);a.multiply(e);drawVerticesColors(g,normalVerticesColors,a);useTextureShader(g);e.setTranslate(1.2,1.2,2.001);a.set(g_viewProjMatrix);a.multiply(e);picturePanel.cells[picturePanel.selectedIndex].draw(g,a,false);var f=picturePanel.infos[picturePanel.selectedIndex].description;var b=f.split("\n");c.font='14px "Times New Roman"';c.fillStyle="rgba(255, 255, 255, 1)";for(var d=0;d<b.length;d++){c.fillText(b[d],270,150+d*16)}}return true}function keydown(a,b){if(picturePanel==null){return}if(picturePanel.mode!=0){return}switch(a.keyCode){case 38:picturePanel.selectUpper();break;case 40:picturePanel.selectLower();break;case 39:picturePanel.selectRight();break;case 37:picturePanel.selectLeft();break;case 33:this.nextPicturePanel=new PicturePanel(b,pictureInfos);this.nextPicturePanel.setMode(2);this.picturePanel.setMode(1);break;case 34:this.nextPicturePanel=new PicturePanel(b,pictureInfos);this.nextPicturePanel.setMode(4);this.picturePanel.setMode(3);break;default:break}}var cellX=new Array(-1.2,0,1.2,-1.2,0,1.2,-1.2,0,1.2,-1.2,0,1.2);var cellY=new Array(1.8,1.8,1.8,0.6,0.6,0.6,-0.6,-0.6,-0.6,-1.8,-1.8,-1.8);var upperIndex=new Array(0,9,10,11,0,1,2,3,4,5,6,7,8);var lowerIndex=new Array(0,3,4,5,6,7,8,9,10,11,0,1,2);var leftIndex=new Array(0,11,0,1,2,3,4,5,6,7,8,9,10);var rightIndex=new Array(0,1,2,3,4,5,6,7,8,9,10,11,0);var cellsParPanel=12;var PicturePanel=function(c,b){this.mode=0;this.selectedIndex=-1;this.angle=0;this.infos=b;this.cells=new Array();for(var a=0;a<cellsParPanel;a++){if(a>=this.infos.length){break}this.cells[a]=new PictureCell(c,this.infos[a].path)}};PicturePanel.prototype.setMode=function(a){this.mode=a;if(this.mode==1||this.mode==3){this.selectedIndex=-1}if(this.mode==2||this.mode==4){this.angle=180}};PicturePanel.prototype.selectUpper=function(){do{this.selectedIndex=upperIndex[this.selectedIndex+1]}while(this.selectedIndex>=this.cells.length)};PicturePanel.prototype.selectLower=function(){do{this.selectedIndex=lowerIndex[this.selectedIndex+1]}while(this.selectedIndex>=this.cells.length)};PicturePanel.prototype.selectRight=function(){do{this.selectedIndex=rightIndex[this.selectedIndex+1]}while(this.selectedIndex>=this.cells.length)};PicturePanel.prototype.selectLeft=function(){do{this.selectedIndex=leftIndex[this.selectedIndex+1]}while(this.selectedIndex>=this.cells.length)};PicturePanel.prototype.update=function(c,a){var b=8;switch(this.mode){case 1:this.angle-=b;if(this.angle<0){this.angle+=360}if(this.angle<=180){this.angle=180;this.mode=5}break;case 2:this.angle-=b;if(this.angle<=0){this.angle=0;this.mode=5}break;case 3:this.angle+=b;if(this.angle>=180){this.angle=180;this.mode=5}break;case 4:this.angle+=b;if(this.angle>=360){this.angle=0;this.mode=5}break}return(this.mode)};PicturePanel.prototype.draw=function(f,e){var d=new Matrix4();d.set(e);d.rotate(this.angle,0,1,0);var c=new Matrix4();var a=new Matrix4();useColorShader(f);for(var b=0;b<cellsParPanel;b++){c.set(d);c.translate(cellX[b],cellY[b],0.001);a.set(g_viewProjMatrix);a.multiply(c);if(b==this.selectedIndex){drawVerticesColors(f,selectedVerticesColors,a)}else{drawVerticesColors(f,normalVerticesColors,a)}}useTextureShader(f);for(var b=0;b<this.cells.length;b++){c.set(d);c.translate(cellX[b],cellY[b],0.002);a.set(g_viewProjMatrix);a.multiply(c);this.cells[b].draw(f,a,(b==this.selectedIndex))}};var PictureCell=function(c,a){this.filePath=a;this.isTextureLoaded=false;this.result=true;this.verticesTexCoords=new Float32Array([-0.5,0.5,0,1,-0.5,-0.5,0,0,0.5,0.5,1,1,0.5,-0.5,1,0]);this.n=4;this.texture=c.createTexture();if(!this.texture){console.log("Failed to Create a texture object");this.result=false;return}this.image=new Image();if(!this.image){console.log("Failed to Create an image object");return false}var b=this;this.image.onload=function(){b.onLoadTexture(c)};this.image.src=a};PictureCell.prototype.onLoadTexture=function(a){this.isTextureLoaded=true};PictureCell.prototype.draw=function(c,b){c.uniformMatrix4fv(u_MvpMatrix,false,b.elements);c.bindBuffer(c.ARRAY_BUFFER,g_vertexTexCoordBuffer);c.bufferData(c.ARRAY_BUFFER,this.verticesTexCoords,c.STATIC_DRAW);var a=this.verticesTexCoords.BYTES_PER_ELEMENT;c.vertexAttribPointer(a_Position,2,c.FLOAT,false,a*4,0);c.enableVertexAttribArray(a_Position);c.vertexAttribPointer(a_TexCoord,2,c.FLOAT,false,a*4,a*2);c.enableVertexAttribArray(a_TexCoord);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,1);c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,this.texture);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texImage2D(c.TEXTURE_2D,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,this.image);c.uniform1i(u_Sampler,0);c.drawArrays(c.TRIANGLE_STRIP,0,this.n)};