function getMapStyle(t,e){var i=styleHashMap.get(t);return i?i.get(e):null}function addEvent(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?(t["e"+e+i]=i,t[e+fn]=function(){t["e"+e+i](window.event)},t.attachEvent("on"+e,t[e+i])):t["on"+e]=t["e"+e+i]}function Pop(t,e,i,n){n=$.extend(options,n),this.title=t,this.url=e,this.intro=i,this.apearTime=1e3,this.hideTime=500,this.delay=n.delay,this.addInfo(),n.auto?this.showDiv():null,this.closeDiv()}$(function(){$.views.helpers({debug:function(t){console.log(t)}})}),$.views.viewModels("MarkerLayerStyle",{getters:["renderStyle","uniformConfig","canvasConfig","heatmapConfig","categoryConfig","textConfig","sortConfig","labelConfig","shapeArray","layer"],extend:{defaultIconSelected:function(t){var e,i="",n=this.shapeArray(),r=this.uniformConfig();return n.indexOf(r.symbol)>=0?(e="icon num dt-f13",i=n[n.indexOf(r.symbol)]):"null"==r.symbol?(e="icon num dt-f13",i="\u65e0"):e="icon "+r.symbol,"className"==t?e:i},defaultIconHasBubble:function(){var t=this.uniformConfig().bubble;return t?"\u6709":"\u65e0"},defaultHasCluster:function(t){var e=!1;return"normal"==t?e=this.uniformConfig().is_cluster:"classify"==t?e=this.categoryConfig().is_cluster:"sort"==t&&(e=this.sortConfig().is_cluster),e?"\u662f":"\u5426"},defaultDataHasClassify:function(){var t=this.categoryConfig().is_categorized;return t?"\u662f":"\u5426"},defaultIconSizeSelected:function(){var t=this.uniformConfig();return"s"==t.size?"\u5c0f":"m"==t.size?"\u4e2d":"l"==t.size?"\u5927":void 0},defaultLabelSelected:function(){var t=this.labelConfig().field;return null==t?"\u65e0\u6807\u7b7e":t},defaultLabelStyleSelected:function(){switch(parseInt(this.labelConfig().style_type)){case 0:return"\u9ed8\u8ba4\u7cfb";case 1:return"\u7b80\u7ea6\u7cfb";case 2:return"\u7ecf\u5178\u7cfb";case 3:return"\u7a33\u91cd\u7cfb";case 4:return"\u6e05\u65b0\u7cfb";case 5:return"\u5409\u7965\u7cfb"}},defaultTextFamilySelect:function(){switch(this.textConfig().font){case 0:return"\u5b8b\u4f53";case 1:return"\u96c5\u9ed1";case 2:return"\u6977\u4f53"}},defaultTextCss:function(){switch(this.textConfig().font){case 0:return"SimSun";case 1:return"Microsoft YaHei";case 2:return"KaiTi"}},defaultCanvasIconSelected:function(){switch(this.canvasConfig().shape){case"BMAP_POINT_SHAPE_WATERDROP":return"<div class='canvas-marker'></div>";case"BMAP_POINT_SHAPE_CIRCLE":return"<div class='canvas-circle' style='background-color:"+this.canvasConfig().color+";'></div>";case"BMAP_POINT_SHAPE_STAR":return"<div class='glyphicon glyphicon-star canvas-star' style='color:"+this.canvasConfig().color+";'></div>";case"BMAP_POINT_SHAPE_SQUARE":return"<div class='canvas-square' style='background-color:"+this.canvasConfig().color+"'></div>";case"BMAP_POINT_SHAPE_RHOMBUS":return"<div class='canvas-rhombus' style='background-color:"+this.canvasConfig().color+"'></div>";default:return""}},defaultSortType:function(){switch(this.sortConfig().type){case"a-z":return"a-z";default:return"1~999"}},defaultSortIconSizeSelected:function(){switch(this.sortConfig().size){case"s":return"\u5c0f";case"m":return"\u4e2d";case"l":return"\u5927"}},markerLayerStyleType:function(){var t=["normal","canvas","heatmap","","text","sort","classify"],e=this.renderStyle();return t[parseInt(e)]||""},getCategoryField:function(){var t=this.categoryConfig().field;if(null==t||""==t){var e=this.layer().attrs;e&&e.length>0&&(t=e[0])}return t},getCategoryMethodName:function(){var t={unique:"\u7c7b\u522b",range:"\u8303\u56f4"},e=this.categoryConfig().method;return"range"!=e&&(e="unique"),t[e]},defaultHeatmapField:function(){var t=this.heatmapConfig().field;return"undefined"==typeof t||null==t||""==t?"\u65e0":t}}}),$.views.viewModels("LineLayerStyle",{getters:["renderStyle","uniformConfig","categoryConfig","labelConfig","layer"],extend:{lineLayerStyleType:function(){var t=["normal","classify"],e=this.renderStyle();return t[parseInt(e)]||""},defaultLineType:function(){var t=this.uniformConfig().stroke_style;switch(t){case"solid":return"<div class='line-solid'></div>";case"dashed":return"<div class='line-dashed'></div>";case"arrow":return"<div class='line-arrow'></div>";case"arrow_node":return"<div class='line-arrow-node'></div>"}},defaultLabelSelected:function(){var t=this.labelConfig().field;return null==t?"\u65e0\u6807\u7b7e":t},defaultDataHasClassify:function(){var t=this.categoryConfig().is_categorized;return t?"\u662f":"\u5426"},defaultLabelStyleSelected:function(){switch(parseInt(this.labelConfig().style_type)){case 0:return"\u9ed8\u8ba4\u7cfb";case 1:return"\u7b80\u7ea6\u7cfb";case 2:return"\u7ecf\u5178\u7cfb";case 3:return"\u7a33\u91cd\u7cfb";case 4:return"\u6e05\u65b0\u7cfb";case 5:return"\u5409\u7965\u7cfb";default:return"\u9ed8\u8ba4\u7cfb"}},defaultLineOpacity:function(){var t=parseFloat(this.uniformConfig().stroke_opacity);return isNaN(t)?20:100-parseInt(100*t)},getCategoryField:function(){var t=this.categoryConfig().field;if(null==t||""==t){var e=this.layer().attrs;e&&e.length>0&&(t=e[0])}return t},getCategoryMethodName:function(){var t={unique:"\u7c7b\u522b",range:"\u8303\u56f4"},e=this.categoryConfig().method;return"range"!=e&&(e="unique"),t[e]}}}),$.views.viewModels("RegionLayerStyle",{getters:["renderStyle","uniformConfig","categoryConfig","labelConfig","layer"],extend:{regionLayerStyleType:function(){var t=["normal","classify"],e=this.renderStyle();return t[parseInt(e)]||""},defaultLabelSelected:function(){var t=this.labelConfig().field;return null==t?"\u65e0\u6807\u7b7e":t},defaultDataHasClassify:function(){var t=this.categoryConfig().is_categorized;return t?"\u662f":"\u5426"},defaultLabelStyleSelected:function(){switch(parseInt(this.labelConfig().style_type)){case 0:return"\u9ed8\u8ba4\u7cfb";case 1:return"\u7b80\u7ea6\u7cfb";case 2:return"\u7ecf\u5178\u7cfb";case 3:return"\u7a33\u91cd\u7cfb";case 4:return"\u6e05\u65b0\u7cfb";case 5:return"\u5409\u7965\u7cfb";default:return"\u9ed8\u8ba4\u7cfb"}},defaultRegionFillOpacity:function(){var t=parseFloat(this.uniformConfig().fill_opacity);return isNaN(t)?20:100-parseInt(100*t)},defaultRegionStrokeOpacity:function(){var t=parseFloat(this.uniformConfig().stroke_opacity);return isNaN(t)?20:100-parseInt(100*t)},getCategoryField:function(){var t=this.categoryConfig().field;if(null==t||""==t){var e=this.layer().attrs;e&&e.length>0&&(t=e[0])}return t},getCategoryMethodName:function(){var t={unique:"\u7c7b\u522b",range:"\u8303\u56f4"},e=this.categoryConfig().method;return"range"!=e&&(e="unique"),t[e]}}}),function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define(i):e[t]=i()}("HashMap",DT={},function(){"use strict";var t=function(){this.size=0,this.array=[],this.entry={},this.type="HashMap"};return t.prototype={put:function(t,e){this.containsKey(t)||this.size++,this.entry[t]=e},add:function(t){this.array.push(t)},get:function(t){return this.containsKey(t)?this.entry[t]:null},remove:function(t){this.containsKey(t)&&delete this.entry[t]&&this.size--},containsKey:function(t){return t in this.entry},containsValue:function(t){for(var e in this.entry)if(this.entry[e]==t)return!0;return!1},update:function(t,e){this.entry[t]=e},getSize:function(){return this.size},clear:function(){this.size=0,this.entry={}},keys:function(){var t=[];for(var e in this.entry)t.push(e);return t},values:function(){var t=[];for(var e in this.entry)t.push(this.entry[e]);return t},getArray:function(){return this.array},clearArray:function(){this.array=[]}},t});var DtwyLib=window.DtwyLib=DtwyLib||{};!function(){function t(t,e,i){return null!=e&&(t=Math.max(t,e)),null!=i&&(t=Math.min(t,i)),t}function e(t,e,i){for(;t>i;)t-=i-e;for(;t<e;)t+=i-e;return t}var i=6370996.81,n=DtwyLib.GeoUtils=function(){};n.isPointInRect=function(t,e){if(!(t instanceof L.LatLng&&e instanceof L.LatLngBounds))return!1;var i=e.getSouthWest(),n=e.getNorthEast();return t.lng>=i.lng&&t.lng<=n.lng&&t.lat>=i.lat&&t.lat<=n.lat},n.isPointInCircle=function(t,e){if(!(t instanceof L.LatLng&&e instanceof L.Circle))return!1;var i=e.getLatLng(),r=e.getRadius(),a=n.getDistance(t,i);return a<=r},n.isPointOnPolyline=function(t,e){if(!(t instanceof L.LatLng&&e instanceof L.Polyline))return!1;var i=e.getBounds();if(!this.isPointInRect(t,i))return!1;for(var n=e.getPath(),r=0;r<n.length-1;r++){var a=n[r],o=n[r+1];if(t.lng>=Math.min(a.lng,o.lng)&&t.lng<=Math.max(a.lng,o.lng)&&t.lat>=Math.min(a.lat,o.lat)&&t.lat<=Math.max(a.lat,o.lat)){var s=(a.lng-t.lng)*(o.lat-t.lat)-(o.lng-t.lng)*(a.lat-t.lat);if(s<2e-10&&s>-2e-10)return!0}}return!1},n.isPointInPolygon=function(t,e){if(!(t instanceof L.LatLng&&e instanceof L.Polygon))return!1;var i=e.getBounds();if(!this.isPointInRect(t,i))return!1;for(var n=e.getLatLngs(),r=new Array,a=0;a<n.length;a++)for(var o=0;o<n[a].length;o++)r.push(n[a][o]);var s,l,d=r.length,h=!0,c=0,u=2e-10,p=t;s=r[0];for(var f=1;f<=d;++f){if(p.equals(s))return h;if(l=r[f%d],p.lat<Math.min(s.lat,l.lat)||p.lat>Math.max(s.lat,l.lat))s=l;else{if(p.lat>Math.min(s.lat,l.lat)&&p.lat<Math.max(s.lat,l.lat)){if(p.lng<=Math.max(s.lng,l.lng)){if(s.lat==l.lat&&p.lng>=Math.min(s.lng,l.lng))return h;if(s.lng==l.lng){if(s.lng==p.lng)return h;++c}else{var m=(p.lat-s.lat)*(l.lng-s.lng)/(l.lat-s.lat)+s.lng;if(Math.abs(p.lng-m)<u)return h;p.lng<m&&++c}}}else if(p.lat==l.lat&&p.lng<=l.lng){var g=r[(f+1)%d];p.lat>=Math.min(s.lat,g.lat)&&p.lat<=Math.max(s.lat,g.lat)?++c:c+=2}s=l}}return c%2!=0},n.degreeToRad=function(t){return Math.PI*t/180},n.radToDegree=function(t){return 180*t/Math.PI},n.getDistance=function(r,a){if(!(r instanceof L.LatLng&&a instanceof L.LatLng))return 0;r.lng=e(r.lng,-180,180),r.lat=t(r.lat,-74,74),a.lng=e(a.lng,-180,180),a.lat=t(a.lat,-74,74);var o,s,l,d;return o=n.degreeToRad(r.lng),l=n.degreeToRad(r.lat),s=n.degreeToRad(a.lng),d=n.degreeToRad(a.lat),i*Math.acos(Math.sin(l)*Math.sin(d)+Math.cos(l)*Math.cos(d)*Math.cos(s-o))},n.getPolylineDistance=function(t){if(t instanceof L.Polyline||t instanceof Array){var e;if(e=t instanceof L.Polyline?t.getPath():t,e.length<2)return 0;for(var i=0,r=0;r<e.length-1;r++){var a=e[r],o=e[r+1],s=n.getDistance(a,o);i+=s}return i}return 0},n.getPolygonArea=function(t){if(!(t instanceof L.Polygon||t instanceof Array))return 0;var e;if(e=t instanceof L.Polygon?t.getPath():t,e.length<3)return 0;for(var n=0,r=0,a=0,o=0,s=0,l=0,d=0,h=0,c=0,u=0,p=0,f=0,m=0,g=0,_=0,y=0,v=0,b=0,w=0,x=0,k=0,C=0,T=0,$=0,M=0,P=0,D=0,S=0,I=0,E=0,U=0,O=0,j=0,A=0,z=i,B=e.length,R=0;R<B;R++)0==R?(r=e[B-1].lng*Math.PI/180,a=e[B-1].lat*Math.PI/180,o=e[0].lng*Math.PI/180,s=e[0].lat*Math.PI/180,l=e[1].lng*Math.PI/180,d=e[1].lat*Math.PI/180):R==B-1?(r=e[B-2].lng*Math.PI/180,a=e[B-2].lat*Math.PI/180,o=e[B-1].lng*Math.PI/180,s=e[B-1].lat*Math.PI/180,l=e[0].lng*Math.PI/180,d=e[0].lat*Math.PI/180):(r=e[R-1].lng*Math.PI/180,a=e[R-1].lat*Math.PI/180,o=e[R].lng*Math.PI/180,s=e[R].lat*Math.PI/180,l=e[R+1].lng*Math.PI/180,d=e[R+1].lat*Math.PI/180),h=Math.cos(s)*Math.cos(o),c=Math.cos(s)*Math.sin(o),u=Math.sin(s),p=Math.cos(a)*Math.cos(r),f=Math.cos(a)*Math.sin(r),m=Math.sin(a),g=Math.cos(d)*Math.cos(l),_=Math.cos(d)*Math.sin(l),y=Math.sin(d),v=(h*h+c*c+u*u)/(h*p+c*f+u*m),b=(h*h+c*c+u*u)/(h*g+c*_+u*y),w=v*p-h,x=v*f-c,k=v*m-u,C=b*g-h,T=b*_-c,$=b*y-u,I=(C*w+T*x+$*k)/(Math.sqrt(C*C+T*T+$*$)*Math.sqrt(w*w+x*x+k*k)),I=Math.acos(I),M=T*k-$*x,P=0-(C*k-$*w),D=C*x-T*w,S=0!=h?M/h:0!=c?P/c:D/u,S>0?(E+=I,j++):(U+=I,O++);var F,N;return F=E+(2*Math.PI*O-U),N=2*Math.PI*j-E+U,A=E>U?F-(B-2)*Math.PI<1?F:N:N-(B-2)*Math.PI<1?N:F,n=(A-(B-2)*Math.PI)*z*z}}(),DT.Layer=function(){this.id="",this.type="",this.title="",this.display="show",this.show_fields="",this.uniform_title="",this.categories=[],this.attrs=[],this.attr_fields=[],this.locate_field="",this.uniform_config=null,this.category_config=null,this.label_config={field:null,style_type:0},this.render_style=0},DT.Layer.prototype={setLayerDisplay:function(t){this.display=t},setShowFields:function(t){this.show_fields=t},getLayerDisplay:function(){return this.display},getLayerId:function(){return this.id},setLayerId:function(t){this.id=t},getTitle:function(){return this.title},setTitle:function(t){this.title=t},getTypeLabel:function(){return"marker_layer"==this.type?"\u6807\u6ce8":"line_layer"==this.type?"\u7ebf\u8def":"region_layer"==this.type?"\u533a\u57df":""},getType:function(){return this.type},setType:function(t){this.type=t},getUniformTitle:function(){return this.uniform_title},setUniformTitle:function(t){this.uniform_title=t},getLabelConfig:function(){return this.label_config},setLabelConfig:function(t){this.label_config=t},getAttrs:function(){return this.attrs},setAttrs:function(t){this.attrs=t},getAttrFields:function(){return this.attr_fields},getAttrField:function(t){var e=null;if(!this.attr_fields)return null;for(var i=0;i<this.attr_fields.length;i++)if(this.attr_fields[i].field==t){e=this.attr_fields[i];break}return e},getNumberFields:function(){for(var t=[],e=0;e<this.attr_fields.length;e++)"number"==this.attr_fields[e].field_type&&t.push(this.attr_fields[e]);return t},setAttrFields:function(t){this.attr_fields=t},getLocateField:function(){return this.locate_field},setLocateField:function(t){this.locate_field=t},getCategories:function(){return this.categories},getCategory:function(t){var e=null;if(this.categories&&this.categories.length>0)for(var i=0;i<this.categories.length;i++)if(this.categories[i]&&this.categories[i].id==t){e=this.categories[i];break}return e},setCategories:function(t){this.categories=t},getUniformConfig:function(){return this.uniform_config},setUniformConfig:function(t){this.uniform_config=t},getCategoryConfig:function(){return this.category_config},setCategoryConfig:function(t){this.category_config=t},getLabelStyle:function(){return this.label_config.style_type}},DT.MarkerLayer=function(){this.type="marker_layer",this.markers=new DT.HashMap,this.uniform_config={icon_id:null,icon_url:null,color:"f86767",size:"s",symbol:"null",bubble:!1,is_cluster:!1},this.canvas_config={color:"#f86767",size:"BMAP_POINT_SIZE_SMALL",shape:"BMAP_POINT_SHAPE_WATERDROP"},this.heatmap_config={gradient:"one",radius:20,max:null,field:null},this.category_config={field:null,is_number_field:!1,method:"unique",level:2,is_categorized:!0,is_cluster:!1,size:"s",symbol:"null",bubble:!0},this.text_config={color:"#ffffff",background_color:"#3ca0d3",border_color:"#ede8e4",font:0,show_decoration:!1,size:12},this.sort_config={color:"f86767",size:"s",type:"a-z",is_cluster:!1},this.getMarkers=function(){return this.markers},this.setMarkers=function(t){t instanceof DT.HashMap&&(this.markers=t)},this.getFeaturesCount=function(){return this.markers.getSize()},this.getMarker=function(t){return this.markers.get(t)},this.setMarker=function(t){this.markers.update(t.feature_id,t)},this.removeMarker=function(t){this.markers.remove(t);for(var e=this.getMarkers().getArray(),i=0;i<e.length;i++)if(e[i].feature_id==t){e.splice(i,1);break}},this.update=function(t){this.setTitle(t.title),this.setUniformTitle(t.uniform_title),t.sort_col&&this.setAttrs(t.sort_col.split(",")),this.setAttrFields(t.attr_fields),this.setLocateField(t.locate_field),this.setCategories(t.categories),this.render_style=t.render_style,this.setUniformConfig(t.uniform_config),this.setCanvasConfig(t.canvas_config),this.setHeatmapConfig(t.heatmap_config),this.setCategoryConfig(t.category_config),this.setTextConfig(t.text_config),this.setSortConfig(t.sort_config),this.setLabelConfig(t.label_config)},this.getStyleSetting=function(){return{renderStyle:this.render_style,uniformConfig:this.uniform_config,canvasConfig:this.canvas_config,heatmapConfig:this.heatmap_config,categoryConfig:this.category_config,textConfig:this.text_config,sortConfig:this.sort_config,labelConfig:this.label_config,layer_type:"marker_layer"}},this.getCanvasConfig=function(){return this.canvas_config},this.setCanvasConfig=function(t){t&&(this.canvas_config=t)},this.getHeatmapConfig=function(){return this.heatmap_config},this.setHeatmapConfig=function(t){t&&(this.heatmap_config=t)},this.getTextConfig=function(){return this.text_config},this.setTextConfig=function(t){t&&(this.text_config=t)},this.getSortConfig=function(){return this.sort_config},this.setSortConfig=function(t){t&&(this.sort_config=t)},this.isCategorized=function(){return 6==this.render_style&&this.category_config.is_categorized},this.isCluster=function(){return 0==this.render_style?this.uniform_config.is_cluster:6==this.render_style?this.category_config.is_cluster:5==this.render_style&&this.sort_config.is_cluster},this.hideFeatures=function(){if(2==this.render_style)MarkerUtils.map.removeOverlay(MarkerUtils.map.dt_heatmap[this.id][0]);else if(this.isCluster())MarkerUtils.map.removeOverlay(MarkerUtils.map.dt_clusterer[this.id]);else for(var t=this.getMarkers().values(),e=0;e<t.length;e++)t[e].hide(),t[e].hideLabel()},this.removeMarkersFromMap=function(){for(var t=this.render_style,e=this.getMarkers().values(),i=0;i<e.length;i++){var n=e[i];0==t&&n instanceof Dtwy.CanvasMarker?n.remove():1==t&&n instanceof Dtwy.Marker&&n.remove()}}},DT.RegionLayer=function(){this.type="region_layer",this.regions=new DT.HashMap,this.uniform_config={fillColor:"#ff0000",fillOpacity:.2,strokeColor:"#ff0000",strokeWeight:1,strokeOpacity:.8,strokeStyle:"solid"},this.category_config={field:null,is_number_field:!1,method:"unique",level:2,is_categorized:!0},this.getRegions=function(){return this.regions},this.getRegion=function(t){return this.regions.get(t)},this.getFeaturesCount=function(){return this.regions.getSize()},this.removeRegion=function(t){this.regions.remove(t)},this.update=function(t){this.setTitle(t.title),this.setUniformTitle(t.uniform_title),t.sort_col&&this.setAttrs(t.sort_col.split(",")),this.setShowFields(t.show_fields),this.setAttrFields(t.attr_fields),this.setCategories(t.categories),this.render_style=t.render_style,this.setUniformConfig(t.uniform_config),this.setCategoryConfig(t.category_config),this.setLabelConfig(t.label_config)},this.getStyleSetting=function(){return{renderStyle:this.render_style,uniformConfig:this.uniform_config,categoryConfig:this.category_config,labelConfig:this.label_config,layer_type:"region_layer"}},this.isCategorized=function(){return 1==this.render_style&&this.category_config.is_categorized},this.hideFeatures=function(){for(var t=this.getRegions().values(),e=0;e<t.length;e++)t[e].hide(),t[e].hideLabel()},this.sort=function(t){if("area"==t){var e=this.getRegions().values();e.sort(function(t,e){var i=0,n=0;return i=t instanceof Dtwy.Circle?Math.PI*Math.pow(t.getRadius(),2):L.GeometryUtil.geodesicArea(t.getLatLngs()),n=e instanceof Dtwy.Circle?Math.PI*Math.pow(e.getRadius(),2):L.GeometryUtil.geodesicArea(e.getLatLngs()),i<n?1:-1})}}},DT.LineLayer=function(){this.type="line_layer",this.lines=new DT.HashMap,this.uniform_config={strokeColor:"#1087bf",strokeWeight:4,strokeOpacity:.8,strokeStyle:"solid"},this.category_config={field:null,is_number_field:!1,method:"unique",level:2,is_categorized:!0},this.getLines=function(){return this.lines},this.getLine=function(t){return this.lines.get(t)},this.getFeaturesCount=function(){return this.lines.getSize()},this.removeLine=function(t){this.lines.remove(t)},this.update=function(t){this.setTitle(t.title),this.setUniformTitle(t.uniform_title),t.sort_col&&this.setAttrs(t.sort_col.split(",")),this.setShowFields(t.show_fields),this.setAttrFields(t.attr_fields),this.setCategories(t.categories),this.render_style=t.render_style,this.setUniformConfig(t.uniform_config),this.setCategoryConfig(t.category_config),this.setLabelConfig(t.label_config)},this.getStyleSetting=function(){return{renderStyle:this.render_style,uniformConfig:this.uniform_config,categoryConfig:this.category_config,labelConfig:this.label_config,layer_type:"line_layer"}},this.isCategorized=function(){return 1==this.render_style&&this.category_config.is_categorized},this.hideFeatures=function(){for(var t=this.getLines().values(),e=0;e<t.length;e++)t[e].hide(),t[e].hideLabel()}},DT.MarkerLayer.prototype=new DT.Layer,DT.RegionLayer.prototype=new DT.Layer,DT.LineLayer.prototype=new DT.Layer,function(t,e,i){function n(){var e=t.L;r.noConflict=function(){return t.L=e,this},t.L=r}var r={version:"1.0.2+4bbb16c"};"object"==typeof module&&"object"==typeof module.exports?module.exports=r:"function"==typeof define&&define.amd&&define(r),"undefined"!=typeof t&&n(),r.Util={extend:function(t){var e,i,n,r;for(i=1,n=arguments.length;i<n;i++){r=arguments[i];for(e in r)t[e]=r[e]}return t},create:Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}(),bind:function(t,e){var i=Array.prototype.slice;if(t.bind)return t.bind.apply(t,i.call(arguments,1));var n=i.call(arguments,2);return function(){return t.apply(e,n.length?n.concat(i.call(arguments)):arguments)}},stamp:function(t){return t._leaflet_id=t._leaflet_id||++r.Util.lastId,t._leaflet_id},lastId:0,throttle:function(t,e,i){var n,r,a,o;return o=function(){n=!1,r&&(a.apply(i,r),r=!1)},a=function(){n?r=arguments:(t.apply(i,arguments),setTimeout(o,e),n=!0)}},wrapNum:function(t,e,i){var n=e[1],r=e[0],a=n-r;return t===n&&i?t:((t-r)%a+a)%a+r},falseFn:function(){return!1},formatNum:function(t,e){var i=Math.pow(10,e||5);return Math.round(t*i)/i},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},splitWords:function(t){return r.Util.trim(t).split(/\s+/)},setOptions:function(t,e){t.hasOwnProperty("options")||(t.options=t.options?r.Util.create(t.options):{});for(var i in e)t.options[i]=e[i];return t.options},getParamString:function(t,e,i){var n=[];for(var r in t)n.push(encodeURIComponent(i?r.toUpperCase():r)+"="+encodeURIComponent(t[r]));return(e&&e.indexOf("?")!==-1?"&":"?")+n.join("&")},template:function(t,e){return t.replace(r.Util.templateRe,function(t,n){var r=e[n];if(r===i)throw new Error("No value provided for variable "+t);return"function"==typeof r&&(r=r(e)),r})},templateRe:/\{ *([\w_\-]+) *\}/g,isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},indexOf:function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function e(e){return t["webkit"+e]||t["moz"+e]||t["ms"+e]}function i(e){var i=+new Date,r=Math.max(0,16-(i-n));return n=i+r,t.setTimeout(e,r)}var n=0,a=t.requestAnimationFrame||e("RequestAnimationFrame")||i,o=t.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){t.clearTimeout(e)};r.Util.requestAnimFrame=function(e,n,o){return o&&a===i?void e.call(n):a.call(t,r.bind(e,n))},r.Util.cancelAnimFrame=function(e){e&&o.call(t,e)}}(),r.extend=r.Util.extend,r.bind=r.Util.bind,r.stamp=r.Util.stamp,r.setOptions=r.Util.setOptions,r.Class=function(){},r.Class.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},i=e.__super__=this.prototype,n=r.Util.create(i);n.constructor=e,e.prototype=n;for(var a in this)this.hasOwnProperty(a)&&"prototype"!==a&&(e[a]=this[a]);return t.statics&&(r.extend(e,t.statics),delete t.statics),t.includes&&(r.Util.extend.apply(null,[n].concat(t.includes)),delete t.includes),n.options&&(t.options=r.Util.extend(r.Util.create(n.options),t.options)),r.extend(n,t),n._initHooks=[],n.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=n._initHooks.length;t<e;t++)n._initHooks[t].call(this)}},e},r.Class.include=function(t){return r.extend(this.prototype,t),this},r.Class.mergeOptions=function(t){return r.extend(this.prototype.options,t),this},r.Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this},r.Evented=r.Class.extend({on:function(t,e,i){if("object"==typeof t)for(var n in t)this._on(n,t[n],e);else{t=r.Util.splitWords(t);for(var a=0,o=t.length;a<o;a++)this._on(t[a],e,i)}return this},off:function(t,e,i){if(t)if("object"==typeof t)for(var n in t)this._off(n,t[n],e);else{t=r.Util.splitWords(t);for(var a=0,o=t.length;a<o;a++)this._off(t[a],e,i)}else delete this._events;return this},_on:function(t,e,n){this._events=this._events||{};var r=this._events[t];r||(r=[],this._events[t]=r),n===this&&(n=i);for(var a={fn:e,ctx:n},o=r,s=0,l=o.length;s<l;s++)if(o[s].fn===e&&o[s].ctx===n)return;o.push(a),r.count++},_off:function(t,e,n){var a,o,s;if(this._events&&(a=this._events[t])){if(!e){for(o=0,s=a.length;o<s;o++)a[o].fn=r.Util.falseFn;return void delete this._events[t]}if(n===this&&(n=i),a)for(o=0,s=a.length;o<s;o++){var l=a[o];if(l.ctx===n&&l.fn===e)return l.fn=r.Util.falseFn,this._firingCount&&(this._events[t]=a=a.slice()),void a.splice(o,1)}}},fire:function(t,e,i){if(!this.listens(t,i))return this;var n=r.Util.extend({},e,{type:t,target:this});if(this._events){var a=this._events[t];if(a){this._firingCount=this._firingCount+1||1;for(var o=0,s=a.length;o<s;o++){var l=a[o];l.fn.call(l.ctx||this,n)}this._firingCount--}}return i&&this._propagateEvent(n),this},listens:function(t,e){var i=this._events&&this._events[t];if(i&&i.length)return!0;if(e)for(var n in this._eventParents)if(this._eventParents[n].listens(t,e))return!0;return!1},once:function(t,e,i){if("object"==typeof t){for(var n in t)this.once(n,t[n],e);return this}var a=r.bind(function(){this.off(t,e,i).off(t,a,i)},this);return this.on(t,e,i).on(t,a,i)},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[r.stamp(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[r.stamp(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,r.extend({layer:t.target},t),!0)}});var a=r.Evented.prototype;a.addEventListener=a.on,a.removeEventListener=a.clearAllEventListeners=a.off,a.addOneTimeEventListener=a.once,a.fireEvent=a.fire,a.hasEventListeners=a.listens,r.Mixin={Events:a},function(){var i=navigator.userAgent.toLowerCase(),n=e.documentElement,a="ActiveXObject"in t,o=i.indexOf("webkit")!==-1,s=i.indexOf("phantom")!==-1,l=i.search("android [23]")!==-1,d=i.indexOf("chrome")!==-1,h=i.indexOf("gecko")!==-1&&!o&&!t.opera&&!a,c=0===navigator.platform.indexOf("Win"),u="undefined"!=typeof orientation||i.indexOf("mobile")!==-1,p=!t.PointerEvent&&t.MSPointerEvent,f=t.PointerEvent||p,m=a&&"transition"in n.style,g="WebKitCSSMatrix"in t&&"m11"in new t.WebKitCSSMatrix&&!l,_="MozPerspective"in n.style,y="OTransition"in n.style,v=!t.L_NO_TOUCH&&(f||"ontouchstart"in t||t.DocumentTouch&&e instanceof t.DocumentTouch);r.Browser={ie:a,ielt9:a&&!e.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in e),webkit:o,gecko:h,android:i.indexOf("android")!==-1,android23:l,chrome:d,safari:!d&&i.indexOf("safari")!==-1,win:c,ie3d:m,webkit3d:g,gecko3d:_,opera12:y,any3d:!t.L_DISABLE_3D&&(m||g||_)&&!y&&!s,mobile:u,mobileWebkit:u&&o,mobileWebkit3d:u&&g,mobileOpera:u&&t.opera,mobileGecko:u&&h,touch:!!v,msPointer:!!p,pointer:!!f,retina:(t.devicePixelRatio||t.screen.deviceXDPI/t.screen.logicalXDPI)>1}}(),r.Point=function(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e},r.Point.prototype={clone:function(){return new r.Point(this.x,this.y)},add:function(t){return this.clone()._add(r.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(r.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new r.Point(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new r.Point(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},distanceTo:function(t){t=r.point(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t=r.point(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=r.point(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+r.Util.formatNum(this.x)+", "+r.Util.formatNum(this.y)+")"}},r.point=function(t,e,n){return t instanceof r.Point?t:r.Util.isArray(t)?new r.Point(t[0],t[1]):t===i||null===t?t:"object"==typeof t&&"x"in t&&"y"in t?new r.Point(t.x,t.y):new r.Point(t,e,n)},r.Bounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,r=i.length;n<r;n++)this.extend(i[n])},r.Bounds.prototype={extend:function(t){return t=r.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new r.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new r.Point(this.min.x,this.max.y)},getTopRight:function(){return new r.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return t="number"==typeof t[0]||t instanceof r.Point?r.point(t):r.bounds(t),t instanceof r.Bounds?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=r.bounds(t);var e=this.min,i=this.max,n=t.min,a=t.max,o=a.x>=e.x&&n.x<=i.x,s=a.y>=e.y&&n.y<=i.y;return o&&s},overlaps:function(t){t=r.bounds(t);var e=this.min,i=this.max,n=t.min,a=t.max,o=a.x>e.x&&n.x<i.x,s=a.y>e.y&&n.y<i.y;return o&&s},isValid:function(){return!(!this.min||!this.max)}},r.bounds=function(t,e){return!t||t instanceof r.Bounds?t:new r.Bounds(t,e)},r.Transformation=function(t,e,i,n){this._a=t,this._b=e,this._c=i,this._d=n},r.Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new r.Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}},r.DomUtil={get:function(t){return"string"==typeof t?e.getElementById(t):t},getStyle:function(t,i){var n=t.style[i]||t.currentStyle&&t.currentStyle[i];if((!n||"auto"===n)&&e.defaultView){var r=e.defaultView.getComputedStyle(t,null);n=r?r[i]:null}return"auto"===n?null:n},create:function(t,i,n){var r=e.createElement(t);return r.className=i||"",n&&n.appendChild(r),r},remove:function(t){var e=t.parentNode;e&&e.removeChild(t)},empty:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},toFront:function(t){t.parentNode.appendChild(t)},toBack:function(t){var e=t.parentNode;e.insertBefore(t,e.firstChild)},hasClass:function(t,e){if(t.classList!==i)return t.classList.contains(e);var n=r.DomUtil.getClass(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)},addClass:function(t,e){if(t.classList!==i)for(var n=r.Util.splitWords(e),a=0,o=n.length;a<o;a++)t.classList.add(n[a]);else if(!r.DomUtil.hasClass(t,e)){var s=r.DomUtil.getClass(t);r.DomUtil.setClass(t,(s?s+" ":"")+e)}},removeClass:function(t,e){t.classList!==i?t.classList.remove(e):r.DomUtil.setClass(t,r.Util.trim((" "+r.DomUtil.getClass(t)+" ").replace(" "+e+" "," ")))},setClass:function(t,e){t.className.baseVal===i?t.className=e:t.className.baseVal=e},getClass:function(t){return t.className.baseVal===i?t.className:t.className.baseVal},setOpacity:function(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&r.DomUtil._setOpacityIE(t,e)},_setOpacityIE:function(t,e){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(t){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"},testProp:function(t){for(var i=e.documentElement.style,n=0;n<t.length;n++)if(t[n]in i)return t[n];return!1},setTransform:function(t,e,i){var n=e||new r.Point(0,0);t.style[r.DomUtil.TRANSFORM]=(r.Browser.ie3d?"translate("+n.x+"px,"+n.y+"px)":"translate3d("+n.x+"px,"+n.y+"px,0)")+(i?" scale("+i+")":"")},setPosition:function(t,e){t._leaflet_pos=e,r.Browser.any3d?r.DomUtil.setTransform(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getPosition:function(t){return t._leaflet_pos||new r.Point(0,0)}},function(){r.DomUtil.TRANSFORM=r.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);var i=r.DomUtil.TRANSITION=r.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);
if(r.DomUtil.TRANSITION_END="webkitTransition"===i||"OTransition"===i?i+"End":"transitionend","onselectstart"in e)r.DomUtil.disableTextSelection=function(){r.DomEvent.on(t,"selectstart",r.DomEvent.preventDefault)},r.DomUtil.enableTextSelection=function(){r.DomEvent.off(t,"selectstart",r.DomEvent.preventDefault)};else{var n=r.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);r.DomUtil.disableTextSelection=function(){if(n){var t=e.documentElement.style;this._userSelect=t[n],t[n]="none"}},r.DomUtil.enableTextSelection=function(){n&&(e.documentElement.style[n]=this._userSelect,delete this._userSelect)}}r.DomUtil.disableImageDrag=function(){r.DomEvent.on(t,"dragstart",r.DomEvent.preventDefault)},r.DomUtil.enableImageDrag=function(){r.DomEvent.off(t,"dragstart",r.DomEvent.preventDefault)},r.DomUtil.preventOutline=function(e){for(;e.tabIndex===-1;)e=e.parentNode;e&&e.style&&(r.DomUtil.restoreOutline(),this._outlineElement=e,this._outlineStyle=e.style.outline,e.style.outline="none",r.DomEvent.on(t,"keydown",r.DomUtil.restoreOutline,this))},r.DomUtil.restoreOutline=function(){this._outlineElement&&(this._outlineElement.style.outline=this._outlineStyle,delete this._outlineElement,delete this._outlineStyle,r.DomEvent.off(t,"keydown",r.DomUtil.restoreOutline,this))}}(),r.LatLng=function(t,e,n){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,n!==i&&(this.alt=+n)},r.LatLng.prototype={equals:function(t,e){if(!t)return!1;t=r.latLng(t);var n=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return n<=(e===i?1e-9:e)},toString:function(t){return"LatLng("+r.Util.formatNum(this.lat,t)+", "+r.Util.formatNum(this.lng,t)+")"},distanceTo:function(t){return r.CRS.Earth.distance(this,r.latLng(t))},wrap:function(){return r.CRS.Earth.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return r.latLngBounds([this.lat-e,this.lng-i],[this.lat+e,this.lng+i])},clone:function(){return new r.LatLng(this.lat,this.lng,this.alt)}},r.latLng=function(t,e,n){return t instanceof r.LatLng?t:r.Util.isArray(t)&&"object"!=typeof t[0]?3===t.length?new r.LatLng(t[0],t[1],t[2]):2===t.length?new r.LatLng(t[0],t[1]):null:t===i||null===t?t:"object"==typeof t&&"lat"in t?new r.LatLng(t.lat,"lng"in t?t.lng:t.lon,t.alt):e===i?null:new r.LatLng(t,e,n)},r.LatLngBounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,r=i.length;n<r;n++)this.extend(i[n])},r.LatLngBounds.prototype={extend:function(t){var e,i,n=this._southWest,a=this._northEast;if(t instanceof r.LatLng)e=t,i=t;else{if(!(t instanceof r.LatLngBounds))return t?this.extend(r.latLng(t)||r.latLngBounds(t)):this;if(e=t._southWest,i=t._northEast,!e||!i)return this}return n||a?(n.lat=Math.min(e.lat,n.lat),n.lng=Math.min(e.lng,n.lng),a.lat=Math.max(i.lat,a.lat),a.lng=Math.max(i.lng,a.lng)):(this._southWest=new r.LatLng(e.lat,e.lng),this._northEast=new r.LatLng(i.lat,i.lng)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,a=Math.abs(e.lng-i.lng)*t;return new r.LatLngBounds(new r.LatLng(e.lat-n,e.lng-a),new r.LatLng(i.lat+n,i.lng+a))},getCenter:function(){return new r.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new r.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new r.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof r.LatLng?r.latLng(t):r.latLngBounds(t);var e,i,n=this._southWest,a=this._northEast;return t instanceof r.LatLngBounds?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=a.lat&&e.lng>=n.lng&&i.lng<=a.lng},intersects:function(t){t=r.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),a=t.getNorthEast(),o=a.lat>=e.lat&&n.lat<=i.lat,s=a.lng>=e.lng&&n.lng<=i.lng;return o&&s},overlaps:function(t){t=r.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),a=t.getNorthEast(),o=a.lat>e.lat&&n.lat<i.lat,s=a.lng>e.lng&&n.lng<i.lng;return o&&s},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return!!t&&(t=r.latLngBounds(t),this._southWest.equals(t.getSouthWest())&&this._northEast.equals(t.getNorthEast()))},isValid:function(){return!(!this._southWest||!this._northEast)}},r.latLngBounds=function(t,e){return t instanceof r.LatLngBounds?t:new r.LatLngBounds(t,e)},r.Projection={},r.Projection.LonLat={project:function(t){return new r.Point(t.lng,t.lat)},unproject:function(t){return new r.LatLng(t.y,t.x)},bounds:r.bounds([-180,-90],[180,90])},r.Projection.SphericalMercator={R:6378137,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),a=Math.sin(n*e);return new r.Point(this.R*t.lng*e,this.R*Math.log((1+a)/(1-a))/2)},unproject:function(t){var e=180/Math.PI;return new r.LatLng((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:function(){var t=6378137*Math.PI;return r.bounds([-t,-t],[t,t])}()},r.CRS={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,i=this.scale(t),n=this.transformation.transform(e.min,i),a=this.transformation.transform(e.max,i);return r.bounds(n,a)},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?r.Util.wrapNum(t.lng,this.wrapLng,!0):t.lng,i=this.wrapLat?r.Util.wrapNum(t.lat,this.wrapLat,!0):t.lat,n=t.alt;return r.latLng(i,e,n)}},r.CRS.Simple=r.extend({},r.CRS,{projection:r.Projection.LonLat,transformation:new r.Transformation(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var i=e.lng-t.lng,n=e.lat-t.lat;return Math.sqrt(i*i+n*n)},infinite:!0}),r.CRS.Earth=r.extend({},r.CRS,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var i=Math.PI/180,n=t.lat*i,r=e.lat*i,a=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-t.lng)*i);return this.R*Math.acos(Math.min(a,1))}}),r.CRS.EPSG3857=r.extend({},r.CRS.Earth,{code:"EPSG:3857",projection:r.Projection.SphericalMercator,transformation:function(){var t=.5/(Math.PI*r.Projection.SphericalMercator.R);return new r.Transformation(t,.5,-t,.5)}()}),r.CRS.EPSG900913=r.extend({},r.CRS.EPSG3857,{code:"EPSG:900913"}),r.CRS.EPSG4326=r.extend({},r.CRS.Earth,{code:"EPSG:4326",projection:r.Projection.LonLat,transformation:new r.Transformation(1/180,1,-1/180,.5)}),r.Map=r.Evented.extend({options:{crs:r.CRS.EPSG3857,center:i,zoom:i,minZoom:i,maxZoom:i,layers:[],maxBounds:i,renderer:i,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=r.setOptions(this,e),this._initContainer(t),this._initLayout(),this._onResize=r.bind(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.zoom!==i&&(this._zoom=this._limitZoom(e.zoom)),e.center&&e.zoom!==i&&this.setView(r.latLng(e.center),e.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this.callInitHooks(),this._zoomAnimated=r.DomUtil.TRANSITION&&r.Browser.any3d&&!r.Browser.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),r.DomEvent.on(this._proxy,r.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,n){if(e=e===i?this._zoom:this._limitZoom(e),t=this._limitCenter(r.latLng(t),e,this.options.maxBounds),n=n||{},this._stop(),this._loaded&&!n.reset&&n!==!0){n.animate!==i&&(n.zoom=r.extend({animate:n.animate},n.zoom),n.pan=r.extend({animate:n.animate,duration:n.duration},n.pan));var a=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,n.zoom):this._tryAnimatedPan(t,n.pan);if(a)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(r.Browser.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(r.Browser.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),a=this.getSize().divideBy(2),o=t instanceof r.Point?t:this.latLngToContainerPoint(t),s=o.subtract(a).multiplyBy(1-1/n),l=this.containerPointToLatLng(a.add(s));return this.setView(l,e,{zoom:i})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():r.latLngBounds(t);var i=r.point(e.paddingTopLeft||e.padding||[0,0]),n=r.point(e.paddingBottomRight||e.padding||[0,0]),a=this.getBoundsZoom(t,!1,i.add(n));a="number"==typeof e.maxZoom?Math.min(e.maxZoom,a):a;var o=n.subtract(i).divideBy(2),s=this.project(t.getSouthWest(),a),l=this.project(t.getNorthEast(),a),d=this.unproject(s.add(l).divideBy(2).add(o),a);return{center:d,zoom:a}},fitBounds:function(t,e){if(t=r.latLngBounds(t),!t.isValid())throw new Error("Bounds are not valid.");var i=this._getBoundsCenterZoom(t,e);return this.setView(i.center,i.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(t=r.point(t).round(),e=e||{},!t.x&&!t.y)return this.fire("moveend");if(e.animate!==!0&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new r.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){r.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,n){function a(t){var e=t?-1:1,i=t?y:_,n=y*y-_*_+e*w*w*v*v,r=2*i*w*v,a=n/r,o=Math.sqrt(a*a+1)-a,s=o<1e-9?-18:Math.log(o);return s}function o(t){return(Math.exp(t)-Math.exp(-t))/2}function s(t){return(Math.exp(t)+Math.exp(-t))/2}function l(t){return o(t)/s(t)}function d(t){return _*(s(x)/s(x+b*t))}function h(t){return _*(s(x)*l(x+b*t)-o(x))/w}function c(t){return 1-Math.pow(1-t,1.5)}function u(){var i=(Date.now()-k)/C,n=c(i)*L;i<=1?(this._flyToFrame=r.Util.requestAnimFrame(u,this),this._move(this.unproject(p.add(f.subtract(p).multiplyBy(h(n)/v)),g),this.getScaleZoom(_/d(n),g),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}if(n=n||{},n.animate===!1||!r.Browser.any3d)return this.setView(t,e,n);this._stop();var p=this.project(this.getCenter()),f=this.project(t),m=this.getSize(),g=this._zoom;t=r.latLng(t),e=e===i?g:e;var _=Math.max(m.x,m.y),y=_*this.getZoomScale(g,e),v=f.distanceTo(p)||1,b=1.42,w=b*b,x=a(0),k=Date.now(),L=(a(1)-x)/b,C=n.duration?1e3*n.duration:1e3*L*.8;return this._moveStart(!0),u.call(this),this},flyToBounds:function(t,e){var i=this._getBoundsCenterZoom(t,e);return this.flyTo(i.center,i.zoom,e)},setMaxBounds:function(t){return t=r.latLngBounds(t),t.isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(t){return this.options.minZoom=t,this._loaded&&this.getZoom()<this.options.minZoom?this.setZoom(t):this},setMaxZoom:function(t){return this.options.maxZoom=t,this._loaded&&this.getZoom()>this.options.maxZoom?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var i=this.getCenter(),n=this._limitCenter(i,this._zoom,r.latLngBounds(t));return i.equals(n)||this.panTo(n,e),this._enforcingBounds=!1,this},invalidateSize:function(t){if(!this._loaded)return this;t=r.extend({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var i=this.getSize(),n=e.divideBy(2).round(),a=i.divideBy(2).round(),o=n.subtract(a);return o.x||o.y?(t.animate&&t.pan?this.panBy(o):(t.pan&&this._rawPanBy(o),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(r.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:i})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=r.extend({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=r.bind(this._handleGeolocationResponse,this),i=r.bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,i=t.coords.longitude,n=new r.LatLng(e,i),a=n.toBounds(t.coords.accuracy),o=this._locateOptions;if(o.setView){var s=this.getBoundsZoom(a);this.setView(n,o.maxZoom?Math.min(s,o.maxZoom):s)}var l={latlng:n,bounds:a,timestamp:t.timestamp};for(var d in t.coords)"number"==typeof t.coords[d]&&(l[d]=t.coords[d]);this.fire("locationfound",l)},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){if(this._initEvents(!0),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=i,this._containerId=i}r.DomUtil.remove(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this._loaded&&this.fire("unload");for(var t in this._layers)this._layers[t].remove();return this},createPane:function(t,e){var i="leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),n=r.DomUtil.create("div",i,e||this._mapPane);return t&&(this._panes[t]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),i=this.unproject(t.getTopRight());return new r.LatLngBounds(e,i)},getMinZoom:function(){return this.options.minZoom===i?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===i?this._layersMaxZoom===i?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=r.latLngBounds(t),i=r.point(i||[0,0]);var n=this.getZoom()||0,a=this.getMinZoom(),o=this.getMaxZoom(),s=t.getNorthWest(),l=t.getSouthEast(),d=this.getSize().subtract(i),h=this.project(l,n).subtract(this.project(s,n)),c=r.Browser.any3d?this.options.zoomSnap:1,u=Math.min(d.x/h.x,d.y/h.y);return n=this.getScaleZoom(u,n),c&&(n=Math.round(n/(c/100))*(c/100),n=e?Math.ceil(n/c)*c:Math.floor(n/c)*c),Math.max(a,Math.min(o,n))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new r.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var i=this._getTopLeftPoint(t,e);return new r.Bounds(i,i.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(t===i?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var n=this.options.crs;return e=e===i?this._zoom:e,n.scale(t)/n.scale(e)},getScaleZoom:function(t,e){var n=this.options.crs;e=e===i?this._zoom:e;var r=n.zoom(t*n.scale(e));return isNaN(r)?1/0:r},project:function(t,e){return e=e===i?this._zoom:e,this.options.crs.latLngToPoint(r.latLng(t),e)},unproject:function(t,e){return e=e===i?this._zoom:e,this.options.crs.pointToLatLng(r.point(t),e)},layerPointToLatLng:function(t){var e=r.point(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(r.latLng(t))._round();return e._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(r.latLng(t))},distance:function(t,e){return this.options.crs.distance(r.latLng(t),r.latLng(e))},containerPointToLayerPoint:function(t){return r.point(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return r.point(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(r.point(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(r.latLng(t)))},mouseEventToContainerPoint:function(t){return r.DomEvent.getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=r.DomUtil.get(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");r.DomEvent.addListener(e,"scroll",this._onScroll,this),this._containerId=r.Util.stamp(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&r.Browser.any3d,r.DomUtil.addClass(t,"leaflet-container"+(r.Browser.touch?" leaflet-touch":"")+(r.Browser.retina?" leaflet-retina":"")+(r.Browser.ielt9?" leaflet-oldie":"")+(r.Browser.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=r.DomUtil.getStyle(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),r.DomUtil.setPosition(this._mapPane,new r.Point(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(r.DomUtil.addClass(t.markerPane,"leaflet-zoom-hide"),r.DomUtil.addClass(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e){r.DomUtil.setPosition(this._mapPane,new r.Point(0,0));var i=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var n=this._zoom!==e;this._moveStart(n)._move(t,e).fire("viewreset")._moveEnd(n),i&&this.fire("load")},_moveStart:function(t){return t&&this.fire("zoomstart"),this.fire("movestart")},_move:function(t,e,n){e===i&&(e=this._zoom);var r=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),(r||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return r.Util.cancelAnimFrame(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){r.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){if(r.DomEvent){this._targets={},this._targets[r.stamp(this._container)]=this;var i=e?"off":"on";r.DomEvent[i](this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress",this._handleDOMEvent,this),this.options.trackResize&&r.DomEvent[i](t,"resize",this._onResize,this),r.Browser.any3d&&this.options.transform3DLimit&&this[i]("moveend",this._onMoveEnd)}},_onResize:function(){r.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=r.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var i,n=[],a="mouseout"===e||"mouseover"===e,o=t.target||t.srcElement,s=!1;o;){if(i=this._targets[r.stamp(o)],i&&("click"===e||"preclick"===e)&&!t._simulated&&this._draggableMoved(i)){s=!0;break}if(i&&i.listens(e,!0)){if(a&&!r.DomEvent._isExternalTarget(o,t))break;if(n.push(i),a)break}if(o===this._container)break;o=o.parentNode}return n.length||s||a||!r.DomEvent._isExternalTarget(o,t)||(n=[this]),n},_handleDOMEvent:function(t){if(this._loaded&&!r.DomEvent._skipped(t)){var e="keypress"===t.type&&13===t.keyCode?"click":t.type;"mousedown"===e&&r.DomUtil.preventOutline(t.target||t.srcElement),this._fireDOMEvent(t,e)}},_fireDOMEvent:function(t,e,i){if("click"===t.type){var n=r.Util.extend({},t);n.type="preclick",this._fireDOMEvent(n,n.type,i)}if(!t._stopped&&(i=(i||[]).concat(this._findEventTargets(t,e)),i.length)){var a=i[0];"contextmenu"===e&&a.listens(e,!0)&&r.DomEvent.preventDefault(t);var o={originalEvent:t};if("keypress"!==t.type){var s=a instanceof r.Marker;o.containerPoint=s?this.latLngToContainerPoint(a.getLatLng()):this.mouseEventToContainerPoint(t),o.layerPoint=this.containerPointToLayerPoint(o.containerPoint),o.latlng=s?a.getLatLng():this.layerPointToLatLng(o.layerPoint)}for(var l=0;l<i.length;l++)if(i[l].fire(e,o,!0),o.originalEvent._stopped||i[l].options.nonBubblingEvents&&r.Util.indexOf(i[l].options.nonBubblingEvents,e)!==-1)return}},_draggableMoved:function(t){return t=t.dragging&&t.dragging.enabled()?t:this,t.dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return r.DomUtil.getPosition(this._mapPane)||new r.Point(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){var n=t&&e!==i?this._getNewPixelOrigin(t,e):this.getPixelOrigin();return n.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return this.project(t,e)._subtract(n)},_latLngBoundsToNewLayerBounds:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return r.bounds([this.project(t.getSouthWest(),e)._subtract(n),this.project(t.getNorthWest(),e)._subtract(n),this.project(t.getSouthEast(),e)._subtract(n),this.project(t.getNorthEast(),e)._subtract(n)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),a=this.getSize().divideBy(2),o=new r.Bounds(n.subtract(a),n.add(a)),s=this._getBoundsOffset(o,i,e);return s.round().equals([0,0])?t:this.unproject(n.add(s),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),n=new r.Bounds(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(n,e))},_getBoundsOffset:function(t,e,i){var n=r.bounds(this.project(e.getNorthEast(),i),this.project(e.getSouthWest(),i)),a=n.min.subtract(t.min),o=n.max.subtract(t.max),s=this._rebound(a.x,-o.x),l=this._rebound(a.y,-o.y);return new r.Point(s,l)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom(),n=r.Browser.any3d?this.options.zoomSnap:1;return n&&(t=Math.round(t/n)*n),Math.max(e,Math.min(i,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){r.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._floor();return!((e&&e.animate)!==!0&&!this.getSize().contains(i))&&(this.panBy(i,e),!0)},_createAnimProxy:function(){var t=this._proxy=r.DomUtil.create("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(e){var i=r.DomUtil.TRANSFORM,n=t.style[i];r.DomUtil.setTransform(t,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),n===t.style[i]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",function(){var e=this.getCenter(),i=this.getZoom();r.DomUtil.setTransform(t,this.project(e,i),this.getZoomScale(i,1))},this)},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),a=this._getCenterOffset(t)._divideBy(1-1/n);return!(i.animate!==!0&&!this.getSize().contains(a))&&(r.Util.requestAnimFrame(function(){this._moveStart(!0)._animateZoom(t,e,!0)},this),!0)},_animateZoom:function(t,e,i,n){i&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,r.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:n}),setTimeout(r.bind(this._onZoomTransitionEnd,this),250)},_onZoomTransitionEnd:function(){this._animatingZoom&&(r.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),r.Util.requestAnimFrame(function(){this._moveEnd(!0)},this))}}),r.map=function(t,e){return new r.Map(t,e)},r.Layer=r.Evented.extend({options:{pane:"overlayPane",nonBubblingEvents:[],attribution:null},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[r.stamp(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[r.stamp(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var i=this.getEvents();e.on(i,this),this.once("remove",function(){e.off(i,this)},this)}this.onAdd(e),this.getAttribution&&this._map.attributionControl&&this._map.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),e.fire("layeradd",{layer:this})}}}),r.Map.include({addLayer:function(t){var e=r.stamp(t);return this._layers[e]?this:(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var e=r.stamp(t);return this._layers[e]?(this._loaded&&t.onRemove(this),t.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(t.getAttribution()),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return!!t&&r.stamp(t)in this._layers},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},_addLayers:function(t){t=t?r.Util.isArray(t)?t:[t]:[];for(var e=0,i=t.length;e<i;e++)this.addLayer(t[e])},_addZoomLimit:function(t){!isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[r.stamp(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=r.stamp(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-(1/0),n=this._getZoomSpan();for(var r in this._zoomBoundLayers){var a=this._zoomBoundLayers[r].options;t=a.minZoom===i?t:Math.min(t,a.minZoom),e=a.maxZoom===i?e:Math.max(e,a.maxZoom)}this._layersMaxZoom=e===-(1/0)?i:e,this._layersMinZoom=t===1/0?i:t,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===i&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===i&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var o="_leaflet_events";r.DomEvent={on:function(t,e,i,n){if("object"==typeof e)for(var a in e)this._on(t,a,e[a],i);else{e=r.Util.splitWords(e);for(var o=0,s=e.length;o<s;o++)this._on(t,e[o],i,n)}return this},off:function(t,e,i,n){if("object"==typeof e)for(var a in e)this._off(t,a,e[a],i);else{e=r.Util.splitWords(e);for(var o=0,s=e.length;o<s;o++)this._off(t,e[o],i,n)}return this},_on:function(e,i,n,a){var s=i+r.stamp(n)+(a?"_"+r.stamp(a):"");if(e[o]&&e[o][s])return this;var l=function(i){return n.call(a||e,i||t.event)},d=l;return r.Browser.pointer&&0===i.indexOf("touch")?this.addPointerListener(e,i,l,s):r.Browser.touch&&"dblclick"===i&&this.addDoubleTapListener?this.addDoubleTapListener(e,l,s):"addEventListener"in e?"mousewheel"===i?e.addEventListener("onwheel"in e?"wheel":"mousewheel",l,!1):"mouseenter"===i||"mouseleave"===i?(l=function(i){i=i||t.event,r.DomEvent._isExternalTarget(e,i)&&d(i)},e.addEventListener("mouseenter"===i?"mouseover":"mouseout",l,!1)):("click"===i&&r.Browser.android&&(l=function(t){return r.DomEvent._filterClick(t,d)}),e.addEventListener(i,l,!1)):"attachEvent"in e&&e.attachEvent("on"+i,l),e[o]=e[o]||{},e[o][s]=l,this},_off:function(t,e,i,n){var a=e+r.stamp(i)+(n?"_"+r.stamp(n):""),s=t[o]&&t[o][a];return s?(r.Browser.pointer&&0===e.indexOf("touch")?this.removePointerListener(t,e,a):r.Browser.touch&&"dblclick"===e&&this.removeDoubleTapListener?this.removeDoubleTapListener(t,a):"removeEventListener"in t?"mousewheel"===e?t.removeEventListener("onwheel"in t?"wheel":"mousewheel",s,!1):t.removeEventListener("mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,s,!1):"detachEvent"in t&&t.detachEvent("on"+e,s),t[o][a]=null,this):this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,r.DomEvent._skipped(t),this},disableScrollPropagation:function(t){return r.DomEvent.on(t,"mousewheel",r.DomEvent.stopPropagation)},disableClickPropagation:function(t){var e=r.DomEvent.stopPropagation;return r.DomEvent.on(t,r.Draggable.START.join(" "),e),r.DomEvent.on(t,{click:r.DomEvent._fakeStop,dblclick:e})},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return r.DomEvent.preventDefault(t).stopPropagation(t)},getMousePosition:function(t,e){if(!e)return new r.Point(t.clientX,t.clientY);var i=e.getBoundingClientRect();return new r.Point(t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop)},_wheelPxFactor:r.Browser.win&&r.Browser.chrome?2:r.Browser.gecko?t.devicePixelRatio:1,getWheelDelta:function(t){return r.Browser.edge?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/r.DomEvent._wheelPxFactor:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0;
},_skipEvents:{},_fakeStop:function(t){r.DomEvent._skipEvents[t.type]=!0},_skipped:function(t){var e=this._skipEvents[t.type];return this._skipEvents[t.type]=!1,e},_isExternalTarget:function(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(t){return!1}return i!==t},_filterClick:function(t,e){var i=t.timeStamp||t.originalEvent&&t.originalEvent.timeStamp,n=r.DomEvent._lastClick&&i-r.DomEvent._lastClick;return n&&n>100&&n<500||t.target._simulatedClick&&!t._simulated?void r.DomEvent.stop(t):(r.DomEvent._lastClick=i,void e(t))}},r.DomEvent.addListener=r.DomEvent.on,r.DomEvent.removeListener=r.DomEvent.off,r.PosAnimation=r.Evented.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=r.DomUtil.getPosition(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=r.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,i=1e3*this._duration;e<i?this._runFrame(this._easeOut(e/i),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var i=this._startPos.add(this._offset.multiplyBy(t));e&&i._round(),r.DomUtil.setPosition(this._el,i),this.fire("step")},_complete:function(){r.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),r.Projection.Mercator={R:6378137,R_MINOR:6356752.314245179,bounds:r.bounds([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,i=this.R,n=t.lat*e,a=this.R_MINOR/i,o=Math.sqrt(1-a*a),s=o*Math.sin(n),l=Math.tan(Math.PI/4-n/2)/Math.pow((1-s)/(1+s),o/2);return n=-i*Math.log(Math.max(l,1e-10)),new r.Point(t.lng*e*i,n)},unproject:function(t){for(var e,i=180/Math.PI,n=this.R,a=this.R_MINOR/n,o=Math.sqrt(1-a*a),s=Math.exp(-t.y/n),l=Math.PI/2-2*Math.atan(s),d=0,h=.1;d<15&&Math.abs(h)>1e-7;d++)e=o*Math.sin(l),e=Math.pow((1-e)/(1+e),o/2),h=Math.PI/2-2*Math.atan(s*e)-l,l+=h;return new r.LatLng(l*i,t.x*i/n)}},r.CRS.EPSG3395=r.extend({},r.CRS.Earth,{code:"EPSG:3395",projection:r.Projection.Mercator,transformation:function(){var t=.5/(Math.PI*r.Projection.Mercator.R);return new r.Transformation(t,.5,-t,.5)}()}),r.GridLayer=r.Layer.extend({options:{tileSize:256,opacity:1,updateWhenIdle:r.Browser.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:i,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){r.setOptions(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),r.DomUtil.remove(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=null},bringToFront:function(){return this._map&&(r.DomUtil.toFront(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(r.DomUtil.toBack(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllTiles(),this._update()),this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=r.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return e.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof r.Point?t:new r.Point(t,t)},_updateZIndex:function(){this._container&&this.options.zIndex!==i&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,i=this.getPane().children,n=-t(-(1/0),1/0),r=0,a=i.length;r<a;r++)e=i[r].style.zIndex,i[r]!==this._container&&e&&(n=t(n,+e));isFinite(n)&&(this.options.zIndex=n+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!r.Browser.ielt9){r.DomUtil.setOpacity(this._container,this.options.opacity);var t=+new Date,e=!1,i=!1;for(var n in this._tiles){var a=this._tiles[n];if(a.current&&a.loaded){var o=Math.min(1,(t-a.loaded)/200);r.DomUtil.setOpacity(a.el,o),o<1?e=!0:(a.active&&(i=!0),a.active=!0)}}i&&!this._noPrune&&this._pruneTiles(),e&&(r.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=r.Util.requestAnimFrame(this._updateOpacity,this))}},_initContainer:function(){this._container||(this._container=r.DomUtil.create("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(t===i)return i;for(var n in this._levels)this._levels[n].el.children.length||n===t?this._levels[n].el.style.zIndex=e-Math.abs(t-n):(r.DomUtil.remove(this._levels[n].el),this._removeTilesAtZoom(n),delete this._levels[n]);var a=this._levels[t],o=this._map;return a||(a=this._levels[t]={},a.el=r.DomUtil.create("div","leaflet-tile-container leaflet-zoom-animated",this._container),a.el.style.zIndex=e,a.origin=o.project(o.unproject(o.getPixelOrigin()),t).round(),a.zoom=t,this._setZoomTransform(a,o.getCenter(),o.getZoom()),r.Util.falseFn(a.el.offsetWidth)),this._level=a,a},_pruneTiles:function(){if(this._map){var t,e,i=this._map.getZoom();if(i>this.options.maxZoom||i<this.options.minZoom)return void this._removeAllTiles();for(t in this._tiles)e=this._tiles[t],e.retain=e.current;for(t in this._tiles)if(e=this._tiles[t],e.current&&!e.active){var n=e.coords;this._retainParent(n.x,n.y,n.z,n.z-5)||this._retainChildren(n.x,n.y,n.z,n.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)r.DomUtil.remove(this._levels[t].el),delete this._levels[t];this._removeAllTiles(),this._tileZoom=null},_retainParent:function(t,e,i,n){var a=Math.floor(t/2),o=Math.floor(e/2),s=i-1,l=new r.Point(+a,+o);l.z=+s;var d=this._tileCoordsToKey(l),h=this._tiles[d];return h&&h.active?(h.retain=!0,!0):(h&&h.loaded&&(h.retain=!0),s>n&&this._retainParent(a,o,s,n))},_retainChildren:function(t,e,i,n){for(var a=2*t;a<2*t+2;a++)for(var o=2*e;o<2*e+2;o++){var s=new r.Point(a,o);s.z=i+1;var l=this._tileCoordsToKey(s),d=this._tiles[l];d&&d.active?d.retain=!0:(d&&d.loaded&&(d.retain=!0),i+1<n&&this._retainChildren(a,o,i+1,n))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_setView:function(t,e,n,r){var a=Math.round(e);(this.options.maxZoom!==i&&a>this.options.maxZoom||this.options.minZoom!==i&&a<this.options.minZoom)&&(a=i);var o=this.options.updateWhenZooming&&a!==this._tileZoom;r&&!o||(this._tileZoom=a,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),a!==i&&this._update(t),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var i in this._levels)this._setZoomTransform(this._levels[i],t,e)},_setZoomTransform:function(t,e,i){var n=this._map.getZoomScale(i,t.zoom),a=t.origin.multiplyBy(n).subtract(this._map._getNewPixelOrigin(e,i)).round();r.Browser.any3d?r.DomUtil.setTransform(t.el,a,n):r.DomUtil.setPosition(t.el,a)},_resetGrid:function(){var t=this._map,e=t.options.crs,i=this._tileSize=this.getTileSize(),n=this._tileZoom,r=this._map.getPixelWorldBounds(this._tileZoom);r&&(this._globalTileRange=this._pxBoundsToTileRange(r)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],n).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],n).x/i.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],n).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],n).y/i.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),n=e.getZoomScale(i,this._tileZoom),a=e.project(t,this._tileZoom).floor(),o=e.getSize().divideBy(2*n);return new r.Bounds(a.subtract(o),a.add(o))},_update:function(t){var n=this._map;if(n){var a=n.getZoom();if(t===i&&(t=n.getCenter()),this._tileZoom!==i){var o=this._getTiledPixelBounds(t),s=this._pxBoundsToTileRange(o),l=s.getCenter(),d=[],h=this.options.keepBuffer,c=new r.Bounds(s.getBottomLeft().subtract([h,-h]),s.getTopRight().add([h,-h]));for(var u in this._tiles){var p=this._tiles[u].coords;p.z===this._tileZoom&&c.contains(r.point(p.x,p.y))||(this._tiles[u].current=!1)}if(Math.abs(a-this._tileZoom)>1)return void this._setView(t,a);for(var f=s.min.y;f<=s.max.y;f++)for(var m=s.min.x;m<=s.max.x;m++){var g=new r.Point(m,f);if(g.z=this._tileZoom,this._isValidTile(g)){var _=this._tiles[this._tileCoordsToKey(g)];_?_.current=!0:d.push(g)}}if(d.sort(function(t,e){return t.distanceTo(l)-e.distanceTo(l)}),0!==d.length){this._loading||(this._loading=!0,this.fire("loading"));var y=e.createDocumentFragment();for(m=0;m<d.length;m++)this._addTile(d[m],y);this._level.el.appendChild(y)}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var i=this._globalTileRange;if(!e.wrapLng&&(t.x<i.min.x||t.x>i.max.x)||!e.wrapLat&&(t.y<i.min.y||t.y>i.max.y))return!1}if(!this.options.bounds)return!0;var n=this._tileCoordsToBounds(t);return r.latLngBounds(this.options.bounds).overlaps(n)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToBounds:function(t){var e=this._map,i=this.getTileSize(),n=t.scaleBy(i),a=n.add(i),o=e.unproject(n,t.z),s=e.unproject(a,t.z);return this.options.noWrap||(o=e.wrapLatLng(o),s=e.wrapLatLng(s)),new r.LatLngBounds(o,s)},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),i=new r.Point(+e[0],+e[1]);return i.z=+e[2],i},_removeTile:function(t){var e=this._tiles[t];e&&(r.DomUtil.remove(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){r.DomUtil.addClass(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=r.Util.falseFn,t.onmousemove=r.Util.falseFn,r.Browser.ielt9&&this.options.opacity<1&&r.DomUtil.setOpacity(t,this.options.opacity),r.Browser.android&&!r.Browser.android23&&(t.style.WebkitBackfaceVisibility="hidden")},_addTile:function(t,e){var i=this._getTilePos(t),n=this._tileCoordsToKey(t),a=this.createTile(this._wrapCoords(t),r.bind(this._tileReady,this,t));this._initTile(a),this.createTile.length<2&&r.Util.requestAnimFrame(r.bind(this._tileReady,this,t,null,a)),r.DomUtil.setPosition(a,i),this._tiles[n]={el:a,coords:t,current:!0},e.appendChild(a),this.fire("tileloadstart",{tile:a,coords:t})},_tileReady:function(t,e,i){if(this._map){e&&this.fire("tileerror",{error:e,tile:i,coords:t});var n=this._tileCoordsToKey(t);i=this._tiles[n],i&&(i.loaded=+new Date,this._map._fadeAnimated?(r.DomUtil.setOpacity(i.el,0),r.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=r.Util.requestAnimFrame(this._updateOpacity,this)):(i.active=!0,this._pruneTiles()),e||(r.DomUtil.addClass(i.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:i.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),r.Browser.ielt9||!this._map._fadeAnimated?r.Util.requestAnimFrame(this._pruneTiles,this):setTimeout(r.bind(this._pruneTiles,this),250)))}},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new r.Point(this._wrapX?r.Util.wrapNum(t.x,this._wrapX):t.x,this._wrapY?r.Util.wrapNum(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new r.Bounds(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}}),r.gridLayer=function(t){return new r.GridLayer(t)},r.TileLayer=r.GridLayer.extend({options:{minZoom:0,maxZoom:18,maxNativeZoom:null,minNativeZoom:null,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(t,e){this._url=t,e=r.setOptions(this,e),e.detectRetina&&r.Browser.retina&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom++):(e.zoomOffset++,e.maxZoom--),e.minZoom=Math.max(0,e.minZoom)),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),r.Browser.android||this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},createTile:function(t,i){var n=e.createElement("img");return r.DomEvent.on(n,"load",r.bind(this._tileOnLoad,this,i,n)),r.DomEvent.on(n,"error",r.bind(this._tileOnError,this,i,n)),this.options.crossOrigin&&(n.crossOrigin=""),n.alt="",n.setAttribute("role","presentation"),n.src=this.getTileUrl(t),n},getTileUrl:function(t){var e={r:r.Browser.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=i),e["-y"]=i}return r.Util.template(this._url,r.extend(e,this.options))},_tileOnLoad:function(t,e){r.Browser.ielt9?setTimeout(r.bind(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,i){var n=this.options.errorTileUrl;n&&(e.src=n),t(i,e)},getTileSize:function(){var t=this._map,e=r.GridLayer.prototype.getTileSize.call(this),i=this._tileZoom+this.options.zoomOffset,n=this.options.minNativeZoom,a=this.options.maxNativeZoom;return null!==n&&i<n?e.divideBy(t.getZoomScale(n,i)).round():null!==a&&i>a?e.divideBy(t.getZoomScale(a,i)).round():e},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom,i=this.options.zoomReverse,n=this.options.zoomOffset,r=this.options.minNativeZoom,a=this.options.maxNativeZoom;return i&&(t=e-t),t+=n,null!==r&&t<r?r:null!==a&&t>a?a:t},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)this._tiles[t].coords.z!==this._tileZoom&&(e=this._tiles[t].el,e.onload=r.Util.falseFn,e.onerror=r.Util.falseFn,e.complete||(e.src=r.Util.emptyImageUrl,r.DomUtil.remove(e)))}}),r.tileLayer=function(t,e){return new r.TileLayer(t,e)},r.TileLayer.WMS=r.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var i=r.extend({},this.defaultWmsParams);for(var n in e)n in this.options||(i[n]=e[n]);e=r.setOptions(this,e),i.width=i.height=e.tileSize*(e.detectRetina&&r.Browser.retina?2:1),this.wmsParams=i},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,r.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToBounds(t),i=this._crs.project(e.getNorthWest()),n=this._crs.project(e.getSouthEast()),a=(this._wmsVersion>=1.3&&this._crs===r.CRS.EPSG4326?[n.y,i.x,i.y,n.x]:[i.x,n.y,n.x,i.y]).join(","),o=r.TileLayer.prototype.getTileUrl.call(this,t);return o+r.Util.getParamString(this.wmsParams,o,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+a},setParams:function(t,e){return r.extend(this.wmsParams,t),e||this.redraw(),this}}),r.tileLayer.wms=function(t,e){return new r.TileLayer.WMS(t,e)},r.ImageOverlay=r.Layer.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1},initialize:function(t,e,i){this._url=t,this._bounds=r.latLngBounds(e),r.setOptions(this,i)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(r.DomUtil.addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){r.DomUtil.remove(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&r.DomUtil.toFront(this._image),this},bringToBack:function(){return this._map&&r.DomUtil.toBack(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=t,this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t=this._image=r.DomUtil.create("img","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":""));t.onselectstart=r.Util.falseFn,t.onmousemove=r.Util.falseFn,t.onload=r.bind(this.fire,this,"load"),this.options.crossOrigin&&(t.crossOrigin=""),t.src=this._url,t.alt=this.options.alt},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;r.DomUtil.setTransform(this._image,i,e)},_reset:function(){var t=this._image,e=new r.Bounds(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=e.getSize();r.DomUtil.setPosition(t,e.min),t.style.width=i.x+"px",t.style.height=i.y+"px"},_updateOpacity:function(){r.DomUtil.setOpacity(this._image,this.options.opacity)}}),r.imageOverlay=function(t,e,i){return new r.ImageOverlay(t,e,i)},r.Icon=r.Class.extend({initialize:function(t){r.setOptions(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n=this._createImg(i,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(n,t),n},_setIconStyles:function(t,e){var i=this.options,n=i[e+"Size"];"number"==typeof n&&(n=[n,n]);var a=r.point(n),o=r.point("shadow"===e&&i.shadowAnchor||i.iconAnchor||a&&a.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(i.className||""),o&&(t.style.marginLeft=-o.x+"px",t.style.marginTop=-o.y+"px"),a&&(t.style.width=a.x+"px",t.style.height=a.y+"px")},_createImg:function(t,i){return i=i||e.createElement("img"),i.src=t,i},_getIconUrl:function(t){return r.Browser.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),r.icon=function(t){return new r.Icon(t)},r.Icon.Default=r.Icon.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return r.Icon.Default.imagePath||(r.Icon.Default.imagePath=this._detectIconPath()),(this.options.imagePath||r.Icon.Default.imagePath)+r.Icon.prototype._getIconUrl.call(this,t)},_detectIconPath:function(){var t=r.DomUtil.create("div","leaflet-default-icon-path",e.body),i=r.DomUtil.getStyle(t,"background-image")||r.DomUtil.getStyle(t,"backgroundImage");return e.body.removeChild(t),0===i.indexOf("url")?i.replace(/^url\([\"\']?/,"").replace(/marker-icon\.png[\"\']?\)$/,""):""}}),r.Marker=r.Layer.extend({options:{icon:new r.Icon.Default,interactive:!0,draggable:!1,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",nonBubblingEvents:["click","dblclick","mouseover","mouseout","contextmenu"]},initialize:function(t,e){r.setOptions(this,e),this._latlng=r.latLng(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=r.latLng(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=t.icon.createIcon(this._icon),n=!1;i!==this._icon&&(this._icon&&this._removeIcon(),n=!0,t.title&&(i.title=t.title),t.alt&&(i.alt=t.alt)),r.DomUtil.addClass(i,e),t.keyboard&&(i.tabIndex="0"),this._icon=i,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var a=t.icon.createShadow(this._shadow),o=!1;a!==this._shadow&&(this._removeShadow(),o=!0),a&&r.DomUtil.addClass(a,e),this._shadow=a,t.opacity<1&&this._updateOpacity(),n&&this.getPane().appendChild(this._icon),this._initInteraction(),a&&o&&this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),r.DomUtil.remove(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&r.DomUtil.remove(this._shadow),this._shadow=null},_setPos:function(t){r.DomUtil.setPosition(this._icon,t),this._shadow&&r.DomUtil.setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(r.DomUtil.addClass(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),r.Handler.MarkerDrag)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new r.Handler.MarkerDrag(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;r.DomUtil.setOpacity(this._icon,t),this._shadow&&r.DomUtil.setOpacity(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor||[0,0]},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor||[0,0]}}),r.marker=function(t,e){return new r.Marker(t,e)},r.DivIcon=r.Icon.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var i=t&&"DIV"===t.tagName?t:e.createElement("div"),n=this.options;if(i.innerHTML=n.html!==!1?n.html:"",n.bgPos){var a=r.point(n.bgPos);i.style.backgroundPosition=-a.x+"px "+-a.y+"px"}return this._setIconStyles(i,"icon"),i},createShadow:function(){return null}}),r.divIcon=function(t){return new r.DivIcon(t)},r.DivOverlay=r.Layer.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(t,e){r.setOptions(this,t),this._source=e},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&r.DomUtil.setOpacity(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&r.DomUtil.setOpacity(this._container,1),this.bringToFront()},onRemove:function(t){t._fadeAnimated?(r.DomUtil.setOpacity(this._container,0),this._removeTimeout=setTimeout(r.bind(r.DomUtil.remove,r.DomUtil,this._container),200)):r.DomUtil.remove(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=r.latLng(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&r.DomUtil.toFront(this._container),this},bringToBack:function(){return this._map&&r.DomUtil.toBack(this._container),this},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=r.point(this.options.offset),i=this._getAnchor();this._zoomAnimated?r.DomUtil.setPosition(this._container,t.add(i)):e=e.add(t).add(i);var n=this._containerBottom=-e.y,a=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=n+"px",this._container.style.left=a+"px"}},_getAnchor:function(){return[0,0]}}),r.Popup=r.DivOverlay.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,className:""},openOn:function(t){return t.openPopup(this),this},onAdd:function(t){r.DivOverlay.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof r.Path||this._source.on("preclick",r.DomEvent.stopPropagation))},onRemove:function(t){r.DivOverlay.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof r.Path||this._source.off("preclick",r.DomEvent.stopPropagation))},getEvents:function(){var t=r.DivOverlay.prototype.getEvents.call(this);return("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t="leaflet-popup",e=this._container=r.DomUtil.create("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated");if(this.options.closeButton){var i=this._closeButton=r.DomUtil.create("a",t+"-close-button",e);i.href="#close",i.innerHTML="&#215;",r.DomEvent.on(i,"click",this._onCloseButtonClick,this)}var n=this._wrapper=r.DomUtil.create("div",t+"-content-wrapper",e);this._contentNode=r.DomUtil.create("div",t+"-content",n),r.DomEvent.disableClickPropagation(n).disableScrollPropagation(this._contentNode).on(n,"contextmenu",r.DomEvent.stopPropagation),this._tipContainer=r.DomUtil.create("div",t+"-tip-container",e),this._tip=r.DomUtil.create("div",t+"-tip",this._tipContainer)},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,a=this.options.maxHeight,o="leaflet-popup-scrolled";a&&n>a?(e.height=a+"px",r.DomUtil.addClass(t,o)):r.DomUtil.removeClass(t,o),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),i=this._getAnchor();r.DomUtil.setPosition(this._container,e.add(i))},_adjustPan:function(){if(!(!this.options.autoPan||this._map._panAnim&&this._map._panAnim._inProgress)){var t=this._map,e=parseInt(r.DomUtil.getStyle(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+e,n=this._containerWidth,a=new r.Point(this._containerLeft,-i-this._containerBottom);a._add(r.DomUtil.getPosition(this._container));var o=t.layerPointToContainerPoint(a),s=r.point(this.options.autoPanPadding),l=r.point(this.options.autoPanPaddingTopLeft||s),d=r.point(this.options.autoPanPaddingBottomRight||s),h=t.getSize(),c=0,u=0;o.x+n+d.x>h.x&&(c=o.x+n-h.x+d.x),o.x-c-l.x<0&&(c=o.x-l.x),o.y+i+d.y>h.y&&(u=o.y+i-h.y+d.y),o.y-u-l.y<0&&(u=o.y-l.y),(c||u)&&t.fire("autopanstart").panBy([c,u])}},_onCloseButtonClick:function(t){this._close(),r.DomEvent.stop(t)},_getAnchor:function(){return r.point(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),r.popup=function(t,e){return new r.Popup(t,e)},r.Map.mergeOptions({closePopupOnClick:!0}),r.Map.include({openPopup:function(t,e,i){return t instanceof r.Popup||(t=new r.Popup(i).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:(this._popup&&this._popup.options.autoClose&&this.closePopup(),this._popup=t,this.addLayer(t))},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&this.removeLayer(t),this}}),r.Layer.include({bindPopup:function(t,e){return t instanceof r.Popup?(r.setOptions(t,e),this._popup=t,t._source=this):(this._popup&&!e||(this._popup=new r.Popup(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t,e){if(t instanceof r.Layer||(e=t,t=this),t instanceof r.FeatureGroup)for(var i in this._layers){t=this._layers[i];break}return e||(e=t.getCenter?t.getCenter():t.getLatLng()),this._popup&&this._map&&(this._popup._source=t,this._popup.update(),this._map.openPopup(this._popup,e)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(t){return this._popup&&(this._popup._map?this.closePopup():this.openPopup(t)),this},isPopupOpen:function(){return this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){var e=t.layer||t.target;if(this._popup&&this._map)return r.DomEvent.stop(t),e instanceof r.Path?void this.openPopup(t.layer||t.target,t.latlng):void(this._map.hasLayer(this._popup)&&this._popup._source===e?this.closePopup():this.openPopup(e,t.latlng))},_movePopup:function(t){this._popup.setLatLng(t.latlng)}}),r.Tooltip=r.DivOverlay.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(t){r.DivOverlay.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(t){r.DivOverlay.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var t=r.DivOverlay.prototype.getEvents.call(this);return r.Browser.touch&&!this.options.permanent&&(t.preclick=this._close),t},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var t="leaflet-tooltip",e=t+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=r.DomUtil.create("div",e)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e=this._map,i=this._container,n=e.latLngToContainerPoint(e.getCenter()),a=e.layerPointToContainerPoint(t),o=this.options.direction,s=i.offsetWidth,l=i.offsetHeight,d=r.point(this.options.offset),h=this._getAnchor();
"top"===o?t=t.add(r.point(-s/2+d.x,-l+d.y+h.y,!0)):"bottom"===o?t=t.subtract(r.point(s/2-d.x,-d.y,!0)):"center"===o?t=t.subtract(r.point(s/2+d.x,l/2-h.y+d.y,!0)):"right"===o||"auto"===o&&a.x<n.x?(o="right",t=t.add(r.point(d.x+h.x,h.y-l/2+d.y,!0))):(o="left",t=t.subtract(r.point(s+h.x-d.x,l/2-h.y-d.y,!0))),r.DomUtil.removeClass(i,"leaflet-tooltip-right"),r.DomUtil.removeClass(i,"leaflet-tooltip-left"),r.DomUtil.removeClass(i,"leaflet-tooltip-top"),r.DomUtil.removeClass(i,"leaflet-tooltip-bottom"),r.DomUtil.addClass(i,"leaflet-tooltip-"+o),r.DomUtil.setPosition(i,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&r.DomUtil.setOpacity(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return r.point(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),r.tooltip=function(t,e){return new r.Tooltip(t,e)},r.Map.include({openTooltip:function(t,e,i){return t instanceof r.Tooltip||(t=new r.Tooltip(i).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:this.addLayer(t)},closeTooltip:function(t){return t&&this.removeLayer(t),this}}),r.Layer.include({bindTooltip:function(t,e){return t instanceof r.Tooltip?(r.setOptions(t,e),this._tooltip=t,t._source=this):(this._tooltip&&!e||(this._tooltip=r.tooltip(e,this)),this._tooltip.setContent(t)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(i.mousemove=this._moveTooltip),r.Browser.touch&&(i.click=this._openTooltip)),this[e](i),this._tooltipHandlersAdded=!t}},openTooltip:function(t,e){if(t instanceof r.Layer||(e=t,t=this),t instanceof r.FeatureGroup)for(var i in this._layers){t=this._layers[i];break}return e||(e=t.getCenter?t.getCenter():t.getLatLng()),this._tooltip&&this._map&&(this._tooltip._source=t,this._tooltip.update(),this._map.openTooltip(this._tooltip,e),this._tooltip.options.interactive&&this._tooltip._container&&(r.DomUtil.addClass(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&(r.DomUtil.removeClass(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(t){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(t)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_openTooltip:function(t){var e=t.layer||t.target;this._tooltip&&this._map&&this.openTooltip(e,this._tooltip.options.sticky?t.latlng:i)},_moveTooltip:function(t){var e,i,n=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),i=this._map.containerPointToLayerPoint(e),n=this._map.layerPointToLatLng(i)),this._tooltip.setLatLng(n)}}),r.LayerGroup=r.Layer.extend({initialize:function(t){this._layers={};var e,i;if(t)for(e=0,i=t.length;e<i;e++)this.addLayer(t[e])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return!!t&&(t in this._layers||this.getLayerId(t)in this._layers)},clearLayers:function(){for(var t in this._layers)this.removeLayer(this._layers[t]);return this},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)i=this._layers[e],i[t]&&i[t].apply(i,n);return this},onAdd:function(t){for(var e in this._layers)t.addLayer(this._layers[e])},onRemove:function(t){for(var e in this._layers)t.removeLayer(this._layers[e])},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];for(var e in this._layers)t.push(this._layers[e]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return r.stamp(t)}}),r.layerGroup=function(t){return new r.LayerGroup(t)},r.FeatureGroup=r.LayerGroup.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),r.LayerGroup.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),r.LayerGroup.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new r.LatLngBounds;for(var e in this._layers){var i=this._layers[e];t.extend(i.getBounds?i.getBounds():i.getLatLng())}return t}}),r.featureGroup=function(t){return new r.FeatureGroup(t)},r.Renderer=r.Layer.extend({options:{padding:.1},initialize:function(t){r.setOptions(this,t),r.stamp(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&r.DomUtil.addClass(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){r.DomUtil.remove(this._container),this.off("update",this._updatePaths,this)},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var i=this._map.getZoomScale(e,this._zoom),n=r.DomUtil.getPosition(this._container),a=this._map.getSize().multiplyBy(.5+this.options.padding),o=this._map.project(this._center,e),s=this._map.project(t,e),l=s.subtract(o),d=a.multiplyBy(-i).add(n).add(a).subtract(l);r.Browser.any3d?r.DomUtil.setTransform(this._container,d,i):r.DomUtil.setPosition(this._container,d)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var t in this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),i=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new r.Bounds(i,i.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),r.Map.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this.options.preferCanvas&&r.canvas()||r.svg()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||t===i)return!1;var e=this._paneRenderers[t];return e===i&&(e=r.SVG&&r.svg({pane:t})||r.Canvas&&r.canvas({pane:t}),this._paneRenderers[t]=e),e}}),r.Path=r.Layer.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return r.setOptions(this,t),this._renderer&&this._renderer._updateStyle(this),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(r.Browser.touch?10:0)}}),r.LineUtil={simplify:function(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=this._reducePoints(t,i),t=this._simplifyDP(t,i)},pointToSegmentDistance:function(t,e,i){return Math.sqrt(this._sqClosestPointOnSegment(t,e,i,!0))},closestPointOnSegment:function(t,e,i){return this._sqClosestPointOnSegment(t,e,i)},_simplifyDP:function(t,e){var n=t.length,r=typeof Uint8Array!=i+""?Uint8Array:Array,a=new r(n);a[0]=a[n-1]=1,this._simplifyDPStep(t,a,e,0,n-1);var o,s=[];for(o=0;o<n;o++)a[o]&&s.push(t[o]);return s},_simplifyDPStep:function(t,e,i,n,r){var a,o,s,l=0;for(o=n+1;o<=r-1;o++)s=this._sqClosestPointOnSegment(t[o],t[n],t[r],!0),s>l&&(a=o,l=s);l>i&&(e[a]=1,this._simplifyDPStep(t,e,i,n,a),this._simplifyDPStep(t,e,i,a,r))},_reducePoints:function(t,e){for(var i=[t[0]],n=1,r=0,a=t.length;n<a;n++)this._sqDist(t[n],t[r])>e&&(i.push(t[n]),r=n);return r<a-1&&i.push(t[a-1]),i},clipSegment:function(t,e,i,n,r){var a,o,s,l=n?this._lastCode:this._getBitCode(t,i),d=this._getBitCode(e,i);for(this._lastCode=d;;){if(!(l|d))return[t,e];if(l&d)return!1;a=l||d,o=this._getEdgeIntersection(t,e,a,i,r),s=this._getBitCode(o,i),a===l?(t=o,l=s):(e=o,d=s)}},_getEdgeIntersection:function(t,e,i,n,a){var o,s,l=e.x-t.x,d=e.y-t.y,h=n.min,c=n.max;return 8&i?(o=t.x+l*(c.y-t.y)/d,s=c.y):4&i?(o=t.x+l*(h.y-t.y)/d,s=h.y):2&i?(o=c.x,s=t.y+d*(c.x-t.x)/l):1&i&&(o=h.x,s=t.y+d*(h.x-t.x)/l),new r.Point(o,s,a)},_getBitCode:function(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i},_sqDist:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},_sqClosestPointOnSegment:function(t,e,i,n){var a,o=e.x,s=e.y,l=i.x-o,d=i.y-s,h=l*l+d*d;return h>0&&(a=((t.x-o)*l+(t.y-s)*d)/h,a>1?(o=i.x,s=i.y):a>0&&(o+=l*a,s+=d*a)),l=t.x-o,d=t.y-s,n?l*l+d*d:new r.Point(o,s)}},r.Polyline=r.Path.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){r.setOptions(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,i,n=1/0,a=null,o=r.LineUtil._sqClosestPointOnSegment,s=0,l=this._parts.length;s<l;s++)for(var d=this._parts[s],h=1,c=d.length;h<c;h++){e=d[h-1],i=d[h];var u=o(t,e,i,!0);u<n&&(n=u,a=o(t,e,i))}return a&&(a.distance=Math.sqrt(n)),a},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,r,a,o,s=this._rings[0],l=s.length;if(!l)return null;for(t=0,e=0;t<l-1;t++)e+=s[t].distanceTo(s[t+1])/2;if(0===e)return this._map.layerPointToLatLng(s[0]);for(t=0,n=0;t<l-1;t++)if(r=s[t],a=s[t+1],i=r.distanceTo(a),n+=i,n>e)return o=(n-e)/i,this._map.layerPointToLatLng([a.x-o*(a.x-r.x),a.y-o*(a.y-r.y)])},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=r.latLng(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new r.LatLngBounds,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return r.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],i=r.Polyline._flat(t),n=0,a=t.length;n<a;n++)i?(e[n]=r.latLng(t[n]),this._bounds.extend(e[n])):e[n]=this._convertLatLngs(t[n]);return e},_project:function(){var t=new r.Bounds;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t);var e=this._clickTolerance(),i=new r.Point(e,e);this._bounds.isValid()&&t.isValid()&&(t.min._subtract(i),t.max._add(i),this._pxBounds=t)},_projectLatlngs:function(t,e,i){var n,a,o=t[0]instanceof r.LatLng,s=t.length;if(o){for(a=[],n=0;n<s;n++)a[n]=this._map.latLngToLayerPoint(t[n]),i.extend(a[n]);e.push(a)}else for(n=0;n<s;n++)this._projectLatlngs(t[n],e,i)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t)){if(this.options.noClip)return void(this._parts=this._rings);var e,i,n,a,o,s,l,d=this._parts;for(e=0,n=0,a=this._rings.length;e<a;e++)for(l=this._rings[e],i=0,o=l.length;i<o-1;i++)s=r.LineUtil.clipSegment(l[i],l[i+1],t,i,!0),s&&(d[n]=d[n]||[],d[n].push(s[0]),s[1]===l[i+1]&&i!==o-2||(d[n].push(s[1]),n++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,i=0,n=t.length;i<n;i++)t[i]=r.LineUtil.simplify(t[i],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)}}),r.polyline=function(t,e){return new r.Polyline(t,e)},r.Polyline._flat=function(t){return!r.Util.isArray(t[0])||"object"!=typeof t[0][0]&&"undefined"!=typeof t[0][0]},r.PolyUtil={},r.PolyUtil.clipPolygon=function(t,e,i){var n,a,o,s,l,d,h,c,u,p=[1,4,2,8],f=r.LineUtil;for(a=0,h=t.length;a<h;a++)t[a]._code=f._getBitCode(t[a],e);for(s=0;s<4;s++){for(c=p[s],n=[],a=0,h=t.length,o=h-1;a<h;o=a++)l=t[a],d=t[o],l._code&c?d._code&c||(u=f._getEdgeIntersection(d,l,c,e,i),u._code=f._getBitCode(u,e),n.push(u)):(d._code&c&&(u=f._getEdgeIntersection(d,l,c,e,i),u._code=f._getBitCode(u,e),n.push(u)),n.push(l));t=n}return t},r.Polygon=r.Polyline.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,r,a,o,s,l,d=this._rings[0],h=d.length;if(!h)return null;for(a=o=s=0,t=0,e=h-1;t<h;e=t++)i=d[t],n=d[e],r=i.y*n.x-n.y*i.x,o+=(i.x+n.x)*r,s+=(i.y+n.y)*r,a+=3*r;return l=0===a?d[0]:[o/a,s/a],this._map.layerPointToLatLng(l)},_convertLatLngs:function(t){var e=r.Polyline.prototype._convertLatLngs.call(this,t),i=e.length;return i>=2&&e[0]instanceof r.LatLng&&e[0].equals(e[i-1])&&e.pop(),e},_setLatLngs:function(t){r.Polyline.prototype._setLatLngs.call(this,t),r.Polyline._flat(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return r.Polyline._flat(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,i=new r.Point(e,e);if(t=new r.Bounds(t.min.subtract(i),t.max.add(i)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t)){if(this.options.noClip)return void(this._parts=this._rings);for(var n,a=0,o=this._rings.length;a<o;a++)n=r.PolyUtil.clipPolygon(this._rings[a],t,!0),n.length&&this._parts.push(n)}},_updatePath:function(){this._renderer._updatePoly(this,!0)}}),r.polygon=function(t,e){return new r.Polygon(t,e)},r.Rectangle=r.Polygon.extend({initialize:function(t,e){r.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=r.latLngBounds(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}),r.rectangle=function(t,e){return new r.Rectangle(t,e)},r.CircleMarker=r.Path.extend({options:{fill:!0,radius:10},initialize:function(t,e){r.setOptions(this,e),this._latlng=r.latLng(t),this._radius=this.options.radius},setLatLng:function(t){return this._latlng=r.latLng(t),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return r.Path.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,i=this._clickTolerance(),n=[t+i,e+i];this._pxBounds=new r.Bounds(this._point.subtract(n),this._point.add(n))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)}}),r.circleMarker=function(t,e){return new r.CircleMarker(t,e)},r.Circle=r.CircleMarker.extend({initialize:function(t,e,i){if("number"==typeof e&&(e=r.extend({},i,{radius:e})),r.setOptions(this,e),this._latlng=r.latLng(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new r.LatLngBounds(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:r.Path.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,i=this._map,n=i.options.crs;if(n.distance===r.CRS.Earth.distance){var a=Math.PI/180,o=this._mRadius/r.CRS.Earth.R/a,s=i.project([e+o,t]),l=i.project([e-o,t]),d=s.add(l).divideBy(2),h=i.unproject(d).lat,c=Math.acos((Math.cos(o*a)-Math.sin(e*a)*Math.sin(h*a))/(Math.cos(e*a)*Math.cos(h*a)))/a;(isNaN(c)||0===c)&&(c=o/Math.cos(Math.PI/180*e)),this._point=d.subtract(i.getPixelOrigin()),this._radius=isNaN(c)?0:Math.max(Math.round(d.x-i.project([h,t-c]).x),1),this._radiusY=Math.max(Math.round(d.y-s.y),1)}else{var u=n.unproject(n.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(u).x}this._updateBounds()}}),r.circle=function(t,e,i){return new r.Circle(t,e,i)},r.SVG=r.Renderer.extend({getEvents:function(){var t=r.Renderer.prototype.getEvents.call(this);return t.zoomstart=this._onZoomStart,t},_initContainer:function(){this._container=r.SVG.create("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=r.SVG.create("g"),this._container.appendChild(this._rootGroup)},_onZoomStart:function(){this._update()},_update:function(){if(!this._map._animatingZoom||!this._bounds){r.Renderer.prototype._update.call(this);var t=this._bounds,e=t.getSize(),i=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,i.setAttribute("width",e.x),i.setAttribute("height",e.y)),r.DomUtil.setPosition(i,t.min),i.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=r.SVG.create("path");t.options.className&&r.DomUtil.addClass(e,t.options.className),t.options.interactive&&r.DomUtil.addClass(e,"leaflet-interactive"),this._updateStyle(t),this._layers[r.stamp(t)]=t},_addPath:function(t){this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){r.DomUtil.remove(t._path),t.removeInteractiveTarget(t._path),delete this._layers[r.stamp(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,i=t.options;e&&(i.stroke?(e.setAttribute("stroke",i.color),e.setAttribute("stroke-opacity",i.opacity),e.setAttribute("stroke-width",i.weight),e.setAttribute("stroke-linecap",i.lineCap),e.setAttribute("stroke-linejoin",i.lineJoin),i.dashArray?e.setAttribute("stroke-dasharray",i.dashArray):e.removeAttribute("stroke-dasharray"),i.dashOffset?e.setAttribute("stroke-dashoffset",i.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),i.fill?(e.setAttribute("fill",i.fillColor||i.color),e.setAttribute("fill-opacity",i.fillOpacity),e.setAttribute("fill-rule",i.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,r.SVG.pointsToPath(t._parts,e))},_updateCircle:function(t){var e=t._point,i=t._radius,n=t._radiusY||i,r="a"+i+","+n+" 0 1,0 ",a=t._empty()?"M0 0":"M"+(e.x-i)+","+e.y+r+2*i+",0 "+r+2*-i+",0 ";this._setPath(t,a)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){r.DomUtil.toFront(t._path)},_bringToBack:function(t){r.DomUtil.toBack(t._path)}}),r.extend(r.SVG,{create:function(t){return e.createElementNS("http://www.w3.org/2000/svg",t)},pointsToPath:function(t,e){var i,n,a,o,s,l,d="";for(i=0,a=t.length;i<a;i++){for(s=t[i],n=0,o=s.length;n<o;n++)l=s[n],d+=(n?"L":"M")+l.x+" "+l.y;d+=e?r.Browser.svg?"z":"x":""}return d||"M0 0"}}),r.Browser.svg=!(!e.createElementNS||!r.SVG.create("svg").createSVGRect),r.svg=function(t){return r.Browser.svg||r.Browser.vml?new r.SVG(t):null},r.Browser.vml=!r.Browser.svg&&function(){try{var t=e.createElement("div");t.innerHTML='<v:shape adj="1"/>';var i=t.firstChild;return i.style.behavior="url(#default#VML)",i&&"object"==typeof i.adj}catch(t){return!1}}(),r.SVG.include(r.Browser.vml?{_initContainer:function(){this._container=r.DomUtil.create("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(r.Renderer.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=r.SVG.create("shape");r.DomUtil.addClass(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=r.SVG.create("path"),e.appendChild(t._path),this._updateStyle(t)},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;r.DomUtil.remove(e),t.removeInteractiveTarget(e)},_updateStyle:function(t){var e=t._stroke,i=t._fill,n=t.options,a=t._container;a.stroked=!!n.stroke,a.filled=!!n.fill,n.stroke?(e||(e=t._stroke=r.SVG.create("stroke")),a.appendChild(e),e.weight=n.weight+"px",e.color=n.color,e.opacity=n.opacity,n.dashArray?e.dashStyle=r.Util.isArray(n.dashArray)?n.dashArray.join(" "):n.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=n.lineCap.replace("butt","flat"),e.joinstyle=n.lineJoin):e&&(a.removeChild(e),t._stroke=null),n.fill?(i||(i=t._fill=r.SVG.create("fill")),a.appendChild(i),i.color=n.fillColor||n.color,i.opacity=n.fillOpacity):i&&(a.removeChild(i),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),i=Math.round(t._radius),n=Math.round(t._radiusY||i);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+i+","+n+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){r.DomUtil.toFront(t._container)},_bringToBack:function(t){r.DomUtil.toBack(t._container)}}:{}),r.Browser.vml&&(r.SVG.create=function(){try{return e.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return e.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}()),r.Canvas=r.Renderer.extend({onAdd:function(){r.Renderer.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=e.createElement("canvas");r.DomEvent.on(t,"mousemove",r.Util.throttle(this._onMouseMove,32,this),this).on(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this).on(t,"mouseout",this._handleMouseOut,this),this._ctx=t.getContext("2d")},_updatePaths:function(){var t;this._redrawBounds=null;for(var e in this._layers)t=this._layers[e],t._update();this._redraw()},_update:function(){if(!this._map._animatingZoom||!this._bounds){this._drawnLayers={},r.Renderer.prototype._update.call(this);var t=this._bounds,e=this._container,i=t.getSize(),n=r.Browser.retina?2:1;r.DomUtil.setPosition(e,t.min),e.width=n*i.x,e.height=n*i.y,e.style.width=i.x+"px",e.style.height=i.y+"px",r.Browser.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_initPath:function(t){this._updateDashArray(t),this._layers[r.stamp(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,i=e.next,n=e.prev;i?i.prev=n:this._drawLast=n,n?n.next=i:this._drawFirst=i,delete t._order,delete this._layers[r.stamp(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if(t.options.dashArray){var e,i=t.options.dashArray.split(","),n=[];for(e=0;e<i.length;e++)n.push(Number(i[e]));t.options._dashArray=n}},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||r.Util.requestAnimFrame(this._redraw,this))},_extendRedrawBounds:function(t){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new r.Bounds,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))},_redraw:function(){this._redrawRequest=null,this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.clearRect(0,0,this._container.width,this._container.height)},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var i=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,i.x,i.y),this._ctx.clip()}this._drawing=!0;for(var n=this._drawFirst;n;n=n.next)t=n.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var i,n,r,a,o=t._parts,s=o.length,l=this._ctx;if(s){for(this._drawnLayers[t._leaflet_id]=t,l.beginPath(),l.setLineDash&&l.setLineDash(t.options&&t.options._dashArray||[]),i=0;i<s;i++){for(n=0,r=o[i].length;n<r;n++)a=o[i][n],l[n?"lineTo":"moveTo"](a.x,a.y);e&&l.closePath()}this._fillStroke(l,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,i=this._ctx,n=t._radius,r=(t._radiusY||n)/n;this._drawnLayers[t._leaflet_id]=t,1!==r&&(i.save(),i.scale(1,r)),i.beginPath(),i.arc(e.x,e.y/r,n,0,2*Math.PI,!1),1!==r&&i.restore(),this._fillStroke(i,t)}},_fillStroke:function(t,e){var i=e.options;i.fill&&(t.globalAlpha=i.fillOpacity,t.fillStyle=i.fillColor||i.color,t.fill(i.fillRule||"evenodd")),i.stroke&&0!==i.weight&&(t.globalAlpha=i.opacity,t.lineWidth=i.weight,t.strokeStyle=i.color,t.lineCap=i.lineCap,t.lineJoin=i.lineJoin,t.stroke())},_onClick:function(t){for(var e,i,n=this._map.mouseEventToLayerPoint(t),a=this._drawFirst;a;a=a.next)e=a.layer,e.options.interactive&&e._containsPoint(n)&&!this._map._draggableMoved(e)&&(i=e);i&&(r.DomEvent._fakeStop(t),this._fireEvent([i],t))},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(r.DomUtil.removeClass(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null)},_handleMouseHover:function(t,e){for(var i,n,a=this._drawFirst;a;a=a.next)i=a.layer,i.options.interactive&&i._containsPoint(e)&&(n=i);n!==this._hoveredLayer&&(this._handleMouseOut(t),n&&(r.DomUtil.addClass(this._container,"leaflet-interactive"),this._fireEvent([n],t,"mouseover"),this._hoveredLayer=n)),this._hoveredLayer&&this._fireEvent([this._hoveredLayer],t)},_fireEvent:function(t,e,i){this._map._fireDOMEvent(e,i||e.type,t)},_bringToFront:function(t){var e=t._order,i=e.next,n=e.prev;i&&(i.prev=n,n?n.next=i:i&&(this._drawFirst=i),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))},_bringToBack:function(t){var e=t._order,i=e.next,n=e.prev;n&&(n.next=i,i?i.prev=n:n&&(this._drawLast=n),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}),r.Browser.canvas=function(){return!!e.createElement("canvas").getContext}(),r.canvas=function(t){return r.Browser.canvas?new r.Canvas(t):null},r.Polyline.prototype._containsPoint=function(t,e){var i,n,a,o,s,l,d=this._clickTolerance();if(!this._pxBounds.contains(t))return!1;for(i=0,o=this._parts.length;i<o;i++)for(l=this._parts[i],n=0,s=l.length,a=s-1;n<s;a=n++)if((e||0!==n)&&r.LineUtil.pointToSegmentDistance(t,l[a],l[n])<=d)return!0;return!1},r.Polygon.prototype._containsPoint=function(t){var e,i,n,a,o,s,l,d,h=!1;if(!this._pxBounds.contains(t))return!1;for(a=0,l=this._parts.length;a<l;a++)for(e=this._parts[a],o=0,d=e.length,s=d-1;o<d;s=o++)i=e[o],n=e[s],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(h=!h);return h||r.Polyline.prototype._containsPoint.call(this,t,!0)},r.CircleMarker.prototype._containsPoint=function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()},r.GeoJSON=r.FeatureGroup.extend({initialize:function(t,e){r.setOptions(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,n,a=r.Util.isArray(t)?t:t.features;if(a){for(e=0,i=a.length;e<i;e++)n=a[e],(n.geometries||n.geometry||n.features||n.coordinates)&&this.addData(n);return this}var o=this.options;if(o.filter&&!o.filter(t))return this;var s=r.GeoJSON.geometryToLayer(t,o);return s?(s.feature=r.GeoJSON.asFeature(t),s.defaultOptions=s.options,this.resetStyle(s),o.onEachFeature&&o.onEachFeature(t,s),this.addLayer(s)):this},resetStyle:function(t){return t.options=r.Util.extend({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),r.extend(r.GeoJSON,{geometryToLayer:function(t,e){var i,n,a,o,s="Feature"===t.type?t.geometry:t,l=s?s.coordinates:null,d=[],h=e&&e.pointToLayer,c=e&&e.coordsToLatLng||this.coordsToLatLng;if(!l&&!s)return null;switch(s.type){case"Point":return i=c(l),h?h(t,i):new r.Marker(i);case"MultiPoint":for(a=0,o=l.length;a<o;a++)i=c(l[a]),d.push(h?h(t,i):new r.Marker(i));return new r.FeatureGroup(d);case"LineString":case"MultiLineString":return n=this.coordsToLatLngs(l,"LineString"===s.type?0:1,c),new r.Polyline(n,e);case"Polygon":case"MultiPolygon":return n=this.coordsToLatLngs(l,"Polygon"===s.type?1:2,c),new r.Polygon(n,e);case"GeometryCollection":for(a=0,o=s.geometries.length;a<o;a++){var u=this.geometryToLayer({geometry:s.geometries[a],type:"Feature",properties:t.properties},e);u&&d.push(u)}return new r.FeatureGroup(d);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(t){return new r.LatLng(t[1],t[0],t[2])},coordsToLatLngs:function(t,e,i){for(var n,r=[],a=0,o=t.length;a<o;a++)n=e?this.coordsToLatLngs(t[a],e-1,i):(i||this.coordsToLatLng)(t[a]),r.push(n);return r},latLngToCoords:function(t){return t.alt!==i?[t.lng,t.lat,t.alt]:[t.lng,t.lat]},latLngsToCoords:function(t,e,i){for(var n=[],a=0,o=t.length;a<o;a++)n.push(e?r.GeoJSON.latLngsToCoords(t[a],e-1,i):r.GeoJSON.latLngToCoords(t[a]));return!e&&i&&n.push(n[0]),n},getFeature:function(t,e){return t.feature?r.extend({},t.feature,{geometry:e}):r.GeoJSON.asFeature(e)},asFeature:function(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}});var s={toGeoJSON:function(){return r.GeoJSON.getFeature(this,{type:"Point",coordinates:r.GeoJSON.latLngToCoords(this.getLatLng())})}};r.Marker.include(s),r.Circle.include(s),r.CircleMarker.include(s),r.Polyline.prototype.toGeoJSON=function(){var t=!r.Polyline._flat(this._latlngs),e=r.GeoJSON.latLngsToCoords(this._latlngs,t?1:0);return r.GeoJSON.getFeature(this,{type:(t?"Multi":"")+"LineString",coordinates:e})},r.Polygon.prototype.toGeoJSON=function(){var t=!r.Polyline._flat(this._latlngs),e=t&&!r.Polyline._flat(this._latlngs[0]),i=r.GeoJSON.latLngsToCoords(this._latlngs,e?2:t?1:0,!0);return t||(i=[i]),r.GeoJSON.getFeature(this,{type:(e?"Multi":"")+"Polygon",coordinates:i})},r.LayerGroup.include({toMultiPoint:function(){var t=[];return this.eachLayer(function(e){t.push(e.toGeoJSON().geometry.coordinates)}),r.GeoJSON.getFeature(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint();var e="GeometryCollection"===t,i=[];return this.eachLayer(function(t){if(t.toGeoJSON){var n=t.toGeoJSON();i.push(e?n.geometry:r.GeoJSON.asFeature(n))}}),e?r.GeoJSON.getFeature(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i
}}}),r.geoJSON=function(t,e){return new r.GeoJSON(t,e)},r.geoJson=r.geoJSON,r.Draggable=r.Evented.extend({options:{clickTolerance:3},statics:{START:r.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(t,e,i){this._element=t,this._dragStartTarget=e||t,this._preventOutline=i},enable:function(){this._enabled||(r.DomEvent.on(this._dragStartTarget,r.Draggable.START.join(" "),this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(r.Draggable._dragging===this&&this.finishDrag(),r.DomEvent.off(this._dragStartTarget,r.Draggable.START.join(" "),this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(!t._simulated&&this._enabled&&(this._moved=!1,!r.DomUtil.hasClass(this._element,"leaflet-zoom-anim")&&!(r.Draggable._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(r.Draggable._dragging=this,this._preventOutline&&r.DomUtil.preventOutline(this._element),r.DomUtil.disableImageDrag(),r.DomUtil.disableTextSelection(),this._moving)))){this.fire("down");var i=t.touches?t.touches[0]:t;this._startPoint=new r.Point(i.clientX,i.clientY),r.DomEvent.on(e,r.Draggable.MOVE[t.type],this._onMove,this).on(e,r.Draggable.END[t.type],this._onUp,this)}},_onMove:function(i){if(!i._simulated&&this._enabled){if(i.touches&&i.touches.length>1)return void(this._moved=!0);var n=i.touches&&1===i.touches.length?i.touches[0]:i,a=new r.Point(n.clientX,n.clientY),o=a.subtract(this._startPoint);(o.x||o.y)&&(Math.abs(o.x)+Math.abs(o.y)<this.options.clickTolerance||(r.DomEvent.preventDefault(i),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=r.DomUtil.getPosition(this._element).subtract(o),r.DomUtil.addClass(e.body,"leaflet-dragging"),this._lastTarget=i.target||i.srcElement,t.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),r.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(o),this._moving=!0,r.Util.cancelAnimFrame(this._animRequest),this._lastEvent=i,this._animRequest=r.Util.requestAnimFrame(this._updatePosition,this,!0)))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),r.DomUtil.setPosition(this._element,this._newPos),this.fire("drag",t)},_onUp:function(t){!t._simulated&&this._enabled&&this.finishDrag()},finishDrag:function(){r.DomUtil.removeClass(e.body,"leaflet-dragging"),this._lastTarget&&(r.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var t in r.Draggable.MOVE)r.DomEvent.off(e,r.Draggable.MOVE[t],this._onMove,this).off(e,r.Draggable.END[t],this._onUp,this);r.DomUtil.enableImageDrag(),r.DomUtil.enableTextSelection(),this._moved&&this._moving&&(r.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,r.Draggable._dragging=!1}}),r.Handler=r.Class.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}}),r.Map.mergeOptions({dragging:!0,inertia:!r.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0}),r.Map.Drag=r.Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new r.Draggable(t._mapPane,t._container),this._draggable.on({down:this._onDown,dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}r.DomUtil.addClass(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){r.DomUtil.removeClass(this._map._container,"leaflet-grab"),r.DomUtil.removeClass(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDown:function(){this._map._stop()},_onDragStart:function(){var t=this._map;if(this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=r.latLngBounds(this._map.options.maxBounds);this._offsetLimit=r.bounds(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,i=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(i),this._times.push(e),e-this._times[0]>50&&(this._positions.shift(),this._times.shift())}this._map.fire("move",t).fire("drag",t)},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,r=(n-e+i)%t+e-i,a=(n+e+i)%t-e-i,o=Math.abs(r+i)<Math.abs(a+i)?r:a;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=o},_onDragEnd:function(t){var e=this._map,i=e.options,n=!i.inertia||this._times.length<2;if(e.fire("dragend",t),n)e.fire("moveend");else{var a=this._lastPos.subtract(this._positions[0]),o=(this._lastTime-this._times[0])/1e3,s=i.easeLinearity,l=a.multiplyBy(s/o),d=l.distanceTo([0,0]),h=Math.min(i.inertiaMaxSpeed,d),c=l.multiplyBy(h/d),u=h/(i.inertiaDeceleration*s),p=c.multiplyBy(-u/2).round();p.x||p.y?(p=e._limitOffset(p,e.options.maxBounds),r.Util.requestAnimFrame(function(){e.panBy(p,{duration:u,easeLinearity:s,noMoveStart:!0,animate:!0})})):e.fire("moveend")}}}),r.Map.addInitHook("addHandler","dragging",r.Map.Drag),r.Map.mergeOptions({doubleClickZoom:!0}),r.Map.DoubleClickZoom=r.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom(),n=e.options.zoomDelta,r=t.originalEvent.shiftKey?i-n:i+n;"center"===e.options.doubleClickZoom?e.setZoom(r):e.setZoomAround(t.containerPoint,r)}}),r.Map.addInitHook("addHandler","doubleClickZoom",r.Map.DoubleClickZoom),r.Map.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60}),r.Map.ScrollWheelZoom=r.Handler.extend({addHooks:function(){r.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){r.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=r.DomEvent.getWheelDelta(t),i=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var n=Math.max(i-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(r.bind(this._performZoom,this),n),r.DomEvent.stop(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),i=this._map.options.zoomSnap||0;t._stop();var n=this._delta/(4*this._map.options.wheelPxPerZoomLevel),r=4*Math.log(2/(1+Math.exp(-Math.abs(n))))/Math.LN2,a=i?Math.ceil(r/i)*i:r,o=t._limitZoom(e+(this._delta>0?a:-a))-e;this._delta=0,this._startTime=null,o&&("center"===t.options.scrollWheelZoom?t.setZoom(e+o):t.setZoomAround(this._lastMousePos,e+o))}}),r.Map.addInitHook("addHandler","scrollWheelZoom",r.Map.ScrollWheelZoom),r.extend(r.DomEvent,{_touchstart:r.Browser.msPointer?"MSPointerDown":r.Browser.pointer?"pointerdown":"touchstart",_touchend:r.Browser.msPointer?"MSPointerUp":r.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(t,e,i){function n(t){var e;if(e=r.Browser.pointer?r.DomEvent._pointersCount:t.touches.length,!(e>1)){var i=Date.now(),n=i-(o||i);s=t.touches?t.touches[0]:t,l=n>0&&n<=d,o=i}}function a(){if(l&&!s.cancelBubble){if(r.Browser.pointer){var t,i,n={};for(i in s)t=s[i],n[i]=t&&t.bind?t.bind(s):t;s=n}s.type="dblclick",e(s),o=null}}var o,s,l=!1,d=250,h="_leaflet_",c=this._touchstart,u=this._touchend;return t[h+c+i]=n,t[h+u+i]=a,t[h+"dblclick"+i]=e,t.addEventListener(c,n,!1),t.addEventListener(u,a,!1),r.Browser.edge||t.addEventListener("dblclick",e,!1),this},removeDoubleTapListener:function(t,e){var i="_leaflet_",n=t[i+this._touchstart+e],a=t[i+this._touchend+e],o=t[i+"dblclick"+e];return t.removeEventListener(this._touchstart,n,!1),t.removeEventListener(this._touchend,a,!1),r.Browser.edge||t.removeEventListener("dblclick",o,!1),this}}),r.extend(r.DomEvent,{POINTER_DOWN:r.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:r.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:r.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:r.Browser.msPointer?"MSPointerCancel":"pointercancel",TAG_WHITE_LIST:["INPUT","SELECT","OPTION"],_pointers:{},_pointersCount:0,addPointerListener:function(t,e,i,n){return"touchstart"===e?this._addPointerStart(t,i,n):"touchmove"===e?this._addPointerMove(t,i,n):"touchend"===e&&this._addPointerEnd(t,i,n),this},removePointerListener:function(t,e,i){var n=t["_leaflet_"+e+i];return"touchstart"===e?t.removeEventListener(this.POINTER_DOWN,n,!1):"touchmove"===e?t.removeEventListener(this.POINTER_MOVE,n,!1):"touchend"===e&&(t.removeEventListener(this.POINTER_UP,n,!1),t.removeEventListener(this.POINTER_CANCEL,n,!1)),this},_addPointerStart:function(t,i,n){var a=r.bind(function(t){if("mouse"!==t.pointerType&&t.pointerType!==t.MSPOINTER_TYPE_MOUSE){if(!(this.TAG_WHITE_LIST.indexOf(t.target.tagName)<0))return;r.DomEvent.preventDefault(t)}this._handlePointer(t,i)},this);if(t["_leaflet_touchstart"+n]=a,t.addEventListener(this.POINTER_DOWN,a,!1),!this._pointerDocListener){var o=r.bind(this._globalPointerUp,this);e.documentElement.addEventListener(this.POINTER_DOWN,r.bind(this._globalPointerDown,this),!0),e.documentElement.addEventListener(this.POINTER_MOVE,r.bind(this._globalPointerMove,this),!0),e.documentElement.addEventListener(this.POINTER_UP,o,!0),e.documentElement.addEventListener(this.POINTER_CANCEL,o,!0),this._pointerDocListener=!0}},_globalPointerDown:function(t){this._pointers[t.pointerId]=t,this._pointersCount++},_globalPointerMove:function(t){this._pointers[t.pointerId]&&(this._pointers[t.pointerId]=t)},_globalPointerUp:function(t){delete this._pointers[t.pointerId],this._pointersCount--},_handlePointer:function(t,e){t.touches=[];for(var i in this._pointers)t.touches.push(this._pointers[i]);t.changedTouches=[t],e(t)},_addPointerMove:function(t,e,i){var n=r.bind(function(t){(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons)&&this._handlePointer(t,e)},this);t["_leaflet_touchmove"+i]=n,t.addEventListener(this.POINTER_MOVE,n,!1)},_addPointerEnd:function(t,e,i){var n=r.bind(function(t){this._handlePointer(t,e)},this);t["_leaflet_touchend"+i]=n,t.addEventListener(this.POINTER_UP,n,!1),t.addEventListener(this.POINTER_CANCEL,n,!1)}}),r.Map.mergeOptions({touchZoom:r.Browser.touch&&!r.Browser.android23,bounceAtZoomLimits:!0}),r.Map.TouchZoom=r.Handler.extend({addHooks:function(){r.DomUtil.addClass(this._map._container,"leaflet-touch-zoom"),r.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){r.DomUtil.removeClass(this._map._container,"leaflet-touch-zoom"),r.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var i=this._map;if(t.touches&&2===t.touches.length&&!i._animatingZoom&&!this._zooming){var n=i.mouseEventToContainerPoint(t.touches[0]),a=i.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=i.getSize()._divideBy(2),this._startLatLng=i.containerPointToLatLng(this._centerPoint),"center"!==i.options.touchZoom&&(this._pinchStartLatLng=i.containerPointToLatLng(n.add(a)._divideBy(2))),this._startDist=n.distanceTo(a),this._startZoom=i.getZoom(),this._moved=!1,this._zooming=!0,i._stop(),r.DomEvent.on(e,"touchmove",this._onTouchMove,this).on(e,"touchend",this._onTouchEnd,this),r.DomEvent.preventDefault(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,i=e.mouseEventToContainerPoint(t.touches[0]),n=e.mouseEventToContainerPoint(t.touches[1]),a=i.distanceTo(n)/this._startDist;if(this._zoom=e.getScaleZoom(a,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&a<1||this._zoom>e.getMaxZoom()&&a>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===a)return}else{var o=i._add(n)._divideBy(2)._subtract(this._centerPoint);if(1===a&&0===o.x&&0===o.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(o),this._zoom)}this._moved||(e._moveStart(!0),this._moved=!0),r.Util.cancelAnimFrame(this._animRequest);var s=r.bind(e._move,e,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=r.Util.requestAnimFrame(s,this,!0),r.DomEvent.preventDefault(t)}},_onTouchEnd:function(){return this._moved&&this._zooming?(this._zooming=!1,r.Util.cancelAnimFrame(this._animRequest),r.DomEvent.off(e,"touchmove",this._onTouchMove).off(e,"touchend",this._onTouchEnd),void(this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom)))):void(this._zooming=!1)}}),r.Map.addInitHook("addHandler","touchZoom",r.Map.TouchZoom),r.Map.mergeOptions({tap:!0,tapTolerance:15}),r.Map.Tap=r.Handler.extend({addHooks:function(){r.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){r.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(r.DomEvent.preventDefault(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var i=t.touches[0],n=i.target;this._startPos=this._newPos=new r.Point(i.clientX,i.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&r.DomUtil.addClass(n,"leaflet-active"),this._holdTimeout=setTimeout(r.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",i))},this),1e3),this._simulateEvent("mousedown",i),r.DomEvent.on(e,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),r.DomEvent.off(e,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&t&&t.changedTouches){var i=t.changedTouches[0],n=i.target;n&&n.tagName&&"a"===n.tagName.toLowerCase()&&r.DomUtil.removeClass(n,"leaflet-active"),this._simulateEvent("mouseup",i),this._isTapValid()&&this._simulateEvent("click",i)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new r.Point(e.clientX,e.clientY),this._simulateEvent("mousemove",e)},_simulateEvent:function(i,n){var r=e.createEvent("MouseEvents");r._simulated=!0,n.target._simulatedClick=!0,r.initMouseEvent(i,!0,!0,t,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(r)}}),r.Browser.touch&&!r.Browser.pointer&&r.Map.addInitHook("addHandler","tap",r.Map.Tap),r.Map.mergeOptions({boxZoom:!0}),r.Map.BoxZoom=r.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){r.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){r.DomEvent.off(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_resetState:function(){this._moved=!1},_onMouseDown:function(t){return!(!t.shiftKey||1!==t.which&&1!==t.button)&&(this._resetState(),r.DomUtil.disableTextSelection(),r.DomUtil.disableImageDrag(),this._startPoint=this._map.mouseEventToContainerPoint(t),void r.DomEvent.on(e,{contextmenu:r.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this))},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=r.DomUtil.create("div","leaflet-zoom-box",this._container),r.DomUtil.addClass(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new r.Bounds(this._point,this._startPoint),i=e.getSize();r.DomUtil.setPosition(this._box,e.min),this._box.style.width=i.x+"px",this._box.style.height=i.y+"px"},_finish:function(){this._moved&&(r.DomUtil.remove(this._box),r.DomUtil.removeClass(this._container,"leaflet-crosshair")),r.DomUtil.enableTextSelection(),r.DomUtil.enableImageDrag(),r.DomEvent.off(e,{contextmenu:r.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){setTimeout(r.bind(this._resetState,this),0);var e=new r.LatLngBounds(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),r.Map.addInitHook("addHandler","boxZoom",r.Map.BoxZoom),r.Map.mergeOptions({keyboard:!0,keyboardPanDelta:80}),r.Map.Keyboard=r.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),r.DomEvent.on(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),r.DomEvent.off(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var i=e.body,n=e.documentElement,r=i.scrollTop||n.scrollTop,a=i.scrollLeft||n.scrollLeft;this._map._container.focus(),t.scrollTo(a,r)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,i,n=this._panKeys={},r=this.keyCodes;for(e=0,i=r.left.length;e<i;e++)n[r.left[e]]=[-1*t,0];for(e=0,i=r.right.length;e<i;e++)n[r.right[e]]=[t,0];for(e=0,i=r.down.length;e<i;e++)n[r.down[e]]=[0,t];for(e=0,i=r.up.length;e<i;e++)n[r.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,i,n=this._zoomKeys={},r=this.keyCodes;for(e=0,i=r.zoomIn.length;e<i;e++)n[r.zoomIn[e]]=t;for(e=0,i=r.zoomOut.length;e<i;e++)n[r.zoomOut[e]]=-t},_addHooks:function(){r.DomEvent.on(e,"keydown",this._onKeyDown,this)},_removeHooks:function(){r.DomEvent.off(e,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,i=t.keyCode,n=this._map;if(i in this._panKeys){if(n._panAnim&&n._panAnim._inProgress)return;e=this._panKeys[i],t.shiftKey&&(e=r.point(e).multiplyBy(3)),n.panBy(e),n.options.maxBounds&&n.panInsideBounds(n.options.maxBounds)}else if(i in this._zoomKeys)n.setZoom(n.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[i]);else{if(27!==i)return;n.closePopup()}r.DomEvent.stop(t)}}}),r.Map.addInitHook("addHandler","keyboard",r.Map.Keyboard),r.Handler.MarkerDrag=r.Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new r.Draggable(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),r.DomUtil.addClass(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&r.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(t){var e=this._marker,i=e._shadow,n=r.DomUtil.getPosition(e._icon),a=e._map.layerPointToLatLng(n);i&&r.DomUtil.setPosition(i,n),e._latlng=a,t.latlng=a,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),r.Control=r.Class.extend({options:{position:"topright"},initialize:function(t){r.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return r.DomUtil.addClass(e,"leaflet-control"),i.indexOf("bottom")!==-1?n.insertBefore(e,n.firstChild):n.appendChild(e),this},remove:function(){return this._map?(r.DomUtil.remove(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),r.control=function(t){return new r.Control(t)},r.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){function t(t,a){var o=i+t+" "+i+a;e[t+a]=r.DomUtil.create("div",o,n)}var e=this._controlCorners={},i="leaflet-",n=this._controlContainer=r.DomUtil.create("div",i+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){r.DomUtil.remove(this._controlContainer)}}),r.Control.Zoom=r.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=r.DomUtil.create("div",e+" leaflet-bar"),n=this.options;return this._zoomInButton=this._createButton(n.zoomInText,n.zoomInTitle,e+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(n.zoomOutText,n.zoomOutTitle,e+"-out",i,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,i,n,a){var o=r.DomUtil.create("a",i,n);return o.innerHTML=t,o.href="#",o.title=e,o.setAttribute("role","button"),o.setAttribute("aria-label",e),r.DomEvent.on(o,"mousedown dblclick",r.DomEvent.stopPropagation).on(o,"click",r.DomEvent.stop).on(o,"click",a,this).on(o,"click",this._refocusOnMap,this),o},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";r.DomUtil.removeClass(this._zoomInButton,e),r.DomUtil.removeClass(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMinZoom())&&r.DomUtil.addClass(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMaxZoom())&&r.DomUtil.addClass(this._zoomInButton,e)}}),r.Map.mergeOptions({zoomControl:!0}),r.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new r.Control.Zoom,this.addControl(this.zoomControl))}),r.control.zoom=function(t){return new r.Control.Zoom(t)},r.Control.Attribution=r.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){r.setOptions(this,t),this._attributions={}},onAdd:function(t){t.attributionControl=this,this._container=r.DomUtil.create("div","leaflet-control-attribution"),r.DomEvent&&r.DomEvent.disableClickPropagation(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),this._container},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(" | ")}}}),r.Map.mergeOptions({attributionControl:!0}),r.Map.addInitHook(function(){this.options.attributionControl&&(new r.Control.Attribution).addTo(this)}),r.control.attribution=function(t){return new r.Control.Attribution(t)},r.Control.Scale=r.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",i=r.DomUtil.create("div",e),n=this.options;return this._addScales(n,e+"-line",i),t.on(n.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=r.DomUtil.create("div",e,i)),t.imperial&&(this._iScale=r.DomUtil.create("div",e,i))},_update:function(){var t=this._map,e=t.getSize().y/2,i=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(i)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,i,e/t)},_updateImperial:function(t){var e,i,n,r=3.2808399*t;r>5280?(e=r/5280,i=this._getRoundNum(e),this._updateScale(this._iScale,i+" mi",i/e)):(n=this._getRoundNum(r),this._updateScale(this._iScale,n+" ft",n/r))},_updateScale:function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}}),r.control.scale=function(t){return new r.Control.Scale(t)},r.Control.Layers=r.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,i,n){return i<n?-1:n<i?1:0}},initialize:function(t,e,i){r.setOptions(this,i),this._layers=[],this._lastZIndex=0,this._handlingClick=!1;for(var n in t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){return this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this),this._container},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(r.stamp(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){r.DomUtil.addClass(this._container,"leaflet-control-layers-expanded"),this._form.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._form.clientHeight?(r.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height=t+"px"):r.DomUtil.removeClass(this._form,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return r.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=r.DomUtil.create("div",t);e.setAttribute("aria-haspopup",!0),r.DomEvent.disableClickPropagation(e),r.Browser.touch||r.DomEvent.disableScrollPropagation(e);var i=this._form=r.DomUtil.create("form",t+"-list");r.Browser.android||r.DomEvent.on(e,{mouseenter:this.expand,mouseleave:this.collapse},this);var n=this._layersLink=r.DomUtil.create("a",t+"-toggle",e);n.href="#",n.title="Layers",r.Browser.touch?r.DomEvent.on(n,"click",r.DomEvent.stop).on(n,"click",this.expand,this):r.DomEvent.on(n,"focus",this.expand,this),r.DomEvent.on(i,"click",function(){setTimeout(r.bind(this._onInputClick,this),0)},this),this._map.on("click",this.collapse,this),this.options.collapsed||this.expand(),this._baseLayersList=r.DomUtil.create("div",t+"-base",i),this._separator=r.DomUtil.create("div",t+"-separator",i),this._overlaysList=r.DomUtil.create("div",t+"-overlays",i),e.appendChild(i)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&r.stamp(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,i){t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:i}),this.options.sortLayers&&this._layers.sort(r.bind(function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(!this._container)return this;r.DomUtil.empty(this._baseLayersList),r.DomUtil.empty(this._overlaysList);var t,e,i,n,a=0;for(i=0;i<this._layers.length;i++)n=this._layers[i],this._addItem(n),e=e||n.overlay,t=t||!n.overlay,a+=n.overlay?0:1;return this.options.hideSingleBase&&(t=t&&a>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(r.stamp(t.target)),i=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)},_createRadioElement:function(t,i){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(i?' checked="checked"':"")+"/>",r=e.createElement("div");return r.innerHTML=n,r.firstChild},_addItem:function(t){var i,n=e.createElement("label"),a=this._map.hasLayer(t.layer);t.overlay?(i=e.createElement("input"),i.type="checkbox",i.className="leaflet-control-layers-selector",i.defaultChecked=a):i=this._createRadioElement("leaflet-base-layers",a),i.layerId=r.stamp(t.layer),r.DomEvent.on(i,"click",this._onInputClick,this);var o=e.createElement("span");o.innerHTML=" "+t.name;var s=e.createElement("div");n.appendChild(s),s.appendChild(i),s.appendChild(o);var l=t.overlay?this._overlaysList:this._baseLayersList;return l.appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){var t,e,i,n=this._form.getElementsByTagName("input"),r=[],a=[];this._handlingClick=!0;for(var o=n.length-1;o>=0;o--)t=n[o],e=this._getLayer(t.layerId).layer,i=this._map.hasLayer(e),t.checked&&!i?r.push(e):!t.checked&&i&&a.push(e);for(o=0;o<a.length;o++)this._map.removeLayer(a[o]);for(o=0;o<r.length;o++)this._map.addLayer(r[o]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var t,e,n=this._form.getElementsByTagName("input"),r=this._map.getZoom(),a=n.length-1;a>=0;a--)t=n[a],e=this._getLayer(t.layerId).layer,t.disabled=e.options.minZoom!==i&&r<e.options.minZoom||e.options.maxZoom!==i&&r>e.options.maxZoom},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),r.control.layers=function(t,e,i){return new r.Control.Layers(t,e,i)}}(window,document),L.Projection.BaiduSphericalMercator={
EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],project:function(t){return this._convertLL2MC(t)},unproject:function(t){return this._convertMC2LL(t)},_convertMC2LL:function(t){var e,i;e={x:Math.abs(t.y),y:Math.abs(t.x)};for(var n=0,r=this.MCBAND.length;n<r;n++)if(e.x>=this.MCBAND[n]){i=this.MC2LL[n];break}var t=this._convertor(t,i);return new L.LatLng(t.y.toFixed(6),t.x.toFixed(6))},_convertLL2MC:function(t){var e,i;t.x=this._getLoop(t.lng,-180,180),t.y=this._getRange(t.lat,-74,74),e=new L.Point(t.x,t.y);for(var n=0;n<this.LLBAND.length;n++)if(e.y>=this.LLBAND[n]){i=this.LL2MC[n];break}if(!i)for(var r=this.LLBAND.length-1;r>=0;r--)if(e.y<=-this.LLBAND[r]){i=this.LL2MC[r];break}var a=this._convertor(t,i);return new L.Point(a.x.toFixed(2),a.y.toFixed(2))},_convertor:function(t,e){if(!t||!e)return null;var i=e[0]+e[1]*Math.abs(t.x),n=Math.abs(t.y)/e[9],r=e[2]+e[3]*n+e[4]*n*n+e[5]*n*n*n+e[6]*n*n*n*n+e[7]*n*n*n*n*n+e[8]*n*n*n*n*n*n;return i*=t.x<0?-1:1,r*=t.y<0?-1:1,new L.Point(i,r)},_getRange:function(t,e,i){return null!=e&&(t=Math.max(t,e)),null!=i&&(t=Math.min(t,i)),t},_getLoop:function(t,e,i){for(;t>i;)t-=i-e;for(;t<e;)t+=i-e;return t},bounds:function(){var t=20037726.37,e=-11708041.66,i=12474104.17,n=L.bounds([-t,e],[t,i]),r=33554432;return n=new L.Bounds([-r,-r],[r,r])}()},L.CRS.BEPSG3857=L.extend({},L.CRS,{code:"EPSG:3857",projection:L.Projection.BaiduSphericalMercator,R:6370996.81,transformation:function(){var t=-26,e=Math.pow(2,t);return new L.Transformation(e,.5,-e,.5)}(),degreeToRad:function(t){return Math.PI*t/180},distance:function(t,e){t.lng=this.projection._getLoop(t.lng,-180,180),t.lat=this.projection._getRange(t.lat,-74,74),e.lng=this.projection._getLoop(e.lng,-180,180),e.lat=this.projection._getRange(e.lat,-74,74);var i,n,r,a;return i=this.degreeToRad(t.lng),r=this.degreeToRad(t.lat),n=this.degreeToRad(e.lng),a=this.degreeToRad(e.lat),this.R*Math.acos(Math.sin(r)*Math.sin(a)+Math.cos(r)*Math.cos(a)*Math.cos(n-i))}}),L.TileLayer.BaiduLayer=L.TileLayer.extend({options:{minZoom:3,maxZoom:19,subdomains:["online1","online2","online3"],attribution:"",style:"normal",styleJson:[],styleStr:null},_urls:{normal:"https://ss0.bdstatic.com/8bo_dTSlRsgBo1vgoIiO_jowehsv/tile/?qt=tile&x={x}&y={y}&z={z}&styles=pl&scaler=2&udt=20160401",weixing:"https://ss0.bdstatic.com/5bwHcj7lABFT8t_jkk_Z1zRvfdw6buu/it/u=x={x};y={y};z={z};v=009;type=sate&fm=46&udt=20141015",light:"https://api.map.baidu.com/customimage/tile?&x={x}&y={y}&z={z}&udt=20161109&scale=2&t%20=%201480488883931",dark:"https://api.map.baidu.com/customimage/tile?&x={x}&y={y}&z={z}&udt=20161109&scale=2",googlelite:"https://api.map.baidu.com/customimage/tile?&x={x}&y={y}&z={z}&udt=20161109&scale=2&t%20=%201480488980881",grassgreen:"https://api.map.baidu.com/customimage/tile?&x={x}&y={y}&z={z}&udt=20161109&scale=2&t%20=%201480489105735",midnight:"https://api.map.baidu.com/customimage/tile?&x={x}&y={y}&z={z}&udt=20161109&scale=2&t%20=%201480489148092",bluish:"https://api.map.baidu.com/customimage/tile?&x={x}&y={y}&z={z}&udt=20161109&scale=2&t%20=%201480489171571",hardedge:"https://api.map.baidu.com/customimage/tile?&x={x}&y={y}&z={z}&udt=20161109&scale=2&t%20=%201480489194855"},_weixing_label_url:"https://ss0.bdstatic.com/8bo_dTSlRMgBo1vgoIiO_jowehsv/tile/?qt=tile&x={x}&y={y}&z={z}&styles=sl&udt=20141015",initialize:function(t){var e,i=this;t.url?e=t.url:t.style&&(e=i._urls[t.style]),e||(e="https://ss0.bdstatic.com/8bo_dTSlRsgBo1vgoIiO_jowehsv/tile/?qt=tile&x={x}&y={y}&z={z}&styles=pl&scaler=2&udt=20160401"),L.TileLayer.prototype.initialize.call(this,e,t),"weixing"==t.style&&(i.labelLayer=new L.TileLayer.BaiduLayer({url:i._weixing_label_url}),i.on("add",function(){i.labelLayer.addTo(i._map)}))},getTileUrl:function(t){var e=Math.pow(2,t.z-1),i=t.x-e,n=e-t.y-1,r=L.point(i,n);r.z=t.z;var a=L.TileLayer.prototype.getTileUrl.call(this,r);return this.options.style&&(a+=this.options.styleStr?"&styles="+encodeURIComponent(this.options.styleStr):"&customid="+this.options.style),a},setMapStyle:function(t,e){var i;if(0==e.length)i=getMapStyle(t,"all");else{var n,r,a,i=[];for(n=0;n<e.length;n++)if(a=getMapStyle(t,e[n]),MapUtils.isArray(a))for(r=0;r<a.length;r++)i.push(a[r]);else i.push(a)}var o;t&&(o=this._urls[t],this.options.style=t),o||(o="https://ss0.bdstatic.com/8bo_dTSlRsgBo1vgoIiO_jowehsv/tile/?qt=tile&x={x}&y={y}&z={z}&styles=pl&scaler=2&udt=20160401"),i?this.options.styleStr=this._generateStyleStr(i):this.options.styleStr=null,"weixing"==t?(this.labelLayer||(this.labelLayer=new L.TileLayer.BaiduLayer({url:this._weixing_label_url})),this.labelLayer._map||this.labelLayer.addTo(this._map)):this.labelLayer&&this.labelLayer._map&&this.labelLayer.remove(),L.TileLayer.prototype.setUrl.call(this,o)},_generateStyleStr:function(t){for(var e,i={featureType:"t",elementType:"e",visibility:"v",color:"c",lightness:"l",saturation:"s",weight:"w",zoom:"z",hue:"h"},n={all:"all",geometry:"g","geometry.fill":"g.f","geometry.stroke":"g.s",labels:"l","labels.text.fill":"l.t.f","labels.text.stroke":"l.t.s","lables.text":"l.t","labels.icon":"l.i"},r=[],a=0;e=t[a];a++){var o=e.stylers;delete e.stylers,L.extend(e,o);var s,o=[];for(s in i)e[s]&&("elementType"===s?o.push(i[s]+":"+n[e[s]]):o.push(i[s]+":"+e[s]));2<o.length&&r.push(o.join("|"))}return r.join(",")}}),L.tileLayer.baiduLayer=function(t,e){return new L.TileLayer.BaiduLayer(t,e)},L.TileLayer.WMTS=L.TileLayer.extend({defaultWmtsParams:{service:"WMTS",request:"GetTile",version:"1.0.0",layer:"",style:"",tilematrixSet:"",format:"image/jpeg"},initialize:function(t,e){this._url=t;var i=L.extend({},this.defaultWmtsParams),n=e.tileSize||this.options.tileSize;e.detectRetina&&L.Browser.retina?i.width=i.height=2*n:i.width=i.height=n;for(var r in e)this.options.hasOwnProperty(r)||"matrixIds"==r||(i[r]=e[r]);this.wmtsParams=i,this.matrixIds=e.matrixIds||this.getDefaultMatrix(),L.setOptions(this,e)},onAdd:function(t){L.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t,e){var i=this._map;return crs=i.options.crs,e=t.z,tileSize=this.options.tileSize,nwPoint=t.multiplyBy(tileSize),nwPoint.x+=1,nwPoint.y-=1,sePoint=nwPoint.add(new L.Point(tileSize,tileSize)),nw=crs.project(i.unproject(nwPoint,e)),se=crs.project(i.unproject(sePoint,e)),tilewidth=se.x-nw.x,ident=this.matrixIds[e].identifier,X0=this.matrixIds[e].topLeftCorner.lng,Y0=this.matrixIds[e].topLeftCorner.lat,tilecol=Math.floor((nw.x-X0)/tilewidth),tilerow=-Math.floor((nw.y-Y0)/tilewidth),url=L.Util.template(this._url,{s:this._getSubdomain(t)}),url+L.Util.getParamString(this.wmtsParams,url)+"&tilematrix="+ident+"&tilerow="+tilerow+"&tilecol="+tilecol},setParams:function(t,e){return L.extend(this.wmtsParams,t),e||this.redraw(),this},getDefaultMatrix:function(){for(var t=new Array(22),e=0;e<22;e++)t[e]={identifier:""+e,topLeftCorner:new L.LatLng(20037508.3428,-20037508.3428)};return t}}),L.tileLayer.wmts=function(t,e){return new L.TileLayer.WMTS(t,e)},function(t,e,i){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[];var e=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,e?this._withAnimation:this._noAnimation),this._markerCluster=e?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(t){if(t instanceof L.LayerGroup)return this.addLayers([t]);if(!t.getLatLng)return this._nonPointGroup.addLayer(t),this;if(!this._map)return this._needsClustering.push(t),this;if(this.hasLayer(t))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(t,this._maxZoom),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var e=t,i=this._zoom;if(t.__parent)for(;e.__parent._zoom>=i;)e=e.__parent;return this._currentShownBounds.contains(e.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(t,e):this._animationAddLayerNonAnimated(t,e)),this},removeLayer:function(t){return t instanceof L.LayerGroup?this.removeLayers([t]):t.getLatLng?this._map?t.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(t)),this._removeLayer(t,!0),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),t.off("move",this._childMarkerMoved,this),t.off("dragstart",this._storeDragStart,this),t.off("dragend",this._onDragEnd,this),this._featureGroup.hasLayer(t)&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,t)&&this.hasLayer(t)&&this._needsRemoving.push(t),this):(this._nonPointGroup.removeLayer(t),this)},addLayers:function(t){if(!L.Util.isArray(t))return this.addLayer(t);var e,i=this._featureGroup,n=this._nonPointGroup,r=this.options.chunkedLoading,a=this.options.chunkInterval,o=this.options.chunkProgress,s=t.length,l=0,d=!0;if(this._map){var h=(new Date).getTime(),c=L.bind(function(){for(var u=(new Date).getTime();l<s;l++){if(r&&l%200===0){var p=(new Date).getTime()-u;if(p>a)break}if(e=t[l],e instanceof L.LayerGroup)d&&(t=t.slice(),d=!1),this._extractNonGroupLayers(e,t),s=t.length;else if(e.getLatLng){if(!this.hasLayer(e)&&(this._addLayer(e,this._maxZoom),e.__parent&&2===e.__parent.getChildCount())){var f=e.__parent.getAllChildMarkers(),m=f[0]===e?f[1]:f[0];i.removeLayer(m)}}else n.addLayer(e)}o&&o(l,s,(new Date).getTime()-h),l===s?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(c,this.options.chunkDelay)},this);c()}else for(var u=this._needsClustering;l<s;l++)e=t[l],e instanceof L.LayerGroup?(d&&(t=t.slice(),d=!1),this._extractNonGroupLayers(e,t),s=t.length):e.getLatLng?this.hasLayer(e)||u.push(e):n.addLayer(e);return this},removeLayers:function(t){var e,i,n=t.length,r=this._featureGroup,a=this._nonPointGroup,o=!0;if(!this._map){for(e=0;e<n;e++)i=t[e],i instanceof L.LayerGroup?(o&&(t=t.slice(),o=!1),this._extractNonGroupLayers(i,t),n=t.length):(this._arraySplice(this._needsClustering,i),a.removeLayer(i),this.hasLayer(i)&&this._needsRemoving.push(i));return this}if(this._unspiderfy){this._unspiderfy();var s=t.slice(),l=n;for(e=0;e<l;e++)i=s[e],i instanceof L.LayerGroup?(this._extractNonGroupLayers(i,s),l=s.length):this._unspiderfyLayer(i)}for(e=0;e<n;e++)i=t[e],i instanceof L.LayerGroup?(o&&(t=t.slice(),o=!1),this._extractNonGroupLayers(i,t),n=t.length):i.__parent?(this._removeLayer(i,!0,!0),r.hasLayer(i)&&(r.removeLayer(i),i.clusterShow&&i.clusterShow())):a.removeLayer(i);return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(t){t.off("move",this._childMarkerMoved,this),delete t.__parent}),this._map&&this._generateInitialClusters(),this},getBounds:function(){var t=new L.LatLngBounds;this._topClusterLevel&&t.extend(this._topClusterLevel._bounds);for(var e=this._needsClustering.length-1;e>=0;e--)t.extend(this._needsClustering[e].getLatLng());return t.extend(this._nonPointGroup.getBounds()),t},eachLayer:function(t,e){var i,n=this._needsClustering.slice(),r=this._needsRemoving;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(n),i=n.length-1;i>=0;i--)r.indexOf(n[i])===-1&&t.call(e,n[i]);this._nonPointGroup.eachLayer(t,e)},getLayers:function(){var t=[];return this.eachLayer(function(e){t.push(e)}),t},getLayer:function(t){var e=null;return t=parseInt(t,10),this.eachLayer(function(i){L.stamp(i)===t&&(e=i)}),e},hasLayer:function(t){if(!t)return!1;var e,i=this._needsClustering;for(e=i.length-1;e>=0;e--)if(i[e]===t)return!0;for(i=this._needsRemoving,e=i.length-1;e>=0;e--)if(i[e]===t)return!1;return!(!t.__parent||t.__parent._group!==this)||this._nonPointGroup.hasLayer(t)},zoomToShowLayer:function(t,e){"function"!=typeof e&&(e=function(){});var i=function(){!t._icon&&!t.__parent._icon||this._inZoomAnimation||(this._map.off("moveend",i,this),this.off("animationend",i,this),t._icon?e():t.__parent._icon&&(this.once("spiderfied",e,this),t.__parent.spiderfy()))};if(t._icon&&this._map.getBounds().contains(t.getLatLng()))e();else if(t.__parent._zoom<Math.round(this._map._zoom))this._map.on("moveend",i,this),this._map.panTo(t.getLatLng());else{var n=function(){this._map.off("movestart",n,this),n=null};this._map.on("movestart",n,this),this._map.on("moveend",i,this),this.on("animationend",i,this),t.__parent.zoomToBounds(),n&&i.call(this)}},onAdd:function(t){this._map=t;var e,i,n;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(t),this._nonPointGroup.addTo(t),this._gridClusters||this._generateInitialClusters(),this._maxLat=t.options.crs.projection.MAX_LATITUDE,e=0,i=this._needsRemoving.length;e<i;e++)n=this._needsRemoving[e],this._removeLayer(n,!0);this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),i=this._needsClustering,this._needsClustering=[],this.addLayers(i)},onRemove:function(t){t.off("zoomend",this._zoomEnd,this),t.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(t){for(var e=t;e&&!e._icon;)e=e.__parent;return e||null},_arraySplice:function(t,e){for(var i=t.length-1;i>=0;i--)if(t[i]===e)return t.splice(i,1),!0},_removeFromGridUnclustered:function(t,e){for(var i=this._map,n=this._gridUnclustered;e>=0&&n[e].removeObject(t,i.project(t.getLatLng(),e));e--);},_childMarkerMoved:function(t){this._ignoreMove||t.originalEvent instanceof MouseEvent||(t.target._latlng=t.oldLatLng,this.removeLayer(t.target),t.target._latlng=t.latlng,this.addLayer(t.target))},_removeLayer:function(t,e,i){var n=this._gridClusters,r=this._gridUnclustered,a=this._featureGroup,o=this._map;e&&this._removeFromGridUnclustered(t,this._maxZoom);var s,l=t.__parent,d=l._markers;for(this._arraySplice(d,t);l&&(l._childCount--,l._boundsNeedUpdate=!0,!(l._zoom<0));)e&&l._childCount<=1?(s=l._markers[0]===t?l._markers[1]:l._markers[0],n[l._zoom].removeObject(l,o.project(l._cLatLng,l._zoom)),r[l._zoom].addObject(s,o.project(s.getLatLng(),l._zoom)),this._arraySplice(l.__parent._childClusters,l),l.__parent._markers.push(s),s.__parent=l.__parent,l._icon&&(a.removeLayer(l),i||a.addLayer(s))):i&&l._icon||l._updateIcon(),l=l.__parent;delete t.__parent},_isOrIsParent:function(t,e){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},fire:function(t,e,i){if(e&&e.layer instanceof L.MarkerCluster){if(e.originalEvent&&this._isOrIsParent(e.layer._icon,e.originalEvent.relatedTarget))return;t="cluster"+t}L.FeatureGroup.prototype.fire.call(this,t,e,i)},listens:function(t,e){return L.FeatureGroup.prototype.listens.call(this,t,e)||L.FeatureGroup.prototype.listens.call(this,"cluster"+t,e)},_defaultIconCreateFunction:function(t){var e=t.getChildCount(),i=" marker-cluster-";return i+=e<10?"small":e<100?"medium":"large",new L.DivIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster"+i,iconSize:new L.Point(40,40)})},_bindEvents:function(){var t=this._map,e=this.options.spiderfyOnMaxZoom,i=this.options.showCoverageOnHover,n=this.options.zoomToBoundsOnClick;(e||n)&&this.on("clusterclick",this._zoomOrSpiderfy,this),i&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),t.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(t){for(var e=t.layer,i=e;1===i._childClusters.length;)i=i._childClusters[0];i._zoom===this._maxZoom&&i._childCount===e._childCount&&this.options.spiderfyOnMaxZoom?e.spiderfy():this.options.zoomToBoundsOnClick&&e.zoomToBounds(),t.originalEvent&&13===t.originalEvent.keyCode&&this._map._container.focus()},_showCoverage:function(t){var e=this._map;this._inZoomAnimation||(this._shownPolygon&&e.removeLayer(this._shownPolygon),t.layer.getChildCount()>2&&t.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(t.layer.getConvexHull(),this.options.polygonOptions),e.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var t=this.options.spiderfyOnMaxZoom,e=this.options.showCoverageOnHover,i=this.options.zoomToBoundsOnClick,n=this._map;(t||i)&&this.off("clusterclick",this._zoomOrSpiderfy,this),e&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),n.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var t=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),t),this._currentShownBounds=t}},_generateInitialClusters:function(){var t=this._map.getMaxZoom(),e=this.options.maxClusterRadius,i=e;"function"!=typeof e&&(i=function(){return e}),this.options.disableClusteringAtZoom&&(t=this.options.disableClusteringAtZoom-1),this._maxZoom=t,this._gridClusters={},this._gridUnclustered={};for(var n=t;n>=0;n--)this._gridClusters[n]=new L.DistanceGrid(i(n)),this._gridUnclustered[n]=new L.DistanceGrid(i(n));this._topClusterLevel=new this._markerCluster(this,-1)},_storeDragStart:function(t){this._startPosForDrag=t.target._latlng},_onDragEnd:function(t){if(!this._ignoreMove){var e=t.target._latlng;t.target._latlng=this._startPosForDrag,this.removeLayer(t.target),t.target._latlng=e,this.addLayer(t.target)}},_addLayer:function(t,e){var i,n,r=this._gridClusters,a=this._gridUnclustered;for(this.options.singleMarkerMode&&this._overrideMarkerIcon(t),t.on("move",this._childMarkerMoved,this),t.on("dragstart",this._storeDragStart,this),t.on("dragend",this._onDragEnd,this);e>=0;e--){i=this._map.project(t.getLatLng(),e);var o=r[e].getNearObject(i);if(o)return o._addChild(t),void(t.__parent=o);if(o=a[e].getNearObject(i)){var s=o.__parent;s&&this._removeLayer(o,!1);var l=new this._markerCluster(this,e,o,t);r[e].addObject(l,this._map.project(l._cLatLng,e)),o.__parent=l,t.__parent=l;var d=l;for(n=e-1;n>s._zoom;n--)d=new this._markerCluster(this,n,d),r[n].addObject(d,this._map.project(o.getLatLng(),n));return s._addChild(d),void this._removeFromGridUnclustered(o,e)}a[e].addObject(t,i)}this._topClusterLevel._addChild(t),t.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(t){t instanceof L.MarkerCluster&&t._iconNeedsUpdate&&t._updateIcon()})},_enqueue:function(t){this._queue.push(t),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var t=0;t<this._queue.length;t++)this._queue[t].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var t=Math.round(this._map._zoom);this._processQueue(),this._zoom<t&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,t)):this._zoom>t?(this._animationStart(),this._animationZoomOut(this._zoom,t)):this._moveEnd()},_getExpandedVisibleBounds:function(){return this.options.removeOutsideVisibleBounds?L.Browser.mobile?this._checkBoundsMaxLat(this._map.getBounds()):this._checkBoundsMaxLat(this._map.getBounds().pad(1)):this._mapBoundsInfinite},_checkBoundsMaxLat:function(t){var e=this._maxLat;return e!==i&&(t.getNorth()>=e&&(t._northEast.lat=1/0),t.getSouth()<=-e&&(t._southWest.lat=-(1/0))),t},_animationAddLayerNonAnimated:function(t,e){if(e===t)this._featureGroup.addLayer(t);else if(2===e._childCount){e._addToMap();var i=e.getAllChildMarkers();this._featureGroup.removeLayer(i[0]),this._featureGroup.removeLayer(i[1])}else e._updateIcon()},_extractNonGroupLayers:function(t,e){var i,n=t.getLayers(),r=0;for(e=e||[];r<n.length;r++)i=n[r],i instanceof L.LayerGroup?this._extractNonGroupLayers(i,e):e.push(i);return e},_overrideMarkerIcon:function(t){var e=t.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[t]}});return e}}),L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-(1/0),-(1/0)),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(t,e){this._animationAddLayerNonAnimated(t,e)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(t,e){var i,n=this._getExpandedVisibleBounds(),r=this._featureGroup;this._ignoreMove=!0,this._topClusterLevel._recursively(n,t,0,function(a){var o,s=a._latlng,l=a._markers;for(n.contains(s)||(s=null),a._isSingleParent()&&t+1===e?(r.removeLayer(a),a._recursivelyAddChildrenToMap(null,e,n)):(a.clusterHide(),a._recursivelyAddChildrenToMap(s,e,n)),i=l.length-1;i>=0;i--)o=l[i],n.contains(o._latlng)||r.removeLayer(o)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(n,e),r.eachLayer(function(t){t instanceof L.MarkerCluster||!t._icon||t.clusterShow()}),this._topClusterLevel._recursively(n,t,e,function(t){t._recursivelyRestoreChildPositions(e)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(n,t,0,function(t){r.removeLayer(t),t.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(t,e){this._animationZoomOutSingle(this._topClusterLevel,t-1,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,t,this._getExpandedVisibleBounds())},_animationAddLayer:function(t,e){var i=this,n=this._featureGroup;n.addLayer(t),e!==t&&(e._childCount>2?(e._updateIcon(),this._forceLayout(),this._animationStart(),t._setPos(this._map.latLngToLayerPoint(e.getLatLng())),t.clusterHide(),this._enqueue(function(){n.removeLayer(t),t.clusterShow(),i._animationEnd()})):(this._forceLayout(),i._animationStart(),i._animationZoomOutSingle(e,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(t,e,i){var n=this._getExpandedVisibleBounds();t._recursivelyAnimateChildrenInAndAddSelfToMap(n,e+1,i);var r=this;this._forceLayout(),t._recursivelyBecomeVisible(n,i),this._enqueue(function(){if(1===t._childCount){var a=t._markers[0];this._ignoreMove=!0,a.setLatLng(a.getLatLng()),this._ignoreMove=!1,a.clusterShow&&a.clusterShow()}else t._recursively(n,i,0,function(t){t._recursivelyRemoveChildrenFromMap(n,e+1)});r._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(e.body.offsetWidth)}}),L.markerClusterGroup=function(t){return new L.MarkerClusterGroup(t)},L.MarkerCluster=L.Marker.extend({initialize:function(t,e,i,n){L.Marker.prototype.initialize.call(this,i?i._cLatLng||i.getLatLng():new L.LatLng(0,0),{icon:this}),this._group=t,this._zoom=e,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,i&&this._addChild(i),n&&this._addChild(n)},getAllChildMarkers:function(t){t=t||[];for(var e=this._childClusters.length-1;e>=0;e--)this._childClusters[e].getAllChildMarkers(t);for(var i=this._markers.length-1;i>=0;i--)t.push(this._markers[i]);return t},getChildCount:function(){return this._childCount},zoomToBounds:function(){for(var t,e=this._childClusters.slice(),i=this._group._map,n=i.getBoundsZoom(this._bounds),r=this._zoom+1,a=i.getZoom();e.length>0&&n>r;){r++;var o=[];for(t=0;t<e.length;t++)o=o.concat(e[t]._childClusters);e=o}n>r?this._group._map.setView(this._latlng,r):n<=a?this._group._map.setView(this._latlng,a+1):this._group._map.fitBounds(this._bounds)},getBounds:function(){var t=new L.LatLngBounds;return t.extend(this._bounds),t},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(t,e){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(t),t instanceof L.MarkerCluster?(e||(this._childClusters.push(t),t.__parent=this),this._childCount+=t._childCount):(e||this._markers.push(t),this._childCount++),this.__parent&&this.__parent._addChild(t,!0)},_setClusterCenter:function(t){this._cLatLng||(this._cLatLng=t._cLatLng||t._latlng)},_resetBounds:function(){var t=this._bounds;t._southWest&&(t._southWest.lat=1/0,t._southWest.lng=1/0),t._northEast&&(t._northEast.lat=-(1/0),t._northEast.lng=-(1/0))},_recalculateBounds:function(){var t,e,i,n,r=this._markers,a=this._childClusters,o=0,s=0,l=this._childCount;if(0!==l){for(this._resetBounds(),t=0;t<r.length;t++)i=r[t]._latlng,this._bounds.extend(i),o+=i.lat,s+=i.lng;for(t=0;t<a.length;t++)e=a[t],e._boundsNeedUpdate&&e._recalculateBounds(),this._bounds.extend(e._bounds),i=e._wLatLng,n=e._childCount,o+=i.lat*n,s+=i.lng*n;this._latlng=this._wLatLng=new L.LatLng(o/l,s/l),this._boundsNeedUpdate=!1}},_addToMap:function(t){t&&(this._backupLatlng=this._latlng,this.setLatLng(t)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(t,e,i){this._recursively(t,0,i-1,function(t){var i,n,r=t._markers;for(i=r.length-1;i>=0;i--)n=r[i],n._icon&&(n._setPos(e),n.clusterHide())},function(t){var i,n,r=t._childClusters;for(i=r.length-1;i>=0;i--)n=r[i],n._icon&&(n._setPos(e),n.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(t,e,i){this._recursively(t,i,0,function(n){n._recursivelyAnimateChildrenIn(t,n._group._map.latLngToLayerPoint(n.getLatLng()).round(),e),n._isSingleParent()&&e-1===i?(n.clusterShow(),n._recursivelyRemoveChildrenFromMap(t,e)):n.clusterHide(),n._addToMap()})},_recursivelyBecomeVisible:function(t,e){this._recursively(t,0,e,null,function(t){t.clusterShow()})},_recursivelyAddChildrenToMap:function(t,e,i){this._recursively(i,-1,e,function(n){if(e!==n._zoom)for(var r=n._markers.length-1;r>=0;r--){var a=n._markers[r];i.contains(a._latlng)&&(t&&(a._backupLatlng=a.getLatLng(),a.setLatLng(t),a.clusterHide&&a.clusterHide()),n._group._featureGroup.addLayer(a))}},function(e){e._addToMap(t)})},_recursivelyRestoreChildPositions:function(t){for(var e=this._markers.length-1;e>=0;e--){var i=this._markers[e];i._backupLatlng&&(i.setLatLng(i._backupLatlng),delete i._backupLatlng)}if(t-1===this._zoom)for(var n=this._childClusters.length-1;n>=0;n--)this._childClusters[n]._restorePosition();else for(var r=this._childClusters.length-1;r>=0;r--)this._childClusters[r]._recursivelyRestoreChildPositions(t)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(t,e,i){var n,r;this._recursively(t,-1,e-1,function(t){for(r=t._markers.length-1;r>=0;r--)n=t._markers[r],i&&i.contains(n._latlng)||(t._group._featureGroup.removeLayer(n),n.clusterShow&&n.clusterShow())},function(t){for(r=t._childClusters.length-1;r>=0;r--)n=t._childClusters[r],i&&i.contains(n._latlng)||(t._group._featureGroup.removeLayer(n),n.clusterShow&&n.clusterShow())})},_recursively:function(t,e,i,n,r){var a,o,s=this._childClusters,l=this._zoom;if(e<=l&&(n&&n(this),r&&l===i&&r(this)),l<e||l<i)for(a=s.length-1;a>=0;a--)o=s[a],t.intersects(o._bounds)&&o._recursively(t,e,i,n,r)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}}),L.Marker.include({clusterHide:function(){return this.options.opacityWhenUnclustered=this.options.opacity||1,this.setOpacity(0)},clusterShow:function(){var t=this.setOpacity(this.options.opacity||this.options.opacityWhenUnclustered);return delete this.options.opacityWhenUnclustered,t}}),L.DistanceGrid=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(t,e){var i=this._getCoord(e.x),n=this._getCoord(e.y),r=this._grid,a=r[n]=r[n]||{},o=a[i]=a[i]||[],s=L.Util.stamp(t);this._objectPoint[s]=e,o.push(t)},updateObject:function(t,e){this.removeObject(t),this.addObject(t,e)},removeObject:function(t,e){var i,n,r=this._getCoord(e.x),a=this._getCoord(e.y),o=this._grid,s=o[a]=o[a]||{},l=s[r]=s[r]||[];for(delete this._objectPoint[L.Util.stamp(t)],i=0,n=l.length;i<n;i++)if(l[i]===t)return l.splice(i,1),1===n&&delete s[r],!0},eachObject:function(t,e){var i,n,r,a,o,s,l,d=this._grid;
for(i in d){o=d[i];for(n in o)for(s=o[n],r=0,a=s.length;r<a;r++)l=t.call(e,s[r]),l&&(r--,a--)}},getNearObject:function(t){var e,i,n,r,a,o,s,l,d=this._getCoord(t.x),h=this._getCoord(t.y),c=this._objectPoint,u=this._sqCellSize,p=null;for(e=h-1;e<=h+1;e++)if(r=this._grid[e])for(i=d-1;i<=d+1;i++)if(a=r[i])for(n=0,o=a.length;n<o;n++)s=a[n],l=this._sqDist(c[L.Util.stamp(s)],t),l<u&&(u=l,p=s);return p},_getCoord:function(t){return Math.floor(t/this._cellSize)},_sqDist:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n}},function(){L.QuickHull={getDistant:function(t,e){var i=e[1].lat-e[0].lat,n=e[0].lng-e[1].lng;return n*(t.lat-e[0].lat)+i*(t.lng-e[0].lng)},findMostDistantPointFromBaseLine:function(t,e){var i,n,r,a=0,o=null,s=[];for(i=e.length-1;i>=0;i--)n=e[i],r=this.getDistant(n,t),r>0&&(s.push(n),r>a&&(a=r,o=n));return{maxPoint:o,newPoints:s}},buildConvexHull:function(t,e){var i=[],n=this.findMostDistantPointFromBaseLine(t,e);return n.maxPoint?(i=i.concat(this.buildConvexHull([t[0],n.maxPoint],n.newPoints)),i=i.concat(this.buildConvexHull([n.maxPoint,t[1]],n.newPoints))):[t[0]]},getConvexHull:function(t){var e,i=!1,n=!1,r=!1,a=!1,o=null,s=null,l=null,d=null,h=null,c=null;for(e=t.length-1;e>=0;e--){var u=t[e];(i===!1||u.lat>i)&&(o=u,i=u.lat),(n===!1||u.lat<n)&&(s=u,n=u.lat),(r===!1||u.lng>r)&&(l=u,r=u.lng),(a===!1||u.lng<a)&&(d=u,a=u.lng)}n!==i?(c=s,h=o):(c=d,h=l);var p=[].concat(this.buildConvexHull([c,h],t),this.buildConvexHull([h,c],t));return p}}}(),L.MarkerCluster.include({getConvexHull:function(){var t,e,i=this.getAllChildMarkers(),n=[];for(e=i.length-1;e>=0;e--)t=i[e].getLatLng(),n.push(t);return L.QuickHull.getConvexHull(n)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var t,e=this.getAllChildMarkers(),i=this._group,n=i._map,r=n.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,e.length>=this._circleSpiralSwitchover?t=this._generatePointsSpiral(e.length,r):(r.y+=10,t=this._generatePointsCircle(e.length,r)),this._animationSpiderfy(e,t)}},unspiderfy:function(t){this._group._inZoomAnimation||(this._animationUnspiderfy(t),this._group._spiderfied=null)},_generatePointsCircle:function(t,e){var i,n,r=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+t),a=r/this._2PI,o=this._2PI/t,s=[];for(s.length=t,i=t-1;i>=0;i--)n=this._circleStartAngle+i*o,s[i]=new L.Point(e.x+a*Math.cos(n),e.y+a*Math.sin(n))._round();return s},_generatePointsSpiral:function(t,e){var i,n=this._group.options.spiderfyDistanceMultiplier,r=n*this._spiralLengthStart,a=n*this._spiralFootSeparation,o=n*this._spiralLengthFactor*this._2PI,s=0,l=[];for(l.length=t,i=t-1;i>=0;i--)s+=a/r+5e-4*i,l[i]=new L.Point(e.x+r*Math.cos(s),e.y+r*Math.sin(s))._round(),r+=o/s;return l},_noanimationUnspiderfy:function(){var t,e,i=this._group,n=i._map,r=i._featureGroup,a=this.getAllChildMarkers();for(i._ignoreMove=!0,this.setOpacity(1),e=a.length-1;e>=0;e--)t=a[e],r.removeLayer(t),t._preSpiderfyLatlng&&(t.setLatLng(t._preSpiderfyLatlng),delete t._preSpiderfyLatlng),t.setZIndexOffset&&t.setZIndexOffset(0),t._spiderLeg&&(n.removeLayer(t._spiderLeg),delete t._spiderLeg);i.fire("unspiderfied",{cluster:this,markers:a}),i._ignoreMove=!1,i._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(t,e){var i,n,r,a,o=this._group,s=o._map,l=o._featureGroup,d=this._group.options.spiderLegPolylineOptions;for(o._ignoreMove=!0,i=0;i<t.length;i++)a=s.layerPointToLatLng(e[i]),n=t[i],r=new L.Polyline([this._latlng,a],d),s.addLayer(r),n._spiderLeg=r,n._preSpiderfyLatlng=n._latlng,n.setLatLng(a),n.setZIndexOffset&&n.setZIndexOffset(1e6),l.addLayer(n);this.setOpacity(.3),o._ignoreMove=!1,o.fire("spiderfied",{cluster:this,markers:t})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(t,e){var n,r,a,o,s,l,d=this,h=this._group,c=h._map,u=h._featureGroup,p=this._latlng,f=c.latLngToLayerPoint(p),m=L.Path.SVG,g=L.extend({},this._group.options.spiderLegPolylineOptions),_=g.opacity;for(_===i&&(_=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),m?(g.opacity=0,g.className=(g.className||"")+" leaflet-cluster-spider-leg"):g.opacity=_,h._ignoreMove=!0,n=0;n<t.length;n++)r=t[n],l=c.layerPointToLatLng(e[n]),a=new L.Polyline([p,l],g),c.addLayer(a),r._spiderLeg=a,m&&(o=a._path,s=o.getTotalLength()+.1,o.style.strokeDasharray=s,o.style.strokeDashoffset=s),r.setZIndexOffset&&r.setZIndexOffset(1e6),r.clusterHide&&r.clusterHide(),u.addLayer(r),r._setPos&&r._setPos(f);for(h._forceLayout(),h._animationStart(),n=t.length-1;n>=0;n--)l=c.layerPointToLatLng(e[n]),r=t[n],r._preSpiderfyLatlng=r._latlng,r.setLatLng(l),r.clusterShow&&r.clusterShow(),m&&(a=r._spiderLeg,o=a._path,o.style.strokeDashoffset=0,a.setStyle({opacity:_}));this.setOpacity(.3),h._ignoreMove=!1,setTimeout(function(){h._animationEnd(),h.fire("spiderfied",{cluster:d,markers:t})},200)},_animationUnspiderfy:function(t){var e,i,n,r,a,o,s=this,l=this._group,d=l._map,h=l._featureGroup,c=t?d._latLngToNewLayerPoint(this._latlng,t.zoom,t.center):d.latLngToLayerPoint(this._latlng),u=this.getAllChildMarkers(),p=L.Path.SVG;for(l._ignoreMove=!0,l._animationStart(),this.setOpacity(1),i=u.length-1;i>=0;i--)e=u[i],e._preSpiderfyLatlng&&(e.setLatLng(e._preSpiderfyLatlng),delete e._preSpiderfyLatlng,o=!0,e._setPos&&(e._setPos(c),o=!1),e.clusterHide&&(e.clusterHide(),o=!1),o&&h.removeLayer(e),p&&(n=e._spiderLeg,r=n._path,a=r.getTotalLength()+.1,r.style.strokeDashoffset=a,n.setStyle({opacity:0})));l._ignoreMove=!1,setTimeout(function(){var t=0;for(i=u.length-1;i>=0;i--)e=u[i],e._spiderLeg&&t++;for(i=u.length-1;i>=0;i--)e=u[i],e._spiderLeg&&(e.clusterShow&&e.clusterShow(),e.setZIndexOffset&&e.setZIndexOffset(0),t>1&&h.removeLayer(e),d.removeLayer(e._spiderLeg),delete e._spiderLeg);l._animationEnd(),l.fire("unspiderfied",{cluster:s,markers:u})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(t){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(t))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(t){this._spiderfied&&this._spiderfied.unspiderfy(t)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(t){t._spiderLeg&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow(),t.setZIndexOffset&&t.setZIndexOffset(0),this._map.removeLayer(t._spiderLeg),delete t._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(t){return t?t instanceof L.MarkerClusterGroup?t=t._topClusterLevel.getAllChildMarkers():t instanceof L.LayerGroup?t=t._layers:t instanceof L.MarkerCluster?t=t.getAllChildMarkers():t instanceof L.Marker&&(t=[t]):t=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(t),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(t),this},_flagParentsIconsNeedUpdate:function(t){var e,i;for(e in t)for(i=t[e].__parent;i;)i._iconNeedsUpdate=!0,i=i.__parent},_refreshSingleMarkerModeMarkers:function(t){var e,i;for(e in t)i=t[e],this.hasLayer(i)&&i.setIcon(this._overrideMarkerIcon(i))}}),L.Marker.include({refreshIconOptions:function(t,e){var i=this.options.icon;return L.setOptions(i,t),this.setIcon(i),e&&this.__parent&&this.__parent._group.refreshClusters(this),this}})}(window,document),L.LineUtil.PolylineDecorator={computeAngle:function(t,e){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI+90},getPointPathPixelLength:function(t){var e=t.length;if(e<2)return 0;for(var i,n=0,r=t[0],a=1;a<e;a++)n+=r.distanceTo(i=t[a]),r=i;return n},getPixelLength:function(t,e){var i=t instanceof L.Polyline?t.getLatLngs():t,n=i.length;if(n<2)return 0;for(var r,a=0,o=e.project(i[0]),s=1;s<n;s++)a+=o.distanceTo(r=e.project(i[s])),o=r;return a},projectPatternOnPath:function(t,e,i,n,r){var a,o=[];for(a=0,l=t.length;a<l;a++)o[a]=r.project(t[a]);var s=this.projectPatternOnPointPath(o,e,i,n);for(a=0,l=s.length;a<l;a++)s[a].latLng=r.unproject(s[a].pt);return s},projectPatternOnPointPath:function(t,e,i,n){var r=[],a=this.getPointPathPixelLength(t)*n,o=this.interpolateOnPointPath(t,e),s=i>0?this.getPointPathPixelLength(t)*i:0;if(r.push(o),n>0){var l=t;l=l.slice(o.predecessor),l[0]=o.pt;for(var d=this.getPointPathPixelLength(l);a<=d-s;)o=this.interpolateOnPointPath(l,a/d),r.push(o),l=l.slice(o.predecessor),l[0]=o.pt,d=this.getPointPathPixelLength(l)}return r},interpolateOnPointPath:function(t,e){var i=t.length;if(i<2)return null;if(e<=0)return{pt:t[0],predecessor:0,heading:this.computeAngle(t[0],t[1])};if(e>=1)return{pt:t[i-1],predecessor:i-1,heading:this.computeAngle(t[i-2],t[i-1])};if(2==i)return{pt:this.interpolateBetweenPoints(t[0],t[1],e),predecessor:0,heading:this.computeAngle(t[0],t[1])};for(var n=this.getPointPathPixelLength(t),r=t[0],a=r,o=0,s=0,l=0,d=1;d<i&&s<e;d++)r=a,o=s,a=t[d],l+=r.distanceTo(a),s=l/n;var h=(e-o)/(s-o);return{pt:this.interpolateBetweenPoints(r,a,h),predecessor:d-2,heading:this.computeAngle(r,a)}},interpolateBetweenPoints:function(t,e,i){return e.x!=t.x?new L.Point(t.x*(1-i)+i*e.x,t.y*(1-i)+i*e.y):new L.Point(t.x,t.y+(e.y-t.y)*i)}},L.PolylineDecorator=L.LayerGroup.extend({options:{patterns:[]},initialize:function(t,e){L.LayerGroup.prototype.initialize.call(this),L.Util.setOptions(this,e),this._map=null,this._initPaths(t),this._initPatterns()},_initPaths:function(t){this._paths=[];if(t instanceof L.Polyline)this._initPath(t.getLatLngs(),t instanceof L.Polygon);else if(L.Util.isArray(t)&&t.length>0)if(t[0]instanceof L.Polyline)for(var e=0;e<t.length;e++)this._initPath(t[e].getLatLngs(),t[e]instanceof L.Polygon);else this._initPath(t)},_isCoordArray:function(t){return L.Util.isArray(t)&&t.length>0&&(t[0]instanceof L.LatLng||L.Util.isArray(t[0])&&2==t[0].length&&"number"==typeof t[0][0])},_initPath:function(t,e){var i;i=this._isCoordArray(t)?[t]:t;for(var n=0;n<i.length;n++)e&&i[n].push(i[n][0]),this._paths.push(i[n])},_initPatterns:function(){this._isZoomDependant=!1,this._patterns=[];for(var t,e=0;e<this.options.patterns.length;e++)t=this._parsePatternDef(this.options.patterns[e]),this._patterns.push(t),this._isZoomDependant=this._isZoomDependant||t.isOffsetInPixels||t.isEndOffsetInPixels||t.isRepeatInPixels||t.symbolFactory.isZoomDependant},setPatterns:function(t){this.options.patterns=t,this._initPatterns(),this._softRedraw()},setPaths:function(t){this._initPaths(t),this.redraw()},_parsePatternDef:function(t){var e={cache:[],symbolFactory:t.symbol,isOffsetInPixels:!1,isEndOffsetInPixels:!1,isRepeatInPixels:!1};return"string"==typeof t.offset&&t.offset.indexOf("%")!=-1?e.offset=parseFloat(t.offset)/100:(e.offset=t.offset?parseFloat(t.offset):0,e.isOffsetInPixels=e.offset>0),"string"==typeof t.endOffset&&t.endOffset.indexOf("%")!=-1?e.endOffset=parseFloat(t.endOffset)/100:(e.endOffset=t.endOffset?parseFloat(t.endOffset):0,e.isEndOffsetInPixels=e.endOffset>0),"string"==typeof t.repeat&&t.repeat.indexOf("%")!=-1?e.repeat=parseFloat(t.repeat)/100:(e.repeat=parseFloat(t.repeat),e.isRepeatInPixels=e.repeat>0),e},onAdd:function(t){this._map=t,this._draw(),this._isZoomDependant&&this._map.on("zoomend",this._softRedraw,this)},onRemove:function(t){this._map.off("zoomend",this._softRedraw,this),this._map=null,L.LayerGroup.prototype.onRemove.call(this,t)},_buildSymbols:function(t,e,i){for(var n=[],r=0,a=i.length;r<a;r++)n.push(e.buildSymbol(i[r],t,this._map,r,a));return n},_getCache:function(t,e,i){var n=t.cache[e];return"undefined"==typeof n?(t.cache[e]=[],null):n[i]},_getDirectionPoints:function(t,e){var i=this._map.getZoom(),n=this._getCache(e,i,t);if(n)return n;var r,a,o,s=null,l=this._paths[t];return e.isOffsetInPixels?(s=L.LineUtil.PolylineDecorator.getPixelLength(l,this._map),r=e.offset/s):r=e.offset,e.isEndOffsetInPixels?(s=null!==s?s:L.LineUtil.PolylineDecorator.getPixelLength(l,this._map),a=e.endOffset/s):a=e.endOffset,e.isRepeatInPixels?(s=null!==s?s:L.LineUtil.PolylineDecorator.getPixelLength(l,this._map),o=e.repeat/s):o=e.repeat,n=L.LineUtil.PolylineDecorator.projectPatternOnPath(l,r,a,o,this._map),e.cache[i][t]=n,n},redraw:function(){this._redraw(!0)},_softRedraw:function(){this._redraw(!1)},_redraw:function(t){if(null!==this._map){if(this.clearLayers(),t)for(var e=0;e<this._patterns.length;e++)this._patterns[e].cache=[];this._draw()}},_drawPattern:function(t){for(var e,i,n=0;n<this._paths.length;n++){e=this._getDirectionPoints(n,t),i=this._buildSymbols(this._paths[n],t.symbolFactory,e);for(var r=0;r<i.length;r++)this.addLayer(i[r])}},_draw:function(){for(var t=0;t<this._patterns.length;t++)this._drawPattern(this._patterns[t])}}),L.polylineDecorator=function(t,e){return new L.PolylineDecorator(t,e)},L.RotatedMarker=L.Marker.extend({options:{angle:0},statics:{TRANSFORM_ORIGIN:L.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"])},_initIcon:function(){L.Marker.prototype._initIcon.call(this),this._icon.style[L.RotatedMarker.TRANSFORM_ORIGIN]=this._getTransformOrigin()},_getTransformOrigin:function(){var t=this.options.icon.options.iconAnchor;return t?t[0]+"px "+t[1]+"px":"50% 50%"},_setPos:function(t){if(L.Marker.prototype._setPos.call(this,t),L.DomUtil.TRANSFORM)this._icon.style[L.DomUtil.TRANSFORM]+=" rotate("+this.options.angle+"deg)";else if(L.Browser.ie){var e=this.options.angle*(Math.PI/180),i=Math.cos(e),n=Math.sin(e);this._icon.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+i+", M12="+-n+", M21="+n+", M22="+i+")"}},setAngle:function(t){this.options.angle=t}}),L.rotatedMarker=function(t,e){return new L.RotatedMarker(t,e)},L.Symbol=L.Symbol||{},L.Symbol.Dash=L.Class.extend({isZoomDependant:!0,options:{pixelSize:10,pathOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.pathOptions.clickable=!1},buildSymbol:function(t,e,i){var n=this.options,r=Math.PI/180;if(n.pixelSize<=1)return new L.Polyline([t.latLng,t.latLng],n.pathOptions);var a=i.project(t.latLng),o=-(t.heading-90)*r,s=new L.Point(a.x+n.pixelSize*Math.cos(o+Math.PI)/2,a.y+n.pixelSize*Math.sin(o)/2),l=a.add(a.subtract(s));return new L.Polyline([i.unproject(s),i.unproject(l)],n.pathOptions)}}),L.Symbol.dash=function(t){return new L.Symbol.Dash(t)},L.Symbol.ArrowHead=L.Class.extend({isZoomDependant:!0,options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function(t){L.Util.setOptions(this,t),this.options.pathOptions.clickable=!1},buildSymbol:function(t,e,i){var n,r=this.options;return n=r.polygon?new L.Polygon(this._buildArrowPath(t,i),r.pathOptions):new L.Polyline(this._buildArrowPath(t,i),r.pathOptions)},_buildArrowPath:function(t,e){var i=Math.PI/180,n=e.project(t.latLng),r=-(t.heading-90)*i,a=this.options.headAngle/2*i,o=r+a,s=r-a,l=new L.Point(n.x-this.options.pixelSize*Math.cos(o),n.y+this.options.pixelSize*Math.sin(o)),d=new L.Point(n.x-this.options.pixelSize*Math.cos(s),n.y+this.options.pixelSize*Math.sin(s));return[e.unproject(l),t.latLng,e.unproject(d)]}}),L.Symbol.arrowHead=function(t){return new L.Symbol.ArrowHead(t)},L.Symbol.Marker=L.Class.extend({isZoomDependant:!1,options:{markerOptions:{},rotate:!1},initialize:function(t){L.Util.setOptions(this,t),this.options.markerOptions.clickable=!1,this.options.markerOptions.draggable=!1,this.isZoomDependant=L.Browser.ie&&this.options.rotate},buildSymbol:function(t){return this.options.rotate?(this.options.markerOptions.angle=t.heading+(this.options.angleCorrection||0),new L.RotatedMarker(t.latLng,this.options.markerOptions)):new L.Marker(t.latLng,this.options.markerOptions)}}),L.Symbol.marker=function(t){return new L.Symbol.Marker(t)},!function(t,e){L.drawVersion="0.4.3+e21f99b",L.Draw={},L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},finish:{title:"Finish drawing",text:"Finish"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Draw a marker"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."},radius:"Radius"},marker:{tooltip:{start:"Click map to place marker."}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}}}},edit:{toolbar:{actions:{save:{title:"Save changes.",text:"Save"},cancel:{title:"Cancel editing, discards all changes.",text:"Cancel"}},buttons:{edit:"Edit layers.",editDisabled:"No layers to edit.",remove:"Delete layers.",removeDisabled:"No layers to delete."}},handlers:{edit:{tooltip:{text:"Drag handles, or marker to edit feature.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove"}}}}},L.Draw.Event={},L.Draw.Event.CREATED="draw:created",L.Draw.Event.EDITED="draw:edited",L.Draw.Event.DELETED="draw:deleted",L.Draw.Event.DRAWSTART="draw:drawstart",L.Draw.Event.DRAWSTOP="draw:drawstop",L.Draw.Event.DRAWVERTEX="draw:drawvertex",L.Draw.Event.EDITSTART="draw:editstart",L.Draw.Event.EDITMOVE="draw:editmove",L.Draw.Event.EDITRESIZE="draw:editresize",L.Draw.Event.EDITVERTEX="draw:editvertex",L.Draw.Event.EDITSTOP="draw:editstop",L.Draw.Event.DELETESTART="draw:deletestart",L.Draw.Event.DELETESTOP="draw:deletestop",L.Draw=L.Draw||{},L.Draw.Feature=L.Handler.extend({includes:L.Mixin.Events,initialize:function(t,e){this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,e&&e.shapeOptions&&(e.shapeOptions=L.Util.extend({},this.options.shapeOptions,e.shapeOptions)),L.setOptions(this,e)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DRAWSTART,{layerType:this.type}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DRAWSTOP,{layerType:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(L.DomUtil.disableTextSelection(),t.getContainer().focus(),this._tooltip=new L.Draw.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(t){L.setOptions(this,t)},_fireCreatedEvent:function(t){this._map.fire(L.Draw.Event.CREATED,{layer:t,layerType:this.type})},_cancelDrawing:function(t){this._map.fire("draw:canceled",{layerType:this.type}),27===t.keyCode&&this.disable()}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,feet:!0,showLength:!0,zIndexOffset:2e3},initialize:function(t,e){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error,e&&e.drawError&&(e.drawError=L.Util.extend({},this.options.drawError,e.drawError)),this.type=L.Draw.Polyline.TYPE,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),L.Browser.touch||this._map.on("mouseup",this._onMouseUp,this),this._mouseMarker.on("mousedown",this._onMouseDown,this).on("mouseout",this._onMouseOut,this).on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).addTo(this._map),this._map.on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).on("zoomlevelschange",this._onZoomEnd,this).on("click",this._onTouch,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this).off("click",this._onTouch,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var t=this._markers.pop(),e=this._poly,i=e.getLatLngs(),n=i.splice(-1,1)[0];this._poly.setLatLngs(i),this._markerGroup.removeLayer(t),e.getLatLngs().length<2&&this._map.removeLayer(e),this._vertexChanged(n,!1)}},addVertex:function(t){var e=this._markers.length;return e>0&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t)?void this._showErrorTooltip():(this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(t)),this._poly.addLatLng(t),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),void this._vertexChanged(t,!0))},completeShape:function(){this._markers.length<=1||(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_finishShape:function(){var t=this._poly._defaultShape?this._poly._defaultShape():this._poly.getLatLngs(),e=this._poly.newLatLngIntersects(t[t.length-1]);return!this.options.allowIntersection&&e||!this._shapeIsValid()?void this._showErrorTooltip():(this._fireCreatedEvent(),this.disable(),void(this.options.repeatMode&&this.enable()))},_shapeIsValid:function(){return!0},_onZoomEnd:function(){null!==this._markers&&this._updateGuide()},_onMouseMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent),i=this._map.layerPointToLatLng(e);this._currentLatLng=i,this._updateTooltip(i),this._updateGuide(e),this._mouseMarker.setLatLng(i),L.DomEvent.preventDefault(t.originalEvent)},_vertexChanged:function(t,e){this._map.fire(L.Draw.Event.DRAWVERTEX,{layers:this._markerGroup}),this._updateFinishHandler(),this._updateRunningMeasure(t,e),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(t){var e=t.originalEvent;this._mouseDownOrigin=L.point(e.clientX,e.clientY)},_onMouseUp:function(e){if(this._mouseDownOrigin){var i=L.point(e.originalEvent.clientX,e.originalEvent.clientY).distanceTo(this._mouseDownOrigin);Math.abs(i)<9*(t.devicePixelRatio||1)&&this.addVertex(e.latlng)}this._mouseDownOrigin=null},_onTouch:function(t){L.Browser.touch&&(this._onMouseDown(t),this._onMouseUp(t))},_onMouseOut:function(){this._tooltip&&this._tooltip._onMouseOut.call(this._tooltip)},_updateFinishHandler:function(){var t=this._markers.length;t>1&&this._markers[t-1].on("click",this._finishShape,this),t>2&&this._markers[t-2].off("click",this._finishShape,this)},_createMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(e),e},_updateGuide:function(t){var e=this._markers?this._markers.length:0;e>0&&(t=t||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[e-1].getLatLng()),t))},_updateTooltip:function(t){var e=this._getTooltipText();t&&this._tooltip.updatePosition(t),this._errorShown||this._tooltip.updateContent(e)},_drawGuide:function(t,e){var i,n,r,a=Math.floor(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))),o=this.options.guidelineDistance,s=this.options.maxGuideLineLength,l=a>s?a-s:o;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));l<a;l+=this.options.guidelineDistance)i=l/a,n={x:Math.floor(t.x*(1-i)+i*e.x),y:Math.floor(t.y*(1-i)+i*e.y)},r=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),r.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(r,n)},_updateGuideColor:function(t){if(this._guidesContainer)for(var e=0,i=this._guidesContainer.childNodes.length;e<i;e++)this._guidesContainer.childNodes[e].style.backgroundColor=t},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var t,e,i=this.options.showLength;return 0===this._markers.length?t={text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(e=i?this._getMeasurementString():"",t=1===this._markers.length?{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:e}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:e}),t},_updateRunningMeasure:function(t,e){var i,n,r=this._markers.length;1===this._markers.length?this._measurementRunningTotal=0:(i=r-(e?2:1),n=t.distanceTo(this._markers[i].getLatLng()),this._measurementRunningTotal+=n*(e?1:-1))},_getMeasurementString:function(){var t,e=this._currentLatLng,i=this._markers[this._markers.length-1].getLatLng();return t=this._measurementRunningTotal+e.distanceTo(i),L.GeometryUtil.readableDistance(t,this.options.metric,this.options.feet)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var t=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},metric:!0},initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var t=this._markers.length;1===t&&this._markers[0].on("click",this._finishShape,this),t>2&&(this._markers[t-1].on("dblclick",this._finishShape,this),t>3&&this._markers[t-2].off("dblclick",this._finishShape,this))},_getTooltipText:function(){var t,e;return 0===this._markers.length?t=L.drawLocal.draw.handlers.polygon.tooltip.start:this._markers.length<3?t=L.drawLocal.draw.handlers.polygon.tooltip.cont:(t=L.drawLocal.draw.handlers.polygon.tooltip.end,e=this._getMeasurementString()),{text:t,subtext:e}},_getMeasurementString:function(){var t=this._area;return t?L.GeometryUtil.readableArea(t,this.options.metric):null},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(t,e){var i;!this.options.allowIntersection&&this.options.showArea&&(i=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(i)),L.Draw.Polyline.prototype._vertexChanged.call(this,t,e)},_cleanUpShape:function(){var t=this._markers.length;t>0&&(this._markers[0].off("click",this._finishShape,this),t>2&&this._markers[t-1].off("dblclick",this._finishShape,this))}}),L.SimpleShape={},L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(t,e){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._mapDraggable=this._map.dragging.enabled(),this._mapDraggable&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this).on("touchstart",this._onMouseDown,this).on("touchmove",this._onMouseMove,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this).off("touchstart",this._onMouseDown,this).off("touchmove",this._onMouseMove,this),L.DomEvent.off(e,"mouseup",this._onMouseUp,this),L.DomEvent.off(e,"touchend",this._onMouseUp,this),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(t){this._isDrawing=!0,this._startLatLng=t.latlng,L.DomEvent.on(e,"mouseup",this._onMouseUp,this).on(e,"touchend",this._onMouseUp,this).preventDefault(t.originalEvent)},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(e))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()}}),L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,showArea:!0,clickable:!0},metric:!0},initialize:function(t,e){this.type=L.Draw.Rectangle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},_drawShape:function(t){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,t)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_getTooltipText:function(){var t,e,i,n=L.Draw.SimpleShape.prototype._getTooltipText.call(this),r=this._shape,a=this.options.showArea;return r&&(t=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),e=L.GeometryUtil.geodesicArea(t),i=a?L.GeometryUtil.readableArea(e,this.options.metric):""),{text:n.text,subtext:i}}}),L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showRadius:!0,metric:!0,feet:!0},initialize:function(t,e){this.type=L.Draw.Circle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start,
L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},_drawShape:function(t){this._shape?this._shape.setRadius(this._startLatLng.distanceTo(t)):(this._shape=new L.Circle(this._startLatLng,this._startLatLng.distanceTo(t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_onMouseMove:function(t){var e,i=t.latlng,n=this.options.showRadius,r=this.options.metric;this._tooltip.updatePosition(i),this._isDrawing&&(this._drawShape(i),e=this._shape.getRadius().toFixed(1),this._tooltip.updateContent({text:this._endLabelText,subtext:n?L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(e,r,this.options.feet):""}))}}),L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2e3},initialize:function(t,e){this.type=L.Draw.Marker.TYPE,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._tooltip.updateContent({text:L.drawLocal.draw.handlers.marker.tooltip.start}),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onTouch,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._marker&&(this._marker.off("click",this._onClick,this),this._map.off("click",this._onClick,this).off("click",this._onTouch,this).removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._mouseMarker.setLatLng(e),this._marker?(e=this._mouseMarker.getLatLng(),this._marker.setLatLng(e)):(this._marker=new L.Marker(e,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset}),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_onClick:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_onTouch:function(t){this._onMouseMove(t),this._onClick()},_fireCreatedEvent:function(){var t=new L.Marker.Touch(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Edit=L.Edit||{},L.Edit.Marker=L.Handler.extend({initialize:function(t,e){this._marker=t,L.setOptions(this,e)},addHooks:function(){var t=this._marker;t.dragging.enable(),t.on("dragend",this._onDragEnd,t),this._toggleMarkerHighlight()},removeHooks:function(){var t=this._marker;t.dragging.disable(),t.off("dragend",this._onDragEnd,t),this._toggleMarkerHighlight()},_onDragEnd:function(t){var e=t.target;e.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:e})},_toggleMarkerHighlight:function(){var t=this._marker._icon;t&&(t.style.display="none",L.DomUtil.hasClass(t,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,-4)):(L.DomUtil.addClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,4)),t.style.display="")},_offsetMarker:function(t,e){var i=parseInt(t.style.marginTop,10)-e,n=parseInt(t.style.marginLeft,10)-e;t.style.marginTop=i+"px",t.style.marginLeft=n+"px"}}),L.Marker.addInitHook(function(){L.Edit.Marker&&(this.editing=new L.Edit.Marker(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.Poly=L.Handler.extend({options:{},initialize:function(t,e){this.latlngs=[t._latlngs],t._holes&&(this.latlngs=this.latlngs.concat(t._holes)),this._poly=t,L.setOptions(this,e),this._poly.on("revert-edited",this._updateLatLngs,this)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._poly._latlngs)?this._poly._latlngs:this._poly._latlngs[0]:this._poly._latlngs},_eachVertexHandler:function(t){for(var e=0;e<this._verticesHandlers.length;e++)t(this._verticesHandlers[e])},addHooks:function(){this._initHandlers(),this._eachVertexHandler(function(t){t.addHooks()})},removeHooks:function(){this._eachVertexHandler(function(t){t.removeHooks()})},updateMarkers:function(){this._eachVertexHandler(function(t){t.updateMarkers()})},_initHandlers:function(){this._verticesHandlers=[];for(var t=0;t<this.latlngs.length;t++)this._verticesHandlers.push(new L.Edit.PolyVerticesEdit(this._poly,this.latlngs[t],this.options))},_updateLatLngs:function(t){this.latlngs=[t.layer._latlngs],t.layer._holes&&(this.latlngs=this.latlngs.concat(t.layer._holes))}}),L.Edit.PolyVerticesEdit=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),drawError:{color:"#b00b00",timeout:1e3}},initialize:function(t,e,i){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this._poly=t,i&&i.drawError&&(i.drawError=L.Util.extend({},this.options.drawError,i.drawError)),this._latlngs=e,L.setOptions(this,i)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]:this._latlngs},addHooks:function(){var t=this._poly;t instanceof L.Polygon||(t.options.fill=!1,t.options.editing&&(t.options.editing.fill=!1)),t.setStyle(t.options.editing),this._poly._map&&(this._map=this._poly._map,this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){var t=this._poly;t.setStyle(t.options.original),t._map&&(t._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var t,e,i,n,r=this._defaultShape();for(t=0,i=r.length;t<i;t++)n=this._createMarker(r[t],t),n.on("click",this._onMarkerClick,this),this._markers.push(n);var a,o;for(t=0,e=i-1;t<i;e=t++)(0!==t||L.Polygon&&this._poly instanceof L.Polygon)&&(a=this._markers[e],o=this._markers[t],this._createMiddleMarker(a,o),this._updatePrevNext(a,o))},_createMarker:function(t,e){var i=new L.Marker.Touch(t,{draggable:!0,icon:this.options.icon});return i._origLatLng=t,i._index=e,i.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._fireEdit,this).on("touchmove",this._onTouchMove,this).on("touchend",this._fireEdit,this).on("MSPointerMove",this._onTouchMove,this).on("MSPointerUp",this._fireEdit,this),this._markerGroup.addLayer(i),i},_onMarkerDragStart:function(){this._poly.fire("editstart")},_spliceLatLngs:function(){var t=this._defaultShape(),e=[].splice.apply(t,arguments);return this._poly._convertLatLngs(t,!0),this._poly.redraw(),e},_removeMarker:function(t){var e=t._index;this._markerGroup.removeLayer(t),this._markers.splice(e,1),this._spliceLatLngs(e,1),this._updateIndexes(e,-1),t.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("touchmove",this._onMarkerDrag,this).off("touchend",this._fireEdit,this).off("click",this._onMarkerClick,this).off("MSPointerMove",this._onTouchMove,this).off("MSPointerUp",this._fireEdit,this)},_fireEdit:function(){this._poly.edited=!0,this._poly.fire("edit"),this._poly._map.fire(L.Draw.Event.EDITVERTEX,{layers:this._markerGroup})},_onMarkerDrag:function(t){var e=t.target,i=this._poly;if(L.extend(e._origLatLng,e._latlng),e._middleLeft&&e._middleLeft.setLatLng(this._getMiddleLatLng(e._prev,e)),e._middleRight&&e._middleRight.setLatLng(this._getMiddleLatLng(e,e._next)),i.options.poly){var n=i._map._editTooltip;if(!i.options.poly.allowIntersection&&i.intersects()){var r=i.options.color;i.setStyle({color:this.options.drawError.color}),0!==L.version.indexOf("0.7")&&e.dragging._draggable._onUp(t),this._onMarkerClick(t),n&&n.updateContent({text:L.drawLocal.draw.handlers.polyline.error}),setTimeout(function(){i.setStyle({color:r}),n&&n.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext})},1e3)}}this._poly.redraw(),this._poly.fire("editdrag")},_onMarkerClick:function(t){var e=L.Polygon&&this._poly instanceof L.Polygon?4:3,i=t.target;this._defaultShape().length<e||(this._removeMarker(i),this._updatePrevNext(i._prev,i._next),i._middleLeft&&this._markerGroup.removeLayer(i._middleLeft),i._middleRight&&this._markerGroup.removeLayer(i._middleRight),i._prev&&i._next?this._createMiddleMarker(i._prev,i._next):i._prev?i._next||(i._prev._middleRight=null):i._next._middleLeft=null,this._fireEdit())},_onTouchMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent.touches[0]),i=this._map.layerPointToLatLng(e),n=t.target;L.extend(n._origLatLng,i),n._middleLeft&&n._middleLeft.setLatLng(this._getMiddleLatLng(n._prev,n)),n._middleRight&&n._middleRight.setLatLng(this._getMiddleLatLng(n,n._next)),this._poly.redraw(),this.updateMarkers()},_updateIndexes:function(t,e){this._markerGroup.eachLayer(function(i){i._index>t&&(i._index+=e)})},_createMiddleMarker:function(t,e){var i,n,r,a=this._getMiddleLatLng(t,e),o=this._createMarker(a);o.setOpacity(.6),t._middleRight=e._middleLeft=o,n=function(){o.off("touchmove",n,this);var r=e._index;o._index=r,o.off("click",i,this).on("click",this._onMarkerClick,this),a.lat=o.getLatLng().lat,a.lng=o.getLatLng().lng,this._spliceLatLngs(r,0,a),this._markers.splice(r,0,o),o.setOpacity(1),this._updateIndexes(r,1),e._index++,this._updatePrevNext(t,o),this._updatePrevNext(o,e),this._poly.fire("editstart")},r=function(){o.off("dragstart",n,this),o.off("dragend",r,this),o.off("touchmove",n,this),this._createMiddleMarker(t,o),this._createMiddleMarker(o,e)},i=function(){n.call(this),r.call(this),this._fireEdit()},o.on("click",i,this).on("dragstart",n,this).on("dragend",r,this).on("touchmove",n,this),this._markerGroup.addLayer(o)},_updatePrevNext:function(t,e){t&&(t._next=e),e&&(e._prev=t)},_getMiddleLatLng:function(t,e){var i=this._poly._map,n=i.project(t.getLatLng()),r=i.project(e.getLatLng());return i.unproject(n._add(r)._divideBy(2))}}),L.Polyline.addInitHook(function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this,this.options.poly),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))}),L.Edit=L.Edit||{},L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"}),touchMoveIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move leaflet-touch-icon"}),touchResizeIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize leaflet-touch-icon"})},initialize:function(t,e){L.Browser.touch&&(this.options.moveIcon=this.options.touchMoveIcon,this.options.resizeIcon=this.options.touchResizeIcon),this._shape=t,L.Util.setOptions(this,e)},addHooks:function(){var t=this._shape;this._shape._map&&(this._map=this._shape._map,t.setStyle(t.options.editing),t._map&&(this._map=t._map,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup)))},removeHooks:function(){var t=this._shape;if(t.setStyle(t.options.original),t._map){this._unbindMarker(this._moveMarker);for(var e=0,i=this._resizeMarkers.length;e<i;e++)this._unbindMarker(this._resizeMarkers[e]);this._resizeMarkers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._createMoveMarker(),this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(t,e){var i=new L.Marker.Touch(t,{draggable:!0,icon:e,zIndexOffset:10});return this._bindMarker(i),this._markerGroup.addLayer(i),i},_bindMarker:function(t){t.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this).on("touchstart",this._onTouchStart,this).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onTouchEnd,this).on("MSPointerUp",this._onTouchEnd,this)},_unbindMarker:function(t){t.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._onMarkerDragEnd,this).off("touchstart",this._onTouchStart,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onTouchEnd,this).off("MSPointerUp",this._onTouchEnd,this)},_onMarkerDragStart:function(t){var e=t.target;e.setOpacity(0),this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=!0,this._shape.fire("edit")},_onMarkerDrag:function(t){var e=t.target,i=e.getLatLng();e===this._moveMarker?this._move(i):this._resize(i),this._shape.redraw(),this._shape.fire("editdrag")},_onMarkerDragEnd:function(t){var e=t.target;e.setOpacity(1),this._fireEdit()},_onTouchStart:function(t){if(L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,t),"function"==typeof this._getCorners){var e=this._getCorners(),i=t.target,n=i._cornerIndex;i.setOpacity(0),this._oppositeCorner=e[(n+2)%4],this._toggleCornerMarkers(0,n)}this._shape.fire("editstart")},_onTouchMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent.touches[0]),i=this._map.layerPointToLatLng(e),n=t.target;return n===this._moveMarker?this._move(i):this._resize(i),this._shape.redraw(),!1},_onTouchEnd:function(t){var e=t.target;e.setOpacity(1),this.updateMarkers(),this._fireEdit()},_move:function(){},_resize:function(){}}),L.Edit=L.Edit||{},L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getBounds(),e=t.getCenter();this._moveMarker=this._createMarker(e,this.options.moveIcon)},_createResizeMarker:function(){var t=this._getCorners();this._resizeMarkers=[];for(var e=0,i=t.length;e<i;e++)this._resizeMarkers.push(this._createMarker(t[e],this.options.resizeIcon)),this._resizeMarkers[e]._cornerIndex=e},_onMarkerDragStart:function(t){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,t);var e=this._getCorners(),i=t.target,n=i._cornerIndex;this._oppositeCorner=e[(n+2)%4],this._toggleCornerMarkers(0,n)},_onMarkerDragEnd:function(t){var e,i,n=t.target;n===this._moveMarker&&(e=this._shape.getBounds(),i=e.getCenter(),n.setLatLng(i)),this._toggleCornerMarkers(1),this._repositionCornerMarkers(),L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,t)},_move:function(t){for(var e,i=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),n=this._shape.getBounds(),r=n.getCenter(),a=[],o=0,s=i.length;o<s;o++)e=[i[o].lat-r.lat,i[o].lng-r.lng],a.push([t.lat+e[0],t.lng+e[1]]);this._shape.setLatLngs(a),this._repositionCornerMarkers(),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})},_resize:function(t){var e;this._shape.setBounds(L.latLngBounds(t,this._oppositeCorner)),e=this._shape.getBounds(),this._moveMarker.setLatLng(e.getCenter()),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})},_getCorners:function(){var t=this._shape.getBounds(),e=t.getNorthWest(),i=t.getNorthEast(),n=t.getSouthEast(),r=t.getSouthWest();return[e,i,n,r]},_toggleCornerMarkers:function(t){for(var e=0,i=this._resizeMarkers.length;e<i;e++)this._resizeMarkers[e].setOpacity(t)},_repositionCornerMarkers:function(){for(var t=this._getCorners(),e=0,i=this._resizeMarkers.length;e<i;e++)this._resizeMarkers[e].setLatLng(t[e])}}),L.Rectangle.addInitHook(function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.Circle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getLatLng();this._moveMarker=this._createMarker(t,this.options.moveIcon)},_createResizeMarker:function(){var t=this._shape.getLatLng(),e=this._getResizeMarkerPoint(t);this._resizeMarkers=[],this._resizeMarkers.push(this._createMarker(e,this.options.resizeIcon))},_getResizeMarkerPoint:function(t){var e=this._shape._radius*Math.cos(Math.PI/4),i=this._map.project(t);return this._map.unproject([i.x+e,i.y-e])},_move:function(t){var e=this._getResizeMarkerPoint(t);this._resizeMarkers[0].setLatLng(e),this._shape.setLatLng(t),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})},_resize:function(t){var e=this._moveMarker.getLatLng(),i=e.distanceTo(t);this._shape.setRadius(i),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})}}),L.Circle.addInitHook(function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()})}),L.Map.mergeOptions({touchExtend:!0}),L.Map.TouchExtend=L.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){L.DomEvent.on(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.on(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.on(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.on(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.on(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.on(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.on(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.on(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.on(this._container,"touchleave",this._onTouchLeave,this))},removeHooks:function(){L.DomEvent.off(this._container,"touchstart",this._onTouchStart),L.DomEvent.off(this._container,"touchend",this._onTouchEnd),L.DomEvent.off(this._container,"touchmove",this._onTouchMove),this._detectIE()?(L.DomEvent.off(this._container,"MSPointerDowm",this._onTouchStart),L.DomEvent.off(this._container,"MSPointerUp",this._onTouchEnd),L.DomEvent.off(this._container,"MSPointerMove",this._onTouchMove),L.DomEvent.off(this._container,"MSPointerCancel",this._onTouchCancel)):(L.DomEvent.off(this._container,"touchcancel",this._onTouchCancel),L.DomEvent.off(this._container,"touchleave",this._onTouchLeave))},_touchEvent:function(t,e){var i={};if("undefined"!=typeof t.touches){if(!t.touches.length)return;i=t.touches[0]}else{if("touch"!==t.pointerType)return;if(i=t,!this._filterClick(t))return}var n=this._map.mouseEventToContainerPoint(i),r=this._map.mouseEventToLayerPoint(i),a=this._map.layerPointToLatLng(r);this._map.fire(e,{latlng:a,layerPoint:r,containerPoint:n,pageX:i.pageX,pageY:i.pageY,originalEvent:t})},_filterClick:function(t){var e=t.timeStamp||t.originalEvent.timeStamp,i=L.DomEvent._lastClick&&e-L.DomEvent._lastClick;return i&&i>100&&i<500||t.target._simulatedClick&&!t._simulated?(L.DomEvent.stop(t),!1):(L.DomEvent._lastClick=e,!0)},_onTouchStart:function(t){if(this._map._loaded){var e="touchstart";this._touchEvent(t,e)}},_onTouchEnd:function(t){if(this._map._loaded){var e="touchend";this._touchEvent(t,e)}},_onTouchCancel:function(t){if(this._map._loaded){var e="touchcancel";this._detectIE()&&(e="pointercancel"),this._touchEvent(t,e)}},_onTouchLeave:function(t){if(this._map._loaded){var e="touchleave";this._touchEvent(t,e)}},_onTouchMove:function(t){if(this._map._loaded){var e="touchmove";this._touchEvent(t,e)}},_detectIE:function(){var e=t.navigator.userAgent,i=e.indexOf("MSIE ");if(i>0)return parseInt(e.substring(i+5,e.indexOf(".",i)),10);var n=e.indexOf("Trident/");if(n>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10)}var a=e.indexOf("Edge/");return a>0&&parseInt(e.substring(a+5,e.indexOf(".",a)),10)}}),L.Map.addInitHook("addHandler","touchExtend",L.Map.TouchExtend),L.Marker.Touch=L.Marker.extend({_initInteraction:function(){return this.addInteractiveTarget?L.Marker.prototype._initInteraction.apply(this):this._initInteractionLegacy()},_initInteractionLegacy:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu","touchstart","touchend","touchmove"];this._detectIE?e.concat(["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"]):e.concat(["touchcancel"]),L.DomUtil.addClass(t,"leaflet-clickable"),L.DomEvent.on(t,"click",this._onMouseClick,this),L.DomEvent.on(t,"keypress",this._onKeyPress,this);for(var i=0;i<e.length;i++)L.DomEvent.on(t,e[i],this._fireMouseEvent,this);L.Handler.MarkerDrag&&(this.dragging=new L.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_detectIE:function(){var e=t.navigator.userAgent,i=e.indexOf("MSIE ");if(i>0)return parseInt(e.substring(i+5,e.indexOf(".",i)),10);var n=e.indexOf("Trident/");if(n>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10)}var a=e.indexOf("Edge/");return a>0&&parseInt(e.substring(a+5,e.indexOf(".",a)),10)}}),L.LatLngUtil={cloneLatLngs:function(t){for(var e=[],i=0,n=t.length;i<n;i++)Array.isArray(t[i])?e.push(L.LatLngUtil.cloneLatLngs(t[i])):e.push(this.cloneLatLng(t[i]));return e},cloneLatLng:function(t){return L.latLng(t.lat,t.lng)}},L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(t){var e,i,n=t.length,r=0,a=Math.PI/180;if(n>2){for(var o=0;o<n;o++)e=t[o],i=t[(o+1)%n],r+=(i.lng-e.lng)*a*(2+Math.sin(e.lat*a)+Math.sin(i.lat*a));r=6378137*r*6378137/2}return Math.abs(r)},readableArea:function(t,e){var i;return e?i=t>=1e4?(1e-4*t).toFixed(2)+" ha":t.toFixed(2)+" m&sup2;":(t/=.836127,i=t>=3097600?(t/3097600).toFixed(2)+" mi&sup2;":t>=4840?(t/4840).toFixed(2)+" acres":Math.ceil(t)+" yd&sup2;"),i},readableDistance:function(t,e,i){var n;if(e)n=t>1e3?(t/1e3).toFixed(2)+" km":Math.ceil(t)+" m";else if(t*=1.09361,t>1760)n=(t/1760).toFixed(2)+" miles";else{var r=" yd";i&&(t*=3,r=" ft"),n=Math.ceil(t)+r}return n}}),L.Util.extend(L.LineUtil,{segmentsIntersect:function(t,e,i,n){return this._checkCounterclockwise(t,i,n)!==this._checkCounterclockwise(e,i,n)&&this._checkCounterclockwise(t,e,i)!==this._checkCounterclockwise(t,e,n)},_checkCounterclockwise:function(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}}),L.Polyline.include({intersects:function(){var t,e,i,n=this._getProjectedPoints(),r=n?n.length:0;if(this._tooFewPointsForIntersection())return!1;for(t=r-1;t>=3;t--)if(e=n[t-1],i=n[t],this._lineSegmentsIntersectsRange(e,i,t-2))return!0;return!1},newLatLngIntersects:function(t,e){return!!this._map&&this.newPointIntersects(this._map.latLngToLayerPoint(t),e)},newPointIntersects:function(t,e){var i=this._getProjectedPoints(),n=i?i.length:0,r=i?i[n-1]:null,a=n-2;return!this._tooFewPointsForIntersection(1)&&this._lineSegmentsIntersectsRange(r,t,a,e?1:0)},_tooFewPointsForIntersection:function(t){var e=this._getProjectedPoints(),i=e?e.length:0;return i+=t||0,!e||i<=3},_lineSegmentsIntersectsRange:function(t,e,i,n){var r,a,o=this._getProjectedPoints();n=n||0;for(var s=i;s>n;s--)if(r=o[s-1],a=o[s],L.LineUtil.segmentsIntersect(t,e,r,a))return!0;return!1},_getProjectedPoints:function(){if(!this._defaultShape)return this._originalPoints;for(var t=[],e=this._defaultShape(),i=0;i<e.length;i++)t.push(this._map.latLngToLayerPoint(e[i]));return t}}),L.Polygon.include({intersects:function(){var t,e,i,n,r,a=this._getProjectedPoints();return!this._tooFewPointsForIntersection()&&(!!(t=L.Polyline.prototype.intersects.call(this))||(e=a.length,i=a[0],n=a[e-1],r=e-2,this._lineSegmentsIntersectsRange(n,i,r,1)))}}),L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(t){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");L.Control.prototype.initialize.call(this,t);var e;this._toolbars={},L.DrawToolbar&&this.options.draw&&(e=new L.DrawToolbar(this.options.draw),this._toolbars[L.DrawToolbar.TYPE]=e,this._toolbars[L.DrawToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.EditToolbar&&this.options.edit&&(e=new L.EditToolbar(this.options.edit),this._toolbars[L.EditToolbar.TYPE]=e,this._toolbars[L.EditToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.toolbar=this},onAdd:function(t){var e,i=L.DomUtil.create("div","leaflet-draw"),n=!1,r="leaflet-draw-toolbar-top";for(var a in this._toolbars)this._toolbars.hasOwnProperty(a)&&(e=this._toolbars[a].addToolbar(t),e&&(n||(L.DomUtil.hasClass(e,r)||L.DomUtil.addClass(e.childNodes[0],r),n=!0),i.appendChild(e)));return i},onRemove:function(){for(var t in this._toolbars)this._toolbars.hasOwnProperty(t)&&this._toolbars[t].removeToolbar()},setDrawingOptions:function(t){for(var e in this._toolbars)this._toolbars[e]instanceof L.DrawToolbar&&this._toolbars[e].setOptions(t)},_toolbarEnabled:function(t){var e=t.target;for(var i in this._toolbars)this._toolbars[i]!==e&&this._toolbars[i].disable()}}),L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1}),L.Map.addInitHook(function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))}),L.Toolbar=L.Class.extend({includes:[L.Mixin.Events],initialize:function(t){L.setOptions(this,t),this._modes={},this._actionButtons=[],this._activeMode=null},enabled:function(){return null!==this._activeMode},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(t){var e,i=L.DomUtil.create("div","leaflet-draw-section"),n=0,r=this._toolbarClass||"",a=this.getModeHandlers(t);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar"),this._map=t,e=0;e<a.length;e++)a[e].enabled&&this._initModeHandler(a[e].handler,this._toolbarContainer,n++,r,a[e].title);if(n)return this._lastButtonIndex=--n,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),i.appendChild(this._toolbarContainer),i.appendChild(this._actionsContainer),i},removeToolbar:function(){for(var t in this._modes)this._modes.hasOwnProperty(t)&&(this._disposeButton(this._modes[t].button,this._modes[t].handler.enable,this._modes[t].handler),this._modes[t].handler.disable(),this._modes[t].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};for(var e=0,i=this._actionButtons.length;e<i;e++)this._disposeButton(this._actionButtons[e].button,this._actionButtons[e].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(t,e,i,n,r){var a=t.type;this._modes[a]={},this._modes[a].handler=t,this._modes[a].button=this._createButton({type:a,title:r,className:n+"-"+a,container:e,callback:this._modes[a].handler.enable,context:this._modes[a].handler}),this._modes[a].buttonIndex=i,this._modes[a].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_createButton:function(t){var e=L.DomUtil.create("a",t.className||"",t.container);return e.href="#",t.text&&(e.innerHTML=t.text),t.title&&(e.title=t.title),L.DomEvent.on(e,"click",L.DomEvent.stopPropagation).on(e,"mousedown",L.DomEvent.stopPropagation).on(e,"dblclick",L.DomEvent.stopPropagation).on(e,"click",L.DomEvent.preventDefault).on(e,"click",t.callback,t.context),e},_disposeButton:function(t,e){L.DomEvent.off(t,"click",L.DomEvent.stopPropagation).off(t,"mousedown",L.DomEvent.stopPropagation).off(t,"dblclick",L.DomEvent.stopPropagation).off(t,"click",L.DomEvent.preventDefault).off(t,"click",e)},_handlerActivated:function(t){this.disable(),this._activeMode=this._modes[t.handler],L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar(),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(t){var e,i,n,r,a=this._actionsContainer,o=this.getActions(t),s=o.length;for(i=0,n=this._actionButtons.length;i<n;i++)this._disposeButton(this._actionButtons[i].button,this._actionButtons[i].callback);for(this._actionButtons=[];a.firstChild;)a.removeChild(a.firstChild);for(var l=0;l<s;l++)"enabled"in o[l]&&!o[l].enabled||(e=L.DomUtil.create("li","",a),r=this._createButton({title:o[l].title,text:o[l].text,container:e,callback:o[l].callback,context:o[l].context}),this._actionButtons.push({button:r,callback:o[l].callback}))},_showActionsToolbar:function(){var t=this._activeMode.buttonIndex,e=this._lastButtonIndex,i=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler),this._actionsContainer.style.top=i+"px",0===t&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),t===e&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block"},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom")}}),L.Draw=L.Draw||{},L.Draw.Tooltip=L.Class.extend({initialize:function(t){this._map=t,this._popupPane=t._panes.popupPane,this._container=t.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null,this._singleLineLabel=!1,this._map.on("mouseout",this._onMouseOut,this)},dispose:function(){this._map.off("mouseout",this._onMouseOut,this),this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(t){return this._container?(t.subtext=t.subtext||"",0!==t.subtext.length||this._singleLineLabel?t.subtext.length>0&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(t.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+t.subtext+"</span><br />":"")+"<span>"+t.text+"</span>",this):this},updatePosition:function(t){var e=this._map.latLngToLayerPoint(t),i=this._container;return this._container&&(i.style.visibility="inherit",L.DomUtil.setPosition(i,e)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this},_onMouseOut:function(){this._container&&(this._container.style.visibility="hidden")}}),L.DrawToolbar=L.Toolbar.extend({statics:{TYPE:"draw"},options:{polyline:{},polygon:{},rectangle:{},circle:{},marker:{}},initialize:function(t){for(var e in this.options)this.options.hasOwnProperty(e)&&t[e]&&(t[e]=L.extend({},this.options[e],t[e]));this._toolbarClass="leaflet-draw-draw",L.Toolbar.prototype.initialize.call(this,t)},getModeHandlers:function(t){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(t,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(t,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(t,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(t,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(t,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker}]},getActions:function(t){return[{enabled:t.completeShape,title:L.drawLocal.draw.toolbar.finish.title,text:L.drawLocal.draw.toolbar.finish.text,callback:t.completeShape,context:t},{enabled:t.deleteLastVertex,title:L.drawLocal.draw.toolbar.undo.title,text:L.drawLocal.draw.toolbar.undo.text,callback:t.deleteLastVertex,
context:t},{title:L.drawLocal.draw.toolbar.actions.title,text:L.drawLocal.draw.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(t){L.setOptions(this,t);for(var e in this._modes)this._modes.hasOwnProperty(e)&&t.hasOwnProperty(e)&&this._modes[e].handler.setOptions(t[e])}}),L.EditToolbar=L.Toolbar.extend({statics:{TYPE:"edit"},options:{edit:{selectedPathOptions:{dashArray:"10, 10",fill:!0,fillColor:"#fe57a1",fillOpacity:.1,maintainColor:!1}},remove:{},poly:null,featureGroup:null},initialize:function(t){t.edit&&("undefined"==typeof t.edit.selectedPathOptions&&(t.edit.selectedPathOptions=this.options.edit.selectedPathOptions),t.edit.selectedPathOptions=L.extend({},this.options.edit.selectedPathOptions,t.edit.selectedPathOptions)),t.remove&&(t.remove=L.extend({},this.options.remove,t.remove)),t.poly&&(t.poly=L.extend({},this.options.poly,t.poly)),this._toolbarClass="leaflet-draw-edit",L.Toolbar.prototype.initialize.call(this,t),this._selectedFeatureCount=0},getModeHandlers:function(t){var e=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(t,{featureGroup:e,selectedPathOptions:this.options.edit.selectedPathOptions,poly:this.options.poly}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(t,{featureGroup:e}),title:L.drawLocal.edit.toolbar.buttons.remove}]},getActions:function(){return[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}]},addToolbar:function(t){var e=L.Toolbar.prototype.addToolbar.call(this,t);return this._checkDisabled(),this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this),e},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this),L.Toolbar.prototype.removeToolbar.call(this)},disable:function(){this.enabled()&&(this._activeMode.handler.revertLayers(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save(),this._activeMode&&this._activeMode.handler.disable()},_checkDisabled:function(){var t,e=this.options.featureGroup,i=0!==e.getLayers().length;this.options.edit&&(t=this._modes[L.EditToolbar.Edit.TYPE].button,i?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",i?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled)),this.options.remove&&(t=this._modes[L.EditToolbar.Delete.TYPE].button,i?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",i?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled))}}),L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},includes:L.Mixin.Events,initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.setOptions(this,e),this._featureGroup=e.featureGroup,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={},this.type=L.EditToolbar.Edit.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.EDITSTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.EDITSTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}),t._editTooltip=this._tooltip,this._updateTooltip(),this._map.on("mousemove",this._onMouseMove,this).on("touchmove",this._onMouseMove,this).on("MSPointerMove",this._onMouseMove,this).on(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this).off("touchmove",this._onMouseMove,this).off("MSPointerMove",this._onMouseMove,this).off(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},revertLayers:function(){this._featureGroup.eachLayer(function(t){this._revertLayer(t)},this)},save:function(){var t=new L.LayerGroup;this._featureGroup.eachLayer(function(e){e.edited&&(t.addLayer(e),e.edited=!1)}),this._map.fire(L.Draw.Event.EDITED,{layers:t})},_backupLayer:function(t){var e=L.Util.stamp(t);this._uneditedLayerProps[e]||(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?this._uneditedLayerProps[e]={latlngs:L.LatLngUtil.cloneLatLngs(t.getLatLngs())}:t instanceof L.Circle?this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng()),radius:t.getRadius()}:t instanceof L.Marker&&(this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng())}))},_getTooltipText:function(){return{text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}},_updateTooltip:function(){this._tooltip.updateContent(this._getTooltipText())},_revertLayer:function(t){var e=L.Util.stamp(t);t.edited=!1,this._uneditedLayerProps.hasOwnProperty(e)&&(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?t.setLatLngs(this._uneditedLayerProps[e].latlngs):t instanceof L.Circle?(t.setLatLng(this._uneditedLayerProps[e].latlng),t.setRadius(this._uneditedLayerProps[e].radius)):t instanceof L.Marker&&t.setLatLng(this._uneditedLayerProps[e].latlng),t.fire("revert-edited",{layer:t}))},_enableLayerEdit:function(t){var e,i,n=t.layer||t.target||t;this._backupLayer(n),this.options.poly&&(i=L.Util.extend({},this.options.poly),n.options.poly=i),this.options.selectedPathOptions&&(e=L.Util.extend({},this.options.selectedPathOptions),e.maintainColor&&(e.color=n.options.color,e.fillColor=n.options.fillColor),n.options.original=L.extend({},n.options),n.options.editing=e),n instanceof L.Marker?(n.editing&&n.editing.enable(),n.dragging.enable(),n.on("dragend",this._onMarkerDragEnd).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onMarkerDragEnd,this).on("MSPointerUp",this._onMarkerDragEnd,this)):n.editing.enable()},_disableLayerEdit:function(t){var e=t.layer||t.target||t;e.edited=!1,e.editing&&e.editing.disable(),delete e.options.editing,delete e.options.original,this._selectedPathOptions&&(e instanceof L.Marker?this._toggleMarkerHighlight(e):(e.setStyle(e.options.previousOptions),delete e.options.previousOptions)),e instanceof L.Marker?(e.dragging.disable(),e.off("dragend",this._onMarkerDragEnd,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onMarkerDragEnd,this).off("MSPointerUp",this._onMarkerDragEnd,this)):e.editing.disable()},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_onMarkerDragEnd:function(t){var e=t.target;e.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:e})},_onTouchMove:function(t){var e=t.originalEvent.changedTouches[0],i=this._map.mouseEventToLayerPoint(e),n=this._map.layerPointToLatLng(i);t.target.setLatLng(n)},_hasAvailableLayers:function(){return 0!==this._featureGroup.getLayers().length}}),L.EditToolbar.Delete=L.Handler.extend({statics:{TYPE:"remove"},includes:L.Mixin.Events,initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.Util.setOptions(this,e),this._deletableLayers=this.options.featureGroup,!(this._deletableLayers instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DELETESTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DELETESTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.LayerGroup,this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.remove.tooltip.text}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._deletableLayers.eachLayer(this._disableLayerDelete,this),this._deletedLayers=null,this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._deletedLayers.eachLayer(function(t){this._deletableLayers.addLayer(t),t.fire("revert-deleted",{layer:t})},this)},save:function(){this._map.fire(L.Draw.Event.DELETED,{layers:this._deletedLayers})},_enableLayerDelete:function(t){var e=t.layer||t.target||t;e.on("click",this._removeLayer,this)},_disableLayerDelete:function(t){var e=t.layer||t.target||t;e.off("click",this._removeLayer,this),this._deletedLayers.removeLayer(e)},_removeLayer:function(t){var e=t.layer||t.target||t;this._deletableLayers.removeLayer(e),this._deletedLayers.addLayer(e),e.fire("deleted")},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_hasAvailableLayers:function(){return 0!==this._deletableLayers.getLayers().length}})}(window,document),L.Edit.Circle.include({_createResizeMarker:function(){var t=this._shape.getLatLng(),e=this._getResizeMarkerPoint(t);this._resizeMarkers=[];var i=this._createMarker(e,this.options.resizeIcon),n=this._shape.getRadius();i.bindTooltip(L.GeometryUtil.readableDistance(n,!0),{permanent:!0,direction:"top",offset:new L.Point(0,-2),className:"leaflet-resize-icon"}).openTooltip(),this._resizeMarkers.push(i)},_resize:function(t){var e=this._moveMarker.getLatLng(),i=e.distanceTo(t);this._shape.setRadius(i);var n=this._resizeMarkers[0].getTooltip();n&&n.setContent(L.GeometryUtil.readableDistance(i,!0)),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})},_getResizeMarkerPoint:function(t){var e=this._shape._radius*Math.cos(Math.PI/4),i=this._map.project(t);return this._map.unproject([i.x+e,i.y+e])}}),L.Draw=L.Draw||{},L.Draw.FeatureWord=L.Draw.Marker.extend({_fireCreatedEvent:function(){var t=new L.Marker.Touch(this._marker.getLatLng(),{icon:this.options.icon});this._map.fire(L.Draw.Event.FEATUREWORDCREATED,{layer:t,layerType:t.type})}}),L.Draw.Event.FEATUREWORDCREATED="draw:featurewordcreated",function(){L.Icon.Pulse=L.DivIcon.extend({options:{className:"",iconSize:[12,12],color:"red",animate:!0,heartbeat:1},initialize:function(t){L.setOptions(this,t);var e="lpi-"+(new Date).getTime()+"-"+Math.round(1e5*Math.random()),i=["background-color: "+this.options.color],n=["box-shadow: 0 0 6px 2px "+this.options.color,"animation: pulsate "+this.options.heartbeat+"s ease-out","animation-iteration-count: infinite","animation-delay: "+(this.options.heartbeat+.1)+"s"];this.options.animate||n.push("animation: none");var r=["."+e+"{"+i.join(";")+";}","."+e+":after{"+n.join(";")+";}"].join(""),a=document.createElement("style");a.styleSheet?a.styleSheet.cssText=r:a.appendChild(document.createTextNode(r)),document.getElementsByTagName("head")[0].appendChild(a),this.options.className=this.options.className+" leaflet-pulsing-icon "+e,L.DivIcon.prototype.initialize.call(this,t)}}),L.icon.pulse=function(t){return new L.Icon.Pulse(t)},L.Marker.Pulse=L.Marker.extend({initialize:function(t,e){e.icon=L.icon.pulse(e),L.Marker.prototype.initialize.call(this,t,e)}}),L.marker.pulse=function(t,e){return new L.Marker.Pulse(t,e)}}(window),function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define(i):e[t]=i()}("h337",this,function(){var t={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},e=function(){var e=function(t){this._coordinator={},this._data=[],this._radi=[],this._min=0,this._max=1,this._xField=t.xField||t.defaultXField,this._yField=t.yField||t.defaultYField,this._valueField=t.valueField||t.defaultValueField,t.radius&&(this._cfgRadius=t.radius)},i=t.defaultRadius;return e.prototype={_organiseData:function(t,e){var n=t[this._xField],r=t[this._yField],a=this._radi,o=this._data,s=this._max,l=this._min,d=t[this._valueField]||1,h=t.radius||this._cfgRadius||i;return o[n]||(o[n]=[],a[n]=[]),o[n][r]?o[n][r]+=d:(o[n][r]=d,a[n][r]=h),o[n][r]>s?(e?this.setDataMax(o[n][r]):this._max=o[n][r],!1):{x:n,y:r,value:d,radius:h,min:l,max:s}},_unOrganizeData:function(){var t=[],e=this._data,i=this._radi;for(var n in e)for(var r in e[n])t.push({x:n,y:r,radius:i[n][r],value:e[n][r]});return{min:this._min,max:this._max,data:t}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0)for(var t=arguments[0],e=t.length;e--;)this.addData.call(this,t[e]);else{var i=this._organiseData(arguments[0],!0);i&&this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[i]})}return this},setData:function(t){var e=t.data,i=e.length;this._data=[],this._radi=[];for(var n=0;n<i;n++)this._organiseData(e[n],!1);return this._max=t.max,this._min=t.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(t){return this._max=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(t){return this._min=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(t){this._coordinator=t},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},e}(),i=function(){function t(t){var i=t.container,n=this.shadowCanvas=document.createElement("canvas"),r=this.canvas=t.canvas||document.createElement("canvas"),a=(this._renderBoundaries=[1e4,1e4,0,0],getComputedStyle(t.container)||{});r.className="heatmap-canvas",this._width=r.width=n.width=t.width||+a.width.replace(/px/,""),this._height=r.height=n.height=t.height||+a.height.replace(/px/,""),this.shadowCtx=n.getContext("2d"),this.ctx=r.getContext("2d"),r.style.cssText=n.style.cssText="position:absolute;left:0;top:0;",i.style.position="relative",i.appendChild(r),this._palette=e(t),this._templates={},this._setStyles(t)}var e=function(t){var e=t.gradient||t.defaultGradient,i=document.createElement("canvas"),n=i.getContext("2d");i.width=256,i.height=1;var r=n.createLinearGradient(0,0,256,1);for(var a in e)r.addColorStop(a,e[a]);return n.fillStyle=r,n.fillRect(0,0,256,1),n.getImageData(0,0,256,1).data},i=function(t,e){var i=document.createElement("canvas"),n=i.getContext("2d"),r=t,a=t;if(i.width=i.height=2*t,1==e)n.beginPath(),n.arc(r,a,t,0,2*Math.PI,!1),n.fillStyle="rgba(0,0,0,1)",n.fill();else{var o=n.createRadialGradient(r,a,t*e,r,a,t);o.addColorStop(0,"rgba(0,0,0,1)"),o.addColorStop(1,"rgba(0,0,0,0)"),n.fillStyle=o,n.fillRect(0,0,2*t,2*t)}return i},n=function(t){for(var e=[],i=t.min,n=t.max,r=t.radi,t=t.data,a=Object.keys(t),o=a.length;o--;)for(var s=a[o],l=Object.keys(t[s]),d=l.length;d--;){var h=l[d],c=t[s][h],u=r[s][h];e.push({x:s,y:h,value:c,radius:u})}return{min:i,max:n,data:e}};return t.prototype={renderPartial:function(t){t.data.length>0&&(this._drawAlpha(t),this._colorize())},renderAll:function(t){this._clear(),t.data.length>0&&(this._drawAlpha(n(t)),this._colorize())},_updateGradient:function(t){this._palette=e(t)},updateConfig:function(t){t.gradient&&this._updateGradient(t),this._setStyles(t)},setDimensions:function(t,e){this._width=t,this._height=e,this.canvas.width=this.shadowCanvas.width=t,this.canvas.height=this.shadowCanvas.height=e},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(t){this._blur=0==t.blur?0:t.blur||t.defaultBlur,t.backgroundColor&&(this.canvas.style.backgroundColor=t.backgroundColor),this._width=this.canvas.width=this.shadowCanvas.width=t.width||this._width,this._height=this.canvas.height=this.shadowCanvas.height=t.height||this._height,this._opacity=255*(t.opacity||0),this._maxOpacity=255*(t.maxOpacity||t.defaultMaxOpacity),this._minOpacity=255*(t.minOpacity||t.defaultMinOpacity),this._useGradientOpacity=!!t.useGradientOpacity},_drawAlpha:function(t){for(var e=this._min=t.min,n=this._max=t.max,t=t.data||[],r=t.length,a=1-this._blur;r--;){var o,s=t[r],l=s.x,d=s.y,h=s.radius,c=Math.min(s.value,n),u=l-h,p=d-h,f=this.shadowCtx;this._templates[h]?o=this._templates[h]:this._templates[h]=o=i(h,a);var m=(c-e)/(n-e);f.globalAlpha=m<.01?.01:m,f.drawImage(o,u,p),u<this._renderBoundaries[0]&&(this._renderBoundaries[0]=u),p<this._renderBoundaries[1]&&(this._renderBoundaries[1]=p),u+2*h>this._renderBoundaries[2]&&(this._renderBoundaries[2]=u+2*h),p+2*h>this._renderBoundaries[3]&&(this._renderBoundaries[3]=p+2*h)}},_colorize:function(){var t=this._renderBoundaries[0],e=this._renderBoundaries[1],i=this._renderBoundaries[2]-t,n=this._renderBoundaries[3]-e,r=this._width,a=this._height,o=this._opacity,s=this._maxOpacity,l=this._minOpacity,d=this._useGradientOpacity;t<0&&(t=0),e<0&&(e=0),t+i>r&&(i=r-t),e+n>a&&(n=a-e);for(var h=this.shadowCtx.getImageData(t,e,i,n),c=h.data,u=c.length,p=this._palette,f=3;f<u;f+=4){var m=c[f],g=4*m;if(g){var _;_=o>0?o:m<s?m<l?l:m:s,c[f-3]=p[g],c[f-2]=p[g+1],c[f-1]=p[g+2],c[f]=d?p[g+3]:_}}h.data=c,this.ctx.putImageData(h,t,e),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(t){var e,i=this.shadowCtx,n=i.getImageData(t.x,t.y,1,1),r=n.data[3],a=this._max,o=this._min;return e=Math.abs(a-o)*(r/255)>>0},getDataURL:function(){return this.canvas.toDataURL()}},t}(),n=function(){var e=!1;return"canvas2d"===t.defaultRenderer&&(e=i),e}(),r={merge:function(){for(var t={},e=arguments.length,i=0;i<e;i++){var n=arguments[i];for(var r in n)t[r]=n[r]}return t}},a=function(){function i(){var i=this._config=r.merge(t,arguments[0]||{});if(this._coordinator=new a,i.plugin){var s=i.plugin;if(!t.plugins[s])throw new Error("Plugin '"+s+"' not found. Maybe it was not registered.");var l=t.plugins[s];this._renderer=new l.renderer(i),this._store=new l.store(i)}else this._renderer=new n(i),this._store=new e(i);o(this)}var a=function(){function t(){this.cStore={}}return t.prototype={on:function(t,e,i){var n=this.cStore;n[t]||(n[t]=[]),n[t].push(function(t){return e.call(i,t)})},emit:function(t,e){var i=this.cStore;if(i[t])for(var n=i[t].length,r=0;r<n;r++){var a=i[t][r];a(e)}}},t}(),o=function(t){var e=t._renderer,i=t._coordinator,n=t._store;i.on("renderpartial",e.renderPartial,e),i.on("renderall",e.renderAll,e),i.on("extremachange",function(e){t._config.onExtremaChange&&t._config.onExtremaChange({min:e.min,max:e.max,gradient:t._config.gradient||t._config.defaultGradient})}),n.setCoordinator(i)};return i.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(t){return this._config=r.merge(this._config,t),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(t){return this._store.getValueAt?this._store.getValueAt(t):this._renderer.getValueAt?this._renderer.getValueAt(t):null}},i}(),o={create:function(t){return new a(t)},register:function(e,i){t.plugins[e]=i}};return o}),function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define(i):e[t]=i()}("HeatmapOverlay",this,function(){"undefined"==typeof L.Layer&&(L.Layer=L.Class);var t=L.Layer.extend({initialize:function(t){this.cfg=t,this._el=L.DomUtil.create("div","leaflet-zoom-hide"),this._data=[],this._max=1,this._min=0,this.cfg.container=this._el},onAdd:function(t){var e=t.getSize(),i="undefined"!=typeof require?require("heatmap.js"):window.h337;this._map=t,this._width=e.x,this._height=e.y,this._el.style.width=e.x+"px",this._el.style.height=e.y+"px",this._el.style.position="absolute",this._origin=this._map.layerPointToLatLng(new L.Point(0,0)),t.getPanes().overlayPane.appendChild(this._el),this._heatmap||(this._heatmap=i.create(this.cfg)),t.on("moveend",this._reset,this),this._draw()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._el),t.off("moveend",this._reset,this)},_draw:function(){if(this._map){var e=this._map.getPanes().mapPane,i=e._leaflet_pos;this._el.style[t.CSS_TRANSFORM]="translate("+-Math.round(i.x)+"px,"+-Math.round(i.y)+"px)",this._update()}},_update:function(){var t,e,i,n={max:this._max,min:this._min,data:[]};if(t=this._map.getBounds(),e=this._map.getZoom(),i=Math.pow(2,e),0==this._data.length)return void(this._heatmap&&this._heatmap.setData(n));for(var r=[],a=this.cfg.scaleRadius?i:1,o=0,s=0,l=this.cfg.valueField,d=this._data.length;d--;){var h=this._data[d],c=h[l],u=h.latlng;if(t.contains(u)){o=Math.max(c,o),s=Math.min(c,s);var p=this._map.latLngToContainerPoint(u),f={x:Math.round(p.x),y:Math.round(p.y)};f[l]=c;var m;m=h.radius?h.radius*a:(this.cfg.radius||2)*a,f.radius=m,r.push(f)}}this.cfg.useLocalExtrema&&(n.max=o,n.min=s),n.data=r,this._heatmap.setData(n)},setData:function(t){this._max=t.max||this._max,this._min=t.min||this._min;for(var e=this.cfg.latField||"lat",i=this.cfg.lngField||"lng",n=this.cfg.valueField||"value",t=t.data,r=t.length,a=[];r--;){var o=t[r],s=new L.LatLng(o[e],o[i]),l={latlng:s};l[n]=o[n],o.radius&&(l.radius=o.radius),a.push(l)}this._data=a,this._draw()},addData:function(t){if(t.length>0)for(var e=t.length;e--;)this.addData(t[e]);else{var i=this.cfg.latField||"lat",n=this.cfg.lngField||"lng",r=this.cfg.valueField||"value",a=t,o=new L.LatLng(a[i],a[n]),s={latlng:o};s[r]=a[r],this._max=Math.max(this._max,s[r]),this._min=Math.min(this._min,s[r]),a.radius&&(s.radius=a.radius),this._data.push(s),this._draw()}},_reset:function(){this._origin=this._map.layerPointToLatLng(new L.Point(0,0));var t=this._map.getSize();this._width===t.x&&this._height===t.y||(this._width=t.x,this._height=t.y,this._el.style.width=this._width+"px",this._el.style.height=this._height+"px",this._heatmap._renderer.setDimensions(this._width,this._height)),this._draw()}});return t.CSS_TRANSFORM=function(){for(var t=document.createElement("div"),e=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],i=0;i<e.length;i++){var n=e[i];if(void 0!==t.style[n])return n}return e[0]}(),t}),function(t,e){"function"==typeof define&&define.amd?define(["leaflet"],function(i){t(i,e.toGeoJSON)}):"object"==typeof exports?module.exports=function(i){return void 0===i&&"undefined"!=typeof e&&(i=require("leaflet")),t(i),i}:"undefined"!=typeof e&&e.L&&t(e.L)}(function(t){t.Polyline.Measure=t.Draw.Polyline.extend({options:{touchIcon:new t.DivIcon({iconSize:new t.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"})},addHooks:function(){t.Draw.Polyline.prototype.addHooks.call(this),this.options.shapeOptions.color="#FB7E42",this.options.shapeOptions.opacity=.8,this.options.shapeOptions.weight=2,this._map&&(this._markerGroup=new t.LayerGroup,this._map.addLayer(this._markerGroup),this._nodeGroup=new t.FeatureGroup,this._map.addLayer(this._nodeGroup),this._markers=[],this._map.on("click",this._onClick,this),this._startShape())},removeHooks:function(){t.Draw.Polyline.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._map.off("pointermove",this._onMouseMove,this).off("mousemove",this._onMouseMove,this).off("click",this._onClick,this),this._clearGuides(),this._container.style.cursor="",this._removeShape()},_startShape:function(){this._drawing=!0,this._nodeGroup.clearLayers(),this._poly=new t.Polyline([],this.options.shapeOptions),this._poly._onClick=function(){},this._container.style.cursor="crosshair",this._updateTooltip(),this._map.on("pointermove",this._onMouseMove,this).on("mousemove",this._onMouseMove,this)},_finishShape:function(e){var i=new t.Polyline(this._poly.getLatLngs(),this._poly.options),n=new t.DivIcon({html:"x",iconAnchor:[26,8],className:"measure-close"}),r=new t.Marker(e.latlng,{icon:n});r.on("click",function(){i.remove()});var a=this._nodeGroup.getLayers()[this._nodeGroup.getLayers().length-1],o=a.getTooltip().getContent(),s="\u516c\u91cc";o.indexOf("\u7c73")>=0&&(s="\u7c73");var l="\u603b\u957f\uff1a<span class='leaflet-measure-total'>"+o.split(" ")[0]+"</span>"+s;a.getTooltip().setContent(l),this._nodeGroup.addLayer(r),this._drawing=!1,this._cleanUpShape(),this._clearGuides(),this._updateTooltip(),this._map.off("pointermove",this._onMouseMove,this).off("mousemove",this._onMouseMove,this),this._container.style.cursor="",i._nodeGroup=this._nodeGroup,i.addTo(this._map),i.on("remove",function(){i._nodeGroup.clearLayers()}),$(".measure-close").css({width:"auto",height:"auto"}),this.disable()},_cancelDrawing:function(e){t.Draw.Polyline.prototype._cancelDrawing.call(this,e),this._nodeGroup.clearLayers()},addVertex:function(e,i){this._markers.length>0&&this._markers[this._markers.length-1].remove(),t.Draw.Polyline.prototype.addVertex.call(this,e,i);var n=this._markers.length>1?this._getMeasurementString():"\u8d77\u70b9";n.indexOf("km")>=0?n=n.split(" ")[0]+" \u516c\u91cc":n.indexOf("m")>=0&&(n=n.split(" ")[0]+" \u7c73"),this._addMeasureNode(e,n)},_addMeasureNode:function(e,i){var n=new t.CircleMarker(e,{radius:4,color:"#ff0000",fillColor:"#fefefe",weight:2,fillOpacity:1});this._nodeGroup.addLayer(n),n.bindTooltip(i,{permanent:!0,direction:"right",offset:new t.Point(2,0),className:"leaflet-measure-icon"}).openTooltip()},_removeShape:function(){this._poly&&(this._map.removeLayer(this._poly),delete this._poly,this._markers.splice(0),this._markerGroup.clearLayers())},_onClick:function(){this._drawing||(this._removeShape(),this._startShape())},_getTooltipText:function(){var e,i,n=this.options.showLength;return 0===this._markers.length?e={text:t.drawLocal.measure.handlers.polyline.tooltip.start}:(i=n?this._getMeasurementString():"",e=1===this._markers.length?{text:t.drawLocal.measure.handlers.polyline.tooltip.cont,subtext:i}:{text:t.drawLocal.measure.handlers.polyline.tooltip.end,subtext:i}),this._drawing||(e.text=""),e}}),t.Control.MeasureControl=t.Control.extend({statics:{TITLE:"\u8ddd\u79bb\u91cf\u7b97"},options:{position:"topleft",handler:{}},toggle:function(){this.handler.enabled()?this.handler.disable.call(this.handler):this.handler.enable.call(this.handler)},onAdd:function(e){var i=null,n="leaflet-control-draw";return this._container=t.DomUtil.create("div","leaflet-bar"),this.handler=new t.Polyline.Measure(e,this.options.handler),this.handler.on("enabled",function(){this.enabled=!0,t.DomUtil.addClass(this._container,"enabled")},this),this.handler.on("disabled",function(){delete this.enabled,t.DomUtil.removeClass(this._container,"enabled")},this),i=t.DomUtil.create("a",n+"-measure",this._container),i.href="#",i.title=t.Control.MeasureControl.TITLE,t.DomEvent.addListener(i,"click",t.DomEvent.stopPropagation).addListener(i,"click",t.DomEvent.preventDefault).addListener(i,"click",this.toggle,this),this._container}}),t.drawLocal.measure={handlers:{polyline:{error:"<strong>\u9519\u8bef:</strong> \u56fe\u5f62\u8fb9\u754c\u4e0d\u80fd\u4ea4\u53c9\uff01",tooltip:{start:"\u5355\u51fb\u786e\u5b9a\u8d77\u70b9",cont:"\u5355\u51fb\u786e\u5b9a\u5730\u70b9\uff0c\u53cc\u51fb\u7ed3\u675f",end:"\u5355\u51fb\u786e\u5b9a\u5730\u70b9\uff0c\u53cc\u51fb\u7ed3\u675f"}}}},t.Map.mergeOptions({measureControl:!1}),t.Map.addInitHook(function(){this.options.measureControl&&(this.measureControl=t.Control.measureControl().addTo(this))}),t.Control.measureControl=function(e){return new t.Control.MeasureControl(e)}},window);var PolylineUtil=window.PolylineUtil=PolylineUtil||{};!function(){"use strict";var t=function(t){return t="number"==typeof t?{precision:t}:t||{},t.precision=t.precision||5,t.factor=t.factor||Math.pow(10,t.precision),t.dimension=t.dimension||2,t};PolylineUtil={encode:function(e,i){i=t(i);for(var n=[],r=0,a=e.length;r<a;++r){var o=e[r];if(2===i.dimension)n.push(o.lat||o[0]),n.push(o.lng||o[1]);else for(var s=0;s<i.dimension;++s)n.push(o[s])}return this.encodeDeltas(n,i)},decode:function(e,i){i=t(i);for(var n=this.decodeDeltas(e,i),r=[],a=0,o=n.length;a+(i.dimension-1)<o;){for(var s=[],l=0;l<i.dimension;++l)s.push(n[a++]);r.push(s)}return r},encodeDeltas:function(e,i){i=t(i);for(var n=[],r=0,a=e.length;r<a;)for(var o=0;o<i.dimension;++o,++r){var s=e[r],l=s-(n[o]||0);n[o]=s,e[r]=l}return this.encodeFloats(e,i)},decodeDeltas:function(e,i){i=t(i);for(var n=[],r=this.decodeFloats(e,i),a=0,o=r.length;a<o;)for(var s=0;s<i.dimension;++s,++a)r[a]=Math.round((n[s]=r[a]+(n[s]||0))*i.factor)/i.factor;return r},encodeFloats:function(e,i){i=t(i);for(var n=0,r=e.length;n<r;++n)e[n]=Math.round(e[n]*i.factor);return this.encodeSignedIntegers(e)},decodeFloats:function(e,i){i=t(i);for(var n=this.decodeSignedIntegers(e),r=0,a=n.length;r<a;++r)n[r]/=i.factor;return n},encodeSignedIntegers:function(t){for(var e=0,i=t.length;e<i;++e){var n=t[e];t[e]=n<0?~(n<<1):n<<1}return this.encodeUnsignedIntegers(t)},decodeSignedIntegers:function(t){for(var e=this.decodeUnsignedIntegers(t),i=0,n=e.length;i<n;++i){var r=e[i];e[i]=1&r?~(r>>1):r>>1}return e},encodeUnsignedIntegers:function(t){for(var e="",i=0,n=t.length;i<n;++i)e+=this.encodeUnsignedInteger(t[i]);return e},decodeUnsignedIntegers:function(t){for(var e=[],i=0,n=0,r=0,a=t.length;r<a;++r){var o=t.charCodeAt(r)-63;i|=(31&o)<<n,o<32?(e.push(i),i=0,n=0):n+=5}return e},encodeSignedInteger:function(t){return t=t<0?~(t<<1):t<<1,this.encodeUnsignedInteger(t)},encodeUnsignedInteger:function(t){for(var e,i="";t>=32;)e=(32|31&t)+63,i+=String.fromCharCode(e),t>>=5;return e=t+63,i+=String.fromCharCode(e)}}}(),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){function e(t){return s.raw?t:encodeURIComponent(t)}function i(t){return s.raw?t:decodeURIComponent(t)}function n(t){return e(s.json?JSON.stringify(t):String(t))}function r(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(o," ")),s.json?JSON.parse(t):t}catch(t){}}function a(e,i){var n=s.raw?e:r(e);return t.isFunction(i)?i(n):n}var o=/\+/g,s=t.cookie=function(r,o,l){if(void 0!==o&&!t.isFunction(o)){if(l=t.extend({},s.defaults,l),"number"==typeof l.expires){var d=l.expires,h=l.expires=new Date;h.setTime(+h+864e5*d)}return document.cookie=[e(r),"=",n(o),l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join("")}for(var c=r?void 0:{},u=document.cookie?document.cookie.split("; "):[],p=0,f=u.length;p<f;p++){var m=u[p].split("="),g=i(m.shift()),_=m.join("=");if(r&&r===g){c=a(_,o);break}r||void 0===(_=a(_))||(c[g]=_)}return c};s.defaults={},t.removeCookie=function(e,i){return void 0!==t.cookie(e)&&(t.cookie(e,"",t.extend({},i,{expires:-1})),!t.cookie(e))}}),function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define(i):e[t]=i()}("ReplyPlugin",window,function(){"use strict";var t={repliesDetails:""},e="",i="",n=!1,r="",a=null,o=function(t,a,o,s){
if(r=t,i=a,e=o,n)s&&s();else{var l=["reply_analysis_details","reply_template_settings"];$.when($.lazyGetTemplate(l)).done(function(){$.views.settings.allowCode=!0,d(t),n=!0,s&&s()})}},s=function(){n=!1},l=function(){$("#"+r).show(),$("a[href='#replyOverview']").trigger("click")},d=function(t){var e="<div id='"+t+"' class='slider-bar' style='display:none;'>";e+=m(),e+="</div>",$("#cooperatePanel").after(e);var n=$("#"+t);$(".reply-details-panel").height(n.height()-116),n.width(window.innerWidth-56),$("#"+t+' a[data-toggle="tab"]').on("shown.bs.tab",function(t){$("#"+r).is(":visible")&&"#replyOverview"==$(t.target).attr("href")&&0==$(".reply-analysis-panel").length&&L()});var o=moment().subtract(365,"days").format("YYYY-MM-DD"),s=moment().startOf("month").format("YYYY-MM-DD"),l=moment().format("YYYY-MM-DD");$("#startTime").datepicker({minDate:o,maxDate:l}).val(s),$("#endTime").datepicker({minDate:o,maxDate:l}).val(l),$(".today").unbind().click(function(){$("#startTime").val(l),$("#endTime").val(l)}),$(".seven-day").unbind().click(function(){var t=moment().subtract(6,"days").format("YYYY-MM-DD");$("#startTime").val(t),$("#endTime").val(l)}),$(".current-month").unbind().click(function(){$("#startTime").val(s);var t=moment().endOf("month").format("YYYY-MM-DD");$("#endTime").val(t)}),$(".last-month").unbind().click(function(){var t=moment().subtract(1,"month"),e=t.startOf("month").format("YYYY-MM-DD"),i=t.endOf("month").format("YYYY-MM-DD");$("#startTime").val(e),$("#endTime").val(i)}),$("a[href='#replyCount']").unbind().click(function(){S()}),i.reply_templates&&i.reply_templates[0]&&($(".reply-template").first().addClass("reply-template-active"),_(i.reply_templates[0].id)),$("#start_datepicker").datepicker().val(l).on("input change",function(){L()}),$("#end_datepicker").datepicker().val(l).on("input change",function(){L()}),$("#reply_details_layers").change(function(){L()}),$("#reply_details_templates").change(function(){L()}),$("#template_settings").show(),$(".reply-template").unbind().click(function(){$(".reply-template").removeClass("reply-template-active");var t=$(this).attr("template-id");t&&($(this).addClass("reply-template-active"),_(t))}),$("#template_has_geo").click(function(){$(this).is(":checked")?$(".is-show-geo").show():$(".is-show-geo").hide()}),$("#default_reply_template").unbind().click(function(){var t={},e=$(".reply-template-active").attr("template-id");t.template_id=e,t.mid=mid,MapUtils.ajax2server(reply_template_default_url,"POST",t,function(t){t.template?(ToolBar._map.default_template_id=t.template.id,k(t.template),_(t.template.id),PromptInfo.xcConfirm("\u5e94\u7528\u9996\u9009\u6a21\u677f\u6210\u529f",PromptInfo.xcConfirm.typeEnum.info)):PromptInfo.xcConfirm("\u5e94\u7528\u9996\u9009\u6a21\u677f\u5931\u8d25",PromptInfo.xcConfirm.typeEnum.info)},function(t){var e="\u5e94\u7528\u9996\u9009\u6a21\u677f\u5931\u8d25";t&&t.msg&&(e=t.msg),PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.error)})}),$("#new_reply_template").unbind().click(function(){return 4==$(".reply-template").length?void PromptInfo.xcConfirm("\u6a21\u7248\u8d85\u51fa\u4e0a\u9650\uff0c\u4e00\u526f\u5730\u56fe\u6700\u591a4\u4e2a\u6a21\u677f",PromptInfo.xcConfirm.typeEnum.info):($(".reply-template-active").removeClass("reply-template-active"),void _(null))}),$("#create_reply_template").unbind().click(function(){var t={};if(t.mid=mid,t.name=$("#template_name").val().trim(),$("#template_name").val(t.name),t.name.length<=1||t.name.length>6)return void PromptInfo.xcConfirm("\u6a21\u677f\u6807\u9898\u957f\u5ea6\u8981\u6c42\u57282\u52306\u4e2a\u5b57\u7b26\u4e4b\u95f4",PromptInfo.xcConfirm.typeEnum.error,{onOk:function(){$("#template_name").focus()}});t.has_img=!0,t.has_geo=$("input[name=template_has_geo]").is(":checked"),t.geo_tolerance=$("#template_geo_tolerance").val().trim(),t.editable=$("input[name=template_editable]").is(":checked"),t.fields=[];for(var e=$(".template-field"),i=$(".template-field-type"),n=[],r=0;r<e.length;r++){var a=$(e[r]),o=a.val();o=o.trim(),a.val(o);var s=y(o,n);if(s)return void PromptInfo.xcConfirm(s,PromptInfo.xcConfirm.typeEnum.error,{onOk:function(){a.focus()}});n.push(o);var l=MapUtils.TemplateFieldType.STRING;$(i[r]).is(":checked")&&(l=MapUtils.TemplateFieldType.NUMERIC),t.fields.push({field:o,field_type:l})}t.fields=JSON.stringify(t.fields),MapUtils.ajax2server(reply_template_create_url,"POST",t,function(t){t.template?(w(t.template),_(t.template.id),$("#reply_details_templates").append('<option value="'+t.template.id+'">'+t.template.name+"</option>"),PromptInfo.xcConfirm("\u65b0\u589e\u52a8\u6001\u6a21\u677f\u6210\u529f",PromptInfo.xcConfirm.typeEnum.info)):PromptInfo.xcConfirm("\u65b0\u589e\u52a8\u6001\u6a21\u677f\u5931\u8d25",PromptInfo.xcConfirm.typeEnum.error)},function(t){var e="\u65b0\u589e\u52a8\u6001\u6a21\u677f\u5931\u8d25";t&&t.msg&&(e=t.msg),PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.error)})}),$("#delete_reply_template").unbind().click(function(){return i.reply_templates.length<=1?(PromptInfo.xcConfirm("\u4e00\u4e2a\u5730\u56fe\u81f3\u5c11\u8981\u6709\u4e00\u4e2a\u52a8\u6001\u6a21\u677f",PromptInfo.xcConfirm.typeEnum.warning),!1):void PromptInfo.xcConfirm("\u5220\u9664\u6a21\u677f\u540e\uff0c\u5bf9\u5e94\u52a8\u6001\u5185\u5bb9\u5c06\u88ab\u5220\u9664\uff0c\u4e0d\u53ef\u6062\u590d\uff01\u786e\u5b9a\u5220\u9664\u6a21\u677f\uff1f",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){var t=$(".reply-template-active").attr("template-id");h(t)}})}),$("#save_reply_template").unbind().click(function(){var t={},e=$(".reply-template-active").attr("template-id");if(t.template_id=e,t.mid=mid,t.name=$("#template_name").val().trim(),$("#template_name").val(t.name),t.name.length<=1||t.name.length>6)return void PromptInfo.xcConfirm("\u6a21\u677f\u6807\u9898\u957f\u5ea6\u8981\u6c42\u57282\u52306\u4e2a\u5b57\u7b26\u4e4b\u95f4",PromptInfo.xcConfirm.typeEnum.error,{onOk:function(){$("#template_name").focus()}});if($("#template_has_geo").is(":checked")){if(0==$("#template_geo_tolerance").val().length)return void PromptInfo.xcConfirm("\u504f\u5dee\u8303\u56f4\u4e0d\u80fd\u4e3a\u7a7a",PromptInfo.xcConfirm.typeEnum.error,{onOk:function(){$("#template_geo_tolerance").focus()}});if(!$.isNumeric($("#template_geo_tolerance").val()))return void PromptInfo.xcConfirm("\u504f\u5dee\u8303\u56f4\u53ea\u80fd\u662f\u6570\u503c\u7c7b\u578b",PromptInfo.xcConfirm.typeEnum.error,{onOk:function(){$("#template_geo_tolerance").focus()}})}t.has_img=!0,t.has_geo=$("input[name=template_has_geo]").is(":checked"),t.geo_tolerance=$("#template_geo_tolerance").val().trim(),t.editable=$("input[name=template_editable]").is(":checked"),t.fields=[];for(var i=$(".template-field"),n=$(".template-field-type"),r=[],a=0;a<i.length;a++){var o=$(i[a]),s=o.attr("data-field-id"),l=o.val();l=l.trim(),o.val(l);var d=y(l,r);if(d)return void PromptInfo.xcConfirm(d,PromptInfo.xcConfirm.typeEnum.error,{onOk:function(){o.focus()}});r.push(l);var h=MapUtils.TemplateFieldType.STRING;$(n[a]).is(":checked")&&(h=MapUtils.TemplateFieldType.NUMERIC),t.fields.push({id:s,field:l,field_type:h})}t.fields=JSON.stringify(t.fields),PromptInfo.xcConfirm('"\u4ec5\u53ef\u8f93\u5165\u6570\u503c\u5185\u5bb9"\u7684\u52fe\u9009\u72b6\u6001\u5728\u4fdd\u5b58\u540e\u65e0\u6cd5\u66f4\u6539\uff01\u786e\u5b9a\u4fdd\u5b58\u6a21\u677f\uff1f',PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){g(t)}}),$(".xcConfirm .popBox .txtBox p").css("margin-top","0")}),$(".template-field-plus").unbind().click(function(){$("#template_field_list").append(v()),MapUtils.reloadTooltip()}),$("#template_field_list").unbind().click(function(t){$(t.target).hasClass("template-field-minus")&&(a=$(t.target),$(".template-field").length>1?(PromptInfo.xcConfirm("\u5220\u9664\u5b57\u6bb5\u540e\uff0c\u5bf9\u5e94\u52a8\u6001\u5185\u5bb9\u5c06\u88ab\u5220\u9664\uff0c\u4e0d\u53ef\u6062\u590d\uff01\u786e\u8ba4\u5220\u9664\u5b57\u6bb5\uff1f",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){if($(".bigIcon").next().removeAttr("style"),a){var t=a.attr("data-field-id");c(t)}}}),$(".bigIcon").next().css("margin-top","0")):PromptInfo.xcConfirm("\u81f3\u5c11\u6709\u4e00\u4e2a\u5b57\u6bb5",PromptInfo.xcConfirm.typeEnum.error))}),$("#begin_statistic").unbind().click(function(){var t={};t.mid=mid,t.marker_layer_id=$("#select_reply_marker_layer").val(),t.template_id=$("#select_reply_template").val(),t.schema=$("#select_analysis_way").val(),t.method=$("#select_count_way").val(),t.start_date=$("#startTime").val(),t.end_date=$("#endTime").val(),$("#statistic-result").empty(),MapUtils.ajax2server(reply_analysis_url,"GET",t,function(t){400==t.status?PromptInfo.xcConfirm(t.msg,PromptInfo.xcConfirm.typeEnum.error):p(t)},function(t){var e="\u52a8\u6001\u7edf\u8ba1\u5931\u8d25";t.responseJSON.msg&&(e=t.responseJSON.msg),PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.error)})}),MapUtils.reloadTooltip(),setTimeout(function(){$("a[href='#replyTemplate']").trigger("click")},5)},h=function(t){var e={};e.template_id=t,e.mid=mid,MapUtils.ajax2server(reply_template_destroy_url,"DELETE",e,function(e){if(404==e.status)PromptInfo.xcConfirm(e.msg,PromptInfo.xcConfirm.typeEnum.error);else{x(t),$("#reply_details_templates option[value="+t+"]").remove();var n=null;e.default_template_id?(i.default_template_id=e.default_template_id,n=e.default_template_id):i.reply_templates[0]&&(n=i.reply_templates[0].id),_(n),$(".reply-template-active").remove(),$(".reply-template").first().addClass("reply-template-active"),PromptInfo.xcConfirm("\u5220\u9664\u52a8\u6001\u6a21\u677f\u6210\u529f",PromptInfo.xcConfirm.typeEnum.info)}},function(t){var e="\u5220\u9664\u52a8\u6001\u6a21\u677f\u5931\u8d25";t&&t.msg&&(e=t.msg),PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.error)})},c=function(t){if(t){var e=$(".reply-template-active").attr("template-id"),i={};i.id=t,i.mid=mid,i.template_id=e,MapUtils.ajax2server(reply_destroy_field_url,"DELETE",i,function(){u();for(var i=b(e),n=0;n<i.fields.length;n++)if(i.fields[n].id==t){i.fields.splice(n,1);break}})}else u();MapUtils.reloadTooltip()},u=function(){a&&(a.parent().remove(),a=null)},p=function(t){if(0==t.results.length)return void PromptInfo.xcConfirm("\u6682\u65e0\u7edf\u8ba1\u6570\u636e",PromptInfo.xcConfirm.typeEnum.info);$("#statistic-result").css("width",window.innerWidth-56-32).css("height",window.innerHeight-360);for(var e=[],i=[],n=0;n<t.fields.length;n++){var r=t.fields[n],a={name:r,type:"bar",data:[]};i.push(a)}for(var o=0;o<t.results.length;o++){var s=t.results[o];s.type="bar",e.push(s.name);for(var l=0;l<t.results[o].data.length;l++)i[l].data.push(t.results[o].data[l])}var d={title:{text:""},tooltip:{trigger:"item",axisPointer:{type:"shadow"}},legend:{data:t.fields},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:e}],yAxis:[{type:"value"}],series:i},h=echarts.init(document.getElementById("statistic-result"));h.setOption(d);var c="<p class='dt-hidden dt-pos-a' style='bottom:0;right:0'>";c+="<a href='###' data-url='"+t.url+"' taget='_blank' class='dt-mar12l pull-right reply-analysis-download'>\u4e0b\u8f7d\u660e\u7ec6</a>",c+="<a href='###' class='pull-right reply-analysis-details-btn'>\u67e5\u770b\u660e\u7ec6</a>",c+="</p>",$("#statistic-result").append(c),$(".reply-analysis-download").unbind().click(function(){var t=$(this).attr("data-url");MapUtils.download(t)});var u=f(t);$("#markerReplyPanel").append(u),$(".reply-analysis-details").height($("#mapContainer").height()-30),$(".reply-analysis-details-btn").unbind().click(function(){$(".reply-analysis-details-panel").removeClass("dt-none"),$(".reply-analysis-details-panel").animate({right:"0"},"slow")}),$(".close-reply-analysis-details").unbind().click(function(){$(".reply-analysis-details-panel").animate({right:"-100%"},"slow",function(){$(".reply-analysis-details-panel").addClass("dt-none")})})},f=function(t){$.views.settings.allowCode=!0;var e={url:t.url,names:t.fields,analysis:t.results},i=$.templates.reply_analysis_details.render(e);return i},m=function(){var t=MarkerUtils.getMarkerLayers(),e={templates:i.reply_templates,default_template_id:i.default_template_id,marker_layers:t};return $.templates.reply_template_settings.render(e)},g=function(t){MapUtils.ajax2server(reply_template_update_url,"PUT",t,function(t){t.template?(k(t.template),_(t.template.id),$("#reply_details_templates option[value="+t.template.id+"]").text(t.template.name),PromptInfo.xcConfirm("\u4fdd\u5b58\u52a8\u6001\u6a21\u677f\u6210\u529f",PromptInfo.xcConfirm.typeEnum.info)):PromptInfo.xcConfirm("\u4fdd\u5b58\u52a8\u6001\u6a21\u677f\u5931\u8d25",PromptInfo.xcConfirm.typeEnum.info)},function(t){var e="\u4fdd\u5b58\u52a8\u6001\u6a21\u677f\u5931\u8d25";t&&t.msg&&(e=t.msg),PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.error)})},_=function(t){var e=null;if(t&&(e=b(t)),e){$("#template_name").val(e.name);for(var n=e.fields,r="",a=0;a<n.length;a++)r+=v(n[a]);$("#template_field_list").empty().append(r),e.has_img?$("#template_has_img").prop("checked",e.has_img):$("#template_has_img").removeProp("checked"),e.has_geo?($("#template_has_geo").prop("checked",e.has_geo),$(".is-show-geo").show()):($("#template_has_geo").removeProp("checked"),$(".is-show-geo").hide()),e.editable?$("#template_editable").prop("checked",e.editable):$("#template_editable").removeProp("checked"),$("#template_geo_tolerance").val(e.geo_tolerance),$("#create_reply_template").hide(),$("#default_reply_template").show(),$("#save_reply_template").show(),e.id==i.default_template_id?$("#default_reply_template").attr("disabled",!0):$("#default_reply_template").attr("disabled",!1),i.reply_templates.length<=1?$("#delete_reply_template").hide():$("#delete_reply_template").show(),$(".template-field-type").attr("disabled",!0)}else $("#template_name").val(""),$("#template_field_list").empty().append(v()),$("#template_has_img").removeProp("checked"),$("#template_has_geo").removeProp("checked"),$("#template_editable").removeProp("checked"),$("#template_geo_tolerance").val(100),$("#create_reply_template").show(),$("#save_reply_template").hide(),$("#default_reply_template").hide(),$("#delete_reply_template").hide(),$(".template-field-type").removeAttr("disabled");$("#template_settings").show()},y=function(t,e){var i=null;return t.length<2||t.length>16?i="\u5b57\u6bb5\u957f\u5ea6\u8981\u6c42\u57282\u523016\u4e2a\u5b57\u7b26\u4e4b\u95f4":null!=t.match(/((?=[\x21-\x7e]+)[^A-Za-z0-9.])/)?i="\u5b57\u6bb5\u4e0d\u80fd\u5305\u542b\u7279\u6b8a\u5b57\u7b26":e&&e.indexOf(t)>-1&&(i="\u5b57\u6bb5\u4e0d\u80fd\u91cd\u590d"),i},v=function(t){var e="",i="",n=MapUtils.TemplateFieldType.STRING;"undefined"!=typeof t&&null!=t&&(e=t.id,i=t.field,n=t.field_type);var r='<div class="dt-mar12t dt-mar16x dt-hidden color75 ">';return r+='<input type="text" class="form-control template-field dt-w50per" data-field-id="'+e+'" value="'+i+'" />',r+=n==MapUtils.TemplateFieldType.NUMERIC?'<input type="checkbox" class="template-field-type dt-middle" style="margin: 0 6px;" checked>\u4ec5\u53ef\u8f93\u5165\u6570\u503c\u5185\u5bb9</input>':'<input type="checkbox" class="template-field-type dt-middle" style="margin: 0 6px;">\u4ec5\u53ef\u8f93\u5165\u6570\u503c\u5185\u5bb9</input>',r+='<span class="glyphicon glyphicon-trash color91 dt-pointer template-field-minus pull-right dt-mar2r dt-mar12t" data-container="body" data-placement="bottom" data-toggle="tooltip" title="\u5220\u9664\u5b57\u6bb5" data-field-id="'+e+'"></span>',r+="</div>"},b=function(t){if(t)for(var e=0;e<i.reply_templates.length;e++)if(i.reply_templates[e].id==t)return i.reply_templates[e];return null},w=function(t){i.reply_templates.push(t),$("#new_reply_template").prev().append("<li template-id='"+t.id+"' class='reply-template reply-template-active'>"+t.name+"</li>"),$(".reply-template").unbind().click(function(){$(".reply-template").removeClass("reply-template-active");var t=$(this).attr("template-id");t&&($(this).addClass("reply-template-active"),_(t))})},x=function(t){for(var e=0;e<i.reply_templates.length;e++)if(i.reply_templates[e].id==t){i.reply_templates.splice(e,1);break}$("#select_reply_template option[value='"+t+"']").remove()},k=function(t){if($(".reply-template-active").text(t.name),t&&t.id)for(var e=0;e<i.reply_templates.length;e++)if(i.reply_templates[e].id==t.id){i.reply_templates[e]=t;break}},L=function(){var t=$("#start_datepicker").val(),e=$("#end_datepicker").val(),i=null,n=null,r=$("#reply_details_layers").val();null!=r&&""!=r&&(i=[r]);var a=$("#reply_details_templates").val();null!=a&&""!=a&&(n=[a]),MapUtils.ajax2server(reply_overview_url,"GET",{start_date:t,end_date:e,marker_layer_ids:i,template_ids:n},function(t){$("#main").empty(),$(".marker-reply-details-panel").remove(),$(".reply-details-count").text("\u5171"+t.replies_count+"\u6761"),t.replies_count&&t.replies_count>0?($(".marker-reply-details").removeClass("dt-none"),T(t),t.user_replies&&t.user_replies.length>0?($("#chart").show(),MapUtils.getReplyChart(t.user_replies)):$("#chart").hide(),C()):($(".marker-reply-details").addClass("dt-none"),$("#main").append('<div class="no-reply img-no-reply-analysis"></div>'),$("#chart").hide()),$(".marker-reply-details").unbind().click(function(){$(".marker-reply-details-panel").removeClass("dt-none").animate({right:"0"},"slow")})})},C=function(){var t=$("#start_datepicker").val(),i=$("#end_datepicker").val(),n=null,r=null,a=$("#reply_details_layers").val();null!=a&&""!=a&&(n=[a]);var o=$("#reply_details_templates").val();null!=o&&""!=o&&(r=[o]),MapUtils.ajax2server(reply_details_url,"GET",{start_date:t,end_date:i,marker_layer_ids:n,template_ids:r},function(n){if(n.reply_details.length>0){$(".marker-reply-details").removeClass("dt-none");var r="<div class='marker-reply-details-panel dt-none'>";r+="<p class='dt-hidden dt-h28'>",r+="\u52a8\u6001\u8be6\u60c5",r+="<span class='glyphicon glyphicon-remove close-reply-details pull-right dt-f16 dt-gray dt-pointer'></span>",r+="</p>",r+="<hr class='dt-mar0' style='margin-left:-15px;margin-right:-15px;'>",r+=MarkerUtils.getMarkerReplyDetails(t,i,n.reply_details,n.replies_count),r+="</div>",$("#markerReplyPanel").append(r),$(".marker-reply-details").css("max-height",window.innerHeight-152)}else $("#main").append('<div class="no-reply img-no-reply-analysis"></div>'),$("#chart").hide();$("#reply_download").unbind().click(function(){PromptInfo.xcConfirm("\u4f60\u786e\u5b9a\u8981\u4e0b\u8f7d\u6b64\u6570\u636e\u5417\uff1f",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){var t=$("#start_datepicker").val(),e=$("#end_datepicker").val(),i=null,n=null,r=$("#reply_details_layers").val();null!=r&&""!=r&&(i=[r]);var a=$("#reply_details_templates").val();null!=a&&""!=a&&(n=[a]),MapUtils.ajax2server(reply_download_url,"POST",{start_date:t,end_date:e,marker_layer_ids:i,template_ids:n},function(t){MapUtils.operatingNotice("\u6570\u636e\u751f\u6210\u4e2d,\u8bf7\u7a0d\u7b49",{loading:!0,expire:1e3}),MapUtils.download(t.url)})}})}),$(".pos-marker").unbind().click(function(t){var i=$(this).attr("layer-id"),n=e.get("m_"+i),r=$(this).attr("marker-id"),a=n.getMarker(r);$(".map-layers").trigger("click"),$(document).trigger("show.reply_panel",[t,r,i]),BInfowindow.open(a)}),$(".close-reply-details").unbind().click(function(){$(".marker-reply-details-panel").animate({right:"-100%"},"slow",function(){$(".marker-reply-details-panel").addClass("dt-none")})})})},T=function(e){var i=$.extend(t,e),n='<div class="reply-analysis-panel">';n+="<p>\u52a8\u6001\u8986\u76d6\u7387\u53ca\u52a8\u6001\u4f4d\u7f6e\u5206\u6790</p>",n+='<div class="reply-table">',n+='<table id="replyAnalysisDetails"></table>',n+='<div id="jqGridPager"></div>',n+="</div>",n+="</div>",$("#main").append(n);var r=M(),a=P(r),o=D(i);$.jgrid.defaults.width=$(".reply-analysis-panel").width()-24,$.jgrid.defaults.responsive=!0,$.jgrid.defaults.styleUI="Bootstrap";var s=$("#replyAnalysisDetails");s.jqGrid({datatype:"local",data:o,colNames:r,colModel:a,gridview:!0,rownumbers:!0,height:260,resize:!0,rowNum:10,pager:"#jqGridPager",viewrecords:!0,forceFit:!0,cellEdit:!1})},M=function(){var t=[];return t.push(""),t.push("\u8d1f\u8d23\u6807\u6ce8\u70b9"),t.push("\u52a8\u6001\u6570"),t.push("\u52a8\u6001\u8986\u76d6\u6807\u6ce8\u6570"),t.push("\u52a8\u6001\u8986\u76d6\u7387"),t.push("\u4f4d\u7f6e\u5f02\u5e38\u8bb0\u5f55"),t},P=function(t){for(var e=[],i=0;i<t.length;i++)""==t[i]?e.push({name:t[i],index:t[i],width:"100%"}):e.push({name:t[i],index:t[i],width:"100%",sortable:!0,sortname:t[i],sorttype:"number",align:"center"});return e},D=function(t){var e=[],i={};i[""]="\u603b\u8ba1&nbsp;\u5171"+t.members_count+"\u4eba",i["\u8d1f\u8d23\u6807\u6ce8\u70b9"]=t.markers_count,i["\u52a8\u6001\u6570"]=t.replies_count,i["\u52a8\u6001\u8986\u76d6\u6807\u6ce8\u6570"]=t.markers_with_reply_count,i["\u52a8\u6001\u8986\u76d6\u7387"]=t.coverage_rate+"%",i["\u4f4d\u7f6e\u5f02\u5e38\u8bb0\u5f55"]=t.abnormal_position_count,e.push(i);for(var n=0;n<t.user_replies.length;n++){var r=t.user_replies[n],a={};a[""]=r.nickname,a["\u8d1f\u8d23\u6807\u6ce8\u70b9"]=r.markers_count,a["\u52a8\u6001\u6570"]=r.replies_count,a["\u52a8\u6001\u8986\u76d6\u6807\u6ce8\u6570"]=r.markers_with_reply_count,a["\u52a8\u6001\u8986\u76d6\u7387"]=r.coverage_rate+"%",a["\u4f4d\u7f6e\u5f02\u5e38\u8bb0\u5f55"]=r.abnormal_position_count,e.push(a)}return e},S=function(){$("#select_reply_template").empty();var t=$(".reply-template");t.each(function(){var t=$(this).attr("template-id");$("#select_reply_template").append('<option value="'+t+'">'+$(this).text()+"</option>")})};return{defaults:t,init:o,destroy:s,showReplyPanel:l}});var CategoryUtils=window.CategoryUtils=CategoryUtils||{};$(function(){CategoryUtils.init=function(t,e){CategoryUtils._map=t,CategoryUtils._layersHashMap=e},CategoryUtils.refreshDetailsPanel=function(t,e){0==$(".classify-result-panel").length&&$("body").append($.templates.classify_result_panel.render());var i=t.getType(),n=t.getCategoryConfig(),r=n.field;$(".classify-field").attr("data-field",r).text(r);var a=n.is_number_field;a?$("#classifyRang").removeAttr("disabled"):$("#classifyRang").attr("disabled",!0);var o=n.method;"range"!=o?$(".layer-classify-count").addClass("dt-none"):$(".layer-classify-count").removeClass("dt-none");var s=i.replace("_layer","");$("."+s+"-classify-type").find("a.active").removeClass("active"),$("."+s+"-classify-type").find("a[data-type="+o+"]").addClass("active");var l=n.level;l<2?l=2:l>12&&(l=12);var d=n.is_categorized;$(".layer-data-has-classify").attr("data-has-classify",d).text(d?"\u662f":"\u5426");var h=n.is_cluster;$(".layer-has-cluster").attr("data-has-cluster",h).text(h?"\u662f":"\u5426"),$(".classify-count").attr("data-level",l).text(l);var c,u="",p=0;for(p=0;p<e.length;p++)c=e[p],"marker_layer"==i?u+=CategoryUtils._markerLayerCategoryHtml(c,o):"line_layer"==i?u+=CategoryUtils._lineLayerCategoryHtml(c,o):"region_layer"==i&&(u+=CategoryUtils._regionLayerCategoryHtml(c,o));for($(".classify-result-panel").empty().append(u),p=0;p<e.length;p++)c=e[p],$("#category_field_id_"+c.id).data("category",c);$(".classify-result-panel").show()},CategoryUtils._markerLayerCategoryHtml=function(t,e){if(!t)return"";var i="<li class='category_column' style='width:232px;float:left;margin: 2px 20px 2px 0;'><div>";if("range"==e){i+="<img style='height:20px;' class='pull-left category_img dt-mar4r dt-mar7t' id='category_img_id_"+t.id+"' src='"+t.icon_url+"'/>";var n=t.field.split("~"),r=n[0].trim(),a=n[1].trim();i+="<div id='category_field_id_"+t.id+"' class='pull-left  dt-max-168w dt-f12 dt-truncate category_field' data-features='"+t.feature_ids+"'>",i+="<input id='rangeStart' type='text' class='range-input form-control dt-w64' style='max-width: 80px;' value='"+r+"' />",i+="<span> ~ </span>",i+="<input id='rangeEnd' type='text' class='range-input form-control dt-w64' style='max-width: 80px;' value='"+a+"' />",i+="</div>",i+="<div class='pull-left dt-f12 dt-line-34h'>\uff08"+t.count+"\uff09</div>",i+="<span title='\u4fee\u6539\u56fe\u6807' data-id='"+t.id+"' class='pull-right dt-mar12r dt-pointer edit_category glyphicon glyphicon-edit dt-line-34h' data-target='#editCategoryMarkerIcon' data-toggle='modal'  aria-hidden='true'></span>"}else i+="<img style='height:20px;' class='pull-left category_img dt-mar4r' id='category_img_id_"+t.id+"' src='"+t.icon_url+"'/>",i+="<div id='category_field_id_"+t.id+"' class='pull-left  dt-max-148w dt-f12 dt-truncate category_field' data-features='"+t.feature_ids+"'>"+t.field+"</div>",i+="<div class='pull-left dt-f12'>\uff08"+t.count+"\uff09</div>",i+="<span title='\u4fee\u6539\u56fe\u6807' data-id='"+t.id+"' class='pull-right dt-mar2t dt-mar12r dt-pointer edit_category glyphicon glyphicon-edit' data-target='#editCategoryMarkerIcon' data-toggle='modal'  aria-hidden='true'></span>";return i+="</div></li>"},CategoryUtils._lineLayerCategoryHtml=function(t,e){if(!t)return"";var i=t.strokeColor,n=t.strokeOpacity,r=MapUtils.RGB2Hex(i.substring(1,7)),a=(t.strokeStyle,"<li class='category_column' style='width:232px;float:left;margin: 2px 20px 2px 0;'><div>");if("range"==e){a+="<div id='category_style_"+t.id+"' class='pull-left category_style dt-mar4r dt-mar7t' style='height: 14px;border:4px solid "+i+";background-color:rgba("+r[0]+","+r[1]+","+r[2]+","+n+"'></div>";var o=t.field.split("~"),s=o[0].trim(),l=o[1].trim();a+="<div id='category_field_id_"+t.id+"' class='pull-left  dt-max-148w dt-f12 dt-truncate category_field' data-style='"+t.style_id+"' data-features='"+t.feature_ids+"'>",a+="<input id='rangeStart' type='text' class='range-input form-control dt-w64' style='max-width: 80px;' value='"+s+"' />",a+="<span> ~ </span>",a+="<input id='rangeEnd' type='text' class='range-input form-control dt-w64' style='max-width: 80px;' value='"+l+"' />",a+="</div>",a+="<div class='pull-left dt-f12 dt-line-34h'>\uff08"+t.count+"\uff09</div>",a+="<span title='\u4fee\u6539\u6837\u5f0f' data-id='"+t.id+"' class='pull-right dt-mar12r dt-pointer edit_category glyphicon glyphicon-edit dt-line-34h' data-target='#editCategoryLineStyle' data-toggle='modal' aria-hidden='true'></span>"}else a+="<div id='category_style_"+t.id+"' class='pull-left category_style dt-mar4r' style='height: 14px;border:4px solid "+i+";background-color:rgba("+r[0]+","+r[1]+","+r[2]+","+n+"'></div>",a+="<div id='category_field_id_"+t.id+"' class='pull-left  dt-max-148w dt-f12 dt-truncate category_field' data-style='"+t.style_id+"' data-features='"+t.feature_ids+"'>"+t.field+"</div>",a+="<div class='pull-left dt-f12'>\uff08"+t.count+"\uff09</div>",a+="<span title='\u4fee\u6539\u6837\u5f0f' data-id='"+t.id+"' class='pull-right dt-mar2t dt-mar12r dt-pointer edit_category glyphicon glyphicon-edit' data-target='#editCategoryLineStyle' data-toggle='modal' aria-hidden='true'></span>";return a+="</div></li>"},CategoryUtils._regionLayerCategoryHtml=function(t,e){if(!t)return"";var i=t.strokeColor,n=t.fillColor,r=t.fillOpacity,a=MapUtils.RGB2Hex(n.substring(1,7)),o="<li class='category_column' style='width:232px;float:left;margin: 2px 20px 2px 0;'><div>";if("range"==e){o+="<div id='category_style_"+t.id+"' class='pull-left category_style dt-mar4r dt-mar7t' style='height: 14px;width: 20px;border: 1px solid "+i+";background-color:rgba("+a[0]+","+a[1]+","+a[2]+","+r+")'></div>";var s=t.field.split("~"),l=s[0].trim(),d=s[1].trim();o+="<div id='category_field_id_"+t.id+"' class='pull-left  dt-max-148w dt-f12 dt-truncate category_field' data-style='"+t.style_id+"' data-features='"+t.feature_ids+"'>",o+="<input id='rangeStart' type='text' class='range-input form-control dt-w64' style='max-width: 80px;' value='"+l+"' />",o+="<span> ~ </span>",o+="<input id='rangeEnd' type='text' class='range-input form-control dt-w64' style='max-width: 80px;' value='"+d+"' />",o+="</div>",o+="<div class='pull-left dt-f12 dt-line-34h'>\uff08"+t.count+"\uff09</div>",o+="<span title='\u4fee\u6539\u6837\u5f0f' data-id='"+t.id+"' class='pull-right dt-mar12r dt-pointer edit_category glyphicon glyphicon-edit dt-line-34h' data-target='#editCategoryRegionStyle' data-toggle='modal' aria-hidden='true'></span>"}else o+="<div id='category_style_"+t.id+"' class='pull-left category_style dt-mar4r' style='height: 14px;width: 20px;border: 1px solid "+i+";background-color:rgba("+a[0]+","+a[1]+","+a[2]+","+r+")'></div>",o+="<div id='category_field_id_"+t.id+"' class='pull-left  dt-max-148w dt-f12 dt-truncate category_field' data-style='"+t.style_id+"' data-features='"+t.feature_ids+"'>"+t.field+"</div>",o+="<div class='pull-left dt-f12'>\uff08"+t.count+"\uff09</div>",o+="<span title='\u4fee\u6539\u6837\u5f0f' data-id='"+t.id+"' class='pull-right dt-mar2t dt-mar12r dt-pointer edit_category glyphicon glyphicon-edit' data-target='#editCategoryRegionStyle' data-toggle='modal' aria-hidden='true'></span>";return o+="</div></li>"},CategoryUtils.getCategorySettings=function(t,e){var i=$("#"+e+"_data_has_classify").is(":checked"),n={mid:mid,id:t.id,field:$(".classify-field").attr("data-field"),method:$("."+e+"-classify-type").find(".active").attr("data-type"),level:parseInt($(".classify-count").attr("data-level")),is_number_field:t.getCategoryConfig().is_number_field,is_display:i,category:null};if($(".category_field").length>0){if(n.category={},"range"==n.method){var r=!1;if($(".category_field").each(function(){var t=$(this).find("#rangeStart").val(),i=$(this).find("#rangeEnd").val();if(""==t||isNaN(t)||""==i||isNaN(i))return void(r=!0);var a=t+" ~ "+i,o=$(this).data("category");"marker"==e?n.category[a]={icon_url:o.icon_url,features:""}:"line"==e?n.category[a]={strokeColor:o.strokeColor,strokeOpacity:o.strokeOpacity,strokeWeight:o.strokeWeight,strokeStyle:o.strokeStyle,features:""}:"region"==e&&(n.category[a]={strokeColor:o.strokeColor,strokeOpacity:o.strokeOpacity,strokeWeight:o.strokeWeight,fillColor:o.fillColor,fillOpacity:o.fillOpacity,features:""})}),r)return PromptInfo.xcConfirm("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u5206\u6bb5\u8303\u56f4\uff01",PromptInfo.xcConfirm.typeEnum.warning),!1}else $(".category_field").each(function(){var t=$(this).text(),i=$(this).attr("data-features"),r=$(this).data("category");"marker"==e?n.category[t]={icon_url:r.icon_url,features:i.split(",")}:"line"==e?n.category[t]={strokeColor:r.strokeColor,strokeOpacity:r.strokeOpacity,strokeWeight:r.strokeWeight,strokeStyle:r.strokeStyle,features:i.split(",")}:"region"==e&&(n.category[t]={strokeColor:r.strokeColor,strokeOpacity:r.strokeOpacity,strokeWeight:r.strokeWeight,fillColor:r.fillColor,fillOpacity:r.fillOpacity,features:i.split(",")})});n.category=JSON.stringify(n.category)}return n},CategoryUtils.getCategory=function(t,e,i,n,r){var a={mid:mid,id:t.id,field:e,is_categorized:r,method:i,level:parseInt(n)},o=null,s=t.getType();"marker_layer"==s?o=get_category_marker_layer_url:"line_layer"==s?o=get_category_line_layer_url:"region_layer"==s&&(o=get_category_region_layer_url),o&&MapUtils.ajax2server(o,"GET",a,function(e){if(e.categories){var i=t.getCategoryConfig();i.field=e.field,i.is_number_field=e.is_number_field,i.method=e.method,i.level=e.level,t.setCategoryConfig(i),t.setCategories(e.categories),CategoryUtils.refreshDetailsPanel(t,e.categories);var n;"marker_layer"==t.type?n="marker":"line_layer"==t.type?n="line":"region_layer"==t.type&&(n="region"),e.is_number_field?$("."+n+"-classify-type").children().last().removeAttr("disabled"):$("."+n+"-classify-type").children().last().attr("disabled",!0)}})},CategoryUtils.getCategoryHtmlToMarkerLayer=function(t,e){var i=t.icon_url,n=t.feature_ids,r=t.field,a=t.id,o=0;n&&n.length>0&&(o=n.split(",").length);var s="<li class='dt-hidden' data-layer-id='"+e+"'>";return s+="<div>",s+="<img id='marker_layer_"+e+"_category_img_"+a+"' data-id='"+a+"' title='\u4fee\u6539\u56fe\u6807' class='category_img pull-left dt-pointer' src='"+i+"' style='height:20px;'/>",s+="<div id='marker_layer_"+e+"_category_field_"+a+"' class='pull-left dt-max-148w dt-f12 dt-truncate layer_category_field' data-features='"+n+"'>"+r+"</div>",s+="<div class='pull-left dt-f12'>(<span>"+o+"</span>)</div>",s+="<span class='dt-none pull-right dt-mar2t dt-mar12r dt-pointer edit_category glyphicon glyphicon-edit' data-id='"+a+"' data-target='#editCategoryMarkerIcon' data-toggler='modal' aria-hidden='true'></span>",s+="</div>",s+="</li>"},CategoryUtils.getCategoryHtmlToMarkerLayerViewer=function(t,e){var i=t.icon_url,n=t.feature_ids,r=t.field,a=t.id,o=0;n&&n.length>0&&(o=n.split(",").length);var s="<li class='dt-hidden' data-layer-id='"+e+"'>";return s+="<div>",s+="<img id='marker_layer_"+e+"_category_img_"+a+"' class='category_img pull-left' src='"+i+"' style='height:20px;'/>",s+="<div id='marker_layer_"+e+"_category_field_"+a+"' class='pull-left dt-max-148w dt-f12 dt-truncate layer_category_field' data-features='"+n+"'>"+r+"</div>",s+="<div class='pull-left dt-f12'>(<span>"+o+"</span>)</div>",s+="</div>",s+="</li>"},CategoryUtils.getCategoryHtmlToLineLayer=function(t,e){
var i=t.feature_ids,n=t.field,r=t.id,a=0;i&&i.length>0&&(a=i.split(",").length);var o="<li class='dt-hidden dt-line-24h' data-layer-id='"+e+"'>";return o+="<div>",o+="<div id='line_layer_"+e+"_category_style_"+r+"' data-id='"+r+"' title='\u4fee\u6539\u6837\u5f0f' class='category_style dt-mar5 pull-left dt-pointer' style='height:14px;border:4px solid "+t.strokeColor+";background-color:rgba("+parseInt(t.strokeColor.substring(1,3),16)+","+parseInt(t.strokeColor.substring(3,5),16)+","+parseInt(t.strokeColor.substring(5,7),16)+","+t.strokeOpacity+"'></div>",o+="<div id='line_layer_"+e+"_category_field_"+r+"' class='pull-left dt-max-148w dt-f12 dt-truncate layer_category_field' data-features='"+i+"'>"+n+"</div>",o+="<div class='pull-left dt-f12'>(<span>"+a+"</span>)</div>",o+="<span class='dt-none pull-right dt-mar2t dt-mar12r dt-pointer edit_category glyphicon glyphicon-edit' data-id='"+r+"' data-target='#editCategoryLineStyle' data-toggler='modal' aria-hidden='true'></span>",o+="</div>",o+="</li>"},CategoryUtils.getCategoryHtmlToLineLayerViewer=function(t,e){var i=t.feature_ids,n=t.field,r=t.id,a=0;i&&i.length>0&&(a=i.split(",").length);var o="<li class='dt-hidden dt-line-24h' data-layer-id='"+e+"'>";return o+="<div>",o+="<div id='line_layer_"+e+"_category_style_"+r+"' data-id='"+r+"' title='\u4fee\u6539\u6837\u5f0f' class='category_style dt-mar5 pull-left dt-pointer' style='height:14px;border:4px solid "+t.strokeColor+";background-color:rgba("+parseInt(t.strokeColor.substring(1,3),16)+","+parseInt(t.strokeColor.substring(3,5),16)+","+parseInt(t.strokeColor.substring(5,7),16)+","+t.strokeOpacity+"'></div>",o+="<div id='line_layer_"+e+"_category_field_"+r+"' class='pull-left dt-max-148w dt-f12 dt-truncate layer_category_field' data-features='"+i+"'>"+n+"</div>",o+="<div class='pull-left dt-f12'>(<span>"+a+"</span>)</div>",o+="</div>",o+="</li>"},CategoryUtils.getCategoryHtmlToRegionLayer=function(t,e){var i=t.feature_ids,n=t.field,r=t.id,a=0;i&&i.length>0&&(a=i.split(",").length);var o="<li class='dt-hidden dt-line-24h' data-layer-id='"+e+"'>";o+="<div>";var s=t.fillColor?parseInt(t.fillColor.substring(1,3),16):255,l=t.fillColor?parseInt(t.fillColor.substring(3,5),16):0,d=t.fillColor?parseInt(t.fillColor.substring(5,7),16):0,h=t.fillOpacity?t.fillOpacity:.2,c=(t.strokeWeight?t.strokeWeight:1,t.strokeColor?t.strokeColor:"#ff0000");return o+="<div id='region_layer_"+e+"_category_style_"+r+"' data-id='"+r+"' title='\u4fee\u6539\u6837\u5f0f' class='category_style dt-mar5 pull-left dt-pointer' style='height:14px;width: 20px;border: 1px solid "+c+";background-color:rgba("+s+","+l+","+d+","+h+")'></div>",o+="<div id='region_layer_"+e+"_category_field_"+r+"' class='pull-left dt-max-148w dt-f12 dt-truncate layer_category_field' data-features='"+i+"'>"+n+"</div>",o+="<div class='pull-left dt-f12'>(<span>"+a+"</span>)</div>",o+="<span class='dt-none pull-right dt-mar2t dt-mar12r dt-pointer edit_category glyphicon glyphicon-edit' data-id='"+r+"' data-target='#editCategoryRegionStyle' data-toggler='modal' aria-hidden='true'></span>",o+="</div>",o+="</li>"},CategoryUtils.getCategoryHtmlToRegionLayerViewer=function(t,e){var i=t.feature_ids,n=t.field,r=t.id,a=0;i&&i.length>0&&(a=i.split(",").length);var o="<li class='dt-hidden dt-line-24h' data-layer-id='"+e+"'>";o+="<div>";var s=t.fillColor?parseInt(t.fillColor.substring(1,3),16):255,l=t.fillColor?parseInt(t.fillColor.substring(3,5),16):0,d=t.fillColor?parseInt(t.fillColor.substring(5,7),16):0,h=t.fillOpacity?t.fillOpacity:.2,c=(t.strokeWeight?t.strokeWeight:1,t.strokeColor?t.strokeColor:"#ff0000");return o+="<div id='region_layer_"+e+"_category_style_"+r+"' data-id='"+r+"' title='\u4fee\u6539\u6837\u5f0f' class='category_style dt-mar5 pull-left dt-pointer' style='height:14px;width: 20px;border:1px solid "+c+";background-color:rgba("+s+","+l+","+d+","+h+")'></div>",o+="<div id='region_layer_"+e+"_category_field_"+r+"' class='pull-left dt-max-148w dt-f12 dt-truncate layer_category_field' data-features='"+i+"'>"+n+"</div>",o+="<div class='pull-left dt-f12'>(<span>"+a+"</span>)</div>",o+="</div>",o+="</li>"},CategoryUtils.handleEvent=function(t,e){"click"==t&&$(e).unbind().click(function(t){$(t.target).hasClass("edit_category")?($(document).trigger("dt.category.selected",t.target),$(document).trigger("dt.category.style",t.target)):$(t.target).hasClass("upload_file")||$(document).trigger("dt.category.selected",t.target)})},CategoryUtils.removeVectors=function(t){if(null!=t&&"marker_layer"==t.type){var e=t.vectors;if(e)for(var i=0;i<e.length;i++){t.getMarker(e[i].feature_id);CategoryUtils._map.removeOverlay(e[i])}}},CategoryUtils.getCurrentLayerCategory=function(t,e){var i,n;"marker_layer"==e?(i=CategoryUtils._layersHashMap.get("m_"+current_layer_id),n="marker"):"line_layer"==e?(i=CategoryUtils._layersHashMap.get("l_"+current_layer_id),n="line"):"region_layer"==e&&(i=CategoryUtils._layersHashMap.get("r_"+current_layer_id),n="region");var r=$(".classify-field").attr("data-field"),a=$(".classify-count").attr("data-level"),o=$("."+n+"-classify-type").find(".active").attr("data-type");if("range"!=o?$(".layer-classify-count").addClass("dt-none"):$(".layer-classify-count").removeClass("dt-none"),"range"==o){var s=i.getAttrField(r);s&&"number"!=s.field_type&&(o="unique")}CategoryUtils.getCategory(i,r,o,a,t)}});var PermissionUtils=window.PermissionUtils=PermissionUtils||{};$(function(){function t(t,e,i){var n={mid:mid,user_id:t.id,role:e};MapUtils.ajax2server(update_member_role_url,"PUT",n,function(){var n=t.id,r=PermissionUtils.setPermissionPanelHtml(t,e);$("#member_"+n).attr("data-content",r),$("#member_"+n).find(".role-icon").removeClass("role-normal").removeClass("role-admin").removeClass("role-guest").addClass(i),$(".map-member").popover("hide")})}function e(t){$("#user_"+t.id).remove();var e=PermissionUtils.setPermissionPanelHtml(t,"\u6210\u5458"),i="<div id='member_"+t.id+"' data-name='"+t.nickname+"' data-user='"+t.id+"' data-content='"+e+"' class='dt-pos-r pull-left dt-mar12l dt-mar6b dt-pointer map-member' title='"+t.nickname+"'>";i+="<img src='"+oss_host+t.avatar+"' width='32' class='img-circle'/>",i+="<span class='role-icon role-normal'></span>",i+="</div>",$(".member-panel").append(i),PermissionUtils.reloadPopover(),PermissionUtils.initPopover()}function i(t){$("#layer_user_"+t.id).remove();var e=$("#layer_members_container"),i=e.attr("data-layer-type"),n=e.attr("data-layer-id"),r=PermissionUtils.setLayerPermissionPanelHtml(t,"\u6210\u5458","\u5730\u56fe\u7ba1\u7406\u5458","",i),a=i+"_member_"+n+"_"+t.id,o="<div id='"+a+"' data-layer-type='"+i+"' data-name='"+t.nickname+"' data-content='"+r+"' class='dt-pos-r pull-left dt-mar12l dt-mar6b dt-pointer map-member' title='"+t.nickname+"'>";o+="<img src='"+oss_host+t.avatar+"' width='32' class='img-circle'/>",o+="<span class='role-icon role-normal'></span>",o+="</div>";var s=$("#permission_"+PermissionUtils.current_layer_id);s.find(".permission-layer-caption").hide(),s.find(".layer-member-panel").append(o),delete PermissionUtils.current_layer_id,PermissionUtils.reloadPopover(),PermissionUtils.initPopover()}function n(t){var e="",i=null;"marker_layer"==PermissionUtils.hashMap.getType()?(e=$("#addMemberToFeature").attr("data-markers").split(","),i=PermissionUtils.hashMap.getMarkers()):"line_layer"==PermissionUtils.hashMap.getType()?(e=$("#addMemberToFeature").attr("data-lines").split(","),i=PermissionUtils.hashMap.getLines()):"region_layer"==PermissionUtils.hashMap.getType()&&(e=$("#addMemberToFeature").attr("data-regions").split(","),i=PermissionUtils.hashMap.getRegions());for(var n=0;i&&n<e.length;n++){var r=i.get(e[n]);r.cooperation=[],r.cooperation.push(t),BInfowindow.refresh(r)}e=e.toString(),delete PermissionUtils.hashMap,$(document).trigger("dt.update.datatable.list",[e,t])}function r(t){return 0==t.trim().length?"\u624b\u673a\u53f7\u7801\u4e0d\u80fd\u4e3a\u7a7a":a(t)?"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7":null}function a(t){var e=/^13[0-9]{9}$|14[0-9]{9}|15[0-9]{9}$|18[0-9]{9}$|17[0-9]{9}$/;return!e.test(t)&&"4006162048"!=t}PermissionUtils.hashMap="",$(".map-invite-member, .map-layer-role,.map-feature-role").height($(window).height()-48-32-24-24),$(".member-panel").css("max-height",$(".map-invite-member").height()-166-32-48-24+"px"),$(".permission-layers").height($(".map-layer-role").height()-82),PermissionUtils.initPopover=function(){$(".map-member, #member_admin").on("show.bs.popover",function(){$(".map-member, #member_admin").popover("hide")}).on("shown.bs.popover",function(){$(".popover").unbind().click(function(e){if($(e.target).hasClass("glyphicon-remove"))$(".map-member, #member_admin").popover("hide");else if($(e.target).hasClass("remove-member")){if("\u79fb\u9664"==$(e.target).text())var i="\u786e\u5b9a\u79fb\u9664\u8be5\u6210\u5458?";else if("\u9000\u51fa"==$(e.target).text())var i="\u786e\u5b9a\u9000\u51fa\u8be5\u5730\u56fe\u534f\u4f5c?";PromptInfo.xcConfirm(i,PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){var t=$(e.target).attr("data-user");MapUtils.ajax2server(remove_member_url,"DELETE",{user_id:t},function(t){if(403!=t.status){var e=$(".user-info").attr("data-user");$("#user_"+e).find(".active-member").remove(),$(".map-member").popover("hide"),$("#member_"+e).remove()}})}})}else if($(e.target).hasClass("setting-permission"))$(".user-info-panel").addClass("dt-none"),$(".permission-panel").removeClass("dt-none");else if($(e.target).hasClass("glyphicon-chevron-left"))$(".user-info-panel").removeClass("dt-none"),$(".permission-panel").addClass("dt-none");else if($(e.target).hasClass("give-admin")){if($(e.target).closest("p").find(".glyphicon-ok").length>0){var i="\u8be5\u6210\u5458\u5df2\u7ecf\u662f\u7ba1\u7406\u5458";return void PromptInfo.xcConfirm(i,PromptInfo.xcConfirm.typeEnum.info)}var n=$(e.target).closest(".popover-content").find(".user-info"),r={};r.id=n.attr("data-user"),r.phone=n.attr("data-phone"),r.avatar=n.attr("data-avatar"),r.nickname=n.attr("data-nickname"),t(r,"\u7ba1\u7406\u5458","role-admin")}else if($(e.target).hasClass("give-normal")){if($(e.target).closest("p").find(".glyphicon-ok").length>0){var i="\u8be5\u6210\u5458\u5df2\u7ecf\u662f\u666e\u901a\u6210\u5458";return void PromptInfo.xcConfirm(i,PromptInfo.xcConfirm.typeEnum.info)}var n=$(e.target).closest(".popover-content").find(".user-info"),r={};r.id=n.attr("data-user"),r.phone=n.attr("data-phone"),r.avatar=n.attr("data-avatar"),r.nickname=n.attr("data-nickname"),t(r,"\u6210\u5458","role-normal")}else if($(e.target).hasClass("give-guest")){if($(e.target).closest("p").find(".glyphicon-ok").length>0){var i="\u8be5\u6210\u5458\u5df2\u7ecf\u662f\u8bbf\u5ba2";return void PromptInfo.xcConfirm(i,PromptInfo.xcConfirm.typeEnum.info)}var n=$(e.target).closest(".popover-content").find(".user-info"),r={};r.id=n.attr("data-user"),r.phone=n.attr("data-phone"),r.avatar=n.attr("data-avatar"),r.nickname=n.attr("data-nickname"),t(r,"\u8bbf\u5ba2","role-guest")}else $(e.target).hasClass("layer-remove-member")&&PromptInfo.xcConfirm("\u662f\u5426\u79fb\u9664\u8be5\u6210\u5458",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){var t=$(e.target).closest(".permission-layer").attr("id").split("_")[1],i=$(e.target).attr("data-layer-type"),n="";"marker_layer"==i?n=marker_layer_remove_member_url:"line_layer"==i?n=line_layer_remove_member_url:"region_layer"==i&&(n=region_layer_remove_member_url);var r=$(e.target).attr("data-user");MapUtils.ajax2server(n,"DELETE",{id:t,user_id:r,mid:mid},function(t){if(200==t.status){var i=$(e.target).closest(".permission-layer").attr("id").split("_")[1],n=$(".layer-remove-member").attr("data-layer-type"),r=$(".user-info").attr("data-user");$(".map-member").popover("hide"),$("#"+n+"_member_"+i+"_"+r).remove()}})}})})})},PermissionUtils.setPermissionPanelHtml=function(t,e){var i='<div class="dt-hidden dt-w200 dt-pos-r user-info-panel">';return i+='<span class="glyphicon glyphicon-remove dt-pointer" style="position:absolute;right:0;top:0;color:#bbb;"></span>',i+='<img src="'+oss_host+t.avatar+'" class="img-circle pull-left" width="48"/>',i+='<div class="user-info" data-user="'+t.id+'" data-nickname="'+t.nickname+'" data-avatar="'+t.avatar+'">'+t.nickname+'<span class="dt-mar12l">'+e+"</span><br>",i+="</div>",i+='<hr style="margin:10px 0"/>',i+='<div><a href="###" class="setting-permission btn btn-danger btn-sm">\u8bbe\u7f6e\u6743\u9650</a><a href="###" data-user="'+t.id+'" class="btn btn-default btn-sm pull-right remove-member">\u79fb\u9664</a></div></div>',i+='</div><div class="permission-panel dt-none dt-hidden dt-pos-r">',i+='<p class="permission-title">',i+='<span class="glyphicon glyphicon-chevron-left dt-f12 dt-pointer" style="position:absolute;left:0;top:4px;color:#bbb;"></span>',i+="\u8bbe\u7f6e\u6743\u9650",i+='<span class="glyphicon glyphicon-remove dt-f12 dt-pointer" style="position:absolute;right:0;top:4px;color:#bbb;"></span>',i+="</p>",i+='<p class="admin-setting give-admin" data-user="'+t.id+'">',"\u7ba1\u7406\u5458"==e&&(i+='<span class="glyphicon glyphicon-ok dt-pos-a give-normal" data-user="'+t.id+'" style="left:4px;top:13px;color:#bbb;"></span>'),i+='\u7ba1\u7406\u5458<br><span class="give-admin"  data-user="'+t.id+'">\u53ef\u7ba1\u7406\u5730\u56fe\u6210\u5458\uff0c\u5bf9\u5730\u56fe\u8fdb\u884c\u8bbe\u7f6e</span>',i+="</p>",i+='<p class="normal-setting give-normal" data-user="'+t.id+'">',"\u6210\u5458"==e&&(i+='<span class="glyphicon glyphicon-ok dt-pos-a give-normal" data-user="'+t.id+'" style="left:4px;top:13px;color:#bbb;"></span>'),i+='\u6210\u5458<br><span class="give-normal" data-user="'+t.id+'">\u901a\u7528\u6027\u64cd\u4f5c\uff0c\u5982\u521b\u5efa\u5220\u9664\u56fe\u5c42\u3001\u6807\u8bb0\u3001\u4e0a\u4f20\u6570\u636e\u7b49\u3002</span>',i+="</p>",i+='<p class="guest-setting give-guest" data-user="'+t.id+'">',"\u8bbf\u5ba2"==e&&(i+='<span class="glyphicon glyphicon-ok dt-pos-a give-guest" data-user="'+t.id+'" style="left:4px;top:13px;color:#bbb;"></span>'),i+='\u8bbf\u5ba2<br><span class="give-guest" data-user="'+t.id+'">\u53ea\u80fd\u67e5\u770b\u5185\u5bb9\uff0c\u4e0d\u53ef\u8fdb\u884c\u64cd\u4f5c</span>',i+="</p>",i+="</div>"},PermissionUtils.setLayerPermissionPanelHtml=function(t,e,i,n,r){var a='<div class="dt-hidden dt-w200 dt-pos-r user-info-panel">';return a+='<span class="glyphicon glyphicon-remove dt-pointer" style="position:absolute;right:0;top:0;color:#bbb;"></span>',a+='<img src="'+oss_host+t.avatar+'" class="img-circle pull-left" width="48"/>',a+='<div class="user-info" data-user="'+t.id+'" data-nickname="'+t.nickname+'" data-avatar="'+t.avatar+'">'+t.nickname+'<span class="dt-mar12l">'+e+"</span><br>",a+="</div>",a+='<hr style="margin:10px 0"/>',"\u56fe\u5c42\u6210\u5458"==i?n&&n==user_phone&&(a+='<div><a href="###" data-layer-type="'+r+'" data-user="'+t.id+'" class="btn btn-default btn-sm pull-right layer-remove-member">\u9000\u51fa</a></div>'):i.indexOf("\u5730\u56fe")>=0&&(a+='<div><a href="###" data-layer-type="'+r+'" data-user="'+t.id+'" class="btn btn-default btn-sm pull-right layer-remove-member">\u79fb\u9664</a></div>'),a+="</div>"},PermissionUtils.setFeaturePermissionPanelHtml=function(t,e){var i='<div class="dt-hidden dt-w200 dt-pos-r user-info-panel">';return i+='<span class="glyphicon glyphicon-remove dt-pointer" style="position:absolute;right:0;top:0;color:#bbb;"></span>',i+='<img src="'+oss_host+t.avatar+'" class="img-circle pull-left" width="48"/>',i+='<div class="user-info" data-user="'+t.id+'" data-nickname="'+t.nickname+'" data-avatar="'+t.avatar+'">'+t.nickname+'<span class="dt-mar12l">'+e+"</span><br>",i+="</div>",i+="</div>"},PermissionUtils.addLayerToPermissionPanel=function(t,e,i){var n="<div class='permission-layer' id='permission_"+t+"'>";"marker_layer"==i?n+="<div class='icons marker_layer_icon pull-left'></div>":"region_layer"==i?n+="<div class='icons region_layer_icon pull-left'></div>":"line_layer"==i&&(n+="<div class='icons line_layer_icon pull-left'></div>"),n+="<span class='dt-f14 layer-title'>"+e+"</span>",n+="<div class='dt-hidden dt-pad12y'>",n+="<div class='dt-pointer pull-left add-overlay layer-add-members' data-layer-type='"+i+"' data-layer-id='"+t+"' data-toggle='modal' data-target='#addMemberToLayer'></div>",n+="<div class='layer-member-panel dt-hidden'>",n+="<span class='permission-layer-caption dt-mar12l dt-line-34h coloraa dt-middle dt-f14'>\u6682\u65e0\u534f\u4f5c\u6210\u5458\uff0c\u70b9\u51fb\u201c\uff0b\u201d\u53f7\u6dfb\u52a0</span>",n+="</div>",n+="</div>",n+="</div>",$(".add-layer-to-panel").before(n)},PermissionUtils.getLayerToPermissionList=function(t){$("#layerListPanel").find("ul").remove();for(var e="<ul id='layerPermissionList' class='dt-hidden dt-mar12t'>",i=0;i<t.length;i++){var n=t[i],r="";"marker_layer"==n.type?r="marker_layer_icon":"region_layer"==n.type?r="region_layer_icon":"line_layer"==n.type&&(r="line_layer_icon"),e+="<li class='dt-hidden dt-line-32h dt-pointer' data-layer-type='"+n.type+"' data-layer-id='"+n.id+"'>",e+="<div class='icons "+r+" pull-left'></div>",e+="<span class='dt-mar12l dt-f14'>"+n.title+"</span>",n.is_permission_layer&&(e+="<span class='glyphicon glyphicon-ok dt-line-30h dt-mar12r pull-right' style='color:green'></span>"),e+="</li>"}e+="</ul>",$("#layerListPanel").find(".modal-body").append(e),$("#layerPermissionList").unbind().click(function(t){var e,i=$(t.target).closest("li"),n=i.attr("data-layer-id"),r=i.attr("data-layer-type"),a=i.find("span").text(),o=PermissionUtils.hashMap;"marker_layer"==r?e=o.get("m_"+n):"line_layer"==r?e=o.get("l_"+n):"region_layer"==r&&(e=o.get("r_"+n)),e&&!e.is_permission_layer&&(e.is_permission_layer=!0,$(t.target).closest("li").append("<span class='glyphicon glyphicon-ok dt-line-30h dt-mar12r pull-right' style='color:green'></span>"),PermissionUtils.addLayerToPermissionPanel(n,a,r))})},PermissionUtils.reloadPopover=function(){$(".map-member").popover("destroy"),$(".map-member").popover({html:!0,template:'<div class="popover" role="tooltip"><div class="popover-content"></div></div>'})},PermissionUtils.loginUserRole=function(t,e){if(e.mapUsers)for(var i=0;i<e.mapUsers.length;i++)if(e.mapUsers[i].phone==t){if(0==e.mapUsers[i].role)return"\u5730\u56fe\u7ba1\u7406\u5458";if(1==e.mapUsers[i].role)return"\u5730\u56fe\u6210\u5458";if(2==e.mapUsers[i].role)return"\u5730\u56fe\u8bbf\u5ba2"}if(e.layerUsers)for(var n=0;n<e.layerUsers.length;n++)if(e.layerUsers[n].phone==t)return"\u56fe\u5c42\u6210\u5458";if(e.featureUsers)for(var r=0;r<e.featureUsers.length;r++)if(e.featureUsers[r].phone==t)return"\u8bb0\u5f55\u6210\u5458"},$(document).on("dt.map.invite.member",function(t,i){var n=$(i).val(),a=r(n);return a?void $(".notice1").html(a).fadeIn(500).delay(1500).fadeOut(500):void MapUtils.ajax2server(add_member_url,"POST",{phone:n,mid:mid},function(t){return 200!=t.status||"undefined"==typeof t.user?void $(".notice1").html(t.msg).fadeIn(500).delay(1500).fadeOut(500):void e(t.user)})}),$(document).on("dt.add.member.to.map",function(t,i){if(0==$(i).closest("div").find(".active-member").length){var n=$(i).parent().attr("data-user");MapUtils.ajax2server(add_member_url,"POST",{user_id:n,mid:mid},function(t){return 200!=t.status||"undefined"==typeof t.user?void $(".notice1").html(t.msg).fadeIn(500).delay(1500).fadeOut(500):void e(t.user)})}}),$(document).on("dt.add.layer",function(t,e){var i=e.values();PermissionUtils.getLayerToPermissionList(i),PermissionUtils.hashMap=e}),$(document).on("dt.get.layer.members",function(){var t=$("#layer_members_container"),e=t.attr("data-layer-id"),i=t.attr("data-layer-type");t.empty();var n="";"marker_layer"==i?n=get_marker_layer_members_url:"line_layer"==i?n=get_line_layer_members_url:"region_layer"==i&&(n=get_region_layer_members_url),MapUtils.ajax2server(n,"GET",{id:e,mid:mid},function(e){if(e&&e.users){for(var i,n="",r=0;r<e.users.length;r++)i=e.users[r],n+='<div id="layer_user_'+i.id+'" class="layer-member" data-user="'+i.id+'">',n+='<img class="img-circle" src="'+oss_host+i.avatar+'" height="32" width="32">',n+='<p class="user-name">'+i.nickname+"</p>",n+="</div>";t.append(n)}})}),$(document).on("dt.add-member-to-layer",function(t,e){if(0==$(e).closest("div").find(".active-member").length){var n=$(e).closest("div").attr("data-user"),r=$("#layer_members_container"),a=r.attr("data-layer-id"),o=r.attr("data-layer-type");PermissionUtils.current_layer_id=a;var s="";"marker_layer"==o?s=marker_layer_member_invite_url:"line_layer"==o?s=line_layer_member_invite_url:"region_layer"==o&&(s=region_layer_member_invite_url),MapUtils.ajax2server(s,"POST",{user_id:n,id:a,mid:mid},function(t){200==t.status&&i(t.user)})}}),$(document).on("dt.layer.invite.member",function(t,e){var n=$(e).val(),a=r(n);if(a)return void $(".notice1").html(a).fadeIn(500).delay(1500).fadeOut(500);var o=$("#layer_members_container"),s=o.attr("data-layer-id"),l=o.attr("data-layer-type"),d="";"marker_layer"==l?d=marker_layer_member_invite_url:"line_layer"==l?d=line_layer_member_invite_url:"region_layer"==l&&(d=region_layer_member_invite_url);var h={phone:n,id:s,mid:mid};PermissionUtils.current_layer_id=s,MapUtils.ajax2server(d,"POST",h,function(t){if(200==t.status){if("undefined"==typeof t.user)return void $(".notice1").html(t.msg).fadeIn(500).delay(1500).fadeOut(500);i(t.user)}})}),$(document).on("dt.get.feature.members",function(t,e,i){$("#feature_members_container").empty();var n="";"marker"==i?n=get_marker_layer_members_url:"line"==i?n=get_line_layer_members_url:"region"==i&&(n=get_region_layer_members_url),MapUtils.ajax2server(n,"GET",{id:e,mid:mid},function(t){for(var e,i="",n=0;n<t.users.length;n++)e=t.users[n],i+='<div id="feature_user_'+e.id+'" class="feature-member" data-user="'+e.id+'">',i+='<img  class="img-circle" height="32" src="'+oss_host+e.avatar+'" width="32">',i+='<p class="user-name">'+e.nickname+"</p>",i+="</div>";$("#feature_members_container").append(i)})}),$(document).on("dt.feature.invite.member",function(t,e,i){var a=$(e).val(),o=r(a);if(o)return void $(".notice1").html(o).fadeIn(500).delay(1500).fadeOut(500);var s=current_layer_id,l=$("#addMemberToFeature"),d=l.attr("data-layer-type"),h="",c="";if("marker"==d){h=marker_member_invite_url;var u=l.attr("data-markers");PermissionUtils.hashMap=i.get("m_"+s),c={phone:a,marker_ids:u,id:s,mid:mid}}else if("line"==d){h=line_member_invite_url;var p=l.attr("data-lines");c={phone:a,line_ids:p,id:s,mid:mid},PermissionUtils.hashMap=i.get("l_"+s)}else if("region"==d){h=region_member_invite_url;var f=l.attr("data-regions");c={phone:a,region_ids:f,id:s,mid:mid},PermissionUtils.hashMap=i.get("r_"+s)}MapUtils.ajax2server(h,"POST",c,function(t){200==t.status&&($(".notice1").html("\u4efb\u52a1\u5206\u6d3e\u5b8c\u6210").fadeIn(500).delay(1500).fadeOut(500),n(t.user))})}),$(document).on("dt.add-member-to-feature",function(t,e,i,r){var a=$(e).closest("div").attr("data-user"),o=$("#addMemberToFeature").attr("data-layer-type"),s="",l="";if("marker"==o){s=marker_member_invite_url;var d=$("#addMemberToFeature").attr("data-markers");l={user_id:a,marker_ids:d,id:i,mid:mid},PermissionUtils.hashMap=r.get("m_"+i)}else if("line"==o){s=line_member_invite_url;var h=$("#addMemberToFeature").attr("data-lines");l={user_id:a,line_ids:h,id:i,mid:mid},PermissionUtils.hashMap=r.get("l_"+i)}else if("region"==o){s=region_member_invite_url;var c=$("#addMemberToFeature").attr("data-regions");l={user_id:a,region_ids:c,id:i,mid:mid},PermissionUtils.hashMap=r.get("r_"+i)}MapUtils.ajax2server(s,"POST",l,function(t){200==t.status&&($(".notice1").html("\u4efb\u52a1\u5206\u6d3e\u5b8c\u6210").fadeIn(500).delay(1500).fadeOut(500),n(t.user))})})}),function(t){t.jgrid=t.jgrid||{},t.extend(t.jgrid,{defaults:{recordtext:"{0} - {1}\u3000\u5171 {2} \u6761",emptyrecords:"\u65e0\u6570\u636e\u663e\u793a",loadtext:"\u8bfb\u53d6\u4e2d...",pgtext:" {0} \u5171 {1} \u9875",pgfirst:"\u7b2c\u4e00\u9875",pglast:"\u6700\u540e\u4e00\u9875",pgnext:"\u4e0b\u4e00\u9875",pgprev:"\u4e0a\u4e00\u9875",pgrecs:"Records per Page",showhide:"Toggle Expand Collapse Grid"},search:{caption:"\u8bbe\u7f6e\u7b5b\u9009\u6761\u4ef6",Find:"\u7b5b\u9009",Reset:"\u91cd\u7f6e",odata:[{oper:"eq",text:"\u7b49\u4e8e\u3000\u3000"},{oper:"ne",text:"\u4e0d\u7b49\u3000\u3000"},{oper:"lt",text:"\u5c0f\u4e8e\u3000\u3000"},{oper:"le",text:"\u5c0f\u4e8e\u7b49\u4e8e"},{oper:"gt",text:"\u5927\u4e8e\u3000\u3000"},{oper:"ge",text:"\u5927\u4e8e\u7b49\u4e8e"},{oper:"bw",text:"\u5f00\u59cb\u4e8e"},{oper:"bn",text:"\u4e0d\u5f00\u59cb\u4e8e"},{oper:"in",text:"\u5c5e\u4e8e\u3000\u3000"},{oper:"ni",text:"\u4e0d\u5c5e\u4e8e"},{oper:"ew",text:"\u7ed3\u675f\u4e8e"},{oper:"en",text:"\u4e0d\u7ed3\u675f\u4e8e"},{oper:"cn",text:"\u5305\u542b\u3000\u3000"},{oper:"nc",text:"\u4e0d\u5305\u542b"},{oper:"nu",text:"\u4e0d\u5b58\u5728"},{oper:"nn",text:"\u5b58\u5728"}],groupOps:[{op:"AND",text:"\u6240\u6709"},{op:"OR",text:"\u4efb\u4e00"}]},edit:{addCaption:"\u6dfb\u52a0\u8bb0\u5f55",editCaption:"\u7f16\u8f91\u8bb0\u5f55",bSubmit:"\u63d0\u4ea4",bCancel:"\u53d6\u6d88",bClose:"\u5173\u95ed",saveData:"\u6570\u636e\u5df2\u6539\u53d8\uff0c\u662f\u5426\u4fdd\u5b58\uff1f",bYes:"\u662f",bNo:"\u5426",bExit:"\u53d6\u6d88",msg:{required:"\u6b64\u5b57\u6bb5\u5fc5\u9700",number:"\u8bf7\u8f93\u5165\u6709\u6548\u6570\u5b57",minValue:"\u8f93\u5165\u503c\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e ",maxValue:"\u8f93\u5165\u503c\u5fc5\u987b\u5c0f\u4e8e\u7b49\u4e8e ",email:"\u8fd9\u4e0d\u662f\u6709\u6548\u7684e-mail\u5730\u5740",integer:"\u8bf7\u8f93\u5165\u6709\u6548\u6574\u6570",date:"\u8bf7\u8f93\u5165\u6709\u6548\u65e5\u671f",url:"\u65e0\u6548\u7f51\u5740\u3002\u524d\u7f00\u5fc5\u987b\u4e3a ('http://' \u6216 'https://')",nodefined:" \u672a\u5b9a\u4e49\uff01",novalue:" \u9700\u8981\u8fd4\u56de\u503c\uff01",customarray:"\u81ea\u5b9a\u4e49\u51fd\u6570\u9700\u8981\u8fd4\u56de\u6570\u7ec4\uff01",customfcheck:"\u5fc5\u987b\u6709\u81ea\u5b9a\u4e49\u51fd\u6570!"}},view:{caption:"\u67e5\u770b\u8bb0\u5f55",bClose:"\u5173\u95ed"},del:{caption:"\u5220\u9664",msg:"\u5220\u9664\u6240\u9009\u8bb0\u5f55\uff1f",bSubmit:"\u5220\u9664",bCancel:"\u53d6\u6d88"},nav:{edittext:"",edittitle:"\u7f16\u8f91\u6240\u9009\u8bb0\u5f55",addtext:"",addtitle:"\u6dfb\u52a0\u65b0\u8bb0\u5f55",deltext:"",deltitle:"\u5220\u9664\u6240\u9009\u8bb0\u5f55",searchtext:"",searchtitle:"\u7b5b\u9009",refreshtext:"",refreshtitle:"\u5237\u65b0\u8868\u683c",alertcap:"\u6ce8\u610f",alerttext:"\u8bf7\u9009\u62e9\u8bb0\u5f55",viewtext:"",viewtitle:"\u67e5\u770b\u6240\u9009\u8bb0\u5f55"},col:{caption:"\u9009\u62e9\u5217",bSubmit:"\u786e\u5b9a",bCancel:"\u53d6\u6d88"},errors:{errcap:"\u9519\u8bef",nourl:"\u6ca1\u6709\u8bbe\u7f6eurl",norecords:"\u6ca1\u6709\u8981\u5904\u7406\u7684\u8bb0\u5f55",model:"colNames \u548c colModel \u957f\u5ea6\u4e0d\u7b49\uff01"},formatter:{integer:{thousandsSeparator:",",defaultValue:"0"},number:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,defaultValue:"0.00"},currency:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"",suffix:"",defaultValue:"0.00"},date:{dayNames:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],monthNames:["\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d","\u5341","\u5341\u4e00","\u5341\u4e8c","\u4e00\u6708","\u4e8c\u6708","\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708"],AmPm:["am","pm","\u4e0a\u5348","\u4e0b\u5348"],S:function(t){return t<11||t>13?["st","nd","rd","th"][Math.min((t-1)%10,3)]:"th"},srcformat:"Y-m-d",newformat:"Y-m-d",parseRe:/[#%\\\/:_;.,\t\s-]/,masks:{ISO8601Long:"Y-m-d H:i:s",ISO8601Short:"Y-m-d",ShortDate:"n/j/Y",LongDate:"l, F d, Y",FullDateTime:"l, F d, Y g:i:s A",MonthDay:"F d",ShortTime:"g:i A",LongTime:"g:i:s A",SortableDateTime:"Y-m-d\\TH:i:s",UniversalSortableDateTime:"Y-m-d H:i:sO",YearMonth:"F, Y"},reformatAfterEdit:!1,userLocalTime:!1},baseLinkUrl:"",showAction:"",target:"",checkbox:{disabled:!0},idName:"id"}})}(jQuery),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function($){"use strict";function _pivotfilter(t,e){var i,n,r,a=[];if(!this||"function"!=typeof t||t instanceof RegExp)throw new TypeError;for(r=this.length,i=0;i<r;i++)if(this.hasOwnProperty(i)&&(n=this[i],t.call(e,n,i,this))){a.push(n);break}return a}$.jgrid=$.jgrid||{},$.jgrid.hasOwnProperty("defaults")||($.jgrid.defaults={}),$.extend($.jgrid,{version:"5.0.0",htmlDecode:function(t){return t&&("&nbsp;"===t||"&#160;"===t||1===t.length&&160===t.charCodeAt(0))?"":t?String(t).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&"):t},htmlEncode:function(t){return t?String(t).replace(/&/g,"&amp;").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):t},template:function(t){var e,i=$.makeArray(arguments).slice(1),n=i.length;return null==t&&(t=""),t.replace(/\{([\w\-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,function(t,r){if(!isNaN(parseInt(r,10)))return i[parseInt(r,10)];for(e=0;e<n;e++)if($.isArray(i[e]))for(var a=i[e],o=a.length;o--;)if(r===a[o].nm)return a[o].v})},msie:"Microsoft Internet Explorer"===navigator.appName,msiever:function(){var t=-1,e=navigator.userAgent,i=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");return null!=i.exec(e)&&(t=parseFloat(RegExp.$1)),t},getCellIndex:function(t){var e=$(t);return e.is("tr")?-1:(e=(e.is("td")||e.is("th")?e:e.closest("td,th"))[0],$.jgrid.msie?$.inArray(e,e.parentNode.cells):e.cellIndex)},stripHtml:function(t){t=String(t);var e=/<("[^"]*"|'[^']*'|[^'">])*>/gi;return t?(t=t.replace(e,""),t&&"&nbsp;"!==t&&"&#160;"!==t?t.replace(/\"/g,"'"):""):t},stripPref:function(t,e){var i=$.type(t);return"string"!==i&&"number"!==i||(t=String(t),e=""!==t?String(e).replace(String(t),""):e),e},parse:function(jsonString){var js=jsonString;return"while(1);"===js.substr(0,9)&&(js=js.substr(9)),"/*"===js.substr(0,2)&&(js=js.substr(2,js.length-4)),js||(js="{}"),$.jgrid.useJSON===!0&&"object"==typeof JSON&&"function"==typeof JSON.parse?JSON.parse(js):eval("("+js+")")},parseDate:function(t,e,i,n){var r,a,o,s=/\\.|[dDjlNSwzWFmMntLoYyaABgGhHisueIOPTZcrU]/g,l=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,d=/[^-+\dA-Z]/g,h=new RegExp("^/Date\\((([-+])?[0-9]+)(([-+])([0-9]{2})([0-9]{2}))?\\)/$"),c="string"==typeof e?e.match(h):null,u=function(t,e){for(t=String(t),e=parseInt(e,10)||2;t.length<e;)t="0"+t;return t},p={m:1,d:1,y:1970,h:0,i:0,s:0,u:0},f=0,m=function(t,e){return 0===t?12===e&&(e=0):12!==e&&(e+=12),e},g=0;if(void 0===n&&(n=$.jgrid.getRegional(this,"formatter.date")),void 0===n.parseRe&&(n.parseRe=/[#%\\\/:_;.,\t\s-]/),n.masks.hasOwnProperty(t)&&(t=n.masks[t]),e&&null!=e)if(isNaN(e-0)||"u"!==String(t).toLowerCase())if(e.constructor===Date)f=e;else if(null!==c)f=new Date(parseInt(c[1],10)),c[3]&&(g=60*Number(c[5])+Number(c[6]),g*="-"===c[4]?1:-1,g-=f.getTimezoneOffset(),f.setTime(Number(Number(f)+60*g*1e3)));else{for("ISO8601Long"===n.srcformat&&"Z"===e.charAt(e.length-1)&&(g-=(new Date).getTimezoneOffset()),e=String(e).replace(/\T/g,"#").replace(/\t/,"%").split(n.parseRe),t=t.replace(/\T/g,"#").replace(/\t/,"%").split(n.parseRe),a=0,o=t.length;a<o;a++){switch(t[a]){case"M":r=$.inArray(e[a],n.monthNames),r!==-1&&r<12&&(e[a]=r+1,p.m=e[a]);break;case"F":r=$.inArray(e[a],n.monthNames,12),r!==-1&&r>11&&(e[a]=r+1-12,p.m=e[a]);break;case"n":t[a]="m";break;case"j":t[a]="d";break;case"a":r=$.inArray(e[a],n.AmPm),r!==-1&&r<2&&e[a]===n.AmPm[r]&&(e[a]=r,p.h=m(e[a],p.h));break;case"A":r=$.inArray(e[a],n.AmPm),r!==-1&&r>1&&e[a]===n.AmPm[r]&&(e[a]=r-2,p.h=m(e[a],p.h));break;case"g":p.h=parseInt(e[a],10)}void 0!==e[a]&&(p[t[a].toLowerCase()]=parseInt(e[a],10))}if(p.f&&(p.m=p.f),0===p.m&&0===p.y&&0===p.d)return"&#160;";p.m=parseInt(p.m,10)-1;var _=p.y;_>=70&&_<=99?p.y=1900+p.y:_>=0&&_<=69&&(p.y=2e3+p.y),f=new Date(p.y,p.m,p.d,p.h,p.i,p.s,p.u),g>0&&f.setTime(Number(Number(f)+60*g*1e3))}else f=new Date(1e3*parseFloat(e));else f=new Date(p.y,p.m,p.d,p.h,p.i,p.s,p.u);if(n.userLocalTime&&0===g&&(g-=(new Date).getTimezoneOffset(),g>0&&f.setTime(Number(Number(f)+60*g*1e3))),void 0===i)return f;n.masks.hasOwnProperty(i)?i=n.masks[i]:i||(i="Y-m-d");var y=f.getHours(),v=f.getMinutes(),b=f.getDate(),w=f.getMonth()+1,x=f.getTimezoneOffset(),k=f.getSeconds(),L=f.getMilliseconds(),C=f.getDay(),T=f.getFullYear(),M=(C+6)%7+1,P=(new Date(T,w-1,b)-new Date(T,0,1))/864e5,D={d:u(b),D:n.dayNames[C],j:b,l:n.dayNames[C+7],N:M,S:n.S(b),w:C,z:P,W:M<5?Math.floor((P+M-1)/7)+1:Math.floor((P+M-1)/7)||((new Date(T-1,0,1).getDay()+6)%7<4?53:52),F:n.monthNames[w-1+12],m:u(w),M:n.monthNames[w-1],n:w,t:"?",L:"?",o:"?",Y:T,y:String(T).substring(2),
a:y<12?n.AmPm[0]:n.AmPm[1],A:y<12?n.AmPm[2]:n.AmPm[3],B:"?",g:y%12||12,G:y,h:u(y%12||12),H:u(y),i:u(v),s:u(k),u:L,e:"?",I:"?",O:(x>0?"-":"+")+u(100*Math.floor(Math.abs(x)/60)+Math.abs(x)%60,4),P:"?",T:(String(f).match(l)||[""]).pop().replace(d,""),Z:"?",c:"?",r:"?",U:Math.floor(f/1e3)};return i.replace(s,function(t){return D.hasOwnProperty(t)?D[t]:t.substring(1)})},jqID:function(t){return String(t).replace(/[!"#$%&'()*+,.\/:; <=>?@\[\\\]\^`{|}~]/g,"\\$&")},guid:1,uidPref:"jqg",randId:function(t){return(t||$.jgrid.uidPref)+$.jgrid.guid++},getAccessor:function(t,e){var i,n,r,a=[];if("function"==typeof e)return e(t);if(i=t[e],void 0===i)try{if("string"==typeof e&&(a=e.split(".")),r=a.length)for(i=t;i&&r--;)n=a.shift(),i=i[n]}catch(t){}return i},getXmlData:function(t,e,i){var n,r="string"==typeof e?e.match(/^(.*)\[(\w+)\]$/):null;return"function"==typeof e?e(t):r&&r[2]?r[1]?$(r[1],t).attr(r[2]):$(t).attr(r[2]):(n=$(e,t),i?n:n.length>0?$(n).text():void 0)},cellWidth:function(){var t=$("<div class='ui-jqgrid' style='left:10000px'><table class='ui-jqgrid-btable ui-common-table' style='width:5px;'><tr class='jqgrow'><td style='width:5px;display:block;'></td></tr></table></div>"),e=t.appendTo("body").find("td").width();return t.remove(),Math.abs(e-5)>.1},isLocalStorage:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}},getRegional:function(t,e,i){var n;return void 0!==i?i:(t.p&&t.p.regional&&$.jgrid.regional&&(n=$.jgrid.getAccessor($.jgrid.regional[t.p.regional]||{},e)),void 0===n&&(n=$.jgrid.getAccessor($.jgrid,e)),n)},isMobile:function(){try{return!!/Android|webOS|iPhone|iPad|iPod|pocket|psp|kindle|avantgo|blazer|midori|Tablet|Palm|maemo|plucker|phone|BlackBerry|symbian|IEMobile|mobile|ZuneWP7|Windows Phone|Opera Mini/i.test(navigator.userAgent)}catch(t){return!1}},cell_width:!0,ajaxOptions:{},from:function(source){var $t=this,QueryObject=function(d,q){"string"==typeof d&&(d=$.data(d));var self=this,_data=d,_usecase=!0,_trim=!1,_query=q,_stripNum=/[\$,%]/g,_lastCommand=null,_lastField=null,_orDepth=0,_negate=!1,_queuedOperator="",_sorting=[],_useProperties=!0;if("object"!=typeof d||!d.push)throw"data provides is not an array";return d.length>0&&(_useProperties="object"==typeof d[0]),this._hasData=function(){return null!==_data&&0!==_data.length},this._getStr=function(t){var e=[];return _trim&&e.push("jQuery.trim("),e.push("String("+t+")"),_trim&&e.push(")"),_usecase||e.push(".toLowerCase()"),e.join("")},this._strComp=function(t){return"string"==typeof t?".toString()":""},this._group=function(t,e){return{field:t.toString(),unique:e,items:[]}},this._toStr=function(t){return _trim&&(t=$.trim(t)),t=t.toString().replace(/\\/g,"\\\\").replace(/\"/g,'\\"'),_usecase?t:t.toLowerCase()},this._funcLoop=function(t){var e=[];return $.each(_data,function(i,n){e.push(t(n))}),e},this._append=function(t){var e;for(null===_query?_query="":_query+=""===_queuedOperator?" && ":_queuedOperator,e=0;e<_orDepth;e++)_query+="(";_negate&&(_query+="!"),_query+="("+t+")",_negate=!1,_queuedOperator="",_orDepth=0},this._setCommand=function(t,e){_lastCommand=t,_lastField=e},this._resetNegate=function(){_negate=!1},this._repeatCommand=function(t,e){return null===_lastCommand?self:null!==t&&null!==e?_lastCommand(t,e):null===_lastField?_lastCommand(t):_useProperties?_lastCommand(_lastField,t):_lastCommand(t)},this._equals=function(t,e){return 0===self._compare(t,e,1)},this._compare=function(t,e,i){var n=Object.prototype.toString;return void 0===i&&(i=1),void 0===t&&(t=null),void 0===e&&(e=null),null===t&&null===e?0:null===t&&null!==e?1:null!==t&&null===e?-1:"[object Date]"===n.call(t)&&"[object Date]"===n.call(e)?t<e?-i:t>e?i:0:(_usecase||"number"==typeof t||"number"==typeof e||(t=String(t),e=String(e)),t<e?-i:t>e?i:0)},this._performSort=function(){0!==_sorting.length&&(_data=self._doSort(_data,0))},this._doSort=function(t,e){var i=_sorting[e].by,n=_sorting[e].dir,r=_sorting[e].type,a=_sorting[e].datefmt,o=_sorting[e].sfunc;if(e===_sorting.length-1)return self._getOrder(t,i,n,r,a,o);e++;var s,l,d,h=self._getGroup(t,i,n,r,a),c=[];for(s=0;s<h.length;s++)for(d=self._doSort(h[s].items,e),l=0;l<d.length;l++)c.push(d[l]);return c},this._getOrder=function(t,e,i,n,r,a){var o,s,l,d,h=[],c=[],u="a"===i?1:-1;void 0===n&&(n="text"),d="float"===n||"number"===n||"currency"===n||"numeric"===n?function(t){var e=parseFloat(String(t).replace(_stripNum,""));return isNaN(e)?Number.NEGATIVE_INFINITY:e}:"int"===n||"integer"===n?function(t){return t?parseFloat(String(t).replace(_stripNum,"")):Number.NEGATIVE_INFINITY}:"date"===n||"datetime"===n?function(t){return $.jgrid.parseDate.call($t,r,t).getTime()}:$.isFunction(n)?n:function(t){return t=t?$.trim(String(t)):"",_usecase?t:t.toLowerCase()},$.each(t,function(t,i){s=""!==e?$.jgrid.getAccessor(i,e):i,void 0===s&&(s=""),s=d(s,i),c.push({vSort:s,index:t})}),$.isFunction(a)?c.sort(function(t,e){return t=t.vSort,e=e.vSort,a.call(this,t,e,u)}):c.sort(function(t,e){return t=t.vSort,e=e.vSort,self._compare(t,e,u)}),l=0;for(var p=t.length;l<p;)o=c[l].index,h.push(t[o]),l++;return h},this._getGroup=function(t,e,i,n,r){var a,o=[],s=null,l=null;return $.each(self._getOrder(t,e,i,n,r),function(t,i){a=$.jgrid.getAccessor(i,e),null==a&&(a=""),self._equals(l,a)||(l=a,null!==s&&o.push(s),s=self._group(e,a)),s.items.push(i)}),null!==s&&o.push(s),o},this.ignoreCase=function(){return _usecase=!1,self},this.useCase=function(){return _usecase=!0,self},this.trim=function(){return _trim=!0,self},this.noTrim=function(){return _trim=!1,self},this.execute=function(){var match=_query,results=[];return null===match?self:($.each(_data,function(){eval(match)&&results.push(this)}),_data=results,self)},this.data=function(){return _data},this.select=function(t){if(self._performSort(),!self._hasData())return[];if(self.execute(),$.isFunction(t)){var e=[];return $.each(_data,function(i,n){e.push(t(n))}),e}return _data},this.hasMatch=function(){return!!self._hasData()&&(self.execute(),_data.length>0)},this.andNot=function(t,e,i){return _negate=!_negate,self.and(t,e,i)},this.orNot=function(t,e,i){return _negate=!_negate,self.or(t,e,i)},this.not=function(t,e,i){return self.andNot(t,e,i)},this.and=function(t,e,i){return _queuedOperator=" && ",void 0===t?self:self._repeatCommand(t,e,i)},this.or=function(t,e,i){return _queuedOperator=" || ",void 0===t?self:self._repeatCommand(t,e,i)},this.orBegin=function(){return _orDepth++,self},this.orEnd=function(){return null!==_query&&(_query+=")"),self},this.isNot=function(t){return _negate=!_negate,self.is(t)},this.is=function(t){return self._append("this."+t),self._resetNegate(),self},this._compareValues=function(t,e,i,n,r){var a;a=_useProperties?"jQuery.jgrid.getAccessor(this,'"+e+"')":"this",void 0===i&&(i=null);var o=i,s=void 0===r.stype?"text":r.stype;if(null!==i)switch(s){case"int":case"integer":o=isNaN(Number(o))||""===o?"0":o,a="parseInt("+a+",10)",o="parseInt("+o+",10)";break;case"float":case"number":case"numeric":o=String(o).replace(_stripNum,""),o=isNaN(Number(o))||""===o?"0":o,a="parseFloat("+a+")",o="parseFloat("+o+")";break;case"date":case"datetime":o=String($.jgrid.parseDate.call($t,r.srcfmt||"Y-m-d",o).getTime()),a='jQuery.jgrid.parseDate.call(jQuery("#'+$.jgrid.jqID($t.p.id)+'")[0],"'+r.srcfmt+'",'+a+").getTime()";break;default:a=self._getStr(a),o=self._getStr('"'+self._toStr(o)+'"')}return self._append(a+" "+n+" "+o),self._setCommand(t,e),self._resetNegate(),self},this.equals=function(t,e,i){return self._compareValues(self.equals,t,e,"==",i)},this.notEquals=function(t,e,i){return self._compareValues(self.equals,t,e,"!==",i)},this.isNull=function(t,e,i){return self._compareValues(self.equals,t,null,"===",i)},this.greater=function(t,e,i){return self._compareValues(self.greater,t,e,">",i)},this.less=function(t,e,i){return self._compareValues(self.less,t,e,"<",i)},this.greaterOrEquals=function(t,e,i){return self._compareValues(self.greaterOrEquals,t,e,">=",i)},this.lessOrEquals=function(t,e,i){return self._compareValues(self.lessOrEquals,t,e,"<=",i)},this.startsWith=function(t,e){var i=null==e?t:e,n=_trim?$.trim(i.toString()).length:i.toString().length;return _useProperties?self._append(self._getStr("jQuery.jgrid.getAccessor(this,'"+t+"')")+".substr(0,"+n+") == "+self._getStr('"'+self._toStr(e)+'"')):(null!=e&&(n=_trim?$.trim(e.toString()).length:e.toString().length),self._append(self._getStr("this")+".substr(0,"+n+") == "+self._getStr('"'+self._toStr(t)+'"'))),self._setCommand(self.startsWith,t),self._resetNegate(),self},this.endsWith=function(t,e){var i=null==e?t:e,n=_trim?$.trim(i.toString()).length:i.toString().length;return _useProperties?self._append(self._getStr("jQuery.jgrid.getAccessor(this,'"+t+"')")+".substr("+self._getStr("jQuery.jgrid.getAccessor(this,'"+t+"')")+".length-"+n+","+n+') == "'+self._toStr(e)+'"'):self._append(self._getStr("this")+".substr("+self._getStr("this")+'.length-"'+self._toStr(t)+'".length,"'+self._toStr(t)+'".length) == "'+self._toStr(t)+'"'),self._setCommand(self.endsWith,t),self._resetNegate(),self},this.contains=function(t,e){return _useProperties?self._append(self._getStr("jQuery.jgrid.getAccessor(this,'"+t+"')")+'.indexOf("'+self._toStr(e)+'",0) > -1'):self._append(self._getStr("this")+'.indexOf("'+self._toStr(t)+'",0) > -1'),self._setCommand(self.contains,t),self._resetNegate(),self},this.groupBy=function(t,e,i,n){return self._hasData()?self._getGroup(_data,t,e,i,n):null},this.orderBy=function(t,e,i,n,r){return e=null==e?"a":$.trim(e.toString().toLowerCase()),null==i&&(i="text"),null==n&&(n="Y-m-d"),null==r&&(r=!1),"desc"!==e&&"descending"!==e||(e="d"),"asc"!==e&&"ascending"!==e||(e="a"),_sorting.push({by:t,dir:e,type:i,datefmt:n,sfunc:r}),self},self};return new QueryObject(source,null)},getMethod:function(t){return this.getAccessor($.fn.jqGrid,t)},extend:function(t){$.extend($.fn.jqGrid,t),this.no_legacy_api||$.fn.extend(t)},clearBeforeUnload:function(t){var e,i=$("#"+$.jgrid.jqID(t))[0];if(i.grid){e=i.grid,$.isFunction(e.emptyRows)&&e.emptyRows.call(i,!0,!0),$(document).unbind("mouseup.jqGrid"+i.p.id),$(e.hDiv).unbind("mousemove"),$(i).unbind();var n,r=e.headers.length,a=["formatCol","sortData","updatepager","refreshIndex","setHeadCheckBox","constructTr","formatter","addXmlData","addJSONData","grid","p"];for(n=0;n<r;n++)e.headers[n].el=null;for(n in e)e.hasOwnProperty(n)&&(e[n]=null);for(n in i.p)i.p.hasOwnProperty(n)&&(i.p[n]=$.isArray(i.p[n])?[]:null);for(r=a.length,n=0;n<r;n++)i.hasOwnProperty(a[n])&&(i[a[n]]=null,delete i[a[n]])}},gridUnload:function(t){if(t){t=$.trim(t),0===t.indexOf("#")&&(t=t.substring(1));var e=$("#"+$.jgrid.jqID(t))[0];if(e.grid){var i={id:$(e).attr("id"),cl:$(e).attr("class")};e.p.pager&&$(e.p.pager).unbind().empty().removeClass("ui-state-default ui-jqgrid-pager ui-corner-bottom");var n=document.createElement("table");n.className=i.cl;var r=$.jgrid.jqID(e.id);$(n).removeClass("ui-jqgrid-btable ui-common-table").insertBefore("#gbox_"+r),1===$(e.p.pager).parents("#gbox_"+r).length&&$(e.p.pager).insertBefore("#gbox_"+r),$.jgrid.clearBeforeUnload(t),$("#gbox_"+r).remove(),$(n).attr({id:i.id}),$("#alertmod_"+$.jgrid.jqID(t)).remove()}}},gridDestroy:function(t){if(t){t=$.trim(t),0===t.indexOf("#")&&(t=t.substring(1));var e=$("#"+$.jgrid.jqID(t))[0];if(e.grid){e.p.pager&&$(e.p.pager).remove();try{$.jgrid.clearBeforeUnload(t),$("#gbox_"+$.jgrid.jqID(t)).remove()}catch(t){}}}},styleUI:{jQueryUI:{common:{disabled:"ui-state-disabled",highlight:"ui-state-highlight",hover:"ui-state-hover",cornerall:"ui-corner-all",cornertop:"ui-corner-top",cornerbottom:"ui-corner-bottom",hidden:"ui-helper-hidden",icon_base:"ui-icon",overlay:"ui-widget-overlay",active:"ui-state-active",error:"ui-state-error",button:"ui-state-default ui-corner-all",content:"ui-widget-content"},base:{entrieBox:"ui-widget ui-widget-content ui-corner-all",viewBox:"",headerTable:"",headerBox:"ui-state-default",rowTable:"",rowBox:"ui-widget-content",footerTable:"",footerBox:"ui-widget-content",headerDiv:"ui-state-default",gridtitleBox:"ui-widget-header ui-corner-top ui-helper-clearfix",customtoolbarBox:"ui-state-default",loadingBox:"ui-state-default ui-state-active",rownumBox:"ui-state-default",scrollBox:"ui-widget-content",multiBox:"cbox",pagerBox:"ui-state-default ui-corner-bottom",toppagerBox:"ui-state-default",pgInput:"ui-corner-all",pgSelectBox:"ui-widget-content ui-corner-all",pgButtonBox:"ui-corner-all",icon_first:"ui-icon-seek-first",icon_prev:"ui-icon-seek-prev",icon_next:"ui-icon-seek-next",icon_end:"ui-icon-seek-end",icon_asc:"ui-icon-triangle-1-n",icon_desc:"ui-icon-triangle-1-s",icon_caption_open:"ui-icon-circle-triangle-n",icon_caption_close:"ui-icon-circle-triangle-s"},modal:{modal:"ui-widget ui-widget-content ui-corner-all",header:"ui-widget-header ui-corner-all ui-helper-clearfix",content:"ui-widget-content",resizable:"ui-resizable-handle ui-resizable-se",icon_close:"ui-icon-closethick",icon_resizable:"ui-icon-gripsmall-diagonal-se"},celledit:{inputClass:"ui-widget-content ui-corner-all"},inlinedit:{inputClass:"ui-widget-content ui-corner-all",icon_edit_nav:"ui-icon-pencil",icon_add_nav:"ui-icon-plus",icon_save_nav:"ui-icon-disk",icon_cancel_nav:"ui-icon-cancel"},formedit:{inputClass:"ui-widget-content ui-corner-all",icon_prev:"ui-icon-triangle-1-w",icon_next:"ui-icon-triangle-1-e",icon_save:"ui-icon-disk",icon_close:"ui-icon-close",icon_del:"ui-icon-scissors",icon_cancel:"ui-icon-cancel"},navigator:{icon_edit_nav:"ui-icon-pencil",icon_add_nav:"ui-icon-plus",icon_del_nav:"ui-icon-trash",icon_search_nav:"ui-icon-search",icon_refresh_nav:"ui-icon-refresh",icon_view_nav:"ui-icon-document",icon_newbutton_nav:"ui-icon-newwin"},grouping:{icon_plus:"ui-icon-circlesmall-plus",icon_minus:"ui-icon-circlesmall-minus"},filter:{table_widget:"ui-widget ui-widget-content",srSelect:"ui-widget-content ui-corner-all",srInput:"ui-widget-content ui-corner-all",menu_widget:"ui-widget ui-widget-content ui-corner-all",icon_search:"ui-icon-search",icon_reset:"ui-icon-arrowreturnthick-1-w",icon_query:"ui-icon-comment"},subgrid:{icon_plus:"ui-icon-plus",icon_minus:"ui-icon-minus",icon_open:"ui-icon-carat-1-sw"},treegrid:{icon_plus:"ui-icon-triangle-1-",icon_minus:"ui-icon-triangle-1-s",icon_leaf:"ui-icon-radio-off"},fmatter:{icon_edit:"ui-icon-pencil",icon_add:"ui-icon-plus",icon_save:"ui-icon-disk",icon_cancel:"ui-icon-cancel",icon_del:"ui-icon-trash"}},Bootstrap:{common:{disabled:"ui-disabled",highlight:"success",hover:"active",cornerall:"",cornertop:"",cornerbottom:"",hidden:"",icon_base:"glyphicon",overlay:"ui-overlay",active:"active",error:"bg-danger",button:"btn btn-default",content:""},base:{entrieBox:"",viewBox:"table-responsive",headerTable:"table table-bordered",headerBox:"",rowTable:"table table-bordered",rowBox:"",footerTable:"table table-bordered",footerBox:"",headerDiv:"",gridtitleBox:"",customtoolbarBox:"",loadingBox:"row",rownumBox:"active",scrollBox:"",multiBox:"checkbox",pagerBox:"",toppagerBox:"",pgInput:"form-control",pgSelectBox:"form-control",pgButtonBox:"",icon_first:"glyphicon-step-backward",icon_prev:"glyphicon-backward",icon_next:"glyphicon-forward",icon_end:"glyphicon-step-forward",icon_asc:"glyphicon-triangle-top",icon_desc:"glyphicon-triangle-bottom",icon_caption_open:"glyphicon-circle-arrow-up",icon_caption_close:"glyphicon-circle-arrow-down"},modal:{modal:"modal-content",header:"modal-header",title:"modal-title",content:"modal-body",resizable:"ui-resizable-handle ui-resizable-se",icon_close:"glyphicon-remove-circle",icon_resizable:""},celledit:{inputClass:"form-control"},inlinedit:{inputClass:"form-control",icon_edit_nav:"glyphicon-edit",icon_add_nav:"glyphicon-plus",icon_save_nav:"glyphicon-save",icon_cancel_nav:"glyphicon-remove-circle"},formedit:{inputClass:"form-control",icon_prev:"glyphicon-step-backward",icon_next:"glyphicon-step-forward",icon_save:"glyphicon-save",icon_close:"glyphicon-remove-circle",icon_del:"glyphicon-trash",icon_cancel:"glyphicon-remove-circle"},navigator:{icon_edit_nav:"glyphicon-edit",icon_add_nav:"glyphicon-plus",icon_del_nav:"glyphicon-trash",icon_search_nav:"glyphicon-search",icon_refresh_nav:"glyphicon-refresh",icon_view_nav:"glyphicon-info-sign",icon_newbutton_nav:"glyphicon-new-window"},grouping:{icon_plus:"glyphicon-triangle-right",icon_minus:"glyphicon-triangle-bottom"},filter:{table_widget:"table table-condensed",srSelect:"form-control",srInput:"form-control",menu_widget:"",icon_search:"glyphicon-search",icon_reset:"glyphicon-refresh",icon_query:"glyphicon-comment"},subgrid:{icon_plus:"glyphicon-triangle-right",icon_minus:"glyphicon-triangle-bottom",icon_open:"glyphicon-indent-left"},treegrid:{icon_plus:"glyphicon-triangle-right",icon_minus:"glyphicon-triangle-bottom",icon_leaf:"glyphicon-unchecked"},fmatter:{icon_edit:"glyphicon-edit",icon_add:"glyphicon-plus",icon_save:"glyphicon-save",icon_cancel:"glyphicon-remove-circle",icon_del:"glyphicon-trash"}}}}),$.fn.jqGrid=function(t){if("string"==typeof t){var e=$.jgrid.getMethod(t);if(!e)throw"jqGrid - No such method: "+t;var i=$.makeArray(arguments).slice(1);return e.apply(this,i)}return this.each(function(){if(!this.grid){var e;null!=t&&void 0!==t.data&&(e=t.data,t.data=[]);var i=$.extend(!0,{url:"",height:150,page:1,rowNum:20,rowTotal:null,records:0,pager:"",pgbuttons:!0,pginput:!0,colModel:[],rowList:[],colNames:[],sortorder:"asc",sortname:"",datatype:"xml",mtype:"GET",altRows:!1,selarrrow:[],savedRow:[],shrinkToFit:!0,xmlReader:{},jsonReader:{},subGrid:!1,subGridModel:[],reccount:0,lastpage:0,lastsort:0,selrow:null,beforeSelectRow:null,onSelectRow:null,onSortCol:null,ondblClickRow:null,onRightClickRow:null,onPaging:null,onSelectAll:null,onInitGrid:null,loadComplete:null,gridComplete:null,loadError:null,loadBeforeSend:null,afterInsertRow:null,beforeRequest:null,beforeProcessing:null,onHeaderClick:null,viewrecords:!1,loadonce:!1,multiselect:!1,multikey:!1,editurl:null,search:!1,caption:"",hidegrid:!0,hiddengrid:!1,postData:{},userData:{},treeGrid:!1,treeGridModel:"nested",treeReader:{},treeANode:-1,ExpandColumn:null,tree_root_level:0,prmNames:{page:"page",rows:"rows",sort:"sidx",order:"sord",search:"_search",nd:"nd",id:"id",oper:"oper",editoper:"edit",addoper:"add",deloper:"del",subgridid:"id",npage:null,totalrows:"totalrows"},forceFit:!1,gridstate:"visible",cellEdit:!1,cellsubmit:"remote",nv:0,loadui:"enable",toolbar:[!1,""],scroll:!1,multiboxonly:!1,deselectAfterSort:!0,scrollrows:!1,autowidth:!1,scrollOffset:18,cellLayout:5,subGridWidth:20,multiselectWidth:30,gridview:!0,rownumWidth:35,rownumbers:!1,pagerpos:"center",recordpos:"right",footerrow:!1,userDataOnFooter:!1,hoverrows:!0,altclass:"ui-priority-secondary",viewsortcols:[!1,"vertical",!0],resizeclass:"",autoencode:!1,remapColumns:[],ajaxGridOptions:{},direction:"ltr",toppager:!1,headertitles:!1,scrollTimeout:40,data:[],_index:{},grouping:!1,groupingView:{groupField:[],groupOrder:[],groupText:[],groupColumnShow:[],groupSummary:[],showSummaryOnHide:!1,sortitems:[],sortnames:[],summary:[],summaryval:[],plusicon:"",minusicon:"",displayField:[],groupSummaryPos:[],formatDisplayField:[],_locgr:!1},ignoreCase:!0,cmTemplate:{},idPrefix:"",multiSort:!1,minColWidth:33,scrollPopUp:!1,scrollTopOffset:0,scrollLeftOffset:"100%",storeNavOptions:!1,regional:"en",styleUI:"jQueryUI",responsive:!1},$.jgrid.defaults,t);void 0!==e&&(i.data=e,t.data=e);var n=this,r={headers:[],cols:[],footers:[],dragStart:function(t,e,r){var a=$(this.bDiv).offset().left;this.resizing={idx:t,startX:e.pageX,sOL:e.pageX-a},this.hDiv.style.cursor="col-resize",this.curGbox=$("#rs_m"+$.jgrid.jqID(i.id),"#gbox_"+$.jgrid.jqID(i.id)),this.curGbox.css({display:"block",left:e.pageX-a,top:r[1],height:r[2]}),$(n).triggerHandler("jqGridResizeStart",[e,t]),$.isFunction(i.resizeStart)&&i.resizeStart.call(n,e,t),document.onselectstart=function(){return!1}},dragMove:function(t){if(this.resizing){var e,n,r=t.pageX-this.resizing.startX,a=this.headers[this.resizing.idx],o="ltr"===i.direction?a.width+r:a.width-r;o>33&&(this.curGbox.css({left:this.resizing.sOL+r}),i.forceFit===!0?(e=this.headers[this.resizing.idx+i.nv],n="ltr"===i.direction?e.width-r:e.width+r,n>i.minColWidth&&(a.newWidth=o,e.newWidth=n)):(this.newWidth="ltr"===i.direction?i.tblwidth+r:i.tblwidth-r,a.newWidth=o))}},dragEnd:function(t){if(this.hDiv.style.cursor="default",this.resizing){var e=this.resizing.idx,r=this.headers[e].newWidth||this.headers[e].width;r=parseInt(r,10),this.resizing=!1,$("#rs_m"+$.jgrid.jqID(i.id)).css("display","none"),i.colModel[e].width=r,this.headers[e].width=r,this.headers[e].el.style.width=r+"px",this.cols[e].style.width=r+"px",this.footers.length>0&&(this.footers[e].style.width=r+"px"),i.forceFit===!0?(r=this.headers[e+i.nv].newWidth||this.headers[e+i.nv].width,this.headers[e+i.nv].width=r,this.headers[e+i.nv].el.style.width=r+"px",this.cols[e+i.nv].style.width=r+"px",this.footers.length>0&&(this.footers[e+i.nv].style.width=r+"px"),i.colModel[e+i.nv].width=r):(i.tblwidth=this.newWidth||i.tblwidth,$("table:first",this.bDiv).css("width",i.tblwidth+"px"),$("table:first",this.hDiv).css("width",i.tblwidth+"px"),this.hDiv.scrollLeft=this.bDiv.scrollLeft,i.footerrow&&($("table:first",this.sDiv).css("width",i.tblwidth+"px"),this.sDiv.scrollLeft=this.bDiv.scrollLeft)),t&&($(n).triggerHandler("jqGridResizeStop",[r,e]),$.isFunction(i.resizeStop)&&i.resizeStop.call(n,r,e))}this.curGbox=null,document.onselectstart=function(){return!0}},populateVisible:function(){r.timer&&clearTimeout(r.timer),r.timer=null;var t=$(r.bDiv).height();if(t){var e,a,o=$("table:first",r.bDiv);if(o[0].rows.length)try{e=o[0].rows[1],a=e?$(e).outerHeight()||r.prevRowHeight:r.prevRowHeight}catch(t){a=r.prevRowHeight}if(a){r.prevRowHeight=a;var s,l,d,h=i.rowNum,c=r.scrollTop=r.bDiv.scrollTop,u=Math.round(o.position().top)-c,p=u+o.height(),f=a*h;if(p<t&&u<=0&&(void 0===i.lastpage||(parseInt((p+c+f-1)/f,10)||0)<=i.lastpage)&&(l=parseInt((t-p+f-1)/f,10)||1,p>=0||l<2||i.scroll===!0?(s=(Math.round((p+c)/f)||0)+1,u=-1):u=1),u>0&&(s=(parseInt(c/f,10)||0)+1,l=(parseInt((c+t)/f,10)||0)+2-s,d=!0),l){if(i.lastpage&&(s>i.lastpage||1===i.lastpage||s===i.page&&s===i.lastpage))return;r.hDiv.loading?r.timer=setTimeout(r.populateVisible,i.scrollTimeout):(i.page=s,d&&(r.selectionPreserver(o[0]),r.emptyRows.call(o[0],!1,!1)),r.populate(l)),i.scrollPopUp&&null!=i.lastpage&&($("#scroll_g"+i.id).show().html($.jgrid.template($.jgrid.getRegional(n,"defaults.pgtext",i.pgtext),i.page,i.lastpage)).css({top:i.scrollTopOffset+c*((parseInt(i.height,10)-45)/(parseInt(a,10)*parseInt(i.records,10)))+"px",left:i.scrollLeftOffset}),$(this).mouseout(function(){$("#scroll_g"+i.id).hide()}))}}}},scrollGrid:function(t){if(i.scroll){var e=r.bDiv.scrollTop;void 0===r.scrollTop&&(r.scrollTop=0),e!==r.scrollTop&&(r.scrollTop=e,r.timer&&clearTimeout(r.timer),r.timer=setTimeout(r.populateVisible,i.scrollTimeout))}r.hDiv.scrollLeft=r.bDiv.scrollLeft,i.footerrow&&(r.sDiv.scrollLeft=r.bDiv.scrollLeft),i.frozenColumns&&$(r.fbDiv).scrollTop(r.bDiv.scrollTop),t&&t.stopPropagation()},selectionPreserver:function(t){var e=t.p,i=e.selrow,n=e.selarrrow?$.makeArray(e.selarrrow):null,r=t.grid.bDiv.scrollLeft,a=function(){var o;if(e.selrow=null,e.selarrrow=[],e.multiselect&&n&&n.length>0)for(o=0;o<n.length;o++)n[o]!==i&&$(t).jqGrid("setSelection",n[o],!1,null);i&&$(t).jqGrid("setSelection",i,!1,null),t.grid.bDiv.scrollLeft=r,$(t).unbind(".selectionPreserver",a)};$(t).bind("jqGridGridComplete.selectionPreserver",a)}};if("TABLE"!==this.tagName.toUpperCase()||null==this.id)return void alert("Element is not a table or has no id!");if(void 0!==document.documentMode&&document.documentMode<=5)return void alert("Grid can not be used in this ('quirks') mode!");var a,o,s,l=0;for(o in $.jgrid.regional)$.jgrid.regional.hasOwnProperty(o)&&(0===l&&(a=o),l++);if(1===l&&a!==i.regional&&(i.regional=a),$(this).empty().attr("tabindex","0"),this.p=i,this.p.useProp=!!$.fn.prop,0===this.p.colNames.length)for(l=0;l<this.p.colModel.length;l++)this.p.colNames[l]=this.p.colModel[l].label||this.p.colModel[l].name;if(this.p.colNames.length!==this.p.colModel.length)return void alert($.jgrid.getRegional(this,"errors.model"));var d,h=$.jgrid.getMethod("getStyleUI"),c=n.p.styleUI+".common",u=h(c,"disabled",!0),p=h(c,"highlight",!0),f=h(c,"hover",!0),m=h(c,"cornerall",!0),g=h(c,"icon_base",!0),_=$.jgrid.msie,y=[],v=[],b=[];c=n.p.styleUI+".base",d=$("<div "+h(c,"viewBox",!1,"ui-jqgrid-view")+" role='grid'></div>"),n.p.direction=$.trim(n.p.direction.toLowerCase()),n.p._ald=!1,$.inArray(n.p.direction,["ltr","rtl"])===-1&&(n.p.direction="ltr"),s=n.p.direction,$(d).insertBefore(this),$(this).appendTo(d);var w=$("<div "+h(c,"entrieBox",!1,"ui-jqgrid")+"></div>");$(w).attr({id:"gbox_"+this.id,dir:s}).insertBefore(d),$(d).attr("id","gview_"+this.id).appendTo(w),$("<div "+h(n.p.styleUI+".common","overlay",!1,"jqgrid-overlay")+" id='lui_"+this.id+"'></div>").insertBefore(d),$("<div "+h(c,"loadingBox",!1,"loading")+" id='load_"+this.id+"'>"+$.jgrid.getRegional(n,"defaults.loadtext",this.p.loadtext)+"</div>").insertBefore(d),$(this).attr({role:"presentation","aria-multiselectable":!!this.p.multiselect,"aria-labelledby":"gbox_"+this.id});var x,k=["shiftKey","altKey","ctrlKey"],L=function(t,e){return t=parseInt(t,10),isNaN(t)?e||0:t},C=function(t,e,i,a,o,s){var l,d,h=n.p.colModel[t],c=h.align,u='style="',p=h.classes,f=h.name,m=[];return c&&(u+="text-align:"+c+";"),h.hidden===!0&&(u+="display:none;"),0===e?u+="width: "+r.headers[t].width+"px;":($.isFunction(h.cellattr)||"string"==typeof h.cellattr&&null!=$.jgrid.cellattr&&$.isFunction($.jgrid.cellattr[h.cellattr]))&&(l=$.isFunction(h.cellattr)?h.cellattr:$.jgrid.cellattr[h.cellattr],d=l.call(n,o,i,a,h,s),d&&"string"==typeof d&&(d=d.replace(/style/i,"style").replace(/title/i,"title"),d.indexOf("title")>-1&&(h.title=!1),d.indexOf("class")>-1&&(p=void 0),m=d.replace(/\-style/g,"-sti").split(/style/),2===m.length?(m[1]=$.trim(m[1].replace(/\-sti/g,"-style").replace("=","")),0!==m[1].indexOf("'")&&0!==m[1].indexOf('"')||(m[1]=m[1].substring(1)),u+=m[1].replace(/'/gi,'"')):u+='"')),m.length||(m[0]="",u+='"'),u+=(void 0!==p?' class="'+p+'"':"")+(h.title&&i?' title="'+$.jgrid.stripHtml(i)+'"':""),u+=' aria-describedby="'+n.p.id+"_"+f+'"',u+m[0]},T=function(t){return null==t||""===t?"&#160;":n.p.autoencode?$.jgrid.htmlEncode(t):String(t)},M=function(t,e,i,r,a){var o,s=n.p.colModel[i];if(void 0!==s.formatter){t=""!==String(n.p.idPrefix)?$.jgrid.stripPref(n.p.idPrefix,t):t;var l={rowId:t,colModel:s,gid:n.p.id,pos:i,styleUI:n.p.styleUI};o=$.isFunction(s.formatter)?s.formatter.call(n,e,l,r,a):$.fmatter?$.fn.fmatter.call(n,s.formatter,e,l,r,a):T(e)}else o=T(e);return o},P=function(t,e,i,n,r,a){var o,s;return o=M(t,e,i,r,"add"),s=C(i,n,o,r,t,a),'<td role="gridcell" '+s+">"+o+"</td>"},D=function(t,e,i,r,a){var o='<input role="checkbox" type="checkbox" id="jqg_'+n.p.id+"_"+t+'" '+a+' name="jqg_'+n.p.id+"_"+t+'"'+(r?'checked="checked"':"")+"/>",s=C(e,i,"",null,t,!0);return'<td role="gridcell" '+s+">"+o+"</td>"},S=function(t,e,i,n,r){var a=(parseInt(i,10)-1)*parseInt(n,10)+1+e,o=C(t,e,a,null,e,!0);return'<td role="gridcell" '+r+" "+o+">"+a+"</td>"},I=function(t){var e,i,r=[],a=0;for(i=0;i<n.p.colModel.length;i++)e=n.p.colModel[i],"cb"!==e.name&&"subgrid"!==e.name&&"rn"!==e.name&&(r[a]="local"===t?e.name:"xml"===t||"xmlstring"===t?e.xmlmap||e.name:e.jsonmap||e.name,n.p.keyName!==!1&&e.key===!0&&(n.p.keyName=r[a]),a++);return r},E=function(t){var e=n.p.remapColumns;return e&&e.length||(e=$.map(n.p.colModel,function(t,e){return e})),t&&(e=$.map(e,function(e){return e<t?null:e-t})),e},U=function(t,e){var i;this.p.deepempty?$(this.rows).slice(1).remove():(i=this.rows.length>0?this.rows[0]:null,$(this.firstChild).empty().append(i)),t&&this.p.scroll&&($(this.grid.bDiv.firstChild).css({height:"auto"}),$(this.grid.bDiv.firstChild.firstChild).css({height:"0px",display:"none"}),0!==this.grid.bDiv.scrollTop&&(this.grid.bDiv.scrollTop=0)),e===!0&&this.p.treeGrid&&!this.p.loadonce&&(this.p.data=[],this.p._index={})},O=function(){var t,e,i,r,a,o,s,l,d,h,c,u=n.p,p=u.data,f=p.length,m=u.localReader,g=u.colModel,_=m.cell,y=(u.multiselect===!0?1:0)+(u.subGrid===!0?1:0)+(u.rownumbers===!0?1:0),v=u.scroll?$.jgrid.randId():1;if("local"===u.datatype&&m.repeatitems===!0)for(d=E(y),h=I("local"),r=u.keyIndex===!1?$.isFunction(m.id)?m.id.call(n,p):m.id:u.keyIndex,t=0;t<f;t++){for(i=p[t],a=$.jgrid.getAccessor(i,r),void 0===a&&("number"==typeof r&&null!=g[r+y]&&(a=$.jgrid.getAccessor(i,g[r+y].name)),void 0===a&&(a=v+t,_&&(o=$.jgrid.getAccessor(i,_)||i,a=null!=o&&void 0!==o[r]?o[r]:a,o=null))),l={},l[m.id]=a,_&&(i=$.jgrid.getAccessor(i,_)||i),c=$.isArray(i)?d:h,e=0;e<c.length;e++)s=$.jgrid.getAccessor(i,c[e]),l[g[e+y].name]=s;$.extend(!0,p[t],l)}},j=function(){var t,e,i,r=n.p.data.length;for(t=n.p.keyName===!1||n.p.loadonce===!0?n.p.localReader.id:n.p.keyName,n.p._index=[],e=0;e<r;e++)i=$.jgrid.getAccessor(n.p.data[e],t),void 0===i&&(i=String(e+1)),n.p._index[i]=e},A=function(t,e,i,r,a){var o,s="-1",l="",d=e?"display:none;":"",h=$(n).triggerHandler("jqGridRowAttr",[r,a,t]);if("object"!=typeof h&&(h=$.isFunction(n.p.rowattr)?n.p.rowattr.call(n,r,a,t):"string"==typeof n.p.rowattr&&null!=$.jgrid.rowattr&&$.isFunction($.jgrid.rowattr[n.p.rowattr])?$.jgrid.rowattr[n.p.rowattr].call(n,r,a,t):{}),!$.isEmptyObject(h)){h.hasOwnProperty("id")&&(t=h.id,delete h.id),h.hasOwnProperty("tabindex")&&(s=h.tabindex,delete h.tabindex),h.hasOwnProperty("style")&&(d+=h.style,delete h.style),h.hasOwnProperty("class")&&(i+=" "+h["class"],delete h["class"]);try{delete h.role}catch(t){}for(o in h)h.hasOwnProperty(o)&&(l+=" "+o+"="+h[o])}return'<tr role="row" id="'+t+'" tabindex="'+s+'" class="'+i+'"'+(""===d?"":' style="'+d+'"')+l+">"},z=function(t,e,i,r){var a=new Date,o="local"!==n.p.datatype&&n.p.loadonce||"xmlstring"===n.p.datatype,s="_id_",l=n.p.xmlReader,d="local"===n.p.datatype?"local":"xml";if(o&&(n.p.data=[],n.p._index={},n.p.localReader.id=s),n.p.reccount=0,$.isXMLDoc(t)){n.p.treeANode!==-1||n.p.scroll?e=e>1?e:1:(U.call(n,!1,!0),e=1);var u,p,f,m,g,_,y,v,b,w,x=$(n),k=0,C=n.p.multiselect===!0?1:0,T=0,M=n.p.rownumbers===!0?1:0,O=[],j={},z=[],B=n.p.altRows===!0?n.p.altclass:"",R=h(c,"rowBox",!0,"jqgrow ui-row-"+n.p.direction);n.p.subGrid===!0&&(T=1,m=$.jgrid.getMethod("addSubGridCell")),l.repeatitems||(O=I(d)),g=n.p.keyName===!1?$.isFunction(l.id)?l.id.call(n,t):l.id:n.p.keyName,_=String(g).indexOf("[")===-1?O.length?function(t,e){return $(g,t).text()||e}:function(t,e){return $(l.cell,t).eq(g).text()||e}:function(t,e){return t.getAttribute(g.replace(/[\[\]]/g,""))||e},n.p.userData={},n.p.page=L($.jgrid.getXmlData(t,l.page),n.p.page),n.p.lastpage=L($.jgrid.getXmlData(t,l.total),1),n.p.records=L($.jgrid.getXmlData(t,l.records)),$.isFunction(l.userdata)?n.p.userData=l.userdata.call(n,t)||{}:$.jgrid.getXmlData(t,l.userdata,!0).each(function(){n.p.userData[this.getAttribute("name")]=$(this).text()});var F=$.jgrid.getXmlData(t,l.root,!0);F=$.jgrid.getXmlData(F,l.row,!0),F||(F=[]);var N,H=F.length,q=0,G=[],W=parseInt(n.p.rowNum,10),Z=n.p.scroll?$.jgrid.randId():1;if(H>0&&n.p.page<=0&&(n.p.page=1),F&&H){r&&(W*=r+1);var V,Y=$.isFunction(n.p.afterInsertRow),X=!1,K=$("#"+$.jgrid.jqID(n.p.id)+" tbody:first"),Q=M?h(c,"rownumBox",!1,"jqgrid-rownum"):"",J=C?h(c,"multiBox",!1,"cbox"):"";for(n.p.grouping&&(X=n.p.groupingView.groupCollapse===!0,V=$.jgrid.getMethod("groupingPrepare"));q<H;){v=F[q],b=_(v,Z+q),b=n.p.idPrefix+b,N=0===e?0:e+1,w=R+((N+q)%2===1?" "+B:"");var tt=z.length;if(z.push(""),M&&z.push(S(0,q,n.p.page,n.p.rowNum,Q)),C&&z.push(D(b,M,q,!1,J)),T&&z.push(m.call(x,C+M,q+e)),l.repeatitems){y||(y=E(C+T+M));var et=$.jgrid.getXmlData(v,l.cell,!0);$.each(y,function(t){var i=et[this];return!!i&&(f=i.textContent||i.text,j[n.p.colModel[t+C+T+M].name]=f,void z.push(P(b,f,t+C+T+M,q+e,v,j)))})}else for(u=0;u<O.length;u++)f=$.jgrid.getXmlData(v,O[u]),j[n.p.colModel[u+C+T+M].name]=f,z.push(P(b,f,u+C+T+M,q+e,v,j));if(z[tt]=A(b,X,w,j,v),z.push("</tr>"),n.p.grouping&&(G.push(z),n.p.groupingView._locgr||V.call(x,j,q),z=[]),(o||n.p.treeGrid===!0&&!n.p._ald)&&(j[s]=$.jgrid.stripPref(n.p.idPrefix,b),n.p.data.push(j),n.p._index[j[s]]=n.p.data.length-1),n.p.gridview===!1&&(K.append(z.join("")),x.triggerHandler("jqGridAfterInsertRow",[b,j,v]),Y&&n.p.afterInsertRow.call(n,b,j,v),z=[]),j={},k++,q++,k===W)break}}if(n.p.gridview===!0&&(p=n.p.treeANode>-1?n.p.treeANode:0,n.p.grouping?o||(x.jqGrid("groupingRender",G,n.p.colModel.length,n.p.page,W),G=null):n.p.treeGrid===!0&&p>0?$(n.rows[p]).after(z.join("")):(K.append(z.join("")),n.grid.cols=n.rows[0].cells)),n.p.subGrid===!0)try{x.jqGrid("addSubGrid",C+M)}catch(t){}if(n.p.totaltime=new Date-a,k>0&&0===n.p.records&&(n.p.records=H),z=null,n.p.treeGrid===!0)try{x.jqGrid("setTreeNode",p+1,k+p+1)}catch(t){}if(n.p.reccount=k,n.p.treeANode=-1,
n.p.userDataOnFooter&&x.jqGrid("footerData","set",n.p.userData,!0),o&&(n.p.records=H,n.p.lastpage=Math.ceil(H/W)),i||n.updatepager(!1,!0),o){for(;k<H;){if(v=F[k],b=_(v,k+Z),b=n.p.idPrefix+b,l.repeatitems){y||(y=E(C+T+M));var it=$.jgrid.getXmlData(v,l.cell,!0);$.each(y,function(t){var e=it[this];return!!e&&(f=e.textContent||e.text,void(j[n.p.colModel[t+C+T+M].name]=f))})}else for(u=0;u<O.length;u++)f=$.jgrid.getXmlData(v,O[u]),j[n.p.colModel[u+C+T+M].name]=f;j[s]=$.jgrid.stripPref(n.p.idPrefix,b),n.p.grouping&&V.call(x,j,k),n.p.data.push(j),n.p._index[j[s]]=n.p.data.length-1,j={},k++}n.p.grouping&&(n.p.groupingView._locgr=!0,x.jqGrid("groupingRender",G,n.p.colModel.length,n.p.page,W),G=null)}}},B=function(t,e,i,r){var a=new Date;if(t){n.p.treeANode!==-1||n.p.scroll?e=e>1?e:1:(U.call(n,!1,!0),e=1);var o,s,l="_id_",d="local"!==n.p.datatype&&n.p.loadonce||"jsonstring"===n.p.datatype;d&&(n.p.data=[],n.p._index={},n.p.localReader.id=l),n.p.reccount=0,"local"===n.p.datatype?(o=n.p.localReader,s="local"):(o=n.p.jsonReader,s="json");var u,f,m,g,_,y,v,b,w,x,k,C,T=$(n),M=0,O=[],j=n.p.multiselect?1:0,z=n.p.subGrid===!0?1:0,B=n.p.rownumbers===!0?1:0,R=E(j+z+B),F=I(s),N={},H=[],q=n.p.altRows===!0?n.p.altclass:"",G=h(c,"rowBox",!0,"jqgrow ui-row-"+n.p.direction);n.p.page=L($.jgrid.getAccessor(t,o.page),n.p.page),n.p.lastpage=L($.jgrid.getAccessor(t,o.total),1),n.p.records=L($.jgrid.getAccessor(t,o.records)),n.p.userData=$.jgrid.getAccessor(t,o.userdata)||{},z&&(_=$.jgrid.getMethod("addSubGridCell")),w=n.p.keyName===!1?$.isFunction(o.id)?o.id.call(n,t):o.id:n.p.keyName,b=$.jgrid.getAccessor(t,o.root),null==b&&$.isArray(t)&&(b=t),b||(b=[]),v=b.length,f=0,v>0&&n.p.page<=0&&(n.p.page=1);var W,Z,V=parseInt(n.p.rowNum,10),Y=n.p.scroll?$.jgrid.randId():1,X=!1;r&&(V*=r+1),"local"!==n.p.datatype||n.p.deselectAfterSort||(X=!0);var K,Q=$.isFunction(n.p.afterInsertRow),J=[],tt=!1,et=$("#"+$.jgrid.jqID(n.p.id)+" tbody:first"),it=B?h(c,"rownumBox",!1,"jqgrid-rownum"):"",nt=j?h(c,"multiBox",!1,"cbox"):"";for(n.p.grouping&&(tt=n.p.groupingView.groupCollapse===!0,K=$.jgrid.getMethod("groupingPrepare"));f<v;){if(g=b[f],k=$.jgrid.getAccessor(g,w),void 0===k&&("number"==typeof w&&null!=n.p.colModel[w+j+z+B]&&(k=$.jgrid.getAccessor(g,n.p.colModel[w+j+z+B].name)),void 0===k&&(k=Y+f,0===O.length&&o.cell))){var rt=$.jgrid.getAccessor(g,o.cell)||g;k=null!=rt&&void 0!==rt[w]?rt[w]:k,rt=null}k=n.p.idPrefix+k,W=1===e?0:e,C=G+((W+f)%2===1?" "+q:""),X&&(Z=n.p.multiselect?$.inArray(k,n.p.selarrrow)!==-1:k===n.p.selrow);var at=H.length;for(H.push(""),B&&H.push(S(0,f,n.p.page,n.p.rowNum,it)),j&&H.push(D(k,B,f,Z,nt)),z&&H.push(_.call(T,j+B,f+e)),y=F,o.repeatitems&&(o.cell&&(g=$.jgrid.getAccessor(g,o.cell)||g),$.isArray(g)&&(y=R)),m=0;m<y.length;m++)u=$.jgrid.getAccessor(g,y[m]),N[n.p.colModel[m+j+z+B].name]=u,H.push(P(k,u,m+j+z+B,f+e,g,N));if(C+=Z?" "+p:"",H[at]=A(k,tt,C,N,g),H.push("</tr>"),n.p.grouping&&(J.push(H),n.p.groupingView._locgr||K.call(T,N,f),H=[]),(d||n.p.treeGrid===!0&&!n.p._ald)&&(N[l]=$.jgrid.stripPref(n.p.idPrefix,k),n.p.data.push(N),n.p._index[N[l]]=n.p.data.length-1),n.p.gridview===!1&&(et.append(H.join("")),T.triggerHandler("jqGridAfterInsertRow",[k,N,g]),Q&&n.p.afterInsertRow.call(n,k,N,g),H=[]),N={},M++,f++,M===V)break}if(n.p.gridview===!0&&(x=n.p.treeANode>-1?n.p.treeANode:0,n.p.grouping?d||(T.jqGrid("groupingRender",J,n.p.colModel.length,n.p.page,V),J=null):n.p.treeGrid===!0&&x>0?$(n.rows[x]).after(H.join("")):(et.append(H.join("")),n.grid.cols=n.rows[0].cells)),n.p.subGrid===!0)try{T.jqGrid("addSubGrid",j+B)}catch(t){}if(n.p.totaltime=new Date-a,M>0&&0===n.p.records&&(n.p.records=v),H=null,n.p.treeGrid===!0)try{T.jqGrid("setTreeNode",x+1,M+x+1)}catch(t){}if(n.p.reccount=M,n.p.treeANode=-1,n.p.userDataOnFooter&&T.jqGrid("footerData","set",n.p.userData,!0),d&&(n.p.records=v,n.p.lastpage=Math.ceil(v/V)),i||n.updatepager(!1,!0),d){for(;M<v&&b[M];){if(g=b[M],k=$.jgrid.getAccessor(g,w),void 0===k&&("number"==typeof w&&null!=n.p.colModel[w+j+z+B]&&(k=$.jgrid.getAccessor(g,n.p.colModel[w+j+z+B].name)),void 0===k&&(k=Y+M,0===O.length&&o.cell))){var ot=$.jgrid.getAccessor(g,o.cell)||g;k=null!=ot&&void 0!==ot[w]?ot[w]:k,ot=null}if(g){for(k=n.p.idPrefix+k,y=F,o.repeatitems&&(o.cell&&(g=$.jgrid.getAccessor(g,o.cell)||g),$.isArray(g)&&(y=R)),m=0;m<y.length;m++)N[n.p.colModel[m+j+z+B].name]=$.jgrid.getAccessor(g,y[m]);N[l]=$.jgrid.stripPref(n.p.idPrefix,k),n.p.grouping&&K.call(T,N,M),n.p.data.push(N),n.p._index[N[l]]=n.p.data.length-1,N={}}M++}n.p.grouping&&(n.p.groupingView._locgr=!0,T.jqGrid("groupingRender",J,n.p.colModel.length,n.p.page,V),J=null)}}},R=function(){function t(e){var i,r,a,o,s,l,h=0;if(null!=e.groups){for(r=e.groups.length&&"OR"===e.groupOp.toString().toUpperCase(),r&&g.orBegin(),i=0;i<e.groups.length;i++){h>0&&r&&g.or();try{t(e.groups[i])}catch(t){alert(t)}h++}r&&g.orEnd()}if(null!=e.rules)try{for(a=e.rules.length&&"OR"===e.groupOp.toString().toUpperCase(),a&&g.orBegin(),i=0;i<e.rules.length;i++)s=e.rules[i],o=e.groupOp.toString().toUpperCase(),m[s.op]&&s.field&&(h>0&&o&&"OR"===o&&(g=g.or()),l=d[s.field],"date"===l.stype&&l.srcfmt&&l.newfmt&&l.srcfmt!==l.newfmt&&(s.data=$.jgrid.parseDate.call(n,l.newfmt,s.data,l.srcfmt)),g=m[s.op](g,o)(s.field,s.data,d[s.field])),h++;a&&g.orEnd()}catch(t){alert(t)}}var e,i,r,a,o=n.p.multiSort?[]:"",s=[],l=!1,d={},h=[],c=[];if($.isArray(n.p.data)){var u,p,f=!!n.p.grouping&&n.p.groupingView;if($.each(n.p.colModel,function(){if(i=this.sorttype||"text","date"===i||"datetime"===i?(this.formatter&&"string"==typeof this.formatter&&"date"===this.formatter?(e=this.formatoptions&&this.formatoptions.srcformat?this.formatoptions.srcformat:$.jgrid.getRegional(n,"formatter.date.srcformat"),r=this.formatoptions&&this.formatoptions.newformat?this.formatoptions.newformat:$.jgrid.getRegional(n,"formatter.date.newformat")):e=r=this.datefmt||"Y-m-d",d[this.name]={stype:i,srcfmt:e,newfmt:r,sfunc:this.sortfunc||null}):d[this.name]={stype:i,srcfmt:"",newfmt:"",sfunc:this.sortfunc||null},n.p.grouping)for(p=0,u=f.groupField.length;p<u;p++)if(this.name===f.groupField[p]){var t=this.name;this.index&&(t=this.index),h[p]=d[t],c[p]=t}n.p.multiSort||l||this.index!==n.p.sortname&&this.name!==n.p.sortname||(o=this.name,l=!0)}),n.p.multiSort&&(o=y,s=v),n.p.treeGrid&&n.p._sort)return void $(n).jqGrid("SortTree",o,n.p.sortorder,d[o].stype||"text",d[o].srcfmt||"");var m={eq:function(t){return t.equals},ne:function(t){return t.notEquals},lt:function(t){return t.less},le:function(t){return t.lessOrEquals},gt:function(t){return t.greater},ge:function(t){return t.greaterOrEquals},cn:function(t){return t.contains},nc:function(t,e){return"OR"===e?t.orNot().contains:t.andNot().contains},bw:function(t){return t.startsWith},bn:function(t,e){return"OR"===e?t.orNot().startsWith:t.andNot().startsWith},en:function(t,e){return"OR"===e?t.orNot().endsWith:t.andNot().endsWith},ew:function(t){return t.endsWith},ni:function(t,e){return"OR"===e?t.orNot().equals:t.andNot().equals},"in":function(t){return t.equals},nu:function(t){return t.isNull},nn:function(t,e){return"OR"===e?t.orNot().isNull:t.andNot().isNull}},g=$.jgrid.from.call(n,n.p.data);if(n.p.ignoreCase&&(g=g.ignoreCase()),n.p.search===!0){var _=n.p.postData.filters;if(_)"string"==typeof _&&(_=$.jgrid.parse(_)),t(_);else try{a=d[n.p.postData.searchField],"date"===a.stype&&a.srcfmt&&a.newfmt&&a.srcfmt!==a.newfmt&&(n.p.postData.searchString=$.jgrid.parseDate.call(n,a.newfmt,n.p.postData.searchString,a.srcfmt)),g=m[n.p.postData.searchOper](g)(n.p.postData.searchField,n.p.postData.searchString,d[n.p.postData.searchField])}catch(t){}}else n.p.treeGrid&&"nested"===n.p.treeGridModel&&g.orderBy(n.p.treeReader.left_field,"asc","integer","",null);if(n.p.treeGrid&&"adjacency"===n.p.treeGridModel&&(u=0,o=null),n.p.grouping)for(p=0;p<u;p++)g.orderBy(c[p],f.groupOrder[p],h[p].stype,h[p].srcfmt);n.p.multiSort?$.each(o,function(t){g.orderBy(this,s[t],d[this].stype,d[this].srcfmt,d[this].sfunc)}):o&&n.p.sortorder&&l&&("DESC"===n.p.sortorder.toUpperCase()?g.orderBy(n.p.sortname,"d",d[o].stype,d[o].srcfmt,d[o].sfunc):g.orderBy(n.p.sortname,"a",d[o].stype,d[o].srcfmt,d[o].sfunc));var b=g.select(),w=parseInt(n.p.rowNum,10),x=b.length,k=parseInt(n.p.page,10),L=Math.ceil(x/w),C={};if(window.filterDatas=b,(n.p.search||n.p.resetsearch)&&n.p.grouping&&n.p.groupingView._locgr){n.p.groupingView.groups=[];var T,M,P,D=$.jgrid.getMethod("groupingPrepare");if(n.p.footerrow&&n.p.userDataOnFooter){for(M in n.p.userData)n.p.userData.hasOwnProperty(M)&&(n.p.userData[M]=0);P=!0}for(T=0;T<x;T++){if(P)for(M in n.p.userData)n.p.userData.hasOwnProperty(M)&&(n.p.userData[M]+=parseFloat(b[T][M]||0));D.call($(n),b[T],T,w)}}return b=n.p.treeGrid&&n.p.search?$(n).jqGrid("searchTree",b):b.slice((k-1)*w,k*w),g=null,d=null,C[n.p.localReader.total]=L,C[n.p.localReader.page]=k,C[n.p.localReader.records]=x,C[n.p.localReader.root]=b,C[n.p.localReader.userdata]=n.p.userData,b=null,C}},F=function(t,e){var i,r,a,o,s,l,d,p,m="",g=n.p.pager?$.jgrid.jqID(n.p.pager.substr(1)):"",_=g?"_"+g:"",y=n.p.toppager?"_"+n.p.toppager.substr(1):"";if(a=parseInt(n.p.page,10)-1,a<0&&(a=0),a*=parseInt(n.p.rowNum,10),s=a+n.p.reccount,n.p.scroll){var v=$("tbody:first > tr:gt(0)",n.grid.bDiv);a=s-v.length,n.p.reccount=v.length;var b=v.outerHeight()||n.grid.prevRowHeight;if(b){var w=a*b,x=parseInt(n.p.records,10)*b;$(">div:first",n.grid.bDiv).css({height:x}).children("div:first").css({height:w,display:w?"":"none"}),0===n.grid.bDiv.scrollTop&&n.p.page>1&&(n.grid.bDiv.scrollTop=n.p.rowNum*(n.p.page-1)*b)}n.grid.bDiv.scrollLeft=n.grid.hDiv.scrollLeft}if(m=n.p.pager||"",m+=n.p.toppager?m?","+n.p.toppager:n.p.toppager:""){if(d=$.jgrid.getRegional(n,"formatter.integer"),i=L(n.p.page),r=L(n.p.lastpage),$(".selbox",m)[this.p.useProp?"prop":"attr"]("disabled",!1),n.p.pginput===!0&&($("#input"+_).html($.jgrid.template($.jgrid.getRegional(n,"defaults.pgtext",n.p.pgtext)||"","<input "+h(c,"pgInput",!1,"ui-pg-input")+" type='text' size='2' maxlength='7' value='0' role='textbox'/>","<span id='sp_1_"+$.jgrid.jqID(g)+"'></span>")),n.p.toppager&&$("#input_t"+y).html($.jgrid.template($.jgrid.getRegional(n,"defaults.pgtext",n.p.pgtext)||"","<input "+h(c,"pgInput",!1,"ui-pg-input")+" type='text' size='2' maxlength='7' value='0' role='textbox'/>","<span id='sp_1_"+$.jgrid.jqID(g)+"_toppager'></span>")),$(".ui-pg-input",m).val(n.p.page),p=n.p.toppager?"#sp_1"+_+",#sp_1"+_+"_toppager":"#sp_1"+_,$(p).html($.fmatter?$.fmatter.util.NumberFormat(n.p.lastpage,d):n.p.lastpage)),n.p.viewrecords)if(0===n.p.reccount)$(".ui-paging-info",m).html($.jgrid.getRegional(n,"defaults.emptyrecords",n.p.emptyrecords));else{o=a+1,l=n.p.records,$.fmatter&&(o=$.fmatter.util.NumberFormat(o,d),s=$.fmatter.util.NumberFormat(s,d),l=$.fmatter.util.NumberFormat(l,d));var k=$.jgrid.getRegional(n,"defaults.recordtext",n.p.recordtext);$(".ui-paging-info",m).html($.jgrid.template(k,o,s,l))}n.p.pgbuttons===!0&&(i<=0&&(i=r=0),1===i||0===i?($("#first"+_+", #prev"+_).addClass(u).removeClass(f),n.p.toppager&&$("#first_t"+y+", #prev_t"+y).addClass(u).removeClass(f)):($("#first"+_+", #prev"+_).removeClass(u),n.p.toppager&&$("#first_t"+y+", #prev_t"+y).removeClass(u)),i===r||0===i?($("#next"+_+", #last"+_).addClass(u).removeClass(f),n.p.toppager&&$("#next_t"+y+", #last_t"+y).addClass(u).removeClass(f)):($("#next"+_+", #last"+_).removeClass(u),n.p.toppager&&$("#next_t"+y+", #last_t"+y).removeClass(u)))}t===!0&&n.p.rownumbers===!0&&$(">td.jqgrid-rownum",n.rows).each(function(t){$(this).html(a+1+t)}),e&&n.p.jqgdnd&&$(n).jqGrid("gridDnD","updateDnD"),$(n).triggerHandler("jqGridGridComplete"),$.isFunction(n.p.gridComplete)&&n.p.gridComplete.call(n),$(n).triggerHandler("jqGridAfterGridComplete")},N=function(){n.grid.hDiv.loading=!0,n.p.hiddengrid||$(n).jqGrid("progressBar",{method:"show",loadtype:n.p.loadui,htmlcontent:$.jgrid.getRegional(n,"defaults.loadtext",n.p.loadtext)})},H=function(){n.grid.hDiv.loading=!1,$(n).jqGrid("progressBar",{method:"hide",loadtype:n.p.loadui})},q=function(t){if(!n.grid.hDiv.loading){var e,i,r=n.p.scroll&&t===!1,a={},o=n.p.prmNames;n.p.page<=0&&(n.p.page=Math.min(1,n.p.lastpage)),null!==o.search&&(a[o.search]=n.p.search),null!==o.nd&&(a[o.nd]=(new Date).getTime()),null!==o.rows&&(a[o.rows]=n.p.rowNum),null!==o.page&&(a[o.page]=n.p.page),null!==o.sort&&(a[o.sort]=n.p.sortname),null!==o.order&&(a[o.order]=n.p.sortorder),null!==n.p.rowTotal&&null!==o.totalrows&&(a[o.totalrows]=n.p.rowTotal);var s=$.isFunction(n.p.loadComplete),l=s?n.p.loadComplete:null,d=0;if(t=t||1,t>1?null!==o.npage?(a[o.npage]=t,d=t-1,t=1):l=function(e){n.p.page++,n.grid.hDiv.loading=!1,s&&n.p.loadComplete.call(n,e),q(t-1)}:null!==o.npage&&delete n.p.postData[o.npage],n.p.grouping){$(n).jqGrid("groupingSetup");var h,c=n.p.groupingView,u="";for(h=0;h<c.groupField.length;h++){var p=c.groupField[h];$.each(n.p.colModel,function(t,e){e.name===p&&e.index&&(p=e.index)}),u+=p+" "+c.groupOrder[h]+", "}a[o.sort]=u+a[o.sort]}$.extend(n.p.postData,a);var f=n.p.scroll?n.rows.length-1:1,m=$(n).triggerHandler("jqGridBeforeRequest");if(m===!1||"stop"===m)return;if($.isFunction(n.p.datatype))return void n.p.datatype.call(n,n.p.postData,"load_"+n.p.id,f,t,d);if($.isFunction(n.p.beforeRequest)&&(m=n.p.beforeRequest.call(n),void 0===m&&(m=!0),m===!1))return;switch(e=n.p.datatype.toLowerCase()){case"json":case"jsonp":case"xml":case"script":$.ajax($.extend({url:n.p.url,type:n.p.mtype,dataType:e,data:$.isFunction(n.p.serializeGridData)?n.p.serializeGridData.call(n,n.p.postData):n.p.postData,success:function(i,a,o){return $.isFunction(n.p.beforeProcessing)&&n.p.beforeProcessing.call(n,i,a,o)===!1?void H():("xml"===e?z(i,f,t>1,d):B(i,f,t>1,d),$(n).triggerHandler("jqGridLoadComplete",[i]),l&&l.call(n,i),$(n).triggerHandler("jqGridAfterLoadComplete",[i]),r&&n.grid.populateVisible(),(n.p.loadonce||n.p.treeGrid)&&(n.p.datatype="local"),i=null,void(1===t&&H()))},error:function(e,i,r){$.isFunction(n.p.loadError)&&n.p.loadError.call(n,e,i,r),1===t&&H(),e=null},beforeSend:function(t,e){var i=!0;return $.isFunction(n.p.loadBeforeSend)&&(i=n.p.loadBeforeSend.call(n,t,e)),void 0===i&&(i=!0),i!==!1&&void N()}},$.jgrid.ajaxOptions,n.p.ajaxGridOptions));break;case"xmlstring":N(),i="string"!=typeof n.p.datastr?n.p.datastr:$.parseXML(n.p.datastr),z(i),$(n).triggerHandler("jqGridLoadComplete",[i]),s&&n.p.loadComplete.call(n,i),$(n).triggerHandler("jqGridAfterLoadComplete",[i]),n.p.datatype="local",n.p.datastr=null,H();break;case"jsonstring":N(),i="string"==typeof n.p.datastr?$.jgrid.parse(n.p.datastr):n.p.datastr,B(i),$(n).triggerHandler("jqGridLoadComplete",[i]),s&&n.p.loadComplete.call(n,i),$(n).triggerHandler("jqGridAfterLoadComplete",[i]),n.p.datatype="local",n.p.datastr=null,H();break;case"local":case"clientside":N(),n.p.datatype="local",n.p._ald=!0;var g=R();B(g,f,t>1,d),$(n).triggerHandler("jqGridLoadComplete",[g]),l&&l.call(n,g),$(n).triggerHandler("jqGridAfterLoadComplete",[g]),r&&n.grid.populateVisible(),H(),n.p._ald=!1}n.p._sort=!1}},G=function(t){$("#cb_"+$.jgrid.jqID(n.p.id),n.grid.hDiv)[n.p.useProp?"prop":"attr"]("checked",t);var e=n.p.frozenColumns?n.p.id+"_frozen":"";e&&$("#cb_"+$.jgrid.jqID(n.p.id),n.grid.fhDiv)[n.p.useProp?"prop":"attr"]("checked",t)},W=function(t,e){var i,r,a,o,l,d,p,m="<td class='ui-pg-button "+u+"'><span class='ui-separator'></span></td>",_="",y="<table class='ui-pg-table ui-common-table ui-paging-pager'><tbody><tr>",v="",b=function(t,e){var i;return $.isFunction(n.p.onPaging)&&(i=n.p.onPaging.call(n,t,e)),"stop"!==i&&(n.p.selrow=null,n.p.multiselect&&(n.p.selarrrow=[],G(!1)),n.p.savedRow=[],!0)};if(t=t.substr(1),e+="_"+t,i="pg_"+t,r=t+"_left",a=t+"_center",o=t+"_right",$("#"+$.jgrid.jqID(t)).append("<div id='"+i+"' class='ui-pager-control' role='group'><table class='ui-pg-table ui-common-table ui-pager-table'><tbody><tr><td id='"+r+"' align='left'></td><td id='"+a+"' align='center' style='white-space:pre;'></td><td id='"+o+"' align='right'></td></tr></tbody></table></div>").attr("dir","ltr"),n.p.rowList.length>0){v='<td dir="'+s+'">',v+="<select "+h(c,"pgSelectBox",!1,"ui-pg-selbox")+' role="listbox" title="'+($.jgrid.getRegional(n,"defaults.pgrecs",n.p.pgrecs)||"")+'">';var w;for(p=0;p<n.p.rowList.length;p++)w=n.p.rowList[p].toString().split(":"),1===w.length&&(w[1]=w[0]),v+='<option role="option" value="'+w[0]+'"'+(L(n.p.rowNum,0)===L(w[0],0)?' selected="selected"':"")+">"+w[1]+"</option>";v+="</select></td>"}if("rtl"===s&&(y+=v),n.p.pginput===!0&&(_="<td id='input"+e+"' dir='"+s+"'>"+$.jgrid.template($.jgrid.getRegional(n,"defaults.pgtext",n.p.pgtext)||"","<input class='ui-pg-input' type='text' size='2' maxlength='7' value='0' role='textbox'/>","<span id='sp_1_"+$.jgrid.jqID(t)+"'></span>")+"</td>"),n.p.pgbuttons===!0){var x=["first"+e,"prev"+e,"next"+e,"last"+e],k=h(c,"pgButtonBox",!0,"ui-pg-button"),C=[$.jgrid.getRegional(n,"defaults.pgfirst",n.p.pgfirst)||"",$.jgrid.getRegional(n,"defaults.pgprev",n.p.pgprev)||"",$.jgrid.getRegional(n,"defaults.pgnext",n.p.pgnext)||"",$.jgrid.getRegional(n,"defaults.pglast",n.p.pglast)||""];"rtl"===s&&(x.reverse(),C.reverse()),y+="<td id='"+x[0]+"' class='"+k+"' title='"+C[0]+"'><span "+h(c,"icon_first",!1,g)+"></span></td>",y+="<td id='"+x[1]+"' class='"+k+"'  title='"+C[1]+"'><span "+h(c,"icon_prev",!1,g)+"></span></td>",y+=""!==_?m+_+m:"",y+="<td id='"+x[2]+"' class='"+k+"' title='"+C[2]+"'><span "+h(c,"icon_next",!1,g)+"></span></td>",y+="<td id='"+x[3]+"' class='"+k+"' title='"+C[3]+"'><span "+h(c,"icon_end",!1,g)+"></span></td>"}else""!==_&&(y+=_);"ltr"===s&&(y+=v),y+="</tr></tbody></table>",n.p.viewrecords===!0&&$("td#"+t+"_"+n.p.recordpos,"#"+i).append("<div dir='"+s+"' style='text-align:"+n.p.recordpos+"' class='ui-paging-info'></div>"),$("td#"+t+"_"+n.p.pagerpos,"#"+i).append(y),d=$("#gbox_"+$.jgrid.jqID(n.p.id)).css("font-size")||"11px",$("#gbox_"+$.jgrid.jqID(n.p.id)).append("<div id='testpg' "+h(c,"entrieBox",!1,"ui-jqgrid")+" style='font-size:"+d+";visibility:hidden;' ></div>"),l=$(y).clone().appendTo("#testpg").width(),$("#testpg").remove(),l>0&&(""!==_&&(l+=50),$("td#"+t+"_"+n.p.pagerpos,"#"+i).width(l)),n.p._nvtd=[],n.p._nvtd[0]=l?Math.floor((n.p.width-l)/2):Math.floor(n.p.width/3),n.p._nvtd[1]=0,y=null,$(".ui-pg-selbox","#"+i).bind("change",function(){return!!b("records",this)&&(n.p.page=Math.round(n.p.rowNum*(n.p.page-1)/this.value-.5)+1,n.p.rowNum=this.value,n.p.pager&&$(".ui-pg-selbox",n.p.pager).val(this.value),n.p.toppager&&$(".ui-pg-selbox",n.p.toppager).val(this.value),q(),!1)}),n.p.pgbuttons===!0&&($(".ui-pg-button","#"+i).hover(function(){$(this).hasClass(u)?this.style.cursor="default":($(this).addClass(f),this.style.cursor="pointer")},function(){$(this).hasClass(u)||($(this).removeClass(f),this.style.cursor="default")}),$("#first"+$.jgrid.jqID(e)+", #prev"+$.jgrid.jqID(e)+", #next"+$.jgrid.jqID(e)+", #last"+$.jgrid.jqID(e)).click(function(){if($(this).hasClass(u))return!1;var t=L(n.p.page,1),i=L(n.p.lastpage,1),r=!1,a=!0,o=!0,s=!0,l=!0;return 0===i||1===i?(a=!1,o=!1,s=!1,l=!1):i>1&&t>=1?1===t?(a=!1,o=!1):t===i&&(s=!1,l=!1):i>1&&0===t&&(s=!1,l=!1,t=i-1),!!b(this.id.split("_")[0],this)&&(this.id==="first"+e&&a&&(n.p.page=1,r=!0),this.id==="prev"+e&&o&&(n.p.page=t-1,r=!0),this.id==="next"+e&&s&&(n.p.page=t+1,r=!0),this.id==="last"+e&&l&&(n.p.page=i,r=!0),r&&q(),!1)})),n.p.pginput===!0&&$("#"+i).on("keypress","input.ui-pg-input",function(t){var e=t.charCode||t.keyCode||0;return 13===e?!!b("user",this)&&($(this).val(L($(this).val(),1)),n.p.page=$(this).val()>0?$(this).val():n.p.page,q(),!1):this})},Z=function(t,e){var i,r=n.p.colModel,a=n.p.frozenColumns?e:n.grid.headers[t].el,o="";$("span.ui-grid-ico-sort",a).addClass(u),$(a).attr("aria-selected","false"),i="local"===n.p.datatype?r[t].name:r[t].index||r[t].name,r[t].lso?"asc"===r[t].lso?(r[t].lso+="-desc",o="desc"):"desc"===r[t].lso?(r[t].lso+="-asc",o="asc"):"asc-desc"!==r[t].lso&&"desc-asc"!==r[t].lso||(r[t].lso=""):r[t].lso=o=r[t].firstsortorder||"asc",o?($("span.s-ico",a).show(),$("span.ui-icon-"+o,a).removeClass(u),$(a).attr("aria-selected","true")):n.p.viewsortcols[0]||$("span.s-ico",a).hide();var s=y.indexOf(i);s===-1?(y.push(i),v.push(o)):o?v[s]=o:(v.splice(s,1),y.splice(s,1)),n.p.sortorder="",n.p.sortname="";for(var l=0,d=y.length;l<d;l++)l>0&&(n.p.sortname+=", "),n.p.sortname+=y[l],l!==d-1&&(n.p.sortname+=" "+v[l]);n.p.sortorder=v[d-1]},V=function(t,e,i,r,a){if(n.p.colModel[e].sortable&&!(n.p.savedRow.length>0)){if(i||(n.p.lastsort===e&&""!==n.p.sortname?"asc"===n.p.sortorder?n.p.sortorder="desc":"desc"===n.p.sortorder&&(n.p.sortorder="asc"):n.p.sortorder=n.p.colModel[e].firstsortorder||"asc",n.p.page=1),n.p.multiSort)Z(e,a);else{if(r){if(n.p.lastsort===e&&n.p.sortorder===r&&!i)return;n.p.sortorder=r}var o,s=n.grid.headers[n.p.lastsort]?n.grid.headers[n.p.lastsort].el:null,l=n.p.frozenColumns?a:n.grid.headers[e].el,d="single"===n.p.viewsortcols[1];o=$(s).find("span.ui-grid-ico-sort"),o.addClass(u),d&&$(o).css("display","none"),$(s).attr("aria-selected","false"),n.p.frozenColumns&&(o=n.grid.fhDiv.find("span.ui-grid-ico-sort"),o.addClass(u),d&&o.css("display","none"),n.grid.fhDiv.find("th").attr("aria-selected","false")),o=$(l).find("span.ui-icon-"+n.p.sortorder),o.removeClass(u),d&&o.css("display",""),$(l).attr("aria-selected","true"),n.p.viewsortcols[0]||(n.p.lastsort!==e?(n.p.frozenColumns&&n.grid.fhDiv.find("span.s-ico").hide(),$("span.s-ico",s).hide(),$("span.s-ico",l).show()):""===n.p.sortname&&$("span.s-ico",l).show()),t=t.substring(5+n.p.id.length+1),n.p.sortname=n.p.colModel[e].index||t}if("stop"===$(n).triggerHandler("jqGridSortCol",[n.p.sortname,e,n.p.sortorder]))return void(n.p.lastsort=e);if($.isFunction(n.p.onSortCol)&&"stop"===n.p.onSortCol.call(n,n.p.sortname,e,n.p.sortorder))return void(n.p.lastsort=e);if("local"===n.p.datatype?n.p.deselectAfterSort&&$(n).jqGrid("resetSelection"):(n.p.selrow=null,n.p.multiselect&&G(!1),n.p.selarrrow=[],n.p.savedRow=[]),n.p.scroll){var h=n.grid.bDiv.scrollLeft;U.call(n,!0,!1),n.grid.hDiv.scrollLeft=h}n.p.subGrid&&"local"===n.p.datatype&&$("td.sgexpanded","#"+$.jgrid.jqID(n.p.id)).each(function(){$(this).trigger("click")}),n.p._sort=!0,q(),n.p.lastsort=e,n.p.sortname!==t&&e&&(n.p.lastsort=e)}},Y=function(){var t,e,i,a,o=0,s=$.jgrid.cell_width?0:L(n.p.cellLayout,0),l=0,d=L(n.p.scrollOffset,0),h=!1,c=0;$.each(n.p.colModel,function(){if(void 0===this.hidden&&(this.hidden=!1),n.p.grouping&&n.p.autowidth){var t=$.inArray(this.name,n.p.groupingView.groupField);t>=0&&n.p.groupingView.groupColumnShow.length>t&&(this.hidden=!n.p.groupingView.groupColumnShow[t])}this.widthOrg=e=L(this.width,0),this.hidden===!1&&(o+=e+s,this.fixed?c+=e+s:l++)}),isNaN(n.p.width)&&(n.p.width=o+(n.p.shrinkToFit!==!1||isNaN(n.p.height)?0:d)),r.width=n.p.width,n.p.tblwidth=o,n.p.shrinkToFit===!1&&n.p.forceFit===!0&&(n.p.forceFit=!1),n.p.shrinkToFit===!0&&l>0&&(i=r.width-s*l-c,isNaN(n.p.height)||(i-=d,h=!0),o=0,$.each(n.p.colModel,function(r){this.hidden!==!1||this.fixed||(e=Math.round(i*this.width/(n.p.tblwidth-s*l-c)),this.width=e,o+=e,t=r)}),a=0,h?r.width-c-(o+s*l)!==d&&(a=r.width-c-(o+s*l)-d):h||1===Math.abs(r.width-c-(o+s*l))||(a=r.width-c-(o+s*l)),n.p.colModel[t].width+=a,n.p.tblwidth=o+a+s*l+c,n.p.tblwidth>n.p.width&&(n.p.colModel[t].width-=n.p.tblwidth-parseInt(n.p.width,10),n.p.tblwidth=n.p.width))},X=function(t){var e,i=t,r=t;for(e=t+1;e<n.p.colModel.length;e++)if(n.p.colModel[e].hidden!==!0){r=e;break}return r-i},K=function(t){var e=$(n.grid.headers[t].el),i=[e.position().left+e.outerWidth()];return"rtl"===n.p.direction&&(i[0]=n.p.width-i[0]),i[0]-=n.grid.bDiv.scrollLeft,i.push($(n.grid.hDiv).position().top),i.push($(n.grid.bDiv).offset().top-$(n.grid.hDiv).offset().top+$(n.grid.bDiv).height()),i},Q=function(t){var e,i=n.grid.headers,r=$.jgrid.getCellIndex(t);for(e=0;e<i.length;e++)if(t===i[e].el){r=e;break}return r};for(this.p.id=this.id,$.inArray(n.p.multikey,k)===-1&&(n.p.multikey=!1),n.p.keyName=!1,l=0;l<n.p.colModel.length;l++)x="string"==typeof n.p.colModel[l].template?null!=$.jgrid.cmTemplate&&"object"==typeof $.jgrid.cmTemplate[n.p.colModel[l].template]?$.jgrid.cmTemplate[n.p.colModel[l].template]:{}:n.p.colModel[l].template,n.p.colModel[l]=$.extend(!0,{},n.p.cmTemplate,x||{},n.p.colModel[l]),n.p.keyName===!1&&n.p.colModel[l].key===!0&&(n.p.keyName=n.p.colModel[l].name);if(n.p.sortorder=n.p.sortorder.toLowerCase(),$.jgrid.cell_width=$.jgrid.cellWidth(),n.p.grouping===!0&&(n.p.scroll=!1,n.p.rownumbers=!1,n.p.treeGrid=!1,n.p.gridview=!0),this.p.treeGrid===!0){try{$(this).jqGrid("setTreeGrid")}catch(t){}"local"!==n.p.datatype&&(n.p.localReader={id:"_id_"})}if(this.p.subGrid)try{$(n).jqGrid("setSubGrid")}catch(t){}this.p.multiselect&&(this.p.colNames.unshift("<input role='checkbox' id='cb_"+this.p.id+"' class='cbox' type='checkbox'/>"),this.p.colModel.unshift({name:"cb",width:$.jgrid.cell_width?n.p.multiselectWidth+n.p.cellLayout:n.p.multiselectWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,align:"center",fixed:!0,frozen:!0})),this.p.rownumbers&&(this.p.colNames.unshift(""),this.p.colModel.unshift({name:"rn",width:n.p.rownumWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,align:"center",fixed:!0,frozen:!0})),n.p.xmlReader=$.extend(!0,{root:"rows",row:"row",page:"rows>page",total:"rows>total",records:"rows>records",repeatitems:!0,cell:"cell",id:"[id]",userdata:"userdata",subgrid:{root:"rows",row:"row",repeatitems:!0,cell:"cell"}},n.p.xmlReader),n.p.jsonReader=$.extend(!0,{root:"rows",page:"page",total:"total",records:"records",repeatitems:!0,cell:"cell",id:"id",userdata:"userdata",subgrid:{root:"rows",repeatitems:!0,cell:"cell"}},n.p.jsonReader),n.p.localReader=$.extend(!0,{root:"rows",page:"page",total:"total",records:"records",repeatitems:!1,cell:"cell",id:"id",userdata:"userdata",subgrid:{root:"rows",repeatitems:!0,cell:"cell"}},n.p.localReader),n.p.scroll&&(n.p.pgbuttons=!1,n.p.pginput=!1,n.p.rowList=[]),n.p.data.length&&(O(),j());var J,tt,et,it,nt,rt,at,ot,st="<thead><tr class='ui-jqgrid-labels' role='row'>",lt="",dt="",ht="";if(n.p.shrinkToFit===!0&&n.p.forceFit===!0)for(l=n.p.colModel.length-1;l>=0;l--)if(!n.p.colModel[l].hidden){n.p.colModel[l].resizable=!1;break}if("horizontal"===n.p.viewsortcols[1]?(dt=" ui-i-asc",ht=" ui-i-desc"):"single"===n.p.viewsortcols[1]&&(dt=" ui-single-sort-asc",ht=" ui-single-sort-desc",lt=" style='display:none'",n.p.viewsortcols[0]=!1),J=_?"class='ui-th-div-ie'":"",ot="<span class='s-ico' style='display:none'>",ot+="<span sort='asc'  class='ui-grid-ico-sort ui-icon-asc"+dt+" ui-sort-"+s+" "+u+" "+g+" "+h(c,"icon_asc",!0)+"'"+lt+"></span>",ot+="<span sort='desc' class='ui-grid-ico-sort ui-icon-desc"+ht+" ui-sort-"+s+" "+u+" "+g+" "+h(c,"icon_desc",!0)+"'"+lt+"></span></span>",n.p.multiSort&&n.p.sortname)for(y=n.p.sortname.split(","),l=0;l<y.length;l++)b=$.trim(y[l]).split(" "),y[l]=$.trim(b[0]),v[l]=b[1]?$.trim(b[1]):n.p.sortorder||"asc";for(l=0;l<this.p.colNames.length;l++){var ct=n.p.headertitles?' title="'+$.jgrid.stripHtml(n.p.colNames[l])+'"':"";st+="<th id='"+n.p.id+"_"+n.p.colModel[l].name+"' role='columnheader' "+h(c,"headerBox",!1,"ui-th-column ui-th-"+s)+" "+ct+">",tt=n.p.colModel[l].index||n.p.colModel[l].name,st+="<div id='jqgh_"+n.p.id+"_"+n.p.colModel[l].name+"' "+J+">"+n.p.colNames[l],n.p.colModel[l].width?n.p.colModel[l].width=parseInt(n.p.colModel[l].width,10):n.p.colModel[l].width=150,"boolean"!=typeof n.p.colModel[l].title&&(n.p.colModel[l].title=!0),n.p.colModel[l].lso="",tt===n.p.sortname&&(n.p.lastsort=l),n.p.multiSort&&(b=$.inArray(tt,y),b!==-1&&(n.p.colModel[l].lso=v[b])),st+=ot+"</div></th>"}if(st+="</tr></thead>",ot=null,$(this).append(st),$("thead tr:first th",this).hover(function(){$(this).addClass(f)},function(){$(this).removeClass(f)}),this.p.multiselect){var ut,pt=[];$("#cb_"+$.jgrid.jqID(n.p.id),this).bind("click",function(){n.p.selarrrow=[];var t=n.p.frozenColumns===!0?n.p.id+"_frozen":"";this.checked?($(n.rows).each(function(e){e>0&&($(this).hasClass("ui-subgrid")||$(this).hasClass("jqgroup")||$(this).hasClass(u)||$(this).hasClass("jqfoot")||($("#jqg_"+$.jgrid.jqID(n.p.id)+"_"+$.jgrid.jqID(this.id))[n.p.useProp?"prop":"attr"]("checked",!0),$(this).addClass(p).attr("aria-selected","true"),n.p.selarrrow.push(this.id),n.p.selrow=this.id,t&&($("#jqg_"+$.jgrid.jqID(n.p.id)+"_"+$.jgrid.jqID(this.id),n.grid.fbDiv)[n.p.useProp?"prop":"attr"]("checked",!0),$("#"+$.jgrid.jqID(this.id),n.grid.fbDiv).addClass(p))))}),ut=!0,pt=[]):($(n.rows).each(function(e){e>0&&($(this).hasClass("ui-subgrid")||$(this).hasClass("jqgroup")||$(this).hasClass(u)||$(this).hasClass("jqfoot")||($("#jqg_"+$.jgrid.jqID(n.p.id)+"_"+$.jgrid.jqID(this.id))[n.p.useProp?"prop":"attr"]("checked",!1),$(this).removeClass(p).attr("aria-selected","false"),pt.push(this.id),t&&($("#jqg_"+$.jgrid.jqID(n.p.id)+"_"+$.jgrid.jqID(this.id),n.grid.fbDiv)[n.p.useProp?"prop":"attr"]("checked",!1),$("#"+$.jgrid.jqID(this.id),n.grid.fbDiv).removeClass(p))))}),n.p.selrow=null,ut=!1),$(n).triggerHandler("jqGridSelectAll",[ut?n.p.selarrrow:pt,ut]),$.isFunction(n.p.onSelectAll)&&n.p.onSelectAll.call(n,ut?n.p.selarrrow:pt,ut)})}if(n.p.autowidth===!0){var ft=$(w).innerWidth();n.p.width=ft>0?ft:"nw"}Y(),$(w).css("width",r.width+"px").append("<div class='ui-jqgrid-resize-mark' id='rs_m"+n.p.id+"'>&#160;</div>"),n.p.scrollPopUp&&$(w).append("<div "+h(c,"scrollBox",!1,"loading ui-scroll-popup")+" id='scroll_g"+n.p.id+"'></div>"),$(d).css("width",r.width+"px"),st=$("thead:first",n).get(0);var mt="";n.p.footerrow&&(mt+="<table role='presentation' style='width:"+n.p.tblwidth+"px' "+h(c,"footerTable",!1,"ui-jqgrid-ftable ui-common-table")+"><tbody><tr role='row' "+h(c,"footerBox",!1,"footrow footrow-"+s)+">");var gt=$("tr:first",st),_t="<tr class='jqgfirstrow' role='row'>";if(n.p.disableClick=!1,$("th",gt).each(function(t){et=n.p.colModel[t].width,void 0===n.p.colModel[t].resizable&&(n.p.colModel[t].resizable=!0),n.p.colModel[t].resizable?(it=document.createElement("span"),$(it).html("&#160;").addClass("ui-jqgrid-resize ui-jqgrid-resize-"+s).css("cursor","col-resize"),$(this).addClass(n.p.resizeclass)):it="",$(this).css("width",et+"px").prepend(it),it=null;var e="";n.p.colModel[t].hidden&&($(this).css("display","none"),e="display:none;"),_t+="<td role='gridcell' style='height:0px;width:"+et+"px;"+e+"'></td>",r.headers[t]={width:et,el:this},lt=n.p.colModel[t].sortable,"boolean"!=typeof lt&&(n.p.colModel[t].sortable=!0,lt=!0);var i=n.p.colModel[t].name;"cb"!==i&&"subgrid"!==i&&"rn"!==i&&n.p.viewsortcols[2]&&$(">div",this).addClass("ui-jqgrid-sortable"),lt&&(n.p.multiSort?n.p.viewsortcols[0]?($("div span.s-ico",this).show(),n.p.colModel[t].lso&&$("div span.ui-icon-"+n.p.colModel[t].lso,this).removeClass(u).css("display","")):n.p.colModel[t].lso&&($("div span.s-ico",this).show(),$("div span.ui-icon-"+n.p.colModel[t].lso,this).removeClass(u).css("display","")):n.p.viewsortcols[0]?($("div span.s-ico",this).show(),t===n.p.lastsort&&$("div span.ui-icon-"+n.p.sortorder,this).removeClass(u).css("display","")):t===n.p.lastsort&&""!==n.p.sortname&&($("div span.s-ico",this).show(),$("div span.ui-icon-"+n.p.sortorder,this).removeClass(u).css("display",""))),n.p.footerrow&&(mt+="<td role='gridcell' "+C(t,0,"",null,"",!1)+">&#160;</td>")}).mousedown(function(t){if(1===$(t.target).closest("th>span.ui-jqgrid-resize").length){var e=Q(this);return n.p.forceFit===!0&&(n.p.nv=X(e)),r.dragStart(e,t,K(e)),!1}}).click(function(t){if(n.p.disableClick)return n.p.disableClick=!1,!1;var e,i,r="th>div.ui-jqgrid-sortable";n.p.viewsortcols[2]||(r="th>div>span>span.ui-grid-ico-sort");var a=$(t.target).closest(r);if(1===a.length){var o;if(n.p.frozenColumns){var s=$(this)[0].id.substring(n.p.id.length+1);$(n.p.colModel).each(function(t){if(this.name===s)return o=t,!1})}else o=Q(this);return n.p.viewsortcols[2]||(e=!0,i=a.attr("sort")),null!=o&&V($("div",this)[0].id,o,e,i,this),!1}}),n.p.sortable&&$.fn.sortable)try{$(n).jqGrid("sortableColumns",gt)}catch(t){}n.p.footerrow&&(mt+="</tr></tbody></table>"),_t+="</tr>",at=document.createElement("tbody"),this.appendChild(at),$(this).addClass(h(c,"rowTable",!0,"ui-jqgrid-btable ui-common-table")).append(_t),_t=null;var yt=$("<table "+h(c,"headerTable",!1,"ui-jqgrid-htable ui-common-table")+" style='width:"+n.p.tblwidth+"px' role='presentation' aria-labelledby='gbox_"+this.id+"'></table>").append(st),vt=!(!n.p.caption||n.p.hiddengrid!==!0),bt=$("<div class='ui-jqgrid-hbox"+("rtl"===s?"-rtl":"")+"'></div>");st=null,r.hDiv=document.createElement("div"),r.hDiv.style.width=r.width+"px",r.hDiv.className=h(c,"headerDiv",!0,"ui-jqgrid-hdiv"),$(r.hDiv).append(bt),$(bt).append(yt),yt=null,vt&&$(r.hDiv).hide(),n.p.pager&&("string"==typeof n.p.pager?"#"!==n.p.pager.substr(0,1)&&(n.p.pager="#"+n.p.pager):n.p.pager="#"+$(n.p.pager).attr("id"),$(n.p.pager).css({width:r.width+"px"}).addClass(h(c,"pagerBox",!0,"ui-jqgrid-pager")).appendTo(w),
vt&&$(n.p.pager).hide(),W(n.p.pager,"")),n.p.cellEdit===!1&&n.p.hoverrows===!0&&$(n).bind("mouseover",function(t){rt=$(t.target).closest("tr.jqgrow"),"ui-subgrid"!==$(rt).attr("class")&&$(rt).addClass(f)}).bind("mouseout",function(t){rt=$(t.target).closest("tr.jqgrow"),$(rt).removeClass(f)});var wt,xt,kt;$(n).before(r.hDiv).click(function(t){if(nt=t.target,rt=$(nt,n.rows).closest("tr.jqgrow"),0===$(rt).length||rt[0].className.indexOf(u)>-1||($(nt,n).closest("table.ui-jqgrid-btable").attr("id")||"").replace("_frozen","")!==n.id)return this;var e=$(nt).hasClass("cbox"),i=$(n).triggerHandler("jqGridBeforeSelectRow",[rt[0].id,t]);if(i=i!==!1&&"stop"!==i,$.isFunction(n.p.beforeSelectRow)){var r=n.p.beforeSelectRow.call(n,rt[0].id,t);r!==!1&&"stop"!==r||(i=!1)}if("A"!==nt.tagName&&("INPUT"!==nt.tagName&&"TEXTAREA"!==nt.tagName&&"OPTION"!==nt.tagName&&"SELECT"!==nt.tagName||e)){if(wt=rt[0].id,nt=$(nt).closest("tr.jqgrow>td"),nt.length>0&&(xt=$.jgrid.getCellIndex(nt),kt=$(nt).closest("td,th").html(),$(n).triggerHandler("jqGridCellSelect",[wt,xt,kt,t]),$.isFunction(n.p.onCellSelect)&&n.p.onCellSelect.call(n,wt,xt,kt,t)),n.p.cellEdit===!0)if(n.p.multiselect&&e&&i)$(n).jqGrid("setSelection",wt,!0,t);else if(nt.length>0){wt=rt[0].rowIndex;try{$(n).jqGrid("editCell",wt,xt,!0)}catch(t){}}if(i)if(n.p.multikey)t[n.p.multikey]?$(n).jqGrid("setSelection",wt,!0,t):n.p.multiselect&&e&&(e=$("#jqg_"+$.jgrid.jqID(n.p.id)+"_"+wt).is(":checked"),$("#jqg_"+$.jgrid.jqID(n.p.id)+"_"+wt)[n.p.useProp?"prop":"attr"]("checked",!e));else if(n.p.multiselect&&n.p.multiboxonly)if(e)$(n).jqGrid("setSelection",wt,!0,t);else{var a=n.p.frozenColumns?n.p.id+"_frozen":"";$(n.p.selarrrow).each(function(t,e){var i=$(n).jqGrid("getGridRowById",e);i&&$(i).removeClass(p),$("#jqg_"+$.jgrid.jqID(n.p.id)+"_"+$.jgrid.jqID(e))[n.p.useProp?"prop":"attr"]("checked",!1),a&&($("#"+$.jgrid.jqID(e),"#"+$.jgrid.jqID(a)).removeClass(p),$("#jqg_"+$.jgrid.jqID(n.p.id)+"_"+$.jgrid.jqID(e),"#"+$.jgrid.jqID(a))[n.p.useProp?"prop":"attr"]("checked",!1))}),n.p.selarrrow=[],$(n).jqGrid("setSelection",wt,!0,t)}else $(n).jqGrid("setSelection",wt,!0,t)}}).bind("reloadGrid",function(t,e){if(n.p.treeGrid===!0&&(n.p.datatype=n.p.treedatatype),e=e||{},e.current&&n.grid.selectionPreserver(n),"local"===n.p.datatype?($(n).jqGrid("resetSelection"),n.p.data.length&&(O(),j())):n.p.treeGrid||(n.p.selrow=null,n.p.multiselect&&(n.p.selarrrow=[],G(!1)),n.p.savedRow=[]),n.p.scroll&&U.call(n,!0,!1),e.page){var i=e.page;i>n.p.lastpage&&(i=n.p.lastpage),i<1&&(i=1),n.p.page=i,n.grid.prevRowHeight?n.grid.bDiv.scrollTop=(i-1)*n.grid.prevRowHeight*n.p.rowNum:n.grid.bDiv.scrollTop=0}return n.grid.prevRowHeight&&n.p.scroll&&void 0===e.page?(delete n.p.lastpage,n.grid.populateVisible()):n.grid.populate(),n.p.inlineNav===!0&&$(n).jqGrid("showAddEditButtons"),!1}).dblclick(function(t){if(nt=t.target,rt=$(nt,n.rows).closest("tr.jqgrow"),0!==$(rt).length){wt=rt[0].rowIndex,xt=$.jgrid.getCellIndex(nt);var e=$(n).triggerHandler("jqGridDblClickRow",[$(rt).attr("id"),wt,xt,t]);return null!=e?e:$.isFunction(n.p.ondblClickRow)&&(e=n.p.ondblClickRow.call(n,$(rt).attr("id"),wt,xt,t),null!=e)?e:void 0}}).bind("contextmenu",function(t){if(nt=t.target,rt=$(nt,n.rows).closest("tr.jqgrow"),0!==$(rt).length){n.p.multiselect||$(n).jqGrid("setSelection",rt[0].id,!0,t),wt=rt[0].rowIndex,xt=$.jgrid.getCellIndex(nt);var e=$(n).triggerHandler("jqGridRightClickRow",[$(rt).attr("id"),wt,xt,t]);return null!=e?e:$.isFunction(n.p.onRightClickRow)&&(e=n.p.onRightClickRow.call(n,$(rt).attr("id"),wt,xt,t),null!=e)?e:void 0}}),r.bDiv=document.createElement("div"),_&&"auto"===String(n.p.height).toLowerCase()&&(n.p.height="100%"),$(r.bDiv).append($('<div style="position:relative;"></div>').append("<div></div>").append(this)).addClass("ui-jqgrid-bdiv").css({height:n.p.height+(isNaN(n.p.height)?"":"px"),width:r.width+"px"}).scroll(r.scrollGrid),$("table:first",r.bDiv).css({width:n.p.tblwidth+"px"}),$.support.tbody||2===$("tbody",this).length&&$("tbody:gt(0)",this).remove(),n.p.multikey&&($.jgrid.msie?$(r.bDiv).bind("selectstart",function(){return!1}):$(r.bDiv).bind("mousedown",function(){return!1})),vt&&$(r.bDiv).hide();var Lt=g+" "+h(c,"icon_caption_open",!0),Ct=g+" "+h(c,"icon_caption_close",!0);r.cDiv=document.createElement("div");var Tt=n.p.hidegrid===!0?$("<a role='link' class='ui-jqgrid-titlebar-close HeaderButton "+m+"' title='"+($.jgrid.getRegional(n,"defaults.showhide",n.p.showhide)||"")+"' />").hover(function(){Tt.addClass(f)},function(){Tt.removeClass(f)}).append("<span class='ui-jqgrid-headlink "+Lt+"'></span>").css("rtl"===s?"left":"right","0px"):"";if($(r.cDiv).append(Tt).append("<span class='ui-jqgrid-title'>"+n.p.caption+"</span>").addClass("ui-jqgrid-titlebar ui-jqgrid-caption"+("rtl"===s?"-rtl":"")+" "+h(c,"gridtitleBox",!0)),$(r.cDiv).insertBefore(r.hDiv),n.p.toolbar[0]){var $t=h(c,"customtoolbarBox",!0,"ui-userdata");r.uDiv=document.createElement("div"),"top"===n.p.toolbar[1]?$(r.uDiv).insertBefore(r.hDiv):"bottom"===n.p.toolbar[1]&&$(r.uDiv).insertAfter(r.hDiv),"both"===n.p.toolbar[1]?(r.ubDiv=document.createElement("div"),$(r.uDiv).addClass($t+" ui-userdata-top").attr("id","t_"+this.id).insertBefore(r.hDiv).width(r.width),$(r.ubDiv).addClass($t+" ui-userdata-bottom").attr("id","tb_"+this.id).insertAfter(r.hDiv).width(r.width),vt&&$(r.ubDiv).hide()):$(r.uDiv).width(r.width).addClass($t+" ui-userdata-top").attr("id","t_"+this.id),vt&&$(r.uDiv).hide()}if(n.p.toppager&&(n.p.toppager=$.jgrid.jqID(n.p.id)+"_toppager",r.topDiv=$("<div id='"+n.p.toppager+"'></div>")[0],n.p.toppager="#"+n.p.toppager,$(r.topDiv).addClass(h(c,"toppagerBox",!0,"ui-jqgrid-toppager")).width(r.width).insertBefore(r.hDiv),W(n.p.toppager,"_t")),n.p.footerrow&&(r.sDiv=$("<div class='ui-jqgrid-sdiv'></div>")[0],bt=$("<div class='ui-jqgrid-hbox"+("rtl"===s?"-rtl":"")+"'></div>"),$(r.sDiv).append(bt).width(r.width).insertAfter(r.hDiv),$(bt).append(mt),r.footers=$(".ui-jqgrid-ftable",r.sDiv)[0].rows[0].cells,n.p.rownumbers&&(r.footers[0].className=h(c,"rownumBox",!0,"jqgrid-rownum")),vt&&$(r.sDiv).hide()),bt=null,n.p.caption){var Mt=n.p.datatype;n.p.hidegrid===!0&&($(".ui-jqgrid-titlebar-close",r.cDiv).click(function(t){var e,i=$.isFunction(n.p.onHeaderClick),a=".ui-jqgrid-bdiv, .ui-jqgrid-hdiv, .ui-jqgrid-toppager, .ui-jqgrid-pager, .ui-jqgrid-sdiv",o=this;return n.p.toolbar[0]===!0&&("both"===n.p.toolbar[1]&&(a+=", #"+$(r.ubDiv).attr("id")),a+=", #"+$(r.uDiv).attr("id")),e=$(a,"#gview_"+$.jgrid.jqID(n.p.id)).length,"visible"===n.p.gridstate?$(a,"#gbox_"+$.jgrid.jqID(n.p.id)).slideUp("fast",function(){e--,0===e&&($("span",o).removeClass(Lt).addClass(Ct),n.p.gridstate="hidden",$("#gbox_"+$.jgrid.jqID(n.p.id)).hasClass("ui-resizable")&&$(".ui-resizable-handle","#gbox_"+$.jgrid.jqID(n.p.id)).hide(),$(n).triggerHandler("jqGridHeaderClick",[n.p.gridstate,t]),i&&(vt||n.p.onHeaderClick.call(n,n.p.gridstate,t)))}):"hidden"===n.p.gridstate&&$(a,"#gbox_"+$.jgrid.jqID(n.p.id)).slideDown("fast",function(){e--,0===e&&($("span",o).removeClass(Ct).addClass(Lt),vt&&(n.p.datatype=Mt,q(),vt=!1),n.p.gridstate="visible",$("#gbox_"+$.jgrid.jqID(n.p.id)).hasClass("ui-resizable")&&$(".ui-resizable-handle","#gbox_"+$.jgrid.jqID(n.p.id)).show(),$(n).triggerHandler("jqGridHeaderClick",[n.p.gridstate,t]),i&&(vt||n.p.onHeaderClick.call(n,n.p.gridstate,t)))}),!1}),vt&&(n.p.datatype="local",$(".ui-jqgrid-titlebar-close",r.cDiv).trigger("click")))}else $(r.cDiv).hide(),n.p.toppager||$(r.hDiv).addClass(h(n.p.styleUI+".common","cornertop",!0));if($(r.hDiv).after(r.bDiv).mousemove(function(t){if(r.resizing)return r.dragMove(t),!1}),$(".ui-jqgrid-labels",r.hDiv).bind("selectstart",function(){return!1}),$(document).bind("mouseup.jqGrid"+n.p.id,function(){return!r.resizing||(r.dragEnd(!0),!1)}),n.formatCol=C,n.sortData=V,n.updatepager=F,n.refreshIndex=j,n.setHeadCheckBox=G,n.constructTr=A,n.formatter=function(t,e,i,n,r){return M(t,e,i,n,r)},$.extend(r,{populate:q,emptyRows:U,beginReq:N,endReq:H}),this.grid=r,n.addXmlData=function(t){z(t)},n.addJSONData=function(t){B(t)},this.grid.cols=this.rows[0].cells,$(n).triggerHandler("jqGridInitGrid"),$.isFunction(n.p.onInitGrid)&&n.p.onInitGrid.call(n),q(),n.p.hiddengrid=!1,n.p.responsive){var Pt="onorientationchange"in window,Dt=Pt?"orientationchange":"resize";$(window).on(Dt,function(){$(n).jqGrid("resizeGrid")})}}})},$.jgrid.extend({getGridParam:function(t,e){var i,n=this[0];if(n&&n.grid){if(void 0===e&&"string"!=typeof e&&(e="jqGrid"),i=n.p,"jqGrid"!==e)try{i=$(n).data(e)}catch(t){i=n.p}return t?void 0!==i[t]?i[t]:null:i}},setGridParam:function(t,e){return this.each(function(){if(null==e&&(e=!1),this.grid&&"object"==typeof t)if(e===!0){var i=$.extend({},this.p,t);this.p=i}else $.extend(!0,this.p,t)})},getGridRowById:function(t){var e;return this.each(function(){try{for(var i=this.rows.length;i--;)if(t.toString()===this.rows[i].id){e=this.rows[i];break}}catch(i){e=$(this.grid.bDiv).find("#"+$.jgrid.jqID(t))}}),e},getDataIDs:function(){var t,e=[],i=0,n=0;return this.each(function(){if(t=this.rows.length,t&&t>0)for(;i<t;)$(this.rows[i]).hasClass("jqgrow")&&(e[n]=this.rows[i].id,n++),i++}),e},getDataFilterIDs:function(){var t=[],e=0;if(window.filterDatas){for(var e=0;e<window.filterDatas.length;e++)t[e]=window.filterDatas[e].id;return t}return[]},getDataCustomerIDs:function(){var t=[],e=0;if(window.filterDatas){for(var e=0;e<window.filterDatas.length;e++)t[e]=window.filterDatas[e].customer_id;return t}return[]},setSelection:function(t,e,i){return this.each(function(){function n(t){var e=$(c.grid.bDiv)[0].clientHeight,i=$(c.grid.bDiv)[0].scrollTop,n=$(c.rows[t]).position().top,r=c.rows[t].clientHeight;n+r>=e+i?$(c.grid.bDiv)[0].scrollTop=n-(e+i)+r+i:n<e+i&&n<i&&($(c.grid.bDiv)[0].scrollTop=n)}var r,a,o,s,l,d,h,c=this,u=$.jgrid.getMethod("getStyleUI"),p=u(c.p.styleUI+".common","highlight",!0),f=u(c.p.styleUI+".common","disabled",!0);void 0!==t&&(e=e!==!1,a=$(c).jqGrid("getGridRowById",t),!a||!a.className||a.className.indexOf(f)>-1||(c.p.scrollrows===!0&&(o=$(c).jqGrid("getGridRowById",t).rowIndex,o>=0&&n(o)),c.p.frozenColumns===!0&&(d=c.p.id+"_frozen"),c.p.multiselect?(c.setHeadCheckBox(!1),c.p.selrow=a.id,s=$.inArray(c.p.selrow,c.p.selarrrow),s===-1?("ui-subgrid"!==a.className&&$(a).addClass(p).attr("aria-selected","true"),r=!0,c.p.selarrrow.push(c.p.selrow)):("ui-subgrid"!==a.className&&$(a).removeClass(p).attr("aria-selected","false"),r=!1,c.p.selarrrow.splice(s,1),l=c.p.selarrrow[0],c.p.selrow=void 0===l?null:l),$("#jqg_"+$.jgrid.jqID(c.p.id)+"_"+$.jgrid.jqID(a.id))[c.p.useProp?"prop":"attr"]("checked",r),d&&(s===-1?$("#"+$.jgrid.jqID(t),"#"+$.jgrid.jqID(d)).addClass(p):$("#"+$.jgrid.jqID(t),"#"+$.jgrid.jqID(d)).removeClass(p),$("#jqg_"+$.jgrid.jqID(c.p.id)+"_"+$.jgrid.jqID(t),"#"+$.jgrid.jqID(d))[c.p.useProp?"prop":"attr"]("checked",r)),e&&($(c).triggerHandler("jqGridSelectRow",[a.id,r,i]),c.p.onSelectRow&&c.p.onSelectRow.call(c,a.id,r,i))):"ui-subgrid"!==a.className&&(c.p.selrow!==a.id?(h=$(c).jqGrid("getGridRowById",c.p.selrow),h&&$(h).removeClass(p).attr({"aria-selected":"false",tabindex:"-1"}),$(a).addClass(p).attr({"aria-selected":"true",tabindex:"0"}),d&&($("#"+$.jgrid.jqID(c.p.selrow),"#"+$.jgrid.jqID(d)).removeClass(p),$("#"+$.jgrid.jqID(t),"#"+$.jgrid.jqID(d)).addClass(p)),r=!0):r=!1,c.p.selrow=a.id,e&&($(c).triggerHandler("jqGridSelectRow",[a.id,r,i]),c.p.onSelectRow&&c.p.onSelectRow.call(c,a.id,r,i)))))})},resetSelection:function(t){return this.each(function(){var e,i,n=this,r=$.jgrid.getMethod("getStyleUI"),a=r(n.p.styleUI+".common","highlight",!0),o=r(n.p.styleUI+".common","hover",!0);if(n.p.frozenColumns===!0&&(i=n.p.id+"_frozen"),void 0!==t){if(e=t===n.p.selrow?n.p.selrow:t,$("#"+$.jgrid.jqID(n.p.id)+" tbody:first tr#"+$.jgrid.jqID(e)).removeClass(a).attr("aria-selected","false"),i&&$("#"+$.jgrid.jqID(e),"#"+$.jgrid.jqID(i)).removeClass(a),n.p.multiselect){$("#jqg_"+$.jgrid.jqID(n.p.id)+"_"+$.jgrid.jqID(e),"#"+$.jgrid.jqID(n.p.id))[n.p.useProp?"prop":"attr"]("checked",!1),i&&$("#jqg_"+$.jgrid.jqID(n.p.id)+"_"+$.jgrid.jqID(e),"#"+$.jgrid.jqID(i))[n.p.useProp?"prop":"attr"]("checked",!1),n.setHeadCheckBox(!1);var s=$.inArray($.jgrid.jqID(e),n.p.selarrrow);s!==-1&&n.p.selarrrow.splice(s,1)}n.p.onUnSelectRow&&n.p.onUnSelectRow.call(n,e),e=null}else n.p.multiselect?($(n.p.selarrrow).each(function(t,e){$($(n).jqGrid("getGridRowById",e)).removeClass(a).attr("aria-selected","false"),$("#jqg_"+$.jgrid.jqID(n.p.id)+"_"+$.jgrid.jqID(e))[n.p.useProp?"prop":"attr"]("checked",!1),i&&($("#"+$.jgrid.jqID(e),"#"+$.jgrid.jqID(i)).removeClass(a),$("#jqg_"+$.jgrid.jqID(n.p.id)+"_"+$.jgrid.jqID(e),"#"+$.jgrid.jqID(i))[n.p.useProp?"prop":"attr"]("checked",!1)),n.p.onUnSelectRow&&n.p.onUnSelectRow.call(n,e)}),n.setHeadCheckBox(!1),n.p.selarrrow=[],n.p.selrow=null):n.p.selrow&&($("#"+$.jgrid.jqID(n.p.id)+" tbody:first tr#"+$.jgrid.jqID(n.p.selrow)).removeClass(a).attr("aria-selected","false"),i&&$("#"+$.jgrid.jqID(n.p.selrow),"#"+$.jgrid.jqID(i)).removeClass(a),n.p.onUnSelectRow&&n.p.onUnSelectRow.call(n,n.p.selrow),n.p.selrow=null);n.p.cellEdit===!0&&parseInt(n.p.iCol,10)>=0&&parseInt(n.p.iRow,10)>=0&&($("td:eq("+n.p.iCol+")",n.rows[n.p.iRow]).removeClass("edit-cell "+a),$(n.rows[n.p.iRow]).removeClass("selected-row "+o)),n.p.savedRow=[]})},getRowData:function(t,e){var i,n,r={},a=!1,o=0;return this.each(function(){var s,l,d=this;if(null==t)a=!0,i=[],n=d.rows.length;else{if(l=$(d).jqGrid("getGridRowById",t),!l)return r;n=2}for(e&&e===!0&&d.p.data.length>0||(e=!1);o<n;)a&&(l=d.rows[o]),$(l).hasClass("jqgrow")&&(e?r=d.p.data[d.p._index[l.id]]:$('td[role="gridcell"]',l).each(function(t){if(s=d.p.colModel[t].name,"cb"!==s&&"subgrid"!==s&&"rn"!==s)if(d.p.treeGrid===!0&&s===d.p.ExpandColumn)r[s]=$.jgrid.htmlDecode($("span:first",this).html());else try{r[s]=$.unformat.call(d,this,{rowId:l.id,colModel:d.p.colModel[t]},t)}catch(t){r[s]=$.jgrid.htmlDecode($(this).html())}}),a&&(i.push(r),r={})),o++}),i||r},delRowData:function(t){var e,i,n,r=!1;return this.each(function(){var a=this;if(e=$(a).jqGrid("getGridRowById",t),!e)return!1;if(a.p.subGrid&&(n=$(e).next(),n.hasClass("ui-subgrid")&&n.remove()),$(e).remove(),a.p.records--,a.p.reccount--,a.updatepager(!0,!1),r=!0,a.p.multiselect&&(i=$.inArray(t,a.p.selarrrow),i!==-1&&a.p.selarrrow.splice(i,1)),a.p.multiselect&&a.p.selarrrow.length>0?a.p.selrow=a.p.selarrrow[a.p.selarrrow.length-1]:a.p.selrow=null,"local"===a.p.datatype){var o=$.jgrid.stripPref(a.p.idPrefix,t),s=a.p._index[o];void 0!==s&&(a.p.data.splice(s,1),a.refreshIndex())}if(a.p.altRows===!0&&r){var l=a.p.altclass;$(a.rows).each(function(t){t%2===1?$(this).addClass(l):$(this).removeClass(l)})}}),r},setRowData:function(t,e,i){var n,r,a=!0;return this.each(function(){if(!this.grid)return!1;var o,s,l=this,d=typeof i,h={};if(s=$(this).jqGrid("getGridRowById",t),!s)return!1;if(e)try{if($(this.p.colModel).each(function(i){n=this.name;var a=$.jgrid.getAccessor(e,n);void 0!==a&&(h[n]=this.formatter&&"string"==typeof this.formatter&&"date"===this.formatter?$.unformat.date.call(l,a,this):a,o=l.formatter(t,h[n],i,e,"edit"),r=this.title?{title:$.jgrid.stripHtml(o)}:{},l.p.treeGrid===!0&&n===l.p.ExpandColumn?$("td[role='gridcell']:eq("+i+") > span:first",s).html(o).attr(r):$("td[role='gridcell']:eq("+i+")",s).html(o).attr(r))}),"local"===l.p.datatype){var c,u=$.jgrid.stripPref(l.p.idPrefix,t),p=l.p._index[u];if(l.p.treeGrid)for(c in l.p.treeReader)l.p.treeReader.hasOwnProperty(c)&&delete h[l.p.treeReader[c]];void 0!==p&&(l.p.data[p]=$.extend(!0,l.p.data[p],h)),h=null}}catch(t){a=!1}a&&("string"===d?$(s).addClass(i):null!==i&&"object"===d&&$(s).css(i),$(l).triggerHandler("jqGridAfterGridComplete"))}),a},addRowData:function(t,e,i,n){["first","last","before","after"].indexOf(i)==-1&&(i="last");var r,a,o,s,l,d,h,c,u,p,f,m,g,_,y=!1,v="",b="",w="";return e&&($.isArray(e)?(u=!0,p=t):(e=[e],u=!1),this.each(function(){var x=this,k=e.length;l=x.p.rownumbers===!0?1:0,o=x.p.multiselect===!0?1:0,s=x.p.subGrid===!0?1:0,u||(void 0!==t?t=String(t):(t=$.jgrid.randId(),x.p.keyName!==!1&&(p=x.p.keyName,void 0!==e[0][p]&&(t=e[0][p])))),f=x.p.altclass;var L,C=0,T=$(x).jqGrid("getStyleUI",x.p.styleUI+".base","rowBox",!0,"jqgrow ui-row-"+x.p.direction),M={},P=!!$.isFunction(x.p.afterInsertRow);for(l&&(v=$(x).jqGrid("getStyleUI",x.p.styleUI+".base","rownumBox",!1,"jqgrid-rownum")),o&&(b=$(x).jqGrid("getStyleUI",x.p.styleUI+".base","multiBox",!1,"cbox"));C<k;){if(m=e[C],a=[],L=T,u){try{t=m[p],void 0===t&&(t=$.jgrid.randId())}catch(e){t=$.jgrid.randId()}L+=x.p.altRows===!0&&(x.rows.length-1)%2===0?" "+f:""}for(_=t,t=x.p.idPrefix+t,l&&(w=x.formatCol(0,1,"",null,t,!0),a[a.length]='<td role="gridcell" '+v+" "+w+">0</td>"),o&&(c='<input role="checkbox" type="checkbox" id="jqg_'+x.p.id+"_"+t+'" '+b+"/>",w=x.formatCol(l,1,"",null,t,!0),a[a.length]='<td role="gridcell" '+w+">"+c+"</td>"),s&&(a[a.length]=$(x).jqGrid("addSubGridCell",o+l,1)),h=o+s+l;h<x.p.colModel.length;h++)g=x.p.colModel[h],r=g.name,M[r]=m[r],c=x.formatter(t,$.jgrid.getAccessor(m,r),h,m),w=x.formatCol(h,1,c,m,t,M),a[a.length]='<td role="gridcell" '+w+">"+c+"</td>";if(a.unshift(x.constructTr(t,!1,L,M,m)),a[a.length]="</tr>",0===x.rows.length)$("table:first",x.grid.bDiv).append(a.join(""));else switch(i){case"last":$(x.rows[x.rows.length-1]).after(a.join("")),d=x.rows.length-1;break;case"first":$(x.rows[0]).after(a.join("")),d=1;break;case"after":d=$(x).jqGrid("getGridRowById",n),d&&($(x.rows[d.rowIndex+1]).hasClass("ui-subgrid")?$(x.rows[d.rowIndex+1]).after(a):$(d).after(a.join("")),d=d.rowIndex+1);break;case"before":d=$(x).jqGrid("getGridRowById",n),d&&($(d).before(a.join("")),d=d.rowIndex-1)}x.p.subGrid===!0&&$(x).jqGrid("addSubGrid",o+l,d),x.p.records++,x.p.reccount++,$(x).triggerHandler("jqGridAfterInsertRow",[t,m,m]),P&&x.p.afterInsertRow.call(x,t,m,m),C++,"local"===x.p.datatype&&(M[x.p.localReader.id]=_,x.p._index[_]=x.p.data.length,x.p.data.push(M),M={})}x.p.altRows!==!0||u||("last"===i?(x.rows.length-1)%2===0&&$(x.rows[x.rows.length-1]).addClass(f):$(x.rows).each(function(t){t%2===0?$(this).addClass(f):$(this).removeClass(f)})),x.updatepager(!0,!0),y=!0})),y},footerData:function(t,e,i){function n(t){var e;for(e in t)if(t.hasOwnProperty(e))return!1;return!0}var r,a,o=!1,s={};return void 0===t&&(t="get"),"boolean"!=typeof i&&(i=!0),t=t.toLowerCase(),this.each(function(){var l,d=this;return!(!d.grid||!d.p.footerrow)&&(("set"!==t||!n(e))&&(o=!0,void $(this.p.colModel).each(function(n){r=this.name,"set"===t?void 0!==e[r]&&(l=i?d.formatter("",e[r],n,e,"edit"):e[r],a=this.title?{title:$.jgrid.stripHtml(l)}:{},$("tr.footrow td:eq("+n+")",d.grid.sDiv).html(l).attr(a),o=!0):"get"===t&&(s[r]=$("tr.footrow td:eq("+n+")",d.grid.sDiv).html())})))}),"get"===t?s:o},showHideCol:function(t,e){return this.each(function(){var i,n=this,r=!1,a=$.jgrid.cell_width?0:n.p.cellLayout;if(n.grid){"string"==typeof t&&(t=[t]),e="none"!==e?"":"none";var o=""===e,s=n.p.groupHeader&&($.isArray(n.p.groupHeader)||$.isFunction(n.p.groupHeader));if(s&&$(n).jqGrid("destroyGroupHeader",!1),$(this.p.colModel).each(function(s){if($.inArray(this.name,t)!==-1&&this.hidden===o){if(n.p.frozenColumns===!0&&this.frozen===!0)return!0;$("tr[role=row]",n.grid.hDiv).each(function(){$(this.cells[s]).css("display",e)}),$(n.rows).each(function(){$(this).hasClass("jqgroup")||$(this.cells[s]).css("display",e)}),n.p.footerrow&&$("tr.footrow td:eq("+s+")",n.grid.sDiv).css("display",e),i=parseInt(this.width,10),"none"===e?n.p.tblwidth-=i+a:n.p.tblwidth+=i+a,this.hidden=!o,r=!0,$(n).triggerHandler("jqGridShowHideCol",[o,this.name,s])}}),r===!0&&(n.p.shrinkToFit!==!0||isNaN(n.p.height)||(n.p.tblwidth+=parseInt(n.p.scrollOffset,10)),$(n).jqGrid("setGridWidth",n.p.shrinkToFit===!0?n.p.tblwidth:n.p.width)),s){var l=$.extend([],n.p.groupHeader);n.p.groupHeader=null;for(var d=0;d<l.length;d++)$(n).jqGrid("setGroupHeaders",l[d])}}})},hideCol:function(t){return this.each(function(){$(this).jqGrid("showHideCol",t,"none")})},showCol:function(t){return this.each(function(){$(this).jqGrid("showHideCol",t,"")})},remapColumns:function(t,e,i){function n(e){var i;i=e.length?$.makeArray(e):$.extend({},e),$.each(t,function(t){e[t]=i[this]})}function r(e,i){$(">tr"+(i||""),e).each(function(){var e=this,i=$.makeArray(e.cells);$.each(t,function(){var t=i[this];t&&e.appendChild(t)})})}var a=this.get(0);n(a.p.colModel),n(a.p.colNames),n(a.grid.headers),r($("thead:first",a.grid.hDiv),i&&":not(.ui-jqgrid-labels)"),e&&r($("#"+$.jgrid.jqID(a.p.id)+" tbody:first"),".jqgfirstrow, tr.jqgrow, tr.jqfoot"),a.p.footerrow&&r($("tbody:first",a.grid.sDiv)),a.p.remapColumns&&(a.p.remapColumns.length?n(a.p.remapColumns):a.p.remapColumns=$.makeArray(t)),a.p.lastsort=$.inArray(a.p.lastsort,t),a.p.treeGrid&&(a.p.expColInd=$.inArray(a.p.expColInd,t)),$(a).triggerHandler("jqGridRemapColumns",[t,e,i])},setGridWidth:function(t,e){return this.each(function(){if(this.grid){var i,n,r,a,o=this,s=0,l=$.jgrid.cell_width?0:o.p.cellLayout,d=0,h=!1,c=o.p.scrollOffset,u=0;if("boolean"!=typeof e&&(e=o.p.shrinkToFit),!isNaN(t)){if(t=parseInt(t,10),o.grid.width=o.p.width=t,$("#gbox_"+$.jgrid.jqID(o.p.id)).css("width",t+"px"),$("#gview_"+$.jgrid.jqID(o.p.id)).css("width",t+"px"),$(o.grid.bDiv).css("width",t+"px"),$(o.grid.hDiv).css("width",t+"px"),o.p.pager&&$(o.p.pager).css("width",t+"px"),o.p.toppager&&$(o.p.toppager).css("width",t+"px"),o.p.toolbar[0]===!0&&($(o.grid.uDiv).css("width",t+"px"),"both"===o.p.toolbar[1]&&$(o.grid.ubDiv).css("width",t+"px")),o.p.footerrow&&$(o.grid.sDiv).css("width",t+"px"),e===!1&&o.p.forceFit===!0&&(o.p.forceFit=!1),e===!0){if($.each(o.p.colModel,function(){this.hidden===!1&&(i=this.widthOrg,s+=i+l,this.fixed?u+=i+l:d++)}),0===d)return;o.p.tblwidth=s,r=t-l*d-u,isNaN(o.p.height)||($(o.grid.bDiv)[0].clientHeight<$(o.grid.bDiv)[0].scrollHeight||1===o.rows.length)&&(h=!0,r-=c),s=0;var p=o.grid.cols.length>0;if($.each(o.p.colModel,function(t){if(this.hidden===!1&&!this.fixed){if(i=this.widthOrg,i=Math.round(r*i/(o.p.tblwidth-l*d-u)),i<0)return;this.width=i,s+=i,o.grid.headers[t].width=i,o.grid.headers[t].el.style.width=i+"px",o.p.footerrow&&(o.grid.footers[t].style.width=i+"px"),p&&(o.grid.cols[t].style.width=i+"px"),n=t}}),!n)return;if(a=0,h?t-u-(s+l*d)!==c&&(a=t-u-(s+l*d)-c):1!==Math.abs(t-u-(s+l*d))&&(a=t-u-(s+l*d)),o.p.colModel[n].width+=a,o.p.tblwidth=s+a+l*d+u,o.p.tblwidth>t){var f=o.p.tblwidth-parseInt(t,10);o.p.tblwidth=t,i=o.p.colModel[n].width=o.p.colModel[n].width-f}else i=o.p.colModel[n].width;o.grid.headers[n].width=i,o.grid.headers[n].el.style.width=i+"px",p&&(o.grid.cols[n].style.width=i+"px"),o.p.footerrow&&(o.grid.footers[n].style.width=i+"px")}o.p.tblwidth&&($("table:first",o.grid.bDiv).css("width",o.p.tblwidth+"px"),$("table:first",o.grid.hDiv).css("width",o.p.tblwidth+"px"),o.grid.hDiv.scrollLeft=o.grid.bDiv.scrollLeft,o.p.footerrow&&$("table:first",o.grid.sDiv).css("width",o.p.tblwidth+"px"))}}})},setGridHeight:function(t){return this.each(function(){var e=this;if(e.grid){var i=$(e.grid.bDiv);i.css({height:t+(isNaN(t)?"":"px")}),e.p.frozenColumns===!0&&$("#"+$.jgrid.jqID(e.p.id)+"_frozen").parent().height(i.height()-16),e.p.height=t,e.p.scroll&&e.grid.populateVisible()}})},setCaption:function(t){return this.each(function(){var e=$(this).jqGrid("getStyleUI",this.p.styleUI+".common","cornertop",!0);this.p.caption=t,$(".ui-jqgrid-title, .ui-jqgrid-title-rtl",this.grid.cDiv).html(t),$(this.grid.cDiv).show(),$(this.grid.hDiv).removeClass(e)})},setLabel:function(t,e,i,n){return this.each(function(){var r=this,a=-1;if(r.grid&&void 0!==t&&($(r.p.colModel).each(function(e){if(this.name===t)return a=e,!1}),a>=0)){var o=$("tr.ui-jqgrid-labels th:eq("+a+")",r.grid.hDiv);if(e){var s=$(".s-ico",o);$("[id^=jqgh_]",o).empty().html(e).append(s),r.p.colNames[a]=e}i&&("string"==typeof i?$(o).addClass(i):$(o).css(i)),"object"==typeof n&&$(o).attr(n)}})},setCell:function(t,e,i,n,r,a){return this.each(function(){var o,s,l=this,d=-1;if(l.grid&&(isNaN(e)?$(l.p.colModel).each(function(t){if(this.name===e)return d=t,!1}):d=parseInt(e,10),d>=0)){var h=$(l).jqGrid("getGridRowById",t);if(h){var c=$("td:eq("+d+")",h),u=0,p=[];if(""!==i||a===!0){if(void 0!==h.cells)for(;u<h.cells.length;)p.push(h.cells[u].innerHTML),u++;if(o=l.formatter(t,i,d,p,"edit"),s=l.p.colModel[d].title?{title:$.jgrid.stripHtml(o)}:{},l.p.treeGrid&&$(".tree-wrap",$(c)).length>0?$("span",$(c)).html(o).attr(s):$(c).html(o).attr(s),"local"===l.p.datatype){var f,m=l.p.colModel[d];i=m.formatter&&"string"==typeof m.formatter&&"date"===m.formatter?$.unformat.date.call(l,i,m):i,f=l.p._index[$.jgrid.stripPref(l.p.idPrefix,t)],void 0!==f&&(l.p.data[f][m.name]=i)}}"string"==typeof n?$(c).addClass(n):n&&$(c).css(n),"object"==typeof r&&$(c).attr(r)}}})},getCell:function(t,e){var i=!1;return this.each(function(){var n=this,r=-1;if(n.grid&&(isNaN(e)?$(n.p.colModel).each(function(t){if(this.name===e)return r=t,!1}):r=parseInt(e,10),r>=0)){var a=$(n).jqGrid("getGridRowById",t);if(a)try{i=$.unformat.call(n,$("td:eq("+r+")",a),{rowId:a.id,colModel:n.p.colModel[r]},r)}catch(t){i=$.jgrid.htmlDecode($("td:eq("+r+")",a).html())}}}),i},getCol:function(t,e,i){var n,r,a,o,s=[],l=0;return e="boolean"==typeof e&&e,void 0===i&&(i=!1),this.each(function(){var d=this,h=-1;if(d.grid&&(isNaN(t)?$(d.p.colModel).each(function(e){if(this.name===t)return h=e,!1}):h=parseInt(t,10),h>=0)){var c=d.rows.length,u=0,p=0;if(c&&c>0){for(;u<c;){if($(d.rows[u]).hasClass("jqgrow")){try{n=$.unformat.call(d,$(d.rows[u].cells[h]),{rowId:d.rows[u].id,colModel:d.p.colModel[h]},h)}catch(t){n=$.jgrid.htmlDecode(d.rows[u].cells[h].innerHTML)}i?(o=parseFloat(n),isNaN(o)||(l+=o,void 0===a&&(a=r=o),r=Math.min(r,o),a=Math.max(a,o),p++)):e?s.push({id:d.rows[u].id,value:n}):s.push(n)}u++}if(i)switch(i.toLowerCase()){case"sum":s=l;break;case"avg":s=l/p;break;case"count":s=c-1;break;case"min":s=r;break;case"max":s=a}}}}),s},clearGridData:function(t){return this.each(function(){var e=this;if(e.grid){if("boolean"!=typeof t&&(t=!1),e.p.deepempty)$("#"+$.jgrid.jqID(e.p.id)+" tbody:first tr:gt(0)").remove();else{var i=$("#"+$.jgrid.jqID(e.p.id)+" tbody:first tr:first")[0];$("#"+$.jgrid.jqID(e.p.id)+" tbody:first").empty().append(i)}e.p.footerrow&&t&&$(".ui-jqgrid-ftable td",e.grid.sDiv).html("&#160;"),e.p.selrow=null,e.p.selarrrow=[],e.p.savedRow=[],e.p.records=0,e.p.page=1,e.p.lastpage=0,e.p.reccount=0,e.p.data=[],e.p._index={},e.updatepager(!0,!1)}})},getInd:function(t,e){var i,n=!1;return this.each(function(){i=$(this).jqGrid("getGridRowById",t),i&&(n=e===!0?i:i.rowIndex)}),n},bindKeys:function(t){var e=$.extend({onEnter:null,onSpace:null,onLeftKey:null,onRightKey:null,scrollingRows:!0},t||{});return this.each(function(){var t=this;$("body").is("[role]")||$("body").attr("role","application"),t.p.scrollrows=e.scrollingRows,$(t).keydown(function(i){var n,r,a,o=$(t).find("tr[tabindex=0]")[0],s=t.p.treeReader.expanded_field;if(o)if(a=t.p._index[$.jgrid.stripPref(t.p.idPrefix,o.id)],37===i.keyCode||38===i.keyCode||39===i.keyCode||40===i.keyCode){if(38===i.keyCode){if(r=o.previousSibling,n="",r)if($(r).is(":hidden")){for(;r;)if(r=r.previousSibling,!$(r).is(":hidden")&&$(r).hasClass("jqgrow")){n=r.id;break}}else n=r.id;$(t).jqGrid("setSelection",n,!0,i),i.preventDefault()}if(40===i.keyCode){if(r=o.nextSibling,n="",r)if($(r).is(":hidden")){for(;r;)if(r=r.nextSibling,!$(r).is(":hidden")&&$(r).hasClass("jqgrow")){n=r.id;break}}else n=r.id;$(t).jqGrid("setSelection",n,!0,i),i.preventDefault()}37===i.keyCode&&(t.p.treeGrid&&t.p.data[a][s]&&$(o).find("div.treeclick").trigger("click"),$(t).triggerHandler("jqGridKeyLeft",[t.p.selrow]),$.isFunction(e.onLeftKey)&&e.onLeftKey.call(t,t.p.selrow)),39===i.keyCode&&(t.p.treeGrid&&!t.p.data[a][s]&&$(o).find("div.treeclick").trigger("click"),$(t).triggerHandler("jqGridKeyRight",[t.p.selrow]),$.isFunction(e.onRightKey)&&e.onRightKey.call(t,t.p.selrow))}else 13===i.keyCode?($(t).triggerHandler("jqGridKeyEnter",[t.p.selrow]),$.isFunction(e.onEnter)&&e.onEnter.call(t,t.p.selrow)):32===i.keyCode&&($(t).triggerHandler("jqGridKeySpace",[t.p.selrow]),$.isFunction(e.onSpace)&&e.onSpace.call(t,t.p.selrow))})})},unbindKeys:function(){return this.each(function(){$(this).unbind("keydown")})},getLocalRow:function(t){var e,i=!1;return this.each(function(){void 0!==t&&(e=this.p._index[$.jgrid.stripPref(this.p.idPrefix,t)],e>=0&&(i=this.p.data[e]))}),i},progressBar:function(t){return t=$.extend({htmlcontent:"",method:"hide",loadtype:"disable"},t||{}),this.each(function(){var e,i,n="show"===t.method,r=$("#load_"+$.jgrid.jqID(this.p.id)),a=$(window).scrollTop();switch(""!==t.htmlcontent&&r.html(t.htmlcontent),t.loadtype){case"disable":break;case"enable":r.toggle(n);break;case"block":$("#lui_"+$.jgrid.jqID(this.p.id)).toggle(n),r.toggle(n)}r.is(":visible")&&(e=r.offsetParent(),r.css("top",""),r.offset().top<a&&(i=Math.min(10+a-e.offset().top,e.height()-r.height()),r.css("top",i+"px")))})},getColProp:function(t){var e={},i=this[0];if(!i.grid)return!1;var n,r=i.p.colModel;for(n=0;n<r.length;n++)if(r[n].name===t){e=r[n];break}return e},setColProp:function(t,e){return this.each(function(){if(this.grid&&e){var i,n=this.p.colModel;for(i=0;i<n.length;i++)if(n[i].name===t){$.extend(!0,this.p.colModel[i],e);break}}})},sortGrid:function(t,e,i){return this.each(function(){var n,r=this,a=-1,o=!1;if(r.grid){for(t||(t=r.p.sortname),n=0;n<r.p.colModel.length;n++)if(r.p.colModel[n].index===t||r.p.colModel[n].name===t){a=n,r.p.frozenColumns===!0&&r.p.colModel[n].frozen===!0&&(o=r.grid.fhDiv.find("#"+r.p.id+"_"+t));break}if(a!==-1){var s=r.p.colModel[a].sortable;o||(o=r.grid.headers[a].el),"boolean"!=typeof s&&(s=!0),"boolean"!=typeof e&&(e=!1),s&&r.sortData("jqgh_"+r.p.id+"_"+t,a,e,i,o)}}})},setGridState:function(t){return this.each(function(){if(this.grid){var e=this,i=$(this).jqGrid("getStyleUI",this.p.styleUI+".base","icon_caption_open",!0),n=$(this).jqGrid("getStyleUI",this.p.styleUI+".base","icon_caption_close",!0);"hidden"===t?($(".ui-jqgrid-bdiv, .ui-jqgrid-hdiv","#gview_"+$.jgrid.jqID(e.p.id)).slideUp("fast"),e.p.pager&&$(e.p.pager).slideUp("fast"),e.p.toppager&&$(e.p.toppager).slideUp("fast"),e.p.toolbar[0]===!0&&("both"===e.p.toolbar[1]&&$(e.grid.ubDiv).slideUp("fast"),$(e.grid.uDiv).slideUp("fast")),e.p.footerrow&&$(".ui-jqgrid-sdiv","#gbox_"+$.jgrid.jqID(e.p.id)).slideUp("fast"),$(".ui-jqgrid-headlink",e.grid.cDiv).removeClass(i).addClass(n),e.p.gridstate="hidden"):"visible"===t&&($(".ui-jqgrid-hdiv, .ui-jqgrid-bdiv","#gview_"+$.jgrid.jqID(e.p.id)).slideDown("fast"),e.p.pager&&$(e.p.pager).slideDown("fast"),e.p.toppager&&$(e.p.toppager).slideDown("fast"),e.p.toolbar[0]===!0&&("both"===e.p.toolbar[1]&&$(e.grid.ubDiv).slideDown("fast"),$(e.grid.uDiv).slideDown("fast")),e.p.footerrow&&$(".ui-jqgrid-sdiv","#gbox_"+$.jgrid.jqID(e.p.id)).slideDown("fast"),$(".ui-jqgrid-headlink",e.grid.cDiv).removeClass(n).addClass(i),e.p.gridstate="visible")}})},setFrozenColumns:function(){return this.each(function(){if(this.grid){var t=this,e=t.p.colModel,i=0,n=e.length,r=-1,a=!1,o=$(t).jqGrid("getStyleUI",t.p.styleUI+".base","headerDiv",!0,"ui-jqgrid-hdiv"),s=$(t).jqGrid("getStyleUI",t.p.styleUI+".common","hover",!0);if(t.p.subGrid!==!0&&t.p.treeGrid!==!0&&t.p.cellEdit!==!0&&!t.p.sortable&&!t.p.scroll){for(t.p.rownumbers&&i++,t.p.multiselect&&i++;i<n&&e[i].frozen===!0;)a=!0,r=i,i++;if(r>=0&&a){var l=t.p.caption?$(t.grid.cDiv).outerHeight():0,d=$(".ui-jqgrid-htable","#gview_"+$.jgrid.jqID(t.p.id)).height();t.p.toppager&&(l+=$(t.grid.topDiv).outerHeight()),t.p.toolbar[0]===!0&&"bottom"!==t.p.toolbar[1]&&(l+=$(t.grid.uDiv).outerHeight()),t.grid.fhDiv=$('<div style="position:absolute;'+("rtl"===t.p.direction?"right:0;":"left:0;")+"top:"+l+"px;height:"+d+'px;" class="frozen-div '+o+'"></div>'),t.grid.fbDiv=$('<div style="position:absolute;'+("rtl"===t.p.direction?"right:0;":"left:0;")+"top:"+(parseInt(l,10)+parseInt(d,10)+1)+'px;overflow-y:hidden" class="frozen-bdiv ui-jqgrid-bdiv"></div>'),$("#gview_"+$.jgrid.jqID(t.p.id)).append(t.grid.fhDiv);var h=$(".ui-jqgrid-htable","#gview_"+$.jgrid.jqID(t.p.id)).clone(!0);if(t.p.groupHeader){$("tr.jqg-first-row-header, tr.jqg-third-row-header",h).each(function(){$("th:gt("+r+")",this).remove()});var c,u,p=-1,f=-1;$("tr.jqg-second-row-header th",h).each(function(){if(c=parseInt($(this).attr("colspan"),10),u=parseInt($(this).attr("rowspan"),10),u&&(p++,f++),c&&(p+=c,f++),p===r)return f=r,!1}),p!==r&&(f=r),$("tr.jqg-second-row-header",h).each(function(){$("th:gt("+f+")",this).remove()})}else $("tr",h).each(function(){$("th:gt("+r+")",this).remove()});if($(h).width(1),$(t.grid.fhDiv).append(h).mousemove(function(e){if(t.grid.resizing)return t.grid.dragMove(e),!1}),t.p.footerrow){var m=$(".ui-jqgrid-bdiv","#gview_"+$.jgrid.jqID(t.p.id)).height();t.grid.fsDiv=$('<div style="position:absolute;left:0px;top:'+(parseInt(l,10)+parseInt(d,10)+parseInt(m,10)+1)+'px;" class="frozen-sdiv ui-jqgrid-sdiv"></div>'),
$("#gview_"+$.jgrid.jqID(t.p.id)).append(t.grid.fsDiv);var g=$(".ui-jqgrid-ftable","#gview_"+$.jgrid.jqID(t.p.id)).clone(!0);$("tr",g).each(function(){$("td:gt("+r+")",this).remove()}),$(g).width(1),$(t.grid.fsDiv).append(g)}$(t).bind("jqGridResizeStop.setFrozenColumns",function(e,i,n){var r=$(".ui-jqgrid-htable",t.grid.fhDiv);$("th:eq("+n+")",r).width(i);var a=$(".ui-jqgrid-btable",t.grid.fbDiv);if($("tr:first td:eq("+n+")",a).width(i),t.p.footerrow){var o=$(".ui-jqgrid-ftable",t.grid.fsDiv);$("tr:first td:eq("+n+")",o).width(i)}}),$("#gview_"+$.jgrid.jqID(t.p.id)).append(t.grid.fbDiv),$(t.grid.fbDiv).bind("mousewheel DOMMouseScroll",function(e){var i=$(t.grid.bDiv).scrollTop();e.originalEvent.wheelDelta>0||e.originalEvent.detail<0?$(t.grid.bDiv).scrollTop(i-25):$(t.grid.bDiv).scrollTop(i+25),e.preventDefault()}),t.p.hoverrows===!0&&$("#"+$.jgrid.jqID(t.p.id)).unbind("mouseover").unbind("mouseout"),$(t).bind("jqGridAfterGridComplete.setFrozenColumns",function(){$("#"+$.jgrid.jqID(t.p.id)+"_frozen").remove(),$(t.grid.fbDiv).height($(t.grid.bDiv).height()-16);var e=$("#"+$.jgrid.jqID(t.p.id)).clone(!0);$("tr[role=row]",e).each(function(){$("td[role=gridcell]:gt("+r+")",this).remove()}),$(e).width(1).attr("id",t.p.id+"_frozen"),$(t.grid.fbDiv).append(e),t.p.hoverrows===!0&&($("tr.jqgrow",e).hover(function(){$(this).addClass(s),$("#"+$.jgrid.jqID(this.id),"#"+$.jgrid.jqID(t.p.id)).addClass(s)},function(){$(this).removeClass(s),$("#"+$.jgrid.jqID(this.id),"#"+$.jgrid.jqID(t.p.id)).removeClass(s)}),$("tr.jqgrow","#"+$.jgrid.jqID(t.p.id)).hover(function(){$(this).addClass(s),$("#"+$.jgrid.jqID(this.id),"#"+$.jgrid.jqID(t.p.id)+"_frozen").addClass(s)},function(){$(this).removeClass(s),$("#"+$.jgrid.jqID(this.id),"#"+$.jgrid.jqID(t.p.id)+"_frozen").removeClass(s)})),e=null}),t.grid.hDiv.loading||$(t).triggerHandler("jqGridAfterGridComplete"),t.p.frozenColumns=!0}}}})},destroyFrozenColumns:function(){return this.each(function(){if(this.grid&&this.p.frozenColumns===!0){var t=this,e=$(t).jqGrid("getStyleUI",t.p.styleUI+".common","hover",!0);if($(t.grid.fhDiv).remove(),$(t.grid.fbDiv).remove(),t.grid.fhDiv=null,t.grid.fbDiv=null,t.p.footerrow&&($(t.grid.fsDiv).remove(),t.grid.fsDiv=null),$(this).unbind(".setFrozenColumns"),t.p.hoverrows===!0){var i;$("#"+$.jgrid.jqID(t.p.id)).bind("mouseover",function(t){i=$(t.target).closest("tr.jqgrow"),"ui-subgrid"!==$(i).attr("class")&&$(i).addClass(e)}).bind("mouseout",function(t){i=$(t.target).closest("tr.jqgrow"),$(i).removeClass(e)})}this.p.frozenColumns=!1}})},resizeColumn:function(t,e){return this.each(function(){var i,n,r,a=this.grid,o=this.p,s=o.colModel,l=s.length;if("string"==typeof t){for(i=0;i<l;i++)if(s[i].name===t){t=i;break}}else t=parseInt(t,10);if(e=parseInt(e,10),!("number"!=typeof t||t<0||t>s.length-1||"number"!=typeof e||e<o.minColWidth)){if(o.forceFit)for(o.nv=0,i=t+1;i<l;i++)if(s[i].hidden!==!0){o.nv=i-t;break}if(a.resizing={idx:t},n=e-a.headers[t].width,o.forceFit){if(r=a.headers[t+o.nv].width-n,r<o.minColWidth)return;a.headers[t+o.nv].newWidth=a.headers[t+o.nv].width-n}a.newWidth=o.tblwidth+n,a.headers[t].newWidth=e,a.dragEnd(!1)}})},getStyleUI:function(t,e,i,n){try{var r="",a=t.split("."),o="";switch(i||(r="class=",o='"'),null==n&&(n=""),a.length){case 1:r+=o+n+" "+$.jgrid.styleUI[a[0]][e]+o;break;case 2:r+=o+n+" "+$.jgrid.styleUI[a[0]][a[1]][e]+o}}catch(t){r=""}return $.trim(r)},resizeGrid:function(t){return this.each(function(){var e=this;void 0===t&&(t=500),setTimeout(function(){var t=$(window).width(),i=$("#gbox_"+$.jgrid.jqID(e.p.id)).parent().width(),n=e.p.width;n=t-i>3?i:t,$("#"+$.jgrid.jqID(e.p.id)).jqGrid("setGridWidth",n)},t)})}}),$.jgrid.extend({editCell:function(t,e,i){return this.each(function(){var n,r,a,o,s=this,l=$(this).jqGrid("getStyleUI",s.p.styleUI+".common","highlight",!0),d=$(this).jqGrid("getStyleUI",s.p.styleUI+".common","hover",!0),h=$(this).jqGrid("getStyleUI",s.p.styleUI+".celledit","inputClass",!0);if(s.grid&&s.p.cellEdit===!0){if(e=parseInt(e,10),s.p.selrow=s.rows[t].id,s.p.knv||$(s).jqGrid("GridNav"),s.p.savedRow.length>0){if(i===!0&&t==s.p.iRow&&e==s.p.iCol)return;$(s).jqGrid("saveCell",s.p.savedRow[0].id,s.p.savedRow[0].ic)}else window.setTimeout(function(){$("#"+$.jgrid.jqID(s.p.knv)).attr("tabindex","-1").focus()},1);if(o=s.p.colModel[e],n=o.name,"subgrid"!==n&&"cb"!==n&&"rn"!==n){if(a=$("td:eq("+e+")",s.rows[t]),o.editable!==!0||i!==!0||a.hasClass("not-editable-cell")||$.isFunction(s.p.isCellEditable)&&!s.p.isCellEditable.call(s,n,t,e))parseInt(s.p.iCol,10)>=0&&parseInt(s.p.iRow,10)>=0&&$(s.rows[s.p.iRow]).removeClass("selected-row "+d).find("td:eq("+s.p.iCol+")").removeClass("edit-cell "+l),a.addClass("edit-cell "+l),$(s.rows[t]).addClass("selected-row "+d),r=a.html().replace(/\&#160\;/gi,""),$(s).triggerHandler("jqGridSelectCell",[s.rows[t].id,n,r,t,e]),$.isFunction(s.p.onSelectCell)&&s.p.onSelectCell.call(s,s.rows[t].id,n,r,t,e);else{parseInt(s.p.iCol,10)>=0&&parseInt(s.p.iRow,10)>=0&&$(s.rows[s.p.iRow]).removeClass("selected-row "+d).find("td:eq("+s.p.iCol+")").removeClass("edit-cell "+l),$(a).addClass("edit-cell "+l),$(s.rows[t]).addClass("selected-row "+d);try{r=$.unformat.call(s,a,{rowId:s.rows[t].id,colModel:o},e)}catch(t){r=o.edittype&&"textarea"===o.edittype?$(a).text():$(a).html()}if(s.p.autoencode&&(r=$.jgrid.htmlDecode(r)),o.edittype||(o.edittype="text"),s.p.savedRow.push({id:t,ic:e,name:n,v:r}),("&nbsp;"===r||"&#160;"===r||1===r.length&&160===r.charCodeAt(0))&&(r=""),$.isFunction(s.p.formatCell)){var c=s.p.formatCell.call(s,s.rows[t].id,n,r,t,e);void 0!==c&&(r=c)}$(s).triggerHandler("jqGridBeforeEditCell",[s.rows[t].id,n,r,t,e]),$.isFunction(s.p.beforeEditCell)&&s.p.beforeEditCell.call(s,s.rows[t].id,n,r,t,e);var u=$.extend({},o.editoptions||{},{id:t+"_"+n,name:n,rowId:s.rows[t].id,oper:"edit"}),p=$.jgrid.createEl.call(s,o.edittype,u,r,!0,$.extend({},$.jgrid.ajaxOptions,s.p.ajaxSelectOptions||{}));$.inArray(o.edittype,["text","textarea","password","select"])>-1&&$(p).addClass(h),$(a).html("").append(p).attr("tabindex","0"),$.jgrid.bindEv.call(s,p,u),window.setTimeout(function(){$(p).focus()},1),$("input, select, textarea",a).bind("keydown",function(i){if(27===i.keyCode&&($("input.hasDatepicker",a).length>0?$(".ui-datepicker").is(":hidden")?$(s).jqGrid("restoreCell",t,e):$("input.hasDatepicker",a).datepicker("hide"):$(s).jqGrid("restoreCell",t,e)),13===i.keyCode&&!i.shiftKey)return $(s).jqGrid("saveCell",t,e),!1;if(9===i.keyCode){if(s.grid.hDiv.loading)return!1;i.shiftKey?$(s).jqGrid("prevCell",t,e):$(s).jqGrid("nextCell",t,e)}i.stopPropagation()}),$(s).triggerHandler("jqGridAfterEditCell",[s.rows[t].id,n,r,t,e]),$.isFunction(s.p.afterEditCell)&&s.p.afterEditCell.call(s,s.rows[t].id,n,r,t,e)}s.p.iCol=e,s.p.iRow=t}}})},saveCell:function(t,e){return this.each(function(){var i,n=this,r=$.jgrid.getRegional(this,"errors"),a=$.jgrid.getRegional(this,"edit");if(n.grid&&n.p.cellEdit===!0){if(i=n.p.savedRow.length>=1?0:null,null!==i){var o,s,l=$("td:eq("+e+")",n.rows[t]),d=n.p.colModel[e],h=d.name,c=$.jgrid.jqID(h);switch(d.edittype){case"select":if(d.editoptions.multiple){var u=$("#"+t+"_"+c,n.rows[t]),p=[];o=$(u).val(),o?o.join(","):o="",$("option:selected",u).each(function(t,e){p[t]=$(e).text()}),s=p.join(",")}else o=$("#"+t+"_"+c+" option:selected",n.rows[t]).val(),s=$("#"+t+"_"+c+" option:selected",n.rows[t]).text();d.formatter&&(s=o);break;case"checkbox":var f=["Yes","No"];d.editoptions&&(f=d.editoptions.value.split(":")),o=$("#"+t+"_"+c,n.rows[t]).is(":checked")?f[0]:f[1],s=o;break;case"password":case"text":case"textarea":case"button":o=$("#"+t+"_"+c,n.rows[t]).val(),s=o;break;case"custom":try{if(!d.editoptions||!$.isFunction(d.editoptions.custom_value))throw"e1";if(o=d.editoptions.custom_value.call(n,$(".customelement",l),"get"),void 0===o)throw"e2";s=o}catch(t){"e1"===t?$.jgrid.info_dialog(r.errcap,"function 'custom_value' "+a.msg.nodefined,a.bClose,{styleUI:n.p.styleUI}):"e2"===t?$.jgrid.info_dialog(r.errcap,"function 'custom_value' "+a.msg.novalue,a.bClose,{styleUI:n.p.styleUI}):$.jgrid.info_dialog(r.errcap,t.message,a.bClose,{styleUI:n.p.styleUI})}}if(s!==n.p.savedRow[i].v){var m=$(n).triggerHandler("jqGridBeforeSaveCell",[n.rows[t].id,h,o,t,e]);if(m&&(o=m,s=m),$.isFunction(n.p.beforeSaveCell)){var g=n.p.beforeSaveCell.call(n,n.rows[t].id,h,o,t,e);g&&(o=g,s=g)}var _=$.jgrid.checkValues.call(n,o,e);if(_[0]===!0){var y=$(n).triggerHandler("jqGridBeforeSubmitCell",[n.rows[t].id,h,o,t,e])||{};if($.isFunction(n.p.beforeSubmitCell)&&(y=n.p.beforeSubmitCell.call(n,n.rows[t].id,h,o,t,e),y||(y={})),$("input.hasDatepicker",l).length>0&&$("input.hasDatepicker",l).datepicker("hide"),"remote"===n.p.cellsubmit)if(n.p.cellurl){var v={};n.p.autoencode&&(o=$.jgrid.htmlEncode(o)),v[h]=o;var b,w,x;x=n.p.prmNames,b=x.id,w=x.oper,v[b]=$.jgrid.stripPref(n.p.idPrefix,n.rows[t].id),v[w]=x.editoper,v=$.extend(y,v),$(n).jqGrid("progressBar",{method:"show",loadtype:n.p.loadui,htmlcontent:$.jgrid.getRegional(n,"defaults.savetext")}),n.grid.hDiv.loading=!0,$.ajax($.extend({url:n.p.cellurl,data:$.isFunction(n.p.serializeCellData)?n.p.serializeCellData.call(n,v):v,type:"POST",complete:function(i,d){if($(n).jqGrid("progressBar",{method:"hide",loadtype:n.p.loadui}),n.grid.hDiv.loading=!1,"success"===d){var c=$(n).triggerHandler("jqGridAfterSubmitCell",[n,i,v.id,h,o,t,e])||[!0,""];c[0]===!0&&$.isFunction(n.p.afterSubmitCell)&&(c=n.p.afterSubmitCell.call(n,i,v.id,h,o,t,e)),c[0]===!0?($(l).empty(),$(n).jqGrid("setCell",n.rows[t].id,e,s,!1,!1,!0),$(l).addClass("dirty-cell"),$(n.rows[t]).addClass("edited"),$(n).triggerHandler("jqGridAfterSaveCell",[n.rows[t].id,h,o,t,e]),$.isFunction(n.p.afterSaveCell)&&n.p.afterSaveCell.call(n,n.rows[t].id,h,o,t,e),n.p.savedRow.splice(0,1)):($.jgrid.info_dialog(r.errcap,c[1],a.bClose,{styleUI:n.p.styleUI}),$(n).jqGrid("restoreCell",t,e))}},error:function(i,o,s){$("#lui_"+$.jgrid.jqID(n.p.id)).hide(),n.grid.hDiv.loading=!1,$(n).triggerHandler("jqGridErrorCell",[i,o,s]),$.isFunction(n.p.errorCell)?(n.p.errorCell.call(n,i,o,s),$(n).jqGrid("restoreCell",t,e)):($.jgrid.info_dialog(r.errcap,i.status+" : "+i.statusText+"<br/>"+o,a.bClose,{styleUI:n.p.styleUI}),$(n).jqGrid("restoreCell",t,e))}},$.jgrid.ajaxOptions,n.p.ajaxCellOptions||{}))}else try{$.jgrid.info_dialog(r.errcap,r.nourl,a.bClose,{styleUI:n.p.styleUI}),$(n).jqGrid("restoreCell",t,e)}catch(t){}"clientArray"===n.p.cellsubmit&&($(l).empty(),$(n).jqGrid("setCell",n.rows[t].id,e,s,!1,!1,!0),$(l).addClass("dirty-cell"),$(n.rows[t]).addClass("edited"),$(n).triggerHandler("jqGridAfterSaveCell",[n.rows[t].id,h,o,t,e]),$.isFunction(n.p.afterSaveCell)&&n.p.afterSaveCell.call(n,n.rows[t].id,h,o,t,e),n.p.savedRow.splice(0,1))}else try{window.setTimeout(function(){$.jgrid.info_dialog(r.errcap,o+" "+_[1],a.bClose,{styleUI:n.p.styleUI})},100),$(n).jqGrid("restoreCell",t,e)}catch(t){}}else $(n).jqGrid("restoreCell",t,e)}window.setTimeout(function(){$("#"+$.jgrid.jqID(n.p.knv)).attr("tabindex","-1").focus()},0)}})},restoreCell:function(t,e){return this.each(function(){var i,n=this;if(n.grid&&n.p.cellEdit===!0){if(i=n.p.savedRow.length>=1?0:null,null!==i){var r=$("td:eq("+e+")",n.rows[t]);if($.isFunction($.fn.datepicker))try{$("input.hasDatepicker",r).datepicker("hide")}catch(t){}$(r).empty().attr("tabindex","-1"),$(n).jqGrid("setCell",n.rows[t].id,e,n.p.savedRow[i].v,!1,!1,!0),$(n).triggerHandler("jqGridAfterRestoreCell",[n.rows[t].id,n.p.savedRow[i].v,t,e]),$.isFunction(n.p.afterRestoreCell)&&n.p.afterRestoreCell.call(n,n.rows[t].id,n.p.savedRow[i].v,t,e),n.p.savedRow.splice(0,1)}window.setTimeout(function(){$("#"+n.p.knv).attr("tabindex","-1").focus()},0)}})},nextCell:function(t,e){return this.each(function(){var i,n=this,r=!1;if(n.grid&&n.p.cellEdit===!0){for(i=e+1;i<n.p.colModel.length;i++)if(n.p.colModel[i].editable===!0&&(!$.isFunction(n.p.isCellEditable)||n.p.isCellEditable.call(n,n.p.colModel[i].name,t,i))){r=i;break}r!==!1?$(n).jqGrid("editCell",t,r,!0):n.p.savedRow.length>0&&$(n).jqGrid("saveCell",t,e)}})},prevCell:function(t,e){return this.each(function(){var i,n=this,r=!1;if(n.grid&&n.p.cellEdit===!0){for(i=e-1;i>=0;i--)if(n.p.colModel[i].editable===!0&&(!$.isFunction(n.p.isCellEditable)||n.p.isCellEditable.call(n,n.p.colModel[i].name,t,i))){r=i;break}r!==!1?$(n).jqGrid("editCell",t,r,!0):n.p.savedRow.length>0&&$(n).jqGrid("saveCell",t,e)}})},GridNav:function(){return this.each(function(){function t(t,e,n){if("v"===n.substr(0,1)){var r=$(i.grid.bDiv)[0].clientHeight,a=$(i.grid.bDiv)[0].scrollTop,o=i.rows[t].offsetTop+i.rows[t].clientHeight,s=i.rows[t].offsetTop;"vd"===n&&o>=r&&($(i.grid.bDiv)[0].scrollTop=$(i.grid.bDiv)[0].scrollTop+i.rows[t].clientHeight),"vu"===n&&s<a&&($(i.grid.bDiv)[0].scrollTop=$(i.grid.bDiv)[0].scrollTop-i.rows[t].clientHeight)}if("h"===n){var l=$(i.grid.bDiv)[0].clientWidth,d=$(i.grid.bDiv)[0].scrollLeft,h=i.rows[t].cells[e].offsetLeft+i.rows[t].cells[e].clientWidth,c=i.rows[t].cells[e].offsetLeft;h>=l+parseInt(d,10)?$(i.grid.bDiv)[0].scrollLeft=$(i.grid.bDiv)[0].scrollLeft+i.rows[t].cells[e].clientWidth:c<d&&($(i.grid.bDiv)[0].scrollLeft=$(i.grid.bDiv)[0].scrollLeft-i.rows[t].cells[e].clientWidth)}}function e(t,e){var n,r;if("lft"===e)for(n=t+1,r=t;r>=0;r--)if(i.p.colModel[r].hidden!==!0){n=r;break}if("rgt"===e)for(n=t-1,r=t;r<i.p.colModel.length;r++)if(i.p.colModel[r].hidden!==!0){n=r;break}return n}var i=this;if(i.grid&&i.p.cellEdit===!0){i.p.knv=i.p.id+"_kn";var n,r,a=$("<div style='position:fixed;top:0px;width:1px;height:1px;' tabindex='0'><div tabindex='-1' style='width:1px;height:1px;' id='"+i.p.knv+"'></div></div>");$(a).insertBefore(i.grid.cDiv),$("#"+i.p.knv).focus().keydown(function(a){switch(r=a.keyCode,"rtl"===i.p.direction&&(37===r?r=39:39===r&&(r=37)),r){case 38:i.p.iRow-1>0&&(t(i.p.iRow-1,i.p.iCol,"vu"),$(i).jqGrid("editCell",i.p.iRow-1,i.p.iCol,!1));break;case 40:i.p.iRow+1<=i.rows.length-1&&(t(i.p.iRow+1,i.p.iCol,"vd"),$(i).jqGrid("editCell",i.p.iRow+1,i.p.iCol,!1));break;case 37:i.p.iCol-1>=0&&(n=e(i.p.iCol-1,"lft"),t(i.p.iRow,n,"h"),$(i).jqGrid("editCell",i.p.iRow,n,!1));break;case 39:i.p.iCol+1<=i.p.colModel.length-1&&(n=e(i.p.iCol+1,"rgt"),t(i.p.iRow,n,"h"),$(i).jqGrid("editCell",i.p.iRow,n,!1));break;case 13:parseInt(i.p.iCol,10)>=0&&parseInt(i.p.iRow,10)>=0&&$(i).jqGrid("editCell",i.p.iRow,i.p.iCol,!0);break;default:return!0}return!1})}})},getChangedCells:function(t){var e=[];return t||(t="all"),this.each(function(){var i,n=this;n.grid&&n.p.cellEdit===!0&&$(n.rows).each(function(r){var a={};$(this).hasClass("edited")&&($("td",this).each(function(e){if(i=n.p.colModel[e].name,"cb"!==i&&"subgrid"!==i)if("dirty"===t){if($(this).hasClass("dirty-cell"))try{a[i]=$.unformat.call(n,this,{rowId:n.rows[r].id,colModel:n.p.colModel[e]},e)}catch(t){a[i]=$.jgrid.htmlDecode($(this).html())}}else try{a[i]=$.unformat.call(n,this,{rowId:n.rows[r].id,colModel:n.p.colModel[e]},e)}catch(t){a[i]=$.jgrid.htmlDecode($(this).html())}}),a.id=this.id,e.push(a))})}),e}}),$.extend($.jgrid,{showModal:function(t){t.w.show()},closeModal:function(t){t.w.hide().attr("aria-hidden","true"),t.o&&t.o.remove()},hideModal:function(t,e){e=$.extend({jqm:!0,gb:"",removemodal:!1,formprop:!1,form:""},e||{});var i=!(!e.gb||"string"!=typeof e.gb||"#gbox_"!==e.gb.substr(0,6))&&$("#"+e.gb.substr(6))[0];if(e.onClose){var n=i?e.onClose.call(i,t):e.onClose(t);if("boolean"==typeof n&&!n)return}if(e.formprop&&i&&e.form){var r=$(t)[0].style.height,a=$(t)[0].style.width;r.indexOf("px")>-1&&(r=parseFloat(r)),a.indexOf("px")>-1&&(a=parseFloat(a));var o,s;"edit"===e.form?(o="#"+$.jgrid.jqID("FrmGrid_"+e.gb.substr(6)),s="formProp"):"view"===e.form&&(o="#"+$.jgrid.jqID("ViewGrid_"+e.gb.substr(6)),s="viewProp"),$(i).data(s,{top:parseFloat($(t).css("top")),left:parseFloat($(t).css("left")),width:a,height:r,dataheight:$(o).height(),datawidth:$(o).width()})}if($.fn.jqm&&e.jqm===!0)$(t).attr("aria-hidden","true").jqmHide();else{if(""!==e.gb)try{$(".jqgrid-overlay:first",e.gb).hide()}catch(t){}$(t).hide().attr("aria-hidden","true")}e.removemodal&&$(t).remove()},findPos:function(t){var e=0,i=0;if(t.offsetParent)do e+=t.offsetLeft,i+=t.offsetTop;while(t=t.offsetParent);return[e,i]},createModal:function(t,e,i,n,r,a,o){i=$.extend(!0,{},$.jgrid.jqModal||{},i);var s=this,l="rtl"===$(i.gbox).attr("dir"),d=$.jgrid.styleUI[i.styleUI||"jQueryUI"].modal,h=$.jgrid.styleUI[i.styleUI||"jQueryUI"].common,c=document.createElement("div");o=$.extend({},o||{}),c.className="ui-jqdialog "+d.modal,c.id=t.themodal;var u=document.createElement("div");u.className="ui-jqdialog-titlebar "+d.header,u.id=t.modalhead,$(u).append("<span class='ui-jqdialog-title'>"+i.caption+"</span>");var p=$("<a class='ui-jqdialog-titlebar-close "+h.cornerall+"'></a>").hover(function(){p.addClass(h.hover)},function(){p.removeClass(h.hover)}).append("<span class='"+h.icon_base+" "+d.icon_close+"'></span>");$(u).append(p),l?(c.dir="rtl",$(".ui-jqdialog-title",u).css("float","right"),$(".ui-jqdialog-titlebar-close",u).css("left","0.3em")):(c.dir="ltr",$(".ui-jqdialog-title",u).css("float","left"),$(".ui-jqdialog-titlebar-close",u).css("right","0.3em"));var f=document.createElement("div");$(f).addClass("ui-jqdialog-content "+d.content).attr("id",t.modalcontent),$(f).append(e),c.appendChild(f),$(c).prepend(u),a===!0?$("body").append(c):"string"==typeof a?$(a).append(c):$(c).insertBefore(n),$(c).css(o),void 0===i.jqModal&&(i.jqModal=!0);var m={};if($.fn.jqm&&i.jqModal===!0){if(0===i.left&&0===i.top&&i.overlay){var g=[];g=$.jgrid.findPos(r),i.left=g[0]+4,i.top=g[1]+4}m.top=i.top+"px",m.left=i.left}else 0===i.left&&0===i.top||(m.left=i.left,m.top=i.top+"px");if($("a.ui-jqdialog-titlebar-close",u).click(function(){var e=$("#"+$.jgrid.jqID(t.themodal)).data("onClose")||i.onClose,n=$("#"+$.jgrid.jqID(t.themodal)).data("gbox")||i.gbox;return s.hideModal("#"+$.jgrid.jqID(t.themodal),{gb:n,jqm:i.jqModal,onClose:e,removemodal:i.removemodal||!1,formprop:!i.recreateForm||!1,form:i.form||""}),!1}),0!==i.width&&i.width||(i.width=300),0!==i.height&&i.height||(i.height=200),!i.zIndex){var _=$(n).parents("*[role=dialog]").filter(":first").css("z-index");_?i.zIndex=parseInt(_,10)+2:i.zIndex=950}var y=0;if(l&&m.left&&!a&&(y=$(i.gbox).width()-(isNaN(i.width)?0:parseInt(i.width,10))-8,m.left=parseInt(m.left,10)+parseInt(y,10)),m.left&&(m.left+="px"),m.left="35%",m.top="25%",$(c).css($.extend({width:isNaN(i.width)?"auto":i.width+"px",height:isNaN(i.height)?"auto":i.height+"px",zIndex:i.zIndex,overflow:"hidden"},m)).attr({tabIndex:"-1",role:"dialog","aria-labelledby":t.modalhead,"aria-hidden":"true"}),void 0===i.drag&&(i.drag=!0),void 0===i.resize&&(i.resize=!0),i.drag)if($.fn.jqDrag)$(c).jqDrag(u);else try{$(c).draggable({handle:$("#"+$.jgrid.jqID(u.id))})}catch(t){}if(i.resize)if($.fn.jqResize)$(c).append("<div class='jqResize "+d.resizable+" "+h.icon_base+" "+d.icon_resizable+"'></div>"),$("#"+$.jgrid.jqID(t.themodal)).jqResize(".jqResize",!!t.scrollelm&&"#"+$.jgrid.jqID(t.scrollelm));else try{$(c).resizable({handles:"se, sw",alsoResize:!!t.scrollelm&&"#"+$.jgrid.jqID(t.scrollelm)})}catch(t){}i.closeOnEscape===!0&&$(c).keydown(function(e){if(27===e.which){var n=$("#"+$.jgrid.jqID(t.themodal)).data("onClose")||i.onClose;s.hideModal("#"+$.jgrid.jqID(t.themodal),{gb:i.gbox,jqm:i.jqModal,onClose:n,removemodal:i.removemodal||!1,formprop:!i.recreateForm||!1,form:i.form||""})}})},viewModal:function(t,e){if(e=$.extend({toTop:!0,overlay:10,modal:!1,overlayClass:"ui-widget-overlay",onShow:$.jgrid.showModal,onHide:$.jgrid.closeModal,gbox:"",jqm:!0,jqM:!0},e||{}),void 0===e.focusField&&(e.focusField=0),"number"==typeof e.focusField&&e.focusField>=0?e.focusField=parseInt(e.focusField,10):"boolean"!=typeof e.focusField||e.focusField?e.focusField=0:e.focusField=!1,$.fn.jqm&&e.jqm===!0)e.jqM?$(t).attr("aria-hidden","false").jqm(e).jqmShow():$(t).attr("aria-hidden","false").jqmShow();else if(""!==e.gbox&&($(".jqgrid-overlay:first",e.gbox).show(),$(t).data("gbox",e.gbox)),$(t).show().attr("aria-hidden","false"),e.focusField>=0)try{$(":input:visible",t)[parseInt(e.focusField,10)].focus()}catch(t){}},info_dialog:function(t,e,i,n){var r={width:290,height:"auto",dataheight:"auto",drag:!0,resize:!1,left:250,top:170,zIndex:1e3,jqModal:!0,modal:!1,closeOnEscape:!0,align:"center",buttonalign:"center",buttons:[]};$.extend(!0,r,$.jgrid.jqModal||{},{caption:"<b>"+t+"</b>"},n||{});var a=r.jqModal,o=this,s=$.jgrid.styleUI[r.styleUI||"jQueryUI"].modal,l=$.jgrid.styleUI[r.styleUI||"jQueryUI"].common;$.fn.jqm&&!a&&(a=!1);var d,h="";if(r.buttons.length>0)for(d=0;d<r.buttons.length;d++)void 0===r.buttons[d].id&&(r.buttons[d].id="info_button_"+d),h+="<a id='"+r.buttons[d].id+"' class='fm-button "+l.button+"'>"+r.buttons[d].text+"</a>";var c=isNaN(r.dataheight)?r.dataheight:r.dataheight+"px",u="text-align:"+r.align+";",p="<div id='info_id'>";p+="<div id='infocnt' style='margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:"+c+";"+u+"'>"+e+"</div>",p+=i?"<div class='"+s.header+"' style='text-align:"+r.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'><a id='closedialog' class='fm-button "+l.button+"'>"+i+"</a>"+h+"</div>":""!==h?"<div class='"+s.header+"' style='text-align:"+r.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'>"+h+"</div>":"",p+="</div>";try{"false"===$("#info_dialog").attr("aria-hidden")&&$.jgrid.hideModal("#info_dialog",{jqm:a}),$("#info_dialog").remove()}catch(t){}$.jgrid.createModal({themodal:"info_dialog",modalhead:"info_head",modalcontent:"info_content",scrollelm:"infocnt"},p,r,"","",!0),h&&$.each(r.buttons,function(t){$("#"+$.jgrid.jqID(this.id),"#info_id").bind("click",function(){return r.buttons[t].onClick.call($("#info_dialog")),!1})}),$("#closedialog","#info_id").click(function(){return o.hideModal("#info_dialog",{jqm:a,onClose:$("#info_dialog").data("onClose")||r.onClose,gb:$("#info_dialog").data("gbox")||r.gbox}),!1}),$(".fm-button","#info_dialog").hover(function(){$(this).addClass(l.hover)},function(){$(this).removeClass(l.hover)}),$.isFunction(r.beforeOpen)&&r.beforeOpen(),$.jgrid.viewModal("#info_dialog",{onHide:function(t){t.w.hide().remove(),t.o&&t.o.remove()},modal:r.modal,jqm:a}),$.isFunction(r.afterOpen)&&r.afterOpen();try{$("#info_dialog").focus()}catch(t){}},bindEv:function(t,e){var i=this;$.isFunction(e.dataInit)&&e.dataInit.call(i,t,e),e.dataEvents&&$.each(e.dataEvents,function(){void 0!==this.data?$(t).bind(this.type,this.data,this.fn):$(t).bind(this.type,this.fn)})},createEl:function(t,e,i,n,r){function a(t,e,i){var n=["dataInit","dataEvents","dataUrl","buildSelect","sopt","searchhidden","defaultValue","attr","custom_element","custom_value","oper"];void 0!==i&&$.isArray(i)&&$.merge(n,i),$.each(e,function(e,i){$.inArray(e,n)===-1&&$(t).attr(e,i)}),e.hasOwnProperty("id")||$(t).attr("id",$.jgrid.randId())}var o="",s=this;switch(t){case"textarea":o=document.createElement("textarea"),n?e.cols||$(o).css({width:"98%"}):e.cols||(e.cols=20),e.rows||(e.rows=2),("&nbsp;"===i||"&#160;"===i||1===i.length&&160===i.charCodeAt(0))&&(i=""),o.value=i,a(o,e),$(o).attr({role:"textbox",multiline:"true"});break;case"checkbox":if(o=document.createElement("input"),o.type="checkbox",e.value){var l=e.value.split(":");i===l[0]&&(o.checked=!0,o.defaultChecked=!0),o.value=l[0],$(o).attr("offval",l[1])}else{var d=(i+"").toLowerCase();d.search(/(false|f|0|no|n|off|undefined)/i)<0&&""!==d?(o.checked=!0,o.defaultChecked=!0,o.value=i):o.value="on",$(o).attr("offval","off")}a(o,e,["value"]),$(o).attr("role","checkbox");break;case"select":o=document.createElement("select"),o.setAttribute("role","select");var h,c=[];if(e.multiple===!0?(h=!0,o.multiple="multiple",$(o).attr("aria-multiselectable","true")):h=!1,null!=e.dataUrl){var u=null,p=e.postData||r.postData;try{u=e.rowId}catch(t){}s.p&&s.p.idPrefix&&(u=$.jgrid.stripPref(s.p.idPrefix,u)),$.ajax($.extend({url:$.isFunction(e.dataUrl)?e.dataUrl.call(s,u,i,String(e.name)):e.dataUrl,type:"GET",dataType:"html",data:$.isFunction(p)?p.call(s,u,i,String(e.name)):p,context:{elem:o,options:e,vl:i},success:function(t){var e,i=[],n=this.elem,r=this.vl,o=$.extend({},this.options),l=o.multiple===!0,d=o.cacheUrlData===!0,h="",c=$.isFunction(o.buildSelect)?o.buildSelect.call(s,t):t;"string"==typeof c&&(c=$($.trim(c)).html()),c&&($(n).append(c),a(n,o,p?["postData"]:void 0),void 0===o.size&&(o.size=l?3:1),l?(i=r.split(","),i=$.map(i,function(t){return $.trim(t)})):i[0]=$.trim(r),setTimeout(function(){if($("option",n).each(function(t){e=$(this).text(),r=$(this).val()||e,d&&(h+=(0!==t?";":"")+r+":"+e),0===t&&n.multiple&&(this.selected=!1),$(this).attr("role","option"),($.inArray($.trim(e),i)>-1||$.inArray($.trim(r),i)>-1)&&(this.selected="selected")}),d)if("edit"===o.oper)$(s).jqGrid("setColProp",o.name,{editoptions:{buildSelect:null,dataUrl:null,value:h}});else if("search"===o.oper)$(s).jqGrid("setColProp",o.name,{searchoptions:{dataUrl:null,value:h}});else if("filter"===o.oper&&$("#fbox_"+s.p.id)[0].p){var t,a=$("#fbox_"+s.p.id)[0].p.columns;$.each(a,function(){if(t=this.index||this.name,o.name===t)return this.searchoptions.dataUrl=null,this.searchoptions.value=h,!1})}$(s).triggerHandler("jqGridAddEditAfterSelectUrlComplete",[n])},0))}},r||{}))}else if(e.value){var f;void 0===e.size&&(e.size=h?3:1),h&&(c=i.split(","),c=$.map(c,function(t){return $.trim(t)})),"function"==typeof e.value&&(e.value=e.value());var m,g,_,y,v,b,w=void 0===e.separator?":":e.separator,x=void 0===e.delimiter?";":e.delimiter;if("string"==typeof e.value)for(m=e.value.split(x),f=0;f<m.length;f++)g=m[f].split(w),g.length>2&&(g[1]=$.map(g,function(t,e){if(e>0)return t}).join(w)),_=document.createElement("option"),_.setAttribute("role","option"),_.value=g[0],_.innerHTML=g[1],o.appendChild(_),h||$.trim(g[0])!==$.trim(i)&&$.trim(g[1])!==$.trim(i)||(_.selected="selected"),h&&($.inArray($.trim(g[1]),c)>-1||$.inArray($.trim(g[0]),c)>-1)&&(_.selected="selected");else if("[object Array]"===Object.prototype.toString.call(e.value))for(y=e.value,f=0;f<y.length;f++)2===y[f].length&&(v=y[f][0],b=y[f][1],_=document.createElement("option"),_.setAttribute("role","option"),_.value=v,_.innerHTML=b,o.appendChild(_),h||$.trim(v)!==$.trim(i)&&$.trim(b)!==$.trim(i)||(_.selected="selected"),h&&($.inArray($.trim(b),c)>-1||$.inArray($.trim(v),c)>-1)&&(_.selected="selected"));else if("object"==typeof e.value){y=e.value;for(v in y)y.hasOwnProperty(v)&&(_=document.createElement("option"),_.setAttribute("role","option"),_.value=v,_.innerHTML=y[v],o.appendChild(_),h||$.trim(v)!==$.trim(i)&&$.trim(y[v])!==$.trim(i)||(_.selected="selected"),h&&($.inArray($.trim(y[v]),c)>-1||$.inArray($.trim(v),c)>-1)&&(_.selected="selected"))}a(o,e,["value"])}break;case"image":case"file":o=document.createElement("input"),o.type=t,a(o,e);break;case"custom":o=document.createElement("span");try{if(!$.isFunction(e.custom_element))throw"e1";var k=e.custom_element.call(s,i,e);if(!k)throw"e2";k=$(k).addClass("customelement").attr({id:e.id,name:e.name}),$(o).empty().append(k)}catch(t){var L=$.jgrid.getRegional(s,"errors"),C=$.jgrid.getRegional(s,"edit");"e1"===t?$.jgrid.info_dialog(L.errcap,"function 'custom_element' "+C.msg.nodefined,C.bClose,{styleUI:s.p.styleUI}):"e2"===t?$.jgrid.info_dialog(L.errcap,"function 'custom_element' "+C.msg.novalue,C.bClose,{styleUI:s.p.styleUI}):$.jgrid.info_dialog(L.errcap,"string"==typeof t?t:t.message,C.bClose,{styleUI:s.p.styleUI})}break;default:var T;T="button"===t?"button":"textbox",o=document.createElement("input"),o.type=t,o.value=i,a(o,e),"button"!==t&&(n?e.size||$(o).css({width:"96%"}):e.size||(e.size=20)),$(o).attr("role",T)}return o},checkDate:function(t,e){var i,n=function(t){return t%4!==0||t%100===0&&t%400!==0?28:29},r={};if(t=t.toLowerCase(),i=t.indexOf("/")!==-1?"/":t.indexOf("-")!==-1?"-":t.indexOf(".")!==-1?".":"/",t=t.split(i),e=e.split(i),3!==e.length)return!1;var a,o,s=-1,l=-1,d=-1;for(o=0;o<t.length;o++){var h=isNaN(e[o])?0:parseInt(e[o],10);r[t[o]]=h,a=t[o],a.indexOf("y")!==-1&&(s=o),a.indexOf("m")!==-1&&(d=o),a.indexOf("d")!==-1&&(l=o)}a="y"===t[s]||"yyyy"===t[s]?4:"yy"===t[s]?2:-1;var c,u=[0,31,29,31,30,31,30,31,31,30,31,30,31];return s!==-1&&(c=r[t[s]].toString(),2===a&&1===c.length&&(a=1),c.length===a&&(0!==r[t[s]]||"00"===e[s])&&(d!==-1&&(c=r[t[d]].toString(),!(c.length<1||r[t[d]]<1||r[t[d]]>12)&&(l!==-1&&(c=r[t[l]].toString(),!(c.length<1||r[t[l]]<1||r[t[l]]>31||2===r[t[d]]&&r[t[l]]>n(r[t[s]])||r[t[l]]>u[r[t[d]]]))))))},isEmpty:function(t){return!(!t.match(/^\s+$/)&&""!==t)},checkTime:function(t){var e,i=/^(\d{1,2}):(\d{2})([apAP][Mm])?$/;if(!$.jgrid.isEmpty(t)){if(e=t.match(i),!e)return!1;if(e[3]){if(e[1]<1||e[1]>12)return!1}else if(e[1]>23)return!1;if(e[2]>59)return!1}return!0},checkValues:function(t,e,i,n){var r,a,o,s,l,d,h=this,c=h.p.colModel,u=$.jgrid.getRegional(this,"edit.msg");if(void 0===i)if("string"==typeof e){for(a=0,l=c.length;a<l;a++)if(c[a].name===e){r=c[a].editrules,e=a,null!=c[a].formoptions&&(o=c[a].formoptions.label);break}}else e>=0&&(r=c[e].editrules);else r=i,o=void 0===n?"_":n;if(r){if(o||(o=null!=h.p.colNames?h.p.colNames[e]:c[e].label),r.required===!0&&$.jgrid.isEmpty(t))return[!1,o+": "+u.required,""];var p=r.required!==!1;if(r.number===!0&&(p!==!1||!$.jgrid.isEmpty(t))&&isNaN(t))return[!1,o+": "+u.number,""];if(void 0!==r.minValue&&!isNaN(r.minValue)&&parseFloat(t)<parseFloat(r.minValue))return[!1,o+": "+u.minValue+" "+r.minValue,""];if(void 0!==r.maxValue&&!isNaN(r.maxValue)&&parseFloat(t)>parseFloat(r.maxValue))return[!1,o+": "+u.maxValue+" "+r.maxValue,""];var f;if(r.email===!0&&!(p===!1&&$.jgrid.isEmpty(t)||(f=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,f.test(t))))return[!1,o+": "+u.email,""];if(r.integer===!0&&(p!==!1||!$.jgrid.isEmpty(t))){if(isNaN(t))return[!1,o+": "+u.integer,""];if(t%1!==0||t.indexOf(".")!==-1)return[!1,o+": "+u.integer,""]}if(r.date===!0&&!(p===!1&&$.jgrid.isEmpty(t)||(c[e].formatoptions&&c[e].formatoptions.newformat?(s=c[e].formatoptions.newformat,d=$.jgrid.getRegional(h,"formatter.date.masks"),d&&d.hasOwnProperty(s)&&(s=d[s])):s=c[e].datefmt||"Y-m-d",$.jgrid.checkDate(s,t))))return[!1,o+": "+u.date+" - "+s,""];if(r.time===!0&&!(p===!1&&$.jgrid.isEmpty(t)||$.jgrid.checkTime(t)))return[!1,o+": "+u.date+" - hh:mm (am/pm)",""];if(r.url===!0&&!(p===!1&&$.jgrid.isEmpty(t)||(f=/^(((https?)|(ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i,f.test(t))))return[!1,o+": "+u.url,""];if(r.custom===!0&&(p!==!1||!$.jgrid.isEmpty(t))){if($.isFunction(r.custom_func)){var m=r.custom_func.call(h,t,o,e);return $.isArray(m)?m:[!1,u.customarray,""]}return[!1,u.customfcheck,""]}}return[!0,"",""]}}),$.fn.jqFilter=function(t){if("string"==typeof t){var e=$.fn.jqFilter[t];if(!e)throw"jqFilter - No such method: "+t;var i=$.makeArray(arguments).slice(1);return e.apply(this,i)}var n=$.extend(!0,{filter:null,columns:[],sortStrategy:null,onChange:null,afterRedraw:null,checkValues:null,error:!1,errmsg:"",errorcheck:!0,showQuery:!0,sopt:null,ops:[],operands:null,numopts:["eq","ne","lt","le","gt","ge","nu","nn","in","ni"],stropts:["eq","ne","bw","bn","ew","en","cn","nc","nu","nn","in","ni"],strarr:["text","string","blob"],groupOps:[{op:"AND",text:"AND"},{op:"OR",text:"OR"}],groupButton:!0,ruleButtons:!0,direction:"ltr"},$.jgrid.filter,t||{});return this.each(function(){if(!this.filter){this.p=n,null!==this.p.filter&&void 0!==this.p.filter||(this.p.filter={groupOp:this.p.groupOps[0].op,rules:[],groups:[]}),null!=this.p.sortStrategy&&$.isFunction(this.p.sortStrategy)&&this.p.columns.sort(this.p.sortStrategy);var t,e,i=this.p.columns.length,r=/msie/i.test(navigator.userAgent)&&!window.opera;if(this.p.initFilter=$.extend(!0,{},this.p.filter),i){for(t=0;t<i;t++)e=this.p.columns[t],e.stype?e.inputtype=e.stype:e.inputtype||(e.inputtype="text"),e.sorttype?e.searchtype=e.sorttype:e.searchtype||(e.searchtype="string"),void 0===e.hidden&&(e.hidden=!1),e.label||(e.label=e.name),
e.index&&(e.name=e.index),e.hasOwnProperty("searchoptions")||(e.searchoptions={}),e.hasOwnProperty("searchrules")||(e.searchrules={});var a=function(){return $("#"+$.jgrid.jqID(n.id))[0]||null},o=a(),s=$.jgrid.styleUI[o.p.styleUI||"jQueryUI"].filter,l=$.jgrid.styleUI[o.p.styleUI||"jQueryUI"].common;this.p.showQuery&&$(this).append("<table class='queryresult "+s.table_widget+"' style='display:block;max-width:440px;border:0px none;' dir='"+this.p.direction+"'><tbody><tr><td class='query'></td></tr></tbody></table>");var d=function(t,e){var i=[!0,""],r=a();if($.isFunction(e.searchrules))i=e.searchrules.call(r,t,e);else if($.jgrid&&$.jgrid.checkValues)try{i=$.jgrid.checkValues.call(r,t,-1,e.searchrules,e.label)}catch(t){}i&&i.length&&i[0]===!1&&(n.error=!i[0],n.errmsg=i[1])};this.onchange=function(){return this.p.error=!1,this.p.errmsg="",!!$.isFunction(this.p.onChange)&&this.p.onChange.call(this,this.p)},this.reDraw=function(){$("table.group:first",this).remove();var t=this.createTableForGroup(n.filter,null);$(this).append(t),$.isFunction(this.p.afterRedraw)&&this.p.afterRedraw.call(this,this.p)},this.createTableForGroup=function(t,e){var i,r=this,a=$("<table class='group "+s.table_widget+" ui-search-table' style='border:0px none;'><tbody></tbody></table>"),o="left";"rtl"===this.p.direction&&(o="right",a.attr("dir","rtl")),null===e&&a.append("<tr class='error' style='display:none;'><th colspan='5' class='"+l.error+"' align='"+o+"'></th></tr>");var d=$("<tr></tr>");a.append(d);var h=$("<th colspan='5' align='"+o+"'></th>");if(d.append(h),this.p.ruleButtons===!0){var c=$("<select class='opsel "+s.srSelect+"'></select>");h.append(c);var u,p="";for(i=0;i<n.groupOps.length;i++)u=t.groupOp===r.p.groupOps[i].op?" selected='selected'":"",p+="<option value='"+r.p.groupOps[i].op+"'"+u+">"+r.p.groupOps[i].text+"</option>";c.append(p).bind("change",function(){t.groupOp=$(c).val(),r.onchange()})}var f="<span></span>";if(this.p.groupButton&&(f=$("<input type='button' value='+ {}' title='Add subgroup' class='add-group "+l.button+"'/>"),f.bind("click",function(){return void 0===t.groups&&(t.groups=[]),t.groups.push({groupOp:n.groupOps[0].op,rules:[],groups:[]}),r.reDraw(),r.onchange(),!1})),h.append(f),this.p.ruleButtons===!0){var m,g=$("<input type='button' value='+' title='Add rule' class='add-rule ui-add "+l.button+"'/>");g.bind("click",function(){for(void 0===t.rules&&(t.rules=[]),i=0;i<r.p.columns.length;i++){var e=void 0===r.p.columns[i].search||r.p.columns[i].search,n=r.p.columns[i].hidden===!0,a=r.p.columns[i].searchoptions.searchhidden===!0;if(a&&e||e&&!n){m=r.p.columns[i];break}}var o;return o=m.searchoptions.sopt?m.searchoptions.sopt:r.p.sopt?r.p.sopt:$.inArray(m.searchtype,r.p.strarr)!==-1?r.p.stropts:r.p.numopts,t.rules.push({field:m.name,op:o[0],data:""}),r.reDraw(),!1}),h.append(g)}if(null!==e){var _=$("<input type='button' value='-' title='Delete group' class='delete-group "+l.button+"'/>");h.append(_),_.bind("click",function(){for(i=0;i<e.groups.length;i++)if(e.groups[i]===t){e.groups.splice(i,1);break}return r.reDraw(),r.onchange(),!1})}if(void 0!==t.groups)for(i=0;i<t.groups.length;i++){var y=$("<tr></tr>");a.append(y);var v=$("<td class='first'></td>");y.append(v);var b=$("<td colspan='4'></td>");b.append(this.createTableForGroup(t.groups[i],t)),y.append(b)}if(void 0===t.groupOp&&(t.groupOp=r.p.groupOps[0].op),void 0!==t.rules)for(i=0;i<t.rules.length;i++)a.append(this.createTableRowForRule(t.rules[i],t));return a},this.createTableRowForRule=function(t,e){var i,o,d,h,c,u=this,p=a(),f=$("<tr></tr>"),m="";f.append("<td class='first'></td>");var g=$("<td class='columns'></td>");f.append(g);var _,y=$("<select class='"+s.srSelect+"'></select>"),v=[];g.append(y),y.bind("change",function(){for(t.field=$(y).val(),d=$(this).parents("tr:first"),$(".data",d).empty(),i=0;i<u.p.columns.length;i++)if(u.p.columns[i].name===t.field){h=u.p.columns[i];break}if(h){h.searchoptions.id=$.jgrid.randId(),h.searchoptions.name=t.field,h.searchoptions.oper="filter",r&&"text"===h.inputtype&&(h.searchoptions.size||(h.searchoptions.size=10));var e=$.jgrid.createEl.call(p,h.inputtype,h.searchoptions,"",!0,u.p.ajaxSelectOptions||{},!0);$(e).addClass("input-elm "+s.srInput),o=h.searchoptions.sopt?h.searchoptions.sopt:u.p.sopt?u.p.sopt:$.inArray(h.searchtype,u.p.strarr)!==-1?u.p.stropts:u.p.numopts;var n="",a=0;for(v=[],$.each(u.p.ops,function(){v.push(this.oper)}),i=0;i<o.length;i++)_=$.inArray(o[i],v),_!==-1&&(0===a&&(t.op=u.p.ops[_].oper),n+="<option value='"+u.p.ops[_].oper+"'>"+u.p.ops[_].text+"</option>",a++);if($(".selectopts",d).empty().append(n),$(".selectopts",d)[0].selectedIndex=0,$.jgrid.msie&&$.jgrid.msiever()<9){var l=parseInt($("select.selectopts",d)[0].offsetWidth,10)+1;$(".selectopts",d).width(l),$(".selectopts",d).css("width","auto")}$(".data",d).append(e),$.jgrid.bindEv.call(p,e,h.searchoptions),$(".input-elm",d).bind("change",function(e){var i=e.target;t.data="SPAN"===i.nodeName.toUpperCase()&&h.searchoptions&&$.isFunction(h.searchoptions.custom_value)?h.searchoptions.custom_value.call(p,$(i).children(".customelement:first"),"get"):i.value,u.onchange()}),setTimeout(function(){t.data=$(e).val(),u.onchange()},0)}});var b=0;for(i=0;i<u.p.columns.length;i++){var w=void 0===u.p.columns[i].search||u.p.columns[i].search,x=u.p.columns[i].hidden===!0,k=u.p.columns[i].searchoptions.searchhidden===!0;(k&&w||w&&!x)&&(c="",t.field===u.p.columns[i].name&&(c=" selected='selected'",b=i),m+="<option value='"+u.p.columns[i].name+"'"+c+">"+u.p.columns[i].label+"</option>")}y.append(m);var L=$("<td class='operators'></td>");f.append(L),h=n.columns[b],h.searchoptions.id=$.jgrid.randId(),r&&"text"===h.inputtype&&(h.searchoptions.size||(h.searchoptions.size=10)),h.searchoptions.name=t.field,h.searchoptions.oper="filter";var C=$.jgrid.createEl.call(p,h.inputtype,h.searchoptions,t.data,!0,u.p.ajaxSelectOptions||{},!0);"nu"!==t.op&&"nn"!==t.op||($(C).attr("readonly","true"),$(C).attr("disabled","true"));var T=$("<select class='selectopts "+s.srSelect+"'></select>");for(L.append(T),T.bind("change",function(){t.op=$(T).val(),d=$(this).parents("tr:first");var e=$(".input-elm",d)[0];"nu"===t.op||"nn"===t.op?(t.data="","SELECT"!==e.tagName.toUpperCase()&&(e.value=""),e.setAttribute("readonly","true"),e.setAttribute("disabled","true")):("SELECT"===e.tagName.toUpperCase()&&(t.data=e.value),e.removeAttribute("readonly"),e.removeAttribute("disabled")),u.onchange()}),o=h.searchoptions.sopt?h.searchoptions.sopt:u.p.sopt?u.p.sopt:$.inArray(h.searchtype,u.p.strarr)!==-1?u.p.stropts:u.p.numopts,m="",$.each(u.p.ops,function(){v.push(this.oper)}),i=0;i<o.length;i++)_=$.inArray(o[i],v),_!==-1&&(c=t.op===u.p.ops[_].oper?" selected='selected'":"",m+="<option value='"+u.p.ops[_].oper+"'"+c+">"+u.p.ops[_].text+"</option>");T.append(m);var M=$("<td class='data'></td>");f.append(M),M.append(C),$.jgrid.bindEv.call(p,C,h.searchoptions),$(C).addClass("input-elm "+s.srInput).bind("change",function(){t.data="custom"===h.inputtype?h.searchoptions.custom_value.call(p,$(this).children(".customelement:first"),"get"):$(this).val(),u.onchange()});var P=$("<td></td>");if(f.append(P),this.p.ruleButtons===!0){var D=$("<input type='button' value='-' title='Delete rule' class='delete-rule ui-del "+l.button+"'/>");P.append(D),D.bind("click",function(){for(i=0;i<e.rules.length;i++)if(e.rules[i]===t){e.rules.splice(i,1);break}return u.reDraw(),u.onchange(),!1})}return f},this.getStringForGroup=function(t){var e,i="(";if(void 0!==t.groups)for(e=0;e<t.groups.length;e++){i.length>1&&(i+=" "+t.groupOp+" ");try{i+=this.getStringForGroup(t.groups[e])}catch(t){alert(t)}}if(void 0!==t.rules)try{for(e=0;e<t.rules.length;e++)i.length>1&&(i+=" "+t.groupOp+" "),i+=this.getStringForRule(t.rules[e])}catch(t){alert(t)}return i+=")","()"===i?"":i},this.getStringForRule=function(t){var e,i,r,a,o="",s="",l=["int","integer","float","number","currency"];for(e=0;e<this.p.ops.length;e++)if(this.p.ops[e].oper===t.op){o=this.p.operands.hasOwnProperty(t.op)?this.p.operands[t.op]:"",s=this.p.ops[e].oper;break}for(e=0;e<this.p.columns.length;e++)if(this.p.columns[e].name===t.field){i=this.p.columns[e];break}return void 0===i?"":(a=t.data,"bw"!==s&&"bn"!==s||(a+="%"),"ew"!==s&&"en"!==s||(a="%"+a),"cn"!==s&&"nc"!==s||(a="%"+a+"%"),"in"!==s&&"ni"!==s||(a=" ("+a+")"),n.errorcheck&&d(t.data,i),r=$.inArray(i.searchtype,l)!==-1||"nn"===s||"nu"===s?t.field+" "+o+" "+a:t.field+" "+o+' "'+a+'"')},this.resetFilter=function(){this.p.filter=$.extend(!0,{},this.p.initFilter),this.reDraw(),this.onchange()},this.hideError=function(){$("th."+l.error,this).html(""),$("tr.error",this).hide()},this.showError=function(){$("th."+l.error,this).html(this.p.errmsg),$("tr.error",this).show()},this.toUserFriendlyString=function(){return this.getStringForGroup(n.filter)},this.toString=function(){function t(t){if(i.p.errorcheck){var e,n;for(e=0;e<i.p.columns.length;e++)if(i.p.columns[e].name===t.field){n=i.p.columns[e];break}n&&d(t.data,n)}return t.op+"(item."+t.field+",'"+t.data+"')"}function e(i){var n,r="(";if(void 0!==i.groups)for(n=0;n<i.groups.length;n++)r.length>1&&(r+="OR"===i.groupOp?" || ":" && "),r+=e(i.groups[n]);if(void 0!==i.rules)for(n=0;n<i.rules.length;n++)r.length>1&&(r+="OR"===i.groupOp?" || ":" && "),r+=t(i.rules[n]);return r+=")","()"===r?"":r}var i=this;return e(this.p.filter)},this.reDraw(),this.p.showQuery&&this.onchange(),this.filter=!0}}})},$.extend($.fn.jqFilter,{toSQLString:function(){var t="";return this.each(function(){t=this.toUserFriendlyString()}),t},filterData:function(){var t;return this.each(function(){t=this.p.filter}),t},getParameter:function(t){return void 0!==t&&this.p.hasOwnProperty(t)?this.p[t]:this.p},resetFilter:function(){return this.each(function(){this.resetFilter()})},addFilter:function(t){"string"==typeof t&&(t=$.jgrid.parse(t)),this.each(function(){this.p.filter=t,this.reDraw(),this.onchange()})}}),$.jgrid.extend({filterToolbar:function(t){var e=$.jgrid.getRegional(this[0],"search");return t=$.extend({autosearch:!0,autosearchDelay:500,searchOnEnter:!0,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,searchurl:"",stringResult:!1,groupOp:"AND",defaultSearch:"bw",searchOperators:!1,resetIcon:"x",operands:{eq:"==",ne:"!",lt:"<",le:"<=",gt:">",ge:">=",bw:"^",bn:"!^","in":"=",ni:"!=",ew:"|",en:"!@",cn:"~",nc:"!~",nu:"#",nn:"!#"}},e,t||{}),this.each(function(){var i=this;if(!i.p.filterToolbar){$(i).data("filterToolbar")||$(i).data("filterToolbar",t),i.p.force_regional&&(t=$.extend(t,e));var n,r=$.jgrid.styleUI[i.p.styleUI||"jQueryUI"].filter,a=$.jgrid.styleUI[i.p.styleUI||"jQueryUI"].common,o=$.jgrid.styleUI[i.p.styleUI||"jQueryUI"].base,s=function(){var e,n,r,a={},o=0,s={};$.each(i.p.colModel,function(){var l=$("#gs_"+i.p.idPrefix+$.jgrid.jqID(this.name),this.frozen===!0&&i.p.frozenColumns===!0?i.grid.fhDiv:i.grid.hDiv);if(n=this.index||this.name,r=t.searchOperators?l.parent().prev().children("a").attr("soper")||t.defaultSearch:this.searchoptions&&this.searchoptions.sopt?this.searchoptions.sopt[0]:"select"===this.stype?"eq":t.defaultSearch,e="custom"===this.stype&&$.isFunction(this.searchoptions.custom_value)&&l.length>0&&"SPAN"===l[0].nodeName.toUpperCase()?this.searchoptions.custom_value.call(i,l.children(".customelement:first"),"get"):l.val(),e||"nu"===r||"nn"===r)a[n]=e,s[n]=r,o++;else try{delete i.p.postData[n]}catch(t){}});var l=o>0;if(t.stringResult===!0||"local"===i.p.datatype||t.searchOperators===!0){var d='{"groupOp":"'+t.groupOp+'","rules":[',h=0;$.each(a,function(t,e){h>0&&(d+=","),d+='{"field":"'+t+'",',d+='"op":"'+s[t]+'",',e+="",d+='"data":"'+e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',h++}),d+="]}",$.extend(i.p.postData,{filters:d}),$.each(["searchField","searchString","searchOper"],function(t,e){i.p.postData.hasOwnProperty(e)&&delete i.p.postData[e]})}else $.extend(i.p.postData,a);var c;i.p.searchurl&&(c=i.p.url,$(i).jqGrid("setGridParam",{url:i.p.searchurl}));var u="stop"===$(i).triggerHandler("jqGridToolbarBeforeSearch");!u&&$.isFunction(t.beforeSearch)&&(u=t.beforeSearch.call(i)),u||$(i).jqGrid("setGridParam",{search:l}).trigger("reloadGrid",[{page:1}]),c&&$(i).jqGrid("setGridParam",{url:c}),$(i).triggerHandler("jqGridToolbarAfterSearch"),$.isFunction(t.afterSearch)&&t.afterSearch.call(i)},l=function(e){var n,r={},a=0;e="boolean"!=typeof e||e,$.each(i.p.colModel,function(){var t,e=$("#gs_"+i.p.idPrefix+$.jgrid.jqID(this.name),this.frozen===!0&&i.p.frozenColumns===!0?i.grid.fhDiv:i.grid.hDiv);switch(this.searchoptions&&void 0!==this.searchoptions.defaultValue&&(t=this.searchoptions.defaultValue),n=this.index||this.name,this.stype){case"select":if(e.find("option").each(function(e){if(0===e&&(this.selected=!0),$(this).val()===t)return this.selected=!0,!1}),void 0!==t)r[n]=t,a++;else try{delete i.p.postData[n]}catch(t){}break;case"text":if(e.val(t||""),void 0!==t)r[n]=t,a++;else try{delete i.p.postData[n]}catch(t){}break;case"custom":$.isFunction(this.searchoptions.custom_value)&&e.length>0&&"SPAN"===e[0].nodeName.toUpperCase()&&this.searchoptions.custom_value.call(i,e.children(".customelement:first"),"set",t||"")}});var o=a>0;if(i.p.resetsearch=!0,t.stringResult===!0||"local"===i.p.datatype){var s='{"groupOp":"'+t.groupOp+'","rules":[',l=0;$.each(r,function(t,e){l>0&&(s+=","),s+='{"field":"'+t+'",',s+='"op":"eq",',e+="",s+='"data":"'+e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',l++}),s+="]}",$.extend(i.p.postData,{filters:s}),$.each(["searchField","searchString","searchOper"],function(t,e){i.p.postData.hasOwnProperty(e)&&delete i.p.postData[e]})}else $.extend(i.p.postData,r);var d;i.p.searchurl&&(d=i.p.url,$(i).jqGrid("setGridParam",{url:i.p.searchurl}));var h="stop"===$(i).triggerHandler("jqGridToolbarBeforeClear");!h&&$.isFunction(t.beforeClear)&&(h=t.beforeClear.call(i)),h||e&&$(i).jqGrid("setGridParam",{search:o}).trigger("reloadGrid",[{page:1}]),d&&$(i).jqGrid("setGridParam",{url:d}),$(i).triggerHandler("jqGridToolbarAfterClear"),$.isFunction(t.afterClear)&&t.afterClear()},d=function(){var t=$("tr.ui-search-toolbar",i.grid.hDiv),e=i.p.frozenColumns===!0&&$("tr.ui-search-toolbar",i.grid.fhDiv);"none"===t.css("display")?(t.show(),e&&e.show()):(t.hide(),e&&e.hide())},h=function(e,n,o){$("#sopt_menu").remove(),n=parseInt(n,10),o=parseInt(o,10)+18;for(var l,d,h=$(".ui-jqgrid-view").css("font-size")||"11px",c='<ul id="sopt_menu" class="ui-search-menu modal-content" role="menu" tabindex="0" style="font-size:'+h+";left:"+n+"px;top:"+o+'px;">',u=$(e).attr("soper"),p=[],f=0,m=$(e).attr("colname"),g=i.p.colModel.length;f<g&&i.p.colModel[f].name!==m;)f++;var _=i.p.colModel[f],y=$.extend({},_.searchoptions);for(y.sopt||(y.sopt=[],y.sopt[0]="select"===_.stype?"eq":t.defaultSearch),$.each(t.odata,function(){p.push(this.oper)}),f=0;f<y.sopt.length;f++)d=$.inArray(y.sopt[f],p),d!==-1&&(l=u===t.odata[d].oper?a.highlight:"",c+='<li class="ui-menu-item '+l+'" role="presentation"><a class="'+a.cornerall+' g-menu-item" tabindex="0" role="menuitem" value="'+t.odata[d].oper+'" oper="'+t.operands[t.odata[d].oper]+'"><table class="ui-common-table"><tr><td width="25px">'+t.operands[t.odata[d].oper]+"</td><td>"+t.odata[d].text+"</td></tr></table></a></li>");c+="</ul>",$("body").append(c),$("#sopt_menu").addClass("ui-menu "+r.menu_widget),$("#sopt_menu > li > a").hover(function(){$(this).addClass(a.hover)},function(){$(this).removeClass(a.hover)}).click(function(){var n=$(this).attr("value"),r=$(this).attr("oper");if($(i).triggerHandler("jqGridToolbarSelectOper",[n,r,e]),$("#sopt_menu").hide(),$(e).text(r).attr("soper",n),t.autosearch===!0){var a=$(e).parent().next().children()[0];($(a).val()||"nu"===n||"nn"===n)&&s()}})},c=$("<tr class='ui-search-toolbar' role='row'></tr>");$.each(i.p.colModel,function(e){var a,l,d,h,u,p,f,m=this,g="",_="=",y=$("<th role='columnheader' class='"+o.headerBox+" ui-th-"+i.p.direction+"' id='gsh_"+i.p.id+"_"+m.name+"' ></th>"),v=$("<div></div>"),b=$("<table class='ui-search-table' cellspacing='0'><tr><td class='ui-search-oper' headers=''></td><td class='ui-search-input' headers=''></td><td class='ui-search-clear' headers=''></td></tr></table>");if(this.hidden===!0&&$(y).css("display","none"),this.search=this.search!==!1,void 0===this.stype&&(this.stype="text"),a=$.extend({},this.searchoptions||{},{name:m.index||m.name,id:"gs_"+i.p.idPrefix+m.name,oper:"search"}),this.search){if(t.searchOperators){for(l=a.sopt?a.sopt[0]:"select"===m.stype?"eq":t.defaultSearch,d=0;d<t.odata.length;d++)if(t.odata[d].oper===l){_=t.operands[l]||"";break}h=null!=a.searchtitle?a.searchtitle:t.operandTitle,g="<a title='"+h+"' style='padding-right: 0.5em;' soper='"+l+"' class='soptclass' colname='"+this.name+"'>"+_+"</a>"}switch($("td:eq(0)",b).attr("colindex",e).append(g),void 0===a.clearSearch&&(a.clearSearch=!0),a.clearSearch?(u=t.resetTitle||"Clear Search Value",$("td:eq(2)",b).append("<a title='"+u+"' style='padding-right: 0.3em;padding-left: 0.3em;' class='clearsearchclass'>"+t.resetIcon+"</a>")):$("td:eq(2)",b).hide(),this.surl&&(a.dataUrl=this.surl),p="",a.defaultValue&&(p=$.isFunction(a.defaultValue)?a.defaultValue.call(i):a.defaultValue),f=$.jgrid.createEl.call(i,this.stype,a,p,!1,$.extend({},$.jgrid.ajaxOptions,i.p.ajaxSelectOptions||{})),$(f).css({width:"100%"}).addClass(r.srInput),$("td:eq(1)",b).append(f),$(v).append(b),this.stype){case"select":t.autosearch===!0&&(a.dataEvents=[{type:"change",fn:function(){return s(),!1}}]);break;case"text":t.autosearch===!0&&(t.searchOnEnter?a.dataEvents=[{type:"keypress",fn:function(t){var e=t.charCode||t.keyCode||0;return 13===e?(s(),!1):this}}]:a.dataEvents=[{type:"keydown",fn:function(e){var i=e.which;switch(i){case 13:return!1;case 9:case 16:case 37:case 38:case 39:case 40:case 27:break;default:n&&clearTimeout(n),n=setTimeout(function(){s()},t.autosearchDelay)}}}])}$.jgrid.bindEv.call(i,f,a)}$(y).append(v),$(c).append(y),t.searchOperators||$("td:eq(0)",b).hide()}),$("table thead",i.grid.hDiv).append(c),t.searchOperators&&($(".soptclass",c).click(function(t){var e=$(this).offset(),i=e.left,n=e.top;h(this,i,n),t.stopPropagation()}),$("body").on("click",function(t){"soptclass"!==t.target.className&&$("#sopt_menu").hide()})),$(".clearsearchclass",c).click(function(){var e=$(this).parents("tr:first"),n=parseInt($("td.ui-search-oper",e).attr("colindex"),10),r=$.extend({},i.p.colModel[n].searchoptions||{}),a=r.defaultValue?r.defaultValue:"";"select"===i.p.colModel[n].stype?a?$("td.ui-search-input select",e).val(a):$("td.ui-search-input select",e)[0].selectedIndex=0:$("td.ui-search-input input",e).val(a),t.autosearch===!0&&s()}),this.p.filterToolbar=!0,this.triggerToolbar=s,this.clearToolbar=l,this.toggleToolbar=d}})},destroyFilterToolbar:function(){return this.each(function(){this.p.filterToolbar&&(this.triggerToolbar=null,this.clearToolbar=null,this.toggleToolbar=null,this.p.filterToolbar=!1,$(this.grid.hDiv).find("table thead tr.ui-search-toolbar").remove())})},searchGrid:function(t){var e=$.jgrid.getRegional(this[0],"search");return t=$.extend(!0,{recreateFilter:!1,drag:!0,sField:"searchField",sValue:"searchString",sOper:"searchOper",sFilter:"filters",loadDefaults:!0,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,afterRedraw:null,afterChange:null,sortStrategy:null,closeAfterSearch:!1,closeAfterReset:!1,closeOnEscape:!1,searchOnEnter:!1,multipleSearch:!1,multipleGroup:!1,top:0,left:0,jqModal:!0,modal:!1,resize:!0,width:450,height:"auto",dataheight:"auto",showQuery:!1,errorcheck:!0,sopt:null,stringResult:void 0,onClose:null,onSearch:null,onReset:null,toTop:!0,overlay:30,columns:[],tmplNames:null,tmplFilters:null,tmplLabel:" Template: ",showOnLoad:!1,layer:null,operands:{eq:"=",ne:"<>",lt:"<",le:"<=",gt:">",ge:">=",bw:"LIKE",bn:"NOT LIKE","in":"IN",ni:"NOT IN",ew:"LIKE",en:"NOT LIKE",cn:"LIKE",nc:"NOT LIKE",nu:"IS NULL",nn:"ISNOT NULL"}},e,t||{}),this.each(function(){function e(e){a=$(i).triggerHandler("jqGridFilterBeforeShow",[e]),void 0===a&&(a=!0),a&&$.isFunction(t.beforeShowSearch)&&(a=t.beforeShowSearch.call(i,e)),a&&($.jgrid.viewModal("#"+$.jgrid.jqID(s.themodal),{gbox:"#gbox_"+$.jgrid.jqID(r),jqm:t.jqModal,modal:t.modal,overlay:t.overlay,toTop:t.toTop}),$(i).triggerHandler("jqGridFilterAfterShow",[e]),$.isFunction(t.afterShowSearch)&&t.afterShowSearch.call(i,e))}var i=this;if(i.grid){var n,r="fbox_"+i.p.id,a=!0,o=!0,s={themodal:"searchmod"+r,modalhead:"searchhd"+r,modalcontent:"searchcnt"+r,scrollelm:r},l=i.p.postData[t.sFilter],d=$.jgrid.styleUI[i.p.styleUI||"jQueryUI"].filter,h=$.jgrid.styleUI[i.p.styleUI||"jQueryUI"].common;if(t.styleUI=i.p.styleUI,"string"==typeof l&&(l=$.jgrid.parse(l)),t.recreateFilter===!0&&$("#"+$.jgrid.jqID(s.themodal)).remove(),void 0!==$("#"+$.jgrid.jqID(s.themodal))[0])e($("#fbox_"+$.jgrid.jqID(i.p.id)));else{var c=$("<div><div id='"+r+"' class='searchFilter' style='overflow:auto'></div></div>").insertBefore("#gview_"+$.jgrid.jqID(i.p.id)),u="left",p="";"rtl"===i.p.direction&&(u="right",p=" style='text-align:left'",c.attr("dir","rtl"));var f,m,g=$.extend([],i.p.colModel),_="<a id='"+r+"_search' class='fm-button "+h.button+" fm-button-icon-right ui-search'><span class='"+h.icon_base+" "+d.icon_search+"'></span>"+t.Find+"</a>",y="<a id='"+r+"_reset' class='fm-button "+h.button+" fm-button-icon-left ui-reset'><span class='"+h.icon_base+" "+d.icon_reset+"'></span>"+t.Reset+"</a>",v="",b="",w=!1,x=-1;if(t.showQuery&&(v="<a id='"+r+"_query' class='fm-button "+h.button+" fm-button-icon-left'><span class='"+h.icon_base+" "+d.icon_query+"'></span>Query</a>"),t.columns.length?(g=t.columns,x=0,f=g[0].index||g[0].name):$.each(g,function(t,e){if(e.label||(e.label=i.p.colNames[t]),!w){var n=void 0===e.search||e.search,r=e.hidden===!0,a=e.searchoptions&&e.searchoptions.searchhidden===!0;(a&&n||n&&!r)&&(w=!0,f=e.index||e.name,x=t)}}),!l&&f||t.multipleSearch===!1){var k="eq";x>=0&&g[x].searchoptions&&g[x].searchoptions.sopt?k=g[x].searchoptions.sopt[0]:t.sopt&&t.sopt.length&&(k=t.sopt[0]),l={groupOp:"AND",rules:[{field:f,op:k,data:""}]}}w=!1,t.tmplNames&&t.tmplNames.length&&(w=!0,b="<tr><td class='ui-search-label'>"+t.tmplLabel+"</td>",b+="<td><select class='ui-template "+d.srSelect+"'>",b+="<option value='default'>Default</option>",$.each(t.tmplNames,function(t,e){b+="<option value='"+t+"'>"+e+"</option>"}),b+="</select></td></tr>"),m="<table class='EditTable' style='border:0px none;margin-top:5px' id='"+r+"_2'><tbody><tr><td colspan='2'><hr class='"+h.content+"' style='margin:1px'/></td></tr>"+b+"<tr><td class='EditButton' style='text-align:"+u+"'>"+y+"</td><td class='EditButton' "+p+">"+v+_+"</td></tr></tbody></table>",r=$.jgrid.jqID(r),$("#"+r).jqFilter({columns:g,sortStrategy:t.sortStrategy,filter:t.loadDefaults?l:null,showQuery:t.showQuery,errorcheck:t.errorcheck,sopt:t.sopt,groupButton:t.multipleGroup,ruleButtons:t.multipleSearch,afterRedraw:t.afterRedraw,ops:t.odata,operands:t.operands,ajaxSelectOptions:i.p.ajaxSelectOptions,groupOps:t.groupOps,onChange:function(){this.p.showQuery&&$(".query",this).html(this.toUserFriendlyString()),$.isFunction(t.afterChange)&&t.afterChange.call(i,$("#"+r),t)},direction:i.p.direction,id:i.p.id}),c.append(m),w&&t.tmplFilters&&t.tmplFilters.length&&$(".ui-template",c).bind("change",function(){var e=$(this).val();return"default"===e?$("#"+r).jqFilter("addFilter",l):$("#"+r).jqFilter("addFilter",t.tmplFilters[parseInt(e,10)]),!1}),t.multipleGroup===!0&&(t.multipleSearch=!0),$(i).triggerHandler("jqGridFilterInitialize",[$("#"+r)]),$.isFunction(t.onInitializeSearch)&&t.onInitializeSearch.call(i,$("#"+r)),t.gbox="#gbox_"+r,t.layer?$.jgrid.createModal(s,c,t,"#gview_"+$.jgrid.jqID(i.p.id),$("#gbox_"+$.jgrid.jqID(i.p.id))[0],"#"+$.jgrid.jqID(t.layer),{position:"relative"}):$.jgrid.createModal(s,c,t,"#gview_"+$.jgrid.jqID(i.p.id),$("#gbox_"+$.jgrid.jqID(i.p.id))[0]),(t.searchOnEnter||t.closeOnEscape)&&$("#"+$.jgrid.jqID(s.themodal)).keydown(function(e){var i=$(e.target);return!t.searchOnEnter||13!==e.which||i.hasClass("add-group")||i.hasClass("add-rule")||i.hasClass("delete-group")||i.hasClass("delete-rule")||i.hasClass("fm-button")&&i.is("[id$=_query]")?t.closeOnEscape&&27===e.which?($("#"+$.jgrid.jqID(s.modalhead)).find(".ui-jqdialog-titlebar-close").click(),!1):void 0:($("#"+r+"_search").click(),!1)}),v&&$("#"+r+"_query").bind("click",function(){return $(".queryresult",c).toggle(),!1}),void 0===t.stringResult&&(t.stringResult=t.multipleSearch),$("#"+r+"_search").bind("click",function(){var e,a,l={};if(n=$("#"+r),n.find(".input-elm:focus").change(),a=n.jqFilter("filterData"),t.errorcheck&&(n[0].hideError(),t.showQuery||n.jqFilter("toSQLString"),n[0].p.error))return n[0].showError(),!1;if(t.stringResult){try{e=JSON.stringify(a)}catch(t){}"string"==typeof e&&(l[t.sFilter]=e,$.each([t.sField,t.sValue,t.sOper],function(){l[this]=""}))}else t.multipleSearch?(l[t.sFilter]=a,$.each([t.sField,t.sValue,t.sOper],function(){l[this]=""})):(l[t.sField]=a.rules[0].field,l[t.sValue]=a.rules[0].data,l[t.sOper]=a.rules[0].op,l[t.sFilter]="");return i.p.search=!0,$.extend(i.p.postData,l),o=$(i).triggerHandler("jqGridFilterSearch"),void 0===o&&(o=!0),o&&$.isFunction(t.onSearch)&&(o=t.onSearch.call(i,i.p.filters)),o!==!1&&$(i).trigger("reloadGrid",[{page:1}]),t.closeAfterSearch&&$.jgrid.hideModal("#"+$.jgrid.jqID(s.themodal),{gb:"#gbox_"+$.jgrid.jqID(i.p.id),jqm:t.jqModal,onClose:t.onClose}),!1}),$("#"+r+"_reset").bind("click",function(){var e={},n=$("#"+r);return i.p.search=!1,i.p.resetsearch=!0,t.multipleSearch===!1?e[t.sField]=e[t.sValue]=e[t.sOper]="":e[t.sFilter]="",n[0].resetFilter(),w&&$(".ui-template",c).val("default"),$.extend(i.p.postData,e),o=$(i).triggerHandler("jqGridFilterReset"),void 0===o&&(o=!0),o&&$.isFunction(t.onReset)&&(o=t.onReset.call(i)),o!==!1&&$(i).trigger("reloadGrid",[{page:1}]),t.closeAfterReset&&$.jgrid.hideModal("#"+$.jgrid.jqID(s.themodal),{gb:"#gbox_"+$.jgrid.jqID(i.p.id),jqm:t.jqModal,onClose:t.onClose}),!1}),e($("#"+r)),$(".fm-button:not(."+h.disabled+")",c).hover(function(){$(this).addClass(h.hover)},function(){$(this).removeClass(h.hover)})}}})}});var rp_ge={};if($.jgrid.extend({editGridRow:function(t,e){var i=$.jgrid.getRegional(this[0],"edit"),n=this[0].p.styleUI,r=$.jgrid.styleUI[n].formedit,a=$.jgrid.styleUI[n].common;return e=$.extend(!0,{top:0,left:0,width:"500",datawidth:"auto",height:"auto",dataheight:"auto",modal:!1,overlay:30,drag:!0,resize:!0,url:null,mtype:"POST",clearAfterAdd:!0,closeAfterEdit:!1,reloadAfterSubmit:!0,onInitializeForm:null,beforeInitData:null,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,afterSubmit:null,onclickSubmit:null,afterComplete:null,onclickPgButtons:null,afterclickPgButtons:null,editData:{},recreateForm:!1,jqModal:!0,closeOnEscape:!1,addedrow:"first",topinfo:"",bottominfo:"",saveicon:[],closeicon:[],savekey:[!1,13],navkeys:[!1,38,40],checkOnSubmit:!1,checkOnUpdate:!1,_savedData:{},processing:!1,onClose:null,ajaxEditOptions:{},serializeEditData:null,viewPagerButtons:!0,overlayClass:a.overlay,removemodal:!0,form:"edit",template:null,focusField:!0},i,e||{}),rp_ge[$(this)[0].p.id]=e,this.each(function(){function i(){return $(k).find(".FormElement").each(function(){var t=$(".customelement",this);if(t.length){var e=t[0],i=$(e).attr("name");$.each(m.p.colModel,function(){if(this.name===i&&this.editoptions&&$.isFunction(this.editoptions.custom_value)){try{if(_[i]=this.editoptions.custom_value.call(m,$("#"+$.jgrid.jqID(i),k),"get"),void 0===_[i])throw"e1"}catch(t){"e1"===t?$.jgrid.info_dialog(D.errcap,"function 'custom_value' "+rp_ge[$(this)[0]].p.msg.novalue,rp_ge[$(this)[0]].p.bClose,{styleUI:rp_ge[$(this)[0]].p.styleUI}):$.jgrid.info_dialog(D.errcap,t.message,rp_ge[$(this)[0]].p.bClose,{styleUI:rp_ge[$(this)[0]].p.styleUI})}return!0}})}else{switch($(this).get(0).type){case"checkbox":if($(this).is(":checked"))_[this.name]=$(this).val();else{var n=$(this).attr("offval");_[this.name]=n}break;case"select-one":_[this.name]=$("option:selected",this).val();break;case"select-multiple":_[this.name]=$(this).val(),_[this.name]?_[this.name]=_[this.name].join(","):_[this.name]="";var r=[];$("option:selected",this).each(function(t,e){r[t]=$(e).text()});break;case"password":case"text":case"textarea":case"button":_[this.name]=$(this).val()}m.p.autoencode&&(_[this.name]=$.jgrid.htmlEncode(_[this.name]))}}),!0}function n(t,e,i,n){var a,o,s,l,d,h,c,u=0,p=[],f=!1,g="<td class='CaptionTD'>&#160;</td><td class='DataTD'>&#160;</td>",_="";for(c=1;c<=n;c++)_+=g;if("_empty"!==t&&(f=$(e).jqGrid("getInd",t)),$(e.p.colModel).each(function(c){if(a=this.name,o=(!this.editrules||this.editrules.edithidden!==!0)&&this.hidden===!0,d=o?"style='display:none'":"","cb"!==a&&"subgrid"!==a&&this.editable===!0&&"rn"!==a){if(f===!1)l="";else if(a===e.p.ExpandColumn&&e.p.treeGrid===!0)l=$("td[role='gridcell']:eq("+c+")",e.rows[f]).text();else{try{l=$.unformat.call(e,$("td[role='gridcell']:eq("+c+")",e.rows[f]),{rowId:t,colModel:this},c)}catch(t){l=this.edittype&&"textarea"===this.edittype?$("td[role='gridcell']:eq("+c+")",e.rows[f]).text():$("td[role='gridcell']:eq("+c+")",e.rows[f]).html()}(!l||"&nbsp;"===l||"&#160;"===l||1===l.length&&160===l.charCodeAt(0))&&(l="")}var g=$.extend({},this.editoptions||{},{id:a,name:a,rowId:t,oper:"edit"}),y=$.extend({},{elmprefix:"",elmsuffix:"",rowabove:!1,rowcontent:""},this.formoptions||{}),v=parseInt(y.rowpos,10)||u+1,b=parseInt(2*(parseInt(y.colpos,10)||1),10);if("_empty"===t&&g.defaultValue&&(l=$.isFunction(g.defaultValue)?g.defaultValue.call(m):g.defaultValue),this.edittype||(this.edittype="text"),m.p.autoencode&&(l=$.jgrid.htmlDecode(l)),h=$.jgrid.createEl.call(m,this.edittype,g,l,!1,$.extend({},$.jgrid.ajaxOptions,e.p.ajaxSelectOptions||{})),"select"===this.edittype&&(l=$(h).val(),"select-multiple"===$(h).get(0).type&&l&&(l=l.join(","))),"checkbox"===this.edittype&&(l=$(h).is(":checked")?$(h).val():$(h).attr("offval")),(rp_ge[m.p.id].checkOnSubmit||rp_ge[m.p.id].checkOnUpdate)&&(rp_ge[m.p.id]._savedData[a]=l),$(h).addClass("FormElement"),$.inArray(this.edittype,["text","textarea","password","select"])>-1&&$(h).addClass(r.inputClass),P)$(O).find("#"+a).replaceWith(h);else{if(s=$(i).find("tr[rowpos="+v+"]"),y.rowabove){var x=$("<tr><td class='contentinfo' colspan='"+2*n+"'>"+y.rowcontent+"</td></tr>");$(i).append(x),x[0].rp=v}0===s.length&&(s=$("<tr "+d+" rowpos='"+v+"'></tr>").addClass("FormData").attr("id","tr_"+a),$(s).append(_),$(i).append(s),s[0].rp=v),$("td:eq("+(b-2)+")",s[0]).html("<label for='"+a+"'>"+(void 0===y.label?e.p.colNames[c]:y.label)+"</label>"),$("td:eq("+(b-1)+")",s[0]).append(y.elmprefix).append(h).append(y.elmsuffix)}"custom"===this.edittype&&$.isFunction(g.custom_value)&&g.custom_value.call(m,$("#"+a,w),"set",l),$.jgrid.bindEv.call(m,h,g),p[u]=c,u++}}),u>0){var y;P?(y="<div class='FormData' style='display:none'><input class='FormElement' id='id_g' type='text' name='"+e.p.id+"_id' value='"+t+"'/>",$(O).append(y)):(y=$("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(2*n-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='"+e.p.id+"_id' value='"+t+"'/></td></tr>"),y[0].rp=u+999,$(i).append(y)),(rp_ge[m.p.id].checkOnSubmit||rp_ge[m.p.id].checkOnUpdate)&&(rp_ge[m.p.id]._savedData[e.p.id+"_id"]=t)}return p}function o(t,e,i){var n,r,a,o,s,l,d=0;(rp_ge[m.p.id].checkOnSubmit||rp_ge[m.p.id].checkOnUpdate)&&(rp_ge[m.p.id]._savedData={},rp_ge[m.p.id]._savedData[e.p.id+"_id"]=t);var h=e.p.colModel;if("_empty"===t)return $(h).each(function(){n=this.name,o=$.extend({},this.editoptions||{}),a=$("#"+$.jgrid.jqID(n),i),a&&a.length&&null!==a[0]&&(s="","custom"===this.edittype&&$.isFunction(o.custom_value)?o.custom_value.call(m,$("#"+n,i),"set",s):o.defaultValue?(s=$.isFunction(o.defaultValue)?o.defaultValue.call(m):o.defaultValue,"checkbox"===a[0].type?(l=s.toLowerCase(),l.search(/(false|f|0|no|n|off|undefined)/i)<0&&""!==l?(a[0].checked=!0,a[0].defaultChecked=!0,a[0].value=s):(a[0].checked=!1,a[0].defaultChecked=!1)):a.val(s)):"checkbox"===a[0].type?(a[0].checked=!1,a[0].defaultChecked=!1,s=$(a).attr("offval")):a[0].type&&"select"===a[0].type.substr(0,6)?a[0].selectedIndex=0:a.val(s),(rp_ge[m.p.id].checkOnSubmit===!0||rp_ge[m.p.id].checkOnUpdate)&&(rp_ge[m.p.id]._savedData[n]=s))}),void $("#id_g",i).val(t);var c=$(e).jqGrid("getInd",t,!0);c&&($('td[role="gridcell"]',c).each(function(a){if(n=h[a].name,"cb"!==n&&"subgrid"!==n&&"rn"!==n&&h[a].editable===!0){if(n===e.p.ExpandColumn&&e.p.treeGrid===!0)r=$(this).text();else try{r=$.unformat.call(e,$(this),{rowId:t,colModel:h[a]},a)}catch(t){r="textarea"===h[a].edittype?$(this).text():$(this).html()}switch(m.p.autoencode&&(r=$.jgrid.htmlDecode(r)),(rp_ge[m.p.id].checkOnSubmit===!0||rp_ge[m.p.id].checkOnUpdate)&&(rp_ge[m.p.id]._savedData[n]=r),n=$.jgrid.jqID(n),h[a].edittype){case"password":case"text":case"button":
case"image":case"textarea":("&nbsp;"===r||"&#160;"===r||1===r.length&&160===r.charCodeAt(0))&&(r=""),$("#"+n,i).val(r);break;case"select":var o=r.split(",");o=$.map(o,function(t){return $.trim(t)}),$("#"+n+" option",i).each(function(){h[a].editoptions.multiple||$.trim(r)!==$.trim($(this).text())&&o[0]!==$.trim($(this).text())&&o[0]!==$.trim($(this).val())?h[a].editoptions.multiple&&($.inArray($.trim($(this).text()),o)>-1||$.inArray($.trim($(this).val()),o)>-1)?this.selected=!0:this.selected=!1:this.selected=!0}),(rp_ge[m.p.id].checkOnSubmit===!0||rp_ge[m.p.id].checkOnUpdate)&&(r=$("#"+n,i).val(),h[a].editoptions.multiple&&(r=r.join(",")),rp_ge[m.p.id]._savedData[n]=r);break;case"checkbox":if(r=String(r),h[a].editoptions&&h[a].editoptions.value){var s=h[a].editoptions.value.split(":");s[0]===r?$("#"+n,i)[m.p.useProp?"prop":"attr"]({checked:!0,defaultChecked:!0}):$("#"+n,i)[m.p.useProp?"prop":"attr"]({checked:!1,defaultChecked:!1})}else r=r.toLowerCase(),r.search(/(false|f|0|no|n|off|undefined)/i)<0&&""!==r?($("#"+n,i)[m.p.useProp?"prop":"attr"]("checked",!0),$("#"+n,i)[m.p.useProp?"prop":"attr"]("defaultChecked",!0)):($("#"+n,i)[m.p.useProp?"prop":"attr"]("checked",!1),$("#"+n,i)[m.p.useProp?"prop":"attr"]("defaultChecked",!1));(rp_ge[m.p.id].checkOnSubmit===!0||rp_ge[m.p.id].checkOnUpdate)&&(r=$("#"+n,i).is(":checked")?$("#"+n,i).val():$("#"+n,i).attr("offval"));break;case"custom":try{if(!h[a].editoptions||!$.isFunction(h[a].editoptions.custom_value))throw"e1";h[a].editoptions.custom_value.call(m,$("#"+n,i),"set",r)}catch(t){"e1"===t?$.jgrid.info_dialog(D.errcap,"function 'custom_value' "+rp_ge[$(this)[0]].p.msg.nodefined,$.rp_ge[$(this)[0]].p.bClose,{styleUI:rp_ge[$(this)[0]].p.styleUI}):$.jgrid.info_dialog(D.errcap,t.message,$.rp_ge[$(this)[0]].p.bClose,{styleUI:rp_ge[$(this)[0]].p.styleUI})}}d++}}),d>0&&$("#id_g",k).val(t))}function s(){$.each(m.p.colModel,function(t,e){e.editoptions&&e.editoptions.NullIfEmpty===!0&&_.hasOwnProperty(e.name)&&""===_[e.name]&&(_[e.name]="null")})}function l(){var t,i,n,r,l,d,h,c=[!0,"",""],u={},p=m.p.prmNames,f=$(m).triggerHandler("jqGridAddEditBeforeCheckValues",[$(w),v]);f&&"object"==typeof f&&(_=f),$.isFunction(rp_ge[m.p.id].beforeCheckValues)&&(f=rp_ge[m.p.id].beforeCheckValues.call(m,_,$(w),v),f&&"object"==typeof f&&(_=f));for(r in _)if(_.hasOwnProperty(r)&&(c=$.jgrid.checkValues.call(m,_[r],r),c[0]===!1))break;if(s(),c[0]&&(u=$(m).triggerHandler("jqGridAddEditClickSubmit",[rp_ge[m.p.id],_,v]),void 0===u&&$.isFunction(rp_ge[m.p.id].onclickSubmit)&&(u=rp_ge[m.p.id].onclickSubmit.call(m,rp_ge[m.p.id],_,v)||{}),c=$(m).triggerHandler("jqGridAddEditBeforeSubmit",[_,$(w),v]),void 0===c&&(c=[!0,"",""]),c[0]&&$.isFunction(rp_ge[m.p.id].beforeSubmit)&&(c=rp_ge[m.p.id].beforeSubmit.call(m,_,$(w),v))),c[0]&&!rp_ge[m.p.id].processing){if(rp_ge[m.p.id].processing=!0,$("#sData",k+"_2").addClass(a.active),h=rp_ge[m.p.id].url||$(m).jqGrid("getGridParam","editurl"),n=p.oper,i="clientArray"===h?m.p.keyName:p.id,_[n]="_empty"===$.trim(_[m.p.id+"_id"])?p.addoper:p.editoper,_[n]!==p.addoper?_[i]=_[m.p.id+"_id"]:void 0===_[i]&&(_[i]=_[m.p.id+"_id"]),delete _[m.p.id+"_id"],_=$.extend(_,rp_ge[m.p.id].editData,u),m.p.treeGrid===!0){if(_[n]===p.addoper){l=$(m).jqGrid("getGridParam","selrow");var g="adjacency"===m.p.treeGridModel?m.p.treeReader.parent_id_field:"parent_id";_[g]=l}for(d in m.p.treeReader)if(m.p.treeReader.hasOwnProperty(d)){var y=m.p.treeReader[d];if(_.hasOwnProperty(y)){if(_[n]===p.addoper&&"parent_id_field"===d)continue;delete _[y]}}}_[i]=$.jgrid.stripPref(m.p.idPrefix,_[i]);var x=$.extend({url:h,type:rp_ge[m.p.id].mtype,data:$.isFunction(rp_ge[m.p.id].serializeEditData)?rp_ge[m.p.id].serializeEditData.call(m,_):_,complete:function(r,s){var d;if($("#sData",k+"_2").removeClass(a.active),_[i]=m.p.idPrefix+_[i],r.status>=300&&304!==r.status?(c[0]=!1,c[1]=$(m).triggerHandler("jqGridAddEditErrorTextFormat",[r,v]),$.isFunction(rp_ge[m.p.id].errorTextFormat)?c[1]=rp_ge[m.p.id].errorTextFormat.call(m,r,v):c[1]=s+" Status: '"+r.statusText+"'. Error code: "+r.status):(c=$(m).triggerHandler("jqGridAddEditAfterSubmit",[r,_,v]),void 0===c&&(c=[!0,"",""]),c[0]&&$.isFunction(rp_ge[m.p.id].afterSubmit)&&(c=rp_ge[m.p.id].afterSubmit.call(m,r,_,v))),c[0]===!1)$(".FormError",w).html(c[1]),$(".FormError",w).show();else if(m.p.autoencode&&$.each(_,function(t,e){_[t]=$.jgrid.htmlDecode(e)}),_[n]===p.addoper?(c[2]||(c[2]=$.jgrid.randId()),null==_[i]||"_empty"===_[i]?_[i]=c[2]:c[2]=_[i],rp_ge[m.p.id].reloadAfterSubmit?$(m).trigger("reloadGrid"):m.p.treeGrid===!0?$(m).jqGrid("addChildNode",c[2],l,_):$(m).jqGrid("addRowData",c[2],_,e.addedrow),rp_ge[m.p.id].closeAfterAdd?(m.p.treeGrid!==!0&&$(m).jqGrid("setSelection",c[2]),$.jgrid.hideModal("#"+$.jgrid.jqID(L.themodal),{gb:"#gbox_"+$.jgrid.jqID(b),jqm:e.jqModal,onClose:rp_ge[m.p.id].onClose,removemodal:rp_ge[m.p.id].removemodal,formprop:!rp_ge[m.p.id].recreateForm,form:rp_ge[m.p.id].form})):rp_ge[m.p.id].clearAfterAdd&&o("_empty",m,w)):(rp_ge[m.p.id].reloadAfterSubmit?($(m).trigger("reloadGrid"),rp_ge[m.p.id].closeAfterEdit||setTimeout(function(){$(m).jqGrid("setSelection",_[i])},1e3)):m.p.treeGrid===!0?$(m).jqGrid("setTreeRow",_[i],_):$(m).jqGrid("setRowData",_[i],_),rp_ge[m.p.id].closeAfterEdit&&$.jgrid.hideModal("#"+$.jgrid.jqID(L.themodal),{gb:"#gbox_"+$.jgrid.jqID(b),jqm:e.jqModal,onClose:rp_ge[m.p.id].onClose,removemodal:rp_ge[m.p.id].removemodal,formprop:!rp_ge[m.p.id].recreateForm,form:rp_ge[m.p.id].form})),$.isFunction(rp_ge[m.p.id].afterComplete)&&(t=r,setTimeout(function(){$(m).triggerHandler("jqGridAddEditAfterComplete",[t,_,$(w),v]),rp_ge[m.p.id].afterComplete.call(m,t,_,$(w),v),t=null},500)),(rp_ge[m.p.id].checkOnSubmit||rp_ge[m.p.id].checkOnUpdate)&&($(w).data("disabled",!1),"_empty"!==rp_ge[m.p.id]._savedData[m.p.id+"_id"]))for(d in rp_ge[m.p.id]._savedData)rp_ge[m.p.id]._savedData.hasOwnProperty(d)&&_[d]&&(rp_ge[m.p.id]._savedData[d]=_[d]);rp_ge[m.p.id].processing=!1;try{$(":input:visible",w)[0].focus()}catch(t){}}},$.jgrid.ajaxOptions,rp_ge[m.p.id].ajaxEditOptions);if(x.url||rp_ge[m.p.id].useDataProxy||($.isFunction(m.p.dataProxy)?rp_ge[m.p.id].useDataProxy=!0:(c[0]=!1,c[1]+=" "+D.nourl)),c[0])if(rp_ge[m.p.id].useDataProxy){var C=m.p.dataProxy.call(m,x,"set_"+m.p.id);void 0===C&&(C=[!0,""]),C[0]===!1?(c[0]=!1,c[1]=C[1]||"Error deleting the selected row!"):(x.data.oper===p.addoper&&rp_ge[m.p.id].closeAfterAdd&&$.jgrid.hideModal("#"+$.jgrid.jqID(L.themodal),{gb:"#gbox_"+$.jgrid.jqID(b),jqm:e.jqModal,onClose:rp_ge[m.p.id].onClose,removemodal:rp_ge[m.p.id].removemodal,formprop:!rp_ge[m.p.id].recreateForm,form:rp_ge[m.p.id].form}),x.data.oper===p.editoper&&rp_ge[m.p.id].closeAfterEdit&&$.jgrid.hideModal("#"+$.jgrid.jqID(L.themodal),{gb:"#gbox_"+$.jgrid.jqID(b),jqm:e.jqModal,onClose:rp_ge[m.p.id].onClose,removemodal:rp_ge[m.p.id].removemodal,formprop:!rp_ge[m.p.id].recreateForm,form:rp_ge[m.p.id].form}))}else"clientArray"===x.url?(rp_ge[m.p.id].reloadAfterSubmit=!1,_=x.data,x.complete({status:200,statusText:""},"")):$.ajax(x)}c[0]===!1&&($(".FormError",w).html(c[1]),$(".FormError",w).show())}function d(t,e){var i,n=!1;for(i in t)if(t.hasOwnProperty(i)&&t[i]!=e[i]){n=!0;break}return n}function h(){var t=!0;return $(".FormError",w).hide(),rp_ge[m.p.id].checkOnUpdate&&(_={},i(),y=d(_,rp_ge[m.p.id]._savedData),y&&($(w).data("disabled",!0),$(".confirm","#"+L.themodal).show(),t=!1)),t}function c(){var e;if("_empty"!==t&&void 0!==m.p.savedRow&&m.p.savedRow.length>0&&$.isFunction($.fn.jqGrid.restoreRow))for(e=0;e<m.p.savedRow.length;e++)if(m.p.savedRow[e].id===t){$(m).jqGrid("restoreRow",t);break}}function u(t,e){var i=e[1].length-1;0===t?$("#pData",g).addClass(a.disabled):void 0!==e[1][t-1]&&$("#"+$.jgrid.jqID(e[1][t-1])).hasClass(a.disabled)?$("#pData",g).addClass(a.disabled):$("#pData",g).removeClass(a.disabled),t===i?$("#nData",g).addClass(a.disabled):void 0!==e[1][t+1]&&$("#"+$.jgrid.jqID(e[1][t+1])).hasClass(a.disabled)?$("#nData",g).addClass(a.disabled):$("#nData",g).removeClass(a.disabled)}function p(){var t=$(m).jqGrid("getDataIDs"),e=$("#id_g",k).val(),i=$.inArray(e,t);return[i,t]}function f(t){var e="";return"string"==typeof t&&(e=t.replace(/\{([\w\-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,function(t,e){return'<span id="'+e+'" ></span>'})),e}var m=this;if(m.grid&&t){var g,_,y,v,b=m.p.id,w="FrmGrid_"+b,x="TblGrid_"+b,k="#"+$.jgrid.jqID(x),L={themodal:"editmod"+b,modalhead:"edithd"+b,modalcontent:"editcnt"+b,scrollelm:w},C=!0,T=1,M=0,P="string"==typeof rp_ge[m.p.id].template&&rp_ge[m.p.id].template.length>0,D=$.jgrid.getRegional(this,"errors");rp_ge[m.p.id].styleUI=m.p.styleUI||"jQueryUI",$.jgrid.isMobile()&&(rp_ge[m.p.id].resize=!1),"new"===t?(t="_empty",v="add",e.caption=rp_ge[m.p.id].addCaption):(e.caption=rp_ge[m.p.id].editCaption,v="edit"),e.recreateForm||$(m).data("formProp")&&$.extend(rp_ge[$(this)[0].p.id],$(m).data("formProp"));var S=!0;e.checkOnUpdate&&e.jqModal&&!e.modal&&(S=!1);var I,E=isNaN(rp_ge[$(this)[0].p.id].dataheight)?rp_ge[$(this)[0].p.id].dataheight:rp_ge[$(this)[0].p.id].dataheight+"px",U=isNaN(rp_ge[$(this)[0].p.id].datawidth)?rp_ge[$(this)[0].p.id].datawidth:rp_ge[$(this)[0].p.id].datawidth+"px",O=$("<form name='FormPost' id='"+w+"' class='FormGrid' onSubmit='return false;' style='width:"+U+";height:"+E+";'></form>").data("disabled",!1);if(P?(I=f(rp_ge[$(this)[0].p.id].template),g=k):(I=$("<table id='"+x+"' class='EditTable ui-common-table'><tbody></tbody></table>"),g=k+"_2"),w="#"+$.jgrid.jqID(w),$(O).append("<div class='FormError "+a.error+"' style='display:none;'></div>"),$(O).append("<div class='tinfo topinfo'>"+rp_ge[m.p.id].topinfo+"</div>"),$(m.p.colModel).each(function(){var t=this.formoptions;T=Math.max(T,t?t.colpos||0:0),M=Math.max(M,t?t.rowpos||0:0)}),$(O).append(I),C=$(m).triggerHandler("jqGridAddEditBeforeInitData",[O,v]),void 0===C&&(C=!0),C&&$.isFunction(rp_ge[m.p.id].beforeInitData)&&(C=rp_ge[m.p.id].beforeInitData.call(m,O,v)),C!==!1){c(),n(t,m,I,T);var j="rtl"===m.p.direction,A=j?"nData":"pData",z=j?"pData":"nData",B="<a id='"+A+"' class='fm-button "+a.button+"'><span class='"+a.icon_base+" "+r.icon_prev+"'></span></a>",R="<a id='"+z+"' class='fm-button "+a.button+"'><span class='"+a.icon_base+" "+r.icon_next+"'></span></a>",F="<a id='sData' class='fm-button "+a.button+"'>"+e.bSubmit+"</a>",N="<a id='cData' class='fm-button "+a.button+"'>"+e.bCancel+"</a>",H="<table style='height:auto' class='EditTable ui-common-table' id='"+x+"_2'><tbody><tr><td colspan='2'><hr class='"+a.content+"' style='margin:1px'/></td></tr><tr id='Act_Buttons'><td class='navButton'>"+(j?R+B:B+R)+"</td><td class='EditButton'>"+F+N+"</td></tr>";if(H+="</tbody></table>",M>0){var q=[];$.each($(I)[0].rows,function(t,e){q[t]=e}),q.sort(function(t,e){return t.rp>e.rp?1:t.rp<e.rp?-1:0}),$.each(q,function(t,e){$("tbody",I).append(e)})}e.gbox="#gbox_"+$.jgrid.jqID(b);var G=!1;e.closeOnEscape===!0&&(e.closeOnEscape=!1,G=!0);var W;if(P?($(O).find("#pData").replaceWith(B),$(O).find("#nData").replaceWith(R),$(O).find("#sData").replaceWith(F),$(O).find("#cData").replaceWith(N),W=$("<div id="+x+"></div>").append(O)):W=$("<div></div>").append(O).append(H),$(O).append("<div class='binfo topinfo bottominfo'>"+rp_ge[m.p.id].bottominfo+"</div>"),$.jgrid.createModal(L,W,rp_ge[$(this)[0].p.id],"#gview_"+$.jgrid.jqID(m.p.id),$("#gbox_"+$.jgrid.jqID(m.p.id))[0]),j&&($("#pData, #nData",k+"_2").css("float","right"),$(".EditButton",k+"_2").css("text-align","left")),rp_ge[m.p.id].topinfo&&$(".tinfo",w).show(),rp_ge[m.p.id].bottominfo&&$(".binfo",w).show(),W=null,H=null,$("#"+$.jgrid.jqID(L.themodal)).keydown(function(t){var i=t.target;if($(w).data("disabled")===!0)return!1;if(rp_ge[m.p.id].savekey[0]===!0&&t.which===rp_ge[m.p.id].savekey[1]&&"TEXTAREA"!==i.tagName)return $("#sData",k+"_2").trigger("click"),!1;if(27===t.which)return!!h()&&(G&&$.jgrid.hideModal("#"+$.jgrid.jqID(L.themodal),{gb:e.gbox,jqm:e.jqModal,onClose:rp_ge[m.p.id].onClose,removemodal:rp_ge[m.p.id].removemodal,formprop:!rp_ge[m.p.id].recreateForm,form:rp_ge[m.p.id].form}),!1);if(rp_ge[m.p.id].navkeys[0]===!0){if("_empty"===$("#id_g",k).val())return!0;if(t.which===rp_ge[m.p.id].navkeys[1])return $("#pData",g).trigger("click"),!1;if(t.which===rp_ge[m.p.id].navkeys[2])return $("#nData",g).trigger("click"),!1}}),e.checkOnUpdate&&($("a.ui-jqdialog-titlebar-close span","#"+$.jgrid.jqID(L.themodal)).removeClass("jqmClose"),$("a.ui-jqdialog-titlebar-close","#"+$.jgrid.jqID(L.themodal)).unbind("click").click(function(){return!!h()&&($.jgrid.hideModal("#"+$.jgrid.jqID(L.themodal),{gb:"#gbox_"+$.jgrid.jqID(b),jqm:e.jqModal,onClose:rp_ge[m.p.id].onClose,removemodal:rp_ge[m.p.id].removemodal,formprop:!rp_ge[m.p.id].recreateForm,form:rp_ge[m.p.id].form}),!1)})),e.saveicon=$.extend([!0,"left",r.icon_save],e.saveicon),e.closeicon=$.extend([!0,"left",r.icon_close],e.closeicon),e.saveicon[0]===!0&&$("#sData",g).addClass("right"===e.saveicon[1]?"fm-button-icon-right":"fm-button-icon-left").append("<span class='"+a.icon_base+" "+e.saveicon[2]+"'></span>"),e.closeicon[0]===!0&&$("#cData",g).addClass("right"===e.closeicon[1]?"fm-button-icon-right":"fm-button-icon-left").append("<span class='"+a.icon_base+" "+e.closeicon[2]+"'></span>"),rp_ge[m.p.id].checkOnSubmit||rp_ge[m.p.id].checkOnUpdate){F="<a id='sNew' class='fm-button "+a.button+"' style='z-index:1002'>"+e.bYes+"</a>",R="<a id='nNew' class='fm-button "+a.button+"' style='z-index:1002;margin-left:5px'>"+e.bNo+"</a>",N="<a id='cNew' class='fm-button "+a.button+"' style='z-index:1002;margin-left:5px;'>"+e.bExit+"</a>";var Z=e.zIndex||999;Z++,$("<div class='"+e.overlayClass+" jqgrid-overlay confirm' style='z-index:"+Z+";display:none;'>&#160;</div><div class='confirm ui-jqconfirm "+a.content+"' style='z-index:"+(Z+1)+"'>"+e.saveData+"<br/><br/>"+F+R+N+"</div>").insertAfter(w),$("#sNew","#"+$.jgrid.jqID(L.themodal)).click(function(){return l(),$(w).data("disabled",!1),$(".confirm","#"+$.jgrid.jqID(L.themodal)).hide(),!1}),$("#nNew","#"+$.jgrid.jqID(L.themodal)).click(function(){return $(".confirm","#"+$.jgrid.jqID(L.themodal)).hide(),$(w).data("disabled",!1),setTimeout(function(){$(":input:visible",w)[0].focus()},0),!1}),$("#cNew","#"+$.jgrid.jqID(L.themodal)).click(function(){return $(".confirm","#"+$.jgrid.jqID(L.themodal)).hide(),$(w).data("disabled",!1),$.jgrid.hideModal("#"+$.jgrid.jqID(L.themodal),{gb:"#gbox_"+$.jgrid.jqID(b),jqm:e.jqModal,onClose:rp_ge[m.p.id].onClose,removemodal:rp_ge[m.p.id].removemodal,formprop:!rp_ge[m.p.id].recreateForm,form:rp_ge[m.p.id].form}),!1})}$(m).triggerHandler("jqGridAddEditInitializeForm",[$(w),v]),$.isFunction(rp_ge[m.p.id].onInitializeForm)&&rp_ge[m.p.id].onInitializeForm.call(m,$(w),v),"_empty"!==t&&rp_ge[m.p.id].viewPagerButtons?$("#pData,#nData",g).show():$("#pData,#nData",g).hide(),$(m).triggerHandler("jqGridAddEditBeforeShowForm",[$(w),v]),$.isFunction(rp_ge[m.p.id].beforeShowForm)&&rp_ge[m.p.id].beforeShowForm.call(m,$(w),v),$("#"+$.jgrid.jqID(L.themodal)).data("onClose",rp_ge[m.p.id].onClose),$.jgrid.viewModal("#"+$.jgrid.jqID(L.themodal),{gbox:"#gbox_"+$.jgrid.jqID(b),jqm:e.jqModal,overlay:e.overlay,modal:e.modal,overlayClass:e.overlayClass,focusField:e.focusField,onHide:function(t){var e=$("#editmod"+b)[0].style.height,i=$("#editmod"+b)[0].style.width;e.indexOf("px")>-1&&(e=parseFloat(e)),i.indexOf("px")>-1&&(i=parseFloat(i)),$(m).data("formProp",{top:parseFloat($(t.w).css("top")),left:parseFloat($(t.w).css("left")),width:i,height:e,dataheight:$(w).height(),datawidth:$(w).width()}),t.w.remove(),t.o&&t.o.remove()}}),S||$("."+$.jgrid.jqID(e.overlayClass)).click(function(){return!!h()&&($.jgrid.hideModal("#"+$.jgrid.jqID(L.themodal),{gb:"#gbox_"+$.jgrid.jqID(b),jqm:e.jqModal,onClose:rp_ge[m.p.id].onClose,removemodal:rp_ge[m.p.id].removemodal,formprop:!rp_ge[m.p.id].recreateForm,form:rp_ge[m.p.id].form}),!1)}),$(".fm-button","#"+$.jgrid.jqID(L.themodal)).hover(function(){$(this).addClass(a.hover)},function(){$(this).removeClass(a.hover)}),$("#sData",g).click(function(){return _={},$(".FormError",w).hide(),i(),"_empty"===_[m.p.id+"_id"]?l():e.checkOnSubmit===!0?(y=d(_,rp_ge[m.p.id]._savedData),y?($(w).data("disabled",!0),$(".confirm","#"+$.jgrid.jqID(L.themodal)).show()):l()):l(),!1}),$("#cData",g).click(function(){return!!h()&&($.jgrid.hideModal("#"+$.jgrid.jqID(L.themodal),{gb:"#gbox_"+$.jgrid.jqID(b),jqm:e.jqModal,onClose:rp_ge[m.p.id].onClose,removemodal:rp_ge[m.p.id].removemodal,formprop:!rp_ge[m.p.id].recreateForm,form:rp_ge[m.p.id].form}),!1)}),$("#nData",g).click(function(){if(!h())return!1;$(".FormError",w).hide();var t=p();if(t[0]=parseInt(t[0],10),t[0]!==-1&&t[1][t[0]+1]){$(m).triggerHandler("jqGridAddEditClickPgButtons",["next",$(w),t[1][t[0]]]);var i;if($.isFunction(e.onclickPgButtons)&&(i=e.onclickPgButtons.call(m,"next",$(w),t[1][t[0]]),void 0!==i&&i===!1))return!1;if($("#"+$.jgrid.jqID(t[1][t[0]+1])).hasClass(a.disabled))return!1;o(t[1][t[0]+1],m,w),$(m).jqGrid("setSelection",t[1][t[0]+1]),$(m).triggerHandler("jqGridAddEditAfterClickPgButtons",["next",$(w),t[1][t[0]]]),$.isFunction(e.afterclickPgButtons)&&e.afterclickPgButtons.call(m,"next",$(w),t[1][t[0]+1]),u(t[0]+1,t)}return!1}),$("#pData",g).click(function(){if(!h())return!1;$(".FormError",w).hide();var t=p();if(t[0]!==-1&&t[1][t[0]-1]){$(m).triggerHandler("jqGridAddEditClickPgButtons",["prev",$(w),t[1][t[0]]]);var i;if($.isFunction(e.onclickPgButtons)&&(i=e.onclickPgButtons.call(m,"prev",$(w),t[1][t[0]]),void 0!==i&&i===!1))return!1;if($("#"+$.jgrid.jqID(t[1][t[0]-1])).hasClass(a.disabled))return!1;o(t[1][t[0]-1],m,w),$(m).jqGrid("setSelection",t[1][t[0]-1]),$(m).triggerHandler("jqGridAddEditAfterClickPgButtons",["prev",$(w),t[1][t[0]]]),$.isFunction(e.afterclickPgButtons)&&e.afterclickPgButtons.call(m,"prev",$(w),t[1][t[0]-1]),u(t[0]-1,t)}return!1}),$(m).triggerHandler("jqGridAddEditAfterShowForm",[$(w),v]),$.isFunction(rp_ge[m.p.id].afterShowForm)&&rp_ge[m.p.id].afterShowForm.call(m,$(w),v);var V=p();u(V[0],V)}}})},viewGridRow:function(t,e){var i=$.jgrid.getRegional(this[0],"view"),n=this[0].p.styleUI,r=$.jgrid.styleUI[n].formedit,a=$.jgrid.styleUI[n].common;return e=$.extend(!0,{top:0,left:0,width:500,datawidth:"auto",height:"auto",dataheight:"auto",modal:!1,overlay:30,drag:!0,resize:!0,jqModal:!0,closeOnEscape:!1,labelswidth:"30%",closeicon:[],navkeys:[!1,38,40],onClose:null,beforeShowForm:null,beforeInitData:null,viewPagerButtons:!0,recreateForm:!1,removemodal:!0,form:"view"},i,e||{}),rp_ge[$(this)[0].p.id]=e,this.each(function(){function i(){rp_ge[d.p.id].closeOnEscape!==!0&&rp_ge[d.p.id].navkeys[0]!==!0||setTimeout(function(){$(".ui-jqdialog-titlebar-close","#"+$.jgrid.jqID(m.modalhead)).attr("tabindex","-1").focus()},0)}function n(t,i,n,r){var o,s,l,d,h,c,u,p,f,m=0,g=[],_=!1,y="<td class='CaptionTD form-view-label "+a.content+"' width='"+e.labelswidth+"'>&#160;</td><td class='DataTD form-view-data ui-helper-reset "+a.content+"'>&#160;</td>",v="",b="<td class='CaptionTD form-view-label "+a.content+"'>&#160;</td><td class='DataTD form-view-data "+a.content+"'>&#160;</td>",w=["integer","number","currency"],x=0,k=0;for(c=1;c<=r;c++)v+=1===c?y:b;if($(i.p.colModel).each(function(){s=(!this.editrules||this.editrules.edithidden!==!0)&&this.hidden===!0,s||"right"!==this.align||(this.formatter&&$.inArray(this.formatter,w)!==-1?x=Math.max(x,parseInt(this.width,10)):k=Math.max(k,parseInt(this.width,10)))}),u=0!==x?x:0!==k?k:0,_=$(i).jqGrid("getInd",t),$(i.p.colModel).each(function(t){if(o=this.name,p=!1,s=(!this.editrules||this.editrules.edithidden!==!0)&&this.hidden===!0,h=s?"style='display:none'":"",f="boolean"!=typeof this.viewable||this.viewable,"cb"!==o&&"subgrid"!==o&&"rn"!==o&&f){d=_===!1?"":o===i.p.ExpandColumn&&i.p.treeGrid===!0?$("td:eq("+t+")",i.rows[_]).text():$("td:eq("+t+")",i.rows[_]).html(),p="right"===this.align&&0!==u;var e=$.extend({},{rowabove:!1,rowcontent:""},this.formoptions||{}),a=parseInt(e.rowpos,10)||m+1,c=parseInt(2*(parseInt(e.colpos,10)||1),10);if(e.rowabove){var y=$("<tr><td class='contentinfo' colspan='"+2*r+"'>"+e.rowcontent+"</td></tr>");$(n).append(y),y[0].rp=a}l=$(n).find("tr[rowpos="+a+"]"),0===l.length&&(l=$("<tr "+h+" rowpos='"+a+"'></tr>").addClass("FormData").attr("id","trv_"+o),$(l).append(v),$(n).append(l),l[0].rp=a),$("td:eq("+(c-2)+")",l[0]).html("<b>"+(void 0===e.label?i.p.colNames[t]:e.label)+"</b>"),$("td:eq("+(c-1)+")",l[0]).append("<span>"+d+"</span>").attr("id","v_"+o),p&&$("td:eq("+(c-1)+") span",l[0]).css({"text-align":"right",width:u+"px"}),g[m]=t,m++}}),m>0){var L=$("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(2*r-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='id' value='"+t+"'/></td></tr>");L[0].rp=m+99,$(n).append(L)}return g}function o(t,e){var i,n,r,a,o=0;a=$(e).jqGrid("getInd",t,!0),a&&($("td",a).each(function(t){i=e.p.colModel[t].name,n=(!e.p.colModel[t].editrules||e.p.colModel[t].editrules.edithidden!==!0)&&e.p.colModel[t].hidden===!0,"cb"!==i&&"subgrid"!==i&&"rn"!==i&&(r=i===e.p.ExpandColumn&&e.p.treeGrid===!0?$(this).text():$(this).html(),i=$.jgrid.jqID("v_"+i),$("#"+i+" span","#"+u).html(r),n&&$("#"+i,"#"+u).parents("tr:first").hide(),o++)}),o>0&&$("#id_g","#"+u).val(t))}function s(t,e){var i=e[1].length-1;0===t?$("#pData","#"+u+"_2").addClass(a.disabled):void 0!==e[1][t-1]&&$("#"+$.jgrid.jqID(e[1][t-1])).hasClass(a.disabled)?$("#pData",u+"_2").addClass(a.disabled):$("#pData","#"+u+"_2").removeClass(a.disabled),t===i?$("#nData","#"+u+"_2").addClass(a.disabled):void 0!==e[1][t+1]&&$("#"+$.jgrid.jqID(e[1][t+1])).hasClass(a.disabled)?$("#nData",u+"_2").addClass(a.disabled):$("#nData","#"+u+"_2").removeClass(a.disabled)}function l(){var t=$(d).jqGrid("getDataIDs"),e=$("#id_g","#"+u).val(),i=$.inArray(e,t);return[i,t]}var d=this;if(d.grid&&t){var h=d.p.id,c="ViewGrid_"+$.jgrid.jqID(h),u="ViewTbl_"+$.jgrid.jqID(h),p="ViewGrid_"+h,f="ViewTbl_"+h,m={themodal:"viewmod"+h,modalhead:"viewhd"+h,modalcontent:"viewcnt"+h,scrollelm:c},g=!!$.isFunction(rp_ge[d.p.id].beforeInitData)&&rp_ge[d.p.id].beforeInitData,_=!0,y=1,v=0;rp_ge[d.p.id].styleUI=d.p.styleUI||"jQueryUI",e.recreateForm||$(d).data("viewProp")&&$.extend(rp_ge[$(this)[0].p.id],$(d).data("viewProp"));var b=isNaN(rp_ge[$(this)[0].p.id].dataheight)?rp_ge[$(this)[0].p.id].dataheight:rp_ge[$(this)[0].p.id].dataheight+"px",w=isNaN(rp_ge[$(this)[0].p.id].datawidth)?rp_ge[$(this)[0].p.id].datawidth:rp_ge[$(this)[0].p.id].datawidth+"px",x=$("<form name='FormPost' id='"+p+"' class='FormGrid' style='width:"+w+";height:"+b+";'></form>"),k=$("<table id='"+f+"' class='EditTable ViewTable'><tbody></tbody></table>");if($(d.p.colModel).each(function(){var t=this.formoptions;y=Math.max(y,t?t.colpos||0:0),v=Math.max(v,t?t.rowpos||0:0)}),$(x).append(k),g&&(_=g.call(d,x),void 0===_&&(_=!0)),_!==!1){n(t,d,k,y);var L="rtl"===d.p.direction,C=L?"nData":"pData",T=L?"pData":"nData",M="<a id='"+C+"' class='fm-button "+a.button+"'><span class='"+a.icon_base+" "+r.icon_prev+"'></span></a>",P="<a id='"+T+"' class='fm-button "+a.button+"'><span class='"+a.icon_base+" "+r.icon_next+"'></span></a>",D="<a id='cData' class='fm-button "+a.button+"'>"+e.bClose+"</a>";if(v>0){var S=[];$.each($(k)[0].rows,function(t,e){S[t]=e}),S.sort(function(t,e){return t.rp>e.rp?1:t.rp<e.rp?-1:0}),$.each(S,function(t,e){$("tbody",k).append(e)})}e.gbox="#gbox_"+$.jgrid.jqID(h);var I=$("<div></div>").append(x).append("<table border='0' class='EditTable' id='"+u+"_2'><tbody><tr id='Act_Buttons'><td class='navButton' width='"+e.labelswidth+"'>"+(L?P+M:M+P)+"</td><td class='EditButton'>"+D+"</td></tr></tbody></table>");$.jgrid.createModal(m,I,rp_ge[$(this)[0].p.id],"#gview_"+$.jgrid.jqID(d.p.id),$("#gview_"+$.jgrid.jqID(d.p.id))[0]),L&&($("#pData, #nData","#"+u+"_2").css("float","right"),$(".EditButton","#"+u+"_2").css("text-align","left")),e.viewPagerButtons||$("#pData, #nData","#"+u+"_2").hide(),I=null,$("#"+m.themodal).keydown(function(t){if(27===t.which)return rp_ge[d.p.id].closeOnEscape&&$.jgrid.hideModal("#"+$.jgrid.jqID(m.themodal),{gb:e.gbox,jqm:e.jqModal,onClose:e.onClose,removemodal:rp_ge[d.p.id].removemodal,formprop:!rp_ge[d.p.id].recreateForm,form:rp_ge[d.p.id].form}),!1;if(e.navkeys[0]===!0){if(t.which===e.navkeys[1])return $("#pData","#"+u+"_2").trigger("click"),!1;if(t.which===e.navkeys[2])return $("#nData","#"+u+"_2").trigger("click"),!1}}),e.closeicon=$.extend([!0,"left",r.icon_close],e.closeicon),e.closeicon[0]===!0&&$("#cData","#"+u+"_2").addClass("right"===e.closeicon[1]?"fm-button-icon-right":"fm-button-icon-left").append("<span class='"+a.icon_base+" "+e.closeicon[2]+"'></span>"),$.isFunction(e.beforeShowForm)&&e.beforeShowForm.call(d,$("#"+c)),$.jgrid.viewModal("#"+$.jgrid.jqID(m.themodal),{gbox:"#gbox_"+$.jgrid.jqID(h),jqm:e.jqModal,overlay:e.overlay,modal:e.modal,onHide:function(t){$(d).data("viewProp",{top:parseFloat($(t.w).css("top")),left:parseFloat($(t.w).css("left")),width:$(t.w).width(),height:$(t.w).height(),dataheight:$("#"+c).height(),datawidth:$("#"+c).width()}),t.w.remove(),t.o&&t.o.remove()}}),$(".fm-button:not(."+a.disabled+")","#"+u+"_2").hover(function(){$(this).addClass(a.hover)},function(){$(this).removeClass(a.hover)}),i(),$("#cData","#"+u+"_2").click(function(){return $.jgrid.hideModal("#"+$.jgrid.jqID(m.themodal),{gb:"#gbox_"+$.jgrid.jqID(h),jqm:e.jqModal,onClose:e.onClose,removemodal:rp_ge[d.p.id].removemodal,formprop:!rp_ge[d.p.id].recreateForm,form:rp_ge[d.p.id].form}),!1}),$("#nData","#"+u+"_2").click(function(){$("#FormError","#"+u).hide();var t=l();return t[0]=parseInt(t[0],10),t[0]!==-1&&t[1][t[0]+1]&&($.isFunction(e.onclickPgButtons)&&e.onclickPgButtons.call(d,"next",$("#"+c),t[1][t[0]]),o(t[1][t[0]+1],d),$(d).jqGrid("setSelection",t[1][t[0]+1]),$.isFunction(e.afterclickPgButtons)&&e.afterclickPgButtons.call(d,"next",$("#"+c),t[1][t[0]+1]),s(t[0]+1,t)),i(),!1}),$("#pData","#"+u+"_2").click(function(){$("#FormError","#"+u).hide();var t=l();return t[0]!==-1&&t[1][t[0]-1]&&($.isFunction(e.onclickPgButtons)&&e.onclickPgButtons.call(d,"prev",$("#"+c),t[1][t[0]]),o(t[1][t[0]-1],d),$(d).jqGrid("setSelection",t[1][t[0]-1]),$.isFunction(e.afterclickPgButtons)&&e.afterclickPgButtons.call(d,"prev",$("#"+c),t[1][t[0]-1]),s(t[0]-1,t)),i(),!1});var E=l();s(E[0],E)}}})},delGridRow:function(t,e){var i=$.jgrid.getRegional(this[0],"del"),n=this[0].p.styleUI,r=$.jgrid.styleUI[n].formedit,a=$.jgrid.styleUI[n].common;return e=$.extend(!0,{top:0,left:0,width:240,height:"auto",dataheight:"auto",modal:!1,overlay:30,drag:!0,resize:!0,url:"",mtype:"POST",reloadAfterSubmit:!0,beforeShowForm:null,beforeInitData:null,afterShowForm:null,beforeSubmit:null,onclickSubmit:null,afterSubmit:null,jqModal:!0,closeOnEscape:!1,delData:{},delicon:[],cancelicon:[],onClose:null,ajaxDelOptions:{},processing:!1,serializeDelData:null,useDataProxy:!1},i,e||{}),rp_ge[$(this)[0].p.id]=e,this.each(function(){var i=this;if(i.grid&&t){var n,o,s,l,d=$.isFunction(rp_ge[i.p.id].beforeShowForm),h=$.isFunction(rp_ge[i.p.id].afterShowForm),c=!!$.isFunction(rp_ge[i.p.id].beforeInitData)&&rp_ge[i.p.id].beforeInitData,u=i.p.id,p={},f=!0,m="DelTbl_"+$.jgrid.jqID(u),g="DelTbl_"+u,_={themodal:"delmod"+u,modalhead:"delhd"+u,modalcontent:"delcnt"+u,scrollelm:m};if(rp_ge[i.p.id].styleUI=i.p.styleUI||"jQueryUI",$.isArray(t)&&(t=t.join()),void 0!==$("#"+$.jgrid.jqID(_.themodal))[0]){if(c&&(f=c.call(i,$("#"+m)),void 0===f&&(f=!0)),f===!1)return;$("#DelData>td","#"+m).text(t),$("#DelError","#"+m).hide(),rp_ge[i.p.id].processing===!0&&(rp_ge[i.p.id].processing=!1,$("#dData","#"+m).removeClass(a.active)),d&&rp_ge[i.p.id].beforeShowForm.call(i,$("#"+m)),$.jgrid.viewModal("#"+$.jgrid.jqID(_.themodal),{gbox:"#gbox_"+$.jgrid.jqID(u),jqm:rp_ge[i.p.id].jqModal,jqM:!1,overlay:rp_ge[i.p.id].overlay,modal:rp_ge[i.p.id].modal}),h&&rp_ge[i.p.id].afterShowForm.call(i,$("#"+m))}else{var y=isNaN(rp_ge[i.p.id].dataheight)?rp_ge[i.p.id].dataheight:rp_ge[i.p.id].dataheight+"px",v=isNaN(e.datawidth)?e.datawidth:e.datawidth+"px",b="<div id='"+g+"' class='formdata' style='width:"+v+";overflow:auto;position:relative;height:"+y+";'>";b+="<table class='DelTable'><tbody>",b+="<tr id='DelError' style='display:none'><td class='"+a.error+"'></td></tr>",b+="<tr id='DelData' style='display:none'><td >"+t+"</td></tr>",b+='<tr><td class="delmsg" style="white-space:pre;">'+rp_ge[i.p.id].msg+"</td></tr><tr><td >&#160;</td></tr>",b+="</tbody></table></div>";var w="<a id='dData' class='fm-button "+a.button+"'>"+e.bSubmit+"</a>",x="<a id='eData' class='fm-button "+a.button+"'>"+e.bCancel+"</a>";if(b+="<table class='EditTable ui-common-table' id='"+m+"_2'><tbody><tr><td><hr class='"+a.content+"' style='margin:1px'/></td></tr><tr><td class='DelButton EditButton'>"+w+"&#160;"+x+"</td></tr></tbody></table>",e.gbox="#gbox_"+$.jgrid.jqID(u),$.jgrid.createModal(_,b,rp_ge[i.p.id],"#gview_"+$.jgrid.jqID(i.p.id),$("#gview_"+$.jgrid.jqID(i.p.id))[0]),c&&(f=c.call(i,$(b)),void 0===f&&(f=!0)),f===!1)return;$(".fm-button","#"+m+"_2").hover(function(){$(this).addClass(a.hover)},function(){$(this).removeClass(a.hover)}),e.delicon=$.extend([!0,"left",r.icon_del],rp_ge[i.p.id].delicon),e.cancelicon=$.extend([!0,"left",r.icon_cancel],rp_ge[i.p.id].cancelicon),e.delicon[0]===!0&&$("#dData","#"+m+"_2").addClass("right"===e.delicon[1]?"fm-button-icon-right":"fm-button-icon-left").append("<span class='"+a.icon_base+" "+e.delicon[2]+"'></span>"),e.cancelicon[0]===!0&&$("#eData","#"+m+"_2").addClass("right"===e.cancelicon[1]?"fm-button-icon-right":"fm-button-icon-left").append("<span class='"+a.icon_base+" "+e.cancelicon[2]+"'></span>"),$("#dData","#"+m+"_2").click(function(){var t,r=[!0,""],d=$("#DelData>td","#"+m).text();if(p={},$.isFunction(rp_ge[i.p.id].onclickSubmit)&&(p=rp_ge[i.p.id].onclickSubmit.call(i,rp_ge[i.p.id],d)||{}),$.isFunction(rp_ge[i.p.id].beforeSubmit)&&(r=rp_ge[i.p.id].beforeSubmit.call(i,d)),r[0]&&!rp_ge[i.p.id].processing){if(rp_ge[i.p.id].processing=!0,s=i.p.prmNames,n=$.extend({},rp_ge[i.p.id].delData,p),l=s.oper,n[l]=s.deloper,o=s.id,d=String(d).split(","),!d.length)return!1;for(t in d)d.hasOwnProperty(t)&&(d[t]=$.jgrid.stripPref(i.p.idPrefix,d[t]));n[o]=d.join(),$(this).addClass(a.active);var h=$.extend({url:rp_ge[i.p.id].url||$(i).jqGrid("getGridParam","editurl"),type:rp_ge[i.p.id].mtype,data:$.isFunction(rp_ge[i.p.id].serializeDelData)?rp_ge[i.p.id].serializeDelData.call(i,n):n,complete:function(t,o){var s;if($("#dData","#"+m+"_2").removeClass(a.active),t.status>=300&&304!==t.status?(r[0]=!1,$.isFunction(rp_ge[i.p.id].errorTextFormat)?r[1]=rp_ge[i.p.id].errorTextFormat.call(i,t):r[1]=o+" Status: '"+t.statusText+"'. Error code: "+t.status):$.isFunction(rp_ge[i.p.id].afterSubmit)&&(r=rp_ge[i.p.id].afterSubmit.call(i,t,n)),r[0]===!1)$("#DelError>td","#"+m).html(r[1]),$("#DelError","#"+m).show();else{if(rp_ge[i.p.id].reloadAfterSubmit&&"local"!==i.p.datatype)$(i).trigger("reloadGrid");else{if(i.p.treeGrid===!0)try{$(i).jqGrid("delTreeNode",i.p.idPrefix+d[0])}catch(t){}else for(s=0;s<d.length;s++)$(i).jqGrid("delRowData",i.p.idPrefix+d[s]);i.p.selrow=null,i.p.selarrrow=[]}$.isFunction(rp_ge[i.p.id].afterComplete)&&setTimeout(function(){rp_ge[i.p.id].afterComplete.call(i,t,d)},500)}rp_ge[i.p.id].processing=!1,r[0]&&$.jgrid.hideModal("#"+$.jgrid.jqID(_.themodal),{gb:"#gbox_"+$.jgrid.jqID(u),jqm:e.jqModal,onClose:rp_ge[i.p.id].onClose})}},$.jgrid.ajaxOptions,rp_ge[i.p.id].ajaxDelOptions);if(h.url||rp_ge[i.p.id].useDataProxy||($.isFunction(i.p.dataProxy)?rp_ge[i.p.id].useDataProxy=!0:(r[0]=!1,r[1]+=" "+$.jgrid.getRegional(i,"errors.nourl"))),r[0])if(rp_ge[i.p.id].useDataProxy){var c=i.p.dataProxy.call(i,h,"del_"+i.p.id);void 0===c&&(c=[!0,""]),c[0]===!1?(r[0]=!1,r[1]=c[1]||"Error deleting the selected row!"):$.jgrid.hideModal("#"+$.jgrid.jqID(_.themodal),{gb:"#gbox_"+$.jgrid.jqID(u),jqm:e.jqModal,onClose:rp_ge[i.p.id].onClose})}else"clientArray"===h.url?(n=h.data,h.complete({status:200,statusText:""},"")):$.ajax(h)}return r[0]===!1&&($("#DelError>td","#"+m).html(r[1]),$("#DelError","#"+m).show()),!1}),$("#eData","#"+m+"_2").click(function(){return $.jgrid.hideModal("#"+$.jgrid.jqID(_.themodal),{gb:"#gbox_"+$.jgrid.jqID(u),jqm:rp_ge[i.p.id].jqModal,onClose:rp_ge[i.p.id].onClose}),!1}),d&&rp_ge[i.p.id].beforeShowForm.call(i,$("#"+m)),$.jgrid.viewModal("#"+$.jgrid.jqID(_.themodal),{gbox:"#gbox_"+$.jgrid.jqID(u),jqm:rp_ge[i.p.id].jqModal,overlay:rp_ge[i.p.id].overlay,modal:rp_ge[i.p.id].modal}),h&&rp_ge[i.p.id].afterShowForm.call(i,$("#"+m))}rp_ge[i.p.id].closeOnEscape===!0&&setTimeout(function(){$(".ui-jqdialog-titlebar-close","#"+$.jgrid.jqID(_.modalhead)).attr("tabindex","-1").focus()},0)}})},navGrid:function(t,e,i,n,r,a,o){var s=$.jgrid.getRegional(this[0],"nav"),l=this[0].p.styleUI,d=$.jgrid.styleUI[l].navigator,h=$.jgrid.styleUI[l].common;return e=$.extend({edit:!0,editicon:d.icon_edit_nav,add:!0,addicon:d.icon_add_nav,
del:!0,delicon:d.icon_del_nav,search:!0,searchicon:d.icon_search_nav,refresh:!0,refreshicon:d.icon_refresh_nav,refreshstate:"firstpage",view:!1,viewicon:d.icon_view_nav,position:"left",closeOnEscape:!0,beforeRefresh:null,afterRefresh:null,cloneToTop:!1,alertwidth:200,alertheight:"auto",alerttop:null,alertleft:null,alertzIndex:null,dropmenu:!1},s,e||{}),this.each(function(){if(!this.p.navGrid){var d,c,u,p={themodal:"alertmod_"+this.p.id,modalhead:"alerthd_"+this.p.id,modalcontent:"alertcnt_"+this.p.id},f=this;if(f.grid&&"string"==typeof t){$(f).data("navGrid")||$(f).data("navGrid",e),u=$(f).data("navGrid"),f.p.force_regional&&(u=$.extend(u,s)),void 0===$("#"+p.themodal)[0]&&(u.alerttop||u.alertleft||(void 0!==window.innerWidth?(u.alertleft=window.innerWidth,u.alerttop=window.innerHeight):void 0!==document.documentElement&&void 0!==document.documentElement.clientWidth&&0!==document.documentElement.clientWidth?(u.alertleft=document.documentElement.clientWidth,u.alerttop=document.documentElement.clientHeight):(u.alertleft=1024,u.alerttop=768),u.alertleft=u.alertleft/2-parseInt(u.alertwidth,10)/2,u.alerttop=u.alerttop/2-25),$.jgrid.createModal(p,"<div>"+u.alerttext+"</div><span tabindex='0'><span tabindex='-1' id='jqg_alrt'></span></span>",{gbox:"#gbox_"+$.jgrid.jqID(f.p.id),jqModal:!0,drag:!0,resize:!0,caption:u.alertcap,top:u.alerttop,left:u.alertleft,width:u.alertwidth,height:u.alertheight,closeOnEscape:u.closeOnEscape,zIndex:u.alertzIndex,styleUI:f.p.styleUI},"#gview_"+$.jgrid.jqID(f.p.id),$("#gbox_"+$.jgrid.jqID(f.p.id))[0],!0));var m,g=1,_=function(){$(this).hasClass(h.disabled)||$(this).addClass(h.hover)},y=function(){$(this).removeClass(h.hover)};for(u.cloneToTop&&f.p.toppager&&(g=2),m=0;m<g;m++){var v,b,w,x=$("<table class='ui-pg-table navtable ui-common-table'><tbody><tr></tr></tbody></table>"),k="<td class='ui-pg-button "+h.disabled+"' style='width:4px;'><span class='ui-separator'></span></td>";0===m?(b=t,w=f.p.id,b===f.p.toppager&&(w+="_top",g=1)):(b=f.p.toppager,w=f.p.id+"_top"),"rtl"===f.p.direction&&$(x).attr("dir","rtl").css("float","right"),n=n||{},u.add&&(v=$("<td class='ui-pg-button "+h.cornerall+"'></td>"),$(v).append("<div class='ui-pg-div'><span class='"+h.icon_base+" "+u.addicon+"'></span>"+u.addtext+"</div>"),$("tr",x).append(v),$(v,x).attr({title:u.addtitle||"",id:n.id||"add_"+w}).click(function(){return $(this).hasClass(h.disabled)||($.isFunction(u.addfunc)?u.addfunc.call(f):$(f).jqGrid("editGridRow","new",n)),!1}).hover(_,y),v=null),i=i||{},u.edit&&(v=$("<td class='ui-pg-button "+h.cornerall+"'></td>"),$(v).append("<div class='ui-pg-div'><span class='"+h.icon_base+" "+u.editicon+"'></span>"+u.edittext+"</div>"),$("tr",x).append(v),$(v,x).attr({title:u.edittitle||"",id:i.id||"edit_"+w}).click(function(){if(!$(this).hasClass(h.disabled)){var t=f.p.selrow;t?$.isFunction(u.editfunc)?u.editfunc.call(f,t):$(f).jqGrid("editGridRow",t,i):($.jgrid.viewModal("#"+p.themodal,{gbox:"#gbox_"+$.jgrid.jqID(f.p.id),jqm:!0}),$("#jqg_alrt").focus())}return!1}).hover(_,y),v=null),o=o||{},u.view&&(v=$("<td class='ui-pg-button "+h.cornerall+"'></td>"),$(v).append("<div class='ui-pg-div'><span class='"+h.icon_base+" "+u.viewicon+"'></span>"+u.viewtext+"</div>"),$("tr",x).append(v),$(v,x).attr({title:u.viewtitle||"",id:o.id||"view_"+w}).click(function(){if(!$(this).hasClass(h.disabled)){var t=f.p.selrow;t?$.isFunction(u.viewfunc)?u.viewfunc.call(f,t):$(f).jqGrid("viewGridRow",t,o):($.jgrid.viewModal("#"+p.themodal,{gbox:"#gbox_"+$.jgrid.jqID(f.p.id),jqm:!0}),$("#jqg_alrt").focus())}return!1}).hover(_,y),v=null),r=r||{},u.del&&(v=$("<td class='ui-pg-button "+h.cornerall+"'></td>"),$(v).append("<div class='ui-pg-div'><span class='"+h.icon_base+" "+u.delicon+"'></span>"+u.deltext+"</div>"),$("tr",x).append(v),$(v,x).attr({title:u.deltitle||"",id:r.id||"del_"+w}).click(function(){if(!$(this).hasClass(h.disabled)){var t;f.p.multiselect?(t=f.p.selarrrow,0===t.length&&(t=null)):t=f.p.selrow,t?$.isFunction(u.delfunc)?u.delfunc.call(f,t):$(f).jqGrid("delGridRow",t,r):($.jgrid.viewModal("#"+p.themodal,{gbox:"#gbox_"+$.jgrid.jqID(f.p.id),jqm:!0}),$("#jqg_alrt").focus())}return!1}).hover(_,y),v=null),(u.add||u.edit||u.del||u.view)&&$("tr",x).append(k),a=a||{},u.search&&(v=$("<td class='ui-pg-button "+h.cornerall+"'></td>"),$(v).append("<div class='ui-pg-div'><span class='"+h.icon_base+" "+u.searchicon+"'></span>"+u.searchtext+"</div>"),$("tr",x).append(v),$(v,x).attr({title:u.searchtitle||"",id:a.id||"search_"+w}).click(function(){return $(this).hasClass(h.disabled)||($.isFunction(u.searchfunc)?u.searchfunc.call(f,a):$(f).jqGrid("searchGrid",a)),!1}).hover(_,y),a.showOnLoad&&a.showOnLoad===!0&&$(v,x).click(),v=null),u.refresh&&(v=$("<td class='ui-pg-button "+h.cornerall+"'></td>"),$(v).append("<div class='ui-pg-div'><span class='"+h.icon_base+" "+u.refreshicon+"'></span>"+u.refreshtext+"</div>"),$("tr",x).append(v),$(v,x).attr({title:u.refreshtitle||"",id:"refresh_"+w}).click(function(){if($(".glyphicon-save").closest(".ui-pg-button").hide(),!$(this).hasClass(h.disabled)){$.isFunction(u.beforeRefresh)&&u.beforeRefresh.call(f),f.p.search=!1,f.p.resetsearch=!0;try{if("currentfilter"!==u.refreshstate){var t=f.p.id;f.p.postData.filters="";try{$("#fbox_"+$.jgrid.jqID(t)).jqFilter("resetFilter")}catch(t){}$.isFunction(f.clearToolbar)&&f.clearToolbar.call(f,!1)}}catch(t){}switch(u.refreshstate){case"firstpage":$(f).trigger("reloadGrid",[{page:1}]);break;case"current":case"currentfilter":$(f).trigger("reloadGrid",[{current:!0}])}$(".glyphicon-save").closest(".ui-pg-button").hide(),$.isFunction(u.afterRefresh)&&u.afterRefresh.call(f)}return!1}).hover(_,y),v=null),c=$(".ui-jqgrid").css("font-size")||"11px",$("body").append("<div id='testpg2' class='ui-jqgrid "+$.jgrid.styleUI[l].base.entrieBox+"' style='font-size:"+c+";visibility:hidden;' ></div>"),d=$(x).clone().appendTo("#testpg2").width(),$("#testpg2").remove(),f.p._nvtd&&(u.dropmenu?(x=null,$(f).jqGrid("_buildNavMenu",b,w,e,i,n,r,a,o)):d>f.p._nvtd[0]&&f.p._nvtd[0]<10?(f.p.responsive?(x=null,$(f).jqGrid("_buildNavMenu",b,w,e,i,n,r,a,o)):$(b+"_"+u.position,b).width(d),f.p._nvtd[0]=d):$(b+"_"+u.position,b).append(x),f.p._nvtd[1]=d),f.p.navGrid=!0}f.p.storeNavOptions&&(f.p.navOptions=u,f.p.editOptions=i,f.p.addOptions=n,f.p.delOptions=r,f.p.searchOptions=a,f.p.viewOptions=o)}}})},navButtonAdd:function(t,e){var i=this[0].p.styleUI,n=$.jgrid.styleUI[i].navigator;return e=$.extend({caption:"newButton",title:"",buttonicon:n.icon_newbutton_nav,onClickButton:null,position:"last",cursor:"pointer"},e||{}),this.each(function(){if(this.grid){"string"==typeof t&&0!==t.indexOf("#")&&(t="#"+$.jgrid.jqID(t));var n=$(".navtable",t)[0],r=this,a=$.jgrid.styleUI[i].common.disabled,o=$.jgrid.styleUI[i].common.hover,s=$.jgrid.styleUI[i].common.cornerall,l=$.jgrid.styleUI[i].common.icon_base;if(n){if(e.id&&void 0!==$("#"+$.jgrid.jqID(e.id),n)[0])return;var d=$("<td></td>");"NONE"===e.buttonicon.toString().toUpperCase()?$(d).addClass("ui-pg-button "+s).append("<div class='ui-pg-div'>"+e.caption+"</div>"):$(d).addClass("ui-pg-button "+s).append("<div class='ui-pg-div'><span class='"+l+" "+e.buttonicon+"'></span>"+e.caption+"</div>"),e.id&&$(d).attr("id",e.id),"first"===e.position?0===n.rows[0].cells.length?$("tr",n).append(d):$("tr td:eq(0)",n).before(d):$("tr",n).append(d),$(d,n).attr("title",e.title||"").click(function(t){return $(this).hasClass(a)||$.isFunction(e.onClickButton)&&e.onClickButton.call(r,t),!1}).hover(function(){$(this).hasClass(a)||$(this).addClass(o)},function(){$(this).removeClass(o)})}else if(n=$(".dropdownmenu",t)[0]){var h=$(n).val(),c=e.id||$.jgrid.randId(),u=$('<li class="ui-menu-item" role="presentation"><a class="'+s+' g-menu-item" tabindex="0" role="menuitem" id="'+c+'">'+(e.caption||e.title)+"</a></li>");h&&("first"===e.position?$("#"+h).prepend(u):$("#"+h).append(u),$(u).on("click",function(t){return $(this).hasClass(a)||($("#"+h).hide(),$.isFunction(e.onClickButton)&&e.onClickButton.call(r,t)),!1}).find("a").hover(function(){$(this).hasClass(a)||$(this).addClass(o)},function(){$(this).removeClass(o)}))}}})},navSeparatorAdd:function(t,e){var i=this[0].p.styleUI,n=$.jgrid.styleUI[i].common;return e=$.extend({sepclass:"ui-separator",sepcontent:"",position:"last"},e||{}),this.each(function(){if(this.grid){"string"==typeof t&&0!==t.indexOf("#")&&(t="#"+$.jgrid.jqID(t));var i,r,a=$(".navtable",t)[0];a?(i="<td class='ui-pg-button "+n.disabled+"' style='width:4px;'><span class='"+e.sepclass+"'></span>"+e.sepcontent+"</td>","first"===e.position?0===a.rows[0].cells.length?$("tr",a).append(i):$("tr td:eq(0)",a).before(i):$("tr",a).append(i)):(a=$(".dropdownmenu",t)[0],i="<li class='ui-menu-item "+n.disabled+"' style='width:100%' role='presentation'><hr class='ui-separator-li'></li>",a&&(r=$(a).val(),r&&("first"===e.position?$("#"+r).prepend(i):$("#"+r).append(i))))}})},_buildNavMenu:function(t,e,i,n,r,a,o,s){return this.each(function(){var l=this,d=l.p.styleUI,h=($.jgrid.styleUI[d].navigator,$.jgrid.styleUI[d].filter),c=$.jgrid.styleUI[d].common,u="form_menu_"+$.jgrid.randId(),p="<button class='dropdownmenu "+c.button+"' value='"+u+"'>Actions</button>";$(t+"_"+i.position,t).append(p);var f={themodal:"alertmod_"+this.p.id,modalhead:"alerthd_"+this.p.id,modalcontent:"alertcnt_"+this.p.id},m=function(){var t,d,p=$(".ui-jqgrid-view").css("font-size")||"11px",m=$('<ul id="'+u+'" class="ui-nav-menu modal-content" role="menu" tabindex="0" style="display:none;font-size:'+p+'"></ul>');i.add&&(r=r||{},t=r.id||"add_"+e,d=$('<li class="ui-menu-item" role="presentation"><a class="'+c.cornerall+' g-menu-item" tabindex="0" role="menuitem" id="'+t+'">'+(i.addtext||i.addtitle)+"</a></li>").click(function(){return $(this).hasClass(c.disabled)||($.isFunction(i.addfunc)?i.addfunc.call(l):$(l).jqGrid("editGridRow","new",r),$(m).hide()),!1}),$(m).append(d)),i.edit&&(n=n||{},t=n.id||"edit_"+e,d=$('<li class="ui-menu-item" role="presentation"><a class="'+c.cornerall+' g-menu-item" tabindex="0" role="menuitem" id="'+t+'">'+(i.edittext||i.edittitle)+"</a></li>").click(function(){if(!$(this).hasClass(c.disabled)){var t=l.p.selrow;t?$.isFunction(i.editfunc)?i.editfunc.call(l,t):$(l).jqGrid("editGridRow",t,n):($.jgrid.viewModal("#"+f.themodal,{gbox:"#gbox_"+$.jgrid.jqID(l.p.id),jqm:!0}),$("#jqg_alrt").focus()),$(m).hide()}return!1}),$(m).append(d)),i.view&&(s=s||{},t=s.id||"view_"+e,d=$('<li class="ui-menu-item" role="presentation"><a class="'+c.cornerall+' g-menu-item" tabindex="0" role="menuitem" id="'+t+'">'+(i.viewtext||i.viewtitle)+"</a></li>").click(function(){if(!$(this).hasClass(c.disabled)){var t=l.p.selrow;t?$.isFunction(i.editfunc)?i.viewfunc.call(l,t):$(l).jqGrid("viewGridRow",t,s):($.jgrid.viewModal("#"+f.themodal,{gbox:"#gbox_"+$.jgrid.jqID(l.p.id),jqm:!0}),$("#jqg_alrt").focus()),$(m).hide()}return!1}),$(m).append(d)),i.del&&(a=a||{},t=a.id||"del_"+e,d=$('<li class="ui-menu-item" role="presentation"><a class="'+c.cornerall+' g-menu-item" tabindex="0" role="menuitem" id="'+t+'">'+(i.deltext||i.deltitle)+"</a></li>").click(function(){if(!$(this).hasClass(c.disabled)){var t;l.p.multiselect?(t=l.p.selarrrow,0===t.length&&(t=null)):t=l.p.selrow,t?$.isFunction(i.delfunc)?i.delfunc.call(l,t):$(l).jqGrid("delGridRow",t,a):($.jgrid.viewModal("#"+f.themodal,{gbox:"#gbox_"+$.jgrid.jqID(l.p.id),jqm:!0}),$("#jqg_alrt").focus()),$(m).hide()}return!1}),$(m).append(d)),(i.add||i.edit||i.del||i.view)&&$(m).append("<li class='ui-menu-item "+c.disabled+"' style='width:100%' role='presentation'><hr class='ui-separator-li'></li>"),i.search&&(o=o||{},t=o.id||"search_"+e,d=$('<li class="ui-menu-item" role="presentation"><a class="'+c.cornerall+' g-menu-item" tabindex="0" role="menuitem" id="'+t+'">'+(i.searchtext||i.searchtitle)+"</a></li>").click(function(){return $(this).hasClass(c.disabled)||($.isFunction(i.searchfunc)?i.searchfunc.call(l,o):$(l).jqGrid("searchGrid",o),$(m).hide()),!1}),$(m).append(d),o.showOnLoad&&o.showOnLoad===!0&&$(d).click()),i.refresh&&(t=o.id||"search_"+e,d=$('<li class="ui-menu-item" role="presentation"><a class="'+c.cornerall+' g-menu-item" tabindex="0" role="menuitem" id="'+t+'">'+(i.refreshtext||i.refreshtitle)+"</a></li>").click(function(){if(!$(this).hasClass(c.disabled)){$.isFunction(i.beforeRefresh)&&i.beforeRefresh.call(l),l.p.search=!1,l.p.resetsearch=!0;try{if("currentfilter"!==i.refreshstate){var t=l.p.id;l.p.postData.filters="";try{$("#fbox_"+$.jgrid.jqID(t)).jqFilter("resetFilter")}catch(t){}$.isFunction(l.clearToolbar)&&l.clearToolbar.call(l,!1)}}catch(t){}switch(i.refreshstate){case"firstpage":$(l).trigger("reloadGrid",[{page:1}]);break;case"current":case"currentfilter":$(l).trigger("reloadGrid",[{current:!0}])}$.isFunction(i.afterRefresh)&&i.afterRefresh.call(l),$(m).hide()}return!1}),$(m).append(d)),$(m).hide(),$("body").append(m),$("#"+u).addClass("ui-menu "+h.menu_widget),$("#"+u+" > li > a").hover(function(){$(this).addClass(c.hover)},function(){$(this).removeClass(c.hover)})};m(),$(".dropdownmenu").on("click",function(){var t=$(this).offset(),e=t.left,i=parseInt(t.top),n=$(this).val();$("#"+n).show().css({top:i-($("#"+n).height()+10)+"px",left:e+"px"})}),$("body").on("click",function(t){$(t.target).hasClass("dropdownmenu")||$("#"+u).hide()})})},GridToForm:function(t,e){return this.each(function(){var i,n=this;if(n.grid){var r=$(n).jqGrid("getRowData",t);if(r)for(i in r)r.hasOwnProperty(i)&&($("[name="+$.jgrid.jqID(i)+"]",e).is("input:radio")||$("[name="+$.jgrid.jqID(i)+"]",e).is("input:checkbox")?$("[name="+$.jgrid.jqID(i)+"]",e).each(function(){$(this).val()==r[i]?$(this)[n.p.useProp?"prop":"attr"]("checked",!0):$(this)[n.p.useProp?"prop":"attr"]("checked",!1)}):$("[name="+$.jgrid.jqID(i)+"]",e).val(r[i]))}})},FormToGrid:function(t,e,i,n){return this.each(function(){var r=this;if(r.grid){i||(i="set"),n||(n="first");var a=$(e).serializeArray(),o={};$.each(a,function(t,e){o[e.name]=e.value}),"add"===i?$(r).jqGrid("addRowData",t,o,n):"set"===i&&$(r).jqGrid("setRowData",t,o)}})}}),$.jgrid.extend({groupingSetup:function(){return this.each(function(){var t,e,i,n=this,r=n.p.colModel,a=n.p.groupingView,o=$.jgrid.styleUI[n.p.styleUI||"jQueryUI"].grouping;if(null===a||"object"!=typeof a&&!$.isFunction(a))n.p.grouping=!1;else if(a.plusicon||(a.plusicon=o.icon_plus),a.minusicon||(a.minusicon=o.icon_minus),a.groupField.length){for(void 0===a.visibiltyOnNextGrouping&&(a.visibiltyOnNextGrouping=[]),a.lastvalues=[],a._locgr||(a.groups=[]),a.counters=[],t=0;t<a.groupField.length;t++)a.groupOrder[t]||(a.groupOrder[t]="asc"),a.groupText[t]||(a.groupText[t]="{0}"),"boolean"!=typeof a.groupColumnShow[t]&&(a.groupColumnShow[t]=!0),"boolean"!=typeof a.groupSummary[t]&&(a.groupSummary[t]=!1),a.groupSummaryPos[t]||(a.groupSummaryPos[t]="footer"),a.groupColumnShow[t]===!0?(a.visibiltyOnNextGrouping[t]=!0,$(n).jqGrid("showCol",a.groupField[t])):(a.visibiltyOnNextGrouping[t]=$("#"+$.jgrid.jqID(n.p.id+"_"+a.groupField[t])).is(":visible"),$(n).jqGrid("hideCol",a.groupField[t]));for(a.summary=[],a.hideFirstGroupCol&&(a.formatDisplayField[0]=function(t){return t}),e=0,i=r.length;e<i;e++)a.hideFirstGroupCol&&(r[e].hidden||a.groupField[0]!==r[e].name||(r[e].formatter=function(){return""})),r[e].summaryType&&(r[e].summaryDivider?a.summary.push({nm:r[e].name,st:r[e].summaryType,v:"",sd:r[e].summaryDivider,vd:"",sr:r[e].summaryRound,srt:r[e].summaryRoundType||"round"}):a.summary.push({nm:r[e].name,st:r[e].summaryType,v:"",sr:r[e].summaryRound,srt:r[e].summaryRoundType||"round"}))}else n.p.grouping=!1})},groupingPrepare:function(t,e){return this.each(function(){var i,n,r,a,o,s=this.p.groupingView,l=this,d=function(){$.isFunction(this.st)?this.v=this.st.call(l,this.v,this.nm,t):(this.v=$(l).jqGrid("groupingCalculations.handler",this.st,this.v,this.nm,this.sr,this.srt,t),"avg"===this.st.toLowerCase()&&this.sd&&(this.vd=$(l).jqGrid("groupingCalculations.handler",this.st,this.vd,this.sd,this.sr,this.srt,t)))},h=s.groupField.length,c=0;for(i=0;i<h;i++)n=s.groupField[i],a=s.displayField[i],r=t[n],o=null==a?null:t[a],null==o&&(o=r),void 0!==r&&(0===e?(s.groups.push({idx:i,dataIndex:n,value:r,displayValue:o,startRow:e,cnt:1,summary:[]}),s.lastvalues[i]=r,s.counters[i]={cnt:1,pos:s.groups.length-1,summary:$.extend(!0,[],s.summary)},$.each(s.counters[i].summary,d),s.groups[s.counters[i].pos].summary=s.counters[i].summary):"object"==typeof r||($.isArray(s.isInTheSameGroup)&&$.isFunction(s.isInTheSameGroup[i])?s.isInTheSameGroup[i].call(l,s.lastvalues[i],r,i,s):s.lastvalues[i]===r)?1===c?(s.groups.push({idx:i,dataIndex:n,value:r,displayValue:o,startRow:e,cnt:1,summary:[]}),s.lastvalues[i]=r,s.counters[i]={cnt:1,pos:s.groups.length-1,summary:$.extend(!0,[],s.summary)},$.each(s.counters[i].summary,d),s.groups[s.counters[i].pos].summary=s.counters[i].summary):(s.counters[i].cnt+=1,s.groups[s.counters[i].pos].cnt=s.counters[i].cnt,$.each(s.counters[i].summary,d),s.groups[s.counters[i].pos].summary=s.counters[i].summary):(s.groups.push({idx:i,dataIndex:n,value:r,displayValue:o,startRow:e,cnt:1,summary:[]}),s.lastvalues[i]=r,c=1,s.counters[i]={cnt:1,pos:s.groups.length-1,summary:$.extend(!0,[],s.summary)},$.each(s.counters[i].summary,d),s.groups[s.counters[i].pos].summary=s.counters[i].summary))}),this},groupingToggle:function(t){return this.each(function(){var e=this,i=e.p.groupingView,n=t.split("_"),r=parseInt(n[n.length-2],10);n.splice(n.length-2,2);var a,o,s=n.join("_"),l=i.minusicon,d=i.plusicon,h=$("#"+$.jgrid.jqID(t)),c=h.length?h[0].nextSibling:null,u=$("#"+$.jgrid.jqID(t)+" span.tree-wrap-"+e.p.direction),p=function(t){var e=$.map(t.split(" "),function(t){if(t.substring(0,s.length+1)===s+"_")return parseInt(t.substring(s.length+1),10)});return e.length>0?e[0]:void 0},f=!1,m=!1,g=!!e.p.frozenColumns&&e.p.id+"_frozen",_=!!g&&$("#"+$.jgrid.jqID(t),"#"+$.jgrid.jqID(g)),y=_&&_.length?_[0].nextSibling:null;if(u.hasClass(l)){if(i.showSummaryOnHide){if(c)for(;c&&(a=p(c.className),!(void 0!==a&&a<=r));)$(c).hide(),c=c.nextSibling,g&&($(y).hide(),y=y.nextSibling)}else if(c)for(;c&&(a=p(c.className),!(void 0!==a&&a<=r));)$(c).hide(),c=c.nextSibling,g&&($(y).hide(),y=y.nextSibling);u.removeClass(l).addClass(d),f=!0}else{if(c)for(o=void 0;c;){if(a=p(c.className),void 0===o&&(o=void 0===a),m=$(c).hasClass("ui-subgrid")&&$(c).hasClass("ui-sg-collapsed"),void 0!==a){if(a<=r)break;a===r+1&&(m||($(c).show().find(">td>span.tree-wrap-"+e.p.direction).removeClass(l).addClass(d),g&&$(y).show().find(">td>span.tree-wrap-"+e.p.direction).removeClass(l).addClass(d)))}else o&&(m||($(c).show(),g&&$(y).show()));c=c.nextSibling,g&&(y=y.nextSibling)}u.removeClass(d).addClass(l)}$(e).triggerHandler("jqGridGroupingClickGroup",[t,f]),$.isFunction(e.p.onClickGroup)&&e.p.onClickGroup.call(e,t,f)}),!1},groupingRender:function(t,e,i,n){return this.each(function(){function r(t,e,i){var n,r=!1;if(0===e)r=i[t];else{var a=i[t].idx;if(0===a)r=i[t];else for(n=t;n>=0;n--)if(i[n].idx===a-e){r=i[n];break}}return r}function a(t,i,n,a){var o,s,l=r(t,i,n),h=d.p.colModel,c=l.cnt,u="";for(s=a;s<e;s++){var p="<td "+d.formatCol(s,1,"")+">&#160;</td>",f="{0}";$.each(l.summary,function(){if(this.nm===h[s].name){h[s].summaryTpl&&(f=h[s].summaryTpl),"string"==typeof this.st&&"avg"===this.st.toLowerCase()&&(this.sd&&this.vd?this.v=this.v/this.vd:this.v&&c>0&&(this.v=this.v/c));try{this.groupCount=l.cnt,this.groupIndex=l.dataIndex,this.groupValue=l.value,o=d.formatter("",this.v,s,this)}catch(t){o=this.v}return p="<td "+d.formatCol(s,1,"")+">"+$.jgrid.template(f,o)+"</td>",!1}}),u+=p}return u}var o,s,l,d=this,h=d.p.groupingView,c="",u="",p=h.groupCollapse?h.plusicon:h.minusicon,f=[],m=h.groupField.length,g=$.jgrid.styleUI[d.p.styleUI||"jQueryUI"].common;p=p+" tree-wrap-"+d.p.direction,$.each(d.p.colModel,function(t,e){var i;for(i=0;i<m;i++)if(h.groupField[i]===e.name){f[i]=t;break}});var _,y=0,v=$.makeArray(h.groupSummary);v.reverse(),_=d.p.multiselect?' colspan="2"':"",$.each(h.groups,function(r,b){if(h._locgr&&!(b.startRow+b.cnt>(i-1)*n&&b.startRow<i*n))return!0;y++,s=d.p.id+"ghead_"+b.idx,o=s+"_"+r,u="<span style='cursor:pointer;margin-right:8px;margin-left:5px;' class='"+g.icon_base+" "+p+"' onclick=\"jQuery('#"+$.jgrid.jqID(d.p.id)+"').jqGrid('groupingToggle','"+o+"');return false;\"></span>";try{$.isArray(h.formatDisplayField)&&$.isFunction(h.formatDisplayField[b.idx])?(b.displayValue=h.formatDisplayField[b.idx].call(d,b.displayValue,b.value,d.p.colModel[f[b.idx]],b.idx,h),l=b.displayValue):l=d.formatter(o,b.displayValue,f[b.idx],b.value)}catch(t){l=b.displayValue}var w="";w=$.isFunction(h.groupText[b.idx])?h.groupText[b.idx].call(d,l,b.cnt,b.summary):$.jgrid.template(h.groupText[b.idx],l,b.cnt,b.summary),"string"!=typeof w&&"number"!=typeof w&&(w=l),"header"===h.groupSummaryPos[b.idx]?(c+='<tr id="'+o+'"'+(h.groupCollapse&&b.idx>0?' style="display:none;" ':" ")+'role="row" class= "'+g.content+" jqgroup ui-row-"+d.p.direction+" "+s+'"><td style="padding-left:'+12*b.idx+'px;"'+_+">"+u+w+"</td>",c+=a(r,0,h.groups,h.groupColumnShow[b.idx]===!1?""===_?2:3:""===_?1:2),c+="</tr>"):c+='<tr id="'+o+'"'+(h.groupCollapse&&b.idx>0?' style="display:none;" ':" ")+'role="row" class= "'+g.content+" jqgroup ui-row-"+d.p.direction+" "+s+'"><td style="padding-left:'+12*b.idx+'px;" colspan="'+(h.groupColumnShow[b.idx]===!1?e-1:e)+'">'+u+w+"</td></tr>";var x=m-1===b.idx;if(x){var k,L,C=h.groups[r+1],T=0,M=b.startRow,P=void 0!==C?C.startRow:h.groups[r].startRow+h.groups[r].cnt;for(h._locgr&&(T=(i-1)*n,T>b.startRow&&(M=T)),k=M;k<P&&t[k-T];k++)c+=t[k-T].join("");if("header"!==h.groupSummaryPos[b.idx]){var D;if(void 0!==C){for(D=0;D<h.groupField.length&&C.dataIndex!==h.groupField[D];D++);y=h.groupField.length-D}for(L=0;L<y;L++)if(v[L]){var S="";h.groupCollapse&&!h.showSummaryOnHide&&(S=' style="display:none;"'),c+="<tr"+S+' jqfootlevel="'+(b.idx-L)+'" role="row" class="'+g.content+" jqfoot ui-row-"+d.p.direction+'">',c+=a(r,L,h.groups,0),c+="</tr>"}y=D}}}),$("#"+$.jgrid.jqID(d.p.id)+" tbody:first").append(c),c=null})},groupingGroupBy:function(t,e){return this.each(function(){var i=this;"string"==typeof t&&(t=[t]);var n=i.p.groupingView;i.p.grouping=!0,n._locgr=!1,void 0===n.visibiltyOnNextGrouping&&(n.visibiltyOnNextGrouping=[]);var r;for(r=0;r<n.groupField.length;r++)!n.groupColumnShow[r]&&n.visibiltyOnNextGrouping[r]&&$(i).jqGrid("showCol",n.groupField[r]);for(r=0;r<t.length;r++)n.visibiltyOnNextGrouping[r]=$("#"+$.jgrid.jqID(i.p.id)+"_"+$.jgrid.jqID(t[r])).is(":visible");i.p.groupingView=$.extend(i.p.groupingView,e||{}),n.groupField=t,$(i).trigger("reloadGrid")})},groupingRemove:function(t){return this.each(function(){var e=this;if(void 0===t&&(t=!0),e.p.grouping=!1,t===!0){var i,n=e.p.groupingView;for(i=0;i<n.groupField.length;i++)!n.groupColumnShow[i]&&n.visibiltyOnNextGrouping[i]&&$(e).jqGrid("showCol",n.groupField);$("tr.jqgroup, tr.jqfoot","#"+$.jgrid.jqID(e.p.id)+" tbody:first").remove(),$("tr.jqgrow:hidden","#"+$.jgrid.jqID(e.p.id)+" tbody:first").show()}else $(e).trigger("reloadGrid")})},groupingCalculations:{handler:function(t,e,i,n,r,a){var o={sum:function(){return parseFloat(e||0)+parseFloat(a[i]||0)},min:function(){return""===e?parseFloat(a[i]||0):Math.min(parseFloat(e),parseFloat(a[i]||0))},max:function(){return""===e?parseFloat(a[i]||0):Math.max(parseFloat(e),parseFloat(a[i]||0))},count:function(){return""===e&&(e=0),a.hasOwnProperty(i)?e+1:0},avg:function(){return o.sum()}};if(!o[t])throw"jqGrid Grouping No such method: "+t;var s=o[t]();if(null!=n)if("fixed"===r)s=s.toFixed(n);else{var l=Math.pow(10,n);s=Math.round(s*l)/l}return s}},setGroupHeaders:function(t){return t=$.extend({useColSpanStyle:!1,groupHeaders:[]},t||{}),this.each(function(){var e,i,n,r,a,o,s,l,d,h,c,u,p,f,m=this,g=0,_=m.p.colModel,y=_.length,v=m.grid.headers,b=$("table.ui-jqgrid-htable",m.grid.hDiv),w=b.children("thead").children("tr.ui-jqgrid-labels:last").addClass("jqg-second-row-header"),x=b.children("thead"),k=b.find(".jqg-first-row-header"),L=$.jgrid.styleUI[m.p.styleUI||"jQueryUI"].base;m.p.groupHeader||(m.p.groupHeader=[]),m.p.groupHeader.push(t),void 0===k[0]?k=$("<tr>",{role:"row","aria-hidden":"true"}).addClass("jqg-first-row-header").css("height","auto"):k.empty();var C,T=function(t,e){var i,n=e.length;for(i=0;i<n;i++)if(e[i].startColumnName===t)return i;return-1};for($(m).prepend(x),n=$("<tr>",{role:"row"}).addClass("ui-jqgrid-labels jqg-third-row-header"),e=0;e<y;e++)if(a=v[e].el,o=$(a),i=_[e],s={height:"0px",width:v[e].width+"px",display:i.hidden?"none":""},$("<th>",{role:"gridcell"}).css(s).addClass("ui-first-th-"+m.p.direction).appendTo(k),a.style.width="",l=T(i.name,t.groupHeaders),l>=0){for(d=t.groupHeaders[l],h=d.numberOfColumns,c=d.titleText,p=d.className||"",u=0,l=0;l<h&&e+l<y;l++)_[e+l].hidden||u++;r=$("<th>").attr({role:"columnheader"}).addClass(L.headerBox+" ui-th-column-header ui-th-"+m.p.direction+" "+p).html(c),u>0&&r.attr("colspan",String(u)),m.p.headertitles&&r.attr("title",r.text()),0===u&&r.hide(),o.before(r),n.append(a),g=h-1}else 0===g?t.useColSpanStyle?o.attr("rowspan","2"):($("<th>",{role:"columnheader"}).addClass(L.headerBox+" ui-th-column-header ui-th-"+m.p.direction).css({display:i.hidden?"none":""}).insertBefore(o),n.append(a)):(n.append(a),g--);f=$(m).children("thead"),f.prepend(k),n.insertAfter(w),b.append(f),t.useColSpanStyle&&(b.find("span.ui-jqgrid-resize").each(function(){var t=$(this).parent();t.is(":visible")&&(this.style.cssText="height: "+t.height()+"px !important; cursor: col-resize;")}),b.find("div.ui-jqgrid-sortable").each(function(){var t=$(this),e=t.parent();e.is(":visible")&&e.is(":has(span.ui-jqgrid-resize)")&&t.css("top",(e.height()-t.outerHeight())/2-4+"px")})),C=f.find("tr.jqg-first-row-header"),$(m).bind("jqGridResizeStop.setGroupHeaders",function(t,e,i){C.find("th").eq(i).width(e)})})},destroyGroupHeader:function(t){return void 0===t&&(t=!0),this.each(function(){var e,i,n,r,a,o,s,l=this,d=l.grid,h=$("table.ui-jqgrid-htable thead",d.hDiv),c=l.p.colModel;if(d){for($(this).unbind(".setGroupHeaders"),e=$("<tr>",{role:"row"}).addClass("ui-jqgrid-labels"),r=d.headers,i=0,n=r.length;i<n;i++){s=c[i].hidden?"none":"",a=$(r[i].el).width(r[i].width).css("display",s);try{a.removeAttr("rowSpan")}catch(t){a.attr("rowSpan",1)}e.append(a),o=a.children("span.ui-jqgrid-resize"),o.length>0&&(o[0].style.height=""),a.children("div")[0].style.top=""}$(h).children("tr.ui-jqgrid-labels").remove(),$(h).prepend(e),t===!0&&$(l).jqGrid("setGridParam",{groupHeader:null})}})}}),$.jgrid=$.jgrid||{},$.extend($.jgrid,{saveState:function(t,e){if(e=$.extend({useStorage:!0,storageType:"localStorage",beforeSetItem:null,compression:!1,compressionModule:"LZString",compressionMethod:"compressToUTF16"},e||{}),t){var i,n,r="",a="",o=$("#"+t)[0];if(o.grid){if(n=$(o).data("inlineNav"),n&&o.p.inlineNav&&$(o).jqGrid("setGridParam",{_iN:n}),n=$(o).data("filterToolbar"),n&&o.p.filterToolbar&&$(o).jqGrid("setGridParam",{_fT:n}),r=$(o).jqGrid("jqGridExport",{exptype:"jsonstring",ident:"",root:""}),$(o.grid.bDiv).find(".ui-jqgrid-btable tr:gt(0)").each(function(t,e){a+=e.outerHTML}),$.isFunction(e.beforeSetItem)&&(i=e.beforeSetItem.call(o,r),null!=i&&(r=i)),e.compression&&e.compressionModule)try{i=window[e.compressionModule][e.compressionMethod](r),null!=i&&(r=i,a=window[e.compressionModule][e.compressionMethod](a))}catch(t){}if(e.useStorage&&$.jgrid.isLocalStorage())try{window[e.storageType].setItem("jqGrid"+o.p.id,r),window[e.storageType].setItem("jqGrid"+o.p.id+"_data",a)}catch(t){22===t.code&&alert("Local storage limit is over!")}return r}}},loadState:function(t,e,i){if(i=$.extend({useStorage:!0,storageType:"localStorage",clearAfterLoad:!1,beforeSetGrid:null,decompression:!1,decompressionModule:"LZString",decompressionMethod:"decompressFromUTF16"},i||{}),t){var n,r,a,o,s,l=$("#"+t)[0];if(l.grid&&$.jgrid.gridUnload(t),i.useStorage)try{e=window[i.storageType].getItem("jqGrid"+l.id),a=window[i.storageType].getItem("jqGrid"+l.id+"_data")}catch(t){}if(e){if(i.decompression&&i.decompressionModule)try{n=window[i.decompressionModule][i.decompressionMethod](e),null!=n&&(e=n,a=window[i.decompressionModule][i.decompressionMethod](a))}catch(t){}if(n=jqGridUtils.parse(e),n&&"object"===$.type(n)){$.isFunction(i.beforeSetGrid)&&(r=i.beforeSetGrid(n),r&&"object"===$.type(r)&&(n=r));var d=function(t){var e;return e=t},h={reccount:n.reccount,records:n.records,lastpage:n.lastpage,shrinkToFit:d(n.shrinkToFit),data:d(n.data),datatype:d(n.datatype),grouping:d(n.grouping)};n.shrinkToFit=!1,n.data=[],n.datatype="local",n.grouping=!1,n.navGrid=!1,n.inlineNav&&(o=d(n._iN),n._iN=null,delete n._iN),n.filterToolbar&&(s=d(n._fT),n._fT=null,delete n._fT);var c=$("#"+t).jqGrid(n);c.append(a),c.jqGrid("setGridParam",h),n.storeNavOptions&&c.jqGrid("navGrid",n.pager,n.navOptions,n.editOptions,n.addOptions,n.delOptions,n.searchOptions,n.viewOptions),n.inlineNav&&o&&(c.jqGrid("setGridParam",{inlineNav:!1}),c.jqGrid("inlineNav",n.pager,o)),n.filterToolbar&&s&&(c.jqGrid("setGridParam",{filterToolbar:!1}),c.jqGrid("filterToolbar",s)),c[0].updatepager(!0,!0),i.clearAfterLoad&&(window[i.storageType].removeItem("jqGrid"+l.id),window[i.storageType].removeItem("jqGrid"+l.id+"_data"))}else alert("can not convert to object")}}},setRegional:function(t,e){$.jgrid.saveState(t,{storageType:"sessionStorage"}),$.jgrid.loadState(t,null,{storageType:"sessionStorage",beforeSetGrid:function(t){return t.regional=e.regional,t.force_regional=!0,t}});var i=$("#"+t)[0],n=$(i).jqGrid("getGridParam","colModel"),r=-1,a=$.jgrid.getRegional(i,"nav");$.each(n,function(t){if(this.formatter&&"actions"===this.formatter)return r=t,!1}),r!==-1&&a&&$("#"+t+" tbody tr").each(function(){var t=this.cells[r];$(t).find(".ui-inline-edit").attr("title",a.edittitle),$(t).find(".ui-inline-del").attr("title",a.deltitle),$(t).find(".ui-inline-save").attr("title",a.savetitle),$(t).find(".ui-inline-cancel").attr("title",a.canceltitle)});try{window.sessionStorage.removeItem("jqGrid"+i.id),window.sessionStorage.removeItem("jqGrid"+i.id+"_data")}catch(t){}},jqGridImport:function(t,e){e=$.extend({imptype:"xml",impstring:"",impurl:"",mtype:"GET",impData:{},xmlGrid:{config:"root>grid",data:"root>rows"},jsonGrid:{config:"grid",data:"data"},ajaxOptions:{}},e||{});var i=(0===t.indexOf("#")?"":"#")+$.jgrid.jqID(t),n=function(t,e){var n,r,a,o=$(e.xmlGrid.config,t)[0],s=$(e.xmlGrid.data,t)[0];if(jqGridUtils.xmlToJSON){n=jqGridUtils.xmlToJSON(o);for(a in n)n.hasOwnProperty(a)&&(r=n[a]);if(s){var l=n.grid.datatype;n.grid.datatype="xmlstring",n.grid.datastr=t,$(i).jqGrid(r).jqGrid("setGridParam",{datatype:l})}else setTimeout(function(){$(i).jqGrid(r)},0)}else alert("xml2json or parse are not present")},r=function(t,e){if(t&&"string"==typeof t){var n=jqGridUtils.parse(t),r=n[e.jsonGrid.config],a=n[e.jsonGrid.data];if(a){var o=r.datatype;r.datatype="jsonstring",r.datastr=a,$(i).jqGrid(r).jqGrid("setGridParam",{datatype:o})}else $(i).jqGrid(r)}};switch(e.imptype){case"xml":$.ajax($.extend({url:e.impurl,type:e.mtype,data:e.impData,dataType:"xml",complete:function(t,r){"success"===r&&(n(t.responseXML,e),$(i).triggerHandler("jqGridImportComplete",[t,e]),$.isFunction(e.importComplete)&&e.importComplete(t)),t=null}},e.ajaxOptions));break;case"xmlstring":if(e.impstring&&"string"==typeof e.impstring){var a=$.parseXML(e.impstring);a&&(n(a,e),$(i).triggerHandler("jqGridImportComplete",[a,e]),$.isFunction(e.importComplete)&&e.importComplete(a))}break;case"json":$.ajax($.extend({url:e.impurl,type:e.mtype,data:e.impData,dataType:"json",complete:function(t){try{r(t.responseText,e),$(i).triggerHandler("jqGridImportComplete",[t,e]),$.isFunction(e.importComplete)&&e.importComplete(t)}catch(t){}t=null}},e.ajaxOptions));break;case"jsonstring":e.impstring&&"string"==typeof e.impstring&&(r(e.impstring,e),$(i).triggerHandler("jqGridImportComplete",[e.impstring,e]),$.isFunction(e.importComplete)&&e.importComplete(e.impstring))}}}),$.jgrid.extend({jqGridExport:function(t){t=$.extend({exptype:"xmlstring",root:"grid",ident:"\t",addOptions:{}},t||{});var e=null;return this.each(function(){if(this.grid){var i,n=$.extend(!0,{},$(this).jqGrid("getGridParam"),t.addOptions);if(n.rownumbers&&(n.colNames.splice(0,1),n.colModel.splice(0,1)),n.multiselect&&(n.colNames.splice(0,1),n.colModel.splice(0,1)),n.subGrid&&(n.colNames.splice(0,1),n.colModel.splice(0,1)),n.knv=null,n.treeGrid)for(i in n.treeReader)n.treeReader.hasOwnProperty(i)&&(n.colNames.splice(n.colNames.length-1),n.colModel.splice(n.colModel.length-1));switch(t.exptype){case"xmlstring":e="<"+t.root+">"+jqGridUtils.jsonToXML(n,{xmlDecl:""})+"</"+t.root+">";break;case"jsonstring":e=jqGridUtils.stringify(n),t.root&&(e="{"+t.root+":"+e+"}")}}}),e},excelExport:function(t){return t=$.extend({exptype:"remote",url:null,oper:"oper",tag:"excel",exportOptions:{}},t||{}),this.each(function(){if(this.grid){var e;
if("remote"===t.exptype){var i=$.extend({},this.p.postData);i[t.oper]=t.tag;var n=jQuery.param(i);e=t.url.indexOf("?")!==-1?t.url+"&"+n:t.url+"?"+n,window.location=e}}})}}),$.jgrid.inlineEdit=$.jgrid.inlineEdit||{},$.jgrid.extend({editRow:function(t,e,i,n,r,a,o,s,l){var d={},h=$.makeArray(arguments).slice(1);return"object"===$.type(h[0])?d=h[0]:(void 0!==e&&(d.keys=e),$.isFunction(i)&&(d.oneditfunc=i),$.isFunction(n)&&(d.successfunc=n),void 0!==r&&(d.url=r),void 0!==a&&(d.extraparam=a),$.isFunction(o)&&(d.aftersavefunc=o),$.isFunction(s)&&(d.errorfunc=s),$.isFunction(l)&&(d.afterrestorefunc=l)),d=$.extend(!0,{keys:!1,oneditfunc:null,successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,mtype:"POST",focusField:!0},$.jgrid.inlineEdit,d),this.each(function(){var e,i,n,r,a,o,s=this,l=0,h=null,c={},u=$(this).jqGrid("getStyleUI",s.p.styleUI+".inlinedit","inputClass",!0);s.grid&&(r=$(s).jqGrid("getInd",t,!0),r!==!1&&(o=$.isFunction(d.beforeEditRow)?d.beforeEditRow.call(s,d,t):void 0,void 0===o&&(o=!0),o&&(n=$(r).attr("editable")||"0","0"!==n||$(r).hasClass("not-editable-row")||(a=s.p.colModel,$('td[role="gridcell"]',r).each(function(n){e=a[n].name;var r=s.p.treeGrid===!0&&e===s.p.ExpandColumn;if(r)i=$("span:first",this).html();else try{i=$.unformat.call(s,this,{rowId:t,colModel:a[n]},n)}catch(t){i=a[n].edittype&&"textarea"===a[n].edittype?$(this).text():$(this).html()}if("cb"!==e&&"subgrid"!==e&&"rn"!==e&&(s.p.autoencode&&(i=$.jgrid.htmlDecode(i)),c[e]=i,a[n].editable===!0)){null===h&&(h=n),r?$("span:first",this).html(""):$(this).html("");var o=$.extend({},a[n].editoptions||{},{id:t+"_"+e,name:e,rowId:t,oper:"edit"});a[n].edittype||(a[n].edittype="text"),("&nbsp;"===i||"&#160;"===i||1===i.length&&160===i.charCodeAt(0))&&(i="");var d=$.jgrid.createEl.call(s,a[n].edittype,o,i,!0,$.extend({},$.jgrid.ajaxOptions,s.p.ajaxSelectOptions||{}));$(d).addClass("editable inline-edit-cell"),$.inArray(a[n].edittype,["text","textarea","password","select"])>-1&&$(d).addClass(u),r?$("span:first",this).append(d):$(this).append(d),$.jgrid.bindEv.call(s,d,o),"select"===a[n].edittype&&void 0!==a[n].editoptions&&a[n].editoptions.multiple===!0&&void 0===a[n].editoptions.dataUrl&&$.jgrid.msie&&$(d).width($(d).width()),l++}}),l>0&&(c.id=t,s.p.savedRow.push(c),$(r).attr("editable","1"),d.focusField&&("number"==typeof d.focusField&&parseInt(d.focusField,10)<=a.length&&(h=d.focusField),setTimeout(function(){var t=$("td:eq("+h+") :input:visible",r).not(":disabled");t.length>0&&t.focus()},0)),d.keys===!0&&$(r).bind("keyup",function(e){if(27===e.keyCode){if($(s).jqGrid("restoreRow",t,d.afterrestorefunc),s.p.inlineNav)try{$(s).jqGrid("showAddEditButtons")}catch(t){}return!1}if(13===e.keyCode){var i=e.target;if("TEXTAREA"===i.tagName)return!0;if($(s).jqGrid("saveRow",t,d)&&s.p.inlineNav)try{$(s).jqGrid("showAddEditButtons")}catch(t){}return!1}}),$(s).triggerHandler("jqGridInlineEditRow",[t,d]),$.isFunction(d.oneditfunc)&&d.oneditfunc.call(s,t))))))})},saveRow:function(t,e,i,n,r,a,o){var s=$.makeArray(arguments).slice(1),l={},d=this[0];"object"===$.type(s[0])?l=s[0]:($.isFunction(e)&&(l.successfunc=e),void 0!==i&&(l.url=i),void 0!==n&&(l.extraparam=n),$.isFunction(r)&&(l.aftersavefunc=r),$.isFunction(a)&&(l.errorfunc=a),$.isFunction(o)&&(l.afterrestorefunc=o)),l=$.extend(!0,{successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,mtype:"POST",saveui:"enable",savetext:$.jgrid.getRegional(d,"defaults.savetext")},$.jgrid.inlineEdit,l);var h,c,u,p,f,m=!1,g={},_={},y={},v=!1,b=$.trim($(d).jqGrid("getStyleUI",d.p.styleUI+".common","error",!0));if(!d.grid)return m;if(f=$(d).jqGrid("getInd",t,!0),f===!1)return m;var w=$.jgrid.getRegional(this,"errors"),x=$.jgrid.getRegional(this,"edit"),k=$.isFunction(l.beforeSaveRow)?l.beforeSaveRow.call(d,l,t):void 0;if(void 0===k&&(k=!0),k){if(c=$(f).attr("editable"),l.url=l.url||d.p.editurl,"1"===c){var L;if($('td[role="gridcell"]',f).each(function(t){if(L=d.p.colModel[t],h=L.name,"cb"!==h&&"subgrid"!==h&&L.editable===!0&&"rn"!==h&&!$(this).hasClass("not-editable-cell")){switch(L.edittype){case"checkbox":var e=["Yes","No"];L.editoptions&&(e=L.editoptions.value.split(":")),g[h]=$("input",this).is(":checked")?e[0]:e[1];break;case"text":case"password":case"textarea":case"button":g[h]=$("input, textarea",this).val();break;case"select":if(L.editoptions.multiple){var i=$("select",this),n=[];g[h]=$(i).val(),g[h]?g[h]=g[h].join(","):g[h]="",$("select option:selected",this).each(function(t,e){n[t]=$(e).text()}),_[h]=n.join(",")}else g[h]=$("select option:selected",this).val(),_[h]=$("select option:selected",this).text();L.formatter&&"select"===L.formatter&&(_={});break;case"custom":try{if(!L.editoptions||!$.isFunction(L.editoptions.custom_value))throw"e1";if(g[h]=L.editoptions.custom_value.call(d,$(".customelement",this),"get"),void 0===g[h])throw"e2"}catch(t){"e1"===t?$.jgrid.info_dialog(w.errcap,"function 'custom_value' "+x.msg.nodefined,x.bClose,{styleUI:d.p.styleUI}):$.jgrid.info_dialog(w.errcap,t.message,x.bClose,{styleUI:d.p.styleUI})}}if(p=$.jgrid.checkValues.call(d,g[h],t),p[0]===!1)return!1;d.p.autoencode&&(g[h]=$.jgrid.htmlEncode(g[h])),"clientArray"!==l.url&&L.editoptions&&L.editoptions.NullIfEmpty===!0&&""===g[h]&&(y[h]="null",v=!0)}}),p[0]===!1){try{var C=$(d).jqGrid("getGridRowById",t),T=$.jgrid.findPos(C);$.jgrid.info_dialog(w.errcap,p[1],x.bClose,{left:T[0],top:T[1]+$(C).outerHeight(),styleUI:d.p.styleUI})}catch(t){alert(p[1])}return m}var M,P=d.p.prmNames,D=t;if(M=d.p.keyName===!1?P.id:d.p.keyName,g){if(g[P.oper]=P.editoper,void 0===g[M]||""===g[M])g[M]=t;else if(f.id!==d.p.idPrefix+g[M]){var S=$.jgrid.stripPref(d.p.idPrefix,t);if(void 0!==d.p._index[S]&&(d.p._index[g[M]]=d.p._index[S],delete d.p._index[S]),t=d.p.idPrefix+g[M],$(f).attr("id",t),d.p.selrow===D&&(d.p.selrow=t),$.isArray(d.p.selarrrow)){var I=$.inArray(D,d.p.selarrrow);I>=0&&(d.p.selarrrow[I]=t)}if(d.p.multiselect){var E="jqg_"+d.p.id+"_"+t;$("input.cbox",f).attr("id",E).attr("name",E)}}void 0===d.p.inlineData&&(d.p.inlineData={}),g=$.extend({},g,d.p.inlineData,l.extraparam)}if("clientArray"===l.url){g=$.extend({},g,_),d.p.autoencode&&$.each(g,function(t,e){g[t]=$.jgrid.htmlDecode(e)});var U,O=$(d).jqGrid("setRowData",t,g);for($(f).attr("editable","0"),U=0;U<d.p.savedRow.length;U++)if(String(d.p.savedRow[U].id)===String(D)){u=U;break}u>=0&&d.p.savedRow.splice(u,1),$(d).triggerHandler("jqGridInlineAfterSaveRow",[t,O,g,l]),$.isFunction(l.aftersavefunc)&&l.aftersavefunc.call(d,t,O,g,l),m=!0,$(f).removeClass("jqgrid-new-row").unbind("keydown")}else $(d).jqGrid("progressBar",{method:"show",loadtype:l.saveui,htmlcontent:l.savetext}),y=$.extend({},g,y),y[M]=$.jgrid.stripPref(d.p.idPrefix,y[M]),$.ajax($.extend({url:l.url,data:$.isFunction(d.p.serializeRowData)?d.p.serializeRowData.call(d,y):y,type:l.mtype,async:!1,complete:function(e,i){if($(d).jqGrid("progressBar",{method:"hide",loadtype:l.saveui,htmlcontent:l.savetext}),"success"===i){var n,r,a=!0;if(n=$(d).triggerHandler("jqGridInlineSuccessSaveRow",[e,t,l]),$.isArray(n)||(n=[!0,y]),n[0]&&$.isFunction(l.successfunc)&&(n=l.successfunc.call(d,e)),$.isArray(n)?(a=n[0],g=n[1]||g):a=n,a===!0){for(d.p.autoencode&&$.each(g,function(t,e){g[t]=$.jgrid.htmlDecode(e)}),v&&$.each(g,function(t){"null"===g[t]&&(g[t]="")}),g=$.extend({},g,_),$(d).jqGrid("setRowData",t,g),$(f).attr("editable","0"),r=0;r<d.p.savedRow.length;r++)if(String(d.p.savedRow[r].id)===String(t)){u=r;break}u>=0&&d.p.savedRow.splice(u,1),$(d).triggerHandler("jqGridInlineAfterSaveRow",[t,e,g,l]),$.isFunction(l.aftersavefunc)&&l.aftersavefunc.call(d,t,e,g,l),m=!0,$(f).removeClass("jqgrid-new-row").unbind("keydown")}else $(d).triggerHandler("jqGridInlineErrorSaveRow",[t,e,i,null,l]),$.isFunction(l.errorfunc)&&l.errorfunc.call(d,t,e,i,null),l.restoreAfterError===!0&&$(d).jqGrid("restoreRow",t,l.afterrestorefunc)}},error:function(e,i,n){if($("#lui_"+$.jgrid.jqID(d.p.id)).hide(),$(d).triggerHandler("jqGridInlineErrorSaveRow",[t,e,i,n,l]),$.isFunction(l.errorfunc))l.errorfunc.call(d,t,e,i,n);else{var r=e.responseText||e.statusText;try{$.jgrid.info_dialog(w.errcap,'<div class="'+b+'">'+r+"</div>",x.bClose,{buttonalign:"right",styleUI:d.p.styleUI})}catch(t){alert(r)}}l.restoreAfterError===!0&&$(d).jqGrid("restoreRow",t,l.afterrestorefunc)}},$.jgrid.ajaxOptions,d.p.ajaxRowOptions||{}))}return m}},restoreRow:function(t,e){var i=$.makeArray(arguments).slice(1),n={};return"object"===$.type(i[0])?n=i[0]:$.isFunction(e)&&(n.afterrestorefunc=e),n=$.extend(!0,{},$.jgrid.inlineEdit,n),this.each(function(){var e,i,r=this,a=-1,o={};if(r.grid&&(e=$(r).jqGrid("getInd",t,!0),e!==!1)){var s=$.isFunction(n.beforeCancelRow)?n.beforeCancelRow.call(r,n,t):void 0;if(void 0===s&&(s=!0),s){for(i=0;i<r.p.savedRow.length;i++)if(String(r.p.savedRow[i].id)===String(t)){a=i;break}if(a>=0){if($.isFunction($.fn.datepicker))try{$("input.hasDatepicker","#"+$.jgrid.jqID(e.id)).datepicker("hide")}catch(t){}$.each(r.p.colModel,function(){this.editable===!0&&r.p.savedRow[a].hasOwnProperty(this.name)&&(o[this.name]=r.p.savedRow[a][this.name])}),$(r).jqGrid("setRowData",t,o),$(e).attr("editable","0").unbind("keydown"),r.p.savedRow.splice(a,1),$("#"+$.jgrid.jqID(t),"#"+$.jgrid.jqID(r.p.id)).hasClass("jqgrid-new-row")&&setTimeout(function(){$(r).jqGrid("delRowData",t),$(r).jqGrid("showAddEditButtons")},0)}$(r).triggerHandler("jqGridInlineAfterRestoreRow",[t]),$.isFunction(n.afterrestorefunc)&&n.afterrestorefunc.call(r,t)}}})},addRow:function(t){return t=$.extend(!0,{rowID:null,initdata:{},position:"first",useDefValues:!0,useFormatter:!1,addRowParams:{extraparam:{}}},t||{}),this.each(function(){if(this.grid){var e=this,i=$.isFunction(t.beforeAddRow)?t.beforeAddRow.call(e,t.addRowParams):void 0;if(void 0===i&&(i=!0),i)if(t.rowID=$.isFunction(t.rowID)?t.rowID.call(e,t):null!=t.rowID?t.rowID:$.jgrid.randId(),t.useDefValues===!0&&$(e.p.colModel).each(function(){if(this.editoptions&&this.editoptions.defaultValue){var i=this.editoptions.defaultValue,n=$.isFunction(i)?i.call(e):i;t.initdata[this.name]=n}}),$(e).jqGrid("addRowData",t.rowID,t.initdata,t.position),t.rowID=e.p.idPrefix+t.rowID,$("#"+$.jgrid.jqID(t.rowID),"#"+$.jgrid.jqID(e.p.id)).addClass("jqgrid-new-row"),t.useFormatter)$("#"+$.jgrid.jqID(t.rowID)+" .ui-inline-edit","#"+$.jgrid.jqID(e.p.id)).click();else{var n=e.p.prmNames,r=n.oper;t.addRowParams.extraparam[r]=n.addoper,$(e).jqGrid("editRow",t.rowID,t.addRowParams),$(e).jqGrid("setSelection",t.rowID)}}})},inlineNav:function(t,e){var i=this[0],n=$.jgrid.getRegional(i,"nav"),r=$.jgrid.styleUI[i.p.styleUI].inlinedit;return e=$.extend(!0,{edit:!0,editicon:r.icon_edit_nav,add:!0,addicon:r.icon_add_nav,save:!0,saveicon:r.icon_save_nav,cancel:!0,cancelicon:r.icon_cancel_nav,addParams:{addRowParams:{extraparam:{}}},editParams:{},restoreAfterSelect:!0},n,e||{}),this.each(function(){if(this.grid&&!this.p.inlineNav){var r=$.jgrid.jqID(i.p.id),a=$.trim($(i).jqGrid("getStyleUI",i.p.styleUI+".common","disabled",!0));if(i.p.navGrid||$(i).jqGrid("navGrid",t,{refresh:!1,edit:!1,add:!1,del:!1,search:!1,view:!1}),$(i).data("inlineNav")||$(i).data("inlineNav",e),i.p.force_regional&&(e=$.extend(e,n)),i.p.inlineNav=!0,e.addParams.useFormatter===!0){var o,s=i.p.colModel;for(o=0;o<s.length;o++)if(s[o].formatter&&"actions"===s[o].formatter){if(s[o].formatoptions){var l={keys:!1,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},d=$.extend(l,s[o].formatoptions);e.addParams.addRowParams={keys:d.keys,oneditfunc:d.onEdit,successfunc:d.onSuccess,url:d.url,extraparam:d.extraparam,aftersavefunc:d.afterSave,errorfunc:d.onError,afterrestorefunc:d.afterRestore}}break}}e.add&&$(i).jqGrid("navButtonAdd",t,{caption:e.addtext,title:e.addtitle,buttonicon:e.addicon,id:i.p.id+"_iladd",onClickButton:function(){$(i).jqGrid("addRow",e.addParams),e.addParams.useFormatter||($("#"+r+"_ilsave").removeClass(a),$("#"+r+"_ilcancel").removeClass(a),$("#"+r+"_iladd").addClass(a),$("#"+r+"_iledit").addClass(a))}}),e.edit&&$(i).jqGrid("navButtonAdd",t,{caption:e.edittext,title:e.edittitle,buttonicon:e.editicon,id:i.p.id+"_iledit",onClickButton:function(){var t=$(i).jqGrid("getGridParam","selrow");t?($(i).jqGrid("editRow",t,e.editParams),$("#"+r+"_ilsave").removeClass(a),$("#"+r+"_ilcancel").removeClass(a),$("#"+r+"_iladd").addClass(a),$("#"+r+"_iledit").addClass(a)):($.jgrid.viewModal("#alertmod_"+r,{gbox:"#gbox_"+r,jqm:!0}),$("#jqg_alrt").focus())}}),e.save&&($(i).jqGrid("navButtonAdd",t,{caption:e.savetext||"",title:e.savetitle||"Save row",buttonicon:e.saveicon,id:i.p.id+"_ilsave",onClickButton:function(){var t=i.p.savedRow[0].id;if(t){var n=i.p.prmNames,a=n.oper,o=e.editParams;$("#"+$.jgrid.jqID(t),"#"+r).hasClass("jqgrid-new-row")?(e.addParams.addRowParams.extraparam[a]=n.addoper,o=e.addParams.addRowParams):(e.editParams.extraparam||(e.editParams.extraparam={}),e.editParams.extraparam[a]=n.editoper),$(i).jqGrid("saveRow",t,o)&&$(i).jqGrid("showAddEditButtons")}else $.jgrid.viewModal("#alertmod_"+r,{gbox:"#gbox_"+r,jqm:!0}),$("#jqg_alrt").focus()}}),$("#"+r+"_ilsave").addClass(a)),e.cancel&&($(i).jqGrid("navButtonAdd",t,{caption:e.canceltext||"",title:e.canceltitle||"Cancel row editing",buttonicon:e.cancelicon,id:i.p.id+"_ilcancel",onClickButton:function(){var t=i.p.savedRow[0].id,n=e.editParams;t?($("#"+$.jgrid.jqID(t),"#"+r).hasClass("jqgrid-new-row")&&(n=e.addParams.addRowParams),$(i).jqGrid("restoreRow",t,n),$(i).jqGrid("showAddEditButtons")):($.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+r,jqm:!0}),$("#jqg_alrt").focus())}}),$("#"+r+"_ilcancel").addClass(a)),e.restoreAfterSelect===!0&&$(i).bind("jqGridBeforeSelectRow.inlineNav",function(t,n){i.p.savedRow.length>0&&i.p.inlineNav===!0&&n!==i.p.selrow&&null!==i.p.selrow&&(i.p.selrow===e.addParams.rowID?$(i).jqGrid("delRowData",i.p.selrow):$(i).jqGrid("restoreRow",i.p.selrow,e.editParams),$(i).jqGrid("showAddEditButtons"))})}})},showAddEditButtons:function(){return this.each(function(){if(this.grid){var t=$.jgrid.jqID(this.p.id),e=$.trim($(this).jqGrid("getStyleUI",this.p.styleUI+".common","disabled",!0));$("#"+t+"_ilsave").addClass(e),$("#"+t+"_ilcancel").addClass(e),$("#"+t+"_iladd").removeClass(e),$("#"+t+"_iledit").removeClass(e)}})}}),$.jgrid.msie&&8===$.jgrid.msiever()&&($.expr[":"].hidden=function(t){return 0===t.offsetWidth||0===t.offsetHeight||"none"===t.style.display}),$.jgrid._multiselect=!1,$.ui&&$.ui.multiselect){if($.ui.multiselect.prototype._setSelected){var setSelected=$.ui.multiselect.prototype._setSelected;$.ui.multiselect.prototype._setSelected=function(t,e){var i=setSelected.call(this,t,e);if(e&&this.selectedList){var n=this.element;this.selectedList.find("li").each(function(){$(this).data("optionLink")&&$(this).data("optionLink").remove().appendTo(n)})}return i}}$.ui.multiselect.prototype.destroy&&($.ui.multiselect.prototype.destroy=function(){this.element.show(),this.container.remove(),void 0===$.Widget?$.widget.prototype.destroy.apply(this,arguments):$.Widget.prototype.destroy.apply(this,arguments)}),$.jgrid._multiselect=!0}$.jgrid.extend({sortableColumns:function(t){return this.each(function(){function e(){i.p.disableClick=!0}var i=this,n=$.jgrid.jqID(i.p.id),r={tolerance:"pointer",axis:"x",scrollSensitivity:"1",items:">th:not(:has(#jqgh_"+n+"_cb,#jqgh_"+n+"_rn,#jqgh_"+n+"_subgrid),:hidden)",placeholder:{element:function(t){var e=$(document.createElement(t[0].nodeName)).addClass(t[0].className+" ui-sortable-placeholder ui-state-highlight").removeClass("ui-sortable-helper")[0];return e},update:function(t,e){e.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),e.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10))}},update:function(t,e){var n=$(e.item).parent(),r=$(">th",n),a=i.p.colModel,o={},s=i.p.id+"_";$.each(a,function(t){o[this.name]=t});var l=[];r.each(function(){var t=$(">div",this).get(0).id.replace(/^jqgh_/,"").replace(s,"");o.hasOwnProperty(t)&&l.push(o[t])}),$(i).jqGrid("remapColumns",l,!0,!0),$.isFunction(i.p.sortable.update)&&i.p.sortable.update(l),setTimeout(function(){i.p.disableClick=!1},50)}};if(i.p.sortable.options?$.extend(r,i.p.sortable.options):$.isFunction(i.p.sortable)&&(i.p.sortable={update:i.p.sortable}),r.start){var a=r.start;r.start=function(t,i){e(),a.call(this,t,i)}}else r.start=e;i.p.sortable.exclude&&(r.items+=":not("+i.p.sortable.exclude+")");var o=t.sortable(r),s=o.data("sortable")||o.data("uiSortable");null!=s&&(s.data("sortable").floating=!0)})},columnChooser:function(t){function e(t,e,i){var n,r;return e>=0?(n=t.slice(),r=n.splice(e,Math.max(t.length-e,e)),e>t.length&&(e=t.length),n[e]=i,n.concat(r)):t}function i(t,e){t&&("string"==typeof t?$.fn[t]&&$.fn[t].apply(e,$.makeArray(arguments).slice(2)):$.isFunction(t)&&t.apply(e,$.makeArray(arguments).slice(2)))}var n,r,a,o,s,l,d,h=this,c={},u=[],p=h.jqGrid("getGridParam","colModel"),f=h.jqGrid("getGridParam","colNames"),m=function(t){return $.ui.multiselect.prototype&&t.data($.ui.multiselect.prototype.widgetFullName||$.ui.multiselect.prototype.widgetName)||t.data("ui-multiselect")||t.data("multiselect")},g=$.jgrid.getRegional(this[0],"col");if(!$("#colchooser_"+$.jgrid.jqID(h[0].p.id)).length){if(n=$('<div id="colchooser_'+h[0].p.id+'" style="position:relative;overflow:hidden"><div><select multiple="multiple"></select></div></div>'),r=$("select",n),t=$.extend({width:400,height:240,classname:null,done:function(t){t&&h.jqGrid("remapColumns",t,!0)},msel:"multiselect",dlog:"dialog",dialog_opts:{minWidth:470,dialogClass:"ui-jqdialog"},dlog_opts:function(t){var e={};return e[t.bSubmit]=function(){t.apply_perm(),t.cleanup(!1)},e[t.bCancel]=function(){t.cleanup(!0)},$.extend(!0,{buttons:e,close:function(){t.cleanup(!0)},modal:t.modal||!1,resizable:t.resizable||!0,width:t.width+70,resize:function(){var t=m(r),e=t.container.closest(".ui-dialog-content");e.length>0&&"object"==typeof e[0].style?e[0].style.width="":e.css("width",""),t.selectedList.height(Math.max(t.selectedContainer.height()-t.selectedActions.outerHeight()-1,1)),t.availableList.height(Math.max(t.availableContainer.height()-t.availableActions.outerHeight()-1,1))}},t.dialog_opts||{})},apply_perm:function(){var i=[];$("option",r).each(function(){$(this).is("[selected]")?h.jqGrid("showCol",p[this.value].name):h.jqGrid("hideCol",p[this.value].name)}),$("option[selected]",r).each(function(){i.push(parseInt(this.value,10))}),$.each(i,function(){delete c[p[parseInt(this,10)].name]}),$.each(c,function(){var t=parseInt(this,10);i=e(i,t,t)}),t.done&&t.done.call(h,i),h.jqGrid("setGridWidth",h[0].p.width,h[0].p.shrinkToFit)},cleanup:function(e){i(t.dlog,n,"destroy"),i(t.msel,r,"destroy"),n.remove(),e&&t.done&&t.done.call(h)},msel_opts:{}},g,t||{}),$.ui&&$.ui.multiselect&&$.ui.multiselect.defaults){if(!$.jgrid._multiselect)return void alert("Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!");t.msel_opts=$.extend($.ui.multiselect.defaults,t.msel_opts)}t.caption&&n.attr("title",t.caption),t.classname&&(n.addClass(t.classname),r.addClass(t.classname)),t.width&&($(">div",n).css({width:t.width,margin:"0 auto"}),r.css("width",t.width)),t.height&&($(">div",n).css("height",t.height),r.css("height",t.height-10)),r.empty(),$.each(p,function(t){return c[this.name]=t,this.hidedlg?void(this.hidden||u.push(t)):void r.append("<option value='"+t+"' "+(this.hidden?"":"selected='selected'")+">"+$.jgrid.stripHtml(f[t])+"</option>")}),a=$.isFunction(t.dlog_opts)?t.dlog_opts.call(h,t):t.dlog_opts,i(t.dlog,n,a),o=$.isFunction(t.msel_opts)?t.msel_opts.call(h,t):t.msel_opts,i(t.msel,r,o),s=$("#colchooser_"+$.jgrid.jqID(h[0].p.id)),s.css({margin:"auto"}),s.find(">div").css({width:"100%",height:"100%",margin:"auto"}),l=m(r),l.container.css({width:"100%",height:"100%",margin:"auto"}),l.selectedContainer.css({width:100*l.options.dividerLocation+"%",height:"100%",margin:"auto",boxSizing:"border-box"}),l.availableContainer.css({width:100-100*l.options.dividerLocation+"%",height:"100%",margin:"auto",boxSizing:"border-box"}),l.selectedList.css("height","auto"),l.availableList.css("height","auto"),d=Math.max(l.selectedList.height(),l.availableList.height()),d=Math.min(d,$(window).height()),l.selectedList.css("height",d),l.availableList.css("height",d)}},sortableRows:function(t){return this.each(function(){var e=this;e.grid&&(e.p.treeGrid||$.fn.sortable&&(t=$.extend({cursor:"move",axis:"y",items:" > .jqgrow"},t||{}),t.start&&$.isFunction(t.start)?(t._start_=t.start,delete t.start):t._start_=!1,t.update&&$.isFunction(t.update)?(t._update_=t.update,delete t.update):t._update_=!1,t.start=function(i,n){if($(n.item).css("border-width","0"),$("td",n.item).each(function(t){this.style.width=e.grid.cols[t].style.width}),e.p.subGrid){var r=$(n.item).attr("id");try{$(e).jqGrid("collapseSubGridRow",r)}catch(t){}}t._start_&&t._start_.apply(this,[i,n])},t.update=function(i,n){$(n.item).css("border-width",""),e.p.rownumbers===!0&&$("td.jqgrid-rownum",e.rows).each(function(t){$(this).html(t+1+(parseInt(e.p.page,10)-1)*parseInt(e.p.rowNum,10))}),t._update_&&t._update_.apply(this,[i,n])},$("tbody:first",e).sortable(t),$("tbody:first > .jqgrow",e).disableSelection()))})},gridDnD:function(t){return this.each(function(){function e(){var t=$.data(r,"dnd");$("tr.jqgrow:not(.ui-draggable)",r).draggable($.isFunction(t.drag)?t.drag.call($(r),t):t.drag)}var i,n,r=this;if(r.grid&&!r.p.treeGrid&&$.fn.draggable&&$.fn.droppable){var a="<table id='jqgrid_dnd' class='ui-jqgrid-dnd'></table>";if(void 0===$("#jqgrid_dnd")[0]&&$("body").append(a),"string"==typeof t&&"updateDnD"===t&&r.p.jqgdnd===!0)return void e();if(t=$.extend({drag:function(t){return $.extend({start:function(e,i){var n,a;if(r.p.subGrid){a=$(i.helper).attr("id");try{$(r).jqGrid("collapseSubGridRow",a)}catch(t){}}for(n=0;n<$.data(r,"dnd").connectWith.length;n++)0===$($.data(r,"dnd").connectWith[n]).jqGrid("getGridParam","reccount")&&$($.data(r,"dnd").connectWith[n]).jqGrid("addRowData","jqg_empty_row",{});i.helper.addClass("ui-state-highlight"),$("td",i.helper).each(function(t){this.style.width=r.grid.headers[t].width+"px"}),t.onstart&&$.isFunction(t.onstart)&&t.onstart.call($(r),e,i)},stop:function(e,i){var n,a;for(i.helper.dropped&&!t.dragcopy&&(a=$(i.helper).attr("id"),void 0===a&&(a=$(this).attr("id")),$(r).jqGrid("delRowData",a)),n=0;n<$.data(r,"dnd").connectWith.length;n++)$($.data(r,"dnd").connectWith[n]).jqGrid("delRowData","jqg_empty_row");t.onstop&&$.isFunction(t.onstop)&&t.onstop.call($(r),e,i)}},t.drag_opts||{})},drop:function(t){return $.extend({accept:function(t){if(!$(t).hasClass("jqgrow"))return t;var e=$(t).closest("table.ui-jqgrid-btable");if(e.length>0&&void 0!==$.data(e[0],"dnd")){var i=$.data(e[0],"dnd").connectWith;return $.inArray("#"+$.jgrid.jqID(this.id),i)!==-1}return!1},drop:function(e,i){if($(i.draggable).hasClass("jqgrow")){var n=$(i.draggable).attr("id"),a=i.draggable.parent().parent().jqGrid("getRowData",n);if(!t.dropbyname){var o,s,l=0,d={},h=$("#"+$.jgrid.jqID(this.id)).jqGrid("getGridParam","colModel");try{for(s in a)a.hasOwnProperty(s)&&(o=h[l].name,"cb"!==o&&"rn"!==o&&"subgrid"!==o&&a.hasOwnProperty(s)&&h[l]&&(d[o]=a[s]),l++);a=d}catch(t){}}if(i.helper.dropped=!0,t.beforedrop&&$.isFunction(t.beforedrop)){var c=t.beforedrop.call(this,e,i,a,$("#"+$.jgrid.jqID(r.p.id)),$(this));void 0!==c&&null!==c&&"object"==typeof c&&(a=c)}if(i.helper.dropped){var u;t.autoid&&($.isFunction(t.autoid)?u=t.autoid.call(this,a):(u=Math.ceil(1e3*Math.random()),u=t.autoidprefix+u)),$("#"+$.jgrid.jqID(this.id)).jqGrid("addRowData",u,a,t.droppos)}t.ondrop&&$.isFunction(t.ondrop)&&t.ondrop.call(this,e,i,a)}}},t.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{activeClass:"ui-state-active",hoverClass:"ui-state-hover"},drag_opts:{revert:"invalid",helper:"clone",cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5e3},dragcopy:!1,dropbyname:!1,droppos:"first",autoid:!0,autoidprefix:"dnd_"},t||{}),t.connectWith)for(t.connectWith=t.connectWith.split(","),t.connectWith=$.map(t.connectWith,function(t){return $.trim(t)}),$.data(r,"dnd",t),0===r.p.reccount||r.p.jqgdnd||e(),r.p.jqgdnd=!0,i=0;i<t.connectWith.length;i++)n=t.connectWith[i],$(n).droppable($.isFunction(t.drop)?t.drop.call($(r),t):t.drop)}})},gridResize:function(opts){return this.each(function(){var $t=this,gID=$.jgrid.jqID($t.p.id),req;if($t.grid&&$.fn.resizable){if(opts=$.extend({},opts||{}),opts.alsoResize?(opts._alsoResize_=opts.alsoResize,delete opts.alsoResize):opts._alsoResize_=!1,opts.stop&&$.isFunction(opts.stop)?(opts._stop_=opts.stop,delete opts.stop):opts._stop_=!1,opts.stop=function(t,e){$($t).jqGrid("setGridParam",{height:$("#gview_"+gID+" .ui-jqgrid-bdiv").height()}),$($t).jqGrid("setGridWidth",e.size.width,opts.shrinkToFit),opts._stop_&&opts._stop_.call($t,t,e),$t.p.caption&&$("#gbox_"+gID).css({height:"auto"}),$t.p.frozenColumns&&(req&&clearTimeout(req),req=setTimeout(function(){req&&clearTimeout(req),$("#"+gID).jqGrid("destroyFrozenColumns"),$("#"+gID).jqGrid("setFrozenColumns")}))},opts._alsoResize_){var optstest="{'#gview_"+gID+" .ui-jqgrid-bdiv':true,'"+opts._alsoResize_+"':true}";opts.alsoResize=eval("("+optstest+")")}else opts.alsoResize=$(".ui-jqgrid-bdiv","#gview_"+gID);delete opts._alsoResize_,$("#gbox_"+gID).resizable(opts)}})}}),$.assocArraySize=function(t){var e,i=0;for(e in t)t.hasOwnProperty(e)&&i++;return i},$.jgrid.extend({pivotSetup:function(t,e){var i=[],n=[],r=[],a=[],o=[],s={grouping:!0,groupingView:{groupField:[],groupSummary:[],groupSummaryPos:[]}},l=[],d=$.extend({rowTotals:!1,rowTotalsText:"Total",colTotals:!1,groupSummary:!0,groupSummaryPos:"header",frozenStaticCols:!1},e||{});return this.each(function(){function e(t,e,i){var n;return n=_pivotfilter.call(t,e,i),n.length>0?n[0]:null}function h(t,e){var i,n=0,r=!0;for(i in t)if(t.hasOwnProperty(i)){if(t[i]!=this[n]){r=!1;break}if(n++,n>=this.length)break}return r&&(m=e),r}function c(t,e,i,n){var r;switch(t){case"sum":r=parseFloat(e||0)+parseFloat(n[i]||0);break;case"count":""!==e&&null!=e||(e=0),r=n.hasOwnProperty(i)?e+1:0;break;case"min":r=""===e||null==e?parseFloat(n[i]||0):Math.min(parseFloat(e),parseFloat(n[i]||0));break;case"max":r=""===e||null==e?parseFloat(n[i]||0):Math.max(parseFloat(e),parseFloat(n[i]||0))}return r}function u(t,e,i,n){var r,s,l,d,h=e.length,u="",p=[];for($.isArray(i)?(d=i.length,p=i):(d=1,p[0]=i),a=[],o=[],a.root=0,l=0;l<d;l++){var f,m=[];for(r=0;r<h;r++){if(null==i)s=$.trim(e[r].member)+"_"+e[r].aggregator,f=s,p[0]=e[r].label||e[r].aggregator+" "+$.trim(e[r].member);else{f=i[l].replace(/\s+/g,"");try{s=1===h?u+f:u+f+"_"+e[r].aggregator+"_"+String(r)}catch(t){}p[l]=i[l]}s=isNaN(parseInt(s,10))?s:s+" ",n[s]=m[s]=c(e[r].aggregator,n[s],e[r].member,t),l<=1&&"_r_Totals"!==f&&""===u&&(u=f)}a[s]=m,o[s]=p[l]}return n}function p(t){var e,n,r,a,o;for(r in t)if(t.hasOwnProperty(r)){if("object"!=typeof t[r]){if("level"===r){if(void 0===j[t.level]&&(j[t.level]="",t.level>0&&"_r_Totals"!==t.text&&(l[t.level-1]={useColSpanStyle:!1,groupHeaders:[]})),j[t.level]!==t.text&&t.children.length&&"_r_Totals"!==t.text&&t.level>0){l[t.level-1].groupHeaders.push({titleText:t.label,numberOfColumns:0});var s=l[t.level-1].groupHeaders.length-1,h=0===s?z:A+v;if(t.level-1===(d.rowTotals?1:0)&&s>0){for(var c=0,u=0;u<s;u++)c+=l[t.level-1].groupHeaders[u].numberOfColumns;c&&(h=c+_)}i[h]&&(l[t.level-1].groupHeaders[s].startColumnName=i[h].name,l[t.level-1].groupHeaders[s].numberOfColumns=i.length-h),A=i.length}j[t.level]=t.text}if(t.level===y&&"level"===r&&y>0)if(v>1){var f=1;for(e in t.fields)t.fields.hasOwnProperty(e)&&(1===f&&l[y-1].groupHeaders.push({startColumnName:e,numberOfColumns:1,titleText:t.label||t.text}),f++);l[y-1].groupHeaders[l[y-1].groupHeaders.length-1].numberOfColumns=f-1}else l.splice(y-1,1)}if(null!=t[r]&&"object"==typeof t[r]&&p(t[r]),"level"===r&&t.level>0&&t.level===(0===y?t.level:y)){n=0;for(e in t.fields)if(t.fields.hasOwnProperty(e)){o={};for(a in d.aggregates[n])if(d.aggregates[n].hasOwnProperty(a))switch(a){case"member":case"label":case"aggregator":break;default:o[a]=d.aggregates[n][a]}v>1?(o.name=e,o.label=d.aggregates[n].label||t.label):(o.name=t.text,o.label="_r_Totals"===t.text?d.rowTotalsText:t.label),i.push(o),n++}}}}var f,m,g,_,y,v,b,w,x=t.length,k=0;if(d.rowTotals&&d.yDimension.length>0){var L=d.yDimension[0].dataName;d.yDimension.splice(0,0,{dataName:L}),d.yDimension[0].converter=function(){return"_r_Totals"}}if(_=$.isArray(d.xDimension)?d.xDimension.length:0,y=d.yDimension.length,v=$.isArray(d.aggregates)?d.aggregates.length:0,0===_||0===v)throw"xDimension or aggregates optiona are not set!";var C;for(g=0;g<_;g++)C={name:d.xDimension[g].dataName,frozen:d.frozenStaticCols},null==d.xDimension[g].isGroupField&&(d.xDimension[g].isGroupField=!0),C=$.extend(!0,C,d.xDimension[g]),i.push(C);for(var T=_-1,M={};k<x;){f=t[k];var P=[],D=[];b={},g=0;do P[g]=$.trim(f[d.xDimension[g].dataName]),b[d.xDimension[g].dataName]=P[g],g++;while(g<_);var S=0;if(m=-1,w=e(n,h,P)){if(m>=0){if(S=0,y>=1){for(S=0;S<y;S++)D[S]=$.trim(f[d.yDimension[S].dataName]),d.yDimension[S].converter&&$.isFunction(d.yDimension[S].converter)&&(D[S]=d.yDimension[S].converter.call(this,D[S],P,D));w=u(f,d.aggregates,D,w)}else 0===y&&(w=u(f,d.aggregates,null,w));n[m]=w}}else{if(S=0,y>=1){for(S=0;S<y;S++)D[S]=$.trim(f[d.yDimension[S].dataName]),d.yDimension[S].converter&&$.isFunction(d.yDimension[S].converter)&&(D[S]=d.yDimension[S].converter.call(this,D[S],P,D));b=u(f,d.aggregates,D,b)}else 0===y&&(b=u(f,d.aggregates,null,b));n.push(b)}var I,E=0,U=null,O=null;for(I in a)if(a.hasOwnProperty(I)){if(0===E)M.children&&void 0!==M.children||(M={text:I,level:0,children:[],label:I}),U=M.children;else{for(O=null,g=0;g<U.length;g++)if(U[g].text===I){O=U[g];break}O?U=O.children:(U.push({children:[],text:I,level:E,fields:a[I],label:o[I]}),U=U[U.length-1].children)}E++}k++}var j=[],A=i.length,z=A;y>0&&(l[y-1]={useColSpanStyle:!1,groupHeaders:[]}),p(M);var B;if(d.colTotals)for(var R=n.length;R--;)for(g=_;g<i.length;g++)B=i[g].name,r[B]?r[B]+=parseFloat(n[R][B]||0):r[B]=parseFloat(n[R][B]||0);if(T>0)for(g=0;g<T;g++)i[g].isGroupField&&(s.groupingView.groupField.push(i[g].name),s.groupingView.groupSummary.push(d.groupSummary),s.groupingView.groupSummaryPos.push(d.groupSummaryPos));else s.grouping=!1;s.sortname=i[T].name,s.groupingView.hideFirstGroupCol=!0}),{colModel:i,rows:n,groupOptions:s,groupHeaders:l,summary:r}},jqPivot:function(t,e,i,n){return this.each(function(){function r(t){var n,r=jQuery(a).jqGrid("pivotSetup",t,e),o=$.assocArraySize(r.summary)>0,s=$.jgrid.from.call(a,r.rows);for(n=0;n<r.groupOptions.groupingView.groupField.length;n++)s.orderBy(r.groupOptions.groupingView.groupField[n],"a","text","");jQuery(a).jqGrid($.extend(!0,{datastr:$.extend(s.select(),o?{userdata:r.summary}:{}),datatype:"jsonstring",footerrow:o,userDataOnFooter:o,colModel:r.colModel,viewrecords:!0,sortname:e.xDimension[0].dataName},r.groupOptions,i||{}));var l=r.groupHeaders;if(l.length)for(n=0;n<l.length;n++)l[n]&&l[n].groupHeaders.length&&jQuery(a).jqGrid("setGroupHeaders",l[n]);e.frozenStaticCols&&jQuery(a).jqGrid("setFrozenColumns")}var a=this;"string"==typeof t?$.ajax($.extend({url:t,dataType:"json",success:function(t){r($.jgrid.getAccessor(t,n&&n.reader?n.reader:"rows"))}},n||{})):r(t)})}}),$.jgrid.extend({setSubGrid:function(){return this.each(function(){var t,e,i=this,n=$.jgrid.styleUI[i.p.styleUI||"jQueryUI"].subgrid,r={plusicon:n.icon_plus,minusicon:n.icon_minus,openicon:n.icon_open,expandOnLoad:!1,delayOnLoad:50,selectOnExpand:!1,selectOnCollapse:!1,reloadOnExpand:!0};if(i.p.subGridOptions=$.extend(r,i.p.subGridOptions||{}),i.p.colNames.unshift(""),i.p.colModel.unshift({name:"subgrid",width:$.jgrid.cell_width?i.p.subGridWidth+i.p.cellLayout:i.p.subGridWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,fixed:!0}),t=i.p.subGridModel,t[0])for(t[0].align=$.extend([],t[0].align||[]),e=0;e<t[0].name.length;e++)t[0].align[e]=t[0].align[e]||"left"})},addSubGridCell:function(t,e){var i,n,r,a="";return this.each(function(){a=this.formatCol(t,e),n=this.p.id,i=this.p.subGridOptions.plusicon,r=$.jgrid.styleUI[this.p.styleUI||"jQueryUI"].common}),'<td role="gridcell" aria-describedby="'+n+'_subgrid" class="ui-sgcollapsed sgcollapsed" '+a+"><a style='cursor:pointer;' class='ui-sghref'><span class='"+r.icon_base+" "+i+"'></span></a></td>"},addSubGrid:function(t,e){return this.each(function(){var i=this;if(i.grid){var n,r,a,o,s,l=$.jgrid.styleUI[i.p.styleUI||"jQueryUI"].base,d=$.jgrid.styleUI[i.p.styleUI||"jQueryUI"].common,h=function(t,e,n){var r=$("<td align='"+i.p.subGridModel[0].align[n]+"'></td>").html(e);
$(t).append(r)},c=function(t,e){var n,r,a,o=$("<table class='"+l.rowTable+" ui-common-table'><tbody></tbody></table>"),s=$("<tr></tr>");for(r=0;r<i.p.subGridModel[0].name.length;r++)n=$("<th class='"+l.headerBox+" ui-th-subgrid ui-th-column ui-th-"+i.p.direction+"'></th>"),$(n).html(i.p.subGridModel[0].name[r]),$(n).width(i.p.subGridModel[0].width[r]),$(s).append(n);$(o).append(s),t&&(a=i.p.xmlReader.subgrid,$(a.root+" "+a.row,t).each(function(){if(s=$("<tr class='"+d.content+" ui-subtblcell'></tr>"),a.repeatitems===!0)$(a.cell,this).each(function(t){h(s,$(this).text()||"&#160;",t)});else{var t=i.p.subGridModel[0].mapping||i.p.subGridModel[0].name;if(t)for(r=0;r<t.length;r++)h(s,$(t[r],this).text()||"&#160;",r)}$(o).append(s)}));var c=$("table:first",i.grid.bDiv).attr("id")+"_";return $("#"+$.jgrid.jqID(c+e)).append(o),i.grid.hDiv.loading=!1,$("#load_"+$.jgrid.jqID(i.p.id)).hide(),!1},u=function(t,e){var n,r,a,o,s,c,u=$("<table class='"+l.rowTable+" ui-common-table'><tbody></tbody></table>"),p=$("<tr></tr>");for(a=0;a<i.p.subGridModel[0].name.length;a++)n=$("<th class='"+l.headerBox+" ui-th-subgrid ui-th-column ui-th-"+i.p.direction+"'></th>"),$(n).html(i.p.subGridModel[0].name[a]),$(n).width(i.p.subGridModel[0].width[a]),$(p).append(n);if($(u).append(p),t&&(s=i.p.jsonReader.subgrid,r=$.jgrid.getAccessor(t,s.root),void 0!==r))for(a=0;a<r.length;a++){if(o=r[a],p=$("<tr class='"+d.content+" ui-subtblcell'></tr>"),s.repeatitems===!0)for(s.cell&&(o=o[s.cell]),c=0;c<o.length;c++)h(p,o[c]||"&#160;",c);else{var f=i.p.subGridModel[0].mapping||i.p.subGridModel[0].name;if(f.length)for(c=0;c<f.length;c++)h(p,o[f[c]]||"&#160;",c)}$(u).append(p)}var m=$("table:first",i.grid.bDiv).attr("id")+"_";return $("#"+$.jgrid.jqID(m+e)).append(u),i.grid.hDiv.loading=!1,$("#load_"+$.jgrid.jqID(i.p.id)).hide(),!1},p=function(t){var e,n,r,a;if(e=$(t).attr("id"),n={nd_:(new Date).getTime()},n[i.p.prmNames.subgridid]=e,!i.p.subGridModel[0])return!1;if(i.p.subGridModel[0].params)for(a=0;a<i.p.subGridModel[0].params.length;a++)for(r=0;r<i.p.colModel.length;r++)i.p.colModel[r].name===i.p.subGridModel[0].params[a]&&(n[i.p.colModel[r].name]=$("td:eq("+r+")",t).text().replace(/\&#160\;/gi,""));if(!i.grid.hDiv.loading)switch(i.grid.hDiv.loading=!0,$("#load_"+$.jgrid.jqID(i.p.id)).show(),i.p.subgridtype||(i.p.subgridtype=i.p.datatype),$.isFunction(i.p.subgridtype)?i.p.subgridtype.call(i,n):i.p.subgridtype=i.p.subgridtype.toLowerCase(),i.p.subgridtype){case"xml":case"json":$.ajax($.extend({type:i.p.mtype,url:$.isFunction(i.p.subGridUrl)?i.p.subGridUrl.call(i,n):i.p.subGridUrl,dataType:i.p.subgridtype,data:$.isFunction(i.p.serializeSubGridData)?i.p.serializeSubGridData.call(i,n):n,complete:function(t){"xml"===i.p.subgridtype?c(t.responseXML,e):u($.jgrid.parse(t.responseText),e),t=null}},$.jgrid.ajaxOptions,i.p.ajaxSubgridOptions||{}))}return!1},f=0;$.each(i.p.colModel,function(){this.hidden!==!0&&"rn"!==this.name&&"cb"!==this.name||f++});var m=i.rows.length,g=1;for(void 0!==e&&e>0&&(g=e,m=e+1);g<m;)$(i.rows[g]).hasClass("jqgrow")&&(i.p.scroll&&$(i.rows[g].cells[t]).unbind("click"),$(i.rows[g].cells[t]).bind("click",function(){var e=$(this).parent("tr")[0];if(r=i.p.id,n=e.id,s=$("#"+r+"_"+n+"_expandedContent"),$(this).hasClass("sgcollapsed")){if(o=$(i).triggerHandler("jqGridSubGridBeforeExpand",[r+"_"+n,n]),o=o!==!1&&"stop"!==o,o&&$.isFunction(i.p.subGridBeforeExpand)&&(o=i.p.subGridBeforeExpand.call(i,r+"_"+n,n)),o===!1)return!1;i.p.subGridOptions.reloadOnExpand===!0||i.p.subGridOptions.reloadOnExpand===!1&&!s.hasClass("ui-subgrid")?(a=t>=1?"<td colspan='"+t+"'>&#160;</td>":"",$(e).after("<tr role='row' id='"+r+"_"+n+"_expandedContent' class='ui-subgrid ui-sg-expanded'>"+a+"<td class='"+d.content+" subgrid-cell'><span class='"+d.icon_base+" "+i.p.subGridOptions.openicon+"'></span></td><td colspan='"+parseInt(i.p.colNames.length-1-f,10)+"' class='"+d.content+" subgrid-data'><div id="+r+"_"+n+" class='tablediv'></div></td></tr>"),$(i).triggerHandler("jqGridSubGridRowExpanded",[r+"_"+n,n]),$.isFunction(i.p.subGridRowExpanded)?i.p.subGridRowExpanded.call(i,r+"_"+n,n):p(e)):s.show().removeClass("ui-sg-collapsed").addClass("ui-sg-expanded"),$(this).html("<a style='cursor:pointer;' class='ui-sghref'><span class='"+d.icon_base+" "+i.p.subGridOptions.minusicon+"'></span></a>").removeClass("sgcollapsed").addClass("sgexpanded"),i.p.subGridOptions.selectOnExpand&&$(i).jqGrid("setSelection",n)}else if($(this).hasClass("sgexpanded")){if(o=$(i).triggerHandler("jqGridSubGridRowColapsed",[r+"_"+n,n]),o=o!==!1&&"stop"!==o,o&&$.isFunction(i.p.subGridRowColapsed)&&(o=i.p.subGridRowColapsed.call(i,r+"_"+n,n)),o===!1)return!1;i.p.subGridOptions.reloadOnExpand===!0?s.remove(".ui-subgrid"):s.hasClass("ui-subgrid")&&s.hide().addClass("ui-sg-collapsed").removeClass("ui-sg-expanded"),$(this).html("<a style='cursor:pointer;' class='ui-sghref'><span class='"+d.icon_base+" "+i.p.subGridOptions.plusicon+"'></span></a>").removeClass("sgexpanded").addClass("sgcollapsed"),i.p.subGridOptions.selectOnCollapse&&$(i).jqGrid("setSelection",n)}return!1})),g++;i.p.subGridOptions.expandOnLoad===!0&&$(i.rows).filter(".jqgrow").each(function(t,e){$(e.cells[0]).click()}),i.subGridXml=function(t,e){c(t,e)},i.subGridJson=function(t,e){u(t,e)}}})},expandSubGridRow:function(t){return this.each(function(){var e=this;if((e.grid||t)&&e.p.subGrid===!0){var i=$(this).jqGrid("getInd",t,!0);if(i){var n=$("td.sgcollapsed",i)[0];n&&$(n).trigger("click")}}})},collapseSubGridRow:function(t){return this.each(function(){var e=this;if((e.grid||t)&&e.p.subGrid===!0){var i=$(this).jqGrid("getInd",t,!0);if(i){var n=$("td.sgexpanded",i)[0];n&&$(n).trigger("click")}}})},toggleSubGridRow:function(t){return this.each(function(){var e=this;if((e.grid||t)&&e.p.subGrid===!0){var i=$(this).jqGrid("getInd",t,!0);if(i){var n=$("td.sgcollapsed",i)[0];n?$(n).trigger("click"):(n=$("td.sgexpanded",i)[0],n&&$(n).trigger("click"))}}})}}),$.jgrid.extend({setTreeNode:function(t,e){return this.each(function(){var i=this;if(i.grid&&i.p.treeGrid)for(var n,r,a,o,s,l,d,h,c=i.p.expColInd,u=i.p.treeReader.expanded_field,p=i.p.treeReader.leaf_field,f=i.p.treeReader.level_field,m=i.p.treeReader.icon_field,g=i.p.treeReader.loaded,_=$.jgrid.styleUI[i.p.styleUI||"jQueryUI"].common;t<e;){var y,v=$.jgrid.stripPref(i.p.idPrefix,i.rows[t].id),b=i.p._index[v];d=i.p.data[b],"nested"===i.p.treeGridModel&&(d[p]||(n=parseInt(d[i.p.treeReader.left_field],10),r=parseInt(d[i.p.treeReader.right_field],10),d[p]=r===n+1?"true":"false",i.rows[t].cells[i.p._treeleafpos].innerHTML=d[p])),a=parseInt(d[f],10),0===i.p.tree_root_level?(o=a+1,s=a):(o=a,s=a-1),l="<div class='tree-wrap tree-wrap-"+i.p.direction+"' style='width:"+18*o+"px;'>",l+="<div style='"+("rtl"===i.p.direction?"right:":"left:")+18*s+"px;' class='"+_.icon_base+" ",void 0!==d[g]&&("true"===d[g]||d[g]===!0?d[g]=!0:d[g]=!1),"true"===d[p]||d[p]===!0?(l+=(void 0!==d[m]&&""!==d[m]?d[m]:i.p.treeIcons.leaf)+" tree-leaf treeclick",d[p]=!0,h="leaf"):(d[p]=!1,h=""),d[u]=("true"===d[u]||d[u]===!0)&&(d[g]||void 0===d[g]),l+=d[u]===!1?d[p]===!0?"'":i.p.treeIcons.plus+" tree-plus treeclick'":d[p]===!0?"'":i.p.treeIcons.minus+" tree-minus treeclick'",l+="></div></div>",$(i.rows[t].cells[c]).wrapInner("<span class='cell-wrapper"+h+"'></span>").prepend(l),a!==parseInt(i.p.tree_root_level,10)&&(y=$(i).jqGrid("isVisibleNode",d),y||$(i.rows[t]).css("display","none")),$(i.rows[t].cells[c]).find("div.treeclick").bind("click",function(t){var e=t.target||t.srcElement,n=$.jgrid.stripPref(i.p.idPrefix,$(e,i.rows).closest("tr.jqgrow")[0].id),r=i.p._index[n];return i.p.data[r][p]||(i.p.data[r][u]?($(i).jqGrid("collapseRow",i.p.data[r]),$(i).jqGrid("collapseNode",i.p.data[r])):($(i).jqGrid("expandRow",i.p.data[r]),$(i).jqGrid("expandNode",i.p.data[r]))),!1}),i.p.ExpandColClick===!0&&$(i.rows[t].cells[c]).find("span.cell-wrapper").css("cursor","pointer").bind("click",function(t){var e=t.target||t.srcElement,n=$.jgrid.stripPref(i.p.idPrefix,$(e,i.rows).closest("tr.jqgrow")[0].id),r=i.p._index[n];return i.p.data[r][p]||(i.p.data[r][u]?($(i).jqGrid("collapseRow",i.p.data[r]),$(i).jqGrid("collapseNode",i.p.data[r])):($(i).jqGrid("expandRow",i.p.data[r]),$(i).jqGrid("expandNode",i.p.data[r]))),$(i).jqGrid("setSelection",n),!1}),t++}})},setTreeGrid:function(){return this.each(function(){var t,e,i,n,r=this,a=0,o=!1,s=[],l=$.jgrid.styleUI[r.p.styleUI||"jQueryUI"].treegrid;if(r.p.treeGrid){r.p.treedatatype||$.extend(r.p,{treedatatype:r.p.datatype}),r.p.loadonce&&(r.p.treedatatype="local"),r.p.subGrid=!1,r.p.altRows=!1,r.p.pgbuttons=!1,r.p.pginput=!1,r.p.gridview=!0,null===r.p.rowTotal&&(r.p.rowNum=1e4),r.p.multiselect=!1,r.p.rowList=[],r.p.expColInd=0,t=l.icon_plus,"jQueryUI"===r.p.styleUI&&(t+="rtl"===r.p.direction?"w":"e"),r.p.treeIcons=$.extend({plus:t,minus:l.icon_minus,leaf:l.icon_leaf},r.p.treeIcons||{}),"nested"===r.p.treeGridModel?r.p.treeReader=$.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},r.p.treeReader):"adjacency"===r.p.treeGridModel&&(r.p.treeReader=$.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},r.p.treeReader));for(i in r.p.colModel)if(r.p.colModel.hasOwnProperty(i)){e=r.p.colModel[i].name,e!==r.p.ExpandColumn||o||(o=!0,r.p.expColInd=a),a++;for(n in r.p.treeReader)r.p.treeReader.hasOwnProperty(n)&&r.p.treeReader[n]===e&&s.push(e)}$.each(r.p.treeReader,function(t,e){e&&$.inArray(e,s)===-1&&("leaf_field"===t&&(r.p._treeleafpos=a),a++,r.p.colNames.push(e),r.p.colModel.push({name:e,width:1,hidden:!0,sortable:!1,resizable:!1,hidedlg:!0,editable:!0,search:!1}))})}})},expandRow:function(t){this.each(function(){var e=this;if(e.grid&&e.p.treeGrid){var i=$(e).jqGrid("getNodeChildren",t),n=e.p.treeReader.expanded_field,r=t[e.p.localReader.id],a=!$.isFunction(e.p.beforeExpandTreeGridRow)||e.p.beforeExpandTreeGridRow.call(e,r,t,i);a!==!1&&($(i).each(function(){var t=e.p.idPrefix+$.jgrid.getAccessor(this,e.p.localReader.id);$($(e).jqGrid("getGridRowById",t)).css("display",""),this[n]&&$(e).jqGrid("expandRow",this)}),$.isFunction(e.p.afterExpandTreeGridRow)&&e.p.afterExpandTreeGridRow.call(e,r,t,i))}})},collapseRow:function(t){this.each(function(){var e=this;if(e.grid&&e.p.treeGrid){var i=$(e).jqGrid("getNodeChildren",t),n=e.p.treeReader.expanded_field,r=t[e.p.localReader.id],a=!$.isFunction(e.p.beforeCollapseTreeGridRow)||e.p.beforeCollapseTreeGridRow.call(e,r,t,i);a!==!1&&($(i).each(function(){var t=e.p.idPrefix+$.jgrid.getAccessor(this,e.p.localReader.id);$($(e).jqGrid("getGridRowById",t)).css("display","none"),this[n]&&$(e).jqGrid("collapseRow",this)}),$.isFunction(e.p.afterCollapseTreeGridRow)&&e.p.afterCollapseTreeGridRow.call(e,r,t,i))}})},getRootNodes:function(t){var e=[];return this.each(function(){var i,n,r,a=this;if(a.grid&&a.p.treeGrid)switch("boolean"!=typeof t&&(t=!1),r=t?$(a).jqGrid("getRowData",null,!0):a.p.data,a.p.treeGridModel){case"nested":i=a.p.treeReader.level_field,$(r).each(function(){parseInt(this[i],10)===parseInt(a.p.tree_root_level,10)&&(t?e.push(a.p.data[a.p._index[this[a.p.keyName]]]):e.push(this))});break;case"adjacency":n=a.p.treeReader.parent_id_field,$(r).each(function(){null!==this[n]&&"null"!==String(this[n]).toLowerCase()||(t?e.push(a.p.data[a.p._index[this[a.p.keyName]]]):e.push(this))})}}),e},getNodeDepth:function(t){var e=null;return this.each(function(){if(this.grid&&this.p.treeGrid){var i=this;switch(i.p.treeGridModel){case"nested":var n=i.p.treeReader.level_field;e=parseInt(t[n],10)-parseInt(i.p.tree_root_level,10);break;case"adjacency":e=$(i).jqGrid("getNodeAncestors",t).length}}}),e},getNodeParent:function(t){var e=null;return this.each(function(){var i=this;if(i.grid&&i.p.treeGrid)switch(i.p.treeGridModel){case"nested":var n=i.p.treeReader.left_field,r=i.p.treeReader.right_field,a=i.p.treeReader.level_field,o=parseInt(t[n],10),s=parseInt(t[r],10),l=parseInt(t[a],10);$(this.p.data).each(function(){if(parseInt(this[a],10)===l-1&&parseInt(this[n],10)<o&&parseInt(this[r],10)>s)return e=this,!1});break;case"adjacency":for(var d=i.p.treeReader.parent_id_field,h=i.p.localReader.id,c=t[h],u=i.p._index[c];u--;)if(i.p.data[u][h]===$.jgrid.stripPref(i.p.idPrefix,t[d])){e=i.p.data[u];break}}}),e},getNodeChildren:function(t){var e=[];return this.each(function(){var i=this;if(i.grid&&i.p.treeGrid)switch(i.p.treeGridModel){case"nested":var n=i.p.treeReader.left_field,r=i.p.treeReader.right_field,a=i.p.treeReader.level_field,o=parseInt(t[n],10),s=parseInt(t[r],10),l=parseInt(t[a],10);$(this.p.data).each(function(){parseInt(this[a],10)===l+1&&parseInt(this[n],10)>o&&parseInt(this[r],10)<s&&e.push(this)});break;case"adjacency":var d=i.p.treeReader.parent_id_field,h=i.p.localReader.id;$(this.p.data).each(function(){this[d]==$.jgrid.stripPref(i.p.idPrefix,t[h])&&e.push(this)})}}),e},getFullTreeNode:function(t,e){var i=[];return this.each(function(){var n,r=this,a=r.p.treeReader.expanded_field;if(r.grid&&r.p.treeGrid)switch(null!=e&&"boolean"==typeof e||(e=!1),r.p.treeGridModel){case"nested":var o=r.p.treeReader.left_field,s=r.p.treeReader.right_field,l=r.p.treeReader.level_field,d=parseInt(t[o],10),h=parseInt(t[s],10),c=parseInt(t[l],10);$(this.p.data).each(function(){parseInt(this[l],10)>=c&&parseInt(this[o],10)>=d&&parseInt(this[o],10)<=h&&(e&&(this[a]=!0),i.push(this))});break;case"adjacency":if(t){i.push(t);var u=r.p.treeReader.parent_id_field,p=r.p.localReader.id;$(this.p.data).each(function(t){for(n=i.length,t=0;t<n;t++)if($.jgrid.stripPref(r.p.idPrefix,i[t][p])===this[u]){e&&(this[a]=!0),i.push(this);break}})}}}),i},getNodeAncestors:function(t){var e=[];return this.each(function(){if(this.grid&&this.p.treeGrid)for(var i=$(this).jqGrid("getNodeParent",t);i;)e.push(i),i=$(this).jqGrid("getNodeParent",i)}),e},isVisibleNode:function(t){var e=!0;return this.each(function(){var i=this;if(i.grid&&i.p.treeGrid){var n=$(i).jqGrid("getNodeAncestors",t),r=i.p.treeReader.expanded_field;$(n).each(function(){if(e=e&&this[r],!e)return!1})}}),e},isNodeLoaded:function(t){var e;return this.each(function(){var i=this;if(i.grid&&i.p.treeGrid){var n=i.p.treeReader.leaf_field,r=i.p.treeReader.loaded;e=void 0!==t&&(void 0!==t[r]?t[r]:!!(t[n]||$(i).jqGrid("getNodeChildren",t).length>0))}}),e},reloadNode:function(t){return this.each(function(){if(this.grid&&this.p.treeGrid){var e=this.p.localReader.id,i=this.p.selrow;$(this).jqGrid("delChildren",t[e]);var n=this.p.treeReader.expanded_field,r=this.p.treeReader.parent_id_field,a=this.p.treeReader.loaded,o=this.p.treeReader.level_field,s=this.p.treeReader.left_field,l=this.p.treeReader.right_field,d=$.jgrid.getAccessor(t,this.p.localReader.id),h=$("#"+d,this.grid.bDiv)[0];t[n]=!0,$("div.treeclick",h).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus"),this.p.treeANode=h.rowIndex,this.p.datatype=this.p.treedatatype,"nested"===this.p.treeGridModel?$(this).jqGrid("setGridParam",{postData:{nodeid:d,n_left:t[s],n_right:t[l],n_level:t[o]}}):$(this).jqGrid("setGridParam",{postData:{nodeid:d,parentid:t[r],n_level:t[o]}}),$(this).trigger("reloadGrid"),t[a]=!0,"nested"===this.p.treeGridModel?$(this).jqGrid("setGridParam",{selrow:i,postData:{nodeid:"",n_left:"",n_right:"",n_level:""}}):$(this).jqGrid("setGridParam",{selrow:i,postData:{nodeid:"",parentid:"",n_level:""}})}})},expandNode:function(t){return this.each(function(){if(this.grid&&this.p.treeGrid){var e=this.p.treeReader.expanded_field,i=this.p.treeReader.parent_id_field,n=this.p.treeReader.loaded,r=this.p.treeReader.level_field,a=this.p.treeReader.left_field,o=this.p.treeReader.right_field;if(!t[e]){var s=$.jgrid.getAccessor(t,this.p.localReader.id),l=$("#"+this.p.idPrefix+$.jgrid.jqID(s),this.grid.bDiv)[0],d=this.p._index[s],h=!$.isFunction(this.p.beforeExpandTreeGridNode)||this.p.beforeExpandTreeGridNode.call(this,s,t);if(h===!1)return;$(this).jqGrid("isNodeLoaded",this.p.data[d])?(t[e]=!0,$("div.treeclick",l).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus")):this.grid.hDiv.loading||(t[e]=!0,$("div.treeclick",l).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus"),this.p.treeANode=l.rowIndex,this.p.datatype=this.p.treedatatype,"nested"===this.p.treeGridModel?$(this).jqGrid("setGridParam",{postData:{nodeid:s,n_left:t[a],n_right:t[o],n_level:t[r]}}):$(this).jqGrid("setGridParam",{postData:{nodeid:s,parentid:t[i],n_level:t[r]}}),$(this).trigger("reloadGrid"),t[n]=!0,"nested"===this.p.treeGridModel?$(this).jqGrid("setGridParam",{postData:{nodeid:"",n_left:"",n_right:"",n_level:""}}):$(this).jqGrid("setGridParam",{postData:{nodeid:"",parentid:"",n_level:""}})),$.isFunction(this.p.afterExpandTreeGridNode)&&this.p.afterExpandTreeGridNode.call(this,s,t)}}})},collapseNode:function(t){return this.each(function(){if(this.grid&&this.p.treeGrid){var e=this.p.treeReader.expanded_field;if(t[e]){var i=$.jgrid.getAccessor(t,this.p.localReader.id),n=!$.isFunction(this.p.beforeCollapseTreeGridNode)||this.p.beforeCollapseTreeGridNode.call(this,i,t),r=$("#"+this.p.idPrefix+$.jgrid.jqID(i),this.grid.bDiv)[0];if(t[e]=!1,n===!1)return;$("div.treeclick",r).removeClass(this.p.treeIcons.minus+" tree-minus").addClass(this.p.treeIcons.plus+" tree-plus"),$.isFunction(this.p.afterCollapseTreeGridNode)&&this.p.afterCollapseTreeGridNode.call(this,i,t)}}})},SortTree:function(t,e,i,n){return this.each(function(){if(this.grid&&this.p.treeGrid){var r,a,o,s,l,d=[],h=this,c=$(this).jqGrid("getRootNodes",h.p.search);for(s=$.jgrid.from.call(this,c),s.orderBy(t,e,i,n),l=s.select(),r=0,a=l.length;r<a;r++)o=l[r],d.push(o),$(this).jqGrid("collectChildrenSortTree",d,o,t,e,i,n);$.each(d,function(t){var e=$.jgrid.getAccessor(this,h.p.localReader.id);$("#"+$.jgrid.jqID(h.p.id)+" tbody tr:eq("+t+")").after($("tr#"+$.jgrid.jqID(e),h.grid.bDiv))}),s=null,l=null,d=null}})},searchTree:function(t){var e,i,n,r=t.length||0,a=[],o=[],s=[];return this.each(function(){if(this.grid&&this.p.treeGrid&&r)for(i=this.p.localReader.id,e=0;e<r;e++)a=$(this).jqGrid("getNodeAncestors",t[e]),a.length||a.push(t[e]),n=a[a.length-1][i],$.inArray(n,o)===-1&&(o.push(n),a=$(this).jqGrid("getFullTreeNode",a[a.length-1],!0),s=s.concat(a))}),s},collectChildrenSortTree:function(t,e,i,n,r,a){return this.each(function(){if(this.grid&&this.p.treeGrid){var o,s,l,d,h,c;for(d=$(this).jqGrid("getNodeChildren",e),h=$.jgrid.from.call(this,d),h.orderBy(i,n,r,a),c=h.select(),o=0,s=c.length;o<s;o++)l=c[o],t.push(l),$(this).jqGrid("collectChildrenSortTree",t,l,i,n,r,a)}})},setTreeRow:function(t,e){var i=!1;return this.each(function(){var n=this;n.grid&&n.p.treeGrid&&(i=$(n).jqGrid("setRowData",t,e))}),i},delTreeNode:function(t){return this.each(function(){var e,i,n,r,a,o=this,s=o.p.localReader.id,l=o.p.treeReader.left_field,d=o.p.treeReader.right_field;if(o.grid&&o.p.treeGrid){var h=o.p._index[t];if(void 0!==h){i=parseInt(o.p.data[h][d],10),n=i-parseInt(o.p.data[h][l],10)+1;var c=$(o).jqGrid("getFullTreeNode",o.p.data[h]);if(c.length>0)for(e=0;e<c.length;e++)$(o).jqGrid("delRowData",c[e][s]);if("nested"===o.p.treeGridModel){if(r=$.jgrid.from.call(o,o.p.data).greater(l,i,{stype:"integer"}).select(),r.length)for(a in r)r.hasOwnProperty(a)&&(r[a][l]=parseInt(r[a][l],10)-n);if(r=$.jgrid.from.call(o,o.p.data).greater(d,i,{stype:"integer"}).select(),r.length)for(a in r)r.hasOwnProperty(a)&&(r[a][d]=parseInt(r[a][d],10)-n)}}}})},delChildren:function(t){return this.each(function(){var e,i,n,r,a=this,o=a.p.localReader.id,s=a.p.treeReader.left_field,l=a.p.treeReader.right_field;if(a.grid&&a.p.treeGrid){var d=a.p._index[t];if(void 0!==d){e=parseInt(a.p.data[d][l],10),i=e-parseInt(a.p.data[d][s],10)+1;var h=$(a).jqGrid("getFullTreeNode",a.p.data[d]);if(h.length>0)for(var c=0;c<h.length;c++)h[c][o]!==t&&$(a).jqGrid("delRowData",h[c][o]);if("nested"===a.p.treeGridModel){if(n=$.jgrid.from(a.p.data).greater(s,e,{stype:"integer"}).select(),n.length)for(r in n)n.hasOwnProperty(r)&&(n[r][s]=parseInt(n[r][s],10)-i);if(n=$.jgrid.from(a.p.data).greater(l,e,{stype:"integer"}).select(),n.length)for(r in n)n.hasOwnProperty(r)&&(n[r][l]=parseInt(n[r][l],10)-i)}}}})},addChildNode:function(t,e,i,n){var r=this[0];if(i){var a,o,s,l,d,h,c,u,p=r.p.treeReader.expanded_field,f=r.p.treeReader.leaf_field,m=r.p.treeReader.level_field,g=r.p.treeReader.parent_id_field,_=r.p.treeReader.left_field,y=r.p.treeReader.right_field,v=r.p.treeReader.loaded,b=0,w=e;if(void 0===n&&(n=!1),null==t){if(d=r.p.data.length-1,d>=0)for(;d>=0;)b=Math.max(b,parseInt(r.p.data[d][r.p.localReader.id],10)),d--;t=b+1}var x=$(r).jqGrid("getInd",e);if(c=!1,void 0===e||null===e||""===e)e=null,w=null,a="last",l=r.p.tree_root_level,d=r.p.data.length+1;else{a="after",o=r.p._index[e],s=r.p.data[o],e=s[r.p.localReader.id],l=parseInt(s[m],10)+1;var k=$(r).jqGrid("getFullTreeNode",s);k.length?(d=k[k.length-1][r.p.localReader.id],w=d,d=$(r).jqGrid("getInd",w)+1):d=$(r).jqGrid("getInd",e)+1,s[f]&&(c=!0,s[p]=!0,$(r.rows[x]).find("span.cell-wrapperleaf").removeClass("cell-wrapperleaf").addClass("cell-wrapper").end().find("div.tree-leaf").removeClass(r.p.treeIcons.leaf+" tree-leaf").addClass(r.p.treeIcons.minus+" tree-minus"),r.p.data[o][f]=!1,s[v]=!0)}if(h=d+1,void 0===i[p]&&(i[p]=!1),void 0===i[v]&&(i[v]=!1),i[m]=l,void 0===i[f]&&(i[f]=!0),"adjacency"===r.p.treeGridModel&&(i[g]=e),"nested"===r.p.treeGridModel){var L,C,T;if(null!==e){if(u=parseInt(s[y],10),L=$.jgrid.from.call(r,r.p.data),L=L.greaterOrEquals(y,u,{stype:"integer"}),C=L.select(),C.length)for(T in C)C.hasOwnProperty(T)&&(C[T][_]=C[T][_]>u?parseInt(C[T][_],10)+2:C[T][_],C[T][y]=C[T][y]>=u?parseInt(C[T][y],10)+2:C[T][y]);i[_]=u,i[y]=u+1}else{if(u=parseInt($(r).jqGrid("getCol",y,!1,"max"),10),C=$.jgrid.from.call(r,r.p.data).greater(_,u,{stype:"integer"}).select(),C.length)for(T in C)C.hasOwnProperty(T)&&(C[T][_]=parseInt(C[T][_],10)+2);if(C=$.jgrid.from.call(r,r.p.data).greater(y,u,{stype:"integer"}).select(),C.length)for(T in C)C.hasOwnProperty(T)&&(C[T][y]=parseInt(C[T][y],10)+2);i[_]=u+1,i[y]=u+2}}(null===e||$(r).jqGrid("isNodeLoaded",s)||c)&&($(r).jqGrid("addRowData",t,i,a,w),$(r).jqGrid("setTreeNode",d,h)),s&&!s[p]&&n&&$(r.rows[x]).find("div.treeclick").click()}}}),$.fn.jqDrag=function(t){return i(this,t,"d")},$.fn.jqResize=function(t,e){return i(this,t,"r",e)},$.jqDnR={dnr:{},e:0,drag:function(t){return"d"==M.k?E.css({left:M.X+t.pageX-M.pX,top:M.Y+t.pageY-M.pY}):(E.css({width:Math.max(t.pageX-M.pX+M.W,0),height:Math.max(t.pageY-M.pY+M.H,0)}),M1&&E1.css({width:Math.max(t.pageX-M1.pX+M1.W,0),height:Math.max(t.pageY-M1.pY+M1.H,0)})),!1},stop:function(){$(document).unbind("mousemove",J.drag).unbind("mouseup",J.stop)}};var J=$.jqDnR,M=J.dnr,E=J.e,E1,M1,i=function(t,e,i,n){return t.each(function(){e=e?$(e,t):t,e.bind("mousedown",{e:t,k:i},function(t){var e=t.data,i={};if(E=e.e,E1=!!n&&$(n),"relative"!=E.css("position"))try{E.position(i)}catch(t){}if(M={X:i.left||f("left")||0,Y:i.top||f("top")||0,W:f("width")||E[0].scrollWidth||0,H:f("height")||E[0].scrollHeight||0,pX:t.pageX,pY:t.pageY,k:e.k},M1=!(!E1||"d"==e.k)&&{X:i.left||f1("left")||0,Y:i.top||f1("top")||0,W:E1[0].offsetWidth||f1("width")||0,H:E1[0].offsetHeight||f1("height")||0,pX:t.pageX,pY:t.pageY,k:e.k},$("input.hasDatepicker",E[0])[0])try{$("input.hasDatepicker",E[0]).datepicker("hide")}catch(t){}return!1})})},f=function(t){return parseInt(E.css(t),10)||!1},f1=function(t){return parseInt(E1.css(t),10)||!1};$.fn.jqm=function(t){var e={overlay:50,closeoverlay:!0,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:F,ajaxText:"",target:F,modal:F,toTop:F,onShow:F,onHide:F,onLoad:F};return this.each(function(){return this._jqm?H[this._jqm].c=$.extend({},H[this._jqm].c,t):(s++,this._jqm=s,H[s]={c:$.extend(e,$.jqm.params,t),a:F,w:$(this).addClass("jqmID"+s),s:s},void(e.trigger&&$(this).jqmAddTrigger(e.trigger)))})},$.fn.jqmAddClose=function(t){return hs(this,t,"jqmHide")},$.fn.jqmAddTrigger=function(t){return hs(this,t,"jqmShow")},$.fn.jqmShow=function(t){return this.each(function(){$.jqm.open(this._jqm,t)})},$.fn.jqmHide=function(t){return this.each(function(){$.jqm.close(this._jqm,t)})},$.jqm={hash:{},open:function(t,i){var n=H[t],r=n.c,a="."+r.closeClass,o=parseInt(n.w.css("z-index"));o=o>0?o:3e3;var s=$("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":o-1,opacity:r.overlay/100});if(n.a)return F;if(n.t=i,n.a=!0,n.w.css("z-index",o),r.modal?(A[0]||setTimeout(function(){new L("bind")},1),A.push(t)):r.overlay>0?r.closeoverlay&&n.w.jqmAddClose(s):s=F,n.o=s?s.addClass(r.overlayClass).prependTo("body"):F,r.ajax){var l=r.target||n.w,d=r.ajax;l="string"==typeof l?$(l,n.w):$(l),d="@"===d.substr(0,1)?$(i).attr(d.substring(1)):d,l.html(r.ajaxText).load(d,function(){r.onLoad&&r.onLoad.call(this,n),a&&n.w.jqmAddClose($(a,n.w)),e(n)})}else a&&n.w.jqmAddClose($(a,n.w));return r.toTop&&n.o&&n.w.before('<span id="jqmP'+n.w[0]._jqm+'"></span>').insertAfter(n.o),r.onShow?r.onShow(n):n.w.show(),e(n),F},close:function(t){var e=H[t];return e.a?(e.a=F,A[0]&&(A.pop(),A[0]||new L("unbind")),e.c.toTop&&e.o&&$("#jqmP"+e.w[0]._jqm).after(e.w).remove(),e.c.onHide?e.c.onHide(e):(e.w.hide(),e.o&&e.o.remove()),F):F},params:{}};var s=0,H=$.jqm.hash,A=[],F=!1,e=function(t){void 0===t.c.focusField&&(t.c.focusField=0),t.c.focusField>=0&&f(t)},f=function(t){try{$(":input:visible",t.w)[parseInt(t.c.focusField,10)].focus()}catch(t){}},L=function(t){$(document)[t]("keypress",m)[t]("keydown",m)[t]("mousedown",m)},m=function(t){var e=H[A[A.length-1]],i=!$(t.target).parents(".jqmID"+e.s)[0];return i&&($(".jqmID"+e.s).each(function(){var e=$(this),n=e.offset();if(n.top<=t.pageY&&t.pageY<=n.top+e.height()&&n.left<=t.pageX&&t.pageX<=n.left+e.width())return i=!1,!1}),f(e)),!i},hs=function(t,e,i){return t.each(function(){var t=this._jqm;$(e).each(function(){this[i]||(this[i]=[],$(this).click(function(){for(var t in{jqmShow:1,jqmHide:1})for(var e in this[t])H[this[t][e]]&&H[this[t][e]].w[t](this);return F})),this[i].push(t)})})};$.fmatter={},$.extend($.fmatter,{isBoolean:function(t){return"boolean"==typeof t},isObject:function(t){return t&&("object"==typeof t||$.isFunction(t))||!1},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t&&isFinite(t)},isValue:function(t){return this.isObject(t)||this.isString(t)||this.isNumber(t)||this.isBoolean(t)},isEmpty:function(t){return!(!this.isString(t)&&this.isValue(t))&&(!this.isValue(t)||(t=$.trim(t).replace(/\&nbsp\;/gi,"").replace(/\&#160\;/gi,""),""===t))}}),$.fn.fmatter=function(t,e,i,n,r){var a=e;i=$.extend({},$.jgrid.getRegional(this,"formatter"),i);try{a=$.fn.fmatter[t].call(this,e,i,n,r)}catch(t){}return a},$.fmatter.util={NumberFormat:function(t,e){if($.fmatter.isNumber(t)||(t*=1),$.fmatter.isNumber(t)){var i,n=t<0,r=String(t),a=e.decimalSeparator||".";if($.fmatter.isNumber(e.decimalPlaces)){var o=e.decimalPlaces,s=Math.pow(10,o);if(r=String(Math.round(t*s)/s),i=r.lastIndexOf("."),o>0)for(i<0?(r+=a,i=r.length-1):"."!==a&&(r=r.replace(".",a));r.length-1-i<o;)r+="0"}if(e.thousandsSeparator){var l=e.thousandsSeparator;i=r.lastIndexOf(a),i=i>-1?i:r.length;var d,h=r.substring(i),c=-1;for(d=i;d>0;d--)c++,c%3===0&&d!==i&&(!n||d>1)&&(h=l+h),h=r.charAt(d-1)+h;r=h}return r=e.prefix?e.prefix+r:r,r=e.suffix?r+e.suffix:r}return t}},$.fn.fmatter.defaultFormat=function(t,e){return $.fmatter.isValue(t)&&""!==t?t:e.defaultValue||"&#160;"},$.fn.fmatter.email=function(t,e){return $.fmatter.isEmpty(t)?$.fn.fmatter.defaultFormat(t,e):'<a href="mailto:'+t+'">'+t+"</a>"},$.fn.fmatter.checkbox=function(t,e){var i,n=$.extend({},e.checkbox);void 0!==e.colModel&&void 0!==e.colModel.formatoptions&&(n=$.extend({},n,e.colModel.formatoptions)),i=n.disabled===!0?'disabled="disabled"':"",($.fmatter.isEmpty(t)||void 0===t)&&(t=$.fn.fmatter.defaultFormat(t,n)),t=String(t),t=(t+"").toLowerCase();var r=t.search(/(false|f|0|no|n|off|undefined)/i)<0?" checked='checked' ":"";return'<input type="checkbox" '+r+' value="'+t+'" offval="no" '+i+"/>"},$.fn.fmatter.link=function(t,e){var i={target:e.target},n="";return void 0!==e.colModel&&void 0!==e.colModel.formatoptions&&(i=$.extend({},i,e.colModel.formatoptions)),i.target&&(n="target="+i.target),$.fmatter.isEmpty(t)?$.fn.fmatter.defaultFormat(t,e):"<a "+n+' href="'+t+'">'+t+"</a>"},$.fn.fmatter.showlink=function(t,e){var i,n={baseLinkUrl:e.baseLinkUrl,showAction:e.showAction,addParam:e.addParam||"",target:e.target,idName:e.idName},r="";return void 0!==e.colModel&&void 0!==e.colModel.formatoptions&&(n=$.extend({},n,e.colModel.formatoptions)),n.target&&(r="target="+n.target),i=n.baseLinkUrl+n.showAction+"?"+n.idName+"="+e.rowId+n.addParam,$.fmatter.isString(t)||$.fmatter.isNumber(t)?"<a "+r+' href="'+i+'">'+t+"</a>":$.fn.fmatter.defaultFormat(t,e)},$.fn.fmatter.integer=function(t,e){var i=$.extend({},e.integer);return void 0!==e.colModel&&void 0!==e.colModel.formatoptions&&(i=$.extend({},i,e.colModel.formatoptions)),$.fmatter.isEmpty(t)?i.defaultValue:$.fmatter.util.NumberFormat(t,i)},$.fn.fmatter.number=function(t,e){var i=$.extend({},e.number);return void 0!==e.colModel&&void 0!==e.colModel.formatoptions&&(i=$.extend({},i,e.colModel.formatoptions)),$.fmatter.isEmpty(t)?i.defaultValue:$.fmatter.util.NumberFormat(t,i)},$.fn.fmatter.currency=function(t,e){var i=$.extend({},e.currency);return void 0!==e.colModel&&void 0!==e.colModel.formatoptions&&(i=$.extend({},i,e.colModel.formatoptions)),$.fmatter.isEmpty(t)?i.defaultValue:$.fmatter.util.NumberFormat(t,i)},$.fn.fmatter.date=function(t,e,i,n){var r=$.extend({},e.date);return void 0!==e.colModel&&void 0!==e.colModel.formatoptions&&(r=$.extend({},r,e.colModel.formatoptions)),r.reformatAfterEdit||"edit"!==n?$.fmatter.isEmpty(t)?$.fn.fmatter.defaultFormat(t,e):$.jgrid.parseDate.call(this,r.srcformat,t,r.newformat,r):$.fn.fmatter.defaultFormat(t,e)},$.fn.fmatter.select=function(t,e){t=String(t);var i,n,r=!1,a=[];if(void 0!==e.colModel.formatoptions?(r=e.colModel.formatoptions.value,i=void 0===e.colModel.formatoptions.separator?":":e.colModel.formatoptions.separator,n=void 0===e.colModel.formatoptions.delimiter?";":e.colModel.formatoptions.delimiter):void 0!==e.colModel.editoptions&&(r=e.colModel.editoptions.value,i=void 0===e.colModel.editoptions.separator?":":e.colModel.editoptions.separator,n=void 0===e.colModel.editoptions.delimiter?";":e.colModel.editoptions.delimiter),r){var o,s=(null!=e.colModel.editoptions&&e.colModel.editoptions.multiple===!0)==!0,l=[];if(s&&(l=t.split(","),l=$.map(l,function(t){return $.trim(t)})),$.fmatter.isString(r)){var d,h=r.split(n),c=0;for(d=0;d<h.length;d++)if(o=h[d].split(i),o.length>2&&(o[1]=$.map(o,function(t,e){if(e>0)return t}).join(i)),s)$.inArray(o[0],l)>-1&&(a[c]=o[1],c++);else if($.trim(o[0])===$.trim(t)){a[0]=o[1];break}}else $.fmatter.isObject(r)&&(s?a=$.map(l,function(t){return r[t]}):a[0]=r[t]||"")}return t=a.join(", "),""===t?$.fn.fmatter.defaultFormat(t,e):t},$.fn.fmatter.rowactions=function(t){var e=$(this).closest("tr.jqgrow"),i=e.attr("id"),n=$(this).closest("table.ui-jqgrid-btable").attr("id").replace(/_frozen([^_]*)$/,"$1"),r=$("#"+n),a=r[0],o=a.p,s=o.colModel[$.jgrid.getCellIndex(this)],l=s.frozen?$("tr#"+i+" td:eq("+$.jgrid.getCellIndex(this)+") > div",r):$(this).parent(),d={extraparam:{}},h=function(t,e){$.isFunction(d.afterSave)&&d.afterSave.call(a,t,e),l.find("div.ui-inline-edit,div.ui-inline-del").show(),l.find("div.ui-inline-save,div.ui-inline-cancel").hide()},c=function(t){$.isFunction(d.afterRestore)&&d.afterRestore.call(a,t),l.find("div.ui-inline-edit,div.ui-inline-del").show(),l.find("div.ui-inline-save,div.ui-inline-cancel").hide()};void 0!==s.formatoptions&&(d=$.extend(d,s.formatoptions)),void 0!==o.editOptions&&(d.editOptions=o.editOptions),void 0!==o.delOptions&&(d.delOptions=o.delOptions),e.hasClass("jqgrid-new-row")&&(d.extraparam[o.prmNames.oper]=o.prmNames.addoper);var u={keys:d.keys,oneditfunc:d.onEdit,successfunc:d.onSuccess,url:d.url,extraparam:d.extraparam,aftersavefunc:h,errorfunc:d.onError,afterrestorefunc:c,restoreAfterError:d.restoreAfterError,mtype:d.mtype};switch(t){case"edit":r.jqGrid("editRow",i,u),l.find("div.ui-inline-edit,div.ui-inline-del").hide(),l.find("div.ui-inline-save,div.ui-inline-cancel").show(),r.triggerHandler("jqGridAfterGridComplete");break;case"save":r.jqGrid("saveRow",i,u)&&(l.find("div.ui-inline-edit,div.ui-inline-del").show(),l.find("div.ui-inline-save,div.ui-inline-cancel").hide(),r.triggerHandler("jqGridAfterGridComplete"));break;case"cancel":r.jqGrid("restoreRow",i,c),l.find("div.ui-inline-edit,div.ui-inline-del").show(),l.find("div.ui-inline-save,div.ui-inline-cancel").hide(),r.triggerHandler("jqGridAfterGridComplete");break;case"del":r.jqGrid("delGridRow",i,d.delOptions);
break;case"formedit":r.jqGrid("setSelection",i),r.jqGrid("editGridRow",i,d.editOptions)}},$.fn.fmatter.actions=function(t,e){var i,n={keys:!1,editbutton:!0,delbutton:!0,editformbutton:!1},r=e.rowId,a="",o=$.jgrid.getRegional(this,"nav"),s=$.jgrid.styleUI[e.styleUI||"jQueryUI"].fmatter,l=$.jgrid.styleUI[e.styleUI||"jQueryUI"].common;if(void 0!==e.colModel.formatoptions&&(n=$.extend(n,e.colModel.formatoptions)),void 0===r||$.fmatter.isEmpty(r))return"";var d="onmouseover=jQuery(this).addClass('"+l.hover+"'); onmouseout=jQuery(this).removeClass('"+l.hover+"');  ";return n.editformbutton?(i="id='jEditButton_"+r+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'formedit'); "+d,a+="<div title='"+o.edittitle+"' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' "+i+"><span class='"+l.icon_base+" "+s.icon_edit+"'></span></div>"):n.editbutton&&(i="id='jEditButton_"+r+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'edit'); "+d,a+="<div title='"+o.edittitle+"' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' "+i+"><span class='"+l.icon_base+" "+s.icon_edit+"'></span></div>"),n.delbutton&&(i="id='jDeleteButton_"+r+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'del'); "+d,a+="<div title='"+o.deltitle+"' style='float:left;' class='ui-pg-div ui-inline-del' "+i+"><span class='"+l.icon_base+" "+s.icon_del+"'></span></div>"),i="id='jSaveButton_"+r+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'save'); "+d,a+="<div title='"+o.savetitle+"' style='float:left;display:none' class='ui-pg-div ui-inline-save' "+i+"><span class='"+l.icon_base+" "+s.icon_save+"'></span></div>",i="id='jCancelButton_"+r+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'cancel'); "+d,a+="<div title='"+o.canceltitle+"' style='float:left;display:none;' class='ui-pg-div ui-inline-cancel' "+i+"><span class='"+l.icon_base+" "+s.icon_cancel+"'></span></div>","<div style='margin-left:8px;'>"+a+"</div>"},$.unformat=function(t,e,i,n){var r,a,o=e.colModel.formatter,s=e.colModel.formatoptions||{},l=/([\.\*\_\'\(\)\{\}\+\?\\])/g,d=e.colModel.unformat||$.fn.fmatter[o]&&$.fn.fmatter[o].unformat;if(void 0!==d&&$.isFunction(d))r=d.call(this,$(t).text(),e,t);else if(void 0!==o&&$.fmatter.isString(o)){var h,c=$.jgrid.getRegional(this,"formatter")||{};switch(o){case"integer":s=$.extend({},c.integer,s),a=s.thousandsSeparator.replace(l,"\\$1"),h=new RegExp(a,"g"),r=$(t).text().replace(h,"");break;case"number":s=$.extend({},c.number,s),a=s.thousandsSeparator.replace(l,"\\$1"),h=new RegExp(a,"g"),r=$(t).text().replace(h,"").replace(s.decimalSeparator,".");break;case"currency":s=$.extend({},c.currency,s),a=s.thousandsSeparator.replace(l,"\\$1"),h=new RegExp(a,"g"),r=$(t).text(),s.prefix&&s.prefix.length&&(r=r.substr(s.prefix.length)),s.suffix&&s.suffix.length&&(r=r.substr(0,r.length-s.suffix.length)),r=r.replace(h,"").replace(s.decimalSeparator,".");break;case"checkbox":var u=e.colModel.editoptions?e.colModel.editoptions.value.split(":"):["Yes","No"];r=$("input",t).is(":checked")?u[0]:u[1];break;case"select":r=$.unformat.select(t,e,i,n);break;case"actions":return"";default:r=$(t).text()}}return void 0!==r?r:n===!0?$(t).text():$.jgrid.htmlDecode($(t).html())},$.unformat.select=function(t,e,i,n){var r=[],a=$(t).text();if(n===!0)return a;var o=$.extend({},void 0!==e.colModel.formatoptions?e.colModel.formatoptions:e.colModel.editoptions),s=void 0===o.separator?":":o.separator,l=void 0===o.delimiter?";":o.delimiter;if(o.value){var d,h=o.value,c=o.multiple===!0,u=[];if(c&&(u=a.split(","),u=$.map(u,function(t){return $.trim(t)})),$.fmatter.isString(h)){var p,f=h.split(l),m=0;for(p=0;p<f.length;p++)if(d=f[p].split(s),d.length>2&&(d[1]=$.map(d,function(t,e){if(e>0)return t}).join(s)),c)$.inArray($.trim(d[1]),u)>-1&&(r[m]=d[0],m++);else if($.trim(d[1])===$.trim(a)){r[0]=d[0];break}}else($.fmatter.isObject(h)||$.isArray(h))&&(c||(u[0]=a),r=$.map(u,function(t){var e;if($.each(h,function(i,n){if(n===t)return e=i,!1}),void 0!==e)return e}));return r.join(", ")}return a||""},$.unformat.date=function(t,e){var i=$.jgrid.getRegional(this,"formatter.date")||{};return void 0!==e.formatoptions&&(i=$.extend({},i,e.formatoptions)),$.fmatter.isEmpty(t)?$.fn.fmatter.defaultFormat(t,e):$.jgrid.parseDate.call(this,i.newformat,t,i.srcformat,i)},window.jqGridUtils={stringify:function(t){return JSON.stringify(t,function(t,e){return"function"==typeof e?e.toString():e})},parse:function(str){return JSON.parse(str,function(key,value){return"string"==typeof value&&value.indexOf("function")!==-1?eval("("+value+")"):value})},encode:function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},jsonToXML:function(t,e){var i=$.extend({xmlDecl:'<?xml version="1.0" encoding="UTF-8" ?>\n',attr_prefix:"-",encode:!0},e||{}),n=this,r=function(t,e){return"#text"===t?i.encode?n.encode(e):e:"function"==typeof e?"<"+t+"><![CDATA["+e+"]]></"+t+">\n":""===e?"<"+t+">__EMPTY_STRING_</"+t+">\n":"<"+t+">"+(i.encode?n.encode(e):e)+"</"+t+">\n"},a=function(t,e){for(var i=[],n=0;n<e.length;n++){var s=e[n];"undefined"==typeof s||null==s?i[i.length]="<"+t+" />":"object"==typeof s&&s.constructor==Array?i[i.length]=a(t,s):"object"==typeof s?i[i.length]=o(t,s):i[i.length]=r(t,s)}return i.length||(i[0]="<"+t+">__EMPTY_ARRAY_</"+t+">\n"),i.join("")},o=function(t,e){var s=[],l=[];for(var d in e)if(e.hasOwnProperty(d)){var h=e[d];d.charAt(0)!==i.attr_prefix?null==h?s[s.length]="<"+d+" />":"object"==typeof h&&h.constructor===Array?s[s.length]=a(d,h):"object"==typeof h?s[s.length]=o(d,h):s[s.length]=r(d,h):l[l.length]=" "+d.substring(1)+'="'+(i.encode?n.encode(h):h)+'"'}var c=l.join(""),u=s.join("");return null==t||(u=s.length>0?u.match(/\n/)?"<"+t+c+">\n"+u+"</"+t+">\n":"<"+t+c+">"+u+"</"+t+">\n":"<"+t+c+" />\n"),u},s=o(null,t);return i.xmlDecl+s},xmlToJSON:function(root,options){var o=$.extend({force_array:[],attr_prefix:"-"},options||{});if(root){var __force_array={};if(o.force_array)for(var i=0;i<o.force_array.length;i++)__force_array[o.force_array[i]]=1;"string"==typeof root&&(root=$.parseXML(root)),root.documentElement&&(root=root.documentElement);var addNode=function(hash,key,cnts,val){if("string"==typeof val)if(val.indexOf("function")!==-1)val=eval("("+val+")");else switch(val){case"__EMPTY_ARRAY_":val=[];break;case"__EMPTY_STRING_":val="";break;case"false":val=!1;break;case"true":val=!0}__force_array[key]?(1===cnts&&(hash[key]=[]),hash[key][hash[key].length]=val):1===cnts?hash[key]=val:2===cnts?hash[key]=[hash[key],val]:hash[key][hash[key].length]=val},parseElement=function(t){if(7!==t.nodeType){if(3===t.nodeType||4===t.nodeType){var e=t.nodeValue.match(/[^\x00-\x20]/);if(null==e)return;return t.nodeValue}var i,n,r,a,s={};if(t.attributes&&t.attributes.length)for(i={},n=0;n<t.attributes.length;n++)r=t.attributes[n].nodeName,"string"==typeof r&&(a=t.attributes[n].nodeValue,a&&(r=o.attr_prefix+r,"undefined"==typeof s[r]&&(s[r]=0),s[r]++,addNode(i,r,s[r],a)));if(t.childNodes&&t.childNodes.length){var l=!0;for(i&&(l=!1),n=0;n<t.childNodes.length&&l;n++){var d=t.childNodes[n].nodeType;3!==d&&4!==d&&(l=!1)}if(l)for(i||(i=""),n=0;n<t.childNodes.length;n++)i+=t.childNodes[n].nodeValue;else for(i||(i={}),n=0;n<t.childNodes.length;n++)r=t.childNodes[n].nodeName,"string"==typeof r&&(a=parseElement(t.childNodes[n]),a&&("undefined"==typeof s[r]&&(s[r]=0),s[r]++,addNode(i,r,s[r],a)))}return i}},json=parseElement(root);if(__force_array[root.nodeName]&&(json=[json]),11!==root.nodeType){var tmp={};tmp[root.nodeName]=json,json=tmp}return json}}}}),function(t){"use strict";t.jgrid.extend({addColumn:function(e){var i,n,r=e.cm,a=e.insertWithColumnIndex,o=e.data;if(null!=r)return i="string"===r.template?null!=t.jgrid.cmTemplate&&"object"==typeof t.jgrid.cmTemplate[r.template]?t.jgrid.cmTemplate[r.template]:{}:r.template,this.each(function(){var s,l,d,h,c,u,p,f,m,g,_,y,v,b,w,x=t(this),k=this,L=this.grid,C=this.p,T=C.colModel,$=C.idPrefix,M="_id_",P="ltr"===C.direction?t(L.hDiv).find(">.ui-jqgrid-hbox>table.ui-jqgrid-htable"):t(L.hDiv).find(">.ui-jqgrid-hbox-rtl>table.ui-jqgrid-htable"),D="ltr"===C.direction?t(L.sDiv).find(">.ui-jqgrid-hbox>table.ui-jqgrid-ftable tr.footrow"):t(L.sDiv).find(">.ui-jqgrid-hbox-rtl>table.ui-jqgrid-ftable tr.footrow"),S=(C.multiselect===!0?1:0)+(C.subGrid===!0?1:0)+(C.rownumbers===!0?1:0),I=function(){var e,i=t(this),n=i.outerWidth(!1),r=3;if(i=i.closest("div"),i.width(n),n=i.outerWidth(!1),i=i.closest("div.ui-jqgrid-bdiv"),i.width(n),i.height()>i.find(">div").height()&&i.find(">div").height()>0)do n+=1,r-=1,i.width(n);while(i.height()>i.find(">div").height()&&r>0);e=i.closest("div.ui-jqgrid-view"),e.find(">.ui-jqgrid-hdiv").width(n),e.find(">.ui-jqgrid-toppager").width(n),n=i.outerWidth(!1),i=e,i.width(n),e=i.closest("div.ui-jqgrid"),e.find(">.ui-jqgrid-pager").width(n),e.width(i.outerWidth(!1))},E=function(){return k.triggerToolbar(),!1},U=function(t){var e=t.charCode||t.keyCode||0;if(13===e)return k.triggerToolbar(),!1},O=function(t){var e=t.which;switch(e){case 13:return!1;case 9:case 16:case 37:case 38:case 39:case 40:case 27:break;default:w&&clearTimeout(w),w=setTimeout(function(){k.triggerToolbar()},500)}};for(x.triggerHandler("jqGridBeforeAddColumn",[e]),r=t.extend(!0,{},C.cmTemplate,i||{},r),n=t.extend({},r.searchoptions||{}),void 0===r.index&&(r.index=r.name),"boolean"!=typeof r.sortable&&(r.sortable=!0),"boolean"!=typeof r.title&&(r.title=!0),void 0===r.resizable&&(r.resizable=!0),void 0===r.hidden&&(r.hidden=!1),r.width=void 0===r.width?150:parseInt(r.width,10),r.widthOrg=r.width,r.lso="",void 0===a&&C.treeGrid!==!0?(a=T.length-1-S,T.push(r),C.colNames.push(r.label||r.name)):(void 0===a&&(a=T.length-6-S),T.splice(a+S,0,r),C.colNames.splice(a+S,0,r.label||r.name)),l=P[0].rows,s=0;s<l.length;s++)d=t(l[s]),d.hasClass("ui-jqgrid-labels")?(v=L.headers[L.headers.length-1].el,h=t(v).clone(!0),h.attr("id",C.id+"_"+r.name),h.css("display",r.hidden===!0?"none":""),h.html('<span class="ui-jqgrid-resize ui-jqgrid-resize-'+C.direction+'" style="cursor: col-resize;">&nbsp;</span><div class="ui-th-div-ie ui-jqgrid-sortable" id="jqgh_'+C.id+"_"+r.name+'">'+(r.label||r.name)+'<span class="s-ico" style="display: none;"><span class="ui-grid-ico-sort ui-icon-asc ui-state-disabled ui-icon ui-icon-triangle-1-n ui-sort-'+C.direction+'" sort="asc"></span><span class="ui-grid-ico-sort ui-icon-desc ui-state-disabled ui-icon ui-icon-triangle-1-s ui-sort-'+C.direction+'" sort="desc"></span></span></div>'),h.css("width",r.width+"px"),a===T.length-1?L.headers.push({el:h[0],width:r.width,widthOrg:r.width}):L.headers.splice(a+S,0,{el:h[0],width:r.width,widthOrg:r.width})):d.hasClass("ui-search-toolbar")&&(h=t('<th class="ui-state-default ui-th-column ui-th-'+C.direction+'" role="columnheader"><div style="height: 100%; padding-right: 0.3em; padding-left: 0.3em; position: relative;"><table class="ui-search-table" cellspacing="0"><tbody><tr><td class="ui-search-oper" style="display: none;" colindex="'+a+'"></td><td class="ui-search-input"></td><td class="ui-search-clear"'+(void 0===n.clearSearch||n.clearSearch?"":' style="display:none;"')+'><a title="'+(t.jgrid.search.resetTitle||"Clear Search Value")+'" class="clearsearchclass" style="padding-right: 0.3em; padding-left: 0.3em;">'+(t.jgrid.search.resetIcon||"x")+"</a></td></tr></tbody></table></div></th>"),b=t.jgrid.createEl.call(this,r.stype||"text",r.searchoptions||{},"",!0,C.ajaxSelectOptions||{},!0),t(b).attr("id","gs_"+r.name).attr("name",r.label||r.name).attr("value",void 0!==n.defaultValue?n.defaultValue:"").css({padding:0,width:"100%"}).appendTo(h.find(".ui-search-input")),r.hidden===!0&&h.css("display","none"),e.autosearch!==!1&&("select"===r.stype?t(b).change(E):"text"!==r.stype&&void 0!==r.stype||(e.searchOnEnter||void 0===e.searchOnEnter?t(b).keypress(U):t(b).keydown(O)))),a===T.length-1?h.appendTo(l[s]):a+S>=1?h.insertAfter(l[s].cells[a+S-1]):h.insertBefore(l[s].cells[a+S]);for(l=this.rows,s=0;s<l.length;s++){if(d=t(l[s]),d.hasClass("jqgrow")||d.hasClass("jqfoot"))u=d.attr("id"),p=t.jgrid.stripPref($,u),m=a+S,g={},"local"===C.datatype||"jsonstring"===C.datatype||C.treeGrid===!0?(g=x.jqGrid("getLocalRow",u),(C.treeGrid===!0||C.loadonce===!0&&"local"===C.datatype)&&(g[M]=p),null==g||void 0===o[p]||d.hasClass("jqfoot")||(g[r.name]=o[p])):g=x.jqGrid("getRowData",u),_=g,f=d.hasClass("jqfoot")?"":this.formatter(u,void 0===o[p]?"":o[p],m,g,"add"),y=this.formatCol(m,s,f,g,u,_),c=t('<td role="gridcell" aria-describedby="list_total" '+y+">"+f+"</td>");else if(d.hasClass("jqgfirstrow"))c=t('<td role="gridcell" style="width: '+r.width+'px; height: 0px;"></td>');else if(d.hasClass("jqgroup")||d.hasClass("ui-subgrid")){c=d.find(">td[colspan]"),c.attr("colspan",parseInt(c.attr("colspan"),10)+1);continue}a===T.length-1?c.appendTo(d):a+S>=1?c.insertAfter(l[s].cells[a+S-1]):c.insertBefore(l[s].cells[a+S])}if(D.length>0)for(m=a+S,g=x.jqGrid("footerData","get",e.footerData,e.formatFooter),g[r.name]=e.footerData,f=e.formatFooter?this.formatter("",void 0===e.footerData?"":e.footerData,m,g,"add"):e.footerData,s=0;s<D.length;s++)m=a+S,c=t("<td role='gridcell' "+this.formatCol(m,0,"",null,"",!1)+">"+(f||"&#160;")+"</td>"),a===T.length-1?c.appendTo(D[s]):a+S>=1?c.insertAfter(D[s].cells[a+S-1]):c.insertBefore(D[s].cells[a+S]);e.adjustGridWidth!==!1&&C.frozenColumns!==!0&&(x.jqGrid("setGridWidth",C.width+c.outerWidth(),!1),I.call(this)),t("#searchmodfbox_"+t.jgrid.jqID(C.id)+",#editmod"+t.jgrid.jqID(C.id)+",#viewmod"+t.jgrid.jqID(C.id)+",#delmod"+t.jgrid.jqID(C.id)).remove(),x.triggerHandler("jqGridAfterAddColumn",[e])})}})}(jQuery);var MapUtils=window.MapUtils=MapUtils||{};$(function(){MapUtils.convertStr2Point=function(t){if(""!=t){var e=t.split(",")[0],i=t.split(",")[1];return new BMap.Point(e,i)}},MapUtils.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},MapUtils.convertPath2Str=function(t){if(""!=t){for(var e=[],i=0;i<t.length;i++){var n=t[i].lng,r=t[i].lat;e.push(n+","+r)}return e.join(";")}},MapUtils.accAdd=function(t,e){var i,n,r,a;try{i=t.toString().split(".")[1].length}catch(t){i=0}try{n=e.toString().split(".")[1].length}catch(t){n=0}if(a=Math.abs(i-n),r=Math.pow(10,Math.max(i,n)),a>0){var o=Math.pow(10,a);i>n?(t=Number(t.toString().replace(".","")),e=Number(e.toString().replace(".",""))*o):(t=Number(t.toString().replace(".",""))*o,e=Number(e.toString().replace(".","")))}else t=Number(t.toString().replace(".","")),e=Number(e.toString().replace(".",""));return(t+e)/r},MapUtils.addSub=function(t,e){var i,n,r,a;try{i=t.toString().split(".")[1].length}catch(t){i=0}try{n=e.toString().split(".")[1].length}catch(t){n=0}return r=Math.pow(10,Math.max(i,n)),a=i>=n?i:n,((t*r-e*r)/r).toFixed(a)},MapUtils.convertStr2Path=function(t){if(""!=t&&null!=t){var e=[];if(t.indexOf("|")>-1){for(var i=t.split("|"),n=0;n<i.length;n++)e.push(MapUtils.convertStr2Path(i[n]));return e}for(var r=t.split(";"),a=0;a<r.length;a++)e.push(new L.LatLng(r[a].split(",")[0],r[a].split(",")[1]));return e}},MapUtils.convertStr2LeafletPath=function(t){if(""!=t&&null!=t){var e=[];if(t.indexOf("|")>-1){for(var i=t.split("|"),n=0;n<i.length;n++)e.push(MapUtils.convertStr2LeafletPath(i[n]));return e}for(var r=t.split(";"),a=0;a<r.length;a++)e.push(new L.LatLng(r[a].split(",")[1],r[a].split(",")[0]));return e}},MapUtils.path2CenterRadius=function(t){t=MapUtils.decodePath(t),t=MapUtils.convertStr2LeafletPath(t);var e=new L.LatLngBounds(t),i=e.getCenter(),n=MapUtils.map.distance(i,new L.LatLng(e.getCenter().lat,e.getNorthEast().lng));return{center:i,radius:n}},MapUtils.region_layer_div=function(t){return"<div data-region-title='"+t.uniform_title+"' class='layer dt-pos-r' data-layer-label='"+t.label_config.field+"' id='region_layer_"+t.id+"' layer-id='"+t.id+"' layer-type='region_layer'><div class='layer-hover dt-pos-a dt-h100 dt-pos-t0 rlayer'></div><div class='dt-h30'><span data-toggle='tooltip' data-placement='bottom' data-container='body' class='rglayer display_layer glyphicon glyphicon-eye-open pull-left dt-mar6r dt-mar8t' layer-id="+t.id+" aria-hidden='true' title='\u9690\u85cf/\u663e\u793a\u6807\u9898'></span><div id='layer_title_"+t.id+"' class='dt-w140 pull-left dt-truncate layer_title dt-mar6t' layer-id='"+t.id+"' >"+t.title+"</div><div class='layer_action dt-mar8t'><span class='dt-pointer dt-mar6r pull-right' id='"+t.id+"_panel'><span data-toggle='tooltip' data-placement='bottom' data-container='body' region_layer_id='"+t.id+"' class='glyphicon glyphicon-globe dt-super colora1 edit_region_layer_style' title='\u6837\u5f0f\u8bbe\u7f6e'></span><span data-toggle='tooltip' data-placement='bottom' data-container='body' id='regionDataList_"+t.id+"' class='glyphicon glyphicon-th-list dt-super colora1 dt-mar6l data-region-list' title='\u67e5\u770b\u6570\u636e\u89c6\u56fe'></span><span data-toggle='tooltip' data-placement='bottom' data-container='body' class='glyphicon glyphicon-option-vertical more-icon dt-super colora1 dt-mar6l dt-region-layer' id='layer_panel_"+t.id+"' layer-id='"+t.id+"' title='\u66f4\u591a\u8bbe\u7f6e''></span></span></div></div><ul class='list-unstyled  dt-pad12x dt-pad12y'>"+MapUtils.load_region_btn_html(t.id)+"</ul></div>"},MapUtils.load_region_btn_html=function(t){var e="<a id='load_region_btn_"+t+"' class='load_region' region_layer_id='"+t+"' href='javascript:void(0);''><span class='glyphicon glyphicon-upload'></span>\u5bfc\u5165\u533a\u57df\u6570\u636e</a>";return e+="<a id='add_district_"+t+"' class='load_district dt-mar12l' region_layer_id='"+t+"' href='###'><span class='iconfont dt-middle dt-mar4r'>&#xe7b0;</span>\u884c\u653f\u533a\u5212\u8f7d\u5165</a>"},MapUtils.load_line_btn_html=function(t){return"<a id='load_line_btn_"+t+"' class='load_line' line_layer_id='"+t+"' href='javascript:void(0);''><span class='glyphicon glyphicon-upload'></span>\u5bfc\u5165\u7ebf\u8def\u6570\u636e</a>"},MapUtils.line_layer_div=function(t){return"<div data-line-title='"+t.uniform_title+"' class='layer dt-pos-r' layer-id='"+t.id+"' id='line_layer_"+t.id+"' data-layer-label='"+t.label_config.field+"' layer-type='line_layer'><div class='layer-hover dt-pos-a dt-h100 dt-pos-t0 llayer'></div><div class='dt-h30'><span data-toggle='tooltip' data-placement='bottom' data-container='body' class='lelayer display_layer glyphicon glyphicon-eye-open pull-left dt-mar6r dt-mar8t' layer-id='"+t.id+"' aria-hidden='true' title='\u9690\u85cf/\u663e\u793a\u6807\u9898'></span><div id='layer_title_"+t.id+"' class='dt-w140 pull-left dt-truncate layer_title dt-mar6t' layer-id='"+t.id+"'>"+t.title+"</div><div class='layer_action dt-mar8t'><span class='dt-pointer dt-mar6r pull-right'id='"+t.id+"_panel'><span data-toggle='tooltip' data-placement='bottom' data-container='body' line_layer_id='"+t.id+"' class='glyphicon glyphicon-globe  dt-super colora1 edit_line_layer_style' title='\u6837\u5f0f\u8bbe\u7f6e'></span><span data-toggle='tooltip' data-placement='bottom' data-container='body' id='lineDataList_"+t.id+"' class='glyphicon glyphicon-th-list dt-super colora1 dt-mar6l data-line-list' title='\u67e5\u770b\u6570\u636e\u89c6\u56fe'></span><span data-toggle='tooltip' data-placement='bottom' data-container='body' class='glyphicon glyphicon-option-vertical more-icon dt-super colora1 dt-mar6l dt-line-layer' id='layer_panel_"+t.id+"' layer-id='"+t.id+"' title='\u66f4\u591a\u8bbe\u7f6e'></span></span></div></div><ul class='list-unstyled dt-pad12x dt-pad12y'>"+MapUtils.load_line_btn_html(t.id)+"</ul></div>"},MapUtils.region_div=function(t){var e="";e+="<li id='li_region_id_"+t.id+"' class='dt-truncate select_region' region-id='"+t.id+"'>";var i=14,n=20,r=0,a=" dt-mar5 ";1==t.region_type&&(i=14,n=14,r=7,a=" dt-mar5y dt-mar8x "),e+="<div id='regionStyle_"+t.id+"' class='"+a+" pull-left select_region' region-id='"+t.id+"' style='height: "+i+"px;width: "+n+"px;border:1px solid #ff0000;background-color:rgba(255, 0, 0, 0.2);border-radius:"+r+"px;'>",e+="</div>";var o="";if(null!=t.region_attrs)for(var s=0;s<t.region_attrs.length;s++){var l=t.region_attrs[s];null!=l&&l.key==t.uniform_title&&(o=l.value||"")}return e+="<span id='setRegionTitle_"+t.id+"' class='dt-line-24h region-title select_region' region-id='"+t.id+"'>"+window.spacePrefix+o+"</span>",t.imgs&&t.imgs.length>0&&(e+='<span class="glyphicon glyphicon-picture pull-right dt-line-18h" id="region_img_'+t.id+'" ></span>'),e+="</li>"},MapUtils.update_line_div=function(t){$("#setLineTitle_"+t.feature_id).text(t.title);var e=$("#li_line_id_"+t.feature_id+" .direction-info");e.find("p").empty(),e.find("ul").empty(),e.find("p").append("\u5171"+(t.line_route.way_points.length+2)+'\u4e2a\u70b9<span class="dt-mar12l dt-f12">'+(t.line_route.distance/1e3).toFixed(2)+"\u516c\u91cc</span>");var i="<li>";i+='<div class="direction-start-panel pull-left">\u8d77</div><span class="pull-left dt-mar12l dt-mar2t dt-truncate dt-w168">'+t.line_route.origin_point.name+"</span>",i+="</li>";for(var n=0;n<t.line_route.way_points.length;n++)i+='<li class="dt-mar8t">',i+='<div class="join-line"></div>',i+='<div class="direction-path-panel pull-left">'+(n+1)+'</div><span class="pull-left dt-mar12l dt-mar2t dt-truncate dt-w168">'+t.line_route.way_points[n].name+"</span>",i+="</li>";i+='<li class="dt-mar8t">',i+='<div class="join-line"></div>',i+='<div class="direction-end-panel pull-left">\u7ec8</div><span class="pull-left dt-mar12l dt-mar2t dt-truncate dt-w168">'+t.line_route.destination_point.name+"</span>",i+="</li>",e.find("ul").append(i)},MapUtils.line_div=function(t){var e="";if(null!=t.line_attrs)for(var i=0;i<t.line_attrs.length;i++)null!=t.line_attrs[i]&&t.line_attrs[i].key==t.uniform_title&&(e=t.line_attrs[i].value||"");var n="";if(n+="<li id='li_line_id_"+t.id+"' class='dt-truncate select_line' line-id='"+t.id+"'>",t.line_route){n+='<span class="glyphicon glyphicon-road dt-mar5" style="color:'+t.line_style.strokeColor+';"></span>',n+='<span id="setLineTitle_'+t.id+'" line-id="'+t.id+'" class="select_line line-title dt-line-24h">'+t.title+"</span>",t.imgs&&t.imgs.length>0&&(n+='<span class="glyphicon glyphicon-picture pull-right dt-line-18h" id="line_img_'+t.id+'" ></span>'),n+='<div class="direction-info">',n+='<p class="dt-mar22l dt-f12">\u5171'+(t.line_route.way_points.length+2)+'\u4e2a\u70b9<span class="dt-mar12l dt-f12">'+(t.line_route.distance/1e3).toFixed(2)+"\u516c\u91cc</span></p>",n+='<ul class="dt-mar8t direction-way-point-info">',n+="<li>",n+='<div class="direction-start-panel pull-left">\u8d77</div><span class="pull-left dt-mar12l dt-mar2t dt-truncate dt-w168">'+t.line_route.origin_point.name+"</span>",n+="</li>";for(var r=0;r<t.line_route.way_points.length;r++)n+='<li class="dt-mar8t">',n+='<div class="join-line"></div>',n+='<div class="direction-path-panel pull-left">'+(r+1)+'</div><span class="pull-left dt-mar12l dt-mar2t dt-truncate dt-w168">'+t.line_route.way_points[r].name+"</span>",n+="</li>";n+='<li class="dt-mar8t">',n+='<div class="join-line"></div>',n+='<div class="direction-end-panel pull-left">\u7ec8</div><span class="pull-left dt-mar12l dt-mar2t dt-truncate dt-w168">'+t.line_route.destination_point.name+"</span>",n+="</li>",n+="</ul>",n+="</div>"}else n+="<div id='lineStyle_"+t.id+"' class='dt-mar5 pull-left select_line' line-id='"+t.id+"' style='height: 14px;border:4px solid #ff0000;'>",n+="</div>",n+="<span id='setLineTitle_"+t.id+"' class='dt-line-24h line-title select_line' line-id='"+t.id+"'>"+window.spacePrefix+e+"</span>",t.imgs&&t.imgs.length>0&&(n+='<span class="glyphicon glyphicon-picture pull-right dt-line-18h" id="line_img_'+t.id+'" ></span>');return n+="</li>"},MapUtils.add_upload_file=function(t){var e="<a href='javascript:void(0);'  layer-id="+t+" id='upload_data_"+t+"' class='upload_file'><span class='glyphicon glyphicon-upload' ></span>\u6279\u91cf\u6dfb\u52a0\u6570\u636e</a>";return e},MapUtils.heatmap_div=function(t){var e=t.heatmap_config,i="";i+="hide"==t.display||2!=t.render_style?"<div id='heatmap_layer_contain_"+t.id+"' class='dt-pad12x dt-pad12y dt-truncate dt-none'>":"<div id='heatmap_layer_contain_"+t.id+"' class='dt-pad12x dt-pad12y dt-truncate'>";var n="background: ",r=MapUtils.isIE();switch(e.gradient){case"one":r?n+="-ms-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%);":(n+="-webkit-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%);",n+="-moz-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%);");break;case"two":r?n+="-ms-linear-gradient(left, blue 50%,red 80%,white 95%);":(n+="-webkit-linear-gradient(left, blue 50%,red 80%,white 95%);",n+="-moz-linear-gradient(left, blue 50%,red 80%,white 95%);");break;case"three":r?n+="-ms-linear-gradient(left, rgb(26,150,65) 45%,rgb(166,217,106) 55%,rgb(255,255,191) 65%,rgb(253,174,97) 95%,rgb(215,25,28) 100%);":(n+="-webkit-linear-gradient(left, rgb(26,150,65) 45%,rgb(166,217,106) 55%,rgb(255,255,191) 65%,rgb(253,174,97) 95%,rgb(215,25,28) 100%);",n+="-moz-linear-gradient(left, rgb(26,150,65) 45%,rgb(166,217,106) 55%,rgb(255,255,191) 65%,rgb(253,174,97) 95%,rgb(215,25,28) 100%);");break;case"four":r?n+="-ms-linear-gradient(left, rgb(26,150,65) 10%,rgb(180,245,185) 20%,rgb(224,239,152) 30%,rgb(160,213,103) 40%,rgb(44,104,50) 50%,rgb(29,135,59) 60%,rgb(118,154,49)70%, rgb(204,175,27) 80%, rgb(198,63,2) 90%);":(n+="-webkit-linear-gradient(left, rgb(26,150,65) 10%,rgb(180,245,185) 20%,rgb(224,239,152) 30%,rgb(160,213,103) 40%,rgb(44,104,50) 50%,rgb(29,135,59) 60%,rgb(118,154,49)70%, rgb(204,175,27) 80%, rgb(198,63,2) 90%);",n+="-moz-linear-gradient(left, rgb(26,150,65) 10%,rgb(180,245,185) 20%,rgb(224,239,152) 30%,rgb(160,213,103) 40%,rgb(44,104,50) 50%,rgb(29,135,59) 60%,rgb(118,154,49)70%, rgb(204,175,27) 80%, rgb(198,63,2) 90%);");break;default:r?n+="-ms-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%);":(n+="-webkit-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%);",n+="-moz-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%);")}return i+="<div id='heatmap_style_"+t.id+"' class='dt-mar5 pull-left' style='height: 14px;width: 20px;"+n+"'>",i+="</div></div>"},MapUtils.ajax2server=function(t,e,i,n,r){$("#operate-status").text().indexOf("\u6570\u636e\u88c5\u8f7d\u4e2d")==-1&&$("#operate-status").text("\u6b63\u5728\u4fdd\u5b58..."),$(".map-refresh").addClass("rotate").removeClass("dt-none"),$.ajax({url:t,data:i,type:e,dataType:"json",cache:!1,success:function(t){$("#operate-status").text().indexOf("\u6570\u636e\u88c5\u8f7d\u4e2d")==-1&&MapUtils.operatingNotice(t.msg,{expire:1e3}),null!=n&&n(t);var e=setInterval(function(){$("#operate-status").text().indexOf("\u6570\u636e\u88c5\u8f7d")==-1&&$("#operate-status").text(""),clearInterval(e)},1e3)},error:function(t,e,i){null!=r&&r(t,e,i);var n="\u53d1\u751f\u9519\u8bef\uff0c\u518d\u6765\u4e00\u6b21";t.responseJSON&&t.responseJSON.error?n=t.responseJSON.error:t.responseJSON&&t.responseJSON.msg&&(n=t.responseJSON.msg),MapUtils.operatingNotice(n,{warning:!0,expire:3e3})}})},MapUtils.operatingNotice=function(t,e){if($("#operate-status").text(t),e&&e.loading?$(".map-refresh").addClass("rotate").removeClass("dt-none"):$(".map-refresh").removeClass("rotate").addClass("dt-none"),e&&e.warning?$("#operate-status").css("background-color","#d9534f"):t&&t.length>0?$("#operate-status").css("background-color","#3aaBC8"):$("#operate-status").css("background-color",""),e&&e.expire){var i=parseInt(e.expire);isNaN(i)||(MapUtils.operatingNoticeTimer&&window.clearTimeout(MapUtils.operatingNoticeTimer),MapUtils.operatingNoticeTimer=window.setTimeout(function(){$(".map-refresh").removeClass("rotate").addClass("dt-none"),$("#operate-status").text("").css("background-color","")},i))}},MapUtils.uploadImgStyle=function(t){var e=t.snapshot;e.indexOf(oss_host)<0&&(e=oss_host+t.snapshot);var i="";return i+="<li id='my_img_"+t.id+"'>",i+="<div>",i+="<img class='selected_feature_img' img_id='"+t.id+"' src='"+e+"' width='80' height='80'>",i+="<div title='\u89e3\u9664\u7ed1\u5b9a' img_id='"+t.id+"' class='img_del dt-pointer img-unbind'></div>",i+="</div>",i+="</li>"},MapUtils.myImgs=function(t,e){var i="";return e?(i+="<div class='net-img'><img class='single_img active' img_id='"+t.id+"' src='"+oss_host+t.snapshot+"' width='100%'>",i+="<div title='\u5df2\u7ecf\u7ed1\u5b9a' class='selected-img'></div>"):i+="<div class='net-img'><img class='single_img' img_id='"+t.id+"' src='"+oss_host+t.snapshot+"' width='100%'>",i+="<img title='\u5220\u9664\u56fe\u7247' img_id='"+t.id+"' class='img_del dt-pointer dt-none'></div>"},MapUtils.setMarkerTitle=function(t){if(null!=t.marker_attrs)for(var e=0;e<t.marker_attrs.length;e++){var i=t.marker_attrs[e];if(null!=i&&i.key==t.uniform_title){$("#setMarkerTitle_"+t.id).text(i.value&&i.value.toString()||"");break}}},MapUtils.setRegionTitle=function(t){if(null!=t.region_attrs)for(var e=0;e<t.region_attrs.length;e++){var i=t.region_attrs[e];if(null!=i&&i.key==t.uniform_title){$("#setRegionTitle_"+t.id).text(i.value&&i.value.toString()||"");break}}},MapUtils.setLineTitle=function(t){if(null!=t.line_attrs)for(var e=0;e<t.line_attrs.length;e++){var i=t.line_attrs[e];if(i&&i.key==t.uniform_title){$("#setLineTitle_"+t.id).text(i.value&&i.value.toString()||"");break}}},MapUtils.refactorRegionJSON=function(t,e){for(var i=0;i<t.region_attrs.length;i++)t.region_attrs[i]&&(t.region_attrs[i].key=e.attrs[i]);return t.label_field=e.label_config.field,t.label_style_type=e.label_config.style_type,t},MapUtils.refactorLineJSON=function(t,e){for(var i=0;i<t.line_attrs.length;i++)t.line_attrs[i]&&t&&(t.line_attrs[i].key=e.attrs[i]);return t.label_field=e.label_config.field,t.label_style_type=e.label_config.style_type,t},MapUtils.initRegionLayerToPanel=function(t,e){var i="";null!=t.show_fields&&(i=t.show_fields);var n=1==t.render_style&&t.category_config.is_categorized,r='<div class="layer dt-pos-r" data-layer-label="'+t.label_config.field+'" id="region_layer_'+t.id+'" layer-id="'+t.id+'" data-region-title="'+t.uniform_title+'" data-show-fields="'+i+'" layer-type="region_layer">';if(r+='<div class="rlayer dt-pos-a dt-h100 dt-pos-t0 '+t.active+'"></div>',r+='<div class="dt-h30">',r+='<span class="glyphicon display_layer rglayer pull-left dt-mar6r dt-mar8t '+t.eye_icon+' " layer-id="'+t.id+'" aria-hidden="true" data-container="body" data-toggle="tooltip" data-placement="bottom" title="\u9690\u85cf/\u663e\u793a\u56fe\u5c42"></span>',r+='<div layer-id="'+t.id+'" title="'+t.title+'" id="layer_title_'+t.id+'" class="dt-w140 dt-truncate pull-left layer_title dt-mar6t">'+t.title+"</div>",r+="hide"==t.display?'<div class="layer_action dt-mar8t dt-none">':'<div class="layer_action dt-mar8t">',t.cooperation)var a=PermissionUtils.loginUserRole(user_phone,{mapUsers:e.cooperation,layerUsers:t.cooperation});else var a=PermissionUtils.loginUserRole(user_phone,{mapUsers:e.cooperation});if(["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458","\u56fe\u5c42\u6210\u5458"].indexOf(a)>=0?(r+='<span class="dt-pointer dt-mar6r pull-right" id="'+t.id+'_panel">',r+='<span region_layer_id="'+t.id+'" class="glyphicon glyphicon-globe dt-super colora1 edit_region_layer_style" data-container="body" data-toggle="tooltip" data-placement="bottom" title="\u6837\u5f0f\u8bbe\u7f6e"></span>',r+='<span id="regionDataList_'+t.id+'" class="glyphicon glyphicon-th-list dt-super colora1 dt-mar6l data-region-list" data-container="body" data-toggle="tooltip" data-placement="bottom" title="\u67e5\u770b\u6570\u636e\u89c6\u56fe"></span>',r+='<span class="glyphicon glyphicon-option-vertical more-icon dt-super colora1 dt-mar6l dt-region-layer" data-container="body" data-toggle="tooltip" data-placement="bottom" id="layer_panel_'+t.id+'" layer-id="'+t.id+'" title="\u66f4\u591a\u8bbe\u7f6e"></span>',r+="</span>"):(r+='<span class="dt-pointer dt-mar6r pull-right" id="'+t.id+'_panel">',r+='<span id="regionDataList_'+t.id+'" class="glyphicon glyphicon-th-list dt-super colora1 dt-mar6l data-region-list" data-container="body" data-toggle="tooltip" data-placement="bottom" title="\u67e5\u770b\u6570\u636e\u89c6\u56fe"></span>',r+="</span>"),r+="</div>",r+="</div>",r+="hide"==t.display||n?'<ul class="list-unstyled dt-pad12x dt-pad12y" style="display:none">':'<ul class="list-unstyled dt-pad12x dt-pad12y" style="display:block">',0==t.regions.length)r+=MapUtils.load_region_btn_html(t.id);else for(var o=0;o<t.regions.length;o++){var s=t.regions[o],l="";s.display||(l="dt-none"),r+='<li id="li_region_id_'+s.id+'" class="dt-truncate select_region '+l+'" region-id="'+s.id+'">';var d=s.region_style.fillColor?parseInt(s.region_style.fillColor.substring(1,3),16):255,h=s.region_style.fillColor?parseInt(s.region_style.fillColor.substring(3,5),16):0,c=s.region_style.fillColor?parseInt(s.region_style.fillColor.substring(5,7),16):0,u=s.region_style.fillOpacity?s.region_style.fillOpacity:.2,p=s.region_style.strokeWeight?s.region_style.strokeWeight:1,f=s.region_style.strokeColor?s.region_style.strokeColor:"#ff0000";
r+=1==parseInt(s.region_type)?parseInt(s.region_style.strokeWeight)>5?'<div id="regionStyle_'+s.id+'" region-id="'+s.id+'" class="select_region dt-mar5y dt-mar8x pull-left" style="height: 14px;width: 14px;border-radius: 7px;border:5px solid '+f+";background-color:rgba("+d+","+h+","+c+","+u+')"> </div>':'<div id="regionStyle_'+s.id+'" region-id="'+s.id+'" class="select_region dt-mar5y dt-mar8x pull-left" style="height: 14px;width: 14px;border-radius: 7px;border:'+p+"px solid "+f+";background-color:rgba("+d+","+h+","+c+","+u+')"> </div>':parseInt(s.region_style.strokeWeight)>5?'<div id="regionStyle_'+s.id+'" region-id="'+s.id+'" class="select_region dt-mar5 pull-left" style="height: 14px;width: 20px;border:5px solid '+f+";background-color:rgba("+d+","+h+","+c+","+u+')"> </div>':'<div id="regionStyle_'+s.id+'" region-id="'+s.id+'" class="select_region dt-mar5 pull-left" style="height: 14px;width: 20px;border:'+p+"px solid "+f+";background-color:rgba("+d+","+h+","+c+","+u+')"> </div>',r+='<span id="setRegionTitle_'+s.id+'" region-id="'+s.id+'" class="select_region region-title dt-line-24h">'+s.title+"</span>",s.imgs&&s.imgs.length>0&&(r+='<span class="glyphicon glyphicon-picture pull-right dt-line-18h" id="region_img_'+s.id+'" ></span>'),r+="</li>"}if(r+="</ul>",n)if(r+="hide"==t.display?'<ul id="region_category_details_'+t.id+'" class="dt-pad12x dt-pad12y dt-none">':'<ul id="region_category_details_'+t.id+'" class="dt-pad12x dt-pad12y">',0==t.regions.length||0==t.categories.length)r+=MapUtils.load_region_btn_html(t.id);else{for(var o=0;o<t.categories.length;o++){var m=t.categories[o];r+=CategoryUtils.getCategoryHtmlToRegionLayer(m,t.id)}r+="</ul>"}r+="</div>",$("#layerContainer").append(r),$("#region_category_details_"+t.id+" li").unbind().mouseenter(function(t){$(t.currentTarget).find(".edit_category").show()}).mouseleave(function(t){$(t.currentTarget).find(".edit_category").hide()}),CategoryUtils.handleEvent("click","#region_category_details_"+t.id)},MapUtils.initLineLayerToPanel=function(t,e){var i="";null!=t.show_fields&&(i=t.show_fields);var n=1==t.render_style&&t.category_config.is_categorized,r='<div class="layer dt-pos-r" id="line_layer_'+t.id+'" layer-id="'+t.id+'" data-line-title="'+t.uniform_title+'" data-show-fields="'+i+'" data-layer-label="'+t.label_config.field+'" layer-type="line_layer">';if(r+='<div class="llayer dt-pos-a dt-h100 dt-pos-t0 '+t.active+'"></div>',r+='<div class="dt-h30">',r+='<span class="glyphicon '+t.eye_icon+'  display_layer lelayer pull-left dt-mar6r dt-mar8t" layer-id="'+t.id+'" aria-hidden="true" data-container="body" data-toggle="tooltip" data-placement="bottom" title="\u9690\u85cf/\u663e\u793a\u56fe\u5c42"></span>',r+='<div layer-id="'+t.id+'" title="'+t.title+'" id="layer_title_'+t.id+'" class="dt-w140 dt-truncate pull-left layer_title dt-mar6t">'+t.title+"</div>",r+="hide"==t.display?'<div class="layer_action dt-mar8t dt-none">':'<div class="layer_action dt-mar8t">',t.cooperation)var a=PermissionUtils.loginUserRole(user_phone,{mapUsers:e.cooperation,layerUsers:t.cooperation});else var a=PermissionUtils.loginUserRole(user_phone,{mapUsers:e.cooperation});if(["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458","\u56fe\u5c42\u6210\u5458"].indexOf(a)>=0?(r+='<span class="dt-pointer dt-mar6r pull-right" id="'+t.id+'_panel">',r+='<span line_layer_id="'+t.id+'" data-toggle="tooltip" data-placement="bottom" data-container="body" class="glyphicon glyphicon-globe  dt-super colora1 edit_line_layer_style" title="\u6837\u5f0f\u8bbe\u7f6e"></span>',r+='<span id="lineDataList_'+t.id+'" data-toggle="tooltip" data-placement="bottom" data-container="body" class="glyphicon glyphicon-th-list dt-super colora1 dt-mar6l data-line-list" title="\u67e5\u770b\u6570\u636e\u89c6\u56fe"></span>',r+='<span data-toggle="tooltip" data-placement="bottom" data-container="body" class="glyphicon glyphicon-option-vertical more-icon dt-super colora1 dt-mar6l dt-line-layer" id="layer_panel_'+t.id+'" layer-id="'+t.id+'" title="\u66f4\u591a\u8bbe\u7f6e"></span>',r+="</span>"):(r+='<span class="dt-pointer dt-mar6r pull-right" id="'+t.id+'_panel">',r+='<span id="lineDataList_'+t.id+'" data-toggle="tooltip" data-placement="bottom" data-container="body" class="glyphicon glyphicon-th-list dt-super colora1 dt-mar6l data-line-list" title="\u67e5\u770b\u6570\u636e\u89c6\u56fe"></span>',r+="</span>"),r+="</div>",r+="</div>",r+="hide"==t.display||n?'<ul class="list-unstyled dt-pad12x dt-pad12y" style="display: none;">':'<ul class="list-unstyled dt-pad12x dt-pad12y" style="display: block;">',0==t.lines.length)r+=MapUtils.load_line_btn_html(t.id);else for(var o=0;o<t.lines.length;o++){var s=t.lines[o],l="";s.display||(l="dt-none"),r+='<li id="li_line_id_'+s.id+'" class="dt-truncate select_line '+l+'" line-id="'+s.id+'">',s.line_route?r+=MapUtils.loadDirectionMarker(s,"edit"):(r+='<div id="lineStyle_'+s.id+'" line-id="'+s.id+'" class="select_line dt-mar5 pull-left" style="height: 14px;border:4px solid '+s.line_style.strokeColor+";background-color:rgba("+parseInt(s.line_style.strokeColor.substring(1,3),16)+","+parseInt(s.line_style.strokeColor.substring(3,5),16)+","+parseInt(s.line_style.strokeColor.substring(5,7),16)+","+s.line_style.strokeOpacity+')"></div>',r+='<span id="setLineTitle_'+s.id+'" line-id="'+s.id+'" class="select_line line-title dt-line-24h">'+s.title+"</span>",s.imgs&&s.imgs.length>0&&(r+='<span class="glyphicon glyphicon-picture pull-right dt-line-18h" id="line_img_'+s.id+'" ></span>')),r+="</li>"}if(r+="</ul>",n)if(r+="hide"==t.display?'<ul id="line_category_details_'+t.id+'" class="dt-pad12x dt-pad12y dt-none">':'<ul id="line_category_details_'+t.id+'" class="dt-pad12x dt-pad12y">',0==t.lines.length||0==t.categories.length)r+=MapUtils.load_line_btn_html(t.id);else{for(var o=0;o<t.categories.length;o++){var d=t.categories[o];r+=CategoryUtils.getCategoryHtmlToLineLayer(d,t.id)}r+="</ul>"}r+="</div>",$("#layerContainer").append(r),$("#line_category_details_"+t.id+" li").unbind().mouseenter(function(t){$(t.currentTarget).find(".edit_category").show()}).mouseleave(function(t){$(t.currentTarget).find(".edit_category").hide()}),CategoryUtils.handleEvent("click","#line_category_details_"+t.id)},MapUtils.viewerRegionLayerToPanel=function(t){var e="";null!=t.show_fields&&(e=t.show_fields);var i=1==t.render_style&&t.category_config.is_categorized,n="";n+=t.is_del?'<div class="layer dr-bg-pink dt-pos-r" id="region_layer_'+t.id+'" layer-id="'+t.id+'" data-region-title="'+t.uniform_title+'" data-show-fields="'+e+'">':'<div class="layer dt-pos-r" id="region_layer_'+t.id+'" layer-id="'+t.id+'" data-region-title="'+t.uniform_title+'" data-show-fields="'+e+'">',n+='<div class="dt-h30">',n+='<span data-toggle="tooltip" data-placement="bottom" data-container="body" class="glyphicon '+t.eye_icon+' display_layer rglayer pull-left dt-mar6r dt-mar8t" layer-id="'+t.id+'" aria-hidden="true" title="\u9690\u85cf/\u663e\u793a\u56fe\u5c42"></span>',n+='<div layer-id="'+t.id+'" title="'+t.title+'" class="dt-truncate dt-pointer dt-w200 pull-left layer_title dt-mar6t">'+t.title+"</div>",n+='<span class="pull-right dt-line-30h dt-f12">('+t.regions.length+")</span>",n+="</div>",n+="hide"==t.display||i?'<ul class="list-unstyled dt-pad12x dt-pad12y" style="display:none">':'<ul class="list-unstyled dt-pad12x dt-pad12y" style="display:block">';for(var r=0;r<t.regions.length;r++){var a=t.regions[r],o="";a.display&&!i||(o="dt-none"),n+='<li id="li_region_id_'+a.id+'" class="dt-truncate select_region '+o+'" region-id="'+a.id+'">';var s=a.region_style.fillColor?parseInt(a.region_style.fillColor.substring(1,3),16):255,l=a.region_style.fillColor?parseInt(a.region_style.fillColor.substring(3,5),16):0,d=a.region_style.fillColor?parseInt(a.region_style.fillColor.substring(5,7),16):0,h=a.region_style.fillOpacity?a.region_style.fillOpacity:.2,c=a.region_style.strokeWeight?a.region_style.strokeWeight:1,u=a.region_style.strokeColor?a.region_style.strokeColor:"#ff0000";n+=1==parseInt(a.region_type)?parseInt(a.region_style.strokeWeight)>5?'<div id="regionStyle_'+a.id+'" region-id="'+a.id+'" class="select_region dt-mar5y dt-mar8x pull-left" style="height: 14px;width: 14px;border-radius: 7px;border:5px solid '+u+";background-color:rgba("+s+","+l+","+d+","+h+')"> </div>':'<div id="regionStyle_'+a.id+'" region-id="'+a.id+'" class="select_region dt-mar5y dt-mar8x pull-left" style="height: 14px;width: 14px;border-radius: 7px;border:'+c+"px solid "+u+";background-color:rgba("+s+","+l+","+d+","+h+')"> </div>':parseInt(a.region_style.strokeWeight)>5?'<div id="regionStyle_'+a.id+'" region-id="'+a.id+'" class="select_region dt-mar5 pull-left" style="height: 14px;width: 20px;border:5px solid '+u+";background-color:rgba("+s+","+l+","+d+","+h+')"> </div>':'<div id="regionStyle_'+a.id+'" region-id="'+a.id+'" class="select_region dt-mar5 pull-left" style="height: 14px;width: 20px;border:'+c+"px solid "+u+";background-color:rgba("+s+","+l+","+d+","+h+')"> </div>',n+='<span id="setRegionTitle_'+a.id+'" region-id="'+a.id+'" class="select_region region-title dt-line-24h dt-f12">'+a.title+"</span>",a.imgs&&a.imgs.length>0&&(n+='<span class="glyphicon glyphicon-picture pull-right dt-line-18h" id="region_img_'+a.id+'" ></span>'),n+="</li>"}if(n+="</ul>",i){n+="hide"==t.display?'<ul id="region_category_details_'+t.id+'" class="dt-pad12x dt-pad12y dt-none">':'<ul id="region_category_details_'+t.id+'" class="dt-pad12x dt-pad12y">';for(var r=0;r<t.categories.length;r++){var p=t.categories[r];n+=CategoryUtils.getCategoryHtmlToRegionLayerViewer(p,t.id)}n+="</ul>"}n+="</div>",$("#layerContainer").append(n),CategoryUtils.handleEvent("click","#line_category_details_"+t.id)},MapUtils.viewerLineLayerToPanel=function(t){var e="";null!=t.show_fields&&(e=t.show_fields);var i=1==t.render_style&&t.category_config.is_categorized,n="";n+=t.is_del?'<div class="layer dt-bg-pink dt-pos-r" id="line_layer_'+t.id+'" layer-id="'+t.id+'" data-line-title="'+t.uniform_title+'" data-show-fields="'+e+'">':'<div class="layer dt-pos-r" id="line_layer_'+t.id+'" layer-id="'+t.id+'" data-line-title="'+t.uniform_title+'" data-show-fields="'+e+'">',n+='<div class="dt-h30">',n+='<span data-toggle="tooltip" data-placement="bottom" data-container="body" class="glyphicon '+t.eye_icon+' display_layer lelayer pull-left dt-mar6r dt-mar8t" layer-id="'+t.id+'" aria-hidden="true" title="\u9690\u85cf/\u663e\u793a\u56fe\u5c42"></span>',n+='<div layer-id="'+t.id+'" title="'+t.title+'" class="dt-truncate dt-pointer dt-w200 pull-left layer_title dt-mar6t">'+t.title+"</div>",n+='<span class="pull-right dt-line-30h dt-f12">('+t.lines.length+")</span>",n+="</div>",n+="hide"==t.display||i?'<ul class="list-unstyled dt-pad12x dt-pad12y" style="display:none">':'<ul class="list-unstyled dt-pad12x dt-pad12y" style="display:block">';for(var r=0;r<t.lines.length;r++){var a=t.lines[r],o="";n+='<li id="li_line_id_'+a.id+'" class="dt-truncate select_line '+o+'" line-id="'+a.id+'">',a.line_route?n+=MapUtils.loadDirectionMarker(a,"viewer"):(n+='<div id="lineStyle_'+a.id+'" line-id="'+a.id+'" class="select_line dt-mar5 pull-left" style="height: 14px;border:4px solid '+a.line_style.strokeColor+";background-color:rgba("+parseInt(a.line_style.strokeColor.substring(1,3),16)+","+parseInt(a.line_style.strokeColor.substring(3,5),16)+","+parseInt(a.line_style.strokeColor.substring(5,7),16)+","+a.line_style.strokeOpacity+'"></div>',n+='<span id="setLineTitle_'+a.id+'" line-id="'+a.id+'" class="select_line line-title dt-line-24h dt-f12">'+a.title+"</span>",a.imgs&&a.imgs.length>0&&(n+='<span class="glyphicon glyphicon-picture pull-right dt-line-18h" id="line_img_'+a.id+'" ></span>')),n+="</li>"}if(n+="</ul>",i){n+="hide"==t.display?'<ul id="line_category_details_'+t.id+'" class="dt-pad12x dt-pad12y dt-none">':'<ul id="line_category_details_'+t.id+'" class="dt-pad12x dt-pad12y">';for(var r=0;r<t.categories.length;r++){var s=t.categories[r];n+=CategoryUtils.getCategoryHtmlToLineLayerViewer(s,t.id)}n+="</ul>"}n+="</div>",$("#layerContainer").append(n),CategoryUtils.handleEvent("click","#line_category_details_"+t.id)},MapUtils.createLayer=function(t){var e;return"marker_layer"==t.type?(e=new DT.MarkerLayer,e.setCanvasConfig(t.canvas_config),e.setHeatmapConfig(t.heatmap_config),e.setTextConfig(t.text_config),e.setSortConfig(t.sort_config),e.users=t.users,e.icons=t.icons,e.setLocateField(t.locate_field)):"region_layer"==t.type?e=new DT.RegionLayer:"line_layer"==t.type&&(e=new DT.LineLayer),e.setAttrs(t.attrs),e.setAttrFields(t.attr_fields),e.setUniformTitle(t.uniform_title),e.setTitle(t.title),e.setLayerDisplay(t.display),e.setLayerId(t.id),e.render_style=t.render_style,e.monitors=t.monitors,e.setUniformConfig(t.uniform_config),e.setCategoryConfig(t.category_config),e.setLabelConfig(t.label_config),e.setCategories(t.categories),e.setShowFields(t.show_fields),t.cooperation&&(e.is_permission_layer=!0),e},MapUtils.addLayerAttrs=function(t,e){var i,n=null,r=[];if("marker"==t.type?(n=t.marker_layer_id,r=t.marker_attrs,i=e.get("m_"+n)):"region"==t.type?(n=t.region_layer_id,r=t.region_attrs,i=e.get("r_"+n)):"line"==t.type&&(n=t.line_layer_id,r=t.line_attrs,i=e.get("l_"+n)),i&&(!i.getAttrs()||0==i.getAttrs().length)){for(var a=[],o=0;o<r.length;o++)a.push(r[o].key);i.setAttrs(a)}},MapUtils.canAddOverlayToMap=function(t,e,i){var n,r=t+"_layer";"marker"==t?n=e.get("m_"+current_layer_id):"region"==t?n=e.get("r_"+current_layer_id):"line"==t&&(n=e.get("l_"+current_layer_id));for(var a=e.values(),o=[],s=0;s<a.length;s++)a[s].type==r&&o.push(a[s]);return MapUtils._canAddOverlayToLayer(o,n,r,i)},MapUtils._canAddOverlayToLayer=function(t,e,i,n){var r="";r="marker_layer"==i?"\u6807\u6ce8":"line_layer"==i?"\u7ebf\u8def":"\u533a\u57df";var a="\u5f53\u524d\u9009\u4e2d\u56fe\u5c42\u5e76\u975e"+r+"\u56fe\u5c42\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u56fe\u5c42\u6216\u65b0\u5efa"+r+"\u56fe\u5c42\u540e\u518d\u8fdb\u884c\u7f16\u8f91";return 0==t.length||(1==t.length?($(".layer").find(".active-layer").removeClass("active-layer").addClass("layer-hover"),$("#"+i+"_"+t[0].getLayerId()).find(".layer-hover").removeClass("layer-hover").addClass("active-layer"),MapUtils.isHideLayer(n,t[0])):t.length>1?e?e.getType()!=i?(PromptInfo.xcConfirm(a,PromptInfo.xcConfirm.typeEnum.info),!1):MapUtils.isHideLayer(n,e):(PromptInfo.xcConfirm(a,PromptInfo.xcConfirm.typeEnum.info),!1):void 0)},MapUtils.isHideLayer=function(t,e){if("hide"==e.getLayerDisplay()){var i=e.getTypeLabel();return PromptInfo.xcConfirm("\u5f53\u524d\u9009\u4e2d\u7684"+i+"\u56fe\u5c42\u5df2\u88ab\u9690\u85cf\uff0c\u8bf7\u5148\u53d6\u6d88\u9690\u85cf\u6216\u8005\u65b0\u5efa\u56fe\u5c42\u518d\u8fdb\u884c\u7f16\u8f91\u3002",PromptInfo.xcConfirm.typeEnum.info),!1}return!0},MapUtils.sortMin2Max=function(t,e){return t>e?1:-1},MapUtils.get_label_offset=function(t,e){null==t&&(t="");var i=-(13*t.toString().replace(/<[^>]+>/g,"").length/2),n=5;return"region"==e&&(n=-9),new L.Point(i,n)},MapUtils.deduplicatePath=function(t){var e=t.concat(),i=e.concat().sort();return i.sort(function(t,i){t.lng==i.lng&&t.lat==i.lat&&e.splice(e.indexOf(t),1)}),e},MapUtils.check_col_name=function(t){var e="";return t.indexOf(" ")>-1&&(e="\u5217\u6807\u9898\u4e0d\u80fd\u5305\u542b\u7a7a\u683c"),(t.length<2||t.length>16)&&(e="\u5217\u6807\u9898\u957f\u5ea6\u8981\u6c42\u57282\u523016\u4e2a\u5b57\u7b26\u4e4b\u95f4"),"\u64cd\u4f5c"!=t&&"id"!=t||(e="\u5217\u6807\u9898\u4e0d\u80fd\u4f7f\u7528\u5173\u952e\u8bcd\u201c"+t+"\u201d"),t.match(/((?=[\x21-\x7e]+)[^A-Za-z0-9])/)&&(e="\u5217\u6807\u9898\u4e0d\u80fd\u5305\u542b\u7279\u6b8a\u5b57\u7b26"),e},MapUtils.get_attr_value=function(t,e){for(var i=0;t&&i<t.length;i++)if(t[i]&&t[i].key==e)return t[i].value;return null},MapUtils.setOverlayPermission=function(t,e,i){var n=PermissionUtils.loginUserRole(user_phone,{mapUsers:i.cooperation,layerUsers:t.cooperation});n||(n="");var r="";"marker_layer"==e?r="marker_layer_icon":"line_layer"==e?r="line_layer_icon":"region_layer"==e&&(r="region_layer_icon");var a=!1;["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458"].indexOf(n)>=0&&(a=!0);for(var o=[],s=0;s<t.cooperation.length;s++){var l=t.cooperation[s];l.dataContent=PermissionUtils.setLayerPermissionPanelHtml(l,"\u6210\u5458",n,l.phone,t.type),o.push(l)}var d=[{layer_id:t.id,layer_icon:r,layer_title:t.title,users:o,is_show:a,type:t.type}],h=$("#layerPermissionTemplate").render(d);$(".add-layer-to-panel").before(h),PermissionUtils.reloadPopover(),PermissionUtils.initPopover()},MapUtils.isIE=function(){return!!(window.ActiveXObject||"ActiveXObject"in window)},MapUtils.getReplyChart=function(t){var e=[],i=[];if(t&&t.length>0){$.each(t,function(t,n){return!(t>=20)&&(e.push(n.nickname),void i.push(n.replies_count))});var n={title:{text:"\u52a8\u6001\u6570\u6392\u884c",subtext:"\u524d20\u4f4d"},tooltip:{trigger:"axis"},toolbox:{show:!0,feature:{saveAsImage:{show:!0}}},xAxis:[{type:"category",data:e}],yAxis:[{type:"value"}],series:[{name:"\u52a8\u6001\u6570",type:"bar",data:i,barMaxWidth:50}]},r=echarts.init(document.getElementById("chart"));r.setOption(n)}},MapUtils.subStr=function(t,e){return t.substring(0,e)+"..."},MapUtils.meter2Kilometre=function(t){if(parseInt(t)>1e3){var e=parseFloat(t/1e3).toFixed(2),i=e.toString();return"0"==i.substring(3,4)?i.substring(0,3)+"\u516c\u91cc":i+"\u516c\u91cc"}return t+"\u7c73"},MapUtils.RGB2Hex=function(t){return t?[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]:[248,103,103]},MapUtils.loadDirectionMarker=function(t,e){var i='<span class="glyphicon glyphicon-road dt-f12 dt-mar5" style="color:'+t.line_style.strokeColor+';"></span>';i+='<span id="setLineTitle_'+t.id+'" line-id="'+t.id+'" class="select_line dt-f12 line-title dt-line-24h">'+t.title+"</span>",t.imgs&&t.imgs.length>0&&(i+='<span class="glyphicon glyphicon-picture pull-right dt-line-18h" id="line_img_'+t.id+'" ></span>'),i+='<div class="direction-info">',i+='<p class="dt-mar22l dt-f12">',i+="\u5171"+(t.line_route.way_points.length+2)+'\u4e2a\u70b9<span class="dt-mar12l dt-f12">'+(t.line_route.distance/1e3).toFixed(2)+"\u516c\u91cc</span>","edit"==e&&t.cooperation.length>0&&(i+='<span class="dt-mar12l">\u8d1f\u8d23\u4eba\uff1a'+t.cooperation[0].nickname+"</span>"),i+="</p>",i+='<ul class="dt-mar8t direction-way-point-info">',i+="<li>",i+='<div class="direction-start-panel pull-left">\u8d77</div><span class="pull-left dt-mar12l dt-mar2t dt-truncate dt-w168">'+t.line_route.origin_point.name+"</span>",i+="</li>";for(var n=0;n<t.line_route.way_points.length;n++)i+='<li class="dt-mar8t">',i+='<div class="join-line"></div>',i+='<div class="direction-path-panel pull-left">'+(n+1)+'</div><span class="pull-left dt-mar12l dt-mar2t dt-truncate dt-w168">'+t.line_route.way_points[n].name+"</span>",i+="</li>";return i+='<li class="dt-mar8t">',i+='<div class="join-line"></div>',i+='<div class="direction-end-panel pull-left">\u7ec8</div><span class="pull-left dt-mar12l dt-mar2t dt-truncate dt-w168">'+t.line_route.destination_point.name+"</span>",i+="</li>",i+="</ul>",i+="</div>"},MapUtils.getOverlayLabelStyle=function(t){switch(t=parseInt(t)){case 0:return{permanent:!0,direction:"right",className:"leaflet-normal-label"};case 1:return{permanent:!0,direction:"top",className:"leaflet-text-label"};case 2:return{permanent:!0,direction:"right",className:"leaflet-classics-label"};case 3:return{permanent:!0,direction:"right",className:"leaflet-black-label"};case 4:return{permanent:!0,direction:"right",className:"leaflet-blue-label"};default:return{permanent:!0,direction:"right",className:"leaflet-normal-label"}}},MapUtils.isLoadMessageAudio=function(){$("audio").get(0).play()},MapUtils.decodePath=function(t){if("undefined"==typeof t||null==t||""==t)return null;for(var e=[],i=t.split("0"),n=0;n<i.length;n++){for(var r=[],a=PolylineUtil.decode(i[n]),o=0;o<a.length;o++)r.push(a[o][1]+","+a[o][0]);e.push(r.join(";"))}return e.join("|")},MapUtils.computeTextLength=function(t){if(null==t||""==t)return 0;for(var e="",i=0,n=0;n<t.length;n++)e=t.charCodeAt(n),i+=e>256?14:7.8;return i+=t.split("\n").length-1},MapUtils.reloadTooltip=function(){$('[data-toggle="tooltip"]').tooltip("destroy"),$('[data-toggle="tooltip"]').tooltip()},MapUtils.updateLabelPosition=function(t){var e=t.label;if("undefined"!=typeof e&&null!=e){var i=null;"line"!=e.type&&"region"!=e.type||(i=t.getCenter()),i&&e.setPosition(i)}},MapUtils.addLabelToOverlay=function(t,e){if(t){var i=t.attrs;if(i){t.unBindLabel();var n=t.label_field;if("undefined"!=typeof n&&null!=n)for(var r=MapUtils.getOverlayLabelStyle(parseInt(t.label_style_type)),a=0;i&&a<i.length;a++)if(i[a]&&n==i[a].key){var o=i[a].value||"";return t.bindLabel(o.toString(),r),void("undefined"!=typeof t.label&&null!=t.label&&(e&&t.display?o.toString().length>0?t.showLabel():t.hideLabel():t.isVisible()&&o.toString().length>0?t.showLabel():t.hideLabel()))}}}},MapUtils.setTitle=function(t,e){$("#setTitle").unbind().on("shown.bs.modal",function(){var i="",n=null,r=$("#"+e+"_layer_"+t).attr("data-"+e+"-title");"marker"==e?(i=uniform_marker_title_url,n=MapUtils.layersHashMap.get("m_"+t)):"line"==e?(i=uniform_line_title_url,n=MapUtils.layersHashMap.get("l_"+t)):"region"==e&&(i=uniform_region_title_url,n=MapUtils.layersHashMap.get("r_"+t));var a=null;if(n&&(a=n.getAttrFields()),null!=a){var o="<span class='dt-line-30h pull-left dt-f14'>\u8bf7\u9009\u62e9\uff1a</span>";o+="<select id='uniform_marker_title_"+t+"' class='dt-select-label pull-left form-control dt-w168'>";for(var s=0;s<a.length;s++)if(null!=a[s]){var l=a[s].field;o+=0!=r.length&&r==l?"<option value='"+l+"' selected>"+l+"</option>":"<option value='"+l+"'>"+l+"</option>"}o+="</select>",o+="</div>",$("#setTitle").find(".modal-body").empty().append(o)}$(".dt-select-label").change(function(){var n={id:t,mid:mid,field:$(this).val()};$("#"+e+"_layer_"+t).attr("data-"+e+"-title",$(this).val()),MapUtils.ajax2server(i,"POST",n,function(){BInfowindow.close()})})})},MapUtils.download=function(t){$("#downloadFrame").remove();var e=document.createElement("iframe");e.style.display="none",e.name="downloadFrame",e.id="downloadFrame",$("body").append(e),window.frames.downloadFrame.location.href=t},MapUtils.getSplitArray=function(t,e){for(var i=[],n=[],r=1;r<=t.length;r++)r%e==0?(i.push(t[r-1]),n.push(i),i=[]):i.push(t[r-1]);return i.length>0&&n.push(i),n},MapUtils.copy_after=function(t){var e=$(t),i=e.children(".copy_success");i.show(),i.css("top","-10px"),i.animate({top:"-20px",opacity:"hide"},"slow")},MapUtils.TemplateFieldType={STRING:"String",NUMERIC:"Numeric"},MapUtils.getArrayIntersect=function(t,e){return Array.prototype.each=function(t){t=t||Function.K;for(var e=[],i=Array.prototype.slice.call(arguments,1),n=0;n<this.length;n++){var r=t.apply(this,[this[n],n].concat(i));null!=r&&e.push(r)}return e},Array.prototype.contains=function(t){return RegExp("\\b"+t+"\\b").test(this)},Array.prototype.uniquelize=function(){for(var t=new Array,e=0;e<this.length;e++)t.contains(this[e])||t.push(this[e]);return t},t.uniquelize().each(function(t){return e.contains(t)?t:null})},MapUtils.validateFieldNumber=function(t){var e=/^(-?\d+)(\.\d+)?$/,i=t;return 0==i.length?0:e.test(i)?1:-1},MapUtils.validateFieldDate=function(t){var e=/^[0-3][0-9]{3}-(0?[1-9]|1[0-2])-(0?[1-9]|[1-2][0-9]|3[0-1])( ([0-1]?[0-9]|2?[0-3])(:([0-5]?[0-9])){2})?$/;return 0==t.length?0:e.test(t)?1:-1},MapUtils.validateFieldTime=function(t){var e=/^([0-1]?[0-9]|2?[0-3])(:([0-5]?[0-9])){2}?$/;return 0==t.length?0:e.test(t)?1:-1},MapUtils.getDateTimePickerTooltip=function(){return{today:"\u4eca\u5929",clear:"\u6e05\u7a7a\u9009\u62e9",close:"\u5173\u95ed",selectMonth:"\u9009\u62e9\u6708\u4efd",prevMonth:"\u4e0a\u4e2a\u6708",nextMonth:"\u4e0b\u4e2a\u6708",selectYear:"\u9009\u62e9\u5e74\u4efd",prevYear:"\u4e0a\u4e00\u5e74",nextYear:"\u4e0b\u4e00\u5e74",selectDecade:"\u9009\u62e9\u5e74\u4ee3",prevDecade:"\u4e0a\u4e00\u5e74\u4ee3",nextDecade:"\u4e0b\u4e00\u5e74\u4ee3",prevCentury:"\u4e0a\u4e00\u4e16\u7eaa",nextCentury:"\u4e0b\u4e00\u4e16\u7eaa",pickHour:"\u65f6",incrementHour:"\u589e\u52a0",decrementHour:"\u51cf\u5c11",pickMinute:"\u5206",incrementMinute:"\u589e\u52a0",decrementMinute:"\u51cf\u5c11",pickSecond:"\u79d2",incrementSecond:"\u589e\u52a0",decrementSecond:"\u51cf\u5c11",togglePeriod:"\u4e0a\u5348/\u4e0b\u5348",selectTime:"\u9009\u62e9\u65f6\u95f4"}},MapUtils.addFilterInfoWrapper=function(){$("#filterInfoWrapper").length>0;var t="<div id='filterInfoWrapper' class='dt-none'>";t+="<p class='dt-hiddeh dt-pad8x dt-pad8y'>",t+="\u603b\u5171\u7b5b\u9009<span class='filter-count dt-f14'>0</span>\u6761\u7ed3\u679c",t+="<a href='###' class='pull-right close-filter-panel'>\u5173\u95ed</a>",t+="</p>",t+="<hr class='dt-mar0'>",t+="<div class='filter-overlay-panel dt-pad8x dt-pad8y dt-auto'>",t+="</div>",t+="</div>",$("#mapInfoWrapper").after(t),$(".filter-overlay-panel").unbind().click(function(t){var e,i;if($(t.target).closest("div").hasClass("filter-marker")){var n=$(t.target).closest("div").attr("marker-id");e=$(t.target).closest("div").attr("layer-id"),i=MarkerUtils.layersHashMap.get("m_"+e);var r=i.getMarker(n);r&&(6==i.render_style&&MarkerUtils.map.setZoom(15),BInfowindow.close(),isViewer?BInfowindow.open(r,{status:"view"}):BInfowindow.open(r))}else if($(t.target).closest("div").hasClass("filter-line")){var a=$(t.target).closest("div").attr("line-id");e=$(t.target).closest("div").attr("layer-id"),i=MarkerUtils.layersHashMap.get("l_"+e);var o=i.getLines().get(a);o&&($(document).trigger("dt.select.line",o),o.line_route&&($(t.target).closest("li").find(".direction-info").hasClass("direction-animate")?$(t.target).closest("li").find(".direction-info").removeClass("direction-animate"):($(t.target).closest("li").find(".direction-info").addClass("direction-animate"),$(t.target).closest("li").find(".direction-info").find("ul").show())))}else if($(t.target).closest("div").hasClass("filter-region")){var s=$(t.target).closest("div").attr("region-id");e=$(t.target).closest("div").attr("layer-id"),i=MarkerUtils.layersHashMap.get("r_"+e);var l=i.getRegions().get(s);l&&$(document).trigger("dt.select.region",l)}}),$(".close-filter-panel").unbind().click(function(){$(".filter-overlay-panel").empty(),$(".filter-count").text("0"),$("#filterInfoWrapper").addClass("dt-none"),$(".btn-reset-filter").trigger("click")})},MapUtils.showSearchFeatures=function(t){$("#closeRD").trigger("click"),$("#dataListClose").trigger("click"),$(".filter-overlay-panel").empty();var e,i,n,r,a,o=0,s=0,l=0,d=[];if(n=MarkerUtils.getMarkerLayers(),t.markers.length>0)for(var h=0;h<n.length;h++)if(e=n[h],2==e.render_style?MapUtils.map.removeOverlay(MapUtils.map.dt_heatmap[e.id][0]):e.isCluster()?MapUtils.map.removeOverlay(MapUtils.map.dt_clusterer[e.id]):e.removeMarkersFromMap(),"hide"!=e.display){CategoryUtils.removeVectors(e);var c=e.getMarkers().values();if(i="<div class='filter-marker-layer-"+e.id+" dt-hidden'>",i+="<div class='dt-h30'>",i+=e.title,i+="<span class='pull-right dt-line-20h'>(<span class='filter-result-count dt-f12'>0</span>)</span>",i+="</div>","undefined"!=typeof MonitorUtils&&has_message_audio&&MonitorUtils.showMonitors(e,t.markers),2==e.render_style){var u=0,p=e.heatmap_config,f=MarkerUtils.heatmapConfig(p.gradient,p.radius,e.id),m=p.field,g=1,_=p.max;null==_&&(_=2);for(var y=[],v=0;v<c.length;v++)if(c[v].lng!=-9999&&c[v].lat!=-9999){var b=c[v];t.markers.indexOf(b.feature_id)>=0&&b.display&&"show"==e.display&&(y.push(MarkerUtils.generateHeatmapPoint(b,m)),o++,u++)}var w={radius:f.radius,maxOpacity:.8,scaleRadius:!1,latField:"lat",lngField:"lng",valueField:"count",gradient:f.gradient},x=new HeatmapOverlay(w),k={max:_,data:y};x.setData(k),x.addTo(MarkerUtils.map),"hide"==e.display&&x.hide(),$(".heatmap-canvas").parent().css("height",0),MapUtils.map.dt_heatmap[e.id]=[x,y,{max:_,field:m,config:f}],i+=MarkerUtils.heatmap_div(e)}else{for(var C=L.markerClusterGroup({spiderfyOnMaxZoom:!1,disableClusteringAtZoom:18}),T=0;T<c.length;T++){var b=c[T];t.markers.indexOf(b.feature_id)>=0&&b.display&&"show"==e.display?(b.show(),C.addLayer(b),b.showLabel(),i+="<div class='dt-hidden dt-pointer filter-marker' layer-id='"+b.layer_id+"' marker-id='"+b.feature_id+"'>",i+=MarkerUtils.markerIconHtml(b.obj,e),i+="<span class='dt-mar4l dt-f12'>"+b.title+"</span>",i+="</div>",o++):(b.hide(),b.hideLabel())}e.isCluster()&&(MarkerUtils.map.dt_clusterer[e.id]=C,"show"==e.display&&MarkerUtils.map.addLayer(MarkerUtils.map.dt_clusterer[e.id]))}i+="<hr class='dt-mar4y'>",i+="</div>",$(".filter-overlay-panel").append(i);var g=0;g=2==e.render_style?u:$(".filter-marker-layer-"+e.id).find(".filter-marker").length,0==g?$(".filter-marker-layer-"+e.id).remove():$(".filter-marker-layer-"+e.id).find(".filter-result-count").text(g)}else d.push(e);else Array.prototype.push.apply(d,n);if(r=LineUtils.getLineLayers(),t.lines.length>0)for(var M=0;M<r.length;M++)if(e=r[M],"hide"!=e.display){i="<div class='filter-line-layer-"+e.id+" dt-hidden'>",i+="<div class='dt-h30'>",i+=e.title,i+="<span class='pull-right dt-line-20h'>(<span class='filter-result-count dt-f12'>0</span>)</span>",i+="</div>";var P=e.getLines().values();"undefined"!=typeof MonitorUtils&&has_message_audio&&MonitorUtils.showMonitors(e,t.lines);for(var D=0;D<P.length;D++){var S=P[D];t.lines.indexOf(S.feature_id)>=0&&S.display&&"show"==e.display?(S.show(),S.label&&S.label instanceof BMap.Label&&S.label.show(),i+="<div class='dt-hidden dt-pointer filter-line' layer-id='"+S.layer_id+"' line-id='"+S.feature_id+"'>",i+='<p line-id="'+S.feature_id+'" class="dt-mar5 pull-left" style="height: 14px;border:4px solid '+S.line_style.strokeColor+";background-color:rgba("+parseInt(S.line_style.strokeColor.substring(1,3),16)+","+parseInt(S.line_style.strokeColor.substring(3,5),16)+","+parseInt(S.line_style.strokeColor.substring(5,7),16)+","+S.line_style.strokeOpacity+');margin:5px 5px 5px 3px;"></p>',i+="<span>"+S.title+"</span>",i+="</div>",s++):(S.hide(),S.label&&S.label instanceof BMap.Label&&S.label.hide())}i+="<hr class='dt-mar4y'>",i+="</div>",$(".filter-overlay-panel").append(i);var g=$(".filter-line-layer-"+e.id).find(".filter-line").length;0==g?$(".filter-line-layer-"+e.id).remove():$(".filter-line-layer-"+e.id).find(".filter-result-count").text(g)}else d.push(e);else Array.prototype.push.apply(d,r);if(a=RegionUtils.getRegionLayers(),t.regions.length>0)for(var I=0;I<a.length;I++)if(e=a[I],"hide"!=e.display){i="<div class='filter-region-layer-"+e.id+" dt-hidden'>",i+="<div class='dt-h30'>",i+=e.title,i+="<span class='pull-right dt-line-20h'>(<span class='filter-result-count dt-f12'>0</span>)</span>",i+="</div>";var E=e.getRegions().values();"undefined"!=typeof MonitorUtils&&has_message_audio&&MonitorUtils.showMonitors(e,t.regions);for(var U=0;U<E.length;U++){var O=E[U];if(t.regions.indexOf(O.feature_id)>=0&&O.display&&"show"==e.display){O.show(),O.label&&O.label instanceof BMap.Label&&O.label.show();var j=O.region_style.fillColor?parseInt(O.region_style.fillColor.substring(1,3),16):255,A=O.region_style.fillColor?parseInt(O.region_style.fillColor.substring(3,5),16):0,z=O.region_style.fillColor?parseInt(O.region_style.fillColor.substring(5,7),16):0,B=O.region_style.fillOpacity?O.region_style.fillOpacity:.2,R=O.region_style.strokeWeight?O.region_style.strokeWeight:1,F=O.region_style.strokeColor?O.region_style.strokeColor:"#ff0000",N=O.feature_id;i+="<div class='dt-hidden dt-pointer filter-region' layer-id='"+O.layer_id+"' region-id='"+N+"'>",i+=1==parseInt(O.region_type)?parseInt(O.region_style.strokeWeight)>5?'<p region-id="'+N+'" class="dt-mar5y dt-mar8x pull-left" style="height: 14px;width: 14px;border-radius: 7px;border:5px solid '+F+";background-color:rgba("+j+","+A+","+z+","+B+')"> </p>':'<p region-id="'+N+'" class="dt-mar5y dt-mar8x pull-left" style="height: 14px;width: 14px;border-radius: 7px;border:'+R+"px solid "+F+";background-color:rgba("+j+","+A+","+z+","+B+')"> </p>':parseInt(O.region_style.strokeWeight)>5?'<p region-id="'+N+'" class="dt-mar4r dt-mar4t pull-left" style="height: 14px;width: 20px;border:5px solid '+F+";background-color:rgba("+j+","+A+","+z+","+B+')"> </p>':'<p region-id="'+N+'" class="dt-mar4r dt-mar4t pull-left" style="height: 14px;width: 20px;border:'+R+"px solid "+F+";background-color:rgba("+j+","+A+","+z+","+B+')"> </p>',i+="<span>"+O.title+"</span>",i+="</div>",l++}else O.hide(),O.label&&O.label instanceof BMap.Label&&O.label.hide()}i+="<hr class='dt-mar4y'>",i+="</div>",$(".filter-overlay-panel").append(i);var g=$(".filter-region-layer-"+e.id).find(".filter-region").length;0==g?$(".filter-region-layer-"+e.id).remove():$(".filter-region-layer-"+e.id).find(".filter-result-count").text(g)}else d.push(e);else Array.prototype.push.apply(d,a);MapUtils.hideAllFeatures(d),o+s+l>0?$(".filter-count").text(o+s+l):$(".filter-count").text(0),
$(".filter-overlay-panel").height($(window).height()-48-36),$("#filterInfoWrapper").removeClass("dt-none")},MapUtils.showAllFeatures=function(){for(var t=MarkerUtils.getMarkerLayers(),e=LineUtils.getLineLayers(),i=RegionUtils.getRegionLayers(),n=0;n<t.length;n++){var r=t[n];"undefined"!=typeof MonitorUtils&&has_message_audio&&MonitorUtils.showMonitors(r);var a=r.getMarkers().values();if(1==r.render_style&&"show"==r.display){r.removeMarkersFromMap();var o=r.getCanvasConfig();o=MapUtils.getCanvasStyle(o);for(var s=0;s<a.length;s++){var l=a[s];if(MapUtils.map.hasLayer(l))l.setStyle(o),"show"==r.display&&l.display&&l.addTo(MapUtils.map);else{var d=MarkerUtils.markerJson2Marker(l.obj,r);r.setMarker(d),d.addTo(MapUtils.map)}}}else if(2==r.render_style&&"show"==r.display){MapUtils.map.removeOverlay(MapUtils.map.dt_heatmap[r.id][0]);var h=r.heatmap_config,c=MarkerUtils.heatmapConfig(h.gradient,h.radius,r.id),u=h.field,p=h.max;null==p&&(p=2);for(var f=[],s=0;s<a.length;s++)if(a[s].lng!=-9999&&a[s].lat!=-9999){var l=a[s];l.display&&f.push(MarkerUtils.generateHeatmapPoint(l,u))}var m={radius:c.radius,maxOpacity:.8,scaleRadius:!1,latField:"lat",lngField:"lng",valueField:"count",gradient:c.gradient},g=new HeatmapOverlay(m),_={max:p,data:f};g.setData(_),g.addTo(MarkerUtils.map),"hide"==r.display&&g.hide(),$(".heatmap-canvas").parent().css("height",0),MapUtils.map.dt_heatmap[r.id]=[g,f,{max:p,field:u,config:c}]}else{var y=L.markerClusterGroup({spiderfyOnMaxZoom:!1,disableClusteringAtZoom:18});if("show"==r.display){for(var v=0;v<a.length;v++){var l=a[v];l.display&&(l.show(),y.addLayer(l),l.showLabel())}r.isCluster()&&(MarkerUtils.map.dt_clusterer[r.id].clearLayers(),MarkerUtils.map.dt_clusterer[r.id]=y,"show"==r.display&&MarkerUtils.map.addLayer(MarkerUtils.map.dt_clusterer[r.id]))}}}for(var b=0;b<i.length;b++){var r=i[b];"undefined"!=typeof MonitorUtils&&has_message_audio&&MonitorUtils.showMonitors(r);for(var w=r.getRegions().values(),x=0;x<w.length;x++){var k=w[x];k.display&&"show"==r.display&&(k.show(),k.showLabel())}}for(var C=0;C<e.length;C++){var r=e[C];"undefined"!=typeof MonitorUtils&&has_message_audio&&MonitorUtils.showMonitors(r);for(var T=r.getLines().values(),M=0;M<T.length;M++){var P=T[M];P.display&&"show"==r.display&&(P.show(),P.showLabel())}}$(".filter-count").text("0"),$("#filterInfoWrapper").addClass("dt-none")},MapUtils.hideAllFeatures=function(t){for(var e=0;e<t.length;e++){var i=t[e];CategoryUtils.removeVectors(i),i.hideFeatures(),"undefined"!=typeof MonitorUtils&&has_message_audio&&MonitorUtils.showMonitors(i,[])}},MapUtils.countCharacters=function(t){for(var e,i=0,n=0;n<t.length;n++)e=t.charCodeAt(n),e>=1&&e<=126||65376<=e&&e<=65439?i++:i+=2;return i},MapUtils.getTextFontFamily=function(t){var e=["SimSun","Microsoft YaHei","KaiTi"];return!t||isNaN(t)||t<0||t>=e.length?e[0]:e[t]},MapUtils.getCanvasStyle=function(t){var e={};return e.color=t.color,e.fillColor=t.color,e.shape=t.shape,e.fillOpacity=1,e.size=t.size,e},MapUtils.searchCity=function(t){var e=MapUtils.map.getBounds(),i=e.getSouthWest(),n=e.getNorthEast();i=i.lng+","+i.lat,n=n.lng+","+n.lat;var r=MapUtils.map.getZoom();$.ajax({url:search_city_url,type:"GET",cache:!1,data:{south_west:i,north_east:n,zoom:r},dataType:"json",success:function(e){t&&t(e.name)}})},MapUtils.autoComplete=function(t,e,i,n){if("undefined"==typeof needAutoComplete||needAutoComplete!==!1){if(MapUtils.autoCompleteTimer&&window.clearTimeout(MapUtils.autoCompleteTimer),0==$(".autocomplete").length){var r=$(t),a="top:"+(r.offset().top+r.parent().height())+"px;left:"+r.offset().left+"px;";"undefined"!=typeof isMobile&&null!=isMobile&&isMobile&&(a+="width:80%");var o='<div tabindex="0" class="autocomplete" style="position: absolute;width:200px;z-index:9999;'+a+'"></div>';$("body").append(o),$(document).on("click",function(){MapUtils.removeAutoComplete()})}e&&0!=e.length&&(MapUtils.autoCompleteTimer=window.setTimeout(function(){$.ajax({url:"https://api.map.baidu.com/place/v2/suggestion?s=1&query="+e+"&region="+i+"&output=json&ak="+baidu_key,type:"GET",dataType:"jsonp",success:function(t){if("ok"==t.message){$(".autocomplete").empty();for(var e="<table class='autocomplete-keyword' style='background:#fff;border:1px solid #7f9db9;width:100%'>",i=0;i<t.result.length;i++)e+="<tr>",e+="<td class='td'><span class='glyphicon glyphicon-search dt-mar6r'></span><span class='keyword'>"+t.result[i].name+" </span><span class='desc'>"+t.result[i].city+t.result[i].district+"</span></td>",e+="</tr>";e+="</table>";var r="";$(".autocomplete").append(e).show().unbind().click(function(t){$(t.target).hasClass("td")?r=$(t.target).children().last().text()+$(t.target).children().first().next().text():$(t.target).hasClass("keyword")?r=$(t.target).next().text()+$(t.target).text():$(t.target).hasClass("desc")&&(r=$(t.target).text()+$(t.target).prev().text()),MapUtils.removeAutoComplete(),n&&n(r)})}},error:function(){}})},200))}},MapUtils.removeAutoComplete=function(){$(".autocomplete").remove()},MapUtils.setCurrentCity=function(t){t&&($("#cur_city_name").text(t),$("#cur_city_spn").text(t))},MapUtils.selectMarkerFromTitle=function(t){for(var e=MarkerUtils.getMarkerLayers(),i=0;i<e.length;i++)for(var n=e[i].getMarkers(),r=0;r<n.length;r++)for(var a=n[r],o=0;a.attrs&&o<a.attrs.length;o++)if(a.attrs[o].value==t)return a;return null}}),function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define(i):e[t]=i()}("Dtwy",window,function(){"use strict";return L.Map.include({addOverlay:function(t){"undefined"==typeof t||null==t||!t instanceof L.Layer||this.options.renderer instanceof L.Canvas&&t.display===!1||t instanceof Dtwy.Marker&&null==t.getLatLng()||this.addLayer(t)},removeOverlay:function(t){"undefined"==typeof t||null==t||!t instanceof L.Layer||this.removeLayer(t)}}),L.Draw.Polyline=L.Draw.Polyline.extend({options:{touchIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"})}}),L.Draw.Polygon=L.Draw.Polygon.extend({options:{touchIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"})}}),L.Edit.PolyVerticesEdit.mergeOptions({touchIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"})}),L.Edit.SimpleShape.mergeOptions({touchMoveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move leaflet-touch-icon"}),touchResizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize leaflet-touch-icon"})}),L.Layer.include({_last_map:null,_isVisible:!0,cloneAttrs:function(){for(var t=new Array,e=0;e<this.attrs.length;e++){var i=this.attrs[e],n=new Object;n.field_type=i.field_type,n.id=i.id,n.is_show=i.is_show,n.key=i.key,n.value=i.value,t.push(n)}return t},getAttr:function(t){if(!t||!this.attrs||0==this.attrs.length)return null;for(var e=this.feature_id+"_"+t,i=0;i<this.attrs.length;i++)if(this.attrs[i].id==e)return this.attrs[i];return null},isVisible:function(){return this._map&&this._isVisible},show:function(){var t=this._last_map;t&&t.options.renderer instanceof L.Canvas?this.addTo(t):$(this.getElement()).show(),this._isVisible=!0},hide:function(){this._map&&(this._last_map=this._map,this._map.options.renderer instanceof L.Canvas?this.remove():$(this.getElement()).hide(),this._isVisible=!1)},"delete":function(){this.remove()},getLabel:function(){return this.getTooltip()},bindLabel:function(t,e){t&&t.length>0&&this.bindTooltip(t,e)},unBindLabel:function(){this.unbindTooltip()},showLabel:function(){var t=this,e=null;e=t instanceof Dtwy.Marker?t.getLabel():t.label,e&&e instanceof L.Tooltip&&e.show()},hideLabel:function(){var t=this,e=null;e=t instanceof Dtwy.Marker?t.getLabel():t.label,e&&e instanceof L.Tooltip&&e.hide()},getImages:function(t,e){$.ajax({url:t,data:{id:this.feature_id},type:"get",dataType:"json",cache:!1,success:function(t){e&&e(t.imgs)}})},enableEditing:function(){this._disableCurrentEditing();var t=this;t._map&&t.editing&&(t.editing.enabled()||(t.editing.enable(),t._map.fire(L.Draw.Event.EDITSTART,{overlay:t})))},disableEditing:function(){var t=this;t._map&&t.editing&&t.editing.enabled()&&(t.editing.disable(),t._map.fire(L.Draw.Event.EDITSTOP))},toggleEditing:function(){this._disableCurrentEditing();var t=this;t._map&&t.editing&&(t.editing.enabled()?this.disableEditing():this.enableEditing())},_disableCurrentEditing:function(){var t=this;if(t._map){var e=t._map.editingOverlay;if(e){var i=t&&t.type==e.type&&t.feature_id==e.feature_id;!i&&e.editing&&(e.editing.disable(),t._map.fire(L.Draw.Event.EDITSTOP))}}},setTop:function(){this.bringToFront()}}),{}}),function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define(i):e[t]=i()}("Marker",Dtwy,function(){"use strict";var t=L.Marker.extend({initialize:function(t,e){if(e&&e.data){var i=e.data;i.cooperation&&(this.cooperation=i.cooperation),this.type="marker",this.layer_id=i.marker_layer_id,this.feature_id=i.id,this.attrs=i.marker_attrs,this.imgs=i.imgs,this.label_field=i.label_field,this.label_style_type=i.label_style_type,this.uniform_title=i.uniform_title,i.user&&(this.user=i.user.nickname),this.created_at=i.created_at,this.display=i.display,"undefined"!=typeof i.title||null!=i.title?this.title=i.title.toString():this.title="",this.obj=i,"-9999"!=i.lng&&"-9999"!=i.lat||(this.isError=!0),this.locate_field=i.locate_field,delete e.data}e=L.Util.extend(e,{riseOnHover:!0}),L.Marker.prototype.initialize.call(this,t,e)},clone:function(){var e=this,i=e.getLatLng(),n=new t(i,e.options);return n.type="marker",n.feature_id=e.feature_id,n.layer_id=e.layer_id,n.attrs=e.attrs,n.label_field=e.label_field,n.label_style_type=e.label_style_type,n.uniform_title=e.uniform_title,n.display=e.display,n.imgs=e.imgs,n.title=e.title,n.marker=e,n},getCenter:function(){return this.getLatLng()},updateFromObj:function(t){if(t){var e=this;e.setPosition(L.latLng(t.lat,t.lng)),e.attrs=t.marker_attrs,e.display=t.display,e.uniform_title=t.uniform_title,e.label_field=t.label_field,e.label_style_type=t.label_style_type,e.imgs=t.imgs,"undefined"!=typeof t.title||null!=t.title?e.title=t.title.toString():e.title="",e.obj=t,t.display?e.show():e.hide()}},addTo:function(t){null!=this.getLatLng()&&L.Marker.prototype.addTo.call(this,t)},setLatLng:function(t){if(L.Marker.prototype.setLatLng.call(this,t),this.editing){var e=this.editing.enabled();this.editing=new L.Edit.Marker(this),e&&this.editing.enable()}},setPosition:function(t){this.setLatLng(t)},getTitle:function(){return this.title},getPosition:function(){return this.getLatLng()},getIcon:function(){return this.options.icon.options},setContent:function(t){this.options.icon.options.html=t},updateToServer:function(t,e){var i=this.getPosition(),n=L.Util.extend(t,{id:this.feature_id,lng:i.lng.toFixed(6),lat:i.lat.toFixed(6)});MapUtils.ajax2server(update_marker_url,"PUT",n,function(t){e&&e(t)})}});return t}),function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define(i):e[t]=i()}("Polyline",Dtwy,function(){"use strict";var t=L.Polyline.extend({initialize:function(t,e){if("string"==typeof t&&(t=MapUtils.convertStr2LeafletPath(t)),t){if(e&&e.data){var i=e.data;i.cooperation&&(this.cooperation=i.cooperation),this.display=i.display,this.type="line",this.feature_id=i.id,this.layer_id=i.line_layer_id,this.attrs=i.line_attrs,this.label=i.label,this.imgs=i.imgs,this.label_field=i.label_field,this.label_style_type=i.label_style_type,this.uniform_title=i.uniform_title,this.line_type=i.line_type,this.line_route=i.line_route,this.line_style=i.line_style,"undefined"!=typeof i.title||null!=i.title?this.title=i.title.toString():this.title="",e.color=i.line_style.strokeColor,e.weight=parseInt(i.line_style.strokeWeight),e.opacity=i.line_style.strokeOpacity,e.style=i.line_style.strokeStyle,"dashed"==i.line_style.strokeStyle?e.dashArray=2*e.weight+","+2*e.weight:e.dashArray="0,0"}e&&delete e.data,L.Polyline.prototype.initialize.call(this,t,e),this._setDecorator()}},onAdd:function(t){L.Polyline.prototype.onAdd.call(this,t),this.decorator&&this.decorator.addTo(t),this.wayPoints&&this.wayPoints.addTo(t)},onRemove:function(t){L.Polyline.prototype.onRemove.call(this,t),this.decorator&&this.decorator.remove(),this.wayPoints&&this.wayPoints.remove()},clone:function(){var e=this,i=e.getLatLngs(),n=new t(i,e.options);return n.type="line",n.feature_id=e.feature_id,n.layer_id=e.layer_id,n.attrs=e.attrs,n.label_field=e.label_field,n.label_style_type=e.label_style_type,n.uniform_title=e.uniform_title,n.display=e.display,n.imgs=e.imgs,n.title=e.title,n.line_style=e.line_style,n.line_route=e.line_route,n.line_type=e.line_type,n.line=e,n},updateFromObj:function(t){if(t){t.encoded_path&&(t.path=MapUtils.decodePath(t.encoded_path));var e=this;e.attrs=t.line_attrs,e.line_route=t.line_route,e.line_style=t.line_style,"undefined"!=typeof t.title||null!=t.title?e.title=t.title.toString():e.title="",e.setPath(t.path);var i=this.options;i.weight=parseInt(t.line_style.strokeWeight),i.color=t.line_style.strokeColor,i.opacity=t.line_style.strokeOpacity,i.style=t.line_style.strokeStyle,e.setStyle(i)}},"delete":function(){this.line_route&&this.wayPoints&&this.wayPoints.remove(),this.remove()},redraw:function(){L.Polyline.prototype.redraw.call(this),this.decorator&&(this._setDecorator(),this.decorator.redraw())},enableEditing:function(){this.line_route||L.Polyline.prototype.enableEditing.call(this)},setLatLngs:function(t){if(L.Polyline.prototype.setLatLngs.call(this,t),this.editing){var e=this.editing.enabled();this.editing.disable(),this.editing=new L.Edit.Poly(this,this.options.poly),e&&this.editing.enable()}},getPath:function(){return this.getLatLngs()},getPathString:function(){var t=[],e=this.getPath();if(e)for(var i=0;i<e.length;i++){var n=e[i].lng.toFixed(6),r=e[i].lat.toFixed(6);t.push(n+","+r)}return t.join(";")},setPath:function(t){var e=MapUtils.convertStr2LeafletPath(t);this.setLatLngs(e),"arrow"!=this.options.style&&"arrow_node"!=this.options.style||this._setDecorator()},setStyle:function(t){t&&("dashed"==t.style?t.dashArray=2*t.weight+","+2*t.weight:t.dashArray="0,0",L.Polyline.prototype.setStyle.call(this,t),"arrow"==t.style||"arrow_node"==t.style?(this._setDecorator(),this._map&&this.decorator&&!this.decorator._map&&this.decorator.addTo(this._map)):this._map&&this.decorator&&this.decorator._map&&this.decorator.remove())},setStrokeColor:function(t){var e=this.options;e.color=t,this.setStyle(e)},getStrokeColor:function(){return this.options.color},setStrokeOpacity:function(t){var e=this.options;e.opacity=t,this.setStyle(e)},getStrokeOpacity:function(){return this.options.opacity},setStrokeWeight:function(t){var e=this.options;e.weight=parseInt(t),this.setStyle(e)},getStrokeWeight:function(){return this.options.weight},setStrokeStyle:function(t){var e=this.options;e.style=t,this.setStyle(e)},getStrokeStyle:function(){return this.options.style},updateToServer:function(t,e){var i=L.Util.extend(t,{id:this.feature_id,path:this.getPathString()});MapUtils.ajax2server(update_line_url,"PUT",i,function(t){e&&e(t)})},_setDecorator:function(){var t,e=this.options;if("arrow"==e.style)t=[{offset:"100%",repeat:0,symbol:L.Symbol.arrowHead({pixelSize:2*e.weight,polygon:!0,pathOptions:{stroke:!0,color:e.color,weight:e.weight,opacity:e.opacity,fillColor:e.color,fillOpacity:e.opacity}})}];else if("arrow_node"==e.style){t=[];var i=[],n=0,r=0,a=this.getLatLngs(),o=a[0];for(r=1;r<a.length;r++){var s=a[r];n+=o.distanceTo(s),i.push(n),o=s}for(r=0;r<i.length;r++){var l=100*i[r]/n+"%",d={offset:l,repeat:0,symbol:L.Symbol.arrowHead({pixelSize:2*e.weight,polygon:!0,pathOptions:{stroke:!0,color:e.color,weight:e.weight,opacity:e.opacity,fillColor:e.color,fillOpacity:e.opacity}})};t.push(d)}}t&&(this.decorator?(this.decorator.setPaths(this),this.decorator.setPatterns(t)):this.decorator=L.polylineDecorator(this,{patterns:t}))}});return t}),function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define(i):e[t]=i()}("Polygon",Dtwy,function(){"use strict";var t=L.Polygon.extend({initialize:function(t,e){if("string"==typeof t&&(t=MapUtils.convertStr2LeafletPath(t)),t){if(e&&e.data){var i=e.data;i.cooperation&&(this.cooperation=i.cooperation),this.type="region",this.display=i.display,this.region_type=i.region_type,this.feature_id=i.id,this.layer_id=i.region_layer_id,this.attrs=i.region_attrs,this.imgs=i.imgs,this.label=i.label,this.label_field=i.label_field,this.label_style_type=i.label_style_type,this.uniform_title=i.uniform_title,this.region_style=i.region_style,"undefined"!=typeof i.code||null!=i.code?this.code=i.code:this.code="","undefined"!=typeof i.parent_code||null!=i.parent_code?this.parent_code=i.parent_code:this.parent_code="","undefined"!=typeof i.title||null!=i.title?this.title=i.title.toString():this.title="",e.color=i.region_style.strokeColor,e.weight=parseInt(i.region_style.strokeWeight),e.opacity=i.region_style.strokeOpacity,"dashed"==i.region_style.strokeStyle?e.dashArray=2*e.weight+","+2*e.weight:e.dashArray=null,e.fillColor=i.region_style.fillColor,e.fillOpacity=i.region_style.fillOpacity,delete e.data}L.Polygon.prototype.initialize.call(this,t,e)}},clone:function(){var e=this,i=e.getLatLngs(),n=new t(i,e.options);return n.feature_id=e.feature_id,n.region=e,n.type="region",n.display=e.display,n.region_type=e.region_type,n.layer_id=e.layer_id,n.attrs=e.attrs,n.imgs=e.imgs,n.label=e.label,n.label_field=e.label_field,n.label_style_type=e.label_style_type,n.uniform_title=e.uniform_title,n.title=e.title,n},updateFromObj:function(t){if(t){t.encoded_path&&(t.path=MapUtils.decodePath(t.encoded_path));var e=this;e.setPath(t.path),e.setFillColor(t.region_style.fillColor),e.setFillOpacity(t.region_style.fillOpacity),e.setStrokeColor(t.region_style.strokeColor),e.setStrokeWeight(t.region_style.strokeWeight),e.setStrokeOpacity(t.region_style.strokeOpacity),e.setStrokeStyle(t.region_style.strokeStyle),e.attrs=t.region_attrs,"undefined"!=typeof t.title||null!=t.title?e.title=t.title.toString():e.title=""}},isComplex:function(){var t=this.getPath();return t.length>1},setLatLngs:function(t){if(L.Polygon.prototype.setLatLngs.call(this,t),this.editing){var e=this.editing.enabled();this.editing.disable(),this.editing=new L.Edit.Poly(this,this.options.poly),e&&this.editing.enable()}},getPath:function(){return this.getLatLngs()},getPathString:function(){var t=[],e=this.getPath();if(e)for(var i=0;i<e.length;i++){for(var n=[],r=e[i],a=0;a<r.length;a++){var o=r[a].lng.toFixed(6),s=r[a].lat.toFixed(6);n.push(o+","+s)}t.push(n.join(";"))}return t.join("|")},setPath:function(t){var e=MapUtils.convertStr2LeafletPath(t);this.setLatLngs(e)},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,r,a,o,s,l,d=this._rings[0],h=d.length;if(this._rings.length>1)for(t=1;t<this._rings.length;t++)h<this._rings[t].length&&(d=this._rings[t],h=d.length);if(!h)return null;for(a=o=s=0,t=0,e=h-1;t<h;e=t++)i=d[t],n=d[e],r=i.y*n.x-n.y*i.x,o+=(i.x+n.x)*r,s+=(i.y+n.y)*r,a+=3*r;return l=0===a?d[0]:[o/a,s/a],this._map.layerPointToLatLng(l)},setFillColor:function(t){var e=this.options;e.fillColor=t,this.setStyle(e)},getFillColor:function(){return this.options.fillColor},setFillOpacity:function(t){var e=this.options;e.fillOpacity=t,this.setStyle(e)},getFillOpacity:function(){return this.options.fillOpacity},setStrokeColor:function(t){var e=this.options;e.color=t,this.setStyle(e)},getStrokeColor:function(){return this.options.color},setStrokeOpacity:function(t){var e=this.options;e.opacity=t,this.setStyle(e)},getStrokeOpacity:function(){return this.options.opacity},setStrokeWeight:function(t){var e=this.options;e.weight=parseInt(t),this.setStyle(e)},getStrokeWeight:function(){return this.options.weight},setStrokeStyle:function(t){var e=this.options;"arrow"!=t&&"arrow_node"!=t||(t="solid"),"dashed"==t?e.dashArray=2*e.weight+","+2*e.weight:e.dashArray=null,this.setStyle(e)},getStrokeStyle:function(){return null==this.options.dashArray?"solid":"dashed"},updateToServer:function(t,e){var i=L.Util.extend(t,{id:this.feature_id,path:this.getPathString()});MapUtils.ajax2server(update_region_url,"PUT",i,function(t){e&&e(t)})}});return t}),function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define(i):e[t]=i()}("Circle",Dtwy,function(){"use strict";L.Circle.include({_project:function(){var t=this._latlng.lng,e=this._latlng.lat,i=this._map,n=i.options.crs;if(n.distance===L.CRS.Earth.distance||n.distance===L.CRS.BEPSG3857.distance){var r=Math.PI/180,a=this._mRadius/n.R/r,o=i.project([e+a,t]),s=i.project([e-a,t]),l=o.add(s).divideBy(2),d=i.unproject(l).lat,h=Math.acos((Math.cos(a*r)-Math.sin(e*r)*Math.sin(d*r))/(Math.cos(e*r)*Math.cos(d*r)))/r;(isNaN(h)||0===h)&&(h=a/Math.cos(Math.PI/180*e)),this._point=l.subtract(i.getPixelOrigin()),this._radius=isNaN(h)?0:Math.max(Math.round(l.x-i.project([d,t-h]).x),1),this._radiusY=Math.max(Math.round(l.y-o.y),1)}else{var c=n.unproject(n.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(c).x}this._updateBounds()}});var t=L.Circle.extend({initialize:function(t,e){var i,n;if("string"==typeof t){var r=t.split(";"),a=r[0].split(",");i=new L.LatLng(a[1],a[0]),n=parseFloat(r[1])}else t&&(i=t.center,n=t.radius);if(i&&n){if(e&&e.data){var o=e.data;o.cooperation&&(this.cooperation=o.cooperation),this.type="region",this.display=o.display,this.region_type=o.region_type,this.feature_id=o.id,this.layer_id=o.region_layer_id,this.attrs=o.region_attrs,this.imgs=o.imgs,this.label=o.label,this.label_field=o.label_field,this.label_style_type=o.label_style_type,this.uniform_title=o.uniform_title,this.region_style=o.region_style,"undefined"!=typeof o.code||null!=o.code?this.code=o.code:this.code="","undefined"!=typeof o.parent_code||null!=o.parent_code?this.parent_code=o.parent_code:this.parent_code="","undefined"!=typeof o.title||null!=o.title?this.title=o.title.toString():this.title="",e.color=o.region_style.strokeColor,e.weight=parseInt(o.region_style.strokeWeight),e.opacity=o.region_style.strokeOpacity,"dashed"==o.region_style.strokeStyle?e.dashArray=2*e.weight+","+2*e.weight:e.dashArray=null,e.fillColor=o.region_style.fillColor,e.fillOpacity=o.region_style.fillOpacity}L.Circle.prototype.initialize.call(this,i,n,e)}},clone:function(){var e=this,i={center:e.getLatLng(),radius:e.getRadius()},n=new t(i,e.options);return n.feature_id=e.feature_id,n.region=e,n.type="region",n.display=e.display,n.region_type=e.region_type,n.layer_id=e.layer_id,n.attrs=e.attrs,n.imgs=e.imgs,n.label=e.label,n.label_field=e.label_field,n.label_style_type=e.label_style_type,n.uniform_title=e.uniform_title,n.title=e.title,n},updateFromObj:function(t){if(t){t.encoded_path.indexOf(";")<0?t.path=MapUtils.path2CenterRadius(t.encoded_path):t.path=t.encoded_path;var e=this;e.setPath(t.path),e.setFillColor(t.region_style.fillColor),e.setFillOpacity(t.region_style.fillOpacity),e.setStrokeColor(t.region_style.strokeColor),e.setStrokeWeight(t.region_style.strokeWeight),e.setStrokeOpacity(t.region_style.strokeOpacity),e.setStrokeStyle(t.region_style.strokeStyle),e.attrs=t.region_attrs,"undefined"!=typeof t.title||null!=t.title?e.title=t.title.toString():e.title="",e.display?e.show():e.hide()}},setCenter:function(t){this.setLatLng(t)},getCenter:function(){return this.getLatLng()},getPath:function(){return{center:this.getLatLng(),radius:this.getRadius()}},getPathString:function(){var t=this.getLatLng(),e=this.getRadius();return[t.lng,t.lat].join(",")+";"+e},setPath:function(t){var e,i;if("string"==typeof t){var n=t.split(";"),r=n[0].split(",");e=new L.LatLng(r[1],r[0]),i=parseFloat(n[1])}e&&i&&(this.setCenter(e),this.setRadius(i))},setFillColor:function(t){var e=this.options;e.fillColor=t,this.setStyle(e)},getFillColor:function(){return this.options.fillColor},setFillOpacity:function(t){var e=this.options;e.fillOpacity=t,this.setStyle(e)},getFillOpacity:function(){return this.options.fillOpacity},setStrokeColor:function(t){var e=this.options;e.color=t,this.setStyle(e)},getStrokeColor:function(){return this.options.color},setStrokeOpacity:function(t){var e=this.options;e.opacity=t,this.setStyle(e)},getStrokeOpacity:function(){return this.options.opacity},setStrokeWeight:function(t){var e=this.options;e.weight=parseInt(t),this.setStyle(e)},getStrokeWeight:function(){return this.options.weight},setStrokeStyle:function(t){var e=this.options;"arrow"!=t&&"arrow_node"!=t||(t="solid"),"dashed"==t?e.dashArray=2*e.weight+","+2*e.weight:e.dashArray=null,this.setStyle(e)},getStrokeStyle:function(){return null==this.options.dashArray?"solid":"dashed"},updateToServer:function(t,e){var i=L.Util.extend(t,{id:this.feature_id,path:this.getPathString()});MapUtils.ajax2server(update_region_url,"PUT",i,function(t){e&&e(t)})}});return t}),function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define(i):e[t]=i()}("CanvasMarker",Dtwy,function(){"use strict";var t=L.Path.extend({options:{stroke:!1,color:"#FF0000",weight:1,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!0,fillColor:"#FF0000",fillOpacity:1,fillRule:"nonzero",interactive:!0,size:"small",shape:"square"},initialize:function(t,e){if(e&&e.data){var i=e.data;i.cooperation&&(this.cooperation=i.cooperation),this.type="marker",this.icon=i.icon,this.layer_id=i.marker_layer_id,this.feature_id=i.id,this.attrs=i.marker_attrs,this.imgs=i.imgs,this.label_field=i.label_field,this.label_style_type=i.label_style_type,this.uniform_title=i.uniform_title,i.user&&(this.user=i.user.nickname),this.created_at=i.created_at,this.display=i.display,"undefined"!=typeof i.title||null!=i.title?this.title=i.title.toString():this.title="",this.obj=i,"-9999"!=i.lng&&"-9999"!=i.lat||(this.isError=!0),this.locate_field=i.locate_field,delete e.data}L.setOptions(this,e),this._latlng=L.latLng(t),this._bounds=new L.LatLngBounds,this._bounds.extend(t),this.options.size=this._convertBDSize(e.size),this.options.shape=this._convertBDShape(e.shape)},_convertBDSize:function(t){return{BMAP_POINT_SIZE_SMALL:"small",BMAP_POINT_SIZE_NORMAL:"medium",BMAP_POINT_SIZE_BIG:"large"}[t]},_convertBDShape:function(t){return{BMAP_POINT_SHAPE_CIRCLE:"circle",BMAP_POINT_SHAPE_STAR:"pentagram",BMAP_POINT_SHAPE_SQUARE:"square",BMAP_POINT_SHAPE_RHOMBUS:"diamond",BMAP_POINT_SHAPE_WATERDROP:"circle"}[t]},setLatLng:function(t){return this._latlng=L.latLng(t),this._bounds=new L.LatLngBounds,this._bounds.extend(t),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setSize:function(t){return t.indexOf("BMAP_")>-1&&(t=this._convertBDSize(t)),this.options.size=t,this.redraw()},getSize:function(){return this.options.size},setColor:function(t){return this.options.color=t,this.options.fillColor=t,this.redraw()},getColor:function(){return this.options.color},setShape:function(t){return t.indexOf("BMAP_")>-1&&(t=this._convertBDShape(t)),this.options.shape=t,this.redraw()},getShape:function(){return this.options.shape},setStyle:function(t){if(t)return t.size.indexOf("BMAP_")>-1?this.options.size=this._convertBDSize(t.size):this.options.size=t.size,t.shape.indexOf("BMAP_")>-1?this.options.shape=this._convertBDShape(t.shape):this.options.shape=t.shape,this.options.fillColor=this.options.color=t.color,this.redraw()},_project:function(){if("circle"==this.options.shape)this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds();else{var t=new L.Bounds;this._rings=[],this._projectLatlng(this._latlng,this._rings,t);var e=this._clickTolerance(),i=new L.Point(e,e);this._bounds.isValid()&&t.isValid()&&(t.min._subtract(i),t.max._add(i),this._pxBounds=t)}},_updateBounds:function(){this._radius=4,"small"==this.options.size?this._radius=4:"medium"==this.options.size?this._radius=6:"large"==this.options.size&&(this._radius=8);var t=this._radius,e=this._radiusY||t,i=this._clickTolerance(),n=[t+i,e+i];this._pxBounds=new L.Bounds(this._point.subtract(n),this._point.add(n))},_projectLatlng:function(t,e,i){var n=7,r=[],a=this._map.latLngToLayerPoint(t);if("small"==this.options.size?n=7:"medium"==this.options.size?n=9:"large"==this.options.size&&(n=12),"square"==this.options.shape)n*=1.2,r=[L.point(a.x-n/2,a.y-n/2),L.point(a.x-n/2,a.y+n/2),L.point(a.x+n/2,a.y+n/2),L.point(a.x+n/2,a.y-n/2)],this._width=n,this._height=n;else if("diamond"==this.options.shape)n*=1.2,r=[L.point(a.x,a.y-.7*n),L.point(a.x+.7*n,a.y),L.point(a.x,a.y+.7*n),L.point(a.x-.7*n,a.y)],this._width=1.4*n,this._height=1.4*n;else if("pentagram"==this.options.shape){for(var o=n,s=2*Math.PI/5,l=-18*Math.PI/180,d=o*Math.sin(s/4)/Math.cos(s/2),h=-54*Math.PI/180,c=0;c<5;c++)r.push(L.point(Math.cos(c*s+h)*d+a.x,Math.sin(c*s+h)*d+a.y)),r.push(L.point(Math.cos(c*s+l)*o+a.x,Math.sin(c*s+l)*o+a.y));this._width=2*n,this._height=2*n}for(var u=[],p=0;p<r.length;p++)u[p]=r[p],i.extend(u[p]);e.push(u)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t)){if(this.options.noClip)return void(this._parts=this._rings);var e,i,n,r,a,o,s,l=this._parts;for(e=0,n=0,r=this._rings.length;e<r;e++)for(s=this._rings[e],i=0,a=s.length;i<a-1;i++)o=L.LineUtil.clipSegment(s[i],s[i+1],t,i,!0),o&&(l[n]=l[n]||[],l[n].push(o[0]),o[1]===s[i+1]&&i!==a-2||(l[n].push(o[1]),n++))}},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_update:function(){this._map&&this._updatePath()},_updatePath:function(){"circle"==this.options.shape?this._renderer._updateCircle(this,!0):(this._clipPoints(),this._renderer._updatePoly(this,!0))},_containsPoint:function(t){return"circle"==this.options.shape?this._circleContainsPoint(t):this._polygonContainsPoint(t)},_polygonContainsPoint:function(t){var e,i,n,r,a,o,s,l,d=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(r=0,s=this._parts.length;r<s;r++)for(e=this._parts[r],a=0,l=e.length,o=l-1;a<l;o=a++)i=e[a],n=e[o],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(d=!d);return d||L.Polyline.prototype._containsPoint.call(this,t,!0)},_circleContainsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()},clone:function(){var e=this,i=e.getLatLng(),n=new t(i,e.options);return n.type="marker",n.feature_id=e.feature_id,n.layer_id=e.layer_id,n.attrs=e.attrs,n.label_field=e.label_field,n.label_style_type=e.label_style_type,n.uniform_title=e.uniform_title,n.display=e.display,n.imgs=e.imgs,n.title=e.title,n.marker=e,n},getCenter:function(){return this.getLatLng()},updateFromObj:function(t){if(t){var e=this;e.setPosition(L.latLng(t.lat,t.lng)),e.attrs=t.marker_attrs,e.display=t.display,e.uniform_title=t.uniform_title,e.label_field=t.label_field,e.label_style_type=t.label_style_type,e.imgs=t.imgs,"undefined"!=typeof t.title||null!=t.title?e.title=t.title.toString():e.title="",e.obj=t,t.display?e.show():e.hide()}},getIcon:function(){return this.options.icon.options},setPosition:function(t){this.setLatLng(t)},getTitle:function(){return this.title},getPosition:function(){return this.getLatLng()},updateToServer:function(t,e){var i=this.getPosition(),n=L.Util.extend(t,{id:this.feature_id,lng:i.lng,lat:i.lat});MapUtils.ajax2server(update_marker_url,"PUT",n,function(t){e&&e(t)})}});return t}),L.Edit=L.Edit||{},L.Edit.CanvasMarker=L.Edit.SimpleShape.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),iconAnchor:new L.Point(8,8),className:"leaflet-edit-move leaflet-edit-marker-selected"})},_createMoveMarker:function(){var t,e,i=this._shape.getLatLng();"circle"==this._shape.options.shape?(t=2*this._shape._radius+4,e=2*this._shape._radius+4):"square"==this._shape.options.shape?(t=parseInt(this._shape._width+8),e=parseInt(this._shape._height+8)):(t=parseInt(this._shape._width),e=parseInt(this._shape._height)),this.options.moveIcon=new L.DivIcon({iconSize:new L.Point(t,e),iconAnchor:new L.Point(t/2+4,e/2+4),className:"leaflet-edit-move leaflet-edit-marker-selected"}),this._moveMarker=this._createMarker(i,this.options.moveIcon)},_createResizeMarker:function(){this._resizeMarkers=[]},_onMarkerDragStart:function(){this._shape.fire("editstart")},_move:function(t){this._shape.setLatLng(t)},_onMarkerDragEnd:function(){this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})}}),Dtwy.CanvasMarker.addInitHook(function(){L.Edit.CanvasMarker&&(this.editing=new L.Edit.CanvasMarker(this),this.options.editable&&this.editing.enable()),
this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()})});var styleHashMap=new DT.HashMap;styleHashMap.put("normal",new DT.HashMap),styleHashMap.get("normal").put("road",{featureType:"road",elementType:"all",stylers:{visibility:"off"}}),styleHashMap.get("normal").put("poi",[{featureType:"poi",elementType:"all",stylers:{visibility:"off"}},{featureType:"all",elementType:"labels.text.stroke",stylers:{visibility:"off"}},{featureType:"all",elementType:"labels.text.fill",stylers:{visibility:"off"}}]),styleHashMap.get("normal").put("water",{featureType:"water",elementType:"all",stylers:{visibility:"off"}}),styleHashMap.get("normal").put("land",{featureType:"land",elementType:"all",stylers:{visibility:"off"}}),styleHashMap.get("normal").put("building",{featureType:"building",elementType:"all",stylers:{visibility:"off"}}),styleHashMap.get("normal").put("all",[{featureType:"building",elementType:"all"},{featureType:"road",elementType:"all"},{featureType:"poi",elementType:"all"},{featureType:"water",elementType:"all"},{featureType:"building",elementType:"all"}]),styleHashMap.put("dark",new DT.HashMap),styleHashMap.get("dark").put("road",[{featureType:"land",elementType:"geometry",stylers:{color:"#212121"}},{featureType:"building",elementType:"geometry",stylers:{color:"#2b2b2b"}},{featureType:"highway",elementType:"all",stylers:{lightness:-42,saturation:-91}},{featureType:"arterial",elementType:"geometry",stylers:{lightness:-77,saturation:-94}},{featureType:"water",elementType:"geometry",stylers:{color:"#181818"}},{featureType:"green",elementType:"geometry",stylers:{color:"#1b1b1b"}},{featureType:"subway",elementType:"geometry.stroke",stylers:{color:"#181818"}},{featureType:"railway",elementType:"geometry",stylers:{lightness:-52}},{featureType:"all",elementType:"labels.text.stroke",stylers:{color:"#313131"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#8b8787"}},{featureType:"manmade",elementType:"geometry",stylers:{color:"#1b1b1b"}},{featureType:"local",elementType:"geometry",stylers:{lightness:-75,saturation:-91}},{featureType:"subway",elementType:"geometry",stylers:{lightness:-65}},{featureType:"railway",elementType:"all",stylers:{lightness:-40}},{featureType:"road",elementType:"geometry",stylers:{color:"#8b8787",weight:"1",lightness:-29,visibility:"off"}}]),styleHashMap.get("dark").put("water",[{featureType:"land",elementType:"geometry",stylers:{color:"#212121"}},{featureType:"building",elementType:"geometry",stylers:{color:"#2b2b2b"}},{featureType:"highway",elementType:"all",stylers:{lightness:-42,saturation:-91}},{featureType:"arterial",elementType:"geometry",stylers:{lightness:-77,saturation:-94}},{featureType:"green",elementType:"geometry",stylers:{color:"#1b1b1b"}},{featureType:"water",elementType:"geometry",stylers:{color:"#181818",visibility:"off"}},{featureType:"subway",elementType:"geometry.stroke",stylers:{color:"#181818"}},{featureType:"railway",elementType:"geometry",stylers:{lightness:-52}},{featureType:"all",elementType:"labels.text.stroke",stylers:{color:"#313131"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#8b8787"}},{featureType:"manmade",elementType:"geometry",stylers:{color:"#1b1b1b"}},{featureType:"local",elementType:"geometry",stylers:{lightness:-75,saturation:-91}},{featureType:"subway",elementType:"geometry",stylers:{lightness:-65}},{featureType:"railway",elementType:"all",stylers:{lightness:-40}}]),styleHashMap.get("dark").put("land",[{featureType:"land",elementType:"geometry",stylers:{color:"#212121",visibility:"off"}},{featureType:"building",elementType:"geometry",stylers:{color:"#2b2b2b"}},{featureType:"highway",elementType:"all",stylers:{lightness:-42,saturation:-91}},{featureType:"arterial",elementType:"geometry",stylers:{lightness:-77,saturation:-94}},{featureType:"water",elementType:"geometry",stylers:{color:"#181818"}},{featureType:"green",elementType:"geometry",stylers:{color:"#1b1b1b"}},{featureType:"subway",elementType:"geometry.stroke",stylers:{color:"#181818"}},{featureType:"railway",elementType:"geometry",stylers:{lightness:-52}},{featureType:"all",elementType:"labels.text.stroke",stylers:{color:"#313131"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#8b8787"}},{featureType:"manmade",elementType:"geometry",stylers:{color:"#1b1b1b"}},{featureType:"local",elementType:"geometry",stylers:{lightness:-75,saturation:-91}},{featureType:"subway",elementType:"geometry",stylers:{lightness:-65}},{featureType:"railway",elementType:"all",stylers:{lightness:-40}},{featureType:"road",elementType:"geometry",stylers:{color:"#8b8787",weight:"1",lightness:-29}}]),styleHashMap.get("dark").put("poi",[{featureType:"land",elementType:"geometry",stylers:{color:"#212121"}},{featureType:"building",elementType:"geometry",stylers:{color:"#2b2b2b"}},{featureType:"highway",elementType:"all",stylers:{lightness:-42,saturation:-91}},{featureType:"arterial",elementType:"geometry",stylers:{lightness:-77,saturation:-94}},{featureType:"water",elementType:"geometry",stylers:{color:"#181818"}},{featureType:"green",elementType:"geometry",stylers:{color:"#1b1b1b"}},{featureType:"subway",elementType:"geometry.stroke",stylers:{color:"#181818"}},{featureType:"railway",elementType:"geometry",stylers:{lightness:-52}},{featureType:"all",elementType:"labels.text.stroke",stylers:{color:"#313131",visibility:"off"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#8b8787",visibility:"off"}},{featureType:"manmade",elementType:"geometry",stylers:{color:"#1b1b1b"}},{featureType:"local",elementType:"geometry",stylers:{lightness:-75,saturation:-91}},{featureType:"subway",elementType:"geometry",stylers:{lightness:-65}},{featureType:"railway",elementType:"all",stylers:{lightness:-40}}]),styleHashMap.get("dark").put("building",[{featureType:"land",elementType:"geometry",stylers:{color:"#212121"}},{featureType:"building",elementType:"geometry",stylers:{color:"#2b2b2b",visibility:"off"}},{featureType:"highway",elementType:"all",stylers:{lightness:-42,saturation:-91}},{featureType:"arterial",elementType:"geometry",stylers:{lightness:-77,saturation:-94}},{featureType:"water",elementType:"geometry",stylers:{color:"#181818"}},{featureType:"green",elementType:"geometry",stylers:{color:"#1b1b1b"}},{featureType:"subway",elementType:"geometry.stroke",stylers:{color:"#181818"}},{featureType:"railway",elementType:"geometry",stylers:{lightness:-52}},{featureType:"all",elementType:"labels.text.stroke",stylers:{color:"#313131"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#8b8787"}},{featureType:"manmade",elementType:"geometry",stylers:{color:"#1b1b1b"}},{featureType:"local",elementType:"geometry",stylers:{lightness:-75,saturation:-91}},{featureType:"subway",elementType:"geometry",stylers:{lightness:-65}},{featureType:"railway",elementType:"all",stylers:{lightness:-40}}]),styleHashMap.put("light",new DT.HashMap),styleHashMap.get("light").put("road",[{featureType:"land",elementType:"geometry",stylers:{color:"#e7f7fc"}},{featureType:"water",elementType:"all",stylers:{color:"#96b5d6"}},{featureType:"green",elementType:"all",stylers:{color:"#b0d3dd"}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#a6cfcf"}},{featureType:"highway",elementType:"geometry.stroke",stylers:{color:"#7dabb3"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#e7f7fc"}},{featureType:"arterial",elementType:"geometry.stroke",stylers:{color:"#b0d5d4"}},{featureType:"local",elementType:"labels.text.fill",stylers:{color:"#7a959a"}},{featureType:"local",elementType:"labels.text.stroke",stylers:{color:"#d6e4e5"}},{featureType:"arterial",elementType:"labels.text.fill",stylers:{color:"#374a46"}},{featureType:"highway",elementType:"labels.text.fill",stylers:{color:"#374a46"}},{featureType:"highway",elementType:"labels.text.stroke",stylers:{color:"#e9eeed"}},{featureType:"road",elementType:"all",stylers:{visibility:"off"}}]),styleHashMap.get("light").put("water",[{featureType:"land",elementType:"geometry",stylers:{color:"#e7f7fc"}},{featureType:"water",elementType:"all",stylers:{color:"#96b5d6",visibility:"off"}},{featureType:"green",elementType:"all",stylers:{color:"#b0d3dd"}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#a6cfcf"}},{featureType:"highway",elementType:"geometry.stroke",stylers:{color:"#7dabb3"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#e7f7fc"}},{featureType:"arterial",elementType:"geometry.stroke",stylers:{color:"#b0d5d4"}},{featureType:"local",elementType:"labels.text.fill",stylers:{color:"#7a959a"}},{featureType:"local",elementType:"labels.text.stroke",stylers:{color:"#d6e4e5"}},{featureType:"arterial",elementType:"labels.text.fill",stylers:{color:"#374a46"}},{featureType:"highway",elementType:"labels.text.fill",stylers:{color:"#374a46"}},{featureType:"highway",elementType:"labels.text.stroke",stylers:{color:"#e9eeed"}}]),styleHashMap.get("light").put("poi",[{featureType:"land",elementType:"geometry",stylers:{color:"#e7f7fc"}},{featureType:"water",elementType:"all",stylers:{color:"#96b5d6"}},{featureType:"green",elementType:"all",stylers:{color:"#b0d3dd"}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#a6cfcf"}},{featureType:"highway",elementType:"geometry.stroke",stylers:{color:"#7dabb3"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#e7f7fc"}},{featureType:"arterial",elementType:"geometry.stroke",stylers:{color:"#b0d5d4"}},{featureType:"local",elementType:"labels.text.fill",stylers:{color:"#7a959a",visibility:"off"}},{featureType:"local",elementType:"labels.text.stroke",stylers:{color:"#d6e4e5",visibility:"off"}},{featureType:"arterial",elementType:"labels.text.fill",stylers:{color:"#374a46",visibility:"off"}},{featureType:"highway",elementType:"labels.text.fill",stylers:{color:"#374a46",visibility:"off"}},{featureType:"highway",elementType:"labels.text.stroke",stylers:{color:"#e9eeed",visibility:"off"}},{featureType:"poi",elementType:"all",stylers:{color:"#e9eeed",visibility:"off"}},{featureType:"label",elementType:"labels.text.stroke",stylers:{color:"#e9eeed",visibility:"off"}}]),styleHashMap.get("light").put("land",[{featureType:"land",elementType:"geometry",stylers:{color:"#e7f7fc",visibility:"off"}},{featureType:"water",elementType:"all",stylers:{color:"#96b5d6"}},{featureType:"green",elementType:"all",stylers:{color:"#b0d3dd"}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#a6cfcf"}},{featureType:"highway",elementType:"geometry.stroke",stylers:{color:"#7dabb3"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#e7f7fc"}},{featureType:"arterial",elementType:"geometry.stroke",stylers:{color:"#b0d5d4"}},{featureType:"local",elementType:"labels.text.fill",stylers:{color:"#7a959a"}},{featureType:"local",elementType:"labels.text.stroke",stylers:{color:"#d6e4e5"}},{featureType:"arterial",elementType:"labels.text.fill",stylers:{color:"#374a46"}},{featureType:"highway",elementType:"labels.text.fill",stylers:{color:"#374a46"}},{featureType:"highway",elementType:"labels.text.stroke",stylers:{color:"#e9eeed"}}]),styleHashMap.get("light").put("building",[{featureType:"land",elementType:"geometry",stylers:{color:"#e7f7fc"}},{featureType:"water",elementType:"all",stylers:{color:"#96b5d6"}},{featureType:"green",elementType:"all",stylers:{color:"#b0d3dd"}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#a6cfcf"}},{featureType:"highway",elementType:"geometry.stroke",stylers:{color:"#7dabb3"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#e7f7fc"}},{featureType:"arterial",elementType:"geometry.stroke",stylers:{color:"#b0d5d4"}},{featureType:"local",elementType:"labels.text.fill",stylers:{color:"#7a959a"}},{featureType:"local",elementType:"labels.text.stroke",stylers:{color:"#d6e4e5"}},{featureType:"arterial",elementType:"labels.text.fill",stylers:{color:"#374a46"}},{featureType:"highway",elementType:"labels.text.fill",stylers:{color:"#374a46"}},{featureType:"highway",elementType:"labels.text.stroke",stylers:{color:"#e9eeed"}},{featureType:"building",elementType:"all",stylers:{color:"#e9eeed",visibility:"off"}}]),styleHashMap.put("googlelite",new DT.HashMap),styleHashMap.get("googlelite").put("road",[{featureType:"road",elementType:"all",stylers:{lightness:20,visibility:"off"}},{featureType:"highway",elementType:"geometry",stylers:{color:"#f49935"}},{featureType:"railway",elementType:"all",stylers:{visibility:"off"}},{featureType:"local",elementType:"labels",stylers:{visibility:"off"}},{featureType:"water",elementType:"all",stylers:{color:"#d1e5ff"}},{featureType:"poi",elementType:"labels",stylers:{visibility:"off"}}]),styleHashMap.get("googlelite").put("water",[{featureType:"road",elementType:"all",stylers:{lightness:20}},{featureType:"highway",elementType:"geometry",stylers:{color:"#f49935"}},{featureType:"railway",elementType:"all",stylers:{visibility:"off"}},{featureType:"local",elementType:"labels",stylers:{visibility:"off"}},{featureType:"water",elementType:"all",stylers:{color:"#d1e5ff",visibility:"off"}},{featureType:"poi",elementType:"labels",stylers:{visibility:"off"}}]),styleHashMap.get("googlelite").put("land",[{featureType:"road",elementType:"all",stylers:{lightness:20}},{featureType:"highway",elementType:"geometry",stylers:{color:"#f49935"}},{featureType:"railway",elementType:"all",stylers:{visibility:"off"}},{featureType:"local",elementType:"labels",stylers:{visibility:"off"}},{featureType:"water",elementType:"all",stylers:{color:"#d1e5ff",visibility:"off"}},{featureType:"poi",elementType:"labels",stylers:{visibility:"off"}},{featureType:"land",elementType:"all",stylers:{color:"#000000",hue:"#000000"}}]),styleHashMap.get("googlelite").put("poi",[{featureType:"road",elementType:"all",stylers:{lightness:20}},{featureType:"highway",elementType:"geometry",stylers:{color:"#f49935"}},{featureType:"railway",elementType:"all",stylers:{visibility:"off"}},{featureType:"local",elementType:"labels",stylers:{visibility:"off"}},{featureType:"water",elementType:"all",stylers:{color:"#d1e5ff",visibility:"off"}},{featureType:"poi",elementType:"labels",stylers:{visibility:"off"}},{featureType:"label",elementType:"all",stylers:{visibility:"off"}}]),styleHashMap.get("googlelite").put("building",[{featureType:"road",elementType:"all",stylers:{lightness:20}},{featureType:"highway",elementType:"geometry",stylers:{color:"#f49935"}},{featureType:"railway",elementType:"all",stylers:{visibility:"off"}},{featureType:"local",elementType:"labels",stylers:{visibility:"off"}},{featureType:"water",elementType:"all",stylers:{color:"#d1e5ff",visibility:"off"}},{featureType:"building",elementType:"all",stylers:{visibility:"off"}}]),styleHashMap.put("grassgreen",new DT.HashMap),styleHashMap.get("grassgreen").put("road",[{featureType:"water",elementType:"all",stylers:{color:"#72b8fe"}},{featureType:"road",elementType:"geometry.fill",stylers:{color:"#ffffff",visibility:"off"}},{featureType:"road",elementType:"geometry.stroke",stylers:{color:"#bababa",visibility:"off"}},{featureType:"road",elementType:"labels.text.fill",stylers:{color:"#767676"}},{featureType:"road",elementType:"labels.text.stroke",stylers:{color:"#ffffff"}},{featureType:"land",elementType:"all",stylers:{color:"#b8cb93"}}]),styleHashMap.get("grassgreen").put("water",[{featureType:"water",elementType:"all",stylers:{color:"#72b8fe",visibility:"off"}},{featureType:"road",elementType:"geometry.fill",stylers:{color:"#ffffff"}},{featureType:"road",elementType:"geometry.stroke",stylers:{color:"#bababa"}},{featureType:"road",elementType:"labels.text.fill",stylers:{color:"#767676"}},{featureType:"road",elementType:"labels.text.stroke",stylers:{color:"#ffffff"}},{featureType:"land",elementType:"all",stylers:{color:"#b8cb93"}}]),styleHashMap.get("grassgreen").put("land",[{featureType:"water",elementType:"all",stylers:{color:"#72b8fe"}},{featureType:"road",elementType:"geometry.fill",stylers:{color:"#ffffff"}},{featureType:"road",elementType:"geometry.stroke",stylers:{color:"#bababa"}},{featureType:"road",elementType:"labels.text.fill",stylers:{color:"#767676"}},{featureType:"road",elementType:"labels.text.stroke",stylers:{color:"#ffffff"}},{featureType:"land",elementType:"all",stylers:{color:"#b8cb93",visibility:"off"}}]),styleHashMap.get("grassgreen").put("poi",[{featureType:"water",elementType:"all",stylers:{color:"#72b8fe"}},{featureType:"road",elementType:"geometry.fill",stylers:{color:"#ffffff"}},{featureType:"road",elementType:"geometry.stroke",stylers:{color:"#bababa"}},{featureType:"road",elementType:"labels.text.fill",stylers:{color:"#767676"}},{featureType:"road",elementType:"labels.text.stroke",stylers:{color:"#ffffff"}},{featureType:"land",elementType:"all",stylers:{color:"#b8cb93"}},{featureType:"poi",elementType:"all",stylers:{visibility:"off"}},{featureType:"label",elementType:"all",stylers:{visibility:"off"}}]),styleHashMap.get("grassgreen").put("building",[{featureType:"water",elementType:"all",stylers:{color:"#72b8fe"}},{featureType:"road",elementType:"geometry.fill",stylers:{color:"#ffffff"}},{featureType:"road",elementType:"geometry.stroke",stylers:{color:"#bababa"}},{featureType:"road",elementType:"labels.text.fill",stylers:{color:"#767676"}},{featureType:"road",elementType:"labels.text.stroke",stylers:{color:"#ffffff"}},{featureType:"land",elementType:"all",stylers:{color:"#b8cb93"}},{featureType:"building",elementType:"all",stylers:{visibility:"off"}}]),styleHashMap.put("midnight",new DT.HashMap),styleHashMap.get("midnight").put("road",[{featureType:"water",elementType:"all",stylers:{color:"#021019"}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"highway",elementType:"geometry.stroke",stylers:{color:"#147a92"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"arterial",elementType:"geometry.stroke",stylers:{color:"#0b3d51"}},{featureType:"local",elementType:"geometry",stylers:{color:"#000000"}},{featureType:"land",elementType:"all",stylers:{color:"#08304b"}},{featureType:"railway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"railway",elementType:"geometry.stroke",stylers:{color:"#08304b"}},{featureType:"subway",elementType:"geometry",stylers:{lightness:-70}},{featureType:"building",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#857f7f"}},{featureType:"all",elementType:"labels.text.stroke",stylers:{color:"#000000"}},{featureType:"building",elementType:"geometry",stylers:{color:"#022338"}},{featureType:"green",elementType:"geometry",stylers:{color:"#062032"}},{featureType:"boundary",elementType:"all",stylers:{color:"#1e1c1c"}},{featureType:"road",elementType:"all",stylers:{color:"#022338",visibility:"off"}}]),styleHashMap.get("midnight").put("water",[{featureType:"water",elementType:"all",stylers:{color:"#021019",visibility:"off"}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"highway",elementType:"geometry.stroke",stylers:{color:"#147a92"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"arterial",elementType:"geometry.stroke",stylers:{color:"#0b3d51"}},{featureType:"local",elementType:"geometry",stylers:{color:"#000000"}},{featureType:"land",elementType:"all",stylers:{color:"#08304b"}},{featureType:"railway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"railway",elementType:"geometry.stroke",stylers:{color:"#08304b"}},{featureType:"subway",elementType:"geometry",stylers:{lightness:-70}},{featureType:"building",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#857f7f"}},{featureType:"all",elementType:"labels.text.stroke",stylers:{color:"#000000"}},{featureType:"building",elementType:"geometry",stylers:{color:"#022338"}},{featureType:"green",elementType:"geometry",stylers:{color:"#062032"}},{featureType:"boundary",elementType:"all",stylers:{color:"#1e1c1c"}},{featureType:"manmade",elementType:"all",stylers:{color:"#022338"}}]),styleHashMap.get("midnight").put("land",[{featureType:"water",elementType:"all",stylers:{color:"#021019"}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"highway",elementType:"geometry.stroke",stylers:{color:"#147a92"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"arterial",elementType:"geometry.stroke",stylers:{color:"#0b3d51"}},{featureType:"local",elementType:"geometry",stylers:{color:"#000000"}},{featureType:"land",elementType:"all",stylers:{color:"#000000",hue:"#000000"}},{featureType:"railway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"railway",elementType:"geometry.stroke",stylers:{color:"#08304b"}},{featureType:"subway",elementType:"geometry",stylers:{lightness:-70}},{featureType:"building",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#857f7f"}},{featureType:"all",elementType:"labels.text.stroke",stylers:{color:"#000000"}},{featureType:"building",elementType:"geometry",stylers:{color:"#022338"}},{featureType:"green",elementType:"geometry",stylers:{color:"#062032"}},{featureType:"boundary",elementType:"all",stylers:{color:"#1e1c1c"}},{featureType:"manmade",elementType:"all",stylers:{color:"#022338"}}]),styleHashMap.get("midnight").put("poi",[{featureType:"water",elementType:"all",stylers:{color:"#021019"}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"highway",elementType:"geometry.stroke",stylers:{color:"#147a92"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"arterial",elementType:"geometry.stroke",stylers:{color:"#0b3d51"}},{featureType:"local",elementType:"geometry",stylers:{color:"#000000"}},{featureType:"land",elementType:"all",stylers:{color:"#08304b"}},{featureType:"railway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"railway",elementType:"geometry.stroke",stylers:{color:"#08304b"}},{featureType:"subway",elementType:"geometry",stylers:{lightness:-70}},{featureType:"building",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#857f7f",visibility:"off"}},{featureType:"all",elementType:"labels.text.stroke",stylers:{color:"#000000"}},{featureType:"building",elementType:"geometry",stylers:{color:"#022338"}},{featureType:"green",elementType:"geometry",stylers:{color:"#062032"}},{featureType:"boundary",elementType:"all",stylers:{color:"#1e1c1c"}},{featureType:"manmade",elementType:"all",stylers:{color:"#022338"}}]),styleHashMap.get("midnight").put("building",[{featureType:"water",elementType:"all",stylers:{color:"#021019"}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"highway",elementType:"geometry.stroke",stylers:{color:"#147a92"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"arterial",elementType:"geometry.stroke",stylers:{color:"#0b3d51"}},{featureType:"local",elementType:"geometry",stylers:{color:"#000000"}},{featureType:"land",elementType:"all",stylers:{color:"#08304b"}},{featureType:"railway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"railway",elementType:"geometry.stroke",stylers:{color:"#08304b"}},{featureType:"subway",elementType:"geometry",stylers:{lightness:-70}},{featureType:"building",elementType:"geometry.fill",stylers:{visibility:"off"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#857f7f"}},{featureType:"all",elementType:"labels.text.stroke",stylers:{color:"#000000"}},{featureType:"building",elementType:"geometry",stylers:{color:"#022338"}},{featureType:"green",elementType:"geometry",stylers:{color:"#062032"}},{featureType:"boundary",elementType:"all",stylers:{color:"#1e1c1c"}},{featureType:"manmade",elementType:"all",stylers:{color:"#022338"}}]),styleHashMap.put("bluish",new DT.HashMap),styleHashMap.get("bluish").put("road",[{featureType:"all",elementType:"geometry",stylers:{hue:"#007fff",saturation:89}},{featureType:"road",elementType:"all",stylers:{visibility:"off"}}]),styleHashMap.get("bluish").put("water",[{featureType:"all",elementType:"geometry",stylers:{hue:"#007fff",saturation:89}},{featureType:"water",elementType:"all",stylers:{visibility:"off"}}]),styleHashMap.get("bluish").put("land",[{featureType:"all",elementType:"geometry",stylers:{hue:"#007fff",saturation:89}},{featureType:"land",elementType:"all",stylers:{color:"#000000"}}]),styleHashMap.get("bluish").put("poi",[{featureType:"all",elementType:"geometry",stylers:{hue:"#007fff",saturation:89}},{featureType:"water",elementType:"all",stylers:{color:"#ffffff"}},{featureType:"label",elementType:"all",stylers:{visibility:"off"}},{featureType:"poi",elementType:"all",stylers:{visibility:"off"}},{featureType:"all",elementType:"labels.text.stroke",stylers:{visibility:"off"}},{featureType:"all",elementType:"labels.text.fill",stylers:{visibility:"off"}}]),styleHashMap.get("bluish").put("building",[{featureType:"all",elementType:"geometry",stylers:{hue:"#007fff",saturation:89}},{featureType:"building",elementType:"all",stylers:{visibility:"off"}}]),styleHashMap.put("hardedge",new DT.HashMap),styleHashMap.get("hardedge").put("road",[{featureType:"land",elementType:"all",stylers:{lightness:100,saturation:-100}},{featureType:"water",elementType:"all",stylers:{lightness:47}},{featureType:"manmade",elementType:"geometry",stylers:{lightness:28}},{featureType:"road",elementType:"geometry.fill",stylers:{lightness:82}},{featureType:"road",elementType:"geometry.stroke",stylers:{lightness:-76,visibility:"off"}},{featureType:"green",elementType:"all",stylers:{lightness:63,saturation:-100}},{featureType:"boundary",elementType:"geometry.fill",stylers:{lightness:80,saturation:1}},{featureType:"boundary",elementType:"geometry.stroke",stylers:{lightness:-75,saturation:-100}}]),styleHashMap.get("hardedge").put("water",[{featureType:"land",elementType:"all",stylers:{lightness:100,saturation:-100}},{featureType:"water",elementType:"all",stylers:{lightness:47,visibility:"off"}},{featureType:"manmade",elementType:"geometry",stylers:{lightness:28}},{featureType:"road",elementType:"geometry.fill",stylers:{lightness:82}},{featureType:"road",elementType:"geometry.stroke",stylers:{lightness:-76}},{featureType:"green",elementType:"all",stylers:{lightness:63,saturation:-100}},{featureType:"boundary",elementType:"geometry.fill",stylers:{lightness:80,saturation:1}},{featureType:"boundary",elementType:"geometry.stroke",stylers:{lightness:-75,saturation:-100}}]),styleHashMap.get("hardedge").put("land",[{featureType:"land",elementType:"all",stylers:{color:"#000000"}},{featureType:"water",elementType:"all",stylers:{lightness:47}},{featureType:"manmade",elementType:"geometry",stylers:{lightness:28}},{featureType:"road",elementType:"geometry.fill",stylers:{lightness:82}},{featureType:"road",elementType:"geometry.stroke",stylers:{lightness:-76}},{featureType:"green",elementType:"all",stylers:{lightness:63,saturation:-100}},{featureType:"boundary",elementType:"geometry.fill",stylers:{lightness:80,saturation:1}},{featureType:"land",elementType:"geometry.stroke",stylers:{lightness:-75,saturation:-100}}]),styleHashMap.get("hardedge").put("poi",[{featureType:"land",elementType:"all",stylers:{lightness:100,saturation:-100}},{featureType:"water",elementType:"all",stylers:{lightness:47}},{featureType:"manmade",elementType:"geometry",stylers:{lightness:28}},{featureType:"road",elementType:"geometry.fill",stylers:{lightness:82}},{featureType:"road",elementType:"geometry.stroke",stylers:{lightness:-76}},{featureType:"green",elementType:"all",stylers:{lightness:63,saturation:-100}},{featureType:"boundary",elementType:"geometry.fill",stylers:{lightness:80,saturation:1}},{featureType:"poi",elementType:"all",stylers:{lightness:-75,saturation:-100,visibility:"off"}},{featureType:"all",elementType:"labels.text.stroke",stylers:{visibility:"off"}},{featureType:"all",elementType:"labels.text.fill",stylers:{visibility:"off"}}]),styleHashMap.get("hardedge").put("building",[{featureType:"land",elementType:"all",stylers:{lightness:100,saturation:-100}},{featureType:"water",elementType:"all",stylers:{lightness:47}},{featureType:"manmade",elementType:"geometry",stylers:{lightness:28}},{featureType:"road",elementType:"geometry.fill",stylers:{lightness:82}},{featureType:"road",elementType:"geometry.stroke",stylers:{lightness:-76}},{featureType:"green",elementType:"all",stylers:{lightness:63,saturation:-100}},{featureType:"boundary",elementType:"geometry.fill",stylers:{lightness:80,saturation:1}},{featureType:"building",elementType:"all",stylers:{lightness:-75,saturation:-100,visibility:"off"}}]),function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define(i):e[t]=i()}("MapUtils",Dtwy,function(){"use strict";var t={definedCRSs:{bepsg3857:L.CRS.BEPSG3857,epsg3395:L.CRS.EPSG3395,epsg3857:L.CRS.EPSG3857,epsg4326:L.CRS.EPSG4326,earth:L.CRS.Earth,simple:L.CRS.Simple},init:function(t,e){var i={renderer:L.canvas(),crs:this.definedCRSs[t.crs],attributionControl:!1,zoomControl:!1,scalePosition:"bottomleft"};t.min_level&&(i.minZoom=t.min_level),t.max_level&&(i.maxZoom=t.max_level),t.scalePosition&&(i.scalePosition=t.scalePosition);var n=new L.map("mapContainer",i),r=null,a=t.baseLayer;if(r="wmts"==a.type?new L.TileLayer.WMTS(a.url,a.options):"baidu"==a.type?new L.TileLayer.BaiduLayer(a):new L.tileLayer(a.url,{}),n.addLayer(r),n.baseLayer=r,t.init_center){var o,s=t.init_center,l=s.split(",");o=t.init_level?t.init_level:1,n.setView([l[1],l[0]],o)}L.control.zoom({position:"bottomright",zoomInTitle:"\u653e\u5927",zoomOutTitle:"\u7f29\u5c0f"}).addTo(n),L.control.scale({position:i.scalePosition,metric:!0,imperial:!1}).addTo(n),$(".leaflet-control-attribution").remove(),e&&e(n)}};return t}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery")):t(jQuery)}(function(t,e){"use strict";function i(e,i,n,r){for(var a=[],o=0;o<e.length;o++){var s=e[o];if(s){var l=tinycolor(s),d=l.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";d+=tinycolor.equals(i,s)?" sp-thumb-active":"";var h=l.toString(r.preferredFormat||"rgb"),c=g?"background-color:"+l.toRgbString():"filter:"+l.toFilter();a.push('<span title="'+h+'" data-color="'+l.toRgbString()+'" class="'+d+'"><span class="sp-thumb-inner" style="'+c+';" /></span>')}else{var u="sp-clear-display";a.push(t("<div />").append(t('<span data-color="" style="background-color:transparent;" class="'+u+'"></span>').attr("title",r.noColorSelectedText)).html())}}return"<div class='sp-cf "+n+"'>"+a.join("")+"</div>"}function n(){for(var t=0;t<f.length;t++)f[t]&&f[t].hide()}function r(e,i){var n=t.extend({},p,e);return n.callbacks={move:d(n.move,i),change:d(n.change,i),show:d(n.show,i),hide:d(n.hide,i),beforeShow:d(n.beforeShow,i)},n}function a(a,s){function d(){if(W.showPaletteOnly&&(W.showPalette=!0),zt.text(W.showPaletteOnly?W.togglePaletteMoreText:W.togglePaletteLessText),W.palette){pt=W.palette.slice(0),ft=t.isArray(pt[0])?pt:[pt],mt={};for(var e=0;e<ft.length;e++)for(var i=0;i<ft[e].length;i++){var n=tinycolor(ft[e][i]).toRgbString();mt[n]=!0}}kt.toggleClass("sp-flat",Z),kt.toggleClass("sp-input-disabled",!W.showInput),kt.toggleClass("sp-alpha-enabled",W.showAlpha),kt.toggleClass("sp-clear-enabled",Xt),kt.toggleClass("sp-buttons-disabled",!W.showButtons),kt.toggleClass("sp-palette-buttons-disabled",!W.togglePaletteOnly),kt.toggleClass("sp-palette-disabled",!W.showPalette),kt.toggleClass("sp-palette-only",W.showPaletteOnly),kt.toggleClass("sp-initial-disabled",!W.showInitial),kt.addClass(W.className).addClass(W.containerClassName),R()}function p(){function e(e){return e.data&&e.data.ignore?(E(t(e.target).closest(".sp-thumb-el").data("color")),j()):(E(t(e.target).closest(".sp-thumb-el").data("color")),j(),B(!0),W.hideAfterPaletteSelect&&S()),!1}if(m&&kt.find("*:not(input)").attr("unselectable","on"),d(),Ft&&wt.after(Nt).hide(),Xt||jt.hide(),Z)wt.after(kt).hide();else{var i="parent"===W.appendTo?wt.parent():t(W.appendTo);1!==i.length&&(i=t("body")),i.append(kt)}v(),Ht.bind("click.spectrum touchstart.spectrum",function(e){xt||$(),e.stopPropagation(),t(e.target).is("input")||e.preventDefault()}),(wt.is(":disabled")||W.disabled===!0)&&q(),
kt.click(l),It.change(T),It.bind("paste",function(){setTimeout(T,1)}),It.keydown(function(t){13==t.keyCode&&T()}),Ot.text(W.cancelText),Ot.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),I(),S()}),jt.attr("title",W.clearText),jt.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),Yt=!0,j(),Z&&B(!0)}),At.text(W.chooseText),At.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),m&&It.is(":focus")&&It.trigger("change"),O()&&(B(!0),S())}),zt.text(W.showPaletteOnly?W.togglePaletteMoreText:W.togglePaletteLessText),zt.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),W.showPaletteOnly=!W.showPaletteOnly,W.showPaletteOnly||Z||kt.css("left","-="+(Lt.outerWidth(!0)+5)),d()}),h(Dt,function(t,e,i){ut=t/ot,Yt=!1,i.shiftKey&&(ut=Math.round(10*ut)/10),j()},L,C),h($t,function(t,e){dt=parseFloat(e/rt),Yt=!1,W.showAlpha||(ut=1),j()},L,C),h(Ct,function(t,e,i){if(i.shiftKey){if(!vt){var n=ht*et,r=it-ct*it,a=Math.abs(t-n)>Math.abs(e-r);vt=a?"x":"y"}}else vt=null;var o=!vt||"x"===vt,s=!vt||"y"===vt;o&&(ht=parseFloat(t/et)),s&&(ct=parseFloat((it-e)/it)),Yt=!1,W.showAlpha||(ut=1),j()},L,C),Gt?(E(Gt),A(),Zt=W.preferredFormat||tinycolor(Gt).format,b(Gt)):A(),Z&&M();var n=m?"mousedown.spectrum":"click.spectrum touchstart.spectrum";Et.delegate(".sp-thumb-el",n,e),Ut.delegate(".sp-thumb-el:nth-child(1)",n,{ignore:!0},e)}function v(){if(Y&&window.localStorage){try{var e=window.localStorage[Y].split(",#");e.length>1&&(delete window.localStorage[Y],t.each(e,function(t,e){b(e)}))}catch(t){}try{gt=window.localStorage[Y].split(";")}catch(t){}}}function b(e){if(V){var i=tinycolor(e).toRgbString();if(!mt[i]&&t.inArray(i,gt)===-1)for(gt.push(i);gt.length>_t;)gt.shift();if(Y&&window.localStorage)try{window.localStorage[Y]=gt.join(";")}catch(t){}}}function w(){var t=[];if(W.showPalette)for(var e=0;e<gt.length;e++){var i=tinycolor(gt[e]).toRgbString();mt[i]||t.push(gt[e])}return t.reverse().slice(0,W.maxSelectionSize)}function x(){var e=U(),n=t.map(ft,function(t,n){return i(t,e,"sp-palette-row sp-palette-row-"+n,W)});v(),gt&&n.push(i(w(),e,"sp-palette-row sp-palette-row-selection",W)),Et.html(n.join(""))}function k(){if(W.showInitial){var t=Wt,e=U();Ut.html(i([t,e],e,"sp-palette-row-initial",W))}}function L(){(it<=0||et<=0||rt<=0)&&R(),tt=!0,kt.addClass(yt),vt=null,wt.trigger("dragstart.spectrum",[U()])}function C(){tt=!1,kt.removeClass(yt),wt.trigger("dragstop.spectrum",[U()])}function T(){var t=It.val();if(null!==t&&""!==t||!Xt){var e=tinycolor(t);e.isValid()?(E(e),B(!0)):It.addClass("sp-validation-error")}else E(null),B(!0)}function $(){J?S():M()}function M(){var e=t.Event("beforeShow.spectrum");return J?void R():(wt.trigger(e,[U()]),void(K.beforeShow(U())===!1||e.isDefaultPrevented()||(n(),J=!0,t(bt).bind("keydown.spectrum",P),t(bt).bind("click.spectrum",D),t(window).bind("resize.spectrum",Q),Nt.addClass("sp-active"),kt.removeClass("sp-hidden"),R(),A(),Wt=U(),k(),K.show(Wt),wt.trigger("show.spectrum",[Wt]))))}function P(t){27===t.keyCode&&S()}function D(t){2!=t.button&&(tt||(Vt?B(!0):I(),S()))}function S(){J&&!Z&&(J=!1,t(bt).unbind("keydown.spectrum",P),t(bt).unbind("click.spectrum",D),t(window).unbind("resize.spectrum",Q),Nt.removeClass("sp-active"),kt.addClass("sp-hidden"),K.hide(U()),wt.trigger("hide.spectrum",[U()]))}function I(){E(Wt,!0)}function E(t,e){if(tinycolor.equals(t,U()))return void A();var i,n;!t&&Xt?Yt=!0:(Yt=!1,i=tinycolor(t),n=i.toHsv(),dt=n.h%360/360,ht=n.s,ct=n.v,ut=n.a),A(),i&&i.isValid()&&!e&&(Zt=W.preferredFormat||i.getFormat())}function U(t){return t=t||{},Xt&&Yt?null:tinycolor.fromRatio({h:dt,s:ht,v:ct,a:Math.round(100*ut)/100},{format:t.format||Zt})}function O(){return!It.hasClass("sp-validation-error")}function j(){A(),K.move(U()),wt.trigger("move.spectrum",[U()])}function A(){It.removeClass("sp-validation-error"),z();var t=tinycolor.fromRatio({h:dt,s:1,v:1});Ct.css("background-color",t.toHexString());var e=Zt;ut<1&&(0!==ut||"name"!==e)&&("hex"!==e&&"hex3"!==e&&"hex6"!==e&&"name"!==e||(e="rgb"));var i=U({format:e}),n="";if(qt.removeClass("sp-clear-display"),qt.css("background-color","transparent"),!i&&Xt)qt.addClass("sp-clear-display");else{var r=i.toHexString(),a=i.toRgbString();if(g||1===i.alpha?qt.css("background-color",a):(qt.css("background-color","transparent"),qt.css("filter",i.toFilter())),W.showAlpha){var o=i.toRgb();o.a=0;var s=tinycolor(o).toRgbString(),l="linear-gradient(left, "+s+", "+r+")";m?Pt.css("filter",tinycolor(s).toFilter({gradientType:1},r)):(Pt.css("background","-webkit-"+l),Pt.css("background","-moz-"+l),Pt.css("background","-ms-"+l),Pt.css("background","linear-gradient(to right, "+s+", "+r+")"))}n=i.toString(e)}W.showInput&&It.val(n),W.showPalette&&x(),k()}function z(){var t=ht,e=ct;if(Xt&&Yt)St.hide(),Mt.hide(),Tt.hide();else{St.show(),Mt.show(),Tt.show();var i=t*et,n=it-e*it;i=Math.max(-nt,Math.min(et-nt,i-nt)),n=Math.max(-nt,Math.min(it-nt,n-nt)),Tt.css({top:n+"px",left:i+"px"});var r=ut*ot;St.css({left:r-st/2+"px"});var a=dt*rt;Mt.css({top:a-lt+"px"})}}function B(t){var e=U(),i="",n=!tinycolor.equals(e,Wt);e&&(i=e.toString(Zt),b(e)),Bt&&wt.val(i),t&&n&&(K.change(e),wt.trigger("change",[e]))}function R(){J&&(et=Ct.width(),it=Ct.height(),nt=Tt.height(),at=$t.width(),rt=$t.height(),lt=Mt.height(),ot=Dt.width(),st=St.width(),Z||(kt.css("position","absolute"),W.offset?kt.offset(W.offset):kt.offset(o(kt,Ht))),z(),W.showPalette&&x(),wt.trigger("reflow.spectrum"))}function F(){wt.show(),Ht.unbind("click.spectrum touchstart.spectrum"),kt.remove(),Nt.remove(),f[Kt.id]=null}function N(i,n){return i===e?t.extend({},W):n===e?W[i]:(W[i]=n,"preferredFormat"===i&&(Zt=W.preferredFormat),void d())}function H(){xt=!1,wt.attr("disabled",!1),Ht.removeClass("sp-disabled")}function q(){S(),xt=!0,wt.attr("disabled",!0),Ht.addClass("sp-disabled")}function G(t){W.offset=t,R()}var W=r(s,a),Z=W.flat,V=W.showSelectionPalette,Y=W.localStorageKey,X=W.theme,K=W.callbacks,Q=c(R,10),J=!1,tt=!1,et=0,it=0,nt=0,rt=0,at=0,ot=0,st=0,lt=0,dt=0,ht=0,ct=0,ut=1,pt=[],ft=[],mt={},gt=W.selectionPalette.slice(0),_t=W.maxSelectionSize,yt="sp-dragging",vt=null,bt=a.ownerDocument,wt=(bt.body,t(a)),xt=!1,kt=t(y,bt).addClass(X),Lt=kt.find(".sp-picker-container"),Ct=kt.find(".sp-color"),Tt=kt.find(".sp-dragger"),$t=kt.find(".sp-hue"),Mt=kt.find(".sp-slider"),Pt=kt.find(".sp-alpha-inner"),Dt=kt.find(".sp-alpha"),St=kt.find(".sp-alpha-handle"),It=kt.find(".sp-input"),Et=kt.find(".sp-palette"),Ut=kt.find(".sp-initial"),Ot=kt.find(".sp-cancel"),jt=kt.find(".sp-clear"),At=kt.find(".sp-choose"),zt=kt.find(".sp-palette-toggle"),Bt=wt.is("input"),Rt=Bt&&"color"===wt.attr("type")&&u(),Ft=Bt&&!Z,Nt=Ft?t(_).addClass(X).addClass(W.className).addClass(W.replacerClassName):t([]),Ht=Ft?Nt:wt,qt=Nt.find(".sp-preview-inner"),Gt=W.color||Bt&&wt.val(),Wt=!1,Zt=W.preferredFormat,Vt=!W.showButtons||W.clickoutFiresChange,Yt=!Gt,Xt=W.allowEmpty&&!Rt;p();var Kt={show:M,hide:S,toggle:$,reflow:R,option:N,enable:H,disable:q,offset:G,set:function(t){E(t),B()},get:U,destroy:F,container:kt};return Kt.id=f.push(Kt)-1,Kt}function o(e,i){var n=0,r=e.outerWidth(),a=e.outerHeight(),o=i.outerHeight(),s=e[0].ownerDocument,l=s.documentElement,d=l.clientWidth+t(s).scrollLeft(),h=l.clientHeight+t(s).scrollTop(),c=i.offset();return c.top+=o,c.left-=Math.min(c.left,c.left+r>d&&d>r?Math.abs(c.left+r-d):0),c.top-=Math.min(c.top,c.top+a>h&&h>a?Math.abs(a+o-n):n),c}function s(){}function l(t){t.stopPropagation()}function d(t,e){var i=Array.prototype.slice,n=i.call(arguments,2);return function(){return t.apply(e,n.concat(i.call(arguments)))}}function h(e,i,n,r){function a(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.returnValue=!1}function o(t){if(h){if(m&&d.documentMode<9&&!t.button)return l();var n=t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches[0],r=n&&n.pageX||t.pageX,o=n&&n.pageY||t.pageY,s=Math.max(0,Math.min(r-c.left,p)),g=Math.max(0,Math.min(o-c.top,u));f&&a(t),i.apply(e,[s,g,t])}}function s(i){var r=i.which?3==i.which:2==i.button;r||h||n.apply(e,arguments)!==!1&&(h=!0,u=t(e).height(),p=t(e).width(),c=t(e).offset(),t(d).bind(g),t(d.body).addClass("sp-dragging"),o(i),a(i))}function l(){h&&(t(d).unbind(g),t(d.body).removeClass("sp-dragging"),setTimeout(function(){r.apply(e,arguments)},0)),h=!1}i=i||function(){},n=n||function(){},r=r||function(){};var d=document,h=!1,c={},u=0,p=0,f="ontouchstart"in window,g={};g.selectstart=a,g.dragstart=a,g["touchmove mousemove"]=o,g["touchend mouseup"]=l,t(e).bind("touchstart mousedown",s)}function c(t,e,i){var n;return function(){var r=this,a=arguments,o=function(){n=null,t.apply(r,a)};i&&clearTimeout(n),!i&&n||(n=setTimeout(o,e))}}function u(){return t.fn.spectrum.inputTypeColorSupport()}var p={beforeShow:s,move:s,change:s,show:s,hide:s,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},f=[],m=!!/msie/i.exec(window.navigator.userAgent),g=function(){function t(t,e){return!!~(""+t).indexOf(e)}var e=document.createElement("div"),i=e.style;return i.cssText="background-color:rgba(0,0,0,.5)",t(i.backgroundColor,"rgba")||t(i.backgroundColor,"hsla")}(),_=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),y=function(){var t="";if(m)for(var e=1;e<=6;e++)t+="<div class='sp-"+e+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",t,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input form-control' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf dt-mar4t'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),v="spectrum.id";t.fn.spectrum=function(e){if("string"==typeof e){var i=this,n=Array.prototype.slice.call(arguments,1);return this.each(function(){var r=f[t(this).data(v)];if(r){var a=r[e];if(!a)throw new Error("Spectrum: no such method: '"+e+"'");"get"==e?i=r.get():"container"==e?i=r.container:"option"==e?i=r.option.apply(r,n):"destroy"==e?(r.destroy(),t(this).removeData(v)):a.apply(r,n)}}),i}return this.spectrum("destroy").each(function(){var i=t.extend({},e,t(this).data()),n=a(this,i);t(this).data(v,n.id)})},t.fn.spectrum.load=!0,t.fn.spectrum.loadOpts={},t.fn.spectrum.draggable=h,t.fn.spectrum.defaults=p,t.fn.spectrum.inputTypeColorSupport=function e(){if("undefined"==typeof e._cachedResult){var i=t("<input type='color'/>")[0];e._cachedResult="color"===i.type&&""!==i.value}return e._cachedResult},t.spectrum={},t.spectrum.localization={},t.spectrum.palettes={},t.fn.spectrum.processNativeColorInputs=function(){var e=t("input[type=color]");e.length&&!u()&&e.spectrum({preferredFormat:"hex6"})},function(){function t(t){var i={r:0,g:0,b:0},r=1,o=!1,s=!1;return"string"==typeof t&&(t=I(t)),"object"==typeof t&&(t.hasOwnProperty("r")&&t.hasOwnProperty("g")&&t.hasOwnProperty("b")?(i=e(t.r,t.g,t.b),o=!0,s="%"===String(t.r).substr(-1)?"prgb":"rgb"):t.hasOwnProperty("h")&&t.hasOwnProperty("s")&&t.hasOwnProperty("v")?(t.s=P(t.s),t.v=P(t.v),i=a(t.h,t.s,t.v),o=!0,s="hsv"):t.hasOwnProperty("h")&&t.hasOwnProperty("s")&&t.hasOwnProperty("l")&&(t.s=P(t.s),t.l=P(t.l),i=n(t.h,t.s,t.l),o=!0,s="hsl"),t.hasOwnProperty("a")&&(r=t.a)),r=x(r),{ok:o,format:t.format||s,r:z(255,B(i.r,0)),g:z(255,B(i.g,0)),b:z(255,B(i.b,0)),a:r}}function e(t,e,i){return{r:255*k(t,255),g:255*k(e,255),b:255*k(i,255)}}function i(t,e,i){t=k(t,255),e=k(e,255),i=k(i,255);var n,r,a=B(t,e,i),o=z(t,e,i),s=(a+o)/2;if(a==o)n=r=0;else{var l=a-o;switch(r=s>.5?l/(2-a-o):l/(a+o),a){case t:n=(e-i)/l+(e<i?6:0);break;case e:n=(i-t)/l+2;break;case i:n=(t-e)/l+4}n/=6}return{h:n,s:r,l:s}}function n(t,e,i){function n(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}var r,a,o;if(t=k(t,360),e=k(e,100),i=k(i,100),0===e)r=a=o=i;else{var s=i<.5?i*(1+e):i+e-i*e,l=2*i-s;r=n(l,s,t+1/3),a=n(l,s,t),o=n(l,s,t-1/3)}return{r:255*r,g:255*a,b:255*o}}function r(t,e,i){t=k(t,255),e=k(e,255),i=k(i,255);var n,r,a=B(t,e,i),o=z(t,e,i),s=a,l=a-o;if(r=0===a?0:l/a,a==o)n=0;else{switch(a){case t:n=(e-i)/l+(e<i?6:0);break;case e:n=(i-t)/l+2;break;case i:n=(t-e)/l+4}n/=6}return{h:n,s:r,v:s}}function a(t,e,i){t=6*k(t,360),e=k(e,100),i=k(i,100);var n=j.floor(t),r=t-n,a=i*(1-e),o=i*(1-r*e),s=i*(1-(1-r)*e),l=n%6,d=[i,o,a,a,s,i][l],h=[s,i,i,o,a,a][l],c=[a,a,s,i,i,o][l];return{r:255*d,g:255*h,b:255*c}}function o(t,e,i,n){var r=[M(A(t).toString(16)),M(A(e).toString(16)),M(A(i).toString(16))];return n&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function s(t,e,i,n){var r=[M(D(n)),M(A(t).toString(16)),M(A(e).toString(16)),M(A(i).toString(16))];return r.join("")}function l(t,e){e=0===e?0:e||10;var i=F(t).toHsl();return i.s-=e/100,i.s=L(i.s),F(i)}function d(t,e){e=0===e?0:e||10;var i=F(t).toHsl();return i.s+=e/100,i.s=L(i.s),F(i)}function h(t){return F(t).desaturate(100)}function c(t,e){e=0===e?0:e||10;var i=F(t).toHsl();return i.l+=e/100,i.l=L(i.l),F(i)}function u(t,e){e=0===e?0:e||10;var i=F(t).toRgb();return i.r=B(0,z(255,i.r-A(255*-(e/100)))),i.g=B(0,z(255,i.g-A(255*-(e/100)))),i.b=B(0,z(255,i.b-A(255*-(e/100)))),F(i)}function p(t,e){e=0===e?0:e||10;var i=F(t).toHsl();return i.l-=e/100,i.l=L(i.l),F(i)}function f(t,e){var i=F(t).toHsl(),n=(A(i.h)+e)%360;return i.h=n<0?360+n:n,F(i)}function m(t){var e=F(t).toHsl();return e.h=(e.h+180)%360,F(e)}function g(t){var e=F(t).toHsl(),i=e.h;return[F(t),F({h:(i+120)%360,s:e.s,l:e.l}),F({h:(i+240)%360,s:e.s,l:e.l})]}function _(t){var e=F(t).toHsl(),i=e.h;return[F(t),F({h:(i+90)%360,s:e.s,l:e.l}),F({h:(i+180)%360,s:e.s,l:e.l}),F({h:(i+270)%360,s:e.s,l:e.l})]}function y(t){var e=F(t).toHsl(),i=e.h;return[F(t),F({h:(i+72)%360,s:e.s,l:e.l}),F({h:(i+216)%360,s:e.s,l:e.l})]}function v(t,e,i){e=e||6,i=i||30;var n=F(t).toHsl(),r=360/i,a=[F(t)];for(n.h=(n.h-(r*e>>1)+720)%360;--e;)n.h=(n.h+r)%360,a.push(F(n));return a}function b(t,e){e=e||6;for(var i=F(t).toHsv(),n=i.h,r=i.s,a=i.v,o=[],s=1/e;e--;)o.push(F({h:n,s:r,v:a})),a=(a+s)%1;return o}function w(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[t[i]]=i);return e}function x(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function k(t,e){T(t)&&(t="100%");var i=$(t);return t=z(e,B(0,parseFloat(t))),i&&(t=parseInt(t*e,10)/100),j.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function L(t){return z(1,B(0,t))}function C(t){return parseInt(t,16)}function T(t){return"string"==typeof t&&t.indexOf(".")!=-1&&1===parseFloat(t)}function $(t){return"string"==typeof t&&t.indexOf("%")!=-1}function M(t){return 1==t.length?"0"+t:""+t}function P(t){return t<=1&&(t=100*t+"%"),t}function D(t){return Math.round(255*parseFloat(t)).toString(16)}function S(t){return C(t)/255}function I(t){t=t.replace(E,"").replace(U,"").toLowerCase();var e=!1;if(N[t])t=N[t],e=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};var i;return(i=q.rgb.exec(t))?{r:i[1],g:i[2],b:i[3]}:(i=q.rgba.exec(t))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=q.hsl.exec(t))?{h:i[1],s:i[2],l:i[3]}:(i=q.hsla.exec(t))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=q.hsv.exec(t))?{h:i[1],s:i[2],v:i[3]}:(i=q.hsva.exec(t))?{h:i[1],s:i[2],v:i[3],a:i[4]}:(i=q.hex8.exec(t))?{a:S(i[1]),r:C(i[2]),g:C(i[3]),b:C(i[4]),format:e?"name":"hex8"}:(i=q.hex6.exec(t))?{r:C(i[1]),g:C(i[2]),b:C(i[3]),format:e?"name":"hex"}:!!(i=q.hex3.exec(t))&&{r:C(i[1]+""+i[1]),g:C(i[2]+""+i[2]),b:C(i[3]+""+i[3]),format:e?"name":"hex"}}var E=/^[\s,#]+/,U=/\s+$/,O=0,j=Math,A=j.round,z=j.min,B=j.max,R=j.random,F=function(e,i){if(e=e?e:"",i=i||{},e instanceof F)return e;if(!(this instanceof F))return new F(e,i);var n=t(e);this._originalInput=e,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=A(100*this._a)/100,this._format=i.format||n.format,this._gradientType=i.gradientType,this._r<1&&(this._r=A(this._r)),this._g<1&&(this._g=A(this._g)),this._b<1&&(this._b=A(this._b)),this._ok=n.ok,this._tc_id=O++};F.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},setAlpha:function(t){return this._a=x(t),this._roundA=A(100*this._a)/100,this},toHsv:function(){var t=r(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=r(this._r,this._g,this._b),e=A(360*t.h),i=A(100*t.s),n=A(100*t.v);return 1==this._a?"hsv("+e+", "+i+"%, "+n+"%)":"hsva("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var t=i(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=i(this._r,this._g,this._b),e=A(360*t.h),n=A(100*t.s),r=A(100*t.l);return 1==this._a?"hsl("+e+", "+n+"%, "+r+"%)":"hsla("+e+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(t){return o(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(){return s(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:A(this._r),g:A(this._g),b:A(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+A(this._r)+", "+A(this._g)+", "+A(this._b)+")":"rgba("+A(this._r)+", "+A(this._g)+", "+A(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:A(100*k(this._r,255))+"%",g:A(100*k(this._g,255))+"%",b:A(100*k(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+A(100*k(this._r,255))+"%, "+A(100*k(this._g,255))+"%, "+A(100*k(this._b,255))+"%)":"rgba("+A(100*k(this._r,255))+"%, "+A(100*k(this._g,255))+"%, "+A(100*k(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(H[o(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var e="#"+s(this._r,this._g,this._b,this._a),i=e,n=this._gradientType?"GradientType = 1, ":"";if(t){var r=F(t);i=r.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+e+",endColorstr="+i+")"},toString:function(t){var e=!!t;t=t||this._format;var i=!1,n=this._a<1&&this._a>=0,r=!e&&n&&("hex"===t||"hex6"===t||"hex3"===t||"name"===t);return r?"name"===t&&0===this._a?this.toName():this.toRgbString():("rgb"===t&&(i=this.toRgbString()),"prgb"===t&&(i=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(i=this.toHexString()),"hex3"===t&&(i=this.toHexString(!0)),"hex8"===t&&(i=this.toHex8String()),"name"===t&&(i=this.toName()),"hsl"===t&&(i=this.toHslString()),"hsv"===t&&(i=this.toHsvString()),i||this.toHexString())},_applyModification:function(t,e){var i=t.apply(null,[this].concat([].slice.call(e)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(c,arguments)},brighten:function(){return this._applyModification(u,arguments)},darken:function(){return this._applyModification(p,arguments)},desaturate:function(){return this._applyModification(l,arguments)},saturate:function(){return this._applyModification(d,arguments)},greyscale:function(){return this._applyModification(h,arguments)},spin:function(){return this._applyModification(f,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(v,arguments)},complement:function(){return this._applyCombination(m,arguments)},monochromatic:function(){return this._applyCombination(b,arguments)},splitcomplement:function(){return this._applyCombination(y,arguments)},triad:function(){return this._applyCombination(g,arguments)},tetrad:function(){return this._applyCombination(_,arguments)}},F.fromRatio=function(t,e){if("object"==typeof t){var i={};for(var n in t)t.hasOwnProperty(n)&&("a"===n?i[n]=t[n]:i[n]=P(t[n]));t=i}return F(t,e)},F.equals=function(t,e){return!(!t||!e)&&F(t).toRgbString()==F(e).toRgbString()},F.random=function(){return F.fromRatio({r:R(),g:R(),b:R()})},F.mix=function(t,e,i){i=0===i?0:i||50;var n,r=F(t).toRgb(),a=F(e).toRgb(),o=i/100,s=2*o-1,l=a.a-r.a;n=s*l==-1?s:(s+l)/(1+s*l),n=(n+1)/2;var d=1-n,h={r:a.r*n+r.r*d,g:a.g*n+r.g*d,b:a.b*n+r.b*d,a:a.a*o+r.a*(1-o)};return F(h)},F.readability=function(t,e){var i=F(t),n=F(e),r=i.toRgb(),a=n.toRgb(),o=i.getBrightness(),s=n.getBrightness(),l=Math.max(r.r,a.r)-Math.min(r.r,a.r)+Math.max(r.g,a.g)-Math.min(r.g,a.g)+Math.max(r.b,a.b)-Math.min(r.b,a.b);return{brightness:Math.abs(o-s),color:l}},F.isReadable=function(t,e){var i=F.readability(t,e);return i.brightness>125&&i.color>500},F.mostReadable=function(t,e){for(var i=null,n=0,r=!1,a=0;a<e.length;a++){var o=F.readability(t,e[a]),s=o.brightness>125&&o.color>500,l=3*(o.brightness/125)+o.color/500;(s&&!r||s&&r&&l>n||!s&&!r&&l>n)&&(r=s,n=l,i=F(e[a]))}return i};var N=F.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},H=F.hexNames=w(N),q=function(){var t="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",i="(?:"+e+")|(?:"+t+")",n="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?",r="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?";return{rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+r),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+r),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+r),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();window.tinycolor=F}(),t(function(){t.fn.spectrum.load&&t.fn.spectrum.processNativeColorInputs()})}),function(t){var e=t.spectrum.localization["zh-cn"]={cancelText:"\u53d6\u6d88",chooseText:"\u9009\u62e9",clearText:"\u6e05\u9664",togglePaletteMoreText:"\u66f4\u591a\u9009\u9879",togglePaletteLessText:"\u9690\u85cf",noColorSelectedText:"\u5c1a\u672a\u9009\u62e9\u4efb\u4f55\u989c\u8272"};t.extend(t.fn.spectrum.defaults,e)}(jQuery),$(function(){function t(t){t&&(e=t),MapUtils.ajax2server(get_logs_url+"?page="+e,"GET","",function(t){if(t.logs&&t.logs.length>0){var e=[{logs:t.logs}],i=$("#mapLogDetails").render(e);if(0==$(".more-log-loading").length){$(".map-logs-details").append(i);var n="<div class='more-log-loading text-center dt-pad4x dt-pad8y'>";n+="<a type='button' href='###' class='btn btn-link log-loading dt-f12'>\u52a0\u8f7d\u66f4\u591a...</a>",n+="</div>",$(".map-logs-details").append(n)}else $(".log-loading").text("\u52a0\u8f7d\u66f4\u591a..."),$(".more-log-loading").before(i)}else $(".log-loading").text("\u5df2\u65e0\u66f4\u591a").attr("disabled","true").addClass("dt-gray")})}var e=1;$(document).on("dt.init.maplog",function(e,i){t(i)}),$("#logPanel").click(function(i){$(i.target).hasClass("log-loading")&&($(".log-loading").text("\u52a0\u8f7d\u4e2d..."),e++,t())})});var StyleUtils=window.StyleUtils=StyleUtils||{};$(function(){StyleUtils.shapeArray=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","1","2","3","4","5","6","7","8","9","0"],$(window).unbind().click(function(t){var e=$(".style-box");e.is(t.target)||0!==e.has(t.target).length||0!==$(t.target).closest(".layer-icons").length||0!==$(t.target).closest(".popover").length||$(".style-box").popover("hide")}),StyleUtils.getOverlayAttrs=function(t){var e=$(".layer-select-label").first().text(),i=t.getAttrFields(),n=t.getAttrField(e),r=null;n&&(r=n.id);var a={attr_fields:i,label_field_id:r};return $.views.settings.allowCode=!0,$.templates.attrs.render(a)},StyleUtils.getOverlaySize=function(t,e){var i=$("."+t).text().trim(),n={selected:i,labelClass:e};return $.templates.overlay_size.render(n)},StyleUtils.getLabelStyle=function(){var t=$(".layer-select-label-style").first().text();$.views.settings.allowCode=!0;var e={current_label_style:t};return $.templates.label_style.render(e)},StyleUtils.getLayerCanvas=function(){var t=$(".layer-canvas-shape").attr("data-shape");$.views.settings.allowCode=!0;var e={icon:t};return $.templates.marker_canvas_icon.render(e)},StyleUtils.getCurrentLayerStyle=function(t,e){switch(e){case"marker_layer":StyleUtils.showMarkerLayerStyle(t);break;case"line_layer":StyleUtils.showLineLayerStyle(t);break;case"region_layer":StyleUtils.showRegionLayerStyle(t)}},StyleUtils.showRegionLayerStyle=function(t){switch($(".layer-style-select").removeClass("layer-style-active"),$(".region-layer-select-panel").addClass("dt-none"),t){case"normal":$(".region-style-normal").removeClass("dt-none"),StyleUtils.weightHandler("regionWeight"),StyleUtils.opacityHandle("regionFillOpacity","region-fill-opacity"),StyleUtils.opacityHandle("regionStrokeOpacity","region-stroke-opacity"),$(".region-layer-normal").children().first().addClass("layer-style-active"),$(".preview").removeClass("dt-none");break;case"classify":$(".region-style-classify").removeClass("dt-none"),$(".region-layer-category").children().first().addClass("layer-style-active"),$(".preview").addClass("dt-none")}},StyleUtils.showLineLayerStyle=function(t){switch($(".layer-style-select").removeClass("layer-style-active"),$(".line-layer-select-panel").addClass("dt-none"),t){case"normal":$(".line-style-normal").removeClass("dt-none"),StyleUtils.weightHandler("lineWeight"),StyleUtils.opacityHandle("lineOpacity","line-opacity"),$(".line-layer-normal").children().first().addClass("layer-style-active"),$(".preview").removeClass("dt-none");break;case"classify":$(".line-style-classify").removeClass("dt-none"),$(".line-layer-category").children().first().addClass("layer-style-active"),$(".preview").addClass("dt-none")}},StyleUtils.showMarkerLayerStyle=function(t){switch($(".layer-style-select").removeClass("layer-style-active"),$(".marker-layer-select-panel").addClass("dt-none"),t){case"normal":$(".marker-style-normal").removeClass("dt-none"),$(".layer-normal").children().first().addClass("layer-style-active"),$(".preview").removeClass("dt-none");break;case"canvas":$(".marker-style-canvas").removeClass("dt-none"),$(".layer-canvas-marker").children().first().addClass("layer-style-active"),$(".preview").removeClass("dt-none");break;case"heatmap":$(".marker-style-heatmap").removeClass("dt-none"),$(".layer-heatmap").children().first().addClass("layer-style-active"),$(".preview").removeClass("dt-none"),StyleUtils.heatmapHandler();break;case"classify":$(".marker-style-classify").removeClass("dt-none"),$(".layer-category").children().first().addClass("layer-style-active"),$(".preview").addClass("dt-none");break;case"text":$(".marker-style-txt").removeClass("dt-none"),$(".layer-text").children().first().addClass("layer-style-active"),$(".preview").removeClass("dt-none"),StyleUtils.txtHandler();break;case"sort":$(".marker-style-sort").removeClass("dt-none"),$(".layer-sort").children().first().addClass("layer-style-active"),$(".preview").removeClass("dt-none")}},StyleUtils.getHeatmapConfig=function(){var t=$(".heatmap-schemes").attr("heatmap-color");$.views.settings.allowCode=!0;var e={current:t};return $.templates.heatmap_color.render(e)},StyleUtils.getHeatmapWeight=function(t){var e=t.getNumberFields(),i=$(".heatmap-select-weight").attr("heatmap-field");$.views.settings.allowCode=!0;var n={num_fields:e,field:i};return $.templates.heatmap_weight.render(n)},StyleUtils.initLayerStylePanel=function(t,e){switch(e){case"marker_layer":StyleUtils.addMarkerLayerPanel(t);break;case"line_layer":StyleUtils.addLineLayerPanel(t);break;case"region_layer":StyleUtils.addRegionLayerPanel(t)}},StyleUtils.addRegionLayerPanel=function(t){switch(t){case"normal":StyleUtils.getCurrentLayerStyle("normal","region_layer"),$(".submit-layer-style").attr("data-layer-style","normal").attr("data-layer-type","region_layer");break;case"classify":StyleUtils.getCurrentLayerStyle("classify","region_layer"),$(".submit-layer-style").attr("data-layer-style","classify").attr("data-layer-type","region_layer"),CategoryUtils.getCurrentLayerCategory(!0,"region_layer")}},StyleUtils.addLineLayerPanel=function(t){switch(t){case"normal":StyleUtils.getCurrentLayerStyle("normal","line_layer"),$(".submit-layer-style").attr("data-layer-style","normal").attr("data-layer-type","line_layer");break;case"classify":StyleUtils.getCurrentLayerStyle("classify","line_layer"),$(".submit-layer-style").attr("data-layer-style","classify").attr("data-layer-type","line_layer"),CategoryUtils.getCurrentLayerCategory(!0,"line_layer")}},StyleUtils.addMarkerLayerPanel=function(t){switch(t){case"normal":StyleUtils.getCurrentLayerStyle("normal","marker_layer"),$(".submit-layer-style").attr("data-layer-style","normal").attr("data-layer-type","marker_layer");break;case"canvas":StyleUtils.getCurrentLayerStyle("canvas","marker_layer"),$(".submit-layer-style").attr("data-layer-style","canvas").attr("data-layer-type","marker_layer");
break;case"heatmap":StyleUtils.getCurrentLayerStyle("heatmap","marker_layer"),$(".submit-layer-style").attr("data-layer-style","heatmap").attr("data-layer-type","marker_layer");break;case"classify":StyleUtils.getCurrentLayerStyle("classify","marker_layer"),$(".submit-layer-style").attr("data-layer-style","classify").attr("data-layer-type","marker_layer"),CategoryUtils.getCurrentLayerCategory(!0,"marker_layer");break;case"text":StyleUtils.getCurrentLayerStyle("text","marker_layer"),$(".submit-layer-style").attr("data-layer-style","text").attr("data-layer-type","marker_layer");break;case"sort":StyleUtils.getCurrentLayerStyle("sort","marker_layer"),$(".submit-layer-style").attr("data-layer-style","sort").attr("data-layer-type","marker_layer")}},StyleUtils.initClickEvents=function(){$(".style-box").off("click"),$(".style-back").unbind().click(function(){$(".layer-style-panel").addClass("dt-none"),$(".map-info-tab").show(),$(".classify-result-panel").hide()}),$("#marker_has_bubble").unbind().click(function(){$("#marker_has_bubble").is(":checked")||($(".layer-select-shape").empty(),$(".layer-select-shape").attr("data-symbol","marker").append('<span class="icon marker dt-f13"></span>')),StyleUtils.showMarkerNormalPreview()}),$("#text_has_background").unbind().click(function(){$("#text_has_background").is(":checked")?$(".layer-font-border-color, .layer-font-background-color").removeClass("dt-none"):$(".layer-font-border-color, .layer-font-background-color").addClass("dt-none"),StyleUtils.showTextPreview()}),$(".marker-normal-size, .marker-canvas-size").unbind().click(function(t){$(t.target).parent().hasClass("marker-normal-size")?($(".marker-normal-size").find(".active").removeClass("active"),$(t.target).addClass("active"),StyleUtils.showMarkerNormalPreview()):($(".marker-canvas-size").find(".active").removeClass("active"),$(t.target).addClass("active"),StyleUtils.showMarkerCanvasPreview())}),$(".marker-sort-panel").unbind().click(function(t){$(".marker-sort-panel").find(".active").removeClass("active"),$(t.target).addClass("active"),StyleUtils.showSortPreview()}),$(".marker-sort-size").unbind().click(function(t){$(".marker-sort-size").find(".active").removeClass("active"),$(t.target).addClass("active"),StyleUtils.showSortPreview()}),$(".marker-classify-type,.line-classify-type,.region-classify-type").unbind().click(function(t){var e,i;$(t.target).closest("div").hasClass("marker-classify-type")?(e="marker",i="marker_layer"):$(t.target).closest("div").hasClass("line-classify-type")?(e="line",i="line_layer"):$(t.target).closest("div").hasClass("region-classify-type")&&(e="region",i="region_layer"),e&&i&&"disabled"!=$(t.target).children().last().attr("disabled")&&($("."+e+"-classify-type").find(".active").removeClass("active"),$(t.target).addClass("active"),CategoryUtils.getCurrentLayerCategory(!1,i))}),$(".style-box").popover({html:!0,template:'<div class="popover" role="tooltip" ><div class="arrow"></div><div class="popover-content"></div></div>'});var t=!0;$(".style-box").on("show.bs.popover",function(t){$(".style-box").popover("hide");var e;if($(t.target).hasClass("layer-label")){var i=$(t.target).closest("div").attr("class");$(".layer-label").attr("data-content","");var n="";"marker-layer"==i?n="m_":"line-layer"==i?n="l_":(n="region-layer")&&(n="r_");var r=StyleUtils.layersHashMap.get(n+current_layer_id);e=StyleUtils.getOverlayAttrs(r),$(".layer-label").attr("data-content",e)}else if($(t.target).hasClass("layer-size"))e=StyleUtils.getOverlaySize("layer-select-size","style-size"),$(".layer-size").attr("data-content",e);else if($(t.target).hasClass("layer-canvas-size"))e=StyleUtils.getOverlaySize("layer-canvas-select-size","style-canvas-size"),$(".layer-canvas-size").attr("data-content",e);else if($(t.target).hasClass("layer-sort-size"))e=StyleUtils.getOverlaySize("layer-sort-select-size","style-sort-size"),$(".layer-sort-size").attr("data-content",e);else if($(t.target).hasClass("layer-label-style"))e=StyleUtils.getLabelStyle(),$(".layer-label-style").attr("data-content",e);else if($(t.target).hasClass("layer-canvas-icon"))e=StyleUtils.getLayerCanvas(),$(".layer-canvas-icon").attr("data-content",e);else if($(t.target).hasClass("heatmap-color-select"))e=StyleUtils.getHeatmapConfig(),$(".heatmap-color-select").attr("data-content",e);else if($(t.target).hasClass("heatmap-weight-setting")){var r=StyleUtils.layersHashMap.get("m_"+current_layer_id);e=StyleUtils.getHeatmapWeight(r),$(".heatmap-weight-setting").attr("data-content",e)}else $(t.target).hasClass("style-color")?(e=StyleUtils.getColorTemplate("layer-select-color"),$(".style-color").attr("data-content",e)):$(t.target).hasClass("fill-color")?(e=StyleUtils.getColorTemplate("region-fill-select-color"),$(".region-color-active").removeClass("region-color-active"),$(".fill-color").attr("data-content",e).addClass("region-color-active")):$(t.target).hasClass("outline-color")?(e=StyleUtils.getColorTemplate("region-outline-select-color"),$(".region-color-active").removeClass("region-color-active"),$(".outline-color").attr("data-content",e).addClass("region-color-active")):$(t.target).hasClass("style-canvas-color")?(e=StyleUtils.getColorTemplate("layer-canvas-select-color"),$(".style-canvas-color").attr("data-content",e)):$(t.target).hasClass("line-style-color")?(e=StyleUtils.getColorTemplate("line-layer-select-color"),$(".line-style-color").attr("data-content",e)):$(t.target).hasClass("layer-txt-border-color")?(e=StyleUtils.getColorTemplate("layer-select-txt-border-color"),$(".layer-txt-border-color").attr("data-content",e)):$(t.target).hasClass("style-shape")?(e=StyleUtils.getShapeTemplate(),$(".style-shape").attr("data-content",e)):$(t.target).hasClass("classify-field-setting")?(e=StyleUtils.getClassifyField(),$(".classify-field-setting").attr("data-content",e)):$(t.target).hasClass("classify-type-setting")?(e=StyleUtils.getClassifyType(),$(".classify-type-setting").attr("data-content",e)):$(t.target).hasClass("classify-count-setting")?(e=StyleUtils.getClassifyCount(),$(".classify-count-setting").attr("data-content",e)):$(t.target).hasClass("layer-sort-color-setting")?(e=StyleUtils.getColorTemplate("layer-select-sort-color"),$(".layer-sort-color-setting").attr("data-content",e)):$(t.target).hasClass("layer-txt-bg-color")?(e=StyleUtils.getColorTemplate("layer-select-txt-bg-color"),$(".layer-txt-bg-color").attr("data-content",e)):$(t.target).hasClass("layer-txt-font-setting")?(e=StyleUtils.getFontFamilyTemplate(),$(".layer-txt-font-setting").attr("data-content",e)):$(t.target).hasClass("layer-txt-color-setting")?(e=StyleUtils.getColorTemplate("layer-select-txt-color"),$(".layer-txt-color-setting").attr("data-content",e)):$(t.target).hasClass("select-bubble")?(e=StyleUtils.getBubble(),$(".select-bubble").attr("data-content",e)):$(t.target).hasClass("has-cluster")?(e=StyleUtils.getCluster(),$(".has-cluster").attr("data-content",e)):$(t.target).hasClass("has-classify")?(e=StyleUtils.getClassify(),$(".has-classify").attr("data-content",e)):$(t.target).hasClass("line-style")&&(e=StyleUtils.getLineType(),$(".line-style").attr("data-content",e))}).on("shown.bs.popover",function(e){if(StyleUtils.createCustomColorPicker(),$(".label-style-panel").length>0)$(".label-style-panel").closest(".popover").css("max-width","360px").width(360);else if($(".layer-icons").length>0){if($(".popover").addClass("dt-hidden"),$(".layer-icons").closest(".popover").css("max-width","520px").width(520).height(338),t){t=!1;var i=$("#custom_icons").html();$(".style-shape").data("icons",i),$(e.target).popover("show"),$(document).trigger("upload.custom.icon.init")}else 0==$("#uploadifive-user_upload_icon").length&&(t=!0);$(".popover-content").find("#custom_icons").empty(),$(".popover-content").find("#custom_icons").append($(".style-shape").data("icons"))}$(".sp-choose").unbind().click(function(){var t=$(".sp-replacer").closest(".dt-hidden").attr("data-class-name"),e=$(".sp-input").val();$("."+t).css("background-color",e).attr("data-color",e),"layer-select-color"==t?StyleUtils.showMarkerNormalPreview():"region-outline-select-color"==t?StyleUtils.showRegionNormalPreview():"region-fill-select-color"==t?StyleUtils.showRegionNormalPreview():"line-layer-select-color"==t&&StyleUtils.showLineNormalPreview()}),$(".popover-content .select-color").unbind().click(function(t){var e=$(t.target).closest(".dt-hidden").attr("data-class-name");$(".popover-content .select-color").removeClass("active"),$(this).addClass("active");var i=$(this).attr("data-color");if($("."+e).css("background-color","#"+i).attr("data-color","#"+i),"layer-select-color"==e)StyleUtils.showMarkerNormalPreview();else if("region-outline-select-color"==e)StyleUtils.showRegionNormalPreview();else if("region-fill-select-color"==e)StyleUtils.showRegionNormalPreview();else if("layer-select-sort-color"==e)StyleUtils.showSortPreview();else if("layer-canvas-select-color"==e){var n=$(".layer-canvas-shape").attr("data-shape");"BMAP_POINT_SHAPE_STAR"==n?$(".layer-canvas-shape").find("div").css("color","#"+i):$(".layer-canvas-shape").find("div").css("background-color","#"+i),StyleUtils.showMarkerCanvasPreview()}else"line-layer-select-color"==e?StyleUtils.showLineNormalPreview():"layer-select-txt-color"==e?StyleUtils.showTextPreview():"layer-select-txt-bg-color"==e?StyleUtils.showTextPreview():"layer-select-txt-border-color"==e&&StyleUtils.showTextPreview()}),$(".layer-text-family").unbind().click(function(t){if($(t.target).closest("tr").hasClass("dt-pointer")){$(".layer-text-family .dt-green").addClass("dt-none"),$(t.target).closest("tr").find(".dt-green").removeClass("dt-none");var e,i=$(t.target).closest("tr").children().last().find("span").text(),n="";"\u5b8b\u4f53"==i?(e="SimSun",n=0):"\u96c5\u9ed1"==i?(e="Microsoft YaHei",n=1):"\u6977\u4f53"==i&&(e="KaiTi",n=2),$(".layer-select-font").attr("data-font-family",e).attr("data-num",n).text(i),StyleUtils.showTextPreview()}}),$(".layer-icons").unbind().click(function(t){if(!($(t.target).hasClass("container-fluid")||$(t.target).is("li")||$(t.target).is("ul"))){var e=$(t.target).attr("aria-controls");if(e)$(t.target).closest("ul").find("li").removeClass("active"),$(".layer-icons").find(".tab-content").find("div").removeClass("active"),$(t.target).closest("li").addClass("active"),$("#"+e).addClass("active");else if($(t.target).hasClass("myicon")){$(".layer-normal-bubble").addClass("dt-none"),$(".layer-normal-color").addClass("dt-none"),$(".layer-size-setting").addClass("dt-none");var i="<img src='"+$(t.target).attr("src")+"' class='dt-pointer' data-id='"+$(t.target).attr("data-id")+"' style='width:24px;height:24px'/>";$(".layer-select-shape").empty().append(i).attr("data-icon-type","custom"),StyleUtils.showMarkerNormalPreview()}else if($(t.target).hasClass("custom_icon_remove")){var n=$(t.target);PromptInfo.xcConfirm("\u5220\u9664\u56fe\u6807\u540e\u5176\u4ed6\u5730\u56fe\u5c06\u4e0d\u80fd\u518d\u91cd\u590d\u4f7f\u7528\uff0c\u786e\u8ba4\u7ee7\u7eed\u5220\u9664\uff1f",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){var t=n.attr("data-id");MapUtils.ajax2server(destroy_icons_url,"delete",{id:t},function(){$(".myicon").each(function(){$(this).attr("data-id")==t&&$(this).parent().remove()})})}})}else"custom_icon"!=$(t.target).attr("id")&&($(".layer-select-shape").attr("data-icon-type","normal"),$(".layer-normal-bubble").removeClass("dt-none"),$(".layer-normal-color").removeClass("dt-none"),$(".layer-size-setting").removeClass("dt-none"))}}),$(".layer-icons .select-shape").unbind().click(function(){$(".select-shape").removeClass("active"),$(this).addClass("active");var t=$(this).attr("data-symbol"),e=$(this).children().first().attr("class"),i=$(this).children().first().text();$(".layer-select-shape").attr("data-symbol",t).empty().append('<span class="'+e+'">'+i+"</span>"),$(".layer-select-shape").children().first().removeClass("dt-f18").removeClass("dt-f16").addClass("dt-f13"),StyleUtils.showMarkerNormalPreview()}),$(".style-sort-size").unbind().click(function(t){var e=$(t.target).closest("label").attr("for");e.indexOf("small")>=0?($(t.target).closest("label").find("input").prop("checked",!0),$(".layer-sort-select-size").attr("data-size","s").text("\u5c0f")):e.indexOf("middle")>=0?($(t.target).closest("label").find("input").prop("checked",!0),$(".layer-sort-select-size").attr("data-size","m").text("\u4e2d")):e.indexOf("large")>=0&&($(t.target).closest("label").find("input").prop("checked",!0),$(".layer-sort-select-size").attr("data-size","l").text("\u5927"))}),$(".style-canvas-size").unbind().click(function(t){var e=$(t.target).closest("label").attr("for");$(t.target).closest("label").find("input").prop("checked",!0),e.indexOf("small")>=0?$(".layer-canvas-select-size").attr("data-size","BMAP_POINT_SIZE_SMALL").text("\u5c0f"):e.indexOf("middle")>=0?$(".layer-canvas-select-size").attr("data-size","BMAP_POINT_SIZE_NORMAL").text("\u4e2d"):e.indexOf("large")>=0&&$(".layer-canvas-select-size").attr("data-size","BMAP_POINT_SIZE_BIG").text("\u5927")}),$(".layer-label-setting").unbind().click(function(t){if($(t.target).closest("tr").hasClass("dt-pointer")){$(".layer-label-setting .dt-green").addClass("dt-none"),$(t.target).closest("tr").find(".dt-green").removeClass("dt-none");var e=$(t.target).closest("tr").children().last().find("span").text();0==e.length&&(e="\u65e0\u6807\u7b7e"),"\u65e0\u6807\u7b7e"==e?$(".layer-label-style-setting").addClass("dt-none"):$(".layer-label-style-setting").removeClass("dt-none"),$(".layer-select-label").attr("data-label",e).text(e)}}),$(".layer-label-style-select").unbind().click(function(t){$(".layer-label-style-active").removeClass("layer-label-style-active"),$(t.target).closest(".layer-label-style-select").addClass("layer-label-style-active");var e=$(t.target).closest(".col-md-4").attr("data-label-style"),i=$(t.target).closest(".col-md-4").attr("data-label-num");$(".layer-select-label-style").attr("data-label-num",i).text(e)}),$(".canvas-icon-panel").unbind().click(function(t){if($(t.target).closest("tr").hasClass("dt-pointer")){$(".canvas-icon-panel .dt-green").addClass("dt-none"),$(t.target).closest("tr").find(".dt-green").removeClass("dt-none");var e=$(t.target).closest("td").find("span").attr("data-shape");"BMAP_POINT_SHAPE_WATERDROP"==e?$(".layer-color,.layer-canvas-size-setting").addClass("dt-none"):$(".layer-color,.layer-canvas-size-setting").removeClass("dt-none");var i=$(".layer-canvas-select-color").attr("data-color"),n=StyleUtils.getCanvasIcon(e,i);$(".layer-canvas-shape").attr("data-shape",e).find("span").empty(),$(".layer-canvas-shape").attr("data-shape",e).find("span").append(n),StyleUtils.showMarkerCanvasPreview()}}),$(".heatmap-colors").unbind().click(function(t){if($(t.target).hasClass("dt-pointer")){$(".heatmap-colors .dt-green").addClass("dt-none"),$(t.target).closest("td").prev().children().first().removeClass("dt-none");var e=$(t.target).attr("heatmap-color");$(".heatmap-schemes").attr("class",function(){return $(this).attr("class").replace(/heatmap\S*/g,"")}).addClass("heatmap-schemes").addClass("heatmap-"+e).attr("heatmap-color",e),StyleUtils.showHeatmapPreview()}}),$(".heatmap-weight").unbind().click(function(t){if($(t.target).closest("tr").hasClass("dt-pointer")){$(".heatmap-weight .dt-green").addClass("dt-none"),$(t.target).closest("tr").find(".dt-green").removeClass("dt-none");var e=$(t.target).closest("tr").children().last().find("span").text(),i=""==e?"\u65e0":e;$(".heatmap-select-weight").attr("heatmap-field",e).text(i)}}),$(".classify-fields").unbind().click(function(t){var e=$(".classify-fields"),i=e.attr("layer-type"),n=$(t.target).closest("tr");if(n.hasClass("dt-pointer")){$(".classify-fields .dt-green").addClass("dt-none"),n.find(".dt-green").removeClass("dt-none");var r=n.find(".classify-attr-field"),a=(r.attr("data-id"),r.text());$(".classify-field").attr("data-field",a).text(a),CategoryUtils.getCurrentLayerCategory(!1,i)}}),$(".classify-count-panel").unbind().click(function(t){if($(t.target).closest("table").attr("layer-type").indexOf("marker")>=0?type="marker_layer":$(t.target).closest("table").attr("layer-type").indexOf("line")>=0?type="line_layer":$(t.target).closest("table").attr("layer-type").indexOf("region")>=0&&(type="region_layer"),$(t.target).closest("tr").hasClass("dt-pointer")){$(".classify-count-panel .dt-green").addClass("dt-none"),$(t.target).closest("tr").find(".dt-green").removeClass("dt-none");var e=$(t.target).closest("tr").children().last().find("span").text();e<2?e=2:e>12&&(e=12),$(".classify-count").attr("data-level",e).text(e),CategoryUtils.getCurrentLayerCategory(!1,type)}}),$("input[name=sort_radio]").unbind().click(function(){var t=$(this).val();$(".layer-select-sort").attr("data-sort",t).text(t)}),$("input[name=cluster_radio]").unbind().click(function(){var t={"true":"\u662f","false":"\u5426"},e=$(this).val();$(".layer-has-cluster").attr("data-has-cluster",e).text(t[e])}),$("input[name=classify_radio]").unbind().click(function(){var t={"true":"\u662f","false":"\u5426"},e=$(this).val();$(".layer-data-has-classify").attr("data-has-classify",e).text(t[e])}),$(".line-type-panel").unbind().click(function(t){if($(t.target).closest("tr").hasClass("dt-pointer")){$(".line-type-panel .dt-green").addClass("dt-none"),$(t.target).closest("tr").find(".dt-green").removeClass("dt-none");var e={solid:"line-solid",dashed:"line-dashed",arrow:"line-arrow",arrow_node:"line-arrow-node"},i=$(t.target).attr("data-line-type");$(".line-select-type").attr("data-line-type",i),$(".line-select-type").find("div").attr("class",e[i]),StyleUtils.showLineNormalPreview()}})}),$(".marker-layer-style-setting").unbind().click(function(t){$(".classify-result-panel").hide();var e=$(t.target).closest(".layer-style-setting").attr("marker-layer-style");StyleUtils.initLayerStylePanel(e,"marker_layer")}),$(".line-layer-style-setting").unbind().click(function(t){$(".classify-result-panel").hide();var e=$(t.target).closest(".layer-style-setting").attr("line-layer-style");StyleUtils.initLayerStylePanel(e,"line_layer")}),$(".region-layer-style-setting").unbind().click(function(t){$(".classify-result-panel").hide();var e=$(t.target).closest(".layer-style-setting").attr("region-layer-style");StyleUtils.initLayerStylePanel(e,"region_layer")}),$(".submit-layer-style").unbind().click(function(){for(var t=$(this).attr("data-layer-style"),e=$(this).attr("data-layer-type"),i=MarkerUtils.getMarkerLayers(),n=0;n<i.length;n++){var r=i[n];r.isCategorized()&&CategoryUtils.removeVectors(r)}switch(e){case"marker_layer":StyleUtils._setMarkerLayerStyle(t);break;case"line_layer":StyleUtils._setLineLayerStyle(t);break;case"region_layer":StyleUtils._setRegionLayerStyle(t)}}),$(".preview").unbind().click(function(t){if("marker-layer"==$(t.target).attr("data-type")){var e=StyleUtils.getMarkerLayerStyleType();e.indexOf("normal")>=0?StyleUtils.showMarkerNormalPreview():e.indexOf("canvas")>=0?StyleUtils.showMarkerCanvasPreview():e.indexOf("heatmap")>=0?StyleUtils.showHeatmapPreview():e.indexOf("text")>=0?StyleUtils.showTextPreview():e.indexOf("sort")>=0&&StyleUtils.showSortPreview()}else if("line-layer"==$(t.target).attr("data-type")){var e=StyleUtils.getLineLayerStyleType();$(".line-layer-style-setting").height(236);var i=$(".line-layer").height()-122;$(".line-layer").height(i),e.indexOf("normal")>=0&&StyleUtils.showLineNormalPreview()}else if("region-layer"==$(t.target).attr("data-type")){var e=StyleUtils.getRegionLayerStyleType();$(".region-layer-style-setting").height(236);var i=$(".region-layer").height()-122;$(".region-layer").height(i),e.indexOf("normal")>=0&&StyleUtils.showRegionNormalPreview()}$(".layer-preview").hasClass("dt-none")?($(".layer-preview").removeClass("dt-none"),$(".preview").removeClass("btn-default").addClass("btn-success")):($(".layer-preview").addClass("dt-none"),$(".preview").removeClass("btn-success").addClass("btn-default"),$(".line-layer-style-setting,.region-layer-style-setting").height(114),$(".line-layer").height($(".layer-style-panel").height()-$(".line-layer-style-setting").height()-32-8-96).css("overflow-y","auto"),$(".region-layer").height($(".layer-style-panel").height()-$(".region-layer-style-setting").height()-32-8-96).css("overflow-y","auto"))}),$(".close-preview").unbind().click(function(){$(".layer-preview").addClass("dt-none"),$(".preview").removeClass("btn-success").addClass("btn-default"),$(".line-layer-style-setting,.region-layer-style-setting").height(114)})},StyleUtils._setMarkerLayerStyle=function(t){var e=null,i={};if("normal"==t){var n,r,a,o,s,l=$(".layer-select-label").attr("data-label"),d=parseInt($(".layer-select-label-style").attr("data-label-num")),h=$("#marker_is_cluster").is(":checked");"normal"==$(".layer-select-shape").attr("data-icon-type")?(n=$(".layer-select-color").attr("data-color"),r=$(".layer-select-shape").attr("data-symbol"),a=$(".marker-normal-size").find(".active").attr("data-size"),o=$("#marker_has_bubble").is(":checked"),i={symbol:r,color:n.replace(/#/g,""),size:a,bubble:o,label_field:l,label_style_type:d,is_cluster:h}):"custom"==$(".layer-select-shape").attr("data-icon-type")&&(s=$(".layer-select-shape").find("img").attr("data-id"),i={icon_id:s,label_field:l,label_style_type:d,is_cluster:h}),e=set_uniform_style_url}else if("canvas"==t){var n=$(".layer-canvas-select-color").attr("data-color"),c=$(".layer-canvas-shape").attr("data-shape"),a=$(".marker-canvas-size").find(".active").attr("data-size");e=set_canvas_style_url,i={shape:c,color:n,size:a}}else if("heatmap"==t){e=set_heatmap_style_marker_layer_url;var u=$("#heatmap-radius input").val(),p=$(".heatmap-schemes").attr("heatmap-color"),f=$(".heatmap-select-weight").attr("heatmap-field");i={radius:u,gradient:p,field:f}}else if("classify"==t){e=category_by_field_marker_layer_url;var m=StyleUtils.layersHashMap.get("m_"+current_layer_id),g=CategoryUtils.getCategorySettings(m,"marker");if(null==g.category)return PromptInfo.xcConfirm("\u8bf7\u7b49\u5f85\u5206\u7c7b\u7ed3\u679c\u5237\u65b0\u540e\u518d\u64cd\u4f5c\uff01",PromptInfo.xcConfirm.typeEnum.warning),!1;var l=$(".layer-select-label").attr("data-label"),d=parseInt($(".layer-select-label-style").attr("data-label-num")),_=$("#marker_data_has_classify").is(":checked"),h=$("#marker_classify_is_cluster").is(":checked");i={field:g.field,is_number_field:g.is_number_field,method:g.method,category:g.category,is_display:_,label_field:l,label_style_type:d,is_cluster:h}}else if("text"==t){e=set_text_style_marker_layer_url;var y,n=$(".layer-select-txt-color").attr("data-color"),a=$("#txtSize input").val(),v=$(".layer-select-font").attr("data-num"),b=$("#text_has_background").is(":checked"),w=null;b&&(y=$(".layer-select-txt-bg-color").attr("data-color"),w=$(".layer-select-txt-border-color").attr("data-color")),i={color:n,size:a,font:v,show_decoration:b,background_color:y,border_color:w}}else if("sort"==t){e=set_sort_style_url;var n=$(".layer-select-sort-color").attr("data-color"),a=$(".marker-sort-size").find(".active").attr("data-size"),x=$(".marker-sort-panel").find(".active").attr("data-sort"),h=$("#marker_sort_is_cluster").is(":checked"),l=$(".layer-select-label").attr("data-label"),d=parseInt($(".layer-select-label-style").attr("data-label-num"));i={color:n.replace(/#/g,""),size:a,type:x,is_cluster:h,label_field:l,label_style_type:d}}e&&($.extend(i,{mid:mid,id:current_layer_id}),MapUtils.ajax2server(e,"POST",i,function(){$(".style-back").trigger("click")},function(){}))},StyleUtils._setLineLayerStyle=function(t){var e=null,i={};if("normal"==t){var n=$(".line-layer-select-color").attr("data-color"),r=parseInt($("#lineWeight input").val()),a=parseFloat($("#lineOpacity input").attr("line-opacity")),o=$(".line-select-type").attr("data-line-type");e=set_uniform_style_line_layer_url,i={strokeWeight:r,strokeColor:n,strokeOpacity:a,strokeStyle:o}}else if("classify"==t){e=category_by_field_line_layer_url;var s=StyleUtils.layersHashMap.get("l_"+current_layer_id),l=CategoryUtils.getCategorySettings(s,"line");i={field:l.field,is_number_field:l.is_number_field,method:l.method,category:l.category,is_display:l.is_display}}if(e){var d=$(".layer-select-label").attr("data-label"),h=parseInt($(".layer-select-label-style").attr("data-label-num"));$.extend(i,{mid:mid,id:current_layer_id,label_field:d,label_style_type:h}),MapUtils.ajax2server(e,"POST",i,function(){$(".style-back").trigger("click")},function(){})}},StyleUtils._setRegionLayerStyle=function(t){var e=null,i={};if("normal"==t){var n=$(".region-outline-select-color").attr("data-color"),r=parseInt($("#regionWeight input").val()),a=parseFloat($("#regionStrokeOpacity input").attr("region-stroke-opacity")),o="solid",s=$(".region-fill-select-color").attr("data-color"),l=parseFloat($("#regionFillOpacity input").attr("region-fill-opacity"));e=set_uniform_style_region_layer_url,i={strokeWeight:r,strokeColor:n,strokeOpacity:a,strokeStyle:o,fillColor:s,fillOpacity:l}}else if("classify"==t){e=category_by_field_region_layer_url;var d=StyleUtils.layersHashMap.get("r_"+current_layer_id),h=CategoryUtils.getCategorySettings(d,"region");i={field:h.field,is_number_field:h.is_number_field,method:h.method,category:h.category,is_display:h.is_display}}if(e){var c=$(".layer-select-label").attr("data-label"),u=parseInt($(".layer-select-label-style").attr("data-label-num"));$.extend(i,{mid:mid,id:current_layer_id,label_field:c,label_style_type:u}),MapUtils.ajax2server(e,"POST",i,function(){$(".style-back").trigger("click")},function(){})}},StyleUtils.getFontFamilyTemplate=function(){var t=StyleUtils.layersHashMap.get("m_"+current_layer_id).getTextConfig().font;return $.templates.marker_text_family.render({text_family:t})},StyleUtils.getColorTemplate=function(t){var e="";return StyleUtils.layersHashMap.get("r_"+current_layer_id)?e="region_layer":StyleUtils.layersHashMap.get("l_"+current_layer_id)&&(e="line_layer"),$.templates.color.render({layer_type:e,className:t})};var t=!0;StyleUtils.getShapeTemplate=function(){var e,i=$("#marker_has_bubble").is(":checked");return t?(e={has_bubble:i,custom_icons:!0},t=!1):e={has_bubble:i,custom_icons:!1},$.templates.shape.render(e)},StyleUtils.openLayerStylePanel=function(t){var e=["layer_style_panel","marker_layer","line_layer","region_layer","marker_style_normal","line_style_normal","region_style_normal","overlay_size","color","shape","icon_shape","attrs","label","label_style","marker_canvas","marker_canvas_icon","marker_heatmap","heatmap_color","heatmap_weight","marker_classify","line_classify","line_style_type","region_classify","classify_fields","classify_result_panel","classify_count","marker_sort","marker_text","marker_text_family"];$(".map-info-tab").hide(),$.when($.lazyGetTemplate(e)).done(function(){$(".layer-style-panel").empty(),$.views.settings.allowCode=!0,t.shapeArray=StyleUtils.shapeArray;var e="";$("#marker_layer_"+current_layer_id).length>0?e="m_":$("#line_layer_"+current_layer_id).length>0?e="l_":$("#region_layer_"+current_layer_id).length>0&&(e="r_");var i=StyleUtils.layersHashMap.get(e+current_layer_id);t.layer=i,"marker_layer"==i.type?StyleUtils.initMarkerStylePanel(t):"line_layer"==i.type?StyleUtils.initLineStylePanel(t):"region_layer"==i.type&&StyleUtils.initRegionStylePanel(t),StyleUtils.initClickEvents(),$(".layer-caption").popover({html:!0,template:'<div class="popover" style="margin-top:-15px;" role="tooltip" ><div class="arrow"></div><div class="popover-content"></div></div>'}),$(".style-caption").popover({html:!0,template:'<div class="popover" role="tooltip" ><div class="arrow"></div><div class="popover-content"></div></div>'}),$(".marker-layer").height($(".layer-style-panel").height()-$(".marker-layer-style-setting").height()-32-8-96).css("overflow-y","auto"),$(".line-layer").height($(".layer-style-panel").height()-$(".line-layer-style-setting").height()-32-8-96).css("overflow-y","auto"),$(".region-layer").height($(".layer-style-panel").height()-$(".region-layer-style-setting").height()-32-8-96).css("overflow-y","auto")})},StyleUtils.initMarkerStylePanel=function(t){var e=$.views.viewModels.MarkerLayerStyle.map(t),i=$.templates.layer_style_panel.render(e);$(".layer-style-panel").append(i),StyleUtils.initLayerStylePanel(e.markerLayerStyleType(),"marker_layer"),$(".layer-style-panel").removeClass("dt-none").css("z-index",99),$(".marker-layer").height($(".layer-style-panel").height()-$(".marker-layer-style-setting").height()-32-8).css("overflow-y","auto")},StyleUtils.initLineStylePanel=function(t){var e=$.views.viewModels.LineLayerStyle.map(t),i=$.templates.layer_style_panel.render(e);$(".layer-style-panel").append(i),StyleUtils.initLayerStylePanel(e.lineLayerStyleType(),"line_layer"),$(".layer-style-panel").removeClass("dt-none").css("z-index",99),$(".line-layer").height($(".layer-style-panel").height()-$(".marker-layer-style-setting").height()-32-8).css("overflow-y","auto")},StyleUtils.initRegionStylePanel=function(t){var e=$.views.viewModels.RegionLayerStyle.map(t),i=$.templates.layer_style_panel.render(e);$(".layer-style-panel").append(i),StyleUtils.initLayerStylePanel(e.regionLayerStyleType(),"region_layer"),$(".layer-style-panel").removeClass("dt-none").css("z-index",99),$(".region-layer").height($(".layer-style-panel").height()-$(".marker-layer-style-setting").height()-32-8).css("overflow-y","auto")},StyleUtils.getClassifyField=function(){var t,e=$(".classify-field").attr("data-field"),i=$(".classify-field").closest("div").attr("data-layer-type");"marker_layer"==i?t=StyleUtils.layersHashMap.get("m_"+current_layer_id):"line_layer"==i?t=StyleUtils.layersHashMap.get("l_"+current_layer_id):"region_layer"==i&&(t=StyleUtils.layersHashMap.get("r_"+current_layer_id));var n={field_id:null,attr_fields:[],type:i};if(t){var r=t.getAttrFields(),a=t.getAttrField(e);n={field_id:a.id,attr_fields:r,type:i}}return $.templates.classify_fields.render(n)},StyleUtils.getClassifyType=function(){var t=StyleUtils.layersHashMap.get(current_layer_id),e=t.getCategoryConfig(),i=t.type.replace("_layer",""),n=$("."+i+"-classify-type").find("a.active").attr("data-type"),r="<ul>";return r+="<li>",r+="unique"==n?"<input type='radio' id='classifyUnique' name='classify_type_radio' value='unique' checked/>":"<input type='radio' id='classifyUnique' name='classify_type_radio' value='unique'/>",r+="<span class='dt-mar6l'>\u7c7b\u522b</span>",r+="</li>",r+="<li>",r+="range"==n?"<input type='radio' id='classifyRang' name='classify_type_radio' value='range' checked/>":e.is_number_field?"<input type='radio' id='classifyRang' name='classify_type_radio' value='range' />":"<input type='radio' id='classifyRang' name='classify_type_radio' value='range' disabled />",r+="<span class='dt-mar6l'>\u8303\u56f4</span>",r+="</li>",r+="</ul>"},StyleUtils.getClassifyCount=function(){var t;$(".classify-count").closest("div").hasClass("marker-layer")?t="marker-layer":$(".classify-count").closest("div").hasClass("line-layer")?t="line-layer":$(".classify-count").closest("div").hasClass("region-layer")&&(t="region-layer");var e=$(".classify-count").attr("data-level"),i={current_count:e,type:t};return $.templates.classify_count.render(i)},StyleUtils.heatmapHandler=function(){function t(t){isNaN(t)?t=1:t<1?t=1:t>20&&(t=20),$("#heatmap-radius input").val(t)}$("#heatmap-radius input").unbind().blur(function(){t($(this).val())}),$("#heatmap-radius .spinner .btn:first-of-type").unbind().click(function(){var e=MapUtils.accAdd(parseInt($("#heatmap-radius input").val()),1);t(e)}),$("#heatmap-radius .spinner .btn:last-of-type").unbind().click(function(){var e=MapUtils.addSub(parseInt($("#heatmap-radius input").val()),1);t(e)})},StyleUtils.txtHandler=function(){function t(t){isNaN(t)?t=14:t<12?t=12:t>34&&(t=34),$("#txtSize input").val(t),StyleUtils.showTextPreview()}$("#txtSize input").unbind().blur(function(){t($(this).val())}),$("#txtSize .btn:first-of-type").unbind().click(function(){var e=MapUtils.accAdd(parseInt($("#txtSize input").val()),1);t(e)}),$("#txtSize .btn:last-of-type").unbind().click(function(){var e=MapUtils.addSub(parseInt($("#txtSize input").val()),1);t(e)})},StyleUtils.weightHandler=function(t){function e(e){isNaN(e)?e=4:e<1?e=1:e>10&&(e=10),$("#"+t+" input").val(e),t.indexOf("line")>=0?StyleUtils.showLineNormalPreview():StyleUtils.showRegionNormalPreview()}$("#"+t+"  input").unbind().blur(function(){e($(this).val())}),$("#"+t+" .btn:first-of-type").unbind().click(function(){var i=MapUtils.accAdd(parseInt($("#"+t+" input").val()),1);e(i)}),$("#"+t+" .btn:last-of-type").unbind().click(function(){var i=MapUtils.addSub(parseInt($("#"+t+" input").val()),1);e(i)})},StyleUtils.opacityHandle=function(t,e){function i(i){isNaN(i)?i=20:i<0?i=0:i>100&&(i=100),$("#"+t+" input").attr(e,(100-i)/100).val(i),t.indexOf("line")>=0?StyleUtils.showLineNormalPreview():StyleUtils.showRegionNormalPreview()}$("#"+t+" input").unbind().blur(function(){i($(this).val());
}),$("#"+t+" .btn:first-of-type").unbind().click(function(){var e=MapUtils.accAdd(parseInt($("#"+t+" input").val()),1);i(e)}),$("#"+t+" .btn:last-of-type").unbind().click(function(){var e=MapUtils.addSub(parseInt($("#"+t+" input").val()),1);i(e)})},StyleUtils.getBubble=function(){var t=$(".layer-has-bubble").text(),e="<ul>";return e+="<li>",e+="\u6709"==t?"<input type='radio' name='bubble_radio' value='true'  checked/>":"<input type='radio' name='bubble_radio' value='true'/>",e+='<span class="dt-mar6l">\u6709</span>',e+="</li>",e+="<li>",e+="\u65e0"==t?"<input type='radio' name='bubble_radio' value='false' checked/>":"<input type='radio' name='bubble_radio' value='false' />",e+='<span class="dt-mar6l">\u65e0</span>',e+="</li>",e+="</ul>"},StyleUtils.getCluster=function(){var t=$(".layer-has-cluster").first().text(),e="<ul>";return e+="<li>",e+="\u662f"==t?"<input type='radio' name='cluster_radio' value='true'  checked/>":"<input type='radio' name='cluster_radio' value='true'/>",e+='<span class="dt-mar6l">\u662f</span>',e+="</li>",e+="<li>",e+="\u5426"==t?"<input type='radio' name='cluster_radio' value='false' checked/>":"<input type='radio' name='cluster_radio' value='false' />",e+='<span class="dt-mar6l">\u5426</span>',e+="</li>",e+="</ul>"},StyleUtils.getClassify=function(){var t=$(".layer-data-has-classify").first().text(),e="<ul>";return e+="<li>",e+="\u662f"==t?"<input type='radio' name='classify_radio' value='true'  checked/>":"<input type='radio' name='classify_radio' value='true'/>",e+='<span class="dt-mar6l">\u662f</span>',e+="</li>",e+="<li>",e+="\u5426"==t?"<input type='radio' name='classify_radio' value='false' checked/>":"<input type='radio' name='classify_radio' value='false' />",e+='<span class="dt-mar6l">\u5426</span>',e+="</li>",e+="</ul>"},StyleUtils.getLineType=function(){var t=$(".line-select-type").attr("data-line-type");$.views.settings.allowCode=!0;var e={current:t};return $.templates.line_style_type.render(e)},StyleUtils.getCanvasIcon=function(t,e){switch(t){case"BMAP_POINT_SHAPE_WATERDROP":return"<div class='canvas-marker'></div>";case"BMAP_POINT_SHAPE_CIRCLE":return"<div class='canvas-circle' style='background-color:"+e+"'></div>";case"BMAP_POINT_SHAPE_STAR":return"<div class='glyphicon glyphicon-star canvas-star' style='color:"+e+"'>";case"BMAP_POINT_SHAPE_SQUARE":return"<div class='canvas-square' style='background-color:"+e+"'></div>";case"BMAP_POINT_SHAPE_RHOMBUS":return"<div class='canvas-rhombus' style='background-color:"+e+"'></div>";default:return""}},StyleUtils.getMarkerLayerStyleType=function(){return $(".layer-style-active").parent().attr("marker-layer-style")},StyleUtils.getLineLayerStyleType=function(){return $(".layer-style-active").parent().attr("line-layer-style")},StyleUtils.getRegionLayerStyleType=function(){return $(".layer-style-active").parent().attr("region-layer-style")},StyleUtils.showMarkerNormalPreview=function(){if($(".layer-normal-bubble").is(":visible")){var t=$("#marker_has_bubble").is(":checked"),e=$(".layer-select-color").attr("data-color"),i=$(".layer-select-shape").attr("data-symbol"),n=$(".marker-normal-size").find(".active").attr("data-size");$(".preview-panel").empty();var r=".png",a="default";t||(r=".svg",a="svg");var o=oss_host+"/uploads/icons/"+a+"/"+e.substring(1,e.length)+"-"+n+"-"+i+r}else var o=$(".layer-select-shape").find("img").attr("src");var s="<img src='"+o+"' class='dt-pos-a' style='top:50%;left:50%'/>";s+="<img src='"+o+"' class='dt-pos-a' style='top:35%;left:35%'/>",s+="<img src='"+o+"' class='dt-pos-a' style='left:65%;top:65%'/>",s+="<img src='"+o+"' class='dt-pos-a' style='left:50%;top:65%'/>",s+="<img src='"+o+"' class='dt-pos-a' style='left:55%;top:45%'/>",$(".preview-panel").append(s)},StyleUtils.showMarkerCanvasPreview=function(){var t=$(".layer-canvas-select-color").attr("data-color"),e=$(".layer-canvas-shape").attr("data-shape"),i=$(".marker-canvas-size").find(".active").attr("data-size"),n="";$(".preview-panel").empty(),n="BMAP_POINT_SHAPE_STAR"==e?"BMAP_POINT_SIZE_SMALL"==i?"font-size:12px;":"BMAP_POINT_SIZE_NORMAL"==i?"font-size:15px;":"font-size:18px;":"BMAP_POINT_SIZE_SMALL"==i?"width:8px;height:8px;":"BMAP_POINT_SIZE_NORMAL"==i?"width:11px;height:11px;":"width:14px;height:14px;";var r="";switch(e){case"BMAP_POINT_SHAPE_CIRCLE":r+="<div class='canvas-circle dt-pos-a' style='background-color:"+t+";top:50%;left:50%;"+n+"'></div>",r+="<div class='canvas-circle dt-pos-a' style='background-color:"+t+";top:35%;left:35%;"+n+"'></div>",r+="<div class='canvas-circle dt-pos-a' style='background-color:"+t+";top:65%;left:65%;"+n+"'></div>",r+="<div class='canvas-circle dt-pos-a' style='background-color:"+t+";top:50%;left:65%;"+n+"'></div>",r+="<div class='canvas-circle dt-pos-a' style='background-color:"+t+";top:55%;left:45%;"+n+"'></div>",r+="<div class='canvas-circle dt-pos-a' style='background-color:"+t+";top:75%;left:25%;"+n+"'></div>",$(".preview-panel").append(r);break;case"BMAP_POINT_SHAPE_SQUARE":r+="<div class='canvas-square dt-pos-a' style='background-color:"+t+";top:50%;left:50%;"+n+"'></div>",r+="<div class='canvas-square dt-pos-a' style='background-color:"+t+";top:35%;left:35%;"+n+"'></div>",r+="<div class='canvas-square dt-pos-a' style='background-color:"+t+";top:65%;left:65%;"+n+"'></div>",r+="<div class='canvas-square dt-pos-a' style='background-color:"+t+";top:50%;left:65%;"+n+"'></div>",r+="<div class='canvas-square dt-pos-a' style='background-color:"+t+";top:55%;left:45%;"+n+"'></div>",r+="<div class='canvas-square dt-pos-a' style='background-color:"+t+";top:75%;left:25%;"+n+"'></div>",$(".preview-panel").append(r);break;case"BMAP_POINT_SHAPE_STAR":r+="<div class='glyphicon glyphicon-star canvas-star dt-pos-a' style='color:"+t+";top:50%;left:50%;"+n+"'></div>",r+="<div class='glyphicon glyphicon-star canvas-star dt-pos-a' style='color:"+t+";top:35%;left:35%;"+n+"'></div>",r+="<div class='glyphicon glyphicon-star canvas-star dt-pos-a' style='color:"+t+";top:65%;left:65%;"+n+"'></div>",r+="<div class='glyphicon glyphicon-star canvas-star dt-pos-a' style='color:"+t+";top:50%;left:65%;"+n+"'></div>",r+="<div class='glyphicon glyphicon-star canvas-star dt-pos-a' style='color:"+t+";top:55%;left:45%;"+n+"'></div>",r+="<div class='glyphicon glyphicon-star canvas-star dt-pos-a' style='color:"+t+";top:75%;left:25%;"+n+"'></div>",$(".preview-panel").append(r);break;case"BMAP_POINT_SHAPE_RHOMBUS":r+="<div class='canvas-rhombus dt-pos-a' style='background-color:"+t+";top:50%;left:50%;"+n+"'></div>",r+="<div class='canvas-rhombus dt-pos-a' style='background-color:"+t+";top:35%;left:35%;"+n+"'></div>",r+="<div class='canvas-rhombus dt-pos-a' style='background-color:"+t+";top:65%;left:65%;"+n+"'></div>",r+="<div class='canvas-rhombus dt-pos-a' style='background-color:"+t+";top:50%;left:65%;"+n+"'></div>",r+="<div class='canvas-rhombus dt-pos-a' style='background-color:"+t+";top:55%;left:45%;"+n+"'></div>",r+="<div class='canvas-rhombus dt-pos-a' style='background-color:"+t+";top:75%;left:25%;"+n+"'></div>",$(".preview-panel").append(r);break;case"BMAP_POINT_SHAPE_WATERDROP":r+="<div class='canvas-marker dt-pos-a' style='top:50%;left:50%;'></div>",r+="<div class='canvas-marker dt-pos-a' style='top:35%;left:35%;'></div>",r+="<div class='canvas-marker dt-pos-a' style='top:65%;left:65%;'></div>",r+="<div class='canvas-marker dt-pos-a' style='top:50%;left:65%;'></div>",r+="<div class='canvas-marker dt-pos-a' style='top:55%;left:45%;'></div>",r+="<div class='canvas-marker dt-pos-a' style='top:75%;left:25%;'></div>",$(".preview-panel").append(r)}},StyleUtils.showHeatmapPreview=function(){var t=$(".heatmap-schemes").attr("heatmap-color");$(".preview-panel").empty();var e="";switch(t){case"one":e+="<div class='heatmap-one-img dt-pos-a'></div>",$(".preview-panel").append(e);break;case"two":e+="<div class='heatmap-two-img dt-pos-a'></div>",$(".preview-panel").append(e);break;case"three":e+="<div class='heatmap-three-img dt-pos-a'></div>",$(".preview-panel").append(e);break;case"four":e+="<div class='heatmap-four-img dt-pos-a'></div>",$(".preview-panel").append(e)}},StyleUtils.showTextPreview=function(){var t=$("#text_has_background").is(":checked"),e="",i=$(".layer-select-font").attr("data-font-family"),n=$(".layer-select-txt-color").attr("data-color"),r=$("#txtSize input").val();if($(".preview-panel").empty(),t){var a=$(".layer-select-txt-bg-color").attr("data-color"),o=$(".layer-select-txt-border-color").attr("data-color");e+="<p class='bubble-3 dt-pos-a' style='left:50%;top:50%;'>",e+="<span class='num' style='background-color:"+a+";border:1px solid "+o+";color:"+n+";font-size:"+r+"px;font-family: "+i+"'>\u70b91</span>",e+='<i class="arrow-up" style="border-top-color:'+o+'"><i class="arrow" style="border-top-color: '+a+'"></i><i></i></i>',e+="</p>",e+="<p class='bubble-3 dt-pos-a' style='left:35%;top:35%;'>",e+="<span class='num' style='background-color:"+a+";border:1px solid "+o+";color:"+n+";font-size:"+r+"px;font-family: "+i+"'>\u70b92</span>",e+='<i class="arrow-up" style="border-top-color:'+o+'"><i class="arrow" style="border-top-color: '+a+'"></i><i></i></i>',e+="</p>",e+="<p class='bubble-3 dt-pos-a' style='left:65%;top:65%;'>",e+="<span class='num' style='background-color:"+a+";border:1px solid "+o+";color:"+n+";font-size:"+r+"px;font-family: "+i+"'>\u70b93</span>",e+='<i class="arrow-up" style="border-top-color:'+o+'"><i class="arrow" style="border-top-color: '+a+'"></i><i></i></i>',e+="</p>",e+="<p class='bubble-3 dt-pos-a' style='left:50%;top:65%;'>",e+="<span class='num' style='background-color:"+a+";border:1px solid "+o+";color:"+n+";font-size:"+r+"px;font-family: "+i+"'>\u70b94</span>",e+='<i class="arrow-up" style="border-top-color:'+o+'"><i class="arrow" style="border-top-color: '+a+'"></i><i></i></i>',e+="</p>",e+="<p class='bubble-3 dt-pos-a' style='left:55%;top:45%;'>",e+="<span class='num' style='background-color:"+a+";border:1px solid "+o+";color:"+n+";font-size:"+r+"px;font-family: "+i+"'>\u70b95</span>",e+='<i class="arrow-up" style="border-top-color:'+o+'"><i class="arrow" style="border-top-color: '+a+'"></i><i></i></i>',e+="</p>"}else e="<span class='dt-pos-a' style='color:"+n+";font-size:"+r+"px;left:50%;top:50%;font-family: "+i+"'>\u70b91</span>",e+="<span class='dt-pos-a' style='color:"+n+";font-size:"+r+"px;left:35%;top:35%;font-family: "+i+"'>\u70b92</span>",e+="<span class='dt-pos-a' style='color:"+n+";font-size:"+r+"px;left:65%;top:65%;font-family: "+i+"'>\u70b93</span>",e+="<span class='dt-pos-a' style='color:"+n+";font-size:"+r+"px;left:50%;top:65%;font-family: "+i+"'>\u70b94</span>",e+="<span class='dt-pos-a' style='color:"+n+";font-size:"+r+"px;left:55%;top:45%;font-family: "+i+"'>\u70b95</span>";$(".preview-panel").append(e)},StyleUtils.showSortPreview=function(){var t=$(".marker-sort-panel").find(".active").attr("data-sort"),e=$(".layer-select-sort-color").attr("data-color"),i=$(".marker-sort-size").find(".active").attr("data-size");$(".preview-panel").empty();var n="";"a-z"==t?(n+="<img src='"+oss_host+"/uploads/icons/default/"+e.substring(1,e.length)+"-"+i+"-a.png' class='dt-pos-a' style='top:50%;left:50%'/>",n+="<img src='"+oss_host+"/uploads/icons/default/"+e.substring(1,e.length)+"-"+i+"-b.png' class='dt-pos-a' style='top:35%;left:35%'/>",n+="<img src='"+oss_host+"/uploads/icons/default/"+e.substring(1,e.length)+"-"+i+"-c.png' class='dt-pos-a' style='left:65%;top:65%'/>",n+="<img src='"+oss_host+"/uploads/icons/default/"+e.substring(1,e.length)+"-"+i+"-d.png' class='dt-pos-a' style='left:50%;top:65%'/>",n+="<img src='"+oss_host+"/uploads/icons/default/"+e.substring(1,e.length)+"-"+i+"-e.png' class='dt-pos-a' style='left:55%;top:45%'/>",$(".preview-panel").append(n)):(n+="<img src='"+oss_host+"/uploads/icons/default/"+e.substring(1,e.length)+"-"+i+"-1.png' class='dt-pos-a' style='top:50%;left:50%'/>",n+="<img src='"+oss_host+"/uploads/icons/default/"+e.substring(1,e.length)+"-"+i+"-2.png' class='dt-pos-a' style='top:35%;left:35%'/>",n+="<img src='"+oss_host+"/uploads/icons/default/"+e.substring(1,e.length)+"-"+i+"-3.png' class='dt-pos-a' style='left:65%;top:65%'/>",n+="<img src='"+oss_host+"/uploads/icons/default/"+e.substring(1,e.length)+"-"+i+"-4.png' class='dt-pos-a' style='left:50%;top:65%'/>",n+="<img src='"+oss_host+"/uploads/icons/default/"+e.substring(1,e.length)+"-"+i+"-5.png' class='dt-pos-a' style='left:55%;top:45%'/>",$(".preview-panel").append(n))},StyleUtils.showLineNormalPreview=function(){var t=$(".line-layer-select-color").attr("data-color"),e=$("#lineWeight input").val(),i=$("#lineOpacity input").attr("line-opacity"),n=$(".line-select-type").attr("data-line-type"),r="",a="";$(".preview-panel").empty(),"arrow"==n?(n="solid",r="<div class='dt-pos-a' style='border-width:"+4*e+"px "+4*e+"px 0;border-style:solid;border-color:"+t+" transparent transparent;top:100%;margin:"+e+"px auto auto "+-(4*e)+"px'></div>",a="<div class='dt-pos-a' style='border-top:"+4*e+"px solid transparent;border-bottom:"+4*e+"px solid transparent;border-left:"+4*e+"px solid "+t+";margin:"+-(4*e)+"px auto auto 110px;'></div>"):"arrow_node"==n&&(n="solid",r="<div class='dt-pos-a' style='border-width:"+4*e+"px "+4*e+"px 0;border-style:solid;border-color:"+t+" transparent transparent;top:100%;margin:"+e+"px auto auto "+-(4*e)+"px'></div>",r+="<div class='dt-pos-a' style='border-width:"+4*e+"px "+4*e+"px 0;border-style:solid;border-color:"+t+" transparent transparent;top:50%;margin:"+e+"px auto auto "+-(4*e)+"px'></div>",a="<div class='dt-pos-a' style='border-top:"+4*e+"px solid transparent;border-bottom:"+4*e+"px solid transparent;border-left:"+4*e+"px solid "+t+";margin:"+-(4*e)+"px auto auto 110px;'></div>",a+="<div class='dt-pos-a' style='border-top:"+4*e+"px solid transparent;border-bottom:"+4*e+"px solid transparent;border-left:"+4*e+"px solid "+t+";margin:"+-(4*e)+"px auto auto 55px;'></div>");var o="<div class='dt-pos-a' style='border:"+e+"px "+n+" "+t+";filter:alpha(opacity="+100*i+");opacity: "+i+";left:40%;top:40%;height:120px;'>"+r+"</div>",s="<div class='dt-pos-a' style='border:"+e+"px "+n+" "+t+";filter:alpha(opacity="+100*i+");opacity: "+i+";left:30%;top:45%;width:120px;'>"+a+"</div>";$(".preview-panel").append(o+s)},StyleUtils.showRegionNormalPreview=function(){var t=$(".region-fill-select-color").attr("data-color"),e=MapUtils.RGB2Hex(t.substring(1,t.length)),i=$("#regionFillOpacity input").attr("region-fill-opacity"),n=$(".region-outline-select-color").attr("data-color"),r=MapUtils.RGB2Hex(n.substring(1,n.length)),a=$("#regionWeight input").val(),o=$("#regionStrokeOpacity input").attr("region-stroke-opacity"),s="border:"+a+"px solid rgba("+r[0]+","+r[1]+","+r[2]+","+o+");",l="background-color:rgba("+e[0]+","+e[1]+","+e[2]+","+i+");";$(".preview-panel").empty();var d="<div class='dt-pos-a' style='width:160px;height:90px;"+s+l+"top:35%;left:25%;'></div>";$(".preview-panel").append(d)},StyleUtils.createCustomColorPicker=function(){$(".sp-container").remove(),$("#full").spectrum({color:"#f86767",showInput:!0,containerClassName:"full-spectrum",showInitial:!0,showPalette:!0,showSelectionPalette:!0,maxPaletteSize:6,preferredFormat:"hex",localStorageKey:"spectrum.demo",move:function(){},show:function(){},beforeShow:function(){},hide:function(){},palette:[]})}});var MarkerUtils=window.MarkerUtils=MarkerUtils||{};$(function(){MarkerUtils.layersHashMap="",MarkerUtils.map="",MarkerUtils.overlays=[],MarkerUtils.markerTimer=!1,MarkerUtils.markerJson2Marker=function(t,e){var i,n=L.icon({iconUrl:oss_host+t.icon.url,iconSize:[t.icon.width,t.icon.height]});if(0==e.render_style)i=new Dtwy.Marker(L.latLng(t.lat,t.lng),{data:t,icon:n});else if(1==e.render_style){var r=e.canvas_config;i=new Dtwy.CanvasMarker(L.latLng(t.lat,t.lng),{data:t,color:r.color,fillColor:r.color,fillOpacity:1,size:r.size,shape:r.shape,icon:n})}else if(4==e.render_style){var a=e.text_config,o=MapUtils.getTextFontFamily(a.font),s=t.title;s&&0!=s.length||(s="&#12288;");var l=MarkerUtils.createTextHtml(a,s,o);n=L.divIcon({html:l,className:"leaflet-text-icon",iconUrl:oss_host+t.icon.url,iconSize:[t.icon.width,t.icon.height]}),i=new Dtwy.Marker(L.latLng(t.lat,t.lng),{data:t,icon:n})}else i=new Dtwy.Marker(L.latLng(t.lat,t.lng),{data:t,icon:n});return!i.isError&&"hide"!=e.display&&i.display||i.hide(),MarkerUtils.addHandler(i),4==e.render_style||i.getIcon().html||MapUtils.addLabelToOverlay(i,!0),MarkerUtils.all&&MarkerUtils.all.put(i.feature_id,i),i},MarkerUtils.addMarker2HashMap=function(t,e){var i=MarkerUtils.layersHashMap.get("m_"+t);if(i){var n=i.getMarkers();n.put(e.feature_id,e),n.add(e)}},MarkerUtils.addHandler=function(t){t.on("click",function(e){$(document).trigger("dt.select.marker",t),L.DomEvent.stopPropagation(e)})},MarkerUtils.refactorMarkerJSON=function(t,e){for(var i=0;i<t.marker_attrs.length;i++)t.marker_attrs[i]&&(t.marker_attrs[i].key=e.attrs[i]);return t.user=e.users[t.user_id],t.icon=e.icons[t.icon_id],t.label_field=e.label_config.field,t.label_style_type=e.label_config.style_type,t},MarkerUtils.showCanvasMarker=function(t){for(var e=t.markers,i=0;i<e.length;i++)if(e[i].lng!=-9999&&e[i].lat!=-9999&&(e[i]=MarkerUtils.refactorMarkerJSON(t.markers[i],t),"hide"!=t.display)){var n=MarkerUtils.markerJson2Marker(e[i],t);MarkerUtils.addMarker2HashMap(n.layer_id,n),n.display&&MarkerUtils.overlays.push(n)}},MarkerUtils.updateHeatmap=function(t,e){if(MarkerUtils.map.dt_heatmap[t.id]){for(var i=MarkerUtils.map.dt_heatmap[t.id][1],n=MarkerUtils.map.dt_heatmap[t.id][2],r=n.max,a=n.field,o=n.config,s=0;s<i.length;s++)i[s].id==e.feature_id&&e.display&&(i[s]=MarkerUtils.generateHeatmapPoint(e,a));var l={radius:o.radius,maxOpacity:.8,scaleRadius:!1,latField:"lat",lngField:"lng",valueField:"count",gradient:o.gradient},d=MarkerUtils.map.dt_heatmap[t.id][0];d.remove(),d=new HeatmapOverlay(l);var h={max:r,data:i};d.setData(h),d.addTo(MarkerUtils.map),"hide"==t.display&&d.hide(),$(".heatmap-canvas").parent().css("height",0),MarkerUtils.map.dt_heatmap[t.id]=[d,i,n]}},MarkerUtils.generateHeatmapPoint=function(t,e){var i=1;null!=e&&(i=parseFloat(MapUtils.get_attr_value(t.attrs,e))),$.isNumeric(i)||(i=1);var n=t.getPosition();return{lng:n.lng,lat:n.lat,count:i,id:t.feature_id}},MarkerUtils.showHeatmap=function(t){var e=t.heatmap_config;$("a.heatmap[data-type='"+e.gradient+"']").addClass("active");var i=MarkerUtils.heatmapConfig(e.gradient,e.radius,t.id),n=e.field,r=e.max;null==r&&(r=2);for(var a=t.markers,o=[],s=0;s<a.length;s++)if(a[s].lng!=-9999&&a[s].lat!=-9999){a[s]=MarkerUtils.refactorMarkerJSON(t.markers[s],t);var l=MarkerUtils.markerJson2Marker(a[s],t);MarkerUtils.addMarker2HashMap(l.layer_id,l),l.display&&o.push(MarkerUtils.generateHeatmapPoint(l,n))}var d={radius:i.radius,maxOpacity:.8,scaleRadius:!1,latField:"lat",lngField:"lng",valueField:"count",gradient:i.gradient},h=new HeatmapOverlay(d),c={max:r,data:o};h.setData(c),h.addTo(MarkerUtils.map),"hide"==t.display&&h.hide(),$(".heatmap-canvas").parent().css("height",0),MarkerUtils.map.dt_heatmap[t.id]=[h,o,{max:r,field:n,config:i}]},MarkerUtils.showClusterer=function(t){MarkerUtils.map.dt_clusterer[t.id]=L.markerClusterGroup({spiderfyOnMaxZoom:!1,disableClusteringAtZoom:18});for(var e=0;e<t.markers.length;e++)t.markers[e]=MarkerUtils.refactorMarkerJSON(t.markers[e],t),"hide"!=t.display&&MarkerUtils.addMarker2Map(t.markers[e],!0);MarkerUtils.map.addLayer(MarkerUtils.map.dt_clusterer[t.id])},MarkerUtils.showTextOverlay=function(t){for(var e=t.markers,i=0;i<e.length;i++)if(e[i].lng!=-9999&&e[i].lat!=-9999){e[i]=MarkerUtils.refactorMarkerJSON(t.markers[i],t);var n=MarkerUtils.markerJson2Marker(e[i],t);MarkerUtils.addMarker2HashMap(n.layer_id,n),MarkerUtils.overlays.push(n),MarkerUtils.map.dt_text_overlay[t.id]=!0}},MarkerUtils.showNormalMarker=function(t){for(var e=0;e<t.markers.length;e++)t.markers[e]=MarkerUtils.refactorMarkerJSON(t.markers[e],t),MarkerUtils.addMarker2Map(t.markers[e],!0);MarkerUtils.map.dt_marker[t.id]=!0},MarkerUtils.isHasLngLat=function(t){return"undefined"!=typeof t.lng&&"undefined"!=typeof t.lat&&(t.lng!=-9999&&t.lat!=-9999&&(""!=t.lng&&""!=t.lat&&(null!=t.lng&&null!=t.lat&&("undefined"!=t.lng&&"undefined"!=t.lat))))},MarkerUtils.isOverlapLabel=function(t,e){var i=t.getLatLng(),n=e.latLngToContainerPoint(i),r=!1;return e.eachLayer(function(i){if(i instanceof Dtwy.Marker&&i.feature_id!=t.feature_id&&e.hasLayer(i.getLabel())){var a=i.getLatLng(),o=e.latLngToContainerPoint(a);n.distanceTo(o)<5&&(r=!0)}}),r},MarkerUtils.bindLabel=function(t,e){for(var i=0;i<t.attrs.length;i++){var n=t.attrs[i];n&&n.key==e&&t.bindLabel(n.value||"",{noHide:!0,pane:"popupPane",offset:[10,-28]})}},MarkerUtils.getMarkerReplyDetails=function(t,e,i,n){$.views.settings.allowCode=!0;var r=[{details:i,start_date:t,end_date:e,replies_count:n}];return $("#markerReplyList").render(r)},MarkerUtils.strLngLat2Point=function(t){return new L.LatLng(t.split(",")[1],t.split(",")[0])},MarkerUtils.addDirectionMarkerToMap=function(t,e){t.wayPoints&&e.removeOverlay(t.wayPoints);var i="<div class='way-points' line-id='"+t.feature_id+"' style='background-color:"+t.line_style.strokeColor+"'>\u8d77</div>",n=MarkerUtils.strLngLat2Point(t.line_route.origin_point.lnglat),r=new L.divIcon({html:i,className:"leaflet-direction-icon"}),a=new Dtwy.Marker(n,{icon:r,zIndexOffset:1});t.wayPoints=new L.LayerGroup([a]);for(var o=0;o<t.line_route.way_points.length;o++){var s="<div class='way-points' line-id='"+t.feature_id+"' style='background-color:"+t.line_style.strokeColor+"'>"+(o+1)+"</div>",l=MarkerUtils.strLngLat2Point(t.line_route.way_points[o].lnglat),d=new L.divIcon({html:s,className:"leaflet-direction-icon"}),h=new Dtwy.Marker(l,{icon:d,zIndexOffset:1});t.wayPoints.addLayer(h)}var c=t.line_route.origin_point.marker_id,u=t.line_route.destination_point.marker_id;if(c!=u){var p="<div class='way-points' line-id='"+t.feature_id+"' style='background-color:"+t.line_style.strokeColor+"'>\u7ec8</div>",f=MarkerUtils.strLngLat2Point(t.line_route.destination_point.lnglat),m=new L.divIcon({html:p,className:"leaflet-direction-icon"}),g=new Dtwy.Marker(f,{icon:m,zIndexOffset:1});t.wayPoints.addLayer(g)}var _=MarkerUtils.layersHashMap.get("l_"+t.layer_id);"hide"==_.display&&t.hide()},MarkerUtils.checkRole=function(t){var e={};e.mapUsers=MarkerUtils.map.cooperation,t&&t.cooperation&&(e.layerUsers=t.cooperation);var i=PermissionUtils.loginUserRole(user_phone,e);return["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458","\u56fe\u5c42\u6210\u5458","\u8bb0\u5f55\u6210\u5458"].indexOf(i)!=-1},MarkerUtils.checkUploadRole=function(t){if(t&&t.cooperation)var e=PermissionUtils.loginUserRole(user_phone,{mapUsers:MarkerUtils.map.cooperation,layerUsers:t.cooperation});else var e=PermissionUtils.loginUserRole(user_phone,{mapUsers:MarkerUtils.map.cooperation});if(["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458","\u56fe\u5c42\u6210\u5458"].indexOf(e)==-1)return!1;if("\u56fe\u5c42\u6210\u5458"==e){for(var i=!1,n=MarkerUtils.layersHashMap.values(),r=0;r<n.length;r++)n[r].id==data.layer_id&&(i=!0);if(!i)return!1}return!0},MarkerUtils.checkUpdateRole=function(t,e,i){var n={mapUsers:MarkerUtils.map.cooperation};t&&t.cooperation&&(n.layerUsers=t.cooperation);var r=PermissionUtils.loginUserRole(user_phone,n);if(["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458","\u56fe\u5c42\u6210\u5458"].indexOf(r)==-1){if("layer"==e)return!1;if("overlay"==e){if(!(t&&i&&i.overlay_id))return!1;var a=t.getMarker(i.overlay_id);if(!a||!a.cooperation)return!1;var o=a.cooperation;if(!o[0].phone==user_phone)return!1}}else if("\u56fe\u5c42\u6210\u5458"==r){for(var s=!1,l=MarkerUtils.getMarkerLayers(),d=0;d<l.length;d++)l[d].id==t.id&&(s=!0);if(!s)return!1}return!0},MarkerUtils.getMarkerLayers=function(){for(var t=MarkerUtils.layersHashMap.values(),e=[],i=0;i<t.length;i++){var n=t[i];"marker_layer"==n.type&&e.push(n)}return e},MarkerUtils.addMarker2Map=function(t,e){var i=MarkerUtils.layersHashMap.get("m_"+t.marker_layer_id),n=MarkerUtils.markerJson2Marker(t,i);return i?(MarkerUtils.addMarker2HashMap(t.marker_layer_id,n),"hide"!=i.display&&(i.isCluster()&&MarkerUtils.map.dt_clusterer[i.id]?MarkerUtils.map.dt_clusterer[i.id].addLayer(n):e?MarkerUtils.overlays.push(n):n.display&&n.addTo(MarkerUtils.map)),n):null},MarkerUtils.updateMarkerToMap=function(t){var e=MarkerUtils.layersHashMap.get("m_"+t.marker_layer_id),i=e.getMarker(t.id);if("undefined"!=typeof i&&null!==i){var n,r,a=t.layer_style,o=a.render_style;if(0==o||5==o||6==o){if(e.isCluster())return r=L.icon({iconUrl:oss_host+t.icon.url,iconSize:[t.icon.width,t.icon.height]}),i.setIcon(r),i.updateFromObj(t),MarkerUtils.refreshVector(e,i),void BInfowindow.refresh(i);i instanceof Dtwy.CanvasMarker?(i.remove(),n=MarkerUtils.markerJson2Marker(t,e),e.setMarker(n),"show"==e.display&&n.addTo(MarkerUtils.map),n.updateFromObj(t)):MarkerUtils.map.hasLayer(i)?(r=L.icon({iconUrl:oss_host+t.icon.url,iconSize:[t.icon.width,t.icon.height]}),i.setIcon(r),i.updateFromObj(t)):(n=MarkerUtils.markerJson2Marker(t,e),e.setMarker(n),"show"==e.display&&n.addTo(MarkerUtils.map)),MarkerUtils.refreshVector(e,i)}else if(1==o){if(i instanceof Dtwy.Marker)i.remove(),n=MarkerUtils.markerJson2Marker(t,e),e.setMarker(n),"show"==e.display&&n.addTo(MarkerUtils.map),n.updateFromObj(t);else{var s=t.layer_style.canvas_config;s=MapUtils.getCanvasStyle(s),i.setStyle(s),i.updateFromObj(t)}MarkerUtils.refreshVector(e,i)}else 4==o?MarkerUtils.map.hasLayer(i)?(i.getIcon().html||(r=L.icon({iconUrl:oss_host+t.icon.url,iconSize:[t.icon.width,t.icon.height]}),i.setIcon(r)),i.updateFromObj(t),BInfowindow.refresh(i)):(n=MarkerUtils.markerJson2Marker(t,e),e.setMarker(n),"show"==e.display&&n.addTo(MarkerUtils.map)):2==o&&(i.updateFromObj(t),MarkerUtils.updateHeatmap(e,i),BInfowindow.refresh(i,!0));if("marker"==i.type&&a&&a.label_config&&4!=e.render_style&&(i.label_field=a.label_config.field,i.label_style_type=a.label_config.style_type,MapUtils.addLabelToOverlay(i)),e.monitors&&has_message_audio){for(var l=0;l<e.monitors.length;l++){var d=e.monitors[l];if("false"==d.conditions.update)return;var h=MonitorUtils.validateMonitor(d,i.attrs,d.conditions.operate,!1);if(h)MonitorUtils.overlayMonitor(h,i,!1);else if(d.overlays){var c,u=i.feature_id;c=d.overlays.get(u),c&&(MonitorUtils._map.removeOverlay(c),d.overlays.remove(i.feature_id),$("[data-id='"+u+"']").remove())}}$("#popIntro").children().length>0&&($("#pop").slideDown(400),$("#popClose").unbind().click(function(){$("#pop").slideUp(400),$("#popIntro").children().empty()}))}$("#setMarkerTitle_"+i.feature_id).text(i.title||""),$("#marker_icon_"+i.feature_id).attr("src",oss_host+t.icon.url),"undefined"==typeof t.isError2&&t.isError&&(i.show(),$("#"+t.id).css("background","#fff"),$("#marker_layer_"+t.marker_layer_id+" ul").append(MarkerUtils.marker_div(t,e))),BInfowindow.refresh(i)}},MarkerUtils.deleteMarkerFromMap=function(t){var e=MarkerUtils.layersHashMap.get("m_"+t.marker_layer_id);if(e){var i=e.getMarker(t.id);i&&(i["delete"](),1!=t.is_upload&&user_phone==t.user.phone&&BInfowindow.close(i)),e.monitors&&MonitorUtils.removeMonitor(i)}$("#select_marker_"+t.id).remove(),$("#search_marker_"+t.id).remove();var n=$("#marker_layer_"+t.marker_layer_id).find("ul");0==n.children().length&&n.append(MapUtils.add_upload_file(t.marker_layer_id))},MarkerUtils.setMarkerLayerPanel=function(t){var e,i,n=$(t).attr("layer-id"),r=MarkerUtils.layersHashMap.get("m_"+n),a=PermissionUtils.loginUserRole(user_phone,{mapUsers:MarkerUtils.map.cooperation});["\u5730\u56fe\u7ba1\u7406\u5458"].indexOf(a)>=0?1==r.render_style?(e=["\u6807\u9898\u8bbe\u7f6e","\u590d\u5236\u5bc6\u94a5","\u5bc6\u94a5\u5bfc\u5165","\u8bb0\u5f55\u6392\u5e8f","\u4fe1\u606f\u7a97\u8bbe\u7f6e","\u91cd\u547d\u540d\u56fe\u5c42","\u5220\u9664\u56fe\u5c42"],i=["title_settings","data_token","token_import","data_sort","infowindow_setting","edit_layer","del_layer"]):2==r.render_style?(e=["\u590d\u5236\u5bc6\u94a5","\u5bc6\u94a5\u5bfc\u5165","\u91cd\u547d\u540d\u56fe\u5c42","\u5220\u9664\u56fe\u5c42"],i=["data_token","token_import","edit_layer","del_layer"]):(e=["\u6807\u9898\u8bbe\u7f6e","\u590d\u5236\u5bc6\u94a5","\u5bc6\u94a5\u5bfc\u5165","\u8bb0\u5f55\u6392\u5e8f","\u4fe1\u606f\u7a97\u8bbe\u7f6e","\u91cd\u547d\u540d\u56fe\u5c42","\u5220\u9664\u56fe\u5c42"],i=["title_settings","data_token","token_import","data_sort","infowindow_setting","edit_layer","del_layer"]):["\u5730\u56fe\u6210\u5458"].indexOf(a)>=0?1==r.render_style?(e=["\u6807\u9898\u8bbe\u7f6e","\u8bb0\u5f55\u6392\u5e8f","\u4fe1\u606f\u7a97\u8bbe\u7f6e","\u91cd\u547d\u540d\u56fe\u5c42","\u5220\u9664\u56fe\u5c42"],i=["title_settings","data_sort","infowindow_setting","edit_layer","del_layer"]):2==r.render_style?(e=["\u91cd\u547d\u540d\u56fe\u5c42","\u5220\u9664\u56fe\u5c42"],i=["edit_layer","del_layer"]):(e=["\u6807\u9898\u8bbe\u7f6e","\u8bb0\u5f55\u6392\u5e8f","\u4fe1\u606f\u7a97\u8bbe\u7f6e","\u91cd\u547d\u540d\u56fe\u5c42","\u5220\u9664\u56fe\u5c42"],i=["title_settings","data_sort","infowindow_setting","edit_layer","del_layer"]):1==r.render_style?(e=["\u6807\u9898\u8bbe\u7f6e","\u8bb0\u5f55\u6392\u5e8f","\u91cd\u547d\u540d\u56fe\u5c42"],i=["title_settings","data_sort","edit_layer"]):2==r.render_style?(e=["\u91cd\u547d\u540d\u56fe\u5c42"],i=["edit_layer"]):(e=["\u6807\u9898\u8bbe\u7f6e","\u8bb0\u5f55\u6392\u5e8f","\u91cd\u547d\u540d\u56fe\u5c42"],i=["title_settings","data_sort","edit_layer"]);var o={textArray:e,classArray:i,style:"left:268px;top:"+(t.offsetParent.offsetTop-$("#featureListPanelBorder").scrollTop()+56+t.offsetHeight)+"px;z-index:99",isLayer:!0,layerId:n,type:"marker_layer",callback:function(){$(".dt-panel").click(function(t){var e=$(t.target).attr("layer-id");$(t.target).hasClass("del_layer")?(PromptInfo.xcConfirm("\u5220\u9664\u56fe\u5c42\u540e\u6570\u636e\u5c06\u4e0d\u53ef\u6062\u590d\uff0c\u786e\u5b9a\u5c06\u6b64\u56fe\u5c42\u4fe1\u606f\u5220\u9664\uff1f",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){var t={mid:mid,id:e};MapUtils.ajax2server(destroy_marker_layer_url,"DELETE",t,function(){$("#layerSize").text(parseInt($("#layerSize").text())-1),$(".marker_layer").first().find(".marker-layer-hover").removeClass("marker-layer-hover").addClass("active-layer"),current_layer_id=-1})}}),$(".xcConfirm .popBox .txtBox p").css("margin-top",0)):$(t.target).hasClass("edit_layer")?$("#save_layer_title").attr("data-type","marker_layer"):$(t.target).hasClass("title_settings")?MapUtils.setTitle(e,"marker"):$(t.target).hasClass("data_token")?MapUtils.ajax2server(marker_layer_token_url,"POST",{mid:mid,id:e},function(t){$("#data_token_container").val(t.token),$("#dataTokenModal").modal("show")}):$(t.target).hasClass("infowindow_setting")?($("#infowindowSetting").modal("show"),$(document).trigger("dt.infowindow.setting",[t,current_layer_id,"marker"])):$(t.target).hasClass("data_sort")?$("#dataSort").unbind().on("shown.bs.modal",function(){$("#data_sort_fields").empty();var i=MarkerUtils.layersHashMap.get("m_"+e),n=i.getAttrFields();if(null!=n){for(var r=i.uniform_title,a="<span class='dt-line-30h pull-left dt-f14'></span><select id='uniform_marker_title_"+current_layer_id+"' class='dt-select-label pull-left form-control dt-w168'>",o=0;o<n.length;o++)if(null!=n[o]){var s=n[o].id,l=n[o].field;a+=0!=r.length&&r==l?"<option value='"+l+"' selected>"+l+"</option>":"<option value='"+l+"'>"+l+"</option>"}a+="</select>",a+="</div>",$("#data_sort_fields").append(a),$(".radio_btn").change(function(){"default"==this.id?$("#data_sort_fields").hide():$("#data_sort_fields").show()}),$("#data-sort").unbind().bind("click",function(){var e="default";$("#asc")[0].checked?e="asc":$("#desc")[0].checked&&(e="desc");var i=$("#data_sort_fields select").val(),n=$(t.target).attr("layer-id");MapUtils.ajax2server(marker_layer_sort_url,"POST",{mid:mid,id:n,type:e,field_id:s,field:i},function(t){var e=t.layer.markers;$("#marker_layer_"+t.layer.id).find("ul").empty();var i=MarkerUtils.layersHashMap.get("m_"+current_layer_id);i.getMarkers().clearArray();for(var n=0;n<e.length;n++){e[n]=MarkerUtils.refactorMarkerJSON(e[n],t.layer);var r=MarkerUtils.marker_div(e[n],i);$("#marker_layer_"+t.layer.id).find("ul").append(r),e[n]=MarkerUtils.markerJson2Marker(e[n],i),i.getMarkers().add(e[n])}$("#dataSort").modal("hide")})})}}):$(t.target).hasClass("token_import")&&($("#token_value").val(""),$("#token_import_btn").attr("layer-id",e).attr("data-type","marker"),$("#tokenImportModal").modal("show"))})}};$("#layer_panel_"+n).DtPanel("init",o)},MarkerUtils.marker_layer_div=function(t){return"<div class='layer dt-pos-r' id='marker_layer_"+t.id+"' layer-id='"+t.id+"' data-layer-label='' data-marker-title=''layer-type='marker_layer'><div class='dt-pos-a dt-h100 dt-pos-t0 layer-hover mlayer'></div><div style='height:30px;'><span data-toggle='tooltip' data-placement='bottom' data-container='body' class='glyphicon glyphicon-eye-open display_layer pull-left dt-mar6r dt-mar8t mklayer' layer-id="+t.id+" aria-hidden='true' title='\u9690\u85cf/\u663e\u793a\u6807\u9898'></span><div id='layer_title_"+t.id+"' class='dt-w140 pull-left dt-truncate layer_title dt-mar6t' layer-id='"+t.id+"'>"+t.title+"</div><div class='layer_action dt-mar8t'><span class='dt-pointer dt-mar6r pull-right' id='"+t.id+"_panel'><span data-toggle='tooltip' data-placement='bottom' data-container='body' class='glyphicon glyphicon-globe dt-super colora1 marker-layer-style' title='\u6837\u5f0f\u8bbe\u7f6e' layer-id='"+t.id+"'></span><span id='markerDataList_"+t.id+"' data-toggle='tooltip' data-placement='bottom' data-container='body' class='glyphicon glyphicon-th-list dt-super colora1 dt-mar6l data-marker-list' title='\u67e5\u770b\u6570\u636e\u89c6\u56fe'></span><span title='\u66f4\u591a\u8bbe\u7f6e' data-toggle='tooltip' data-placement='bottom' data-container='body' class='glyphicon glyphicon-option-vertical more-icon dt-super colora1 dt-mar6l dt-marker-layer' layer-id='"+t.id+"'></span></span></div></div><ul class='list-unstyled  dt-pad12x dt-pad12y'>"+MapUtils.add_upload_file(t.id)+"</a></ul></div>";
},MarkerUtils.heatmap_div=function(t){var e=t.getHeatmapConfig(),i="";i+="hide"==t.getLayerDisplay()||2!=t.render_style?"<div id='heatmap_layer_contain_"+t.id+"' class='dt-pad12x dt-pad12y dt-truncate dt-none'>":"<div id='heatmap_layer_contain_"+t.id+"' class='dt-pad12x dt-pad12y dt-truncate'>";var n="background: ",r=MapUtils.isIE();switch(e.gradient){case"one":r?n+="-ms-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%);":(n+="-webkit-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%);",n+="-moz-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%);");break;case"two":r?n+="-ms-linear-gradient(left, blue 50%,red 80%,white 95%);":(n+="-webkit-linear-gradient(left, blue 50%,red 80%,white 95%);",n+="-moz-linear-gradient(left, blue 50%,red 80%,white 95%);");break;case"three":r?n+="-ms-linear-gradient(left, rgb(26,150,65) 45%,rgb(166,217,106) 55%,rgb(255,255,191) 65%,rgb(253,174,97) 95%,rgb(215,25,28) 100%);":(n+="-webkit-linear-gradient(left, rgb(26,150,65) 45%,rgb(166,217,106) 55%,rgb(255,255,191) 65%,rgb(253,174,97) 95%,rgb(215,25,28) 100%);",n+="-moz-linear-gradient(left, rgb(26,150,65) 45%,rgb(166,217,106) 55%,rgb(255,255,191) 65%,rgb(253,174,97) 95%,rgb(215,25,28) 100%);");break;case"four":r?n+="-ms-linear-gradient(left, rgb(26,150,65) 10%,rgb(180,245,185) 20%,rgb(224,239,152) 30%,rgb(160,213,103) 40%,rgb(44,104,50) 50%,rgb(29,135,59) 60%,rgb(118,154,49)70%, rgb(204,175,27) 80%, rgb(198,63,2) 90%);":(n+="-webkit-linear-gradient(left, rgb(26,150,65) 10%,rgb(180,245,185) 20%,rgb(224,239,152) 30%,rgb(160,213,103) 40%,rgb(44,104,50) 50%,rgb(29,135,59) 60%,rgb(118,154,49)70%, rgb(204,175,27) 80%, rgb(198,63,2) 90%);",n+="-moz-linear-gradient(left, rgb(26,150,65) 10%,rgb(180,245,185) 20%,rgb(224,239,152) 30%,rgb(160,213,103) 40%,rgb(44,104,50) 50%,rgb(29,135,59) 60%,rgb(118,154,49)70%, rgb(204,175,27) 80%, rgb(198,63,2) 90%);");break;default:r?n+="-ms-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%);":(n+="-webkit-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%);",n+="-moz-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%);")}return i+="<div id='heatmap_style_"+t.id+"' class='dt-mar5 pull-left' style='height: 14px;width: 20px;"+n+"'>",i+="</div></div>"},MarkerUtils.heatmapConfig=function(t,e,i){var n;return"one"==t?(n={radius:e,gradient:{.45:"rgb(0,0,255)",.55:"rgb(0,255,255)",.65:"rgb(0,255,0)",.95:"yellow",1:"rgb(255,0,0)"}},$("#heatmap_style_"+i).css("background","-webkit-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%)"),$("#heatmap_style_"+i).css("background","-moz-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%)"),$("#heatmap_style_"+i).css("background","-ms-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%)")):"two"==t?(n={radius:e,gradient:{".5":"blue",".8":"red",".95":"white"}},$("#heatmap_style_"+i).css("background","-webkit-linear-gradient(left, blue 50%,red 80%,white 95%)"),$("#heatmap_style_"+i).css("background","-moz-linear-gradient(left, blue 50%,red 80%,white 95%)"),$("#heatmap_style_"+i).css("background","-ms-linear-gradient(left, blue 50%,red 80%,white 95%)")):"three"==t?(n={radius:e,gradient:{.45:"rgb(26,150,65)",.55:"rgb(166,217,106)",.65:"rgb(255,255,191)",.95:"rgb(253,174,97)",1:"rgb(215,25,28)"}},$("#heatmap_style_"+i).css("background","-webkit-linear-gradient(left, rgb(26,150,65) 45%,rgb(166,217,106) 55%,rgb(255,255,191) 65%,rgb(253,174,97) 95%,rgb(215,25,28) 100%)"),$("#heatmap_style_"+i).css("background","-moz-linear-gradient(left, rgb(26,150,65) 45%,rgb(166,217,106) 55%,rgb(255,255,191) 65%,rgb(253,174,97) 95%,rgb(215,25,28) 100%)"),$("#heatmap_style_"+i).css("background","-ms-linear-gradient(left, rgb(26,150,65) 45%,rgb(166,217,106) 55%,rgb(255,255,191) 65%,rgb(253,174,97) 95%,rgb(215,25,28) 100%)")):"four"==t?(n={radius:e,gradient:{.1:"rgb(26,150,65)",.2:"rgb(180,245,185)",.3:"rgb(224,239,152)",.4:"rgb(160,213,103)",.5:"rgb(44,104,50)",.6:"rgb(29,135,59)",.7:"rgb(118,154,49)",.8:"rgb(204,175,27)",.95:"rgb(198,63,2)"}},$("#heatmap_style_"+i).css("background","-webkit-linear-gradient(left, rgb(26,150,65) 10%,rgb(180,245,185) 20%,rgb(224,239,152) 30%,rgb(160,213,103) 40%,rgb(44,104,50) 50%,rgb(29,135,59) 60%,rgb(118,154,49)70%, rgb(204,175,27) 80%, rgb(198,63,2) 90%)"),$("#heatmap_style_"+i).css("background","-moz-linear-gradient(left, rgb(26,150,65) 10%,rgb(180,245,185) 20%,rgb(224,239,152) 30%,rgb(160,213,103) 40%,rgb(44,104,50) 50%,rgb(29,135,59) 60%,rgb(118,154,49)70%, rgb(204,175,27) 80%, rgb(198,63,2) 90%)"),$("#heatmap_style_"+i).css("background","-ms-linear-gradient(left, rgb(26,150,65) 10%,rgb(180,245,185) 20%,rgb(224,239,152) 30%,rgb(160,213,103) 40%,rgb(44,104,50) 50%,rgb(29,135,59) 60%,rgb(118,154,49)70%, rgb(204,175,27) 80%, rgb(198,63,2) 90%)")):(n={radius:e,gradient:{.45:"rgb(0,0,255)",.55:"rgb(0,255,255)",.65:"rgb(0,255,0)",.95:"yellow",1:"rgb(255,0,0)"}},$("#heatmap_style_"+i).css("background","-webkit-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%)"),$("#heatmap_style_"+i).css("background","-moz-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%)"),$("#heatmap_style_"+i).css("background","-ms-linear-gradient(left, rgb(0,0,255) 45%,rgb(0,255,255) 55%,rgb(0,255,0) 65%,yellow 95%,rgb(255,0,0) 100%)")),n},MarkerUtils.marker_div=function(t,e){if(null!=e){var i="";if(null!=t.marker_attrs)for(var n=0;n<t.marker_attrs.length;n++)if(null!=t.marker_attrs[n]&&t.marker_attrs[n].key==t.uniform_title){i=t.marker_attrs[n].value||"";break}var r="<li marker-id='"+t.id+"' class='dt-truncate select_marker' id='select_marker_"+t.id+"'>";return r+=MarkerUtils.markerIconHtml(t,e),r+="<span marker-id='"+t.id+"' class='select_marker marker-title' id='setMarkerTitle_"+t.id+"'>"+window.spacePrefix+i+"</span>",t.imgs.length>0&&(r+='<span class="glyphicon glyphicon-picture pull-right dt-line-18h" id="marker_img_'+t.id+'" ></span>'),r+="</li>"}},MarkerUtils.markerIconHtml=function(t,e){if(!t||!e)return"";t.feature_id||(t.feature_id=t.id);var i="";if(1==e.render_style){var n=e.getCanvasConfig(),r="",a="background-color:"+n.color;"BMAP_POINT_SHAPE_STAR"==n.shape?(r="glyphicon glyphicon-star canvas-star",a="color:"+n.color):r="BMAP_POINT_SHAPE_RHOMBUS"==n.shape?"canvas-rhombus":"BMAP_POINT_SHAPE_SQUARE"==n.shape?"canvas-square":("BMAP_POINT_SHAPE_CIRCLE"==n.shape,"canvas-circle"),i+="<div id='marker_icon_"+t.feature_id+"' class='dt-mar5 pull-left "+r+"' style='"+a+"'></div>"}else i+="<img id='marker_icon_"+t.feature_id+"' class='select_marker' marker-id='"+t.feature_id+"' src='"+oss_host+t.icon.url+"'>";return i},MarkerUtils.initMarkerLayerToPanel=function(t,e){var i="";null!=t.show_fields&&(i=t.show_fields);var n='<div class="layer dt-pos-r" id="marker_layer_'+t.id+'" data-layer-label="'+t.label;if(n+='" layer-id="'+t.id+'" data-marker-title="'+t.uniform_title,n+='" data-show-fields="'+i+'" layer-type="marker_layer">',n+='<div class="mlayer dt-pos-a dt-h100 dt-pos-t0 '+t.active+'"></div>',n+='<div class="dt-h30">',n+='<span class="glyphicon display_layer pull-left dt-mar6r dt-mar8t mklayer '+t.eye_icon+'" layer-id="'+t.id+'" aria-hidden="true" data-container="body" data-placement="bottom" data-toggle="tooltip" title="\u9690\u85cf/\u663e\u793a\u56fe\u5c42"></span>',n+='<div title="'+t.title+'" id="layer_title_'+t.id+'" class="dt-w140 dt-truncate pull-left layer_title dt-mar6t" layer-id="'+t.id+'">'+t.title+"</div>",n+="hide"==t.display?'<div class="layer_action dt-mar8t dt-none">':'<div class="layer_action dt-mar8t">',t.cooperation)var r=PermissionUtils.loginUserRole(user_phone,{mapUsers:e.cooperation,layerUsers:t.cooperation});else var r=PermissionUtils.loginUserRole(user_phone,{mapUsers:e.cooperation});["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458","\u56fe\u5c42\u6210\u5458"].indexOf(r)>=0?(n+='<span class="dt-pointer dt-mar6r pull-right" id="'+t.id+'_panel">',n+='<span data-toggle="tooltip" data-placement="bottom" data-container="body" class="glyphicon glyphicon-globe dt-super colora1 marker-layer-style"  title="\u6837\u5f0f\u8bbe\u7f6e"" layer-id="'+t.id+'"></span>',n+='<span data-toggle="tooltip" data-placement="bottom" data-container="body" id="markerDataList_'+t.id+'" class="glyphicon glyphicon-th-list dt-super colora1 dt-mar6l data-marker-list" title="\u67e5\u770b\u6570\u636e\u89c6\u56fe"></span>',n+='<span data-toggle="tooltip" data-placement="bottom" data-container="body" class="glyphicon glyphicon-option-vertical more-icon dt-super colora1 dt-mar6l dt-marker-layer" id="layer_panel_'+t.id+'" layer-id="'+t.id+'" title="\u66f4\u591a\u8bbe\u7f6e"></span>',n+="</span>"):(n+='<span class="dt-pointer dt-mar6r pull-right" id="'+t.id+'_panel">',n+='<span data-toggle="tooltip" data-placement="bottom" data-container="body" id="markerDataList_'+t.id+'" class="glyphicon glyphicon-th-list dt-super colora1 dt-mar6l data-marker-list" title="\u67e5\u770b\u6570\u636e\u89c6\u56fe"></span>',n+="</span>"),n+="</div>",n+="</div>";var a=MarkerUtils.layersHashMap.get("m_"+t.id);if(n+=MarkerUtils.heatmap_div(a),n+="hide"==t.display||6==t.render_style&&t.category_config.is_categorized||2==t.render_style?'<ul class="list-unstyled dt-pad12x dt-pad12y" style="display:none">':'<ul class="list-unstyled dt-pad12x dt-pad12y">',0==t.markers.length)n+=MapUtils.add_upload_file(t.id);else for(var o=0;o<t.markers.length;o++){var s=t.markers[o];"-9999"==s.lng&&"-9999"==s.lat||(n+=s.display?'<li marker-id="'+s.id+'" class="select_marker dt-truncate" id="select_marker_'+s.id+'">':'<li marker-id="'+s.id+'" class="select_marker dt-truncate" id="select_marker_'+s.id+'" style="display: none;">',n+=MarkerUtils.markerIconHtml(s,a),n+='<span marker-id="'+s.id+'" class="select_marker marker-title" layer-id="'+t.id+'" id="setMarkerTitle_'+s.id+'">'+s.title+"</span>",s.imgs.length>0&&(n+='<span class="glyphicon glyphicon-picture pull-right dt-line-18h" id="marker_img_'+s.id+'" ></span>'),n+="</li>")}if(n+="</ul>",a.isCategorized())if($("#marker_layer_"+t.id).find("ul").first().hide(),n+="hide"==t.display?'<ul id="marker_category_details_'+t.id+'" class="dt-pad12x dt-pad12y dt-none">':'<ul id="marker_category_details_'+t.id+'" class="dt-pad12x dt-pad12y">',0==t.categories.length)n+=MapUtils.add_upload_file(t.id);else{for(var o=0;o<t.categories.length;o++){var l=t.categories[o];n+=CategoryUtils.getCategoryHtmlToMarkerLayer(l,t.id)}n+="</ul>"}n+="</div>",$("#layerContainer").append(n),$("#marker_category_details_"+t.id+" li").unbind().mouseenter(function(t){$(t.currentTarget).find(".edit_category").show()}).mouseleave(function(t){$(t.currentTarget).find(".edit_category").hide()}),CategoryUtils.handleEvent("click","#marker_category_details_"+t.id)},MarkerUtils.viewerMarkerLayerToPanel=function(t,e){var i="";null!=t.show_fields&&(i=t.show_fields);var n="";n+=t.is_del?'<div class="marker_layer dt-bg-pink dt-pos-r" id="marker_layer_'+t.id+'" data-layer-label="'+t.label+'" layer-id="'+t.id+'" data-marker-title="'+t.uniform_title+'" data-show-fields="'+i+'">':'<div class="marker_layer dt-pos-r" id="marker_layer_'+t.id+'" data-layer-label="'+t.label+'" layer-id="'+t.id+'" data-marker-title="'+t.uniform_title+'" data-show-fields="'+i+'">',n+='<div class="dt-h30">',n+='<span data-toggle="tooltip" data-placement="bottom" data-container="body" class="glyphicon '+t.eye_icon+' display_layer mklayer pull-left dt-mar6r dt-mar8t" layer-id="'+t.id+'" aria-hidden="true" title="\u9690\u85cf/\u663e\u793a\u56fe\u5c42"></span>',n+='<div layer-id="'+t.id+'" title="'+t.title+'" class="dt-truncate dt-w200 pull-left dt-pointer layer_title dt-mar6t">'+t.title+"</div>",n+='<span class="pull-right dt-line-30h dt-f12">('+t.markers.length+")</span>",n+="</div>";var r=MarkerUtils.layersHashMap.get("m_"+t.id);if(2==t.render_style)n+=MarkerUtils.heatmap_div(r);else{n+="hide"==t.display||r.isCategorized()||2==t.render_style?'<ul class="list-unstyled dt-pad12x dt-pad12y" style="display:none">':'<ul class="list-unstyled dt-pad12x dt-pad12y" style="display:block">';for(var a=0;a<t.markers.length;a++){var o=t.markers[a];(e||o.display)&&(n+="-9999"!=o.lng||"-9999"!=o.lat?'<li marker-id="'+o.id+'" layer-id="'+t.id+'" class="select_marker dt-truncate" id="select_marker_'+o.id+'">':'<li marker-id="'+o.id+'" layer-id="'+t.id+'" class="select_marker dt-truncate" id="select_marker_'+o.id+'" style="display: none;">',n+=MarkerUtils.markerIconHtml(o,r),n+='<span marker-id="'+o.id+'" class="select_marker marker-title dt-f12" id="setMarkerTitle_'+o.id+'">'+o.title+"</span>",o.imgs.length>0&&(n+='<span class="glyphicon glyphicon-picture pull-right dt-line-18h" id="marker_img_'+o.id+'" ></span>'),n+="</li>")}if(n+="</ul>",6==t.render_style&&t.category_config.is_categorized){n+="hide"==t.display||1==t.render_style||2==t.render_style?'<ul id="marker_category_details_'+t.id+'" class="dt-pad12x dt-pad12y dt-none">':'<ul id="marker_category_details_'+t.id+'" class="dt-pad12x dt-pad12y">';for(var a=0;a<t.categories.length;a++){var s=t.categories[a];n+=CategoryUtils.getCategoryHtmlToMarkerLayerViewer(s,t.id)}n+="</ul>"}}n+="</div>",(1==t.render_style||2==t.render_style||r.isCategorized())&&$("#marker_layer_"+t.id).find("ul").first().show(),$("#layerContainer").append(n),CategoryUtils.handleEvent("click","#marker_category_details_"+t.id)},MarkerUtils.markers2RichMarkers=function(t,e){var i=t,n=MarkerUtils.layersHashMap.get("m_"+e),r=n.getMarkers();t=new Array;for(var a=0;a<i.length;a++){i[a].remove();var o=MarkerUtils.markerJson2Marker(i[a].obj,n);r.put(o.feature_id,o),t.push(o),MarkerUtils.map.removeOverlay(i[a])}return t},MarkerUtils.richMarkers2markers=function(t,e){var i=t,n=MarkerUtils.layersHashMap.get("m_"+e),r=n.getMarkers();t=new Array;for(var a=0;a<i.length;a++){var o=MarkerUtils.markerJson2Marker(i[a].obj,n);r.put(o.feature_id,o),t.push(o),MarkerUtils.map.removeOverlay(i[a])}return t},MarkerUtils.addMarkersToMap=function(t){var e=window.setInterval(function(){if(MarkerUtils.markerTimer=!1,t){var i=t.shift();if(i){var n=MarkerUtils.layersHashMap.get("m_"+i.layer_id);i.addTo(MarkerUtils.map),i.display&&"hide"!=n.display||i.hide()}}0==t.length&&(window.clearInterval(e),e=null,MarkerUtils.markerTimer=!0)},1)},MarkerUtils.createTextHtml=function(t,e,i){var n="";return t.show_decoration?(n+="<p class='leaflet-text'>",n+="<span class='num' style='background-color:"+t.background_color+";border:1px solid "+t.border_color+";color:"+t.color+";font-size:"+t.size+"px;font-family: "+i+"'>"+e+"</span>",n+='<i class="arrow-up" style="border-top-color:'+t.border_color+'"><i class="arrow" style="border-top-color: '+t.background_color+'"></i><i></i></i>',n+="</p>"):n+="<div style='white-space: pre;font-size:"+t.size+"px;color:"+t.color+";font-family: "+i+"' >"+e+"</div>",n},MarkerUtils.editStatus=function(t,e){e&&(e instanceof Dtwy.Marker||e instanceof Dtwy.CanvasMarker)&&e.toggleEditing()},MarkerUtils.saveMarker=function(t,e,i,n){var r,a=e.getLabelConfig();if(null!=t.label&&0!=a.field.length)for(var o=0;o<t.attrs.length;o++)if(r=t.attrs[o],r&&a.field==r.key){null!=t.getLabel()&&t.getLabel().setContent(i[r.id]);break}for(var s=!1,l=t.cloneAttrs(),d=0;d<t.attrs.length;d++)if(r=t.attrs[d],null!=r&&"undefined"!=typeof i[r.id]&&null!=i[r.id]&&r.value!=i[r.id].trim()){r.value=i[r.id],s=!0;break}s?MapUtils.ajax2server(update_marker_attrs_url,"PUT",{attrs:i,id:t.feature_id,mid:mid},function(){n&&n(t,s)},function(e){400==e.status&&($(".BMapLib_bubble_title").text(t.title),t.attrs=l,n(t,s))}):n&&n(t,s)},MarkerUtils.delMarker=function(t){MapUtils.reloadTooltip();var e="\u5220\u9664\u6807\u6ce8\u540e\u5c06\u4e0d\u53ef\u6062\u590d\uff0c\u786e\u5b9a\u5c06\u6b64\u6807\u6ce8\u4fe1\u606f\u5220\u9664\uff1f";PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){var e={mid:mid,id:t.feature_id};MapUtils.ajax2server(destroy_marker_url,"DELETE",e,function(){})}}),$(".xcConfirm .popBox .txtBox p").css("margin-top","0")},MarkerUtils.setMarkerStyle=function(t){$('[data-toggle="tooltip"]').tooltip("destroy").tooltip(),$("#setMarkerStyle").modal("show"),$("#setMarkerStyle").find(".modal-footer").find("button").last().attr("id","set_single_icon"),$("#set_single_icon").unbind().click(function(){if($(".icon_preview").attr("src").indexOf("custom")!=-1)var e={id:t.feature_id,icon_id:$(".icon_preview").attr("data-id"),mid:mid};else var i=$(".icon_preview").attr("color"),n=$(".icon_preview").attr("size"),r=$(".icon_preview").attr("symbol"),a=$(".icon_preview").attr("bubble"),e={id:t.feature_id,color:i,size:n,symbol:r,bubble:a,mid:mid};MapUtils.ajax2server(change_marker_icon_url,"PUT",e)}),current_marker_id=t.feature_id},MarkerUtils.refreshVector=function(t,e){if(t.vectors&&e)for(var i=0,n=t.vectors.length;i<n;i++){var r=t.vectors[i];if(r&&r.feature_id==e.feature_id){r.setLatLng(e.getPosition());break}}}});var LineUtils=window.LineUtils=LineUtils||{};$(function(){LineUtils.overlays=[],LineUtils.lineTimer=!1,LineUtils.checkRole=function(t){var e={};e.mapUsers=LineUtils.map.cooperation,t&&t.cooperation&&(e.layerUsers=t.cooperation);var i=PermissionUtils.loginUserRole(user_phone,e);return["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458","\u56fe\u5c42\u6210\u5458","\u8bb0\u5f55\u6210\u5458"].indexOf(i)!=-1},LineUtils.checkUpdateRole=function(t,e,i){var n={mapUsers:LineUtils.map.cooperation};t&&t.cooperation&&(n.layerUsers=t.cooperation);var r=PermissionUtils.loginUserRole(user_phone,n);if(["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458","\u56fe\u5c42\u6210\u5458"].indexOf(r)==-1){if("layer"==e)return!1;if("overlay"==e){if(!(t&&i&&i.overlay_id))return!1;var a=t.getLines().get(i.overlay_id);if(!a||!a.cooperation)return!1;var o=a.cooperation;if(!o[0].phone==user_phone)return!1}}else if("\u56fe\u5c42\u6210\u5458"==r){for(var s=!1,l=LineUtils.getLineLayers(),d=0;d<l.length;d++)l[d].id==t.id&&(s=!0);if(!s)return!1}return!0},LineUtils.getLineLayers=function(){for(var t=LineUtils.layersHashMap.values(),e=[],i=0;i<t.length;i++){var n=t[i];"line_layer"==n.type&&e.push(n)}return e},LineUtils.addLine2Map=function(t,e,i){var n=new Dtwy.Polyline(t.path,{data:t});n.line_route&&MarkerUtils.addDirectionMarkerToMap(n,LineUtils.map);var r=LineUtils.layersHashMap.get("l_"+t.line_layer_id),a=r.getLines();return a.put(n.feature_id,n),"hide"!=e&&(i?LineUtils.overlays.push(n):LineUtils.map.addLayer(n),"hide"!=e&&n.display||n.hide(),!t.is_upload&&t.is_add&&user_phone==t.user.phone&&BInfowindow.open(n,{status:"edit"}),n.on("click",LineUtils.clickLine),MapUtils.addLabelToOverlay(n,!0)),n},LineUtils.clickLine=function(t){if("addMarker"!=LineUtils.map.action){var e=this;$(document).trigger("dt.select.line",[e,{infoPoint:t.latlng}]),L.DomEvent.stopPropagation(t)}},LineUtils.updateHashMapDataLine=function(t){var e=t.line_layer_id,i=t.id,n=LineUtils.layersHashMap.get("l_"+e),r=n.getLines(),a=r.get(i);a&&(a.attrs=t.line_attrs,a.display=t.display,a.imgs=t.imgs,a.title=t.title,a.uniform_title=t.uniform_title,a.label_field=t.label_field,a.label_style_type=t.label_style_type);for(var o=[],s=0;s<t.line_attrs.length;s++)t.line_attrs[s].key&&o.push(t.line_attrs[s].key);BInfowindow.refresh(a),n.setAttrs(o)},LineUtils.updateLineInMap=function(t){var e=LineUtils.layersHashMap.get("l_"+t.line_layer_id),i=e.getLines().get(t.id);if("undefined"!=typeof i&&null!=i){if(i.updateFromObj(t),i.line_route&&($("#li_line_id_"+t.id).find(".glyphicon-road").css("color",t.line_style.strokeColor),$(".way-points").each(function(){$(this).attr("line-id")==t.id&&$(this).css("background-color",t.line_style.strokeColor)}),MarkerUtils.addDirectionMarkerToMap(i,LineUtils.map),MapUtils.update_line_div(i)),i.display?($("#li_line_id_"+i.feature_id).show(),i.wayPoints&&"show"==e.display&&i.wayPoints.addTo(LineUtils.map)):($("#li_line_id_"+i.feature_id).hide(),i.wayPoints&&i.wayPoints.remove()),"show"==e.display&&MapUtils.addLabelToOverlay(i,!1),i.display&&"show"==e.display?i.show():i.hide(),e.monitors&&has_message_audio){for(var n=0;n<e.monitors.length;n++){var r=e.monitors[n];if("false"==r.conditions.update)return;var a=MonitorUtils.validateMonitor(r,i.attrs,r.conditions.operate,!1);if(a)MonitorUtils.overlayMonitor(a,i,!1);else if(r.overlays){var o,s=i.feature_id;o=r.overlays.get(s),o&&(MonitorUtils._map.removeOverlay(o),r.overlays.remove(i.feature_id),$("[data-id='"+s+"']").remove())}}$("#popIntro").children().length>0&&($("#pop").slideDown(400),$("#popClose").unbind().click(function(){$("#pop").slideUp(400),$("#popIntro").children().empty()}))}BInfowindow.refresh(i)}},LineUtils.setLineLayerPanel=function(t){var e,i,n=PermissionUtils.loginUserRole(user_phone,{mapUsers:LineUtils.map.cooperation});["\u5730\u56fe\u7ba1\u7406\u5458"].indexOf(n)>=0?(e=["\u6807\u9898\u8bbe\u7f6e","\u590d\u5236\u5bc6\u94a5","\u5bc6\u94a5\u5bfc\u5165","\u4fe1\u606f\u7a97\u8bbe\u7f6e","\u91cd\u547d\u540d\u56fe\u5c42","\u5220\u9664\u56fe\u5c42"],i=["title_settings","data_token","token_import","infowindow_setting","edit_layer","del_layer"]):["\u5730\u56fe\u6210\u5458"].indexOf(n)>=0?(e=["\u6807\u9898\u8bbe\u7f6e","\u4fe1\u606f\u7a97\u8bbe\u7f6e","\u91cd\u547d\u540d\u56fe\u5c42","\u5220\u9664\u56fe\u5c42"],i=["title_settings","infowindow_setting","edit_layer","del_layer"]):(e=["\u6807\u9898\u8bbe\u7f6e","\u4fe1\u606f\u7a97\u8bbe\u7f6e","\u91cd\u547d\u540d\u56fe\u5c42"],i=["title_settings","infowindow_setting","edit_layer"]);var r={textArray:e,classArray:i,style:"left:268px;top:"+(t.offsetParent.offsetTop-$("#featureListPanelBorder").scrollTop()+56+t.offsetHeight)+"px;z-index:99",isLayer:!0,layerId:$(t).attr("layer-id"),type:"line_layer",callback:function(){$(".dt-panel").click(function(t){var e=$(t.target).attr("layer-id");if($(t.target).hasClass("del_layer")){var i="\u5220\u9664\u56fe\u5c42\u540e\u6570\u636e\u5c06\u4e0d\u53ef\u6062\u590d\uff0c\u786e\u5b9a\u5c06\u6b64\u56fe\u5c42\u4fe1\u606f\u5220\u9664\uff1f";PromptInfo.xcConfirm(i,PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){var t={mid:mid,id:e};MapUtils.ajax2server(destroy_line_layer_url,"DELETE",t,function(){$("#layerSize").text(parseInt($("#layerSize").text())-1),current_layer_id=-1})}}),$(".xcConfirm .popBox .txtBox p").css("margin-top",0)}else $(t.target).hasClass("edit_layer")?$("#save_layer_title").attr("data-type","line_layer"):$(t.target).hasClass("infowindow_setting")?($("#infowindowSetting").modal("show"),$(document).trigger("dt.infowindow.setting",[t,current_layer_id,"line"])):$(t.target).hasClass("data_token")?MapUtils.ajax2server(line_layer_token_url,"POST",{mid:mid,id:e},function(t){$("#data_token_container").val(t.token),$("#dataTokenModal").modal("show")}):$(t.target).hasClass("title_settings")?MapUtils.setTitle(e,"line"):$(t.target).hasClass("token_import")&&($("#token_import_btn").attr("layer-id",e).attr("data-type","line"),$("#tokenImportModal").modal("show"),$("#token_value").val(""))})}};$("#layer_panel_"+current_layer_id).DtPanel("init",r)},LineUtils.addLinesToMap=function(t){var e=window.setInterval(function(){LineUtils.lineTimer=!1;var i=t.shift();if(i){var n=LineUtils.layersHashMap.get("l_"+i.layer_id);LineUtils.map.addOverlay(i),i.display&&"hide"!=n.display||i.hide()}0==t.length&&(window.clearInterval(e),e=null,LineUtils.lineTimer=!0)},1)},LineUtils.delLine=function(t){MapUtils.reloadTooltip();var e="\u5220\u9664\u7ebf\u8def\u540e\u5c06\u4e0d\u53ef\u6062\u590d\uff0c\u786e\u5b9a\u5c06\u6b64\u7ebf\u8def\u4fe1\u606f\u5220\u9664\uff1f";PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){MapUtils.ajax2server(destroy_line_url,"DELETE",{id:t.feature_id,mid:mid})}}),$(".xcConfirm .popBox .txtBox p").css("margin-top","0")},LineUtils.saveLine=function(t,e,i,n){var r=e.getLabelConfig(),a=t.getLabel();if(a&&null!=t.label&&0!=r.field.length)for(var o=0;o<t.attrs.length;o++){var s=t.attrs[o];if(s&&r.field==s.key){a.setContent(i[s.id]);break}}for(var l=!1,d=t.cloneAttrs(),h=0;h<t.attrs.length;h++){var s=t.attrs[h];if(null!=s&&"undefined"!=typeof i[s.id]&&null!=i[s.id]&&s.value!=i[s.id].trim()){s.value=i[s.id],l=!0;break}}l?MapUtils.ajax2server(update_line_attrs_url,"PUT",{attrs:i,id:t.feature_id,mid:mid},function(){n&&n(t,l)},function(e){400==e.status&&($(".BMapLib_bubble_title").text(t.title),t.attrs=d,n(t,l))}):n&&n(t,l)},LineUtils.editNodeLine=function(t){return t.line_route?void PromptInfo.xcConfirm("\u8def\u7ebf\u4e0d\u652f\u6301\u7f16\u8f91\u8282\u70b9",PromptInfo.xcConfirm.typeEnum.info):(t.toggleEditing(),void BInfowindow.close())},LineUtils.editLineStyle=function(t){$('[data-toggle="tooltip"]').tooltip("destroy").tooltip(),$("#editLineStyle").attr("line-id",t.feature_id).attr("line-layer-id",t.layer_id).modal("show"),$("#set_line_style").attr("data-line-id",t.feature_id).data("data-line",t)},LineUtils.selectLine=function(t){var e=$(t).attr("line-id"),i=$(t).attr("layer-id"),n=LineUtils.layersHashMap.get(i),r=n.getLines().get(e);r&&r.line_route&&($(t).closest("li").find(".direction-info").hasClass("direction-animate")?$(t).closest("li").find(".direction-info").removeClass("direction-animate"):($(t).closest("li").find(".direction-info").addClass("direction-animate"),$(t).closest("li").find(".direction-info").find("ul").show())),r&&$(document).trigger("dt.select.line",r)}});var RegionUtils=window.RegionUtils=RegionUtils||{};$(function(){RegionUtils.overlays=[],RegionUtils.regionTimer=!1,RegionUtils.loadProvince=function(t){var e=[{provinces:t,currentSelect:"\u7701"}],i=$("#districtTemplate").render(e);$(".district-panel").append(i),$("#provinceList").unbind().dblclick(function(t){RegionUtils.addDistrict($(t.target),"#provinceList")}),$(".add-district").unbind().click(function(){var t=$("#provinceList option:selected");RegionUtils.addDistrict(t,"#provinceList")}),$(".remove-district").unbind().click(function(){var t=$("#selectedDistrict option:selected");RegionUtils.removeDistrict(t,"#provinceList")})},RegionUtils.loadCity=function(t){var e=[{provinces:t,currentSelect:"\u5e02"}],i=$("#districtTemplate").render(e);$(".district-panel").append(i),$("#provinceList").unbind().click(function(t){RegionUtils.getCityToServer(t.target,"\u5e02")}),$("#cityList").unbind().dblclick(function(t){RegionUtils.addDistrict($(t.target),"#cityList")}),$(".add-district").unbind().click(function(){var t=$("#cityList option:selected");RegionUtils.addDistrict(t,"#cityList")}),$(".remove-district").unbind().click(function(){var t=$("#selectedDistrict option:selected");RegionUtils.removeDistrict(t,"#cityList")})},RegionUtils.loadCounty=function(t){var e=[{provinces:t,currentSelect:"\u533a"}],i=$("#districtTemplate").render(e);$(".district-panel").append(i),$("#provinceList").unbind().click(function(t){var e=$(t.target).val();11e4==e||12e4==e||31e4==e||5e5==e?($("#cityList").empty(),RegionUtils.getCountyToServer(t.target)):RegionUtils.getCityToServer(t.target,"\u533a")}),$("#cityList").unbind().click(function(t){RegionUtils.getCountyToServer(t.target)}),$("#countyList").unbind().dblclick(function(t){RegionUtils.addDistrict($(t.target),"#countyList")}),$(".add-district").unbind().click(function(){var t=$("#countyList option:selected");RegionUtils.addDistrict(t,"#countyList")}),$(".remove-district").unbind().click(function(){var t=$("#selectedDistrict option:selected");RegionUtils.removeDistrict(t,"#countyList")})},RegionUtils.loadSearchDistrict=function(t){var e=[{searchResults:t,currentSelect:"\u641c\u7d22"}],i=$("#districtTemplate").render(e);$(".district-panel").append(i),$(".add-district").unbind().click(function(){var t=$("#resultList option:selected");RegionUtils.addDistrict(t,"#resultList")}),$("#resultList").unbind().dblclick(function(t){RegionUtils.addDistrict($(t.target),"#resultList")}),$(".remove-district").unbind().click(function(){var t=$("#selectedDistrict option:selected");RegionUtils.removeDistrict(t,"#resultList","search")})},RegionUtils.addDistrict=function(t,e){var i=t;return i&&0==i.length?void PromptInfo.xcConfirm("\u8bf7\u5148\u9009\u62e9\u884c\u653f\u533a\u5212\u5728\u8fdb\u884c\u6dfb\u52a0\uff01",PromptInfo.xcConfirm.typeEnum.info):void(1==i.length&&"all"==i.val()?$("#selectedDistrict").append($(e+" option[value!='all']")):$("#selectedDistrict").append($(e).find(":selected")))},RegionUtils.removeDistrict=function(t,e,i){var n=t;return n&&0==n.length?void PromptInfo.xcConfirm("\u8bf7\u5148\u9009\u62e9\u884c\u653f\u533a\u5212\u5728\u8fdb\u884c\u79fb\u9664\uff01",PromptInfo.xcConfirm.typeEnum.info):void("search"==i?$(e).append(n):$(e+" option[value='all']").after(n))},RegionUtils.getCityToServer=function(t,e){$("#cityList").empty(),$("#countyList").empty();var i=$(t).val();MapUtils.ajax2server(districts_url,"GET",{parent_code:i},function(t){if(t&&t.length>0){"\u5e02"==e&&$("#cityList").append('<option value="all" parent-code="'+t[0].parent_code+'">\u5168\u90e8\u5e02/\u533a</option>');for(var i=$("#selectedDistrict option").map(function(){return $(this).val()}).get().join(","),n=0;n<t.length;n++){var r=t[n];if(i.indexOf(r.code)==-1){var a="<option value='"+r.code+"' parent-code='"+r.parent_code+"'>"+r.name+"</option>";$("#cityList").append(a)}}}})},RegionUtils.getCountyToServer=function(t){$("#countyList").empty();var e=$(t).val();MapUtils.ajax2server(districts_url,"GET",{parent_code:e},function(t){if(!(t&&t.length>0))return void PromptInfo.xcConfirm("\u6682\u65e0\u6570\u636e\uff01",PromptInfo.xcConfirm.typeEnum.info);$("#countyList").append('<option value="all" parent-code="'+t[0].parent_code+'">\u5168\u90e8\u533a/\u53bf</option>');for(var e=$("#selectedDistrict option").map(function(){return $(this).val()}).get().join(","),i=0;i<t.length;i++){var n=t[i];if(e.indexOf(n.code)==-1){var r="<option value='"+n.code+"' parent-code='"+n.parent_code+"'>"+n.name+"</option>";$("#countyList").append(r)}}})},RegionUtils.checkRole=function(t){var e={};e.mapUsers=RegionUtils.map.cooperation,t&&t.cooperation&&(e.layerUsers=t.cooperation);var i=PermissionUtils.loginUserRole(user_phone,e);return["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458","\u56fe\u5c42\u6210\u5458","\u8bb0\u5f55\u6210\u5458"].indexOf(i)!=-1},RegionUtils.checkUpdateRole=function(t,e,i){var n={mapUsers:RegionUtils.map.cooperation};t&&t.cooperation&&(n.layerUsers=t.cooperation);var r=PermissionUtils.loginUserRole(user_phone,n);if(["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458","\u56fe\u5c42\u6210\u5458"].indexOf(r)==-1){if("layer"==e)return!1;if("overlay"==e){if(!(t&&i&&i.overlay_id))return!1;var a=t.getRegions().get(i.overlay_id);if(!a||!a.cooperation)return!1;var o=a.cooperation;if(!o[0].phone==user_phone)return!1}}else if("\u56fe\u5c42\u6210\u5458"==r){for(var s=!1,l=RegionUtils.getRegionLayers(),d=0;d<l.length;d++)l[d].id==t.id&&(s=!0);if(!s)return!1}return!0},RegionUtils.getRegionLayers=function(){for(var t=RegionUtils.layersHashMap.values(),e=[],i=0;i<t.length;i++){var n=t[i];"region_layer"==n.type&&e.push(n)}return e},RegionUtils.addRegion2Map=function(t,e,i){if(null!=t&&null!=t.encoded_path){var n=RegionUtils.generateRegion(t),r=RegionUtils.layersHashMap.get("r_"+t.region_layer_id),a=r.getRegions();return a.put(n.feature_id,n),"hide"!=e&&(i?RegionUtils.overlays.push(n):RegionUtils.map.addLayer(n),"hide"!=e&&n.display||n.hide(),!t.is_upload&&t.is_add&&user_phone==t.user.phone&&BInfowindow.open(n,{status:"edit"}),n.on("click",RegionUtils.clickRegion),MapUtils.addLabelToOverlay(n,!0)),n}},RegionUtils.clickRegion=function(t){if("addMarker"!=RegionUtils.map.action){var e=this;$(document).trigger("dt.select.region",[e,{infoPoint:t.latlng}]),L.DomEvent.stopPropagation(t)}},RegionUtils.updateHashMapDataRegion=function(t){var e=t.region_layer_id,i=t.id,n=RegionUtils.layersHashMap.get("r_"+e),r=n.getRegions(),a=r.get(i);a&&(a.attrs=t.region_attrs,a.display=t.display,a.imgs=t.imgs,a.title=t.title,a.uniform_title=t.uniform_title,a.label_field=t.label_field,a.label_style_type=t.label_style_type);for(var o=[],s=0;s<t.region_attrs.length;s++)t.region_attrs[s].key&&o.push(t.region_attrs[s].key);BInfowindow.refresh(a),n.setAttrs(o)},RegionUtils.updateRegionInMap=function(t){var e=RegionUtils.layersHashMap.get("r_"+t.region_layer_id),i=e.getRegion(t.id);if("undefined"!=typeof i&&null!=i){if(i.updateFromObj(t),i.display?$("#li_region_id_"+i.feature_id).show():$("#li_region_id_"+i.feature_id).hide(),MapUtils.addLabelToOverlay(i,!1),i.display&&"show"==e.display?i.show():i.hide(),e.monitors&&has_message_audio){for(var n=0;n<e.monitors.length;n++){var r=e.monitors[n];
if("false"==r.conditions.update)return;var a=MonitorUtils.validateMonitor(r,i.attrs,r.conditions.operate,!1);if(a)MonitorUtils.overlayMonitor(a,i,!1);else if(r.overlays){var o,s=i.feature_id;o=r.overlays.get(s),o&&(MonitorUtils._map.removeOverlay(o),r.overlays.remove(i.feature_id),$("[data-id='"+s+"']").remove())}}$("#popIntro").children().length>0&&($("#pop").slideDown(400),$("#popClose").unbind().click(function(){$("#pop").slideUp(400),$("#popIntro").children().empty()}))}BInfowindow.refresh(i)}},RegionUtils.setRegionLayerPanel=function(t){var e,i,n=PermissionUtils.loginUserRole(user_phone,{mapUsers:RegionUtils.map.cooperation});["\u5730\u56fe\u7ba1\u7406\u5458"].indexOf(n)>=0?(e=["\u884c\u653f\u533a\u5212\u8f7d\u5165","\u6807\u9898\u8bbe\u7f6e","\u590d\u5236\u5bc6\u94a5","\u5bc6\u94a5\u5bfc\u5165","\u4fe1\u606f\u7a97\u8bbe\u7f6e","\u91cd\u547d\u540d\u56fe\u5c42","\u5220\u9664\u56fe\u5c42"],i=["load_district","title_settings","data_token","token_import","infowindow_setting","edit_layer","del_layer"]):["\u5730\u56fe\u6210\u5458"].indexOf(n)>=0?(e=["\u884c\u653f\u533a\u5212\u8f7d\u5165","\u6807\u9898\u8bbe\u7f6e","\u4fe1\u606f\u7a97\u8bbe\u7f6e","\u91cd\u547d\u540d\u56fe\u5c42","\u5220\u9664\u56fe\u5c42"],i=["load_district","title_settings","infowindow_setting","edit_layer","del_layer"]):(e=["\u6807\u9898\u8bbe\u7f6e","\u4fe1\u606f\u7a97\u8bbe\u7f6e","\u91cd\u547d\u540d\u56fe\u5c42"],i=["title_settings","infowindow_setting","edit_layer"]);var r={textArray:e,classArray:i,style:"left:268px;top:"+(t.offsetParent.offsetTop-$("#featureListPanelBorder").scrollTop()+56+t.offsetHeight)+"px;z-index:99",isLayer:!0,isOpen:!0,layerId:$(t).attr("layer-id"),type:"region_layer",callback:function(){$(".dt-panel").click(function(t){var e=$(t.target).attr("layer-id");if($(t.target).hasClass("edit_layer"))$("#save_layer_title").attr("data-type","region_layer");else if($(t.target).hasClass("del_layer")){var i="\u5220\u9664\u56fe\u5c42\u540e\u6570\u636e\u5c06\u4e0d\u53ef\u6062\u590d\uff0c\u786e\u5b9a\u5c06\u6b64\u56fe\u5c42\u4fe1\u606f\u5220\u9664\uff1f";PromptInfo.xcConfirm(i,PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){var t={mid:mid,id:e};MapUtils.ajax2server(destroy_region_layer_url,"DELETE",t,function(){$("#layerSize").text(parseInt($("#layerSize").text())-1),current_layer_id=-1})}}),$(".xcConfirm .popBox .txtBox p").css("margin-top",0)}else if($(t.target).hasClass("data_token"))MapUtils.ajax2server(region_layer_token_url,"POST",{mid:mid,id:e},function(t){$("#data_token_container").val(t.token),$("#dataTokenModal").modal("show")});else if($(t.target).hasClass("infowindow_setting"))$("#infowindowSetting").modal("show"),$(document).trigger("dt.infowindow.setting",[t,current_layer_id,"region"]);else if($(t.target).hasClass("title_settings"))MapUtils.setTitle(e,"region");else if($(t.target).hasClass("token_import"))$("#token_import_btn").attr("layer-id",e).attr("data-type","region"),$("#tokenImportModal").modal("show"),$("#token_value").val("");else if($(t.target).hasClass("load_district")){var e=current_layer_id;$("#loadDistrict").modal("show"),$("#submitDistrict").attr("layer-id",e)}})}};$("#layer_panel_"+current_layer_id).DtPanel("init",r)},RegionUtils.addRegionsToMap=function(t){var e=window.setInterval(function(){RegionUtils.regionTimer=!1;var i=t.shift();i&&(RegionUtils.map.addLayer(i),i.display||i.hide(),i.code&&""!=i.code&&(i.code.indexOf("0000")==-1?(i.hide(),i.label&&i.label.hide()):i.label&&i.label.show())),0==t.length&&(window.clearInterval(e),e=null,RegionUtils.regionTimer=!0)},1)},RegionUtils.addCorrectionPanel=function(t,e){t.eye_icon="hide"==t.display?"glyphicon-eye-close":"glyphicon-eye-open";var i="";null!=t.show_fields&&(i=t.show_fields);var n="";n+=t.is_del?'<div class="layer dr-bg-pink dt-pos-r" id="region_layer_'+t.id+'" layer-id="'+t.id+'" data-region-title="'+t.uniform_title+'" data-show-fields="'+i+'">':'<div class="layer dt-pos-r" id="region_layer_'+t.id+'" layer-id="'+t.id+'" data-region-title="'+t.uniform_title+'" data-show-fields="'+i+'">',n+='<div class="dt-h30">',n+='<span data-toggle="tooltip" data-placement="bottom" data-container="body" class="glyphicon '+t.eye_icon+' display_layer rglayer pull-left dt-mar6r dt-mar8t" layer-id="'+t.id+'" aria-hidden="true" title="\u9690\u85cf/\u663e\u793a\u56fe\u5c42"></span>',n+='<div layer-id="'+t.id+'" title="'+t.title+'" class="dt-truncate dt-pointer dt-w200 pull-left layer_title dt-mar6t">'+t.title+"</div>",n+="</div>",n+="hide"==t.display?'<ul class="list-unstyled dt-pad12x dt-pad12y" style="display:none">':'<ul class="list-unstyled dt-pad12x dt-pad12y" style="display:block">';for(var r=0;r<t.getRegions().getSize();r++){var a=t.getRegions().values()[r],o="";a.display||(o="dt-none"),n+='<li id="li_region_id_'+a.feature_id+'" class="dt-truncate select_region '+o+'" region-id="'+a.feature_id+'">';var s=t.uniform_config.fill_color?parseInt(t.uniform_config.fill_color.substring(1,3),16):255,l=t.uniform_config.fill_color?parseInt(t.uniform_config.fill_color.substring(3,5),16):0,d=t.uniform_config.fill_color?parseInt(t.uniform_config.fill_color.substring(5,7),16):0,h=t.uniform_config.fill_opacity?t.uniform_config.fill_opacity:.2,c=t.uniform_config.stroke_weight?t.uniform_config.stroke_weight:1,u=t.uniform_config.stroke_color?t.uniform_config.stroke_color:"#ff0000";n+=1==parseInt(a.region_type)?parseInt(t.uniform_config.stroke_weight)>5?'<div id="regionStyle_'+a.feature_id+'" region-id="'+a.feature_id+'" class="select_region dt-mar5y dt-mar8x pull-left" style="height: 14px;width: 14px;border-radius: 7px;border:5px solid '+u+";background-color:rgba("+s+","+l+","+d+","+h+')"> </div>':'<div id="regionStyle_'+a.feature_id+'" region-id="'+a.feature_id+'" class="select_region dt-mar5y dt-mar8x pull-left" style="height: 14px;width: 14px;border-radius: 7px;border:'+c+"px solid "+u+";background-color:rgba("+s+","+l+","+d+","+h+')"> </div>':parseInt(t.uniform_config.stroke_weight)>5?'<div id="regionStyle_'+a.feature_id+'" region-id="'+a.feature_id+'" class="select_region dt-mar5 pull-left" style="height: 14px;width: 20px;border:5px solid '+u+";background-color:rgba("+s+","+l+","+d+","+h+')"> </div>':'<div id="regionStyle_'+a.feature_id+'" region-id="'+a.feature_id+'" class="select_region dt-mar5 pull-left" style="height: 14px;width: 20px;border:'+c+"px solid "+u+";background-color:rgba("+s+","+l+","+d+","+h+')"> </div>',n+='<span id="setRegionTitle_'+a.feature_id+'" region-id="'+a.feature_id+'" class="select_region region-title dt-line-24h dt-f12">'+a.title+"</span>",n+="</li>"}n+="</ul>",n+="</div>",$(e).append(n)},RegionUtils.delRegion=function(t){MapUtils.reloadTooltip();var e="\u5220\u9664\u533a\u57df\u540e\u5c06\u4e0d\u53ef\u6062\u590d\uff0c\u786e\u5b9a\u5c06\u6b64\u533a\u57df\u4fe1\u606f\u5220\u9664\uff1f";PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){MapUtils.ajax2server(destroy_region_url,"DELETE",{id:t.feature_id,mid:mid})}}),$(".xcConfirm .popBox .txtBox p").css("margin-top","0")},RegionUtils.editNodeRegion=function(t){return t instanceof Dtwy.Polygon&&t.isComplex()?void PromptInfo.xcConfirm("\u6b64\u533a\u57df\u4e0d\u652f\u6301\u7f16\u8f91\u8282\u70b9",PromptInfo.xcConfirm.typeEnum.info):(t.toggleEditing(),void BInfowindow.close())},RegionUtils.saveRegion=function(t,e,i,n){var r=e.getLabelConfig(),a=t.getLabel();if(a&&null!=t.label&&r.field&&0!=r.field.length)for(var o=0;o<t.attrs.length;o++){var s=t.attrs[o];if(r.field==s.key){a.setContent(i[s.id]);break}}for(var l=!1,d=t.cloneAttrs(),h=0;h<t.attrs.length;h++){var s=t.attrs[h];if(null!=s&&"undefined"!=typeof i[s.id]&&null!=i[s.id]&&s.value!=i[s.id].trim()){s.value=i[s.id],l=!0;break}}l?MapUtils.ajax2server(update_region_attrs_url,"PUT",{attrs:i,id:t.feature_id,mid:mid},function(){n&&n(t,l)},function(e){400==e.status&&($(".BMapLib_bubble_title").text(t.title),t.attrs=d,n(t,l))}):n&&n(t,l)},RegionUtils.setRegionStyle=function(t){$('[data-toggle="tooltip"]').tooltip("destroy").tooltip(),$("#editRegionStyle").attr("region-id",t.feature_id).attr("region-layer-id",t.layer_id).modal("show"),$("#set_region_style").attr("data-region-id",t.feature_id).data("data-region",t)},RegionUtils.generateRegion=function(t){var e;return 1==t.region_type?(t.encoded_path.indexOf(";")<0?t.path=MapUtils.path2CenterRadius(t.encoded_path):t.path=t.encoded_path,e=new Dtwy.Circle(t.path,{data:t})):(t.encoded_path&&(t.path=MapUtils.decodePath(t.encoded_path)),e=new Dtwy.Polygon(t.path,{data:t})),e},RegionUtils.isPointInRegion=function(t,e){return e instanceof L.Circle&&DtwyLib.GeoUtils.isPointInCircle(t,e)||e instanceof L.Polygon&&DtwyLib.GeoUtils.isPointInPolygon(t,e)}}),function(t,e){function i(e,i){var r,a,o,s=e.nodeName.toLowerCase();return"area"===s?(r=e.parentNode,a=r.name,!(!e.href||!a||"map"!==r.nodeName.toLowerCase())&&(o=t("img[usemap=#"+a+"]")[0],!!o&&n(o))):(/input|select|textarea|button|object/.test(s)?!e.disabled:"a"===s?e.href||i:i)&&n(e)}function n(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter(function(){return"hidden"===t.css(this,"visibility")}).length}var r=0,a=/^ui-id-\d+$/;t.ui=t.ui||{},t.extend(t.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),t.fn.extend({focus:function(e){return function(i,n){return"number"==typeof i?this.each(function(){var e=this;setTimeout(function(){t(e).focus(),n&&n.call(e)},i)}):e.apply(this,arguments)}}(t.fn.focus),scrollParent:function(){var e;return e=t.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(t.css(this,"position"))&&/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!e.length?t(document):e},zIndex:function(i){if(i!==e)return this.css("zIndex",i);if(this.length)for(var n,r,a=t(this[0]);a.length&&a[0]!==document;){if(n=a.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(r=parseInt(a.css("zIndex"),10),!isNaN(r)&&0!==r))return r;a=a.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++r)})},removeUniqueId:function(){return this.each(function(){a.test(this.id)&&t(this).removeAttr("id")})}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,n){return!!t.data(e,n[3])},focusable:function(e){return i(e,!isNaN(t.attr(e,"tabindex")))},tabbable:function(e){var n=t.attr(e,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(e,!r)}}),t("<a>").outerWidth(1).jquery||t.each(["Width","Height"],function(i,n){function r(e,i,n,r){return t.each(a,function(){i-=parseFloat(t.css(e,"padding"+this))||0,n&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),r&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var a="Width"===n?["Left","Right"]:["Top","Bottom"],o=n.toLowerCase(),s={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+n]=function(i){return i===e?s["inner"+n].call(this):this.each(function(){t(this).css(o,r(this,i)+"px")})},t.fn["outer"+n]=function(e,i){return"number"!=typeof e?s["outer"+n].call(this,e):this.each(function(){t(this).css(o,r(this,e,!0,i)+"px")})}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(t.fn.removeData=function(e){return function(i){return arguments.length?e.call(this,t.camelCase(i)):e.call(this)}}(t.fn.removeData)),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),t.support.selectstart="onselectstart"in document.createElement("div"),t.fn.extend({disableSelection:function(){return this.bind((t.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(t){t.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),t.extend(t.ui,{plugin:{add:function(e,i,n){var r,a=t.ui[e].prototype;for(r in n)a.plugins[r]=a.plugins[r]||[],a.plugins[r].push([i,n[r]])},call:function(t,e,i){var n,r=t.plugins[e];if(r&&t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType)for(n=0;r.length>n;n++)t.options[r[n][0]]&&r[n][1].apply(t.element,i)}},hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",r=!1;return e[n]>0||(e[n]=1,r=e[n]>0,e[n]=0,r)}})}(jQuery),function(t,e){var i=0,n=Array.prototype.slice,r=t.cleanData;t.cleanData=function(e){for(var i,n=0;null!=(i=e[n]);n++)try{t(i).triggerHandler("remove")}catch(t){}r(e)},t.widget=function(i,n,r){var a,o,s,l,d={},h=i.split(".")[0];i=i.split(".")[1],a=h+"-"+i,r||(r=n,n=t.Widget),t.expr[":"][a.toLowerCase()]=function(e){return!!t.data(e,a)},t[h]=t[h]||{},o=t[h][i],s=t[h][i]=function(t,i){return this._createWidget?(arguments.length&&this._createWidget(t,i),e):new s(t,i)},t.extend(s,o,{version:r.version,_proto:t.extend({},r),_childConstructors:[]}),l=new n,l.options=t.widget.extend({},l.options),t.each(r,function(i,r){return t.isFunction(r)?(d[i]=function(){var t=function(){return n.prototype[i].apply(this,arguments)},e=function(t){return n.prototype[i].apply(this,t)};return function(){var i,n=this._super,a=this._superApply;return this._super=t,this._superApply=e,i=r.apply(this,arguments),this._super=n,this._superApply=a,i}}(),e):(d[i]=r,e)}),s.prototype=t.widget.extend(l,{widgetEventPrefix:o?l.widgetEventPrefix||i:i},d,{constructor:s,namespace:h,widgetName:i,widgetFullName:a}),o?(t.each(o._childConstructors,function(e,i){var n=i.prototype;t.widget(n.namespace+"."+n.widgetName,s,i._proto)}),delete o._childConstructors):n._childConstructors.push(s),t.widget.bridge(i,s)},t.widget.extend=function(i){for(var r,a,o=n.call(arguments,1),s=0,l=o.length;l>s;s++)for(r in o[s])a=o[s][r],o[s].hasOwnProperty(r)&&a!==e&&(i[r]=t.isPlainObject(a)?t.isPlainObject(i[r])?t.widget.extend({},i[r],a):t.widget.extend({},a):a);return i},t.widget.bridge=function(i,r){var a=r.prototype.widgetFullName||i;t.fn[i]=function(o){var s="string"==typeof o,l=n.call(arguments,1),d=this;return o=!s&&l.length?t.widget.extend.apply(null,[o].concat(l)):o,s?this.each(function(){var n,r=t.data(this,a);return r?t.isFunction(r[o])&&"_"!==o.charAt(0)?(n=r[o].apply(r,l),n!==r&&n!==e?(d=n&&n.jquery?d.pushStack(n.get()):n,!1):e):t.error("no such method '"+o+"' for "+i+" widget instance"):t.error("cannot call methods on "+i+" prior to initialization; attempted to call method '"+o+"'")}):this.each(function(){var e=t.data(this,a);e?e.option(o||{})._init():t.data(this,a,new r(o,this))}),d}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,n){n=t(n||this.defaultElement||this)[0],this.element=t(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),n!==this&&(t.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===n&&this.destroy()}}),this.document=t(n.style?n.ownerDocument:n.document||n),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(i,n){var r,a,o,s=i;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof i)if(s={},r=i.split("."),i=r.shift(),r.length){for(a=s[i]=t.widget.extend({},this.options[i]),o=0;r.length-1>o;o++)a[r[o]]=a[r[o]]||{},a=a[r[o]];if(i=r.pop(),1===arguments.length)return a[i]===e?null:a[i];a[i]=n}else{if(1===arguments.length)return this.options[i]===e?null:this.options[i];s[i]=n}return this._setOptions(s),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(i,n,r){var a,o=this;"boolean"!=typeof i&&(r=n,n=i,i=!1),r?(n=a=t(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,a=this.widget()),t.each(r,function(r,s){function l(){return i||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof s?o[s]:s).apply(o,arguments):e}"string"!=typeof s&&(l.guid=s.guid=s.guid||l.guid||t.guid++);var d=r.match(/^(\w+)\s*(.*)$/),h=d[1]+o.eventNamespace,c=d[2];c?a.delegate(c,h,l):n.bind(h,l)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function i(){return("string"==typeof t?n[t]:t).apply(n,arguments)}var n=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,n){var r,a,o=this.options[e];if(n=n||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(r in a)r in i||(i[r]=a[r]);return this.element.trigger(i,n),!(t.isFunction(o)&&o.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(n,r,a){"string"==typeof r&&(r={effect:r});var o,s=r?r===!0||"number"==typeof r?i:r.effect||i:e;r=r||{},"number"==typeof r&&(r={duration:r}),o=!t.isEmptyObject(r),r.complete=a,r.delay&&n.delay(r.delay),o&&t.effects&&t.effects.effect[s]?n[e](r):s!==e&&n[s]?n[s](r.duration,r.easing,a):n.queue(function(i){t(this)[e](),a&&a.call(n[0]),i()})}})}(jQuery),function(t){var e=!1;t(document).mouseup(function(){e=!1}),t.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!e){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,r=1===i.which,a=!("string"!=typeof this.options.cancel||!i.target.nodeName)&&t(i.target).closest(this.options.cancel).length;return!(r&&!a&&this._mouseCapture(i))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===t.data(i.target,this.widgetName+".preventClickEvent")&&t.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return n._mouseMove(t)},this._mouseUpDelegate=function(t){return n._mouseUp(t)},t(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),e=!0,!0))}},_mouseMove:function(e){return t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button?this._mouseUp(e):this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(t){t.widget("ui.draggable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(e){var i=this.options;return!(this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(e),!!this.handle&&(t(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){t("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")}),!0))},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,i){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(this._trigger("drag",e,n)===!1)return this._mouseUp({}),!1;this.position=n.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,n=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(n=t.ui.ddmanager.drop(this,e)),this.dropped&&(n=this.dropped,this.dropped=!1),!("original"===this.options.helper&&!t.contains(this.element[0].ownerDocument,this.element[0]))&&("invalid"===this.options.revert&&!n||"valid"===this.options.revert&&n||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1)},_mouseUp:function(e){return t("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){return!this.options.handle||!!t(e.target).closest(this.element.find(this.options.handle)).length},_createHelper:function(e){var i=this.options,n=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.element.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,n,r=this.options;return r.containment?"window"===r.containment?void(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===r.containment?void(this.containment=[0,0,t(document).width()-this.helperProportions.width-this.margins.left,(t(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):r.containment.constructor===Array?void(this.containment=r.containment):("parent"===r.containment&&(r.containment=this.helper[0].parentNode),i=t(r.containment),n=i[0],void(n&&(e="hidden"!==i.css("overflow"),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i))):void(this.containment=null)},_convertPositionTo:function(e,i){i||(i=this.position);var n="absolute"===e?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:r.scrollTop(),left:r.scrollLeft()}),{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*n}},_generatePosition:function(e){var i,n,r,a,o=this.options,s="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=e.pageX,d=e.pageY;return this.offset.scroll||(this.offset.scroll={top:s.scrollTop(),left:s.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(n=this.relative_container.offset(),i=[this.containment[0]+n.left,this.containment[1]+n.top,this.containment[2]+n.left,this.containment[3]+n.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(d=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(d=i[3]+this.offset.click.top)),o.grid&&(r=o.grid[1]?this.originalPageY+Math.round((d-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,d=i?r-this.offset.click.top>=i[1]||r-this.offset.click.top>i[3]?r:r-this.offset.click.top>=i[1]?r-o.grid[1]:r+o.grid[1]:r,a=o.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,l=i?a-this.offset.click.left>=i[0]||a-this.offset.click.left>i[2]?a:a-this.offset.click.left>=i[0]?a-o.grid[0]:a+o.grid[0]:a)),{top:d-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,i,n){return n=n||this._uiHash(),t.ui.plugin.call(this,e,[i,n]),"drag"===e&&(this.positionAbs=this._convertPositionTo("absolute")),t.Widget.prototype._trigger.call(this,e,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i){var n=t(this).data("ui-draggable"),r=n.options,a=t.extend({},i,{item:n.element});n.sortables=[],t(r.connectToSortable).each(function(){var i=t.data(this,"ui-sortable");i&&!i.options.disabled&&(n.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),
i._trigger("activate",e,a))})},stop:function(e,i){var n=t(this).data("ui-draggable"),r=t.extend({},i,{item:n.element});t.each(n.sortables,function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"===n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,r))})},drag:function(e,i){var n=t(this).data("ui-draggable"),r=this;t.each(n.sortables,function(){var a=!1,o=this;this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(a=!0,t.each(n.sortables,function(){return this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this!==o&&this.instance._intersectsWith(this.instance.containerCache)&&t.contains(o.instance.element[0],this.instance.element[0])&&(a=!1),a})),a?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(r).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",e),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",e),n.dropped=!1)})}}),t.ui.plugin.add("draggable","cursor",{start:function(){var e=t("body"),i=t(this).data("ui-draggable").options;e.css("cursor")&&(i._cursor=e.css("cursor")),e.css("cursor",i.cursor)},stop:function(){var e=t(this).data("ui-draggable").options;e._cursor&&t("body").css("cursor",e._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i){var n=t(i.helper),r=t(this).data("ui-draggable").options;n.css("opacity")&&(r._opacity=n.css("opacity")),n.css("opacity",r.opacity)},stop:function(e,i){var n=t(this).data("ui-draggable").options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(){var e=t(this).data("ui-draggable");e.scrollParent[0]!==document&&"HTML"!==e.scrollParent[0].tagName&&(e.overflowOffset=e.scrollParent.offset())},drag:function(e){var i=t(this).data("ui-draggable"),n=i.options,r=!1;i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName?(n.axis&&"x"===n.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-e.pageY<n.scrollSensitivity?i.scrollParent[0].scrollTop=r=i.scrollParent[0].scrollTop+n.scrollSpeed:e.pageY-i.overflowOffset.top<n.scrollSensitivity&&(i.scrollParent[0].scrollTop=r=i.scrollParent[0].scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-e.pageX<n.scrollSensitivity?i.scrollParent[0].scrollLeft=r=i.scrollParent[0].scrollLeft+n.scrollSpeed:e.pageX-i.overflowOffset.left<n.scrollSensitivity&&(i.scrollParent[0].scrollLeft=r=i.scrollParent[0].scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(document).scrollTop()<n.scrollSensitivity?r=t(document).scrollTop(t(document).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<n.scrollSensitivity&&(r=t(document).scrollTop(t(document).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(document).scrollLeft()<n.scrollSensitivity?r=t(document).scrollLeft(t(document).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<n.scrollSensitivity&&(r=t(document).scrollLeft(t(document).scrollLeft()+n.scrollSpeed)))),r!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(i,e)}}),t.ui.plugin.add("draggable","snap",{start:function(){var e=t(this).data("ui-draggable"),i=e.options;e.snapElements=[],t(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var i=t(this),n=i.offset();this!==e.element[0]&&e.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:n.top,left:n.left})})},drag:function(e,i){var n,r,a,o,s,l,d,h,c,u,p=t(this).data("ui-draggable"),f=p.options,m=f.snapTolerance,g=i.offset.left,_=g+p.helperProportions.width,y=i.offset.top,v=y+p.helperProportions.height;for(c=p.snapElements.length-1;c>=0;c--)s=p.snapElements[c].left,l=s+p.snapElements[c].width,d=p.snapElements[c].top,h=d+p.snapElements[c].height,s-m>_||g>l+m||d-m>v||y>h+m||!t.contains(p.snapElements[c].item.ownerDocument,p.snapElements[c].item)?(p.snapElements[c].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,e,t.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=!1):("inner"!==f.snapMode&&(n=m>=Math.abs(d-v),r=m>=Math.abs(h-y),a=m>=Math.abs(s-_),o=m>=Math.abs(l-g),n&&(i.position.top=p._convertPositionTo("relative",{top:d-p.helperProportions.height,left:0}).top-p.margins.top),r&&(i.position.top=p._convertPositionTo("relative",{top:h,left:0}).top-p.margins.top),a&&(i.position.left=p._convertPositionTo("relative",{top:0,left:s-p.helperProportions.width}).left-p.margins.left),o&&(i.position.left=p._convertPositionTo("relative",{top:0,left:l}).left-p.margins.left)),u=n||r||a||o,"outer"!==f.snapMode&&(n=m>=Math.abs(d-y),r=m>=Math.abs(h-v),a=m>=Math.abs(s-g),o=m>=Math.abs(l-_),n&&(i.position.top=p._convertPositionTo("relative",{top:d,left:0}).top-p.margins.top),r&&(i.position.top=p._convertPositionTo("relative",{top:h-p.helperProportions.height,left:0}).top-p.margins.top),a&&(i.position.left=p._convertPositionTo("relative",{top:0,left:s}).left-p.margins.left),o&&(i.position.left=p._convertPositionTo("relative",{top:0,left:l-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[c].snapping&&(n||r||a||o||u)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,e,t.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=n||r||a||o||u)}}),t.ui.plugin.add("draggable","stack",{start:function(){var e,i=this.data("ui-draggable").options,n=t.makeArray(t(i.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});n.length&&(e=parseInt(t(n[0]).css("zIndex"),10)||0,t(n).each(function(i){t(this).css("zIndex",e+i)}),this.css("zIndex",e+n.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i){var n=t(i.helper),r=t(this).data("ui-draggable").options;n.css("zIndex")&&(r._zIndex=n.css("zIndex")),n.css("zIndex",r.zIndex)},stop:function(e,i){var n=t(this).data("ui-draggable").options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}})}(jQuery),function(t){function e(t,e,i){return t>e&&e+i>t}t.widget("ui.droppable",{version:"1.10.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,n=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(n)?n:function(t){return t.is(n)},this.proportions=function(){return arguments.length?void(e=arguments[0]):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},t.ui.ddmanager.droppables[i.scope]=t.ui.ddmanager.droppables[i.scope]||[],t.ui.ddmanager.droppables[i.scope].push(this),i.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var e=0,i=t.ui.ddmanager.droppables[this.options.scope];i.length>e;e++)i[e]===this&&i.splice(e,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,i){"accept"===e&&(this.accept=t.isFunction(i)?i:function(t){return t.is(i)}),t.Widget.prototype._setOption.apply(this,arguments)},_activate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var n=i||t.ui.ddmanager.current,r=!1;return!(!n||(n.currentItem||n.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var e=t.data(this,"ui-droppable");return e.options.greedy&&!e.options.disabled&&e.options.scope===n.options.scope&&e.accept.call(e.element[0],n.currentItem||n.element)&&t.ui.intersect(n,t.extend(e,{offset:e.element.offset()}),e.options.tolerance)?(r=!0,!1):void 0}),!r&&(!!this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(n)),this.element)))},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}}}),t.ui.intersect=function(t,i,n){if(!i.offset)return!1;var r,a,o=(t.positionAbs||t.position.absolute).left,s=(t.positionAbs||t.position.absolute).top,l=o+t.helperProportions.width,d=s+t.helperProportions.height,h=i.offset.left,c=i.offset.top,u=h+i.proportions().width,p=c+i.proportions().height;switch(n){case"fit":return o>=h&&u>=l&&s>=c&&p>=d;case"intersect":return o+t.helperProportions.width/2>h&&u>l-t.helperProportions.width/2&&s+t.helperProportions.height/2>c&&p>d-t.helperProportions.height/2;case"pointer":return r=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,a=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,e(a,c,i.proportions().height)&&e(r,h,i.proportions().width);case"touch":return(s>=c&&p>=s||d>=c&&p>=d||c>s&&d>p)&&(o>=h&&u>=o||l>=h&&u>=l||h>o&&l>u);default:return!1}},t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,i){var n,r,a=t.ui.ddmanager.droppables[e.options.scope]||[],o=i?i.type:null,s=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(n=0;a.length>n;n++)if(!(a[n].options.disabled||e&&!a[n].accept.call(a[n].element[0],e.currentItem||e.element))){for(r=0;s.length>r;r++)if(s[r]===a[n].element[0]){a[n].proportions().height=0;continue t}a[n].visible="none"!==a[n].element.css("display"),a[n].visible&&("mousedown"===o&&a[n]._activate.call(a[n],i),a[n].offset=a[n].element.offset(),a[n].proportions({width:a[n].element[0].offsetWidth,height:a[n].element[0].offsetHeight}))}},drop:function(e,i){var n=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&t.ui.intersect(e,this,this.options.tolerance)&&(n=this._drop.call(this,i)||n),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),n},dragStart:function(e,i){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var n,r,a,o=t.ui.intersect(e,this,this.options.tolerance),s=!o&&this.isover?"isout":o&&!this.isover?"isover":null;s&&(this.options.greedy&&(r=this.options.scope,a=this.element.parents(":data(ui-droppable)").filter(function(){return t.data(this,"ui-droppable").options.scope===r}),a.length&&(n=t.data(a[0],"ui-droppable"),n.greedyChild="isover"===s)),n&&"isover"===s&&(n.isover=!1,n.isout=!0,n._out.call(n,i)),this[s]=!0,this["isout"===s?"isover":"isout"]=!1,this["isover"===s?"_over":"_out"].call(this,i),n&&"isout"===s&&(n.isout=!1,n.isover=!0,n._over.call(n,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}}}(jQuery),function(t){function e(t){return parseInt(t,10)||0}function i(t){return!isNaN(parseInt(t,10))}t.widget("ui.resizable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var e,i,n,r,a,o=this,s=this.options;if(this.element.addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!s.aspectRatio,aspectRatio:s.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:s.helper||s.ghost||s.animate?s.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=s.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),e=this.handles.split(","),this.handles={},i=0;e.length>i;i++)n=t.trim(e[i]),a="ui-resizable-"+n,r=t("<div class='ui-resizable-handle "+a+"'></div>"),r.css({zIndex:s.zIndex}),"se"===n&&r.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[n]=".ui-resizable-"+n,this.element.append(r);this._renderAxis=function(e){var i,n,r,a;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String&&(this.handles[i]=t(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(n=t(this.handles[i],this.element),a=/sw|ne|nw|se|n|s/.test(i)?n.outerHeight():n.outerWidth(),r=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(r,a),this._proportionallyResize()),t(this.handles[i]).length},this._renderAxis(this.element),this._handles=t(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(r=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=r&&r[1]?r[1]:"se")}),s.autoHide&&(this._handles.hide(),t(this.element).addClass("ui-resizable-autohide").mouseenter(function(){s.disabled||(t(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){s.disabled||o.resizing||(t(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(e){var i,n,r=!1;for(i in this.handles)n=t(this.handles[i])[0],(n===e.target||t.contains(n,e.target))&&(r=!0);return!this.options.disabled&&r},_mouseStart:function(i){var n,r,a,o=this.options,s=this.element.position(),l=this.element;return this.resizing=!0,/absolute/.test(l.css("position"))?l.css({position:"absolute",top:l.css("top"),left:l.css("left")}):l.is(".ui-draggable")&&l.css({position:"absolute",top:s.top,left:s.left}),this._renderProxy(),n=e(this.helper.css("left")),r=e(this.helper.css("top")),o.containment&&(n+=t(o.containment).scrollLeft()||0,r+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:n,top:r},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:l.width(),height:l.height()},this.originalSize=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalPosition={left:n,top:r},this.sizeDiff={width:l.outerWidth()-l.width(),height:l.outerHeight()-l.height()},this.originalMousePosition={left:i.pageX,top:i.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,a=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===a?this.axis+"-resize":a),l.addClass("ui-resizable-resizing"),this._propagate("start",i),!0},_mouseDrag:function(e){var i,n=this.helper,r={},a=this.originalMousePosition,o=this.axis,s=this.position.top,l=this.position.left,d=this.size.width,h=this.size.height,c=e.pageX-a.left||0,u=e.pageY-a.top||0,p=this._change[o];return!!p&&(i=p.apply(this,[e,c,u]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),this.position.top!==s&&(r.top=this.position.top+"px"),this.position.left!==l&&(r.left=this.position.left+"px"),this.size.width!==d&&(r.width=this.size.width+"px"),this.size.height!==h&&(r.height=this.size.height+"px"),n.css(r),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(r)||this._trigger("resize",e,this.ui()),!1)},_mouseStop:function(e){this.resizing=!1;var i,n,r,a,o,s,l,d=this.options,h=this;return this._helper&&(i=this._proportionallyResizeElements,n=i.length&&/textarea/i.test(i[0].nodeName),r=n&&t.ui.hasScroll(i[0],"left")?0:h.sizeDiff.height,a=n?0:h.sizeDiff.width,o={width:h.helper.width()-a,height:h.helper.height()-r},s=parseInt(h.element.css("left"),10)+(h.position.left-h.originalPosition.left)||null,l=parseInt(h.element.css("top"),10)+(h.position.top-h.originalPosition.top)||null,d.animate||this.element.css(t.extend(o,{top:l,left:s})),h.helper.height(h.size.height),h.helper.width(h.size.width),this._helper&&!d.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(t){var e,n,r,a,o,s=this.options;o={minWidth:i(s.minWidth)?s.minWidth:0,maxWidth:i(s.maxWidth)?s.maxWidth:1/0,minHeight:i(s.minHeight)?s.minHeight:0,maxHeight:i(s.maxHeight)?s.maxHeight:1/0},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,r=o.minWidth/this.aspectRatio,n=o.maxHeight*this.aspectRatio,a=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),r>o.minHeight&&(o.minHeight=r),o.maxWidth>n&&(o.maxWidth=n),o.maxHeight>a&&(o.maxHeight=a)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),i(t.left)&&(this.position.left=t.left),i(t.top)&&(this.position.top=t.top),i(t.height)&&(this.size.height=t.height),i(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,n=this.size,r=this.axis;return i(t.height)?t.width=t.height*this.aspectRatio:i(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===r&&(t.left=e.left+(n.width-t.width),t.top=null),"nw"===r&&(t.top=e.top+(n.height-t.height),t.left=e.left+(n.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,n=this.axis,r=i(t.width)&&e.maxWidth&&e.maxWidth<t.width,a=i(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=i(t.width)&&e.minWidth&&e.minWidth>t.width,s=i(t.height)&&e.minHeight&&e.minHeight>t.height,l=this.originalPosition.left+this.originalSize.width,d=this.position.top+this.size.height,h=/sw|nw|w/.test(n),c=/nw|ne|n/.test(n);return o&&(t.width=e.minWidth),s&&(t.height=e.minHeight),r&&(t.width=e.maxWidth),a&&(t.height=e.maxHeight),o&&h&&(t.left=l-e.minWidth),r&&h&&(t.left=l-e.maxWidth),s&&c&&(t.top=d-e.minHeight),a&&c&&(t.top=d-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var t,e,i,n,r,a=this.helper||this.element;for(t=0;this._proportionallyResizeElements.length>t;t++){if(r=this._proportionallyResizeElements[t],!this.borderDif)for(this.borderDif=[],i=[r.css("borderTopWidth"),r.css("borderRightWidth"),r.css("borderBottomWidth"),r.css("borderLeftWidth")],n=[r.css("paddingTop"),r.css("paddingRight"),r.css("paddingBottom"),r.css("paddingLeft")],e=0;i.length>e;e++)this.borderDif[e]=(parseInt(i[e],10)||0)+(parseInt(n[e],10)||0);r.css({height:a.height()-this.borderDif[0]-this.borderDif[2]||0,width:a.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,n=this.originalPosition;return{left:n.left+e,width:i.width-e}},n:function(t,e,i){var n=this.originalSize,r=this.originalPosition;return{top:r.top+i,height:n.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,n){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,n]))},sw:function(e,i,n){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,n]))},ne:function(e,i,n){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,n]))},nw:function(e,i,n){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,n]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).data("ui-resizable"),n=i.options,r=i._proportionallyResizeElements,a=r.length&&/textarea/i.test(r[0].nodeName),o=a&&t.ui.hasScroll(r[0],"left")?0:i.sizeDiff.height,s=a?0:i.sizeDiff.width,l={width:i.size.width-s,height:i.size.height-o},d=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,h=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(l,h&&d?{top:h,left:d}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var n={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};r&&r.length&&t(r[0]).css({width:n.width,height:n.height}),i._updateCache(n),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var i,n,r,a,o,s,l,d=t(this).data("ui-resizable"),h=d.options,c=d.element,u=h.containment,p=u instanceof t?u.get(0):/parent/.test(u)?c.parent().get(0):u;p&&(d.containerElement=t(p),/document/.test(u)||u===document?(d.containerOffset={left:0,top:0},d.containerPosition={left:0,top:0},d.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(i=t(p),n=[],t(["Top","Right","Left","Bottom"]).each(function(t,r){n[t]=e(i.css("padding"+r))}),d.containerOffset=i.offset(),d.containerPosition=i.position(),d.containerSize={height:i.innerHeight()-n[3],width:i.innerWidth()-n[1]},r=d.containerOffset,a=d.containerSize.height,o=d.containerSize.width,s=t.ui.hasScroll(p,"left")?p.scrollWidth:o,l=t.ui.hasScroll(p)?p.scrollHeight:a,d.parentData={element:p,left:r.left,top:r.top,width:s,height:l}))},resize:function(e){var i,n,r,a,o=t(this).data("ui-resizable"),s=o.options,l=o.containerOffset,d=o.position,h=o._aspectRatio||e.shiftKey,c={top:0,left:0},u=o.containerElement;u[0]!==document&&/static/.test(u.css("position"))&&(c=l),d.left<(o._helper?l.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-l.left:o.position.left-c.left),h&&(o.size.height=o.size.width/o.aspectRatio),o.position.left=s.helper?l.left:0),d.top<(o._helper?l.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-l.top:o.position.top),h&&(o.size.width=o.size.height*o.aspectRatio),o.position.top=o._helper?l.top:0),o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top,i=Math.abs((o._helper?o.offset.left-c.left:o.offset.left-c.left)+o.sizeDiff.width),n=Math.abs((o._helper?o.offset.top-c.top:o.offset.top-l.top)+o.sizeDiff.height),r=o.containerElement.get(0)===o.element.parent().get(0),a=/relative|absolute/.test(o.containerElement.css("position")),r&&a&&(i-=Math.abs(o.parentData.left)),i+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-i,h&&(o.size.height=o.size.width/o.aspectRatio)),n+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-n,h&&(o.size.width=o.size.height*o.aspectRatio))},stop:function(){var e=t(this).data("ui-resizable"),i=e.options,n=e.containerOffset,r=e.containerPosition,a=e.containerElement,o=t(e.helper),s=o.offset(),l=o.outerWidth()-e.sizeDiff.width,d=o.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(a.css("position"))&&t(this).css({left:s.left-r.left-n.left,width:l,height:d}),e._helper&&!i.animate&&/static/.test(a.css("position"))&&t(this).css({left:s.left-r.left-n.left,width:l,height:d})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).data("ui-resizable"),i=e.options,n=function(e){t(e).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseInt(e.width(),10),height:parseInt(e.height(),10),left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?n(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],n(i.alsoResize)):t.each(i.alsoResize,function(t){n(t)})},resize:function(e,i){var n=t(this).data("ui-resizable"),r=n.options,a=n.originalSize,o=n.originalPosition,s={height:n.size.height-a.height||0,width:n.size.width-a.width||0,top:n.position.top-o.top||0,left:n.position.left-o.left||0},l=function(e,n){t(e).each(function(){var e=t(this),r=t(this).data("ui-resizable-alsoresize"),a={},o=n&&n.length?n:e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(r[e]||0)+(s[e]||0);i&&i>=0&&(a[e]=i||null)}),e.css(a)})};"object"!=typeof r.alsoResize||r.alsoResize.nodeType?l(r.alsoResize):t.each(r.alsoResize,function(t,e){l(t,e)})},stop:function(){t(this).removeData("resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).data("ui-resizable"),i=e.options,n=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:n.height,width:n.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).data("ui-resizable");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).data("ui-resizable");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e=t(this).data("ui-resizable"),i=e.options,n=e.size,r=e.originalSize,a=e.originalPosition,o=e.axis,s="number"==typeof i.grid?[i.grid,i.grid]:i.grid,l=s[0]||1,d=s[1]||1,h=Math.round((n.width-r.width)/l)*l,c=Math.round((n.height-r.height)/d)*d,u=r.width+h,p=r.height+c,f=i.maxWidth&&u>i.maxWidth,m=i.maxHeight&&p>i.maxHeight,g=i.minWidth&&i.minWidth>u,_=i.minHeight&&i.minHeight>p;i.grid=s,g&&(u+=l),_&&(p+=d),f&&(u-=l),m&&(p-=d),/^(se|s|e)$/.test(o)?(e.size.width=u,e.size.height=p):/^(ne)$/.test(o)?(e.size.width=u,e.size.height=p,e.position.top=a.top-c):/^(sw)$/.test(o)?(e.size.width=u,e.size.height=p,e.position.left=a.left-h):(p-d>0?(e.size.height=p,e.position.top=a.top-c):(e.size.height=d,e.position.top=a.top+r.height-d),u-l>0?(e.size.width=u,e.position.left=a.left-h):(e.size.width=l,e.position.left=a.left+r.width-l))}})}(jQuery),function(t){t.widget("ui.selectable",t.ui.mouse,{version:"1.10.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e=t(i.options.filter,i.element[0]),e.addClass("ui-selectee"),e.each(function(){var e=t(this),i=e.offset();t.data(this,"selectable-item",{element:this,$element:e,left:i.left,top:i.top,right:i.left+e.outerWidth(),bottom:i.top+e.outerHeight(),startselected:!1,selected:e.hasClass("ui-selected"),selecting:e.hasClass("ui-selecting"),unselecting:e.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=e.addClass("ui-selectee"),this._mouseInit(),this.helper=t("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(e){var i=this,n=this.options;this.opos=[e.pageX,e.pageY],this.options.disabled||(this.selectees=t(n.filter,this.element[0]),this._trigger("start",e),t(n.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),n.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var n=t.data(this,"selectable-item");n.startselected=!0,e.metaKey||e.ctrlKey||(n.$element.removeClass("ui-selected"),n.selected=!1,n.$element.addClass("ui-unselecting"),n.unselecting=!0,i._trigger("unselecting",e,{unselecting:n.element}))}),t(e.target).parents().addBack().each(function(){var n,r=t.data(this,"selectable-item");return r?(n=!e.metaKey&&!e.ctrlKey||!r.$element.hasClass("ui-selected"),r.$element.removeClass(n?"ui-unselecting":"ui-selected").addClass(n?"ui-selecting":"ui-unselecting"),r.unselecting=!n,r.selecting=n,r.selected=n,n?i._trigger("selecting",e,{selecting:r.element}):i._trigger("unselecting",e,{unselecting:r.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,n=this,r=this.options,a=this.opos[0],o=this.opos[1],s=e.pageX,l=e.pageY;
return a>s&&(i=s,s=a,a=i),o>l&&(i=l,l=o,o=i),this.helper.css({left:a,top:o,width:s-a,height:l-o}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),d=!1;i&&i.element!==n.element[0]&&("touch"===r.tolerance?d=!(i.left>s||a>i.right||i.top>l||o>i.bottom):"fit"===r.tolerance&&(d=i.left>a&&s>i.right&&i.top>o&&l>i.bottom),d?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,n._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),n._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,n._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var n=t.data(this,"selectable-item");n.$element.removeClass("ui-unselecting"),n.unselecting=!1,n.startselected=!1,i._trigger("unselected",e,{unselected:n.element})}),t(".ui-selecting",this.element[0]).each(function(){var n=t.data(this,"selectable-item");n.$element.removeClass("ui-selecting").addClass("ui-selected"),n.selecting=!1,n.selected=!0,n.startselected=!0,i._trigger("selected",e,{selected:n.element})}),this._trigger("stop",e),this.helper.remove(),!1}})}(jQuery),function(t){function e(t,e,i){return t>e&&e+i>t}function i(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))}t.widget("ui.sortable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var t=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=!!this.items.length&&("x"===t.axis||i(this.items[0].item)),this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_setOption:function(e,i){"disabled"===e?(this.options[e]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):t.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,i){var n=null,r=!1,a=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,a.widgetName+"-item")===a?(n=t(this),!1):void 0}),t.data(e.target,a.widgetName+"-item")===a&&(n=t(e.target)),!!n&&(!(this.options.handle&&!i&&(t(this.options.handle,n).find("*").addBack().each(function(){this===e.target&&(r=!0)}),!r))&&(this.currentItem=n,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(e,i,n){var r,a,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(a=this.document.find("body"),this.storedCursor=a.css("cursor"),a.css("cursor",o.cursor),this.storedStylesheet=t("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(a)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!o.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,n,r,a,o=this.options,s=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop+o.scrollSpeed:e.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft+o.scrollSpeed:e.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(e.pageY-t(document).scrollTop()<o.scrollSensitivity?s=t(document).scrollTop(t(document).scrollTop()-o.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<o.scrollSensitivity&&(s=t(document).scrollTop(t(document).scrollTop()+o.scrollSpeed)),e.pageX-t(document).scrollLeft()<o.scrollSensitivity?s=t(document).scrollLeft(t(document).scrollLeft()-o.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<o.scrollSensitivity&&(s=t(document).scrollLeft(t(document).scrollLeft()+o.scrollSpeed))),s!==!1&&t.ui.ddmanager&&!o.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(n=this.items[i],r=n.item[0],a=this._intersectsWithPointer(n),a&&n.instance===this.currentContainer&&r!==this.currentItem[0]&&this.placeholder[1===a?"next":"prev"]()[0]!==r&&!t.contains(this.placeholder[0],r)&&("semi-dynamic"!==this.options.type||!t.contains(this.element[0],r))){if(this.direction=1===a?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(n))break;this._rearrange(e,n),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var n=this,r=this.placeholder.offset(),a=this.options.axis,o={};a&&"x"!==a||(o.left=r.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),a&&"y"!==a||(o.top=r.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){n._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&n.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!n.length&&e.key&&n.push(e.key+"="),n.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},i.each(function(){n.push(t(e.item||this).attr(e.attribute||"id")||"")}),n},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,n=this.positionAbs.top,r=n+this.helperProportions.height,a=t.left,o=a+t.width,s=t.top,l=s+t.height,d=this.offset.click.top,h=this.offset.click.left,c="x"===this.options.axis||n+d>s&&l>n+d,u="y"===this.options.axis||e+h>a&&o>e+h,p=c&&u;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>a&&o>i-this.helperProportions.width/2&&n+this.helperProportions.height/2>s&&l>r-this.helperProportions.height/2},_intersectsWithPointer:function(t){var i="x"===this.options.axis||e(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||e(this.positionAbs.left+this.offset.click.left,t.left,t.width),r=i&&n,a=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return!!r&&(this.floating?o&&"right"===o||"down"===a?2:1:a&&("down"===a?2:1))},_intersectsWithSides:function(t){var i=e(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),n=e(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),r=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return this.floating&&a?"right"===a&&n||"left"===a&&!n:r&&("down"===r&&i||"up"===r&&!i)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){s.push(this)}var n,r,a,o,s=[],l=[],d=this._connectWith();if(d&&e)for(n=d.length-1;n>=0;n--)for(a=t(d[n]),r=a.length-1;r>=0;r--)o=t.data(a[r],this.widgetFullName),o&&o!==this&&!o.options.disabled&&l.push([t.isFunction(o.options.items)?o.options.items.call(o.element):t(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(l.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),n=l.length-1;n>=0;n--)l[n][0].each(i);return t(s)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,n,r,a,o,s,l,d,h=this.items,c=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],u=this._connectWith();if(u&&this.ready)for(i=u.length-1;i>=0;i--)for(r=t(u[i]),n=r.length-1;n>=0;n--)a=t.data(r[n],this.widgetFullName),a&&a!==this&&!a.options.disabled&&(c.push([t.isFunction(a.options.items)?a.options.items.call(a.element[0],e,{item:this.currentItem}):t(a.options.items,a.element),a]),this.containers.push(a));for(i=c.length-1;i>=0;i--)for(o=c[i][1],s=c[i][0],n=0,d=s.length;d>n;n++)l=t(s[n]),l.data(this.widgetName+"-item",o),h.push({item:l,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,n,r,a;for(i=this.items.length-1;i>=0;i--)n=this.items[i],n.instance!==this.currentContainer&&this.currentContainer&&n.item[0]!==this.currentItem[0]||(r=this.options.toleranceElement?t(this.options.toleranceElement,n.item):n.item,e||(n.width=r.outerWidth(),n.height=r.outerHeight()),a=r.offset(),n.left=a.left,n.top=a.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)a=this.containers[i].element.offset(),this.containers[i].containerCache.left=a.left,this.containers[i].containerCache.top=a.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,n=e.options;n.placeholder&&n.placeholder.constructor!==String||(i=n.placeholder,n.placeholder={element:function(){var n=e.currentItem[0].nodeName.toLowerCase(),r=t("<"+n+">",e.document[0]).addClass(i||e.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===n?e.currentItem.children().each(function(){t("<td>&#160;</td>",e.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(r)}):"img"===n&&r.attr("src",e.currentItem.attr("src")),i||r.css("visibility","hidden"),r},update:function(t,r){(!i||n.forcePlaceholderSize)&&(r.height()||r.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),r.width()||r.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(n.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),n.placeholder.update(e,e.placeholder)},_contactContainers:function(n){var r,a,o,s,l,d,h,c,u,p,f=null,m=null;for(r=this.containers.length-1;r>=0;r--)if(!t.contains(this.currentItem[0],this.containers[r].element[0]))if(this._intersectsWith(this.containers[r].containerCache)){if(f&&t.contains(this.containers[r].element[0],f.element[0]))continue;f=this.containers[r],m=r}else this.containers[r].containerCache.over&&(this.containers[r]._trigger("out",n,this._uiHash(this)),this.containers[r].containerCache.over=0);if(f)if(1===this.containers.length)this.containers[m].containerCache.over||(this.containers[m]._trigger("over",n,this._uiHash(this)),this.containers[m].containerCache.over=1);else{for(o=1e4,s=null,p=f.floating||i(this.currentItem),l=p?"left":"top",d=p?"width":"height",h=this.positionAbs[l]+this.offset.click[l],a=this.items.length-1;a>=0;a--)t.contains(this.containers[m].element[0],this.items[a].item[0])&&this.items[a].item[0]!==this.currentItem[0]&&(!p||e(this.positionAbs.top+this.offset.click.top,this.items[a].top,this.items[a].height))&&(c=this.items[a].item.offset()[l],u=!1,Math.abs(c-h)>Math.abs(c+this.items[a][d]-h)&&(u=!0,c+=this.items[a][d]),o>Math.abs(c-h)&&(o=Math.abs(c-h),s=this.items[a],this.direction=u?"up":"down"));if(!s&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[m])return;s?this._rearrange(n,s,null,!0):this._rearrange(n,null,this.containers[m].element,!0),this._trigger("change",n,this._uiHash()),this.containers[m]._trigger("change",n,this._uiHash(this)),this.currentContainer=this.containers[m],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[m]._trigger("over",n,this._uiHash(this)),this.containers[m].containerCache.over=1}},_createHelper:function(e){var i=this.options,n=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(!n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,n,r=this.options;"parent"===r.containment&&(r.containment=this.helper[0].parentNode),("document"===r.containment||"window"===r.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"===r.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"===r.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(r.containment)||(e=t(r.containment)[0],i=t(r.containment).offset(),n="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(n?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(n?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var n="absolute"===e?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(r[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:r.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:r.scrollLeft())*n}},_generatePosition:function(e){var i,n,r=this.options,a=e.pageX,o=e.pageY,s="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(s[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(a=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(a=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),r.grid&&(i=this.originalPageY+Math.round((o-this.originalPageY)/r.grid[1])*r.grid[1],o=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-r.grid[1]:i+r.grid[1]:i,n=this.originalPageX+Math.round((a-this.originalPageX)/r.grid[0])*r.grid[0],a=this.containment?n-this.offset.click.left>=this.containment[0]&&n-this.offset.click.left<=this.containment[2]?n:n-this.offset.click.left>=this.containment[0]?n-r.grid[0]:n+r.grid[0]:n)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:s.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:s.scrollLeft())}},_rearrange:function(t,e,i,n){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var r=this.counter;this._delay(function(){r===this.counter&&this.refreshPositions(!n)})},_clear:function(t,e){function i(t,e,i){return function(n){i._trigger(t,n,e._uiHash(e))}}this.reverting=!1;var n,r=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(n in this._storedCSS)("auto"===this._storedCSS[n]||"static"===this._storedCSS[n])&&(this._storedCSS[n]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&r.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||r.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(r.push(function(t){this._trigger("remove",t,this._uiHash())}),r.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),n=this.containers.length-1;n>=0;n--)e||r.push(i("deactivate",this,this.containers[n])),this.containers[n].containerCache.over&&(r.push(i("out",this,this.containers[n])),this.containers[n].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!e){for(this._trigger("beforeStop",t,this._uiHash()),n=0;r.length>n;n++)r[n].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!e){for(n=0;r.length>n;n++)r[n].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}})}(jQuery),function(t,e){var i="ui-effects-";t.effects={effect:{}},function(t,e){function i(t,e,i){var n=c[e.type]||{};return null==t?i||!e.def?null:e.def:(t=n.floor?~~t:parseFloat(t),isNaN(t)?e.def:n.mod?(t+n.mod)%n.mod:0>t?0:t>n.max?n.max:t)}function n(i){var n=d(),r=n._rgba=[];return i=i.toLowerCase(),f(l,function(t,a){var o,s=a.re.exec(i),l=s&&a.parse(s),d=a.space||"rgba";return l?(o=n[d](l),n[h[d].cache]=o[h[d].cache],r=n._rgba=o._rgba,!1):e}),r.length?("0,0,0,0"===r.join()&&t.extend(r,a.transparent),n):a[i]}function r(t,e,i){return i=(i+1)%1,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var a,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",s=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],d=t.Color=function(e,i,n,r){return new t.Color.fn.parse(e,i,n,r)},h={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},c={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},u=d.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",u.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(h,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),d.fn=t.extend(d.prototype,{parse:function(r,o,s,l){if(r===e)return this._rgba=[null,null,null,null],this;(r.jquery||r.nodeType)&&(r=t(r).css(o),o=e);var c=this,u=t.type(r),p=this._rgba=[];return o!==e&&(r=[r,o,s,l],u="array"),"string"===u?this.parse(n(r)||a._default):"array"===u?(f(h.rgba.props,function(t,e){p[e.idx]=i(r[e.idx],e)}),this):"object"===u?(r instanceof d?f(h,function(t,e){r[e.cache]&&(c[e.cache]=r[e.cache].slice())}):f(h,function(e,n){var a=n.cache;f(n.props,function(t,e){if(!c[a]&&n.to){if("alpha"===t||null==r[t])return;c[a]=n.to(c._rgba)}c[a][e.idx]=i(r[t],e,!0)}),c[a]&&0>t.inArray(null,c[a].slice(0,3))&&(c[a][3]=1,n.from&&(c._rgba=n.from(c[a])))}),this):e},is:function(t){var i=d(t),n=!0,r=this;return f(h,function(t,a){var o,s=i[a.cache];return s&&(o=r[a.cache]||a.to&&a.to(r._rgba)||[],f(a.props,function(t,i){return null!=s[i.idx]?n=s[i.idx]===o[i.idx]:e})),n}),n},_space:function(){var t=[],e=this;return f(h,function(i,n){e[n.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var n=d(t),r=n._space(),a=h[r],o=0===this.alpha()?d("transparent"):this,s=o[a.cache]||a.to(o._rgba),l=s.slice();return n=n[a.cache],f(a.props,function(t,r){var a=r.idx,o=s[a],d=n[a],h=c[r.type]||{};null!==d&&(null===o?l[a]=d:(h.mod&&(d-o>h.mod/2?o+=h.mod:o-d>h.mod/2&&(o-=h.mod)),l[a]=i((d-o)*e+o,r)))}),this[r](l)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),n=i.pop(),r=d(e)._rgba;return d(t.map(i,function(t,e){return(1-n)*r[e]+n*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),n=i.pop();return e&&i.push(~~(255*n)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),d.fn.parse.prototype=d.fn,h.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,n=t[0]/255,r=t[1]/255,a=t[2]/255,o=t[3],s=Math.max(n,r,a),l=Math.min(n,r,a),d=s-l,h=s+l,c=.5*h;return e=l===s?0:n===s?60*(r-a)/d+360:r===s?60*(a-n)/d+120:60*(n-r)/d+240,i=0===d?0:.5>=c?d/h:d/(2-h),[Math.round(e)%360,i,c,null==o?1:o]},h.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],n=t[2],a=t[3],o=.5>=n?n*(1+i):n+i-n*i,s=2*n-o;return[Math.round(255*r(s,o,e+1/3)),Math.round(255*r(s,o,e)),Math.round(255*r(s,o,e-1/3)),a]},f(h,function(n,r){var a=r.props,o=r.cache,l=r.to,h=r.from;d.fn[n]=function(n){if(l&&!this[o]&&(this[o]=l(this._rgba)),n===e)return this[o].slice();var r,s=t.type(n),c="array"===s||"object"===s?n:arguments,u=this[o].slice();return f(a,function(t,e){var n=c["object"===s?t:e.idx];null==n&&(n=u[e.idx]),u[e.idx]=i(n,e)}),h?(r=d(h(u)),r[o]=u,r):d(u)},f(a,function(e,i){d.fn[e]||(d.fn[e]=function(r){var a,o=t.type(r),l="alpha"===e?this._hsla?"hsla":"rgba":n,d=this[l](),h=d[i.idx];return"undefined"===o?h:("function"===o&&(r=r.call(this,h),o=t.type(r)),null==r&&i.empty?this:("string"===o&&(a=s.exec(r),a&&(r=h+parseFloat(a[2])*("+"===a[1]?1:-1))),d[i.idx]=r,this[l](d)))})})}),d.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,r){var a,o,s="";if("transparent"!==r&&("string"!==t.type(r)||(a=n(r)))){if(r=d(a||r),!u.rgba&&1!==r._rgba[3]){for(o="backgroundColor"===i?e.parentNode:e;(""===s||"transparent"===s)&&o&&o.style;)try{s=t.css(o,"backgroundColor"),o=o.parentNode}catch(t){}r=r.blend(s&&"transparent"!==s?s:"_default")}r=r.toRgbaString()}try{e.style[i]=r}catch(t){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=d(e.elem,i),e.end=d(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},d.hook(o),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,n){e["border"+n+"Color"]=t}),e}},a=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function i(e){var i,n,r=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,a={};if(r&&r.length&&r[0]&&r[r[0]])for(n=r.length;n--;)i=r[n],"string"==typeof r[i]&&(a[t.camelCase(i)]=r[i]);else for(i in r)"string"==typeof r[i]&&(a[i]=r[i]);return a}function n(e,i){var n,r,o={};for(n in i)r=i[n],e[n]!==r&&(a[n]||(t.fx.step[n]||!isNaN(parseFloat(r)))&&(o[n]=r));return o}var r=["add","remove","toggle"],a={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,
borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(jQuery.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(e,a,o,s){var l=t.speed(a,o,s);return this.queue(function(){var a,o=t(this),s=o.attr("class")||"",d=l.children?o.find("*").addBack():o;d=d.map(function(){var e=t(this);return{el:e,start:i(this)}}),a=function(){t.each(r,function(t,i){e[i]&&o[i+"Class"](e[i])})},a(),d=d.map(function(){return this.end=i(this.el[0]),this.diff=n(this.start,this.end),this}),o.attr("class",s),d=d.map(function(){var e=this,i=t.Deferred(),n=t.extend({},l,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,n),i.promise()}),t.when.apply(t,d.get()).done(function(){a(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),l.complete.call(o[0])})})},t.fn.extend({addClass:function(e){return function(i,n,r,a){return n?t.effects.animateClass.call(this,{add:i},n,r,a):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,n,r,a){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},n,r,a):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(i){return function(n,r,a,o,s){return"boolean"==typeof r||r===e?a?t.effects.animateClass.call(this,r?{add:n}:{remove:n},a,o,s):i.apply(this,arguments):t.effects.animateClass.call(this,{toggle:n},r,a,o)}}(t.fn.toggleClass),switchClass:function(e,i,n,r,a){return t.effects.animateClass.call(this,{add:i,remove:e},n,r,a)}})}(),function(){function n(e,i,n,r){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(r=i,n=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(r=n,n=i,i={}),t.isFunction(n)&&(r=n,n=null),i&&t.extend(e,i),n=n||i.duration,e.duration=t.fx.off?0:"number"==typeof n?n:n in t.fx.speeds?t.fx.speeds[n]:t.fx.speeds._default,e.complete=r||i.complete,e}function r(e){return!(e&&"number"!=typeof e&&!t.fx.speeds[e])||("string"==typeof e&&!t.effects.effect[e]||(!!t.isFunction(e)||"object"==typeof e&&!e.effect))}t.extend(t.effects,{version:"1.10.4",save:function(t,e){for(var n=0;e.length>n;n++)null!==e[n]&&t.data(i+e[n],t[0].style[e[n]])},restore:function(t,n){var r,a;for(a=0;n.length>a;a++)null!==n[a]&&(r=t.data(i+n[a]),r===e&&(r=""),t.css(n[a],r))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},getBaseline:function(t,e){var i,n;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":n=0;break;case"center":n=.5;break;case"right":n=1;break;default:n=t[1]/e.width}return{x:n,y:i}},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},n=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),r={width:e.width(),height:e.height()},a=document.activeElement;try{a.id}catch(t){a=document.body}return e.wrap(n),(e[0]===a||t.contains(e[0],a))&&t(a).focus(),n=e.parent(),"static"===e.css("position")?(n.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,n){i[n]=e.css(n),isNaN(parseInt(i[n],10))&&(i[n]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(r),n.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).focus()),e},setTransition:function(e,i,n,r){return r=r||{},t.each(i,function(t,i){var a=e.cssUnit(i);a[0]>0&&(r[i]=a[0]*n+a[1])}),r}}),t.fn.extend({effect:function(){function e(e){function n(){t.isFunction(a)&&a.call(r[0]),t.isFunction(e)&&e()}var r=t(this),a=i.complete,s=i.mode;(r.is(":hidden")?"hide"===s:"show"===s)?(r[s](),n()):o.call(r[0],i,n)}var i=n.apply(this,arguments),r=i.mode,a=i.queue,o=t.effects.effect[i.effect];return t.fx.off||!o?r?this[r](i.duration,i.complete):this.each(function(){i.complete&&i.complete.call(this)}):a===!1?this.each(e):this.queue(a||"fx",e)},show:function(t){return function(e){if(r(e))return t.apply(this,arguments);var i=n.apply(this,arguments);return i.mode="show",this.effect.call(this,i)}}(t.fn.show),hide:function(t){return function(e){if(r(e))return t.apply(this,arguments);var i=n.apply(this,arguments);return i.mode="hide",this.effect.call(this,i)}}(t.fn.hide),toggle:function(t){return function(e){if(r(e)||"boolean"==typeof e)return t.apply(this,arguments);var i=n.apply(this,arguments);return i.mode="toggle",this.effect.call(this,i)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),n=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(n=[parseFloat(i),e])}),n}})}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}()}(jQuery),function(t){var e=0,i={},n={};i.height=i.paddingTop=i.paddingBottom=i.borderTopWidth=i.borderBottomWidth="hide",n.height=n.paddingTop=n.paddingBottom=n.borderTopWidth=n.borderBottomWidth="show",t.widget("ui.accordion",{version:"1.10.4",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),e.collapsible||e.active!==!1&&null!=e.active||(e.active=0),this._processPanels(),0>e.active&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t(),content:this.active.length?this.active.next():t()}},_createIcons:function(){var e=this.options.icons;e&&(t("<span>").addClass("ui-accordion-header-icon ui-icon "+e.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(e.header).addClass(e.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),this._destroyIcons(),t=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){return"active"===t?void this._activate(e):("event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||this.options.active!==!1||this._activate(0),"icons"===t&&(this._destroyIcons(),e&&this._createIcons()),void("disabled"===t&&this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!e)))},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var i=t.ui.keyCode,n=this.headers.length,r=this.headers.index(e.target),a=!1;switch(e.keyCode){case i.RIGHT:case i.DOWN:a=this.headers[(r+1)%n];break;case i.LEFT:case i.UP:a=this.headers[(r-1+n)%n];break;case i.SPACE:case i.ENTER:this._eventHandler(e);break;case i.HOME:a=this.headers[0];break;case i.END:a=this.headers[n-1]}a&&(t(e.target).attr("tabIndex",-1),t(a).attr("tabIndex",0),a.focus(),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().focus()},refresh:function(){var e=this.options;this._processPanels(),e.active===!1&&e.collapsible===!0||!this.headers.length?(e.active=!1,this.active=t()):e.active===!1?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide()},_refresh:function(){var i,n=this.options,r=n.heightStyle,a=this.element.parent(),o=this.accordionId="ui-accordion-"+(this.element.attr("id")||++e);this.active=this._findActive(n.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(e){var i=t(this),n=i.attr("id"),r=i.next(),a=r.attr("id");n||(n=o+"-header-"+e,i.attr("id",n)),a||(a=o+"-panel-"+e,r.attr("id",a)),i.attr("aria-controls",a),r.attr("aria-labelledby",n)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(n.event),"fill"===r?(i=a.height(),this.element.siblings(":visible").each(function(){var e=t(this),n=e.css("position");"absolute"!==n&&"fixed"!==n&&(i-=e.outerHeight(!0))}),this.headers.each(function(){i-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===r&&(i=0,this.headers.next().each(function(){i=Math.max(i,t(this).css("height","").height())}).height(i))},_activate:function(e){var i=this._findActive(e)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var i=this.options,n=this.active,r=t(e.currentTarget),a=r[0]===n[0],o=a&&i.collapsible,s=o?t():r.next(),l=n.next(),d={oldHeader:n,oldPanel:l,newHeader:o?t():r,newPanel:s};e.preventDefault(),a&&!i.collapsible||this._trigger("beforeActivate",e,d)===!1||(i.active=!o&&this.headers.index(r),this.active=a?t():r,this._toggle(d),n.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),a||(r.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&r.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),r.next().addClass("ui-accordion-content-active")))},_toggle:function(e){var i=e.newPanel,n=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=n,this.options.animate?this._animate(i,n,e):(n.hide(),i.show(),this._toggleComplete(e)),n.attr({"aria-hidden":"true"}),n.prev().attr("aria-selected","false"),i.length&&n.length?n.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true",tabIndex:0,"aria-expanded":"true"})},_animate:function(t,e,r){var a,o,s,l=this,d=0,h=t.length&&(!e.length||t.index()<e.index()),c=this.options.animate||{},u=h&&c.down||c,p=function(){l._toggleComplete(r)};return"number"==typeof u&&(s=u),"string"==typeof u&&(o=u),o=o||u.easing||c.easing,s=s||u.duration||c.duration,e.length?t.length?(a=t.show().outerHeight(),e.animate(i,{duration:s,easing:o,step:function(t,e){e.now=Math.round(t)}}),void t.hide().animate(n,{duration:s,easing:o,complete:p,step:function(t,i){i.now=Math.round(t),"height"!==i.prop?d+=i.now:"content"!==l.options.heightStyle&&(i.now=Math.round(a-e.outerHeight()-d),d=0)}})):e.animate(i,s,o,p):t.animate(n,s,o,p)},_toggleComplete:function(t){var e=t.oldPanel;e.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}})}(jQuery),function(t){t.widget("ui.autocomplete",{version:"1.10.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,n,r=this.element[0].nodeName.toLowerCase(),a="textarea"===r,o="input"===r;this.isMultiLine=!!a||!o&&this.element.prop("isContentEditable"),this.valueMethod=this.element[a||o?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(r){if(this.element.prop("readOnly"))return e=!0,n=!0,void(i=!0);e=!1,n=!1,i=!1;var a=t.ui.keyCode;switch(r.keyCode){case a.PAGE_UP:e=!0,this._move("previousPage",r);break;case a.PAGE_DOWN:e=!0,this._move("nextPage",r);break;case a.UP:e=!0,this._keyEvent("previous",r);break;case a.DOWN:e=!0,this._keyEvent("next",r);break;case a.ENTER:case a.NUMPAD_ENTER:this.menu.active&&(e=!0,r.preventDefault(),this.menu.select(r));break;case a.TAB:this.menu.active&&this.menu.select(r);break;case a.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(r),r.preventDefault());break;default:i=!0,this._searchTimeout(r)}},keypress:function(n){if(e)return e=!1,void((!this.isMultiLine||this.menu.element.is(":visible"))&&n.preventDefault());if(!i){var r=t.ui.keyCode;switch(n.keyCode){case r.PAGE_UP:this._move("previousPage",n);break;case r.PAGE_DOWN:this._move("nextPage",n);break;case r.UP:this._keyEvent("previous",n);break;case r.DOWN:this._keyEvent("next",n)}}},input:function(t){return n?(n=!1,void t.preventDefault()):void this._searchTimeout(t)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(t),void this._change(t))}}),this._initSource(),this.menu=t("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];t(e.target).closest(".ui-menu-item").length||this._delay(function(){var e=this;this.document.one("mousedown",function(n){n.target===e.element[0]||n.target===i||t.contains(i,n.target)||e.close()})})},menufocus:function(e,i){if(this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)});var n=i.item.data("ui-autocomplete-item");!1!==this._trigger("focus",e,{item:n})?e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(n.value):this.liveRegion.text(n.value)},menuselect:function(t,e){var i=e.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=i})),!1!==this._trigger("select",t,{item:i})&&this._value(i.value),this.term=this._value(),this.close(t),this.selectedItem=i}}),this.liveRegion=t("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertBefore(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e||(e=this.element.closest(".ui-front")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,n=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,n){n(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,r){n.xhr&&n.xhr.abort(),n.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){r(t)},error:function(){r([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):this._trigger("search",e)!==!1?this._search(t):void 0},_search:function(t){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({label:e.label||e.value,value:e.value||e.label},e)})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var n=this;t.each(i,function(t,i){n._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").append(t("<a>").text(i.label)).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this._value(this.term),void this.menu.blur()):void this.menu[t](e):void this.search(null,e)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var n=RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return n.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(t){var e;this._superApply(arguments),this.options.disabled||this.cancelSearch||(e=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.text(e))}})}(jQuery),function(t){var e,i="ui-button ui-widget ui-state-default ui-corner-all",n="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",r=function(){var e=t(this);setTimeout(function(){e.find(":ui-button").button("refresh")},1)},a=function(e){var i=e.name,n=e.form,r=t([]);return i&&(i=i.replace(/'/g,"\\'"),r=n?t(n).find("[name='"+i+"']"):t("[name='"+i+"']",e.ownerDocument).filter(function(){return!this.form})),r};t.widget("ui.button",{version:"1.10.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,r),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var n=this,o=this.options,s="checkbox"===this.type||"radio"===this.type,l=s?"":"ui-state-active";null===o.label&&(o.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(i).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){o.disabled||this===e&&t(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){o.disabled||t(this).removeClass(l)}).bind("click"+this.eventNamespace,function(t){o.disabled&&(t.preventDefault(),t.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),s&&this.element.bind("change"+this.eventNamespace,function(){n.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return!o.disabled&&void 0}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(o.disabled)return!1;t(this).addClass("ui-state-active"),n.buttonElement.attr("aria-pressed","true");var e=n.element[0];a(e).not(e).map(function(){return t(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return!o.disabled&&(t(this).addClass("ui-state-active"),e=this,void n.document.one("mouseup",function(){e=null}))}).bind("mouseup"+this.eventNamespace,function(){return!o.disabled&&void t(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(e){return!o.disabled&&void((e.keyCode===t.ui.keyCode.SPACE||e.keyCode===t.ui.keyCode.ENTER)&&t(this).addClass("ui-state-active"))}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){t(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(e){e.keyCode===t.ui.keyCode.SPACE&&t(this).click()})),this._setOption("disabled",o.disabled),this._resetButton()},_determineButtonType:function(){var t,e,i;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(t=this.element.parents().last(),e="label[for='"+this.element.attr("id")+"']",this.buttonElement=t.find(e),this.buttonElement.length||(t=t.length?t.siblings():this.element.siblings(),this.buttonElement=t.filter(e),this.buttonElement.length||(this.buttonElement=t.find(e))),this.element.addClass("ui-helper-hidden-accessible"),i=this.element.is(":checked"),i&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(i+" ui-state-active "+n).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(t,e){return this._super(t,e),"disabled"===t?(this.element.prop("disabled",!!e),void(e&&this.buttonElement.removeClass("ui-state-focus"))):void this._resetButton()},refresh:function(){var e=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");e!==this.options.disabled&&this._setOption("disabled",e),"radio"===this.type?a(this.element[0]).each(function(){t(this).is(":checked")?t(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):t(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return void(this.options.label&&this.element.val(this.options.label));var e=this.buttonElement.removeClass(n),i=t("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(e.empty()).text(),r=this.options.icons,a=r.primary&&r.secondary,o=[];r.primary||r.secondary?(this.options.text&&o.push("ui-button-text-icon"+(a?"s":r.primary?"-primary":"-secondary")),r.primary&&e.prepend("<span class='ui-button-icon-primary ui-icon "+r.primary+"'></span>"),r.secondary&&e.append("<span class='ui-button-icon-secondary ui-icon "+r.secondary+"'></span>"),this.options.text||(o.push(a?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||e.attr("title",t.trim(i)))):o.push("ui-button-text-only"),e.addClass(o.join(" "))}}),t.widget("ui.buttonset",{version:"1.10.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(t,e){"disabled"===t&&this.buttons.button("option",t,e),this._super(t,e)},refresh:function(){var e="rtl"===this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return t(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(e?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(e?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return t(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(jQuery),function(t,e){function i(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.dpDiv=n(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function n(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.delegate(i,"mouseout",function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",function(){t.datepicker._isDisabledDatepicker(a.inline?e.parent()[0]:a.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))})}function r(e,i){t.extend(e,i);for(var n in i)null==i[n]&&(e[n]=i[n]);return e}t.extend(t.ui,{datepicker:{version:"1.10.4"}});var a,o="datepicker";t.extend(i.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return r(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var n,r,a;n=e.nodeName.toLowerCase(),r="div"===n||"span"===n,e.id||(this.uuid+=1,e.id="dp"+this.uuid),a=this._newInst(t(e),r),a.settings=t.extend({},i||{}),"input"===n?this._connectDatepicker(e,a):r&&this._inlineDatepicker(e,a)},_newInst:function(e,i){var r=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:r,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?n(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var n=t(e);i.append=t([]),i.trigger=t([]),n.hasClass(this.markerClassName)||(this._attachments(n,i),n.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),t.data(e,o,i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var n,r,a,o=this._get(i,"appendText"),s=this._get(i,"isRTL");i.append&&i.append.remove(),o&&(i.append=t("<span class='"+this._appendClass+"'>"+o+"</span>"),e[s?"before":"after"](i.append)),e.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),n=this._get(i,"showOn"),("focus"===n||"both"===n)&&e.focus(this._showDatepicker),("button"===n||"both"===n)&&(r=this._get(i,"buttonText"),a=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({
src:a,alt:r,title:r}):t("<button type='button'></button>").addClass(this._triggerClass).html(a?t("<img/>").attr({src:a,alt:r,title:r}):r)),e[s?"before":"after"](i.trigger),i.trigger.click(function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,i,n,r,a=new Date(2009,11,20),o=this._get(t,"dateFormat");o.match(/[DM]/)&&(e=function(t){for(i=0,n=0,r=0;t.length>r;r++)t[r].length>i&&(i=t[r].length,n=r);return n},a.setMonth(e(this._get(t,o.match(/MM/)?"monthNames":"monthNamesShort"))),a.setDate(e(this._get(t,o.match(/DD/)?"dayNames":"dayNamesShort"))+20-a.getDay())),t.input.attr("size",this._formatDate(t,a).length)}},_inlineDatepicker:function(e,i){var n=t(e);n.hasClass(this.markerClassName)||(n.addClass(this.markerClassName).append(i.dpDiv),t.data(e,o,i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,n,a,s){var l,d,h,c,u,p=this._dialogInst;return p||(this.uuid+=1,l="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+l+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),t("body").append(this._dialogInput),p=this._dialogInst=this._newInst(this._dialogInput,!1),p.settings={},t.data(this._dialogInput[0],o,p)),r(p.settings,a||{}),i=i&&i.constructor===Date?this._formatDate(p,i):i,this._dialogInput.val(i),this._pos=s?s.length?s:[s.pageX,s.pageY]:null,this._pos||(d=document.documentElement.clientWidth,h=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[d/2-100+c,h/2-150+u]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),p.settings.onSelect=n,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],o,p),this},_destroyDatepicker:function(e){var i,n=t(e),r=t.data(e,o);n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,o),"input"===i?(r.append.remove(),r.trigger.remove(),n.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===i||"span"===i)&&n.removeClass(this.markerClassName).empty())},_enableDatepicker:function(e){var i,n,r=t(e),a=t.data(e,o);r.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!1,a.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(n=r.children("."+this._inlineClass),n.children().removeClass("ui-state-disabled"),n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,n,r=t(e),a=t.data(e,o);r.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!0,a.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(n=r.children("."+this._inlineClass),n.children().addClass("ui-state-disabled"),n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,o)}catch(t){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(i,n,a){var o,s,l,d,h=this._getInst(i);return 2===arguments.length&&"string"==typeof n?"defaults"===n?t.extend({},t.datepicker._defaults):h?"all"===n?t.extend({},h.settings):this._get(h,n):null:(o=n||{},"string"==typeof n&&(o={},o[n]=a),h&&(this._curInst===h&&this._hideDatepicker(),s=this._getDateDatepicker(i,!0),l=this._getMinMaxDate(h,"min"),d=this._getMinMaxDate(h,"max"),r(h.settings,o),null!==l&&o.dateFormat!==e&&o.minDate===e&&(h.settings.minDate=this._formatDate(h,l)),null!==d&&o.dateFormat!==e&&o.maxDate===e&&(h.settings.maxDate=this._formatDate(h,d)),"disabled"in o&&(o.disabled?this._disableDatepicker(i):this._enableDatepicker(i)),this._attachments(t(i),h),this._autoSize(h),this._setDate(h,s),this._updateAlternate(h),this._updateDatepicker(h)),e)},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,n,r,a=t.datepicker._getInst(e.target),o=!0,s=a.dpDiv.is(".ui-datepicker-rtl");if(a._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),o=!1;break;case 13:return r=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",a.dpDiv),r[0]&&t.datepicker._selectDay(e.target,a.selectedMonth,a.selectedYear,r[0]),i=t.datepicker._get(a,"onSelect"),i?(n=t.datepicker._formatDate(a),i.apply(a.input?a.input[0]:null,[n,a])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(a,"stepBigMonths"):-t.datepicker._get(a,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(a,"stepBigMonths"):+t.datepicker._get(a,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),o=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),o=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,s?1:-1,"D"),o=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(a,"stepBigMonths"):-t.datepicker._get(a,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),o=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,s?-1:1,"D"),o=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(a,"stepBigMonths"):+t.datepicker._get(a,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),o=e.ctrlKey||e.metaKey;break;default:o=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):o=!1;o&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(i){var n,r,a=t.datepicker._getInst(i.target);return t.datepicker._get(a,"constrainInput")?(n=t.datepicker._possibleChars(t.datepicker._get(a,"dateFormat")),r=String.fromCharCode(null==i.charCode?i.keyCode:i.charCode),i.ctrlKey||i.metaKey||" ">r||!n||n.indexOf(r)>-1):e},_doKeyUp:function(e){var i,n=t.datepicker._getInst(e.target);if(n.input.val()!==n.lastVal)try{i=t.datepicker.parseDate(t.datepicker._get(n,"dateFormat"),n.input?n.input.val():null,t.datepicker._getFormatConfig(n)),i&&(t.datepicker._setDateFromField(n),t.datepicker._updateAlternate(n),t.datepicker._updateDatepicker(n))}catch(t){}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!==e.nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var i,n,a,o,s,l,d;i=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==i&&(t.datepicker._curInst.dpDiv.stop(!0,!0),i&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),n=t.datepicker._get(i,"beforeShow"),a=n?n.apply(e,[e,i]):{},a!==!1&&(r(i.settings,a),i.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(i),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),o=!1,t(e).parents().each(function(){return o|="fixed"===t(this).css("position"),!o}),s={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(i),s=t.datepicker._checkOffset(i,s,o),i.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":o?"fixed":"absolute",display:"none",left:s.left+"px",top:s.top+"px"}),i.inline||(l=t.datepicker._get(i,"showAnim"),d=t.datepicker._get(i,"duration"),i.dpDiv.zIndex(t(e).zIndex()+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[l]?i.dpDiv.show(l,t.datepicker._get(i,"showOptions"),d):i.dpDiv[l||"show"](l?d:null),t.datepicker._shouldFocusInput(i)&&i.input.focus(),t.datepicker._curInst=i))}},_updateDatepicker:function(e){this.maxRows=4,a=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e),e.dpDiv.find("."+this._dayOverClass+" a").mouseover();var i,n=this._getNumberOfMonths(e),r=n[1],o=17;e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),r>1&&e.dpDiv.addClass("ui-datepicker-multi-"+r).css("width",o*r+"em"),e.dpDiv[(1!==n[0]||1!==n[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.focus(),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,n){var r=e.dpDiv.outerWidth(),a=e.dpDiv.outerHeight(),o=e.input?e.input.outerWidth():0,s=e.input?e.input.outerHeight():0,l=document.documentElement.clientWidth+(n?0:t(document).scrollLeft()),d=document.documentElement.clientHeight+(n?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?r-o:0,i.left-=n&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=n&&i.top===e.input.offset().top+s?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+r>l&&l>r?Math.abs(i.left+r-l):0),i.top-=Math.min(i.top,i.top+a>d&&d>a?Math.abs(a+s):0),i},_findPos:function(e){for(var i,n=this._getInst(e),r=this._get(n,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[r?"previousSibling":"nextSibling"];return i=t(e).offset(),[i.left,i.top]},_hideDatepicker:function(e){var i,n,r,a,s=this._curInst;!s||e&&s!==t.data(e,o)||this._datepickerShowing&&(i=this._get(s,"showAnim"),n=this._get(s,"duration"),r=function(){t.datepicker._tidyDialog(s)},t.effects&&(t.effects.effect[i]||t.effects[i])?s.dpDiv.hide(i,t.datepicker._get(s,"showOptions"),n,r):s.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?n:null,r),i||r(),this._datepickerShowing=!1,a=this._get(s,"onClose"),a&&a.apply(s.input?s.input[0]:null,[s.input?s.input.val():"",s]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var i=t(e.target),n=t.datepicker._getInst(i[0]);(i[0].id!==t.datepicker._mainDivId&&0===i.parents("#"+t.datepicker._mainDivId).length&&!i.hasClass(t.datepicker.markerClassName)&&!i.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||i.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==n)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,n){var r=t(e),a=this._getInst(r[0]);this._isDisabledDatepicker(r[0])||(this._adjustInstDate(a,i+("M"===n?this._get(a,"showCurrentAtPos"):0),n),this._updateDatepicker(a))},_gotoToday:function(e){var i,n=t(e),r=this._getInst(n[0]);this._get(r,"gotoCurrent")&&r.currentDay?(r.selectedDay=r.currentDay,r.drawMonth=r.selectedMonth=r.currentMonth,r.drawYear=r.selectedYear=r.currentYear):(i=new Date,r.selectedDay=i.getDate(),r.drawMonth=r.selectedMonth=i.getMonth(),r.drawYear=r.selectedYear=i.getFullYear()),this._notifyChange(r),this._adjustDate(n)},_selectMonthYear:function(e,i,n){var r=t(e),a=this._getInst(r[0]);a["selected"+("M"===n?"Month":"Year")]=a["draw"+("M"===n?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(a),this._adjustDate(r)},_selectDay:function(e,i,n,r){var a,o=t(e);t(r).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0])||(a=this._getInst(o[0]),a.selectedDay=a.currentDay=t("a",r).html(),a.selectedMonth=a.currentMonth=i,a.selectedYear=a.currentYear=n,this._selectDate(e,this._formatDate(a,a.currentDay,a.currentMonth,a.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var n,r=t(e),a=this._getInst(r[0]);i=null!=i?i:this._formatDate(a),a.input&&a.input.val(i),this._updateAlternate(a),n=this._get(a,"onSelect"),n?n.apply(a.input?a.input[0]:null,[i,a]):a.input&&a.input.trigger("change"),a.inline?this._updateDatepicker(a):(this._hideDatepicker(),this._lastInput=a.input[0],"object"!=typeof a.input[0]&&a.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var i,n,r,a=this._get(e,"altField");a&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),n=this._getDate(e),r=this.formatDate(i,n,this._getFormatConfig(e)),t(a).each(function(){t(this).val(r)}))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(i,n,r){if(null==i||null==n)throw"Invalid arguments";if(n="object"==typeof n?""+n:n+"",""===n)return null;var a,o,s,l,d=0,h=(r?r.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof h?h:(new Date).getFullYear()%100+parseInt(h,10),u=(r?r.dayNamesShort:null)||this._defaults.dayNamesShort,p=(r?r.dayNames:null)||this._defaults.dayNames,f=(r?r.monthNamesShort:null)||this._defaults.monthNamesShort,m=(r?r.monthNames:null)||this._defaults.monthNames,g=-1,_=-1,y=-1,v=-1,b=!1,w=function(t){var e=i.length>a+1&&i.charAt(a+1)===t;return e&&a++,e},x=function(t){var e=w(t),i="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,r=RegExp("^\\d{1,"+i+"}"),a=n.substring(d).match(r);if(!a)throw"Missing number at position "+d;return d+=a[0].length,parseInt(a[0],10)},k=function(i,r,a){var o=-1,s=t.map(w(i)?a:r,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(s,function(t,i){var r=i[1];return n.substr(d,r.length).toLowerCase()===r.toLowerCase()?(o=i[0],d+=r.length,!1):e}),-1!==o)return o+1;throw"Unknown name at position "+d},L=function(){if(n.charAt(d)!==i.charAt(a))throw"Unexpected literal at position "+d;d++};for(a=0;i.length>a;a++)if(b)"'"!==i.charAt(a)||w("'")?L():b=!1;else switch(i.charAt(a)){case"d":y=x("d");break;case"D":k("D",u,p);break;case"o":v=x("o");break;case"m":_=x("m");break;case"M":_=k("M",f,m);break;case"y":g=x("y");break;case"@":l=new Date(x("@")),g=l.getFullYear(),_=l.getMonth()+1,y=l.getDate();break;case"!":l=new Date((x("!")-this._ticksTo1970)/1e4),g=l.getFullYear(),_=l.getMonth()+1,y=l.getDate();break;case"'":w("'")?L():b=!0;break;default:L()}if(n.length>d&&(s=n.substr(d),!/^\s+/.test(s)))throw"Extra/unparsed characters found in date: "+s;if(-1===g?g=(new Date).getFullYear():100>g&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(c>=g?0:-100)),v>-1)for(_=1,y=v;o=this._getDaysInMonth(g,_-1),!(o>=y);)_++,y-=o;if(l=this._daylightSavingAdjust(new Date(g,_-1,y)),l.getFullYear()!==g||l.getMonth()+1!==_||l.getDate()!==y)throw"Invalid date";return l},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:864e9*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,i){if(!e)return"";var n,r=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,a=(i?i.dayNames:null)||this._defaults.dayNames,o=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,s=(i?i.monthNames:null)||this._defaults.monthNames,l=function(e){var i=t.length>n+1&&t.charAt(n+1)===e;return i&&n++,i},d=function(t,e,i){var n=""+e;if(l(t))for(;i>n.length;)n="0"+n;return n},h=function(t,e,i,n){return l(t)?n[e]:i[e]},c="",u=!1;if(e)for(n=0;t.length>n;n++)if(u)"'"!==t.charAt(n)||l("'")?c+=t.charAt(n):u=!1;else switch(t.charAt(n)){case"d":c+=d("d",e.getDate(),2);break;case"D":c+=h("D",e.getDay(),r,a);break;case"o":c+=d("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":c+=d("m",e.getMonth()+1,2);break;case"M":c+=h("M",e.getMonth(),o,s);break;case"y":c+=l("y")?e.getFullYear():(10>e.getYear()%100?"0":"")+e.getYear()%100;break;case"@":c+=e.getTime();break;case"!":c+=1e4*e.getTime()+this._ticksTo1970;break;case"'":l("'")?c+="'":u=!0;break;default:c+=t.charAt(n)}return c},_possibleChars:function(t){var e,i="",n=!1,r=function(i){var n=t.length>e+1&&t.charAt(e+1)===i;return n&&e++,n};for(e=0;t.length>e;e++)if(n)"'"!==t.charAt(e)||r("'")?i+=t.charAt(e):n=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":r("'")?i+="'":n=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,i){return t.settings[i]!==e?t.settings[i]:this._defaults[i]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),n=t.lastVal=t.input?t.input.val():null,r=this._getDefaultDate(t),a=r,o=this._getFormatConfig(t);try{a=this.parseDate(i,n,o)||r}catch(t){n=e?"":n}t.selectedDay=a.getDate(),t.drawMonth=t.selectedMonth=a.getMonth(),t.drawYear=t.selectedYear=a.getFullYear(),t.currentDay=n?a.getDate():0,t.currentMonth=n?a.getMonth():0,t.currentYear=n?a.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,n){var r=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},a=function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(t){}for(var n=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,r=n.getFullYear(),a=n.getMonth(),o=n.getDate(),s=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=s.exec(i);l;){switch(l[2]||"d"){case"d":case"D":o+=parseInt(l[1],10);break;case"w":case"W":o+=7*parseInt(l[1],10);break;case"m":case"M":a+=parseInt(l[1],10),o=Math.min(o,t.datepicker._getDaysInMonth(r,a));break;case"y":case"Y":r+=parseInt(l[1],10),o=Math.min(o,t.datepicker._getDaysInMonth(r,a))}l=s.exec(i)}return new Date(r,a,o)},o=null==i||""===i?n:"string"==typeof i?a(i):"number"==typeof i?isNaN(i)?n:r(i):new Date(i.getTime());return o=o&&"Invalid Date"==""+o?n:o,o&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var n=!e,r=t.selectedMonth,a=t.selectedYear,o=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=o.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=o.getMonth(),t.drawYear=t.selectedYear=t.currentYear=o.getFullYear(),r===t.selectedMonth&&a===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(n?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),n="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(n,-i,"M")},next:function(){t.datepicker._adjustDate(n,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(n)},selectDay:function(){return t.datepicker._selectDay(n,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(n,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(n,this,"Y"),!1}};t(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,i,n,r,a,o,s,l,d,h,c,u,p,f,m,g,_,y,v,b,w,x,k,L,C,T,$,M,P,D,S,I,E,U,O,j,A,z,B,R=new Date,F=this._daylightSavingAdjust(new Date(R.getFullYear(),R.getMonth(),R.getDate())),N=this._get(t,"isRTL"),H=this._get(t,"showButtonPanel"),q=this._get(t,"hideIfNoPrevNext"),G=this._get(t,"navigationAsDateFormat"),W=this._getNumberOfMonths(t),Z=this._get(t,"showCurrentAtPos"),V=this._get(t,"stepMonths"),Y=1!==W[0]||1!==W[1],X=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),K=this._getMinMaxDate(t,"min"),Q=this._getMinMaxDate(t,"max"),J=t.drawMonth-Z,tt=t.drawYear;if(0>J&&(J+=12,tt--),Q)for(e=this._daylightSavingAdjust(new Date(Q.getFullYear(),Q.getMonth()-W[0]*W[1]+1,Q.getDate())),e=K&&K>e?K:e;this._daylightSavingAdjust(new Date(tt,J,1))>e;)J--,0>J&&(J=11,tt--);for(t.drawMonth=J,t.drawYear=tt,i=this._get(t,"prevText"),i=G?this.formatDate(i,this._daylightSavingAdjust(new Date(tt,J-V,1)),this._getFormatConfig(t)):i,n=this._canAdjustMonth(t,-1,tt,J)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(N?"e":"w")+"'>"+i+"</span></a>":q?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(N?"e":"w")+"'>"+i+"</span></a>",r=this._get(t,"nextText"),r=G?this.formatDate(r,this._daylightSavingAdjust(new Date(tt,J+V,1)),this._getFormatConfig(t)):r,a=this._canAdjustMonth(t,1,tt,J)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+r+"'><span class='ui-icon ui-icon-circle-triangle-"+(N?"w":"e")+"'>"+r+"</span></a>":q?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+r+"'><span class='ui-icon ui-icon-circle-triangle-"+(N?"w":"e")+"'>"+r+"</span></a>",o=this._get(t,"currentText"),s=this._get(t,"gotoCurrent")&&t.currentDay?X:F,o=G?this.formatDate(o,s,this._getFormatConfig(t)):o,l=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",d=H?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(N?l:"")+(this._isInRange(t,s)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+o+"</button>":"")+(N?"":l)+"</div>":"",h=parseInt(this._get(t,"firstDay"),10),h=isNaN(h)?0:h,c=this._get(t,"showWeek"),u=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),m=this._get(t,"monthNamesShort"),g=this._get(t,"beforeShowDay"),_=this._get(t,"showOtherMonths"),y=this._get(t,"selectOtherMonths"),v=this._getDefaultDate(t),b="",x=0;W[0]>x;x++){for(k="",this.maxRows=4,L=0;W[1]>L;L++){if(C=this._daylightSavingAdjust(new Date(tt,J,t.selectedDay)),T=" ui-corner-all",$="",Y){if($+="<div class='ui-datepicker-group",W[1]>1)switch(L){case 0:$+=" ui-datepicker-group-first",T=" ui-corner-"+(N?"right":"left");break;case W[1]-1:$+=" ui-datepicker-group-last",T=" ui-corner-"+(N?"left":"right");break;default:$+=" ui-datepicker-group-middle",T=""}$+="'>"}for($+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+T+"'>"+(/all|left/.test(T)&&0===x?N?a:n:"")+(/all|right/.test(T)&&0===x?N?n:a:"")+this._generateMonthYearHeader(t,J,tt,K,Q,x>0||L>0,f,m)+"</div><table class='ui-datepicker-calendar'><thead><tr>",M=c?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",w=0;7>w;w++)P=(w+h)%7,M+="<th"+((w+h+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+u[P]+"'>"+p[P]+"</span></th>";for($+=M+"</tr></thead><tbody>",D=this._getDaysInMonth(tt,J),tt===t.selectedYear&&J===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,D)),S=(this._getFirstDayOfMonth(tt,J)-h+7)%7,I=Math.ceil((S+D)/7),E=Y&&this.maxRows>I?this.maxRows:I,this.maxRows=E,U=this._daylightSavingAdjust(new Date(tt,J,1-S)),O=0;E>O;O++){for($+="<tr>",j=c?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(U)+"</td>":"",w=0;7>w;w++)A=g?g.apply(t.input?t.input[0]:null,[U]):[!0,""],z=U.getMonth()!==J,B=z&&!y||!A[0]||K&&K>U||Q&&U>Q,j+="<td class='"+((w+h+6)%7>=5?" ui-datepicker-week-end":"")+(z?" ui-datepicker-other-month":"")+(U.getTime()===C.getTime()&&J===t.selectedMonth&&t._keyEvent||v.getTime()===U.getTime()&&v.getTime()===C.getTime()?" "+this._dayOverClass:"")+(B?" "+this._unselectableClass+" ui-state-disabled":"")+(z&&!_?"":" "+A[1]+(U.getTime()===X.getTime()?" "+this._currentClass:"")+(U.getTime()===F.getTime()?" ui-datepicker-today":""))+"'"+(z&&!_||!A[2]?"":" title='"+A[2].replace(/'/g,"&#39;")+"'")+(B?"":" data-handler='selectDay' data-event='click' data-month='"+U.getMonth()+"' data-year='"+U.getFullYear()+"'")+">"+(z&&!_?"&#xa0;":B?"<span class='ui-state-default'>"+U.getDate()+"</span>":"<a class='ui-state-default"+(U.getTime()===F.getTime()?" ui-state-highlight":"")+(U.getTime()===X.getTime()?" ui-state-active":"")+(z?" ui-priority-secondary":"")+"' href='#'>"+U.getDate()+"</a>")+"</td>",U.setDate(U.getDate()+1),U=this._daylightSavingAdjust(U);$+=j+"</tr>"}J++,J>11&&(J=0,tt++),$+="</tbody></table>"+(Y?"</div>"+(W[0]>0&&L===W[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),k+=$}b+=k}return b+=d,t._keyEvent=!1,b},_generateMonthYearHeader:function(t,e,i,n,r,a,o,s){var l,d,h,c,u,p,f,m,g=this._get(t,"changeMonth"),_=this._get(t,"changeYear"),y=this._get(t,"showMonthAfterYear"),v="<div class='ui-datepicker-title'>",b="";if(a||!g)b+="<span class='ui-datepicker-month'>"+o[e]+"</span>";else{for(l=n&&n.getFullYear()===i,d=r&&r.getFullYear()===i,b+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",h=0;12>h;h++)(!l||h>=n.getMonth())&&(!d||r.getMonth()>=h)&&(b+="<option value='"+h+"'"+(h===e?" selected='selected'":"")+">"+s[h]+"</option>");b+="</select>"}if(y||(v+=b+(!a&&g&&_?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",a||!_)v+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(c=this._get(t,"yearRange").split(":"),u=(new Date).getFullYear(),p=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?u+parseInt(t,10):parseInt(t,10);return isNaN(e)?u:e},f=p(c[0]),m=Math.max(f,p(c[1]||"")),f=n?Math.max(f,n.getFullYear()):f,m=r?Math.min(m,r.getFullYear()):m,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";m>=f;f++)t.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";t.yearshtml+="</select>",v+=t.yearshtml,t.yearshtml=null}return v+=this._get(t,"yearSuffix"),y&&(v+=(!a&&g&&_?"":"&#xa0;")+b),v+="</div>"},_adjustInstDate:function(t,e,i){var n=t.drawYear+("Y"===i?e:0),r=t.drawMonth+("M"===i?e:0),a=Math.min(t.selectedDay,this._getDaysInMonth(n,r))+("D"===i?e:0),o=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(n,r,a)));t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),n=this._getMinMaxDate(t,"max"),r=i&&i>e?i:e;return n&&r>n?n:r},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,n){var r=this._getNumberOfMonths(t),a=this._daylightSavingAdjust(new Date(i,n+(0>e?e:r[0]*r[1]),1));return 0>e&&a.setDate(this._getDaysInMonth(a.getFullYear(),a.getMonth())),this._isInRange(t,a)},_isInRange:function(t,e){var i,n,r=this._getMinMaxDate(t,"min"),a=this._getMinMaxDate(t,"max"),o=null,s=null,l=this._get(t,"yearRange");return l&&(i=l.split(":"),n=(new Date).getFullYear(),o=parseInt(i[0],10),s=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(o+=n),i[1].match(/[+\-].*/)&&(s+=n)),(!r||e.getTime()>=r.getTime())&&(!a||e.getTime()<=a.getTime())&&(!o||e.getFullYear()>=o)&&(!s||s>=e.getFullYear())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,n){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var r=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(n,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),r,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).mousedown(t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new i,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.10.4"}(jQuery),function(t){var e={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},i={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};t.widget("ui.dialog",{version:"1.10.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0);
},_destroy:function(){var t,e=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),t=e.parent.children().eq(e.index),t.length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},disable:t.noop,enable:t.noop,close:function(e){var i,n=this;if(this._isOpen&&this._trigger("beforeClose",e)!==!1){if(this._isOpen=!1,this._destroyOverlay(),!this.opener.filter(":focusable").focus().length)try{i=this.document[0].activeElement,i&&"body"!==i.nodeName.toLowerCase()&&t(i).blur()}catch(t){}this._hide(this.uiDialog,this.options.hide,function(){n._trigger("close",e)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,e){var i=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;return i&&!e&&this._trigger("focus",t),i},open:function(){var e=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=t(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),void this._trigger("open"))},_focusTabbable:function(){var t=this.element.find("[autofocus]");t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).focus()},_keepFocus:function(e){function i(){var e=this.document[0].activeElement,i=this.uiDialog[0]===e||t.contains(this.uiDialog[0],e);i||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),void this.close(e);if(e.keyCode===t.ui.keyCode.TAB){var i=this.uiDialog.find(":tabbable"),n=i.filter(":first"),r=i.filter(":last");e.target!==r[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==n[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(r.focus(1),e.preventDefault()):(n.focus(1),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(e),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title||t.html("&#160;"),t.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?void this.uiDialog.removeClass("ui-dialog-buttons"):(t.each(i,function(i,n){var r,a;n=t.isFunction(n)?{click:n,text:i}:n,n=t.extend({type:"button"},n),r=n.click,n.click=function(){r.apply(e.element[0],arguments)},a={icons:n.icons,text:n.showText},delete n.icons,delete n.showText,t("<button></button>",n).button(a).appendTo(e.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,n=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(n,r){t(this).addClass("ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",n,e(r))},drag:function(t,n){i._trigger("drag",t,e(n))},stop:function(r,a){n.position=[a.position.left-i.document.scrollLeft(),a.position.top-i.document.scrollTop()],t(this).removeClass("ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",r,e(a))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,n=this.options,r=n.resizable,a=this.uiDialog.css("position"),o="string"==typeof r?r:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:n.maxWidth,maxHeight:n.maxHeight,minWidth:n.minWidth,minHeight:this._minHeight(),handles:o,start:function(n,r){t(this).addClass("ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",n,e(r))},resize:function(t,n){i._trigger("resize",t,e(n))},stop:function(r,a){n.height=t(this).height(),n.width=t(this).width(),t(this).removeClass("ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",r,e(a))}}).css("position",a)},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(n){var r=this,a=!1,o={};t.each(n,function(t,n){r._setOption(t,n),t in e&&(a=!0),t in i&&(o[t]=n)}),a&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",o)},_setOption:function(t,e){var i,n,r=this.uiDialog;"dialogClass"===t&&r.removeClass(this.options.dialogClass).addClass(e),"disabled"!==t&&(this._super(t,e),"appendTo"===t&&this.uiDialog.appendTo(this._appendTo()),"buttons"===t&&this._createButtons(),"closeText"===t&&this.uiDialogTitlebarClose.button({label:""+e}),"draggable"===t&&(i=r.is(":data(ui-draggable)"),i&&!e&&r.draggable("destroy"),!i&&e&&this._makeDraggable()),"position"===t&&this._position(),"resizable"===t&&(n=r.is(":data(ui-resizable)"),n&&!e&&r.resizable("destroy"),n&&"string"==typeof e&&r.resizable("option","handles",e),n||e===!1||this._makeResizable()),"title"===t&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,n=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),n.minWidth>n.width&&(n.width=n.minWidth),t=this.uiDialog.css({height:"auto",width:n.width}).outerHeight(),e=Math.max(0,n.minHeight-t),i="number"==typeof n.maxHeight?Math.max(0,n.maxHeight-t):"none","auto"===n.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,n.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return!!t(e.target).closest(".ui-dialog").length||!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=this,i=this.widgetFullName;t.ui.dialog.overlayInstances||this._delay(function(){t.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",function(n){e._allowInteraction(n)||(n.preventDefault(),t(".ui-dialog:visible:last .ui-dialog-content").data(i)._focusTabbable())})}),this.overlay=t("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),t.ui.dialog.overlayInstances++}},_destroyOverlay:function(){this.options.modal&&this.overlay&&(t.ui.dialog.overlayInstances--,t.ui.dialog.overlayInstances||this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}}),t.ui.dialog.overlayInstances=0,t.uiBackCompat!==!1&&t.widget("ui.dialog",t.ui.dialog,{_position:function(){var e,i=this.options.position,n=[],r=[0,0];i?(("string"==typeof i||"object"==typeof i&&"0"in i)&&(n=i.split?i.split(" "):[i[0],i[1]],1===n.length&&(n[1]=n[0]),t.each(["left","top"],function(t,e){+n[t]===n[t]&&(r[t]=n[t],n[t]=e)}),i={my:n[0]+(0>r[0]?r[0]:"+"+r[0])+" "+n[1]+(0>r[1]?r[1]:"+"+r[1]),at:n.join(" ")}),i=t.extend({},t.ui.dialog.prototype.options.position,i)):i=t.ui.dialog.prototype.options.position,e=this.uiDialog.is(":visible"),e||this.uiDialog.show(),this.uiDialog.position(i),e||this.uiDialog.hide()}})}(jQuery),function(t){var e=/up|down|vertical/,i=/up|left|vertical|horizontal/;t.effects.effect.blind=function(n,r){var a,o,s,l=t(this),d=["position","top","bottom","left","right","height","width"],h=t.effects.setMode(l,n.mode||"hide"),c=n.direction||"up",u=e.test(c),p=u?"height":"width",f=u?"top":"left",m=i.test(c),g={},_="show"===h;l.parent().is(".ui-effects-wrapper")?t.effects.save(l.parent(),d):t.effects.save(l,d),l.show(),a=t.effects.createWrapper(l).css({overflow:"hidden"}),o=a[p](),s=parseFloat(a.css(f))||0,g[p]=_?o:0,m||(l.css(u?"bottom":"right",0).css(u?"top":"left","auto").css({position:"absolute"}),g[f]=_?s:o+s),_&&(a.css(p,0),m||a.css(f,s+o)),a.animate(g,{duration:n.duration,easing:n.easing,queue:!1,complete:function(){"hide"===h&&l.hide(),t.effects.restore(l,d),t.effects.removeWrapper(l),r()}})}}(jQuery),function(t){t.effects.effect.bounce=function(e,i){var n,r,a,o=t(this),s=["position","top","bottom","left","right","height","width"],l=t.effects.setMode(o,e.mode||"effect"),d="hide"===l,h="show"===l,c=e.direction||"up",u=e.distance,p=e.times||5,f=2*p+(h||d?1:0),m=e.duration/f,g=e.easing,_="up"===c||"down"===c?"top":"left",y="up"===c||"left"===c,v=o.queue(),b=v.length;for((h||d)&&s.push("opacity"),t.effects.save(o,s),o.show(),t.effects.createWrapper(o),u||(u=o["top"===_?"outerHeight":"outerWidth"]()/3),h&&(a={opacity:1},a[_]=0,o.css("opacity",0).css(_,y?2*-u:2*u).animate(a,m,g)),d&&(u/=Math.pow(2,p-1)),a={},a[_]=0,n=0;p>n;n++)r={},r[_]=(y?"-=":"+=")+u,o.animate(r,m,g).animate(a,m,g),u=d?2*u:u/2;d&&(r={opacity:0},r[_]=(y?"-=":"+=")+u,o.animate(r,m,g)),o.queue(function(){d&&o.hide(),t.effects.restore(o,s),t.effects.removeWrapper(o),i()}),b>1&&v.splice.apply(v,[1,0].concat(v.splice(b,f+1))),o.dequeue()}}(jQuery),function(t){t.effects.effect.clip=function(e,i){var n,r,a,o=t(this),s=["position","top","bottom","left","right","height","width"],l=t.effects.setMode(o,e.mode||"hide"),d="show"===l,h=e.direction||"vertical",c="vertical"===h,u=c?"height":"width",p=c?"top":"left",f={};t.effects.save(o,s),o.show(),n=t.effects.createWrapper(o).css({overflow:"hidden"}),r="IMG"===o[0].tagName?n:o,a=r[u](),d&&(r.css(u,0),r.css(p,a/2)),f[u]=d?a:0,f[p]=d?0:a/2,r.animate(f,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){d||o.hide(),t.effects.restore(o,s),t.effects.removeWrapper(o),i()}})}}(jQuery),function(t){t.effects.effect.drop=function(e,i){var n,r=t(this),a=["position","top","bottom","left","right","opacity","height","width"],o=t.effects.setMode(r,e.mode||"hide"),s="show"===o,l=e.direction||"left",d="up"===l||"down"===l?"top":"left",h="up"===l||"left"===l?"pos":"neg",c={opacity:s?1:0};t.effects.save(r,a),r.show(),t.effects.createWrapper(r),n=e.distance||r["top"===d?"outerHeight":"outerWidth"](!0)/2,s&&r.css("opacity",0).css(d,"pos"===h?-n:n),c[d]=(s?"pos"===h?"+=":"-=":"pos"===h?"-=":"+=")+n,r.animate(c,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===o&&r.hide(),t.effects.restore(r,a),t.effects.removeWrapper(r),i()}})}}(jQuery),function(t){t.effects.effect.explode=function(e,i){function n(){v.push(this),v.length===c*u&&r()}function r(){p.css({visibility:"visible"}),t(v).remove(),m||p.hide(),i()}var a,o,s,l,d,h,c=e.pieces?Math.round(Math.sqrt(e.pieces)):3,u=c,p=t(this),f=t.effects.setMode(p,e.mode||"hide"),m="show"===f,g=p.show().css("visibility","hidden").offset(),_=Math.ceil(p.outerWidth()/u),y=Math.ceil(p.outerHeight()/c),v=[];for(a=0;c>a;a++)for(l=g.top+a*y,h=a-(c-1)/2,o=0;u>o;o++)s=g.left+o*_,d=o-(u-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-o*_,top:-a*y}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:_,height:y,left:s+(m?d*_:0),top:l+(m?h*y:0),opacity:m?0:1}).animate({left:s+(m?0:d*_),top:l+(m?0:h*y),opacity:m?1:0},e.duration||500,e.easing,n)}}(jQuery),function(t){t.effects.effect.fade=function(e,i){var n=t(this),r=t.effects.setMode(n,e.mode||"toggle");n.animate({opacity:r},{queue:!1,duration:e.duration,easing:e.easing,complete:i})}}(jQuery),function(t){t.effects.effect.fold=function(e,i){var n,r,a=t(this),o=["position","top","bottom","left","right","height","width"],s=t.effects.setMode(a,e.mode||"hide"),l="show"===s,d="hide"===s,h=e.size||15,c=/([0-9]+)%/.exec(h),u=!!e.horizFirst,p=l!==u,f=p?["width","height"]:["height","width"],m=e.duration/2,g={},_={};t.effects.save(a,o),a.show(),n=t.effects.createWrapper(a).css({overflow:"hidden"}),r=p?[n.width(),n.height()]:[n.height(),n.width()],c&&(h=parseInt(c[1],10)/100*r[d?0:1]),l&&n.css(u?{height:0,width:h}:{height:h,width:0}),g[f[0]]=l?r[0]:h,_[f[1]]=l?r[1]:0,n.animate(g,m,e.easing).animate(_,m,e.easing,function(){d&&a.hide(),t.effects.restore(a,o),t.effects.removeWrapper(a),i()})}}(jQuery),function(t){t.effects.effect.highlight=function(e,i){var n=t(this),r=["backgroundImage","backgroundColor","opacity"],a=t.effects.setMode(n,e.mode||"show"),o={backgroundColor:n.css("backgroundColor")};"hide"===a&&(o.opacity=0),t.effects.save(n,r),n.show().css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(o,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===a&&n.hide(),t.effects.restore(n,r),i()}})}}(jQuery),function(t){t.effects.effect.pulsate=function(e,i){var n,r=t(this),a=t.effects.setMode(r,e.mode||"show"),o="show"===a,s="hide"===a,l=o||"hide"===a,d=2*(e.times||5)+(l?1:0),h=e.duration/d,c=0,u=r.queue(),p=u.length;for((o||!r.is(":visible"))&&(r.css("opacity",0).show(),c=1),n=1;d>n;n++)r.animate({opacity:c},h,e.easing),c=1-c;r.animate({opacity:c},h,e.easing),r.queue(function(){s&&r.hide(),i()}),p>1&&u.splice.apply(u,[1,0].concat(u.splice(p,d+1))),r.dequeue()}}(jQuery),function(t){t.effects.effect.puff=function(e,i){var n=t(this),r=t.effects.setMode(n,e.mode||"hide"),a="hide"===r,o=parseInt(e.percent,10)||150,s=o/100,l={height:n.height(),width:n.width(),outerHeight:n.outerHeight(),outerWidth:n.outerWidth()};t.extend(e,{effect:"scale",queue:!1,fade:!0,mode:r,complete:i,percent:a?o:100,from:a?l:{height:l.height*s,width:l.width*s,outerHeight:l.outerHeight*s,outerWidth:l.outerWidth*s}}),n.effect(e)},t.effects.effect.scale=function(e,i){var n=t(this),r=t.extend(!0,{},e),a=t.effects.setMode(n,e.mode||"effect"),o=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"hide"===a?0:100),s=e.direction||"both",l=e.origin,d={height:n.height(),width:n.width(),outerHeight:n.outerHeight(),outerWidth:n.outerWidth()},h={y:"horizontal"!==s?o/100:1,x:"vertical"!==s?o/100:1};r.effect="size",r.queue=!1,r.complete=i,"effect"!==a&&(r.origin=l||["middle","center"],r.restore=!0),r.from=e.from||("show"===a?{height:0,width:0,outerHeight:0,outerWidth:0}:d),r.to={height:d.height*h.y,width:d.width*h.x,outerHeight:d.outerHeight*h.y,outerWidth:d.outerWidth*h.x},r.fade&&("show"===a&&(r.from.opacity=0,r.to.opacity=1),"hide"===a&&(r.from.opacity=1,r.to.opacity=0)),n.effect(r)},t.effects.effect.size=function(e,i){var n,r,a,o=t(this),s=["position","top","bottom","left","right","width","height","overflow","opacity"],l=["position","top","bottom","left","right","overflow","opacity"],d=["width","height","overflow"],h=["fontSize"],c=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],u=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=t.effects.setMode(o,e.mode||"effect"),f=e.restore||"effect"!==p,m=e.scale||"both",g=e.origin||["middle","center"],_=o.css("position"),y=f?s:l,v={height:0,width:0,outerHeight:0,outerWidth:0};"show"===p&&o.show(),n={height:o.height(),width:o.width(),outerHeight:o.outerHeight(),outerWidth:o.outerWidth()},"toggle"===e.mode&&"show"===p?(o.from=e.to||v,o.to=e.from||n):(o.from=e.from||("show"===p?v:n),o.to=e.to||("hide"===p?v:n)),a={from:{y:o.from.height/n.height,x:o.from.width/n.width},to:{y:o.to.height/n.height,x:o.to.width/n.width}},("box"===m||"both"===m)&&(a.from.y!==a.to.y&&(y=y.concat(c),o.from=t.effects.setTransition(o,c,a.from.y,o.from),o.to=t.effects.setTransition(o,c,a.to.y,o.to)),a.from.x!==a.to.x&&(y=y.concat(u),o.from=t.effects.setTransition(o,u,a.from.x,o.from),o.to=t.effects.setTransition(o,u,a.to.x,o.to))),("content"===m||"both"===m)&&a.from.y!==a.to.y&&(y=y.concat(h).concat(d),o.from=t.effects.setTransition(o,h,a.from.y,o.from),o.to=t.effects.setTransition(o,h,a.to.y,o.to)),t.effects.save(o,y),o.show(),t.effects.createWrapper(o),o.css("overflow","hidden").css(o.from),g&&(r=t.effects.getBaseline(g,n),o.from.top=(n.outerHeight-o.outerHeight())*r.y,o.from.left=(n.outerWidth-o.outerWidth())*r.x,o.to.top=(n.outerHeight-o.to.outerHeight)*r.y,o.to.left=(n.outerWidth-o.to.outerWidth)*r.x),o.css(o.from),("content"===m||"both"===m)&&(c=c.concat(["marginTop","marginBottom"]).concat(h),u=u.concat(["marginLeft","marginRight"]),d=s.concat(c).concat(u),o.find("*[width]").each(function(){var i=t(this),n={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};f&&t.effects.save(i,d),i.from={height:n.height*a.from.y,width:n.width*a.from.x,outerHeight:n.outerHeight*a.from.y,outerWidth:n.outerWidth*a.from.x},i.to={height:n.height*a.to.y,width:n.width*a.to.x,outerHeight:n.height*a.to.y,outerWidth:n.width*a.to.x},a.from.y!==a.to.y&&(i.from=t.effects.setTransition(i,c,a.from.y,i.from),i.to=t.effects.setTransition(i,c,a.to.y,i.to)),a.from.x!==a.to.x&&(i.from=t.effects.setTransition(i,u,a.from.x,i.from),i.to=t.effects.setTransition(i,u,a.to.x,i.to)),i.css(i.from),i.animate(i.to,e.duration,e.easing,function(){f&&t.effects.restore(i,d)})})),o.animate(o.to,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){0===o.to.opacity&&o.css("opacity",o.from.opacity),"hide"===p&&o.hide(),t.effects.restore(o,y),f||("static"===_?o.css({position:"relative",top:o.to.top,left:o.to.left}):t.each(["top","left"],function(t,e){o.css(e,function(e,i){var n=parseInt(i,10),r=t?o.to.left:o.to.top;return"auto"===i?r+"px":n+r+"px"})})),t.effects.removeWrapper(o),i()}})}}(jQuery),function(t){t.effects.effect.shake=function(e,i){var n,r=t(this),a=["position","top","bottom","left","right","height","width"],o=t.effects.setMode(r,e.mode||"effect"),s=e.direction||"left",l=e.distance||20,d=e.times||3,h=2*d+1,c=Math.round(e.duration/h),u="up"===s||"down"===s?"top":"left",p="up"===s||"left"===s,f={},m={},g={},_=r.queue(),y=_.length;for(t.effects.save(r,a),r.show(),t.effects.createWrapper(r),f[u]=(p?"-=":"+=")+l,m[u]=(p?"+=":"-=")+2*l,g[u]=(p?"-=":"+=")+2*l,r.animate(f,c,e.easing),n=1;d>n;n++)r.animate(m,c,e.easing).animate(g,c,e.easing);r.animate(m,c,e.easing).animate(f,c/2,e.easing).queue(function(){"hide"===o&&r.hide(),t.effects.restore(r,a),t.effects.removeWrapper(r),i()}),y>1&&_.splice.apply(_,[1,0].concat(_.splice(y,h+1))),r.dequeue()}}(jQuery),function(t){t.effects.effect.slide=function(e,i){var n,r=t(this),a=["position","top","bottom","left","right","width","height"],o=t.effects.setMode(r,e.mode||"show"),s="show"===o,l=e.direction||"left",d="up"===l||"down"===l?"top":"left",h="up"===l||"left"===l,c={};t.effects.save(r,a),r.show(),n=e.distance||r["top"===d?"outerHeight":"outerWidth"](!0),t.effects.createWrapper(r).css({overflow:"hidden"}),s&&r.css(d,h?isNaN(n)?"-"+n:-n:n),c[d]=(s?h?"+=":"-=":h?"-=":"+=")+n,r.animate(c,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===o&&r.hide(),t.effects.restore(r,a),t.effects.removeWrapper(r),i()}})}}(jQuery),function(t){t.effects.effect.transfer=function(e,i){var n=t(this),r=t(e.to),a="fixed"===r.css("position"),o=t("body"),s=a?o.scrollTop():0,l=a?o.scrollLeft():0,d=r.offset(),h={top:d.top-s,left:d.left-l,height:r.innerHeight(),width:r.innerWidth()},c=n.offset(),u=t("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(e.className).css({top:c.top-s,left:c.left-l,height:n.innerHeight(),width:n.innerWidth(),position:a?"fixed":"absolute"}).animate(h,e.duration,e.easing,function(){u.remove(),i()})}}(jQuery),function(t){t.widget("ui.menu",{version:"1.10.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,t.proxy(function(t){this.options.disabled&&t.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(t){t.preventDefault()},"click .ui-state-disabled > a":function(t){t.preventDefault()},"click .ui-menu-item:has(a)":function(e){var i=t(e.target).closest(".ui-menu-item");!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&t(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){var i=t(e.currentTarget);i.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(e,i)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.children(".ui-menu-item").eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){t.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){t(e.target).closest(".ui-menu").length||this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var e=t(this);e.data("ui-menu-submenu-carat")&&e.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(e){function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var n,r,a,o,s,l=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:l=!1,r=this.previousFilter||"",a=String.fromCharCode(e.keyCode),o=!1,clearTimeout(this.filterTimer),a===r?o=!0:a=r+a,s=RegExp("^"+i(a),"i"),n=this.activeMenu.children(".ui-menu-item").filter(function(){return s.test(t(this).children("a").text())}),n=o&&-1!==n.index(this.active.next())?this.active.nextAll(".ui-menu-item"):n,n.length||(a=String.fromCharCode(e.keyCode),s=RegExp("^"+i(a),"i"),n=this.activeMenu.children(".ui-menu-item").filter(function(){return s.test(t(this).children("a").text())})),n.length?(this.focus(e,n),n.length>1?(this.previousFilter=a,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}l&&e.preventDefault()},_activate:function(t){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var e,i=this.options.icons.submenu,n=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),n.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),n=e.prev("a"),r=t("<span>").addClass("ui-menu-icon ui-icon "+i).data("ui-menu-submenu-carat",!0);n.attr("aria-haspopup","true").prepend(r),e.attr("aria-labelledby",n.attr("id"))}),e=n.add(this.element),e.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),e.children(":not(.ui-menu-item)").each(function(){var e=t(this);/[^\-\u2014\u2013\s]/.test(e.text())||e.addClass("ui-widget-content ui-menu-divider")}),e.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){"icons"===t&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(e.submenu),this._super(t,e)},focus:function(t,e){var i,n;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),n=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",n.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=e.children(".ui-menu"),i.length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,n,r,a,o,s;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,n=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,r=e.offset().top-this.activeMenu.offset().top-i-n,a=this.activeMenu.scrollTop(),o=this.activeMenu.height(),s=e.height(),0>r?this.activeMenu.scrollTop(a+r):r+s>o&&this.activeMenu.scrollTop(a+r-o+s))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",t,{item:this.active}))},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var n=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));n.length||(n=this.element),this._close(n),this.blur(e),this.activeMenu=n},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var n;this.active&&(n="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),n&&n.length&&this.active||(n=this.activeMenu.children(".ui-menu-item")[e]()),this.focus(i,n)},nextPage:function(e){var i,n,r;return this.active?void(this.isLastItem()||(this._hasScroll()?(n=this.active.offset().top,r=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=t(this),0>i.offset().top-n-r}),this.focus(e,i)):this.focus(e,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]()))):void this.next(e)},previousPage:function(e){var i,n,r;return this.active?void(this.isFirstItem()||(this._hasScroll()?(n=this.active.offset().top,r=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-n+r>0}),this.focus(e,i)):this.focus(e,this.activeMenu.children(".ui-menu-item").first()))):void this.next(e)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)}})}(jQuery),function(t,e){function i(t,e,i){return[parseFloat(t[0])*(p.test(t[0])?e/100:1),parseFloat(t[1])*(p.test(t[1])?i/100:1)]}function n(e,i){return parseInt(t.css(e,i),10)||0}function r(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}t.ui=t.ui||{};var a,o=Math.max,s=Math.abs,l=Math.round,d=/left|center|right/,h=/top|center|bottom/,c=/[\+\-]\d+(\.[\d]+)?%?/,u=/^\w+/,p=/%$/,f=t.fn.position;t.position={scrollbarWidth:function(){if(a!==e)return a;var i,n,r=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=r.children()[0];return t("body").append(r),i=o.offsetWidth,r.css("overflow","scroll"),n=o.offsetWidth,i===n&&(n=r[0].clientWidth),r.remove(),a=i-n},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),n=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),r="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,a="scroll"===n||"auto"===n&&e.height<e.element[0].scrollHeight;return{width:a?t.position.scrollbarWidth():0,height:r?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),n=t.isWindow(i[0]),r=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:n,isDocument:r,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:n?i.width():i.outerWidth(),height:n?i.height():i.outerHeight()}}},t.fn.position=function(e){if(!e||!e.of)return f.apply(this,arguments);e=t.extend({},e);var a,p,m,g,_,y,v=t(e.of),b=t.position.getWithinInfo(e.within),w=t.position.getScrollInfo(b),x=(e.collision||"flip").split(" "),k={};return y=r(v),v[0].preventDefault&&(e.at="left top"),p=y.width,m=y.height,g=y.offset,_=t.extend({},g),t.each(["my","at"],function(){var t,i,n=(e[this]||"").split(" ");1===n.length&&(n=d.test(n[0])?n.concat(["center"]):h.test(n[0])?["center"].concat(n):["center","center"]),
n[0]=d.test(n[0])?n[0]:"center",n[1]=h.test(n[1])?n[1]:"center",t=c.exec(n[0]),i=c.exec(n[1]),k[this]=[t?t[0]:0,i?i[0]:0],e[this]=[u.exec(n[0])[0],u.exec(n[1])[0]]}),1===x.length&&(x[1]=x[0]),"right"===e.at[0]?_.left+=p:"center"===e.at[0]&&(_.left+=p/2),"bottom"===e.at[1]?_.top+=m:"center"===e.at[1]&&(_.top+=m/2),a=i(k.at,p,m),_.left+=a[0],_.top+=a[1],this.each(function(){var r,d,h=t(this),c=h.outerWidth(),u=h.outerHeight(),f=n(this,"marginLeft"),y=n(this,"marginTop"),L=c+f+n(this,"marginRight")+w.width,C=u+y+n(this,"marginBottom")+w.height,T=t.extend({},_),$=i(k.my,h.outerWidth(),h.outerHeight());"right"===e.my[0]?T.left-=c:"center"===e.my[0]&&(T.left-=c/2),"bottom"===e.my[1]?T.top-=u:"center"===e.my[1]&&(T.top-=u/2),T.left+=$[0],T.top+=$[1],t.support.offsetFractions||(T.left=l(T.left),T.top=l(T.top)),r={marginLeft:f,marginTop:y},t.each(["left","top"],function(i,n){t.ui.position[x[i]]&&t.ui.position[x[i]][n](T,{targetWidth:p,targetHeight:m,elemWidth:c,elemHeight:u,collisionPosition:r,collisionWidth:L,collisionHeight:C,offset:[a[0]+$[0],a[1]+$[1]],my:e.my,at:e.at,within:b,elem:h})}),e.using&&(d=function(t){var i=g.left-T.left,n=i+p-c,r=g.top-T.top,a=r+m-u,l={target:{element:v,left:g.left,top:g.top,width:p,height:m},element:{element:h,left:T.left,top:T.top,width:c,height:u},horizontal:0>n?"left":i>0?"right":"center",vertical:0>a?"top":r>0?"bottom":"middle"};c>p&&p>s(i+n)&&(l.horizontal="center"),u>m&&m>s(r+a)&&(l.vertical="middle"),l.important=o(s(i),s(n))>o(s(r),s(a))?"horizontal":"vertical",e.using.call(this,t,l)}),h.offset(t.extend(T,{using:d}))})},t.ui.position={fit:{left:function(t,e){var i,n=e.within,r=n.isWindow?n.scrollLeft:n.offset.left,a=n.width,s=t.left-e.collisionPosition.marginLeft,l=r-s,d=s+e.collisionWidth-a-r;e.collisionWidth>a?l>0&&0>=d?(i=t.left+l+e.collisionWidth-a-r,t.left+=l-i):t.left=d>0&&0>=l?r:l>d?r+a-e.collisionWidth:r:l>0?t.left+=l:d>0?t.left-=d:t.left=o(t.left-s,t.left)},top:function(t,e){var i,n=e.within,r=n.isWindow?n.scrollTop:n.offset.top,a=e.within.height,s=t.top-e.collisionPosition.marginTop,l=r-s,d=s+e.collisionHeight-a-r;e.collisionHeight>a?l>0&&0>=d?(i=t.top+l+e.collisionHeight-a-r,t.top+=l-i):t.top=d>0&&0>=l?r:l>d?r+a-e.collisionHeight:r:l>0?t.top+=l:d>0?t.top-=d:t.top=o(t.top-s,t.top)}},flip:{left:function(t,e){var i,n,r=e.within,a=r.offset.left+r.scrollLeft,o=r.width,l=r.isWindow?r.scrollLeft:r.offset.left,d=t.left-e.collisionPosition.marginLeft,h=d-l,c=d+e.collisionWidth-o-l,u="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>h?(i=t.left+u+p+f+e.collisionWidth-o-a,(0>i||s(h)>i)&&(t.left+=u+p+f)):c>0&&(n=t.left-e.collisionPosition.marginLeft+u+p+f-l,(n>0||c>s(n))&&(t.left+=u+p+f))},top:function(t,e){var i,n,r=e.within,a=r.offset.top+r.scrollTop,o=r.height,l=r.isWindow?r.scrollTop:r.offset.top,d=t.top-e.collisionPosition.marginTop,h=d-l,c=d+e.collisionHeight-o-l,u="top"===e.my[1],p=u?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,m=-2*e.offset[1];0>h?(n=t.top+p+f+m+e.collisionHeight-o-a,t.top+p+f+m>h&&(0>n||s(h)>n)&&(t.top+=p+f+m)):c>0&&(i=t.top-e.collisionPosition.marginTop+p+f+m-l,t.top+p+f+m>c&&(i>0||c>s(i))&&(t.top+=p+f+m))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}},function(){var e,i,n,r,a,o=document.getElementsByTagName("body")[0],s=document.createElement("div");e=document.createElement(o?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&t.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"});for(a in n)e.style[a]=n[a];e.appendChild(s),i=o||document.documentElement,i.insertBefore(e,i.firstChild),s.style.cssText="position: absolute; left: 10.7432222px;",r=t(s).offset().left,t.support.offsetFractions=r>10&&11>r,e.innerHTML="",i.removeChild(e)}()}(jQuery),function(t,e){t.widget("ui.progressbar",{version:"1.10.4",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=t("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(t){return t===e?this.options.value:(this.options.value=this._constrainedValue(t),this._refreshValue(),e)},_constrainedValue:function(t){return t===e&&(t=this.options.value),this.indeterminate=t===!1,"number"!=typeof t&&(t=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),this._super(t,e)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).toggleClass("ui-corner-right",e===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}})}(jQuery),function(t){var e=5;t.widget("ui.slider",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,n=this.options,r=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),a="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",o=[];for(i=n.values&&n.values.length||1,r.length>i&&(r.slice(i).remove(),r=r.slice(0,i)),e=r.length;i>e;e++)o.push(a);this.handles=r.add(t(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e)})},_createRange:function(){var e=this.options,i="";e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=t("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===e.range||"max"===e.range?" ui-slider-range-"+e.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){var t=this.handles.add(this.range).filter("a");this._off(t),this._on(t,this._handleEvents),this._hoverable(t),this._focusable(t)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(e){var i,n,r,a,o,s,l,d,h=this,c=this.options;return!c.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(i),r=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(n-h.values(e));(r>i||r===i&&(e===h._lastChangedValue||h.values(e)===c.min))&&(r=i,a=t(this),o=e)}),s=this._start(e,o),s!==!1&&(this._mouseSliding=!0,this._handleIndex=o,a.addClass("ui-state-active").focus(),l=a.offset(),d=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=d?{left:0,top:0}:{left:e.pageX-l.left-a.width()/2,top:e.pageY-l.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,o,n),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,n,r,a;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),n=i/e,n>1&&(n=1),0>n&&(n=0),"vertical"===this.orientation&&(n=1-n),r=this._valueMax()-this._valueMin(),a=this._valueMin()+n*r,this._trimAlignValue(a)},_start:function(t,e){var i={handle:this.handles[e],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("start",t,i)},_slide:function(t,e,i){var n,r,a;this.options.values&&this.options.values.length?(n=this.values(e?0:1),2===this.options.values.length&&this.options.range===!0&&(0===e&&i>n||1===e&&n>i)&&(i=n),i!==this.values(e)&&(r=this.values(),r[e]=i,a=this._trigger("slide",t,{handle:this.handles[e],value:i,values:r}),n=this.values(e?0:1),a!==!1&&this.values(e,i))):i!==this.value()&&(a=this._trigger("slide",t,{handle:this.handles[e],value:i}),a!==!1&&this.value(i))},_stop:function(t,e){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("stop",t,i)},_change:function(t,e){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._lastChangedValue=e,this._trigger("change",t,i)}},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),void this._change(null,0)):this._value()},values:function(e,i){var n,r,a;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,e);if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(e):this.value();for(n=this.options.values,r=arguments[0],a=0;n.length>a;a+=1)n[a]=this._trimAlignValue(r[a]),this._change(null,a);this._refreshValue()},_setOption:function(e,i){var n,r=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(r=this.options.values.length),t.Widget.prototype._setOption.apply(this,arguments),e){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),n=0;r>n;n+=1)this._change(null,n);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,n;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),n=0;i.length>n;n+=1)i[n]=this._trimAlignValue(i[n]);return i}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,n=t-i;return 2*Math.abs(i)>=e&&(n+=i>0?e:-e),parseFloat(n.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var e,i,n,r,a,o=this.options.range,s=this.options,l=this,d=!this._animateOff&&s.animate,h={};this.options.values&&this.options.values.length?this.handles.each(function(n){i=100*((l.values(n)-l._valueMin())/(l._valueMax()-l._valueMin())),h["horizontal"===l.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[d?"animate":"css"](h,s.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===n&&l.range.stop(1,1)[d?"animate":"css"]({left:i+"%"},s.animate),1===n&&l.range[d?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:s.animate})):(0===n&&l.range.stop(1,1)[d?"animate":"css"]({bottom:i+"%"},s.animate),1===n&&l.range[d?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:s.animate}))),e=i}):(n=this.value(),r=this._valueMin(),a=this._valueMax(),i=a!==r?100*((n-r)/(a-r)):0,h["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[d?"animate":"css"](h,s.animate),"min"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[d?"animate":"css"]({width:i+"%"},s.animate),"max"===o&&"horizontal"===this.orientation&&this.range[d?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:s.animate}),"min"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[d?"animate":"css"]({height:i+"%"},s.animate),"max"===o&&"vertical"===this.orientation&&this.range[d?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:s.animate}))},_handleEvents:{keydown:function(i){var n,r,a,o,s=t(i.target).data("ui-slider-handle-index");switch(i.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(i.preventDefault(),!this._keySliding&&(this._keySliding=!0,t(i.target).addClass("ui-state-active"),n=this._start(i,s),n===!1))return}switch(o=this.options.step,r=a=this.options.values&&this.options.values.length?this.values(s):this.value(),i.keyCode){case t.ui.keyCode.HOME:a=this._valueMin();break;case t.ui.keyCode.END:a=this._valueMax();break;case t.ui.keyCode.PAGE_UP:a=this._trimAlignValue(r+(this._valueMax()-this._valueMin())/e);break;case t.ui.keyCode.PAGE_DOWN:a=this._trimAlignValue(r-(this._valueMax()-this._valueMin())/e);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(r===this._valueMax())return;a=this._trimAlignValue(r+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(r===this._valueMin())return;a=this._trimAlignValue(r-o)}this._slide(i,s,a)},click:function(t){t.preventDefault()},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),t(e.target).removeClass("ui-state-active"))}}})}(jQuery),function(t){function e(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.widget("ui.spinner",{version:"1.10.4",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e={},i=this.element;return t.each(["min","max","step"],function(t,n){var r=i.attr(n);void 0!==r&&r.length&&(e[n]=r)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",t)))},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){var t=this.element[0]===this.document[0].activeElement;t||(this.element.focus(),this.previous=n,this._delay(function(){this.previous=n}))}var n;n=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(e)!==!1&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?this._start(e)!==!1&&void this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e):void 0},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var t=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=t.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*t.height())&&t.height()>0&&t.height(t.height()),this.options.disabled&&this.disable()},_keydown:function(e){var i=this.options,n=t.ui.keyCode;switch(e.keyCode){case n.UP:return this._repeat(null,1,e),!0;case n.DOWN:return this._repeat(null,-1,e),!0;case n.PAGE_UP:return this._repeat(null,i.page,e),!0;case n.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(t){return!(!this.spinning&&this._trigger("start",t)===!1)&&(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,e,i)},t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&this._trigger("spin",e,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var e,i,n=this.options;return e=null!==n.min?n.min:0,i=t-e,i=Math.round(i/n.step)*n.step,t=e+i,t=parseFloat(t.toFixed(this._precision())),null!==n.max&&t>n.max?n.max:null!==n.min&&n.min>t?n.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){if("culture"===t||"numberFormat"===t){var i=this._parse(this.element.val());return this.options[t]=e,void this.element.val(this._format(i))}("max"===t||"min"===t||"step"===t)&&"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(e.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(e.down)),this._super(t,e),"disabled"===t&&(e?(this.element.prop("disabled",!0),this.buttons.button("disable")):(this.element.prop("disabled",!1),this.buttons.button("enable")))},_setOptions:e(function(t){this._super(t),this._value(this.element.val())}),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},_value:function(t,e){var i;""!==t&&(i=this._parse(t),null!==i&&(e||(i=this._adjustValue(i)),t=this._format(i))),this.element.val(t),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:e(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:e(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:e(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:e(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){return arguments.length?void e(this._value).call(this,t):this._parse(this.element.val())},widget:function(){return this.uiSpinner}})}(jQuery),function(t,e){function i(){return++r}function n(t){return t=t.cloneNode(!1),t.hash.length>1&&decodeURIComponent(t.href.replace(a,""))===decodeURIComponent(location.href.replace(a,""))}var r=0,a=/#.*$/;t.widget("ui.tabs",{version:"1.10.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var e=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),i.active=this._initialActive(),t.isArray(i.disabled)&&(i.disabled=t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),function(t){return e.tabs.index(t)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):t(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var i=this.options.active,n=this.options.collapsible,r=location.hash.substring(1);return null===i&&(r&&this.tabs.each(function(n,a){return t(a).attr("aria-controls")===r?(i=n,!1):e}),null===i&&(i=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===i||-1===i)&&(i=!!this.tabs.length&&0)),i!==!1&&(i=this.tabs.index(this.tabs.eq(i)),-1===i&&(i=!n&&0)),!n&&i===!1&&this.anchors.length&&(i=0),i},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(i){var n=t(this.document[0].activeElement).closest("li"),r=this.tabs.index(n),a=!0;if(!this._handlePageNav(i)){switch(i.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:r++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:a=!1,r--;break;case t.ui.keyCode.END:r=this.anchors.length-1;break;case t.ui.keyCode.HOME:r=0;break;case t.ui.keyCode.SPACE:return i.preventDefault(),clearTimeout(this.activating),this._activate(r),e;case t.ui.keyCode.ENTER:return i.preventDefault(),clearTimeout(this.activating),this._activate(r!==this.options.active&&r),e;default:return}i.preventDefault(),clearTimeout(this.activating),r=this._focusNextTab(r,a),i.ctrlKey||(n.attr("aria-selected","false"),this.tabs.eq(r).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",r)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.focus())},_handlePageNav:function(i){return i.altKey&&i.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):i.altKey&&i.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):e},_findNextTab:function(e,i){function n(){return e>r&&(e=0),0>e&&(e=r),e}for(var r=this.tabs.length-1;-1!==t.inArray(n(),this.options.disabled);)e=i?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).focus(),t},_setOption:function(t,i){return"active"===t?(this._activate(i),e):"disabled"===t?(this._setupDisabled(i),e):(this._super(t,i),"collapsible"===t&&(this.element.toggleClass("ui-tabs-collapsible",i),i||this.options.active!==!1||this._activate(0)),"event"===t&&this._setupEvents(i),"heightStyle"===t&&this._setupHeightStyle(i),e)},_tabId:function(t){return t.attr("aria-controls")||"ui-tabs-"+i()},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,i=this.tablist.children(":has(a[href])");e.disabled=t.map(i.filter(".ui-state-disabled"),function(t){return i.index(t)}),this._processTabs(),e.active!==!1&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return t("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=t(),this.anchors.each(function(i,r){var a,o,s,l=t(r).uniqueId().attr("id"),d=t(r).closest("li"),h=d.attr("aria-controls");n(r)?(a=r.hash,o=e.element.find(e._sanitizeSelector(a))):(s=e._tabId(d),a="#"+s,o=e.element.find(a),o.length||(o=e._createPanel(s),o.insertAfter(e.panels[i-1]||e.tablist)),o.attr("aria-live","polite")),o.length&&(e.panels=e.panels.add(o)),h&&d.data("ui-tabs-aria-controls",h),d.attr({"aria-controls":a.substring(1),"aria-labelledby":l}),o.attr("aria-labelledby",l)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(e){t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1);for(var i,n=0;i=this.tabs[n];n++)e===!0||-1!==t.inArray(n,e)?t(i).addClass("ui-state-disabled").attr("aria-disabled","true"):t(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=e},_setupEvents:function(e){var i={click:function(t){t.preventDefault()}};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,n=this.element.parent();"fill"===e?(i=n.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=t(this),n=e.css("position");"absolute"!==n&&"fixed"!==n&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=t(this).outerHeight(!0)}),this.panels.each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,t(this).height("").height())}).height(i))},_eventHandler:function(e){var i=this.options,n=this.active,r=t(e.currentTarget),a=r.closest("li"),o=a[0]===n[0],s=o&&i.collapsible,l=s?t():this._getPanelForTab(a),d=n.length?this._getPanelForTab(n):t(),h={oldTab:n,oldPanel:d,newTab:s?t():a,newPanel:l};e.preventDefault(),a.hasClass("ui-state-disabled")||a.hasClass("ui-tabs-loading")||this.running||o&&!i.collapsible||this._trigger("beforeActivate",e,h)===!1||(i.active=!s&&this.tabs.index(a),this.active=o?t():a,this.xhr&&this.xhr.abort(),d.length||l.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(a),e),this._toggle(e,h))},_toggle:function(e,i){function n(){a.running=!1,a._trigger("activate",e,i)}function r(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),o.length&&a.options.show?a._show(o,a.options.show,n):(o.show(),n())}var a=this,o=i.newPanel,s=i.oldPanel;this.running=!0,s.length&&this.options.hide?this._hide(s,this.options.hide,function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),r()}):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),s.hide(),r()),s.attr({"aria-expanded":"false","aria-hidden":"true"}),i.oldTab.attr("aria-selected","false"),o.length&&s.length?i.oldTab.attr("tabIndex",-1):o.length&&this.tabs.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),o.attr({"aria-expanded":"true","aria-hidden":"false"}),i.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(e){var i,n=this._findActive(e);n[0]!==this.active[0]&&(n.length||(n=this.active),i=n.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return e===!1?t():this.tabs.eq(e)},_getIndex:function(t){return"string"==typeof t&&(t=this.anchors.index(this.anchors.filter("[href$='"+t+"']"))),t},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role");
}),this.tabs.each(function(){var e=t(this),i=e.data("ui-tabs-aria-controls");i?e.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(i){var n=this.options.disabled;n!==!1&&(i===e?n=!1:(i=this._getIndex(i),n=t.isArray(n)?t.map(n,function(t){return t!==i?t:null}):t.map(this.tabs,function(t,e){return e!==i?e:null})),this._setupDisabled(n))},disable:function(i){var n=this.options.disabled;if(n!==!0){if(i===e)n=!0;else{if(i=this._getIndex(i),-1!==t.inArray(i,n))return;n=t.isArray(n)?t.merge([i],n).sort():[i]}this._setupDisabled(n)}},load:function(e,i){e=this._getIndex(e);var r=this,a=this.tabs.eq(e),o=a.find(".ui-tabs-anchor"),s=this._getPanelForTab(a),l={tab:a,panel:s};n(o[0])||(this.xhr=t.ajax(this._ajaxSettings(o,i,l)),this.xhr&&"canceled"!==this.xhr.statusText&&(a.addClass("ui-tabs-loading"),s.attr("aria-busy","true"),this.xhr.success(function(t){setTimeout(function(){s.html(t),r._trigger("load",i,l)},1)}).complete(function(t,e){setTimeout(function(){"abort"===e&&r.panels.stop(!1,!0),a.removeClass("ui-tabs-loading"),s.removeAttr("aria-busy"),t===r.xhr&&delete r.xhr},1)})))},_ajaxSettings:function(e,i,n){var r=this;return{url:e.attr("href"),beforeSend:function(e,a){return r._trigger("beforeLoad",i,t.extend({jqXHR:e,ajaxSettings:a},n))}}},_getPanelForTab:function(e){var i=t(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}})}(jQuery),function(k){for(var d,f,l=document.getElementsByTagName("head")[0].style,h=["transformProperty","WebkitTransform","OTransform","msTransform","MozTransform"],g=0;g<h.length;g++)void 0!==l[h[g]]&&(d=h[g]);d&&(f=d.replace(/[tT]ransform/,"TransformOrigin"),"T"==f[0]&&(f[0]="t")),eval('IE = "v"=="\x0B"'),jQuery.fn.extend({rotate:function(t){if(0!==this.length&&"undefined"!=typeof t){"number"==typeof t&&(t={angle:t});for(var e=[],i=0,n=this.length;i<n;i++){var r=this.get(i);if(r.Wilq32&&r.Wilq32.PhotoEffect)r.Wilq32.PhotoEffect._handleRotation(t);else{var a=k.extend(!0,{},t),r=new Wilq32.PhotoEffect(r,a)._rootObj;e.push(k(r))}}return e}},getRotateAngle:function(){for(var t=[],e=0,i=this.length;e<i;e++){var n=this.get(e);n.Wilq32&&n.Wilq32.PhotoEffect&&(t[e]=n.Wilq32.PhotoEffect._angle)}return t},stopRotate:function(){for(var t=0,e=this.length;t<e;t++){var i=this.get(t);i.Wilq32&&i.Wilq32.PhotoEffect&&clearTimeout(i.Wilq32.PhotoEffect._timer)}}}),Wilq32=window.Wilq32||{},Wilq32.PhotoEffect=function(){return d?function(t,e){t.Wilq32={PhotoEffect:this},this._img=this._rootObj=this._eventObj=t,this._handleRotation(e)}:function(t,e){if(this._img=t,this._onLoadDelegate=[e],this._rootObj=document.createElement("span"),this._rootObj.style.display="inline-block",this._rootObj.Wilq32={PhotoEffect:this},t.parentNode.insertBefore(this._rootObj,t),t.complete)this._Loader();else{var i=this;jQuery(this._img).bind("load",function(){i._Loader()})}}}(),Wilq32.PhotoEffect.prototype={_setupParameters:function(t){this._parameters=this._parameters||{},"number"!=typeof this._angle&&(this._angle=0),"number"==typeof t.angle&&(this._angle=t.angle),this._parameters.animateTo="number"==typeof t.animateTo?t.animateTo:this._angle,this._parameters.step=t.step||this._parameters.step||null,this._parameters.easing=t.easing||this._parameters.easing||this._defaultEasing,this._parameters.duration=t.duration||this._parameters.duration||1e3,this._parameters.callback=t.callback||this._parameters.callback||this._emptyFunction,this._parameters.center=t.center||this._parameters.center||["50%","50%"],this._rotationCenterX="string"==typeof this._parameters.center[0]?parseInt(this._parameters.center[0],10)/100*this._imgWidth*this._aspectW:this._parameters.center[0],this._rotationCenterY="string"==typeof this._parameters.center[1]?parseInt(this._parameters.center[1],10)/100*this._imgHeight*this._aspectH:this._parameters.center[1],t.bind&&t.bind!=this._parameters.bind&&this._BindEvents(t.bind)},_emptyFunction:function(){},_defaultEasing:function(t,e,i,n,r){return-n*((e=e/r-1)*e*e*e-1)+i},_handleRotation:function(t,e){d||this._img.complete||e?(this._setupParameters(t),this._angle==this._parameters.animateTo?this._rotate(this._angle):this._animateStart()):this._onLoadDelegate.push(t)},_BindEvents:function(t){if(t&&this._eventObj){if(this._parameters.bind){var e,i=this._parameters.bind;for(e in i)i.hasOwnProperty(e)&&jQuery(this._eventObj).unbind(e,i[e])}this._parameters.bind=t;for(e in t)t.hasOwnProperty(e)&&jQuery(this._eventObj).bind(e,t[e])}},_Loader:function(){return IE?function(){var t=this._img.width,e=this._img.height;for(this._imgWidth=t,this._imgHeight=e,this._img.parentNode.removeChild(this._img),this._vimage=this.createVMLNode("image"),this._vimage.src=this._img.src,this._vimage.style.height=e+"px",this._vimage.style.width=t+"px",this._vimage.style.position="absolute",this._vimage.style.top="0px",this._vimage.style.left="0px",this._aspectW=this._aspectH=1,this._container=this.createVMLNode("group"),this._container.style.width=t,this._container.style.height=e,this._container.style.position="absolute",this._container.style.top="0px",this._container.style.left="0px",this._container.setAttribute("coordsize",t-1+","+(e-1)),this._container.appendChild(this._vimage),this._rootObj.appendChild(this._container),this._rootObj.style.position="relative",this._rootObj.style.width=t+"px",this._rootObj.style.height=e+"px",this._rootObj.setAttribute("id",this._img.getAttribute("id")),this._rootObj.className=this._img.className,this._eventObj=this._rootObj;t=this._onLoadDelegate.shift();)this._handleRotation(t,!0)}:function(){this._rootObj.setAttribute("id",this._img.getAttribute("id")),this._rootObj.className=this._img.className,this._imgWidth=this._img.naturalWidth,this._imgHeight=this._img.naturalHeight;var t=Math.sqrt(this._imgHeight*this._imgHeight+this._imgWidth*this._imgWidth);for(this._width=3*t,this._height=3*t,this._aspectW=this._img.offsetWidth/this._img.naturalWidth,this._aspectH=this._img.offsetHeight/this._img.naturalHeight,this._img.parentNode.removeChild(this._img),this._canvas=document.createElement("canvas"),this._canvas.setAttribute("width",this._width),this._canvas.style.position="relative",this._canvas.style.left=-this._img.height*this._aspectW+"px",this._canvas.style.top=-this._img.width*this._aspectH+"px",this._canvas.Wilq32=this._rootObj.Wilq32,this._rootObj.appendChild(this._canvas),this._rootObj.style.width=this._img.width*this._aspectW+"px",this._rootObj.style.height=this._img.height*this._aspectH+"px",this._eventObj=this._canvas,this._cnv=this._canvas.getContext("2d");t=this._onLoadDelegate.shift();)this._handleRotation(t,!0)}}(),_animateStart:function(){this._timer&&clearTimeout(this._timer),this._animateStartTime=+new Date,this._animateStartAngle=this._angle,this._animate()},_animate:function(){var t=+new Date,e=t-this._animateStartTime>this._parameters.duration;if(e&&!this._parameters.animatedGif)clearTimeout(this._timer);else{(this._canvas||this._vimage||this._img)&&(t=this._parameters.easing(0,t-this._animateStartTime,this._animateStartAngle,this._parameters.animateTo-this._animateStartAngle,this._parameters.duration),this._rotate(~~(10*t)/10)),this._parameters.step&&this._parameters.step(this._angle);var i=this;this._timer=setTimeout(function(){i._animate.call(i)},10)}this._parameters.callback&&e&&(this._angle=this._parameters.animateTo,this._rotate(this._angle),this._parameters.callback.call(this._rootObj))},_rotate:function(){var t=Math.PI/180;return IE?function(t){this._angle=t,this._container.style.rotation=t%360+"deg",this._vimage.style.top=-(this._rotationCenterY-this._imgHeight/2)+"px",this._vimage.style.left=-(this._rotationCenterX-this._imgWidth/2)+"px",this._container.style.top=this._rotationCenterY-this._imgHeight/2+"px",this._container.style.left=this._rotationCenterX-this._imgWidth/2+"px"}:d?function(t){this._angle=t,this._img.style[d]="rotate("+t%360+"deg)",this._img.style[f]=this._parameters.center.join(" ")}:function(e){this._angle=e,e=e%360*t,this._canvas.width=this._width,this._canvas.height=this._height,this._cnv.translate(this._imgWidth*this._aspectW,this._imgHeight*this._aspectH),this._cnv.translate(this._rotationCenterX,this._rotationCenterY),this._cnv.rotate(e),this._cnv.translate(-this._rotationCenterX,-this._rotationCenterY),this._cnv.scale(this._aspectW,this._aspectH),this._cnv.drawImage(this._img,0,0)}}()},IE&&(Wilq32.PhotoEffect.prototype.createVMLNode=function(){document.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{return!document.namespaces.rvml&&document.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<rvml:"+t+' class="rvml">')}}catch(t){return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}}())}(jQuery),!function(t,e,i,n){var r=e.document,a=t(r),o=t(e),s=Array.prototype,l=1.41,d=!0,h=3e4,c=!1,u=navigator.userAgent.toLowerCase(),p=e.location.hash.replace(/#\//,""),f=e.location.protocol,m=Math,g=function(){},_=function(){return!1},y=function(){var t=3,e=r.createElement("div"),i=e.getElementsByTagName("i");do e.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->";while(i[0]);return t>4?t:r.documentMode||n}(),v=function(){return{html:r.documentElement,body:r.body,head:r.getElementsByTagName("head")[0],title:r.title}},b=e.parent!==e.self,w="data ready thumbnail loadstart loadfinish image play pause progress fullscreen_enter fullscreen_exit idle_enter idle_exit rescale lightbox_open lightbox_close lightbox_image",x=function(){var e=[];return t.each(w.split(" "),function(t,i){e.push(i),/_/.test(i)&&e.push(i.replace(/_/g,""))}),e}(),k=function(e){var i;return"object"!=typeof e?e:(t.each(e,function(n,r){/^[a-z]+_/.test(n)&&(i="",t.each(n.split("_"),function(t,e){i+=t>0?e.substr(0,1).toUpperCase()+e.substr(1):e}),e[i]=r,delete e[n])}),e)},L=function(e){return t.inArray(e,x)>-1?i[e.toUpperCase()]:e},C={youtube:{reg:/https?:\/\/(?:[a-zA_Z]{2,3}.)?(?:youtube\.com\/watch\?)((?:[\w\d\-\_\=]+&amp;(?:amp;)?)*v(?:&lt;[A-Z]+&gt;)?=([0-9a-zA-Z\-\_]+))/i,embed:function(){return"http://www.youtube.com/embed/"+this.id},getUrl:function(){return f+"//gdata.youtube.com/feeds/api/videos/"+this.id+"?v=2&alt=json-in-script&callback=?"},get_thumb:function(t){return t.entry.media$group.media$thumbnail[2].url},get_image:function(t){return t.entry.yt$hd?f+"//img.youtube.com/vi/"+this.id+"/maxresdefault.jpg":t.entry.media$group.media$thumbnail[3].url}},vimeo:{reg:/https?:\/\/(?:www\.)?(vimeo\.com)\/(?:hd#)?([0-9]+)/i,embed:function(){return"http://player.vimeo.com/video/"+this.id},getUrl:function(){return f+"//vimeo.com/api/v2/video/"+this.id+".json?callback=?"},get_thumb:function(t){return t[0].thumbnail_medium},get_image:function(t){return t[0].thumbnail_large}},dailymotion:{reg:/https?:\/\/(?:www\.)?(dailymotion\.com)\/video\/([^_]+)/,embed:function(){return f+"//www.dailymotion.com/embed/video/"+this.id},getUrl:function(){return"https://api.dailymotion.com/video/"+this.id+"?fields=thumbnail_240_url,thumbnail_720_url&callback=?"},get_thumb:function(t){return t.thumbnail_240_url},get_image:function(t){return t.thumbnail_720_url}},_inst:[]},T=function(e,i){for(var n=0;n<C._inst.length;n++)if(C._inst[n].id===i&&C._inst[n].type==e)return C._inst[n];this.type=e,this.id=i,this.readys=[],C._inst.push(this);var r=this;t.extend(this,C[e]),t.getJSON(this.getUrl(),function(e){r.data=e,t.each(r.readys,function(t,e){e(r.data)}),r.readys=[]}),this.getMedia=function(t,e,i){i=i||g;var n=this,r=function(i){e(n["get_"+t](i))};try{n.data?r(n.data):n.readys.push(r)}catch(t){i()}}},$=function(t){var e;for(var i in C)if(e=t&&C[i].reg&&t.match(C[i].reg),e&&e.length)return{id:e[2],provider:i};return!1},M={support:function(){var t=v().html;return!b&&(t.requestFullscreen||t.msRequestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen)}(),callback:g,enter:function(t,e,i){this.instance=t,this.callback=e||g,i=i||v().html,i.requestFullscreen?i.requestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullScreen&&i.webkitRequestFullScreen()},exit:function(t){this.callback=t||g,r.exitFullscreen?r.exitFullscreen():r.msExitFullscreen?r.msExitFullscreen():r.mozCancelFullScreen?r.mozCancelFullScreen():r.webkitCancelFullScreen&&r.webkitCancelFullScreen()},instance:null,listen:function(){if(this.support){var t=function(){if(M.instance){var t=M.instance._fullscreen;r.fullscreen||r.mozFullScreen||r.webkitIsFullScreen||r.msFullscreenElement&&null!==r.msFullscreenElement?t._enter(M.callback):t._exit(M.callback)}};r.addEventListener("fullscreenchange",t,!1),r.addEventListener("MSFullscreenChange",t,!1),r.addEventListener("mozfullscreenchange",t,!1),r.addEventListener("webkitfullscreenchange",t,!1)}}},P=[],D=[],S=!1,I=!1,E=[],U=[],O=function(e){U.push(e),t.each(E,function(t,i){i._options.theme!=e.name&&(i._initialized||i._options.theme)||(i.theme=e,i._init.call(i))})},j=function(){return{clearTimer:function(e){t.each(i.get(),function(){this.clearTimer(e)})},addTimer:function(e){t.each(i.get(),function(){this.addTimer(e)})},array:function(t){return s.slice.call(t,0)},create:function(t,e){e=e||"div";var i=r.createElement(e);return i.className=t,i},removeFromArray:function(e,i){return t.each(e,function(t,n){if(n==i)return e.splice(t,1),!1}),e},getScriptPath:function(e){e=e||t("script:last").attr("src");var i=e.split("/");return 1==i.length?"":(i.pop(),i.join("/")+"/")},animate:function(){var n,a,o,s,l,d,h,c=function(t){var i,n="transition WebkitTransition MozTransition OTransition".split(" ");if(e.opera)return!1;for(i=0;n[i];i++)if("undefined"!=typeof t[n[i]])return n[i];return!1}((r.body||r.documentElement).style),u={MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[c],p={_default:[.25,.1,.25,1],galleria:[.645,.045,.355,1],galleriaIn:[.55,.085,.68,.53],galleriaOut:[.25,.46,.45,.94],ease:[.25,0,.25,1],linear:[.25,.25,.75,.75],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1]},f=function(e,i,n){var r={};n=n||"transition",t.each("webkit moz ms o".split(" "),function(){r["-"+this+"-"+n]=i}),e.css(r)},m=function(t){f(t,"none","transition"),i.WEBKIT&&i.TOUCH&&(f(t,"translate3d(0,0,0)","transform"),t.data("revert")&&(t.css(t.data("revert")),t.data("revert",null)))};return function(r,_,y){return y=t.extend({duration:400,complete:g,stop:!1},y),r=t(r),y.duration?c?(y.stop&&(r.off(u),m(r)),n=!1,t.each(_,function(t,e){h=r.css(t),j.parseValue(h)!=j.parseValue(e)&&(n=!0),r.css(t,h)}),n?(a=[],o=y.easing in p?p[y.easing]:p._default,s=" "+y.duration+"ms cubic-bezier("+o.join(",")+")",void e.setTimeout(function(e,n,r,o){return function(){e.one(n,function(t){return function(){m(t),y.complete.call(t[0])}}(e)),i.WEBKIT&&i.TOUCH&&(l={},d=[0,0,0],t.each(["left","top"],function(t,i){i in r&&(d[t]=j.parseValue(r[i])-j.parseValue(e.css(i))+"px",l[i]=r[i],delete r[i])}),(d[0]||d[1])&&(e.data("revert",l),a.push("-webkit-transform"+o),f(e,"translate3d("+d.join(",")+")","transform"))),t.each(r,function(t){a.push(t+o)}),f(e,a.join(",")),e.css(r)}}(r,u,_,s),2)):void e.setTimeout(function(){y.complete.call(r[0])},y.duration)):void r.animate(_,y):(r.css(_),void y.complete.call(r[0]))}}(),removeAlpha:function(t){if(t instanceof jQuery&&(t=t[0]),y<9&&t){var e=t.style,i=t.currentStyle,n=i&&i.filter||e.filter||"";/alpha/.test(n)&&(e.filter=n.replace(/alpha\([^)]*\)/i,""))}},forceStyles:function(e,i){e=t(e),e.attr("style")&&e.data("styles",e.attr("style")).removeAttr("style"),e.css(i)},revertStyles:function(){t.each(j.array(arguments),function(e,i){i=t(i),i.removeAttr("style"),i.attr("style",""),i.data("styles")&&i.attr("style",i.data("styles")).data("styles",null)})},moveOut:function(t){j.forceStyles(t,{position:"absolute",left:-1e4})},moveIn:function(){j.revertStyles.apply(j,j.array(arguments))},hide:function(e,i,n){n=n||g;var r=t(e);e=r[0],r.data("opacity")||r.data("opacity",r.css("opacity"));var a={opacity:0};if(i){var o=y<9&&e?function(){j.removeAlpha(e),e.style.visibility="hidden",n.call(e)}:n;j.animate(e,a,{duration:i,complete:o,stop:!0})}else y<9&&e?(j.removeAlpha(e),e.style.visibility="hidden"):r.css(a)},show:function(e,i,n){n=n||g;var r=t(e);e=r[0];var a=parseFloat(r.data("opacity"))||1,o={opacity:a};if(i){y<9&&(r.css("opacity",0),e.style.visibility="visible");var s=y<9&&e?function(){1==o.opacity&&j.removeAlpha(e),n.call(e)}:n;j.animate(e,o,{duration:i,complete:s,stop:!0})}else y<9&&1==o.opacity&&e?(j.removeAlpha(e),e.style.visibility="visible"):r.css(o)},wait:function(n){i._waiters=i._waiters||[],n=t.extend({until:_,success:g,error:function(){i.raise("Could not complete wait function.")},timeout:3e3},n);var r,a,o,s=j.timestamp(),l=function(){return a=j.timestamp(),r=a-s,j.removeFromArray(i._waiters,o),n.until(r)?(n.success(),!1):"number"==typeof n.timeout&&a>=s+n.timeout?(n.error(),!1):void i._waiters.push(o=e.setTimeout(l,10))};i._waiters.push(o=e.setTimeout(l,10))},toggleQuality:function(t,e){7!==y&&8!==y||!t||"IMG"!=t.nodeName.toUpperCase()||("undefined"==typeof e&&(e="nearest-neighbor"===t.style.msInterpolationMode),t.style.msInterpolationMode=e?"bicubic":"nearest-neighbor")},insertStyleTag:function(e,i){if(!i||!t("#"+i).length){var n=r.createElement("style");if(i&&(n.id=i),v().head.appendChild(n),n.styleSheet)n.styleSheet.cssText=e;else{var a=r.createTextNode(e);n.appendChild(a)}}},loadScript:function(e,i){var n=!1,r=t("<script>").attr({src:e,async:!0}).get(0);r.onload=r.onreadystatechange=function(){n||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(n=!0,r.onload=r.onreadystatechange=null,"function"==typeof i&&i.call(this,this))},v().head.appendChild(r)},parseValue:function(t){if("number"==typeof t)return t;if("string"==typeof t){var e=t.match(/\-?\d|\./g);return e&&e.constructor===Array?1*e.join(""):0}return 0},timestamp:function(){return(new Date).getTime()},loadCSS:function(e,a,o){var s,l;if(t("link[rel=stylesheet]").each(function(){if(new RegExp(e).test(this.href))return s=this,!1}),"function"==typeof a&&(o=a,a=n),o=o||g,s)return o.call(s,s),s;if(l=r.styleSheets.length,t("#"+a).length)t("#"+a).attr("href",e),l--;else{s=t("<link>").attr({rel:"stylesheet",href:e,id:a}).get(0);var d=t('link[rel="stylesheet"], style');if(d.length?d.get(0).parentNode.insertBefore(s,d[0]):v().head.appendChild(s),y&&l>=31)return void i.raise("You have reached the browser stylesheet limit (31)",!0)}if("function"==typeof o){var h=t("<s>").attr("id","galleria-loader").hide().appendTo(v().body);j.wait({until:function(){return 1==h.height()},success:function(){h.remove(),o.call(s,s)},error:function(){h.remove(),i.raise("Theme CSS could not load after 20 sec. "+(i.QUIRK?"Your browser is in Quirks Mode, please add a correct doctype.":"Please download the latest theme at http://galleria.io/customer/."),!0)},timeout:5e3})}return s}}}(),A=function(e){var i=".galleria-videoicon{width:60px;height:60px;position:absolute;top:50%;left:50%;z-index:1;margin:-30px 0 0 -30px;cursor:pointer;background:#000;background:rgba(0,0,0,.8);border-radius:3px;-webkit-transition:all 150ms}.galleria-videoicon i{width:0px;height:0px;border-style:solid;border-width:10px 0 10px 16px;display:block;border-color:transparent transparent transparent #ffffff;margin:20px 0 0 22px}.galleria-image:hover .galleria-videoicon{background:#000}";return j.insertStyleTag(i,"galleria-videoicon"),t(j.create("galleria-videoicon")).html("<i></i>").appendTo(e).click(function(){t(this).siblings("img").mouseup()})},z=function(){var e=function(e,i,n,r){var a=this.getOptions("easing"),o=this.getStageWidth(),s={left:o*(e.rewind?-1:1)},l={left:0};n?(s.opacity=0,l.opacity=1):s.opacity=1,t(e.next).css(s),j.animate(e.next,l,{duration:e.speed,complete:function(t){return function(){i(),t.css({left:0})}}(t(e.next).add(e.prev)),queue:!1,easing:a}),r&&(e.rewind=!e.rewind),e.prev&&(s={left:0},l={left:o*(e.rewind?1:-1)},n&&(s.opacity=1,l.opacity=0),t(e.prev).css(s),j.animate(e.prev,l,{duration:e.speed,queue:!1,easing:a,complete:function(){t(this).css("opacity",0)}}))};return{active:!1,init:function(t,e,i){z.effects.hasOwnProperty(t)&&z.effects[t].call(this,e,i)},effects:{fade:function(e,i){t(e.next).css({opacity:0,left:0}),j.animate(e.next,{opacity:1},{duration:e.speed,complete:i}),e.prev&&(t(e.prev).css("opacity",1).show(),j.animate(e.prev,{opacity:0},{duration:e.speed}))},flash:function(e,i){t(e.next).css({opacity:0,left:0}),e.prev?j.animate(e.prev,{opacity:0},{duration:e.speed/2,complete:function(){j.animate(e.next,{opacity:1},{duration:e.speed,complete:i})}}):j.animate(e.next,{opacity:1},{duration:e.speed,complete:i})},pulse:function(e,i){e.prev&&t(e.prev).hide(),t(e.next).css({opacity:0,left:0}).show(),j.animate(e.next,{opacity:1},{duration:e.speed,complete:i})},slide:function(){e.apply(this,j.array(arguments))},fadeslide:function(){e.apply(this,j.array(arguments).concat([!0]))},doorslide:function(){e.apply(this,j.array(arguments).concat([!1,!0]))}}}}();M.listen(),t.event.special["click:fast"]={propagate:!0,add:function(i){var n=function(t){if(t.touches&&t.touches.length){var e=t.touches[0];return{x:e.pageX,y:e.pageY}}},r={touched:!1,touchdown:!1,coords:{x:0,y:0},evObj:{}};t(this).data({clickstate:r,timer:0}).on("touchstart.fast",function(i){e.clearTimeout(t(this).data("timer")),t(this).data("clickstate",{touched:!0,touchdown:!0,coords:n(i.originalEvent),evObj:i})}).on("touchmove.fast",function(e){var i=n(e.originalEvent),r=t(this).data("clickstate"),a=Math.max(Math.abs(r.coords.x-i.x),Math.abs(r.coords.y-i.y));a>6&&t(this).data("clickstate",t.extend(r,{touchdown:!1}))}).on("touchend.fast",function(n){var a=t(this),o=a.data("clickstate");o.touchdown&&i.handler.call(this,n),a.data("timer",e.setTimeout(function(){a.data("clickstate",r)},400))}).on("click.fast",function(e){var n=t(this).data("clickstate");return!n.touched&&(t(this).data("clickstate",r),void i.handler.call(this,e))})},remove:function(){t(this).off("touchstart.fast touchmove.fast touchend.fast click.fast")}},o.on("orientationchange",function(){t(this).resize()}),i=function(){var s=this;this._options={},this._playing=!1,this._playtime=5e3,this._active=null,this._queue={length:0},this._data=[],this._dom={},this._thumbnails=[],this._layers=[],this._initialized=!1,this._firstrun=!1,this._stageWidth=0,this._stageHeight=0,this._target=n,this._binds=[],this._id=parseInt(1e4*m.random(),10);var l="container stage images image-nav image-nav-left image-nav-right info info-text info-title info-description thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right loader counter tooltip",d="current total";t.each(l.split(" "),function(t,e){s._dom[e]=j.create("galleria-"+e)}),t.each(d.split(" "),function(t,e){s._dom[e]=j.create("galleria-"+e,"span")});var h=this._keyboard={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:!1,press:function(t){var e=t.keyCode||t.which;e in h.map&&"function"==typeof h.map[e]&&h.map[e].call(s,t)},attach:function(t){var e,i;for(e in t)t.hasOwnProperty(e)&&(i=e.toUpperCase(),i in h.keys?h.map[h.keys[i]]=t[e]:h.map[i]=t[e]);h.bound||(h.bound=!0,a.on("keydown",h.press))},detach:function(){h.bound=!1,h.map={},a.off("keydown",h.press)}},c=this._controls={0:n,1:n,active:0,swap:function(){c.active=c.active?0:1},getActive:function(){return s._options.swipe?c.slides[s._active]:c[c.active]},getNext:function(){return s._options.swipe?c.slides[s.getNext(s._active)]:c[1-c.active]},slides:[],frames:[],layers:[]},p=this._carousel={next:s.$("thumb-nav-right"),prev:s.$("thumb-nav-left"),width:0,current:0,max:0,hooks:[],update:function(){var e=0,i=0,n=[0];t.each(s._thumbnails,function(r,a){if(a.ready){e+=a.outerWidth||t(a.container).outerWidth(!0);var o=t(a.container).width();e+=o-m.floor(o),n[r+1]=e,i=m.max(i,a.outerHeight||t(a.container).outerHeight(!0))}}),s.$("thumbnails").css({width:e,height:i}),p.max=e,p.hooks=n,p.width=s.$("thumbnails-list").width(),p.setClasses(),s.$("thumbnails-container").toggleClass("galleria-carousel",e>p.width),p.width=s.$("thumbnails-list").width()},bindControls:function(){var t;p.next.on("click:fast",function(e){if(e.preventDefault(),"auto"===s._options.carouselSteps){for(t=p.current;t<p.hooks.length;t++)if(p.hooks[t]-p.hooks[p.current]>p.width){p.set(t-2);break}}else p.set(p.current+s._options.carouselSteps)}),p.prev.on("click:fast",function(e){if(e.preventDefault(),"auto"===s._options.carouselSteps)for(t=p.current;t>=0;t--){if(p.hooks[p.current]-p.hooks[t]>p.width){p.set(t+2);break}if(0===t){p.set(0);break}}else p.set(p.current-s._options.carouselSteps)})},set:function(t){for(t=m.max(t,0);p.hooks[t-1]+p.width>=p.max&&t>=0;)t--;p.current=t,p.animate()},getLast:function(t){return(t||p.current)-1},follow:function(t){if(0===t||t===p.hooks.length-2)return void p.set(t);for(var e=p.current;p.hooks[e]-p.hooks[p.current]<p.width&&e<=p.hooks.length;)e++;t-1<p.current?p.set(t-1):t+2>e&&p.set(t-e+p.current+2)},setClasses:function(){p.prev.toggleClass("disabled",!p.current),p.next.toggleClass("disabled",p.hooks[p.current]+p.width>=p.max)},animate:function(){p.setClasses();var e=p.hooks[p.current]*-1;isNaN(e)||(s.$("thumbnails").css("left",function(){return t(this).css("left")}),j.animate(s.get("thumbnails"),{left:e},{duration:s._options.carouselSpeed,easing:s._options.easing,queue:!1}))}},f=this._tooltip={initialized:!1,open:!1,timer:"tooltip"+s._id,swapTimer:"swap"+s._id,init:function(){f.initialized=!0;var t=".galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3;opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}";j.insertStyleTag(t,"galleria-tooltip"),s.$("tooltip").css({opacity:.8,visibility:"visible",display:"none"})},move:function(t){var e=s.getMousePosition(t).x,i=s.getMousePosition(t).y,n=s.$("tooltip"),r=e,a=i,o=n.outerHeight(!0)+1,l=n.outerWidth(!0),d=o+15,h=s.$("container").width()-l-2,c=s.$("container").height()-o-2;isNaN(r)||isNaN(a)||(r+=10,a-=o+8,r=m.max(0,m.min(h,r)),a=m.max(0,m.min(c,a)),i<d&&(a=d),n.css({left:r,top:a}))},bind:function(e,n){if(!i.TOUCH){f.initialized||f.init();var r=function(){s.$("container").off("mousemove",f.move),s.clearTimer(f.timer),s.$("tooltip").stop().animate({opacity:0},200,function(){s.$("tooltip").hide(),s.addTimer(f.swapTimer,function(){f.open=!1},1e3)})},a=function(e,i){f.define(e,i),t(e).hover(function(){s.clearTimer(f.swapTimer),s.$("container").off("mousemove",f.move).on("mousemove",f.move).trigger("mousemove"),f.show(e),s.addTimer(f.timer,function(){s.$("tooltip").stop().show().animate({opacity:1}),f.open=!0},f.open?0:500)},r).click(r)};"string"==typeof n?a(e in s._dom?s.get(e):e,n):t.each(e,function(t,e){a(s.get(t),e)})}},show:function(i){i=t(i in s._dom?s.get(i):i);var n=i.data("tt"),r=function(t){e.setTimeout(function(t){return function(){f.move(t)}}(t),10),i.off("mouseup",r)};n="function"==typeof n?n():n,n&&(s.$("tooltip").html(n.replace(/\s/,"&#160;")),i.on("mouseup",r))},define:function(e,i){if("function"!=typeof i){var n=i;i=function(){return n}}e=t(e in s._dom?s.get(e):e).data("tt",i),f.show(e)}},g=this._fullscreen={scrolled:0,crop:n,active:!1,prev:t(),beforeEnter:function(t){t()},beforeExit:function(t){t()},keymap:s._keyboard.map,parseCallback:function(e,i){return z.active?function(){"function"==typeof e&&e.call(s);var n=s._controls.getActive(),r=s._controls.getNext();s._scaleImage(r),s._scaleImage(n),i&&s._options.trueFullscreen&&t(n.container).add(r.container).trigger("transitionend")}:e},enter:function(t){g.beforeEnter(function(){t=g.parseCallback(t,!0),s._options.trueFullscreen&&M.support?(g.active=!0,j.forceStyles(s.get("container"),{width:"100%",height:"100%"}),s.rescale(),i.MAC?i.SAFARI&&/version\/[1-5]/.test(u)?(s.$("stage").css("opacity",0),e.setTimeout(function(){g.scale(),s.$("stage").css("opacity",1)},4)):(s.$("container").css("opacity",0).addClass("fullscreen"),e.setTimeout(function(){g.scale(),s.$("container").css("opacity",1)},50)):s.$("container").addClass("fullscreen"),o.resize(g.scale),M.enter(s,t,s.get("container"))):(g.scrolled=o.scrollTop(),i.TOUCH||e.scrollTo(0,0),g._enter(t))})},_enter:function(a){g.active=!0,b&&(g.iframe=function(){var n,a=r.referrer,o=r.createElement("a"),s=e.location;return o.href=a,o.protocol!=s.protocol||o.hostname!=s.hostname||o.port!=s.port?(i.raise("Parent fullscreen not available. Iframe protocol, domains and ports must match."),!1):(g.pd=e.parent.document,t(g.pd).find("iframe").each(function(){var t=this.contentDocument||this.contentWindow.document;if(t===r)return n=this,!1}),n)}()),j.hide(s.getActiveImage()),b&&g.iframe&&(g.iframe.scrolled=t(e.parent).scrollTop(),e.parent.scrollTo(0,0));var l=s.getData(),d=s._options,h=!s._options.trueFullscreen||!M.support,c={height:"100%",overflow:"hidden",margin:0,padding:0};if(h&&(s.$("container").addClass("fullscreen"),g.prev=s.$("container").prev(),g.prev.length||(g.parent=s.$("container").parent()),s.$("container").appendTo("body"),j.forceStyles(s.get("container"),{position:i.TOUCH?"absolute":"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1e4}),j.forceStyles(v().html,c),j.forceStyles(v().body,c)),b&&g.iframe&&(j.forceStyles(g.pd.documentElement,c),j.forceStyles(g.pd.body,c),j.forceStyles(g.iframe,t.extend(c,{width:"100%",height:"100%",top:0,left:0,position:"fixed",zIndex:1e4,border:"none"}))),g.keymap=t.extend({},s._keyboard.map),s.attachKeyboard({escape:s.exitFullscreen,right:s.next,left:s.prev}),g.crop=d.imageCrop,d.fullscreenCrop!=n&&(d.imageCrop=d.fullscreenCrop),l&&l.big&&l.image!==l.big){var u=new i.Picture,p=u.isCached(l.big),f=s.getIndex(),m=s._thumbnails[f];s.trigger({type:i.LOADSTART,cached:p,rewind:!1,index:f,imageTarget:s.getActiveImage(),thumbTarget:m,galleriaData:l}),u.load(l.big,function(e){s._scaleImage(e,{complete:function(e){s.trigger({type:i.LOADFINISH,cached:p,index:f,rewind:!1,imageTarget:e.image,thumbTarget:m});var n=s._controls.getActive().image;n&&t(n).width(e.image.width).height(e.image.height).attr("style",t(e.image).attr("style")).attr("src",e.image.src)}})});var _=s.getNext(f),y=new i.Picture,w=s.getData(_);y.preload(s.isFullscreen()&&w.big?w.big:w.image)}s.rescale(function(){s.addTimer(!1,function(){h&&j.show(s.getActiveImage()),"function"==typeof a&&a.call(s),s.rescale()},100),s.trigger(i.FULLSCREEN_ENTER)}),h?o.resize(g.scale):j.show(s.getActiveImage())},scale:function(){s.rescale()},exit:function(t){g.beforeExit(function(){t=g.parseCallback(t),s._options.trueFullscreen&&M.support?M.exit(t):g._exit(t)})},_exit:function(t){g.active=!1;var n=!s._options.trueFullscreen||!M.support,r=s.$("container").removeClass("fullscreen");if(g.parent?g.parent.prepend(r):r.insertAfter(g.prev),n){j.hide(s.getActiveImage()),j.revertStyles(s.get("container"),v().html,v().body),i.TOUCH||e.scrollTo(0,g.scrolled);var a=s._controls.frames[s._controls.active];a&&a.image&&(a.image.src=a.image.src)}b&&g.iframe&&(j.revertStyles(g.pd.documentElement,g.pd.body,g.iframe),g.iframe.scrolled&&e.parent.scrollTo(0,g.iframe.scrolled)),s.detachKeyboard(),s.attachKeyboard(g.keymap),s._options.imageCrop=g.crop;var l=s.getData().big,d=s._controls.getActive().image;!s.getData().iframe&&d&&l&&l==d.src&&e.setTimeout(function(t){return function(){d.src=t}}(s.getData().image),1),s.rescale(function(){s.addTimer(!1,function(){n&&j.show(s.getActiveImage()),"function"==typeof t&&t.call(s),o.trigger("resize")},50),s.trigger(i.FULLSCREEN_EXIT)}),o.off("resize",g.scale)}},_=this._idle={trunk:[],bound:!1,active:!1,add:function(e,n,r,a){if(e&&!i.TOUCH){_.bound||_.addEvent(),e=t(e),"boolean"==typeof r&&(a=r,r={}),r=r||{};var o,s={};for(o in n)n.hasOwnProperty(o)&&(s[o]=e.css(o));e.data("idle",{from:t.extend(s,r),to:n,complete:!0,busy:!1}),a?e.css(n):_.addTimer(),_.trunk.push(e)}},remove:function(e){e=t(e),t.each(_.trunk,function(t,i){i&&i.length&&!i.not(e).length&&(e.css(e.data("idle").from),_.trunk.splice(t,1))}),_.trunk.length||(_.removeEvent(),s.clearTimer(_.timer))},addEvent:function(){_.bound=!0,s.$("container").on("mousemove click",_.showAll),"hover"==s._options.idleMode&&s.$("container").on("mouseleave",_.hide)},removeEvent:function(){_.bound=!1,s.$("container").on("mousemove click",_.showAll),"hover"==s._options.idleMode&&s.$("container").off("mouseleave",_.hide)},addTimer:function(){"hover"!=s._options.idleMode&&s.addTimer("idle",function(){_.hide()},s._options.idleTime)},hide:function(){if(s._options.idleMode&&s.getIndex()!==!1){s.trigger(i.IDLE_ENTER);var e=_.trunk.length;t.each(_.trunk,function(t,i){var n=i.data("idle");n&&(i.data("idle").complete=!1,
j.animate(i,n.to,{duration:s._options.idleSpeed,complete:function(){t==e-1&&(_.active=!1)}}))})}},showAll:function(){s.clearTimer("idle"),t.each(_.trunk,function(t,e){_.show(e)})},show:function(e){var n=e.data("idle");_.active&&(n.busy||n.complete)||(n.busy=!0,s.trigger(i.IDLE_EXIT),s.clearTimer("idle"),j.animate(e,n.from,{duration:s._options.idleSpeed/2,complete:function(){_.active=!0,t(e).data("idle").busy=!1,t(e).data("idle").complete=!0}})),_.addTimer()}},w=this._lightbox={width:0,height:0,initialized:!1,active:null,image:null,elems:{},keymap:!1,init:function(){if(!w.initialized){w.initialized=!0;var e="overlay box content shadow title info close prevholder prev nextholder next counter image",n={},r=s._options,a="",o="position:absolute;",l="lightbox-",d={overlay:"position:fixed;display:none;opacity:"+r.overlayOpacity+";filter:alpha(opacity="+100*r.overlayOpacity+");top:0;left:0;width:100%;height:100%;background:"+r.overlayBackground+";z-index:99990",box:"position:fixed;display:none;width:400px;height:400px;top:50%;left:50%;margin-top:-200px;margin-left:-200px;z-index:99991",shadow:o+"background:#000;width:100%;height:100%;",content:o+"background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden",info:o+"bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px",close:o+"top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999",image:o+"top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;",prevholder:o+"width:50%;top:0;bottom:40px;cursor:pointer;",nextholder:o+"width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;",prev:o+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif",next:o+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000",title:"float:left",counter:"float:right;margin-left:8px;"},h=function(e){return e.hover(function(){t(this).css("color","#bbb")},function(){t(this).css("color","#444")})},c={},u="";u=y>7?y<9?"background:#000;filter:alpha(opacity=0);":"background:rgba(0,0,0,0);":"z-index:99999",d.nextholder+=u,d.prevholder+=u,t.each(d,function(t,e){a+=".galleria-"+l+t+"{"+e+"}"}),a+=".galleria-"+l+"box.iframe .galleria-"+l+"prevholder,.galleria-"+l+"box.iframe .galleria-"+l+"nextholder{width:100px;height:100px;top:50%;margin-top:-70px}",j.insertStyleTag(a,"galleria-lightbox"),t.each(e.split(" "),function(t,e){s.addElement("lightbox-"+e),n[e]=w.elems[e]=s.get("lightbox-"+e)}),w.image=new i.Picture,t.each({box:"shadow content close prevholder nextholder",info:"title counter",content:"info image",prevholder:"prev",nextholder:"next"},function(e,i){var n=[];t.each(i.split(" "),function(t,e){n.push(l+e)}),c[l+e]=n}),s.append(c),t(n.image).append(w.image.container),t(v().body).append(n.overlay,n.box),h(t(n.close).on("click:fast",w.hide).html("&#215;")),t.each(["Prev","Next"],function(e,r){var a=t(n[r.toLowerCase()]).html(/v/.test(r)?"&#8249;&#160;":"&#160;&#8250;"),o=t(n[r.toLowerCase()+"holder"]);return o.on("click:fast",function(){w["show"+r]()}),y<8||i.TOUCH?void a.show():void o.hover(function(){a.show()},function(){a.stop().fadeOut(200)})}),t(n.overlay).on("click:fast",w.hide),i.IPAD&&(s._options.lightboxTransitionSpeed=0)}},rescale:function(e){var n=m.min(o.width()-40,w.width),r=m.min(o.height()-60,w.height),a=m.min(n/w.width,r/w.height),l=m.round(w.width*a)+40,d=m.round(w.height*a)+60,h={width:l,height:d,"margin-top":m.ceil(d/2)*-1,"margin-left":m.ceil(l/2)*-1};e?t(w.elems.box).css(h):t(w.elems.box).animate(h,{duration:s._options.lightboxTransitionSpeed,easing:s._options.easing,complete:function(){var e=w.image,n=s._options.lightboxFadeSpeed;s.trigger({type:i.LIGHTBOX_IMAGE,imageTarget:e.image}),t(e.container).show(),t(e.image).animate({opacity:1},n),j.show(w.elems.info,n)}})},hide:function(){w.image.image=null,o.off("resize",w.rescale),t(w.elems.box).hide().find("iframe").remove(),j.hide(w.elems.info),s.detachKeyboard(),s.attachKeyboard(w.keymap),w.keymap=!1,j.hide(w.elems.overlay,200,function(){t(this).hide().css("opacity",s._options.overlayOpacity),s.trigger(i.LIGHTBOX_CLOSE)})},showNext:function(){w.show(s.getNext(w.active))},showPrev:function(){w.show(s.getPrev(w.active))},show:function(n){w.active=n="number"==typeof n?n:s.getIndex()||0,w.initialized||w.init(),s.trigger(i.LIGHTBOX_OPEN),w.keymap||(w.keymap=t.extend({},s._keyboard.map),s.attachKeyboard({escape:w.hide,right:w.showNext,left:w.showPrev})),o.off("resize",w.rescale);var r,a,l,d=s.getData(n),h=s.getDataLength(),c=s.getNext(n);j.hide(w.elems.info);try{for(l=s._options.preload;l>0;l--)a=new i.Picture,r=s.getData(c),a.preload(r.big?r.big:r.image),c=s.getNext(c)}catch(t){}w.image.isIframe=d.iframe&&!d.image,t(w.elems.box).toggleClass("iframe",w.image.isIframe),t(w.image.container).find(".galleria-videoicon").remove(),w.image.load(d.big||d.image||d.iframe,function(i){if(i.isIframe){var r=t(e).width(),a=t(e).height();if(i.video&&s._options.maxVideoSize){var l=m.min(s._options.maxVideoSize/r,s._options.maxVideoSize/a);l<1&&(r*=l,a*=l)}w.width=r,w.height=a}else w.width=i.original.width,w.height=i.original.height;if(t(i.image).css({width:i.isIframe?"100%":"100.1%",height:i.isIframe?"100%":"100.1%",top:0,bottom:0,zIndex:99998,opacity:0,visibility:"visible"}).parent().height("100%"),w.elems.title.innerHTML=d.title||"",w.elems.counter.innerHTML=n+1+" / "+h,o.resize(w.rescale),w.rescale(),d.image&&d.iframe){if(t(w.elems.box).addClass("iframe"),d.video){var c=A(i.container).hide();e.setTimeout(function(){c.fadeIn(200)},200)}t(i.image).css("cursor","pointer").mouseup(function(e,i){return function(n){t(w.image.container).find(".galleria-videoicon").remove(),n.preventDefault(),i.isIframe=!0,i.load(e.iframe+(e.video?"&autoplay=1":""),{width:"100%",height:y<8?t(w.image.container).height():"100%"})}}(d,i))}}),t(w.elems.overlay).show().css("visibility","visible"),t(w.elems.box).show()}},x=this._timer={trunk:{},add:function(t,i,n,r){if(t=t||(new Date).getTime(),r=r||!1,this.clear(t),r){var a=i;i=function(){a(),x.add(t,i,n)}}this.trunk[t]=e.setTimeout(i,n)},clear:function(t){var i,n=function(t){e.clearTimeout(this.trunk[t]),delete this.trunk[t]};if(t&&t in this.trunk)n.call(this,t);else if("undefined"==typeof t)for(i in this.trunk)this.trunk.hasOwnProperty(i)&&n.call(this,i)}};return this},i.prototype={constructor:i,init:function(e,r){if(r=k(r),this._original={target:e,options:r,data:null},this._target=this._dom.target=e.nodeName?e:t(e).get(0),this._original.html=this._target.innerHTML,D.push(this),!this._target)return void i.raise("Target not found",!0);if(this._options={autoplay:!1,carousel:!0,carouselFollow:!0,carouselSpeed:400,carouselSteps:"auto",clicknext:!1,dailymotion:{foreground:"%23EEEEEE",highlight:"%235BCEC5",background:"%23222222",logo:0,hideInfos:1},dataConfig:function(){return{}},dataSelector:"img",dataSort:!1,dataSource:this._target,debug:n,dummy:n,easing:"galleria",extend:function(){},fullscreenCrop:n,fullscreenDoubleTap:!0,fullscreenTransition:n,height:0,idleMode:!0,idleTime:3e3,idleSpeed:200,imageCrop:!1,imageMargin:0,imagePan:!1,imagePanSmoothness:12,imagePosition:"50%",imageTimeout:n,initialTransition:n,keepSource:!1,layerFollow:!0,lightbox:!1,lightboxFadeSpeed:200,lightboxTransitionSpeed:200,linkSourceImages:!0,maxScaleRatio:n,maxVideoSize:n,minScaleRatio:n,overlayOpacity:.85,overlayBackground:"#0b0b0b",pauseOnInteraction:!0,popupLinks:!1,preload:2,queue:!0,responsive:!0,show:0,showInfo:!0,showCounter:!0,showImagenav:!0,swipe:"auto",theme:null,thumbCrop:!0,thumbEventType:"click:fast",thumbMargin:0,thumbQuality:"auto",thumbDisplayOrder:!0,thumbPosition:"50%",thumbnails:!0,touchTransition:n,transition:"fade",transitionInitial:n,transitionSpeed:400,trueFullscreen:!0,useCanvas:!1,variation:"",videoPoster:!0,vimeo:{title:0,byline:0,portrait:0,color:"aaaaaa"},wait:5e3,width:"auto",youtube:{modestbranding:1,autohide:1,color:"white",hd:1,rel:0,showinfo:0}},this._options.initialTransition=this._options.initialTransition||this._options.transitionInitial,r&&(r.debug===!1&&(d=!1),"number"==typeof r.imageTimeout&&(h=r.imageTimeout),"string"==typeof r.dummy&&(c=r.dummy),"string"==typeof r.theme&&(this._options.theme=r.theme)),t(this._target).children().hide(),i.QUIRK&&i.raise("Your page is in Quirks mode, Galleria may not render correctly. Please validate your HTML and add a correct doctype."),U.length)if(this._options.theme){for(var a=0;a<U.length;a++)if(this._options.theme===U[a].name){this.theme=U[a];break}}else this.theme=U[0];return"object"==typeof this.theme?this._init():E.push(this),this},_init:function(){var a=this,s=this._options;if(this._initialized)return i.raise("Init failed: Gallery instance already initialized."),this;if(this._initialized=!0,!this.theme)return i.raise("Init failed: No theme found.",!0),this;if(t.extend(!0,s,this.theme.defaults,this._original.options,i.configure.options),s.swipe=function(t){return"enforced"==t||t!==!1&&"disabled"!=t&&!!i.TOUCH}(s.swipe),s.swipe&&(s.clicknext=!1,s.imagePan=!1),!function(t){return"getContext"in t?void(I=I||{elem:t,context:t.getContext("2d"),cache:{},length:0}):void(t=null)}(r.createElement("canvas")),this.bind(i.DATA,function(){e.screen&&e.screen.width&&Array.prototype.forEach&&this._data.forEach(function(t){var i="devicePixelRatio"in e?e.devicePixelRatio:1,n=m.max(e.screen.width,e.screen.height);n*i<1024&&(t.big=t.image)}),this._original.data=this._data,this.get("total").innerHTML=this.getDataLength();var t=this.$("container");a._options.height<2&&(a._userRatio=a._ratio=a._options.height);var n={width:0,height:0},r=function(){return a.$("stage").height()};j.wait({until:function(){return n=a._getWH(),t.width(n.width).height(n.height),r()&&n.width&&n.height>50},success:function(){a._width=n.width,a._height=n.height,a._ratio=a._ratio||n.height/n.width,i.WEBKIT?e.setTimeout(function(){a._run()},1):a._run()},error:function(){r()?i.raise("Could not extract sufficient width/height of the gallery container. Traced measures: width:"+n.width+"px, height: "+n.height+"px.",!0):i.raise("Could not extract a stage height from the CSS. Traced height: "+r()+"px.",!0)},timeout:"number"==typeof this._options.wait&&this._options.wait})}),this.append({"info-text":["info-title","info-description"],info:["info-text"],"image-nav":["image-nav-right","image-nav-left"],stage:["images","loader","counter","image-nav"],"thumbnails-list":["thumbnails"],"thumbnails-container":["thumb-nav-left","thumbnails-list","thumb-nav-right"],container:["stage","thumbnails-container","info","tooltip"]}),j.hide(this.$("counter").append(this.get("current"),r.createTextNode(" / "),this.get("total"))),this.setCounter("&#8211;"),j.hide(a.get("tooltip")),this.$("container").addClass([i.TOUCH?"touch":"notouch",this._options.variation,"galleria-theme-"+this.theme.name].join(" ")),this._options.swipe||t.each(new Array(2),function(e){var n=new i.Picture;t(n.container).css({position:"absolute",top:0,left:0}).prepend(a._layers[e]=t(j.create("galleria-layer")).css({position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:2})[0]),a.$("images").append(n.container),a._controls[e]=n;var r=new i.Picture;r.isIframe=!0,t(r.container).attr("class","galleria-frame").css({position:"absolute",top:0,left:0,zIndex:4,background:"#000",display:"none"}).appendTo(n.container),a._controls.frames[e]=r}),this.$("images").css({position:"relative",top:0,left:0,width:"100%",height:"100%"}),s.swipe&&(this.$("images").css({position:"absolute",top:0,left:0,width:0,height:"100%"}),this.finger=new i.Finger(this.get("stage"),{onchange:function(t){a.pause().show(t)},oncomplete:function(e){var i=m.max(0,m.min(parseInt(e,10),a.getDataLength()-1)),n=a.getData(i);t(a._thumbnails[i].container).addClass("active").siblings(".active").removeClass("active"),n&&(a.$("images").find(".galleria-frame").css("opacity",0).hide().find("iframe").remove(),a._options.carousel&&a._options.carouselFollow&&a._carousel.follow(i))}}),this.bind(i.RESCALE,function(){this.finger.setup()}),this.$("stage").on("click",function(){var i=a.getData();if(i){if(i.iframe){a.isPlaying()&&a.pause();var r=a._controls.frames[a._active],o=a._stageWidth,s=a._stageHeight;if(t(r.container).find("iframe").length)return;return t(r.container).css({width:o,height:s,opacity:0}).show().animate({opacity:1},200),void e.setTimeout(function(){r.load(i.iframe+(i.video?"&autoplay=1":""),{width:o,height:s},function(t){a.$("container").addClass("videoplay"),t.scale({width:a._stageWidth,height:a._stageHeight,iframelimit:i.video?a._options.maxVideoSize:n})})},100)}if(i.link)if(a._options.popupLinks){e.open(i.link,"_blank")}else e.location.href=i.link;else;}}),this.bind(i.IMAGE,function(e){a.setCounter(e.index),a.setInfo(e.index);var i=this.getNext(),n=this.getPrev(),r=[n,i];r.push(this.getNext(i),this.getPrev(n),a._controls.slides.length-1);var o=[];t.each(r,function(e,i){t.inArray(i,o)==-1&&o.push(i)}),t.each(o,function(e,i){var n=a.getData(i),r=a._controls.slides[i],o=a.isFullscreen()&&n.big?n.big:n.image||n.iframe;n.iframe&&!n.image&&(r.isIframe=!0),r.ready||a._controls.slides[i].load(o,function(e){e.isIframe||t(e.image).css("visibility","hidden"),a._scaleImage(e,{complete:function(e){e.isIframe||t(e.image).css({opacity:0,visibility:"visible"}).animate({opacity:1},200)}})})})})),this.$("thumbnails, thumbnails-list").css({overflow:"hidden",position:"relative"}),this.$("image-nav-right, image-nav-left").on("click:fast",function(){s.pauseOnInteraction&&a.pause();var t=/right/.test(this.className)?"next":"prev";a[t]()}).on("click",function(t){t.preventDefault(),(s.clicknext||s.swipe)&&t.stopPropagation()}),t.each(["info","counter","image-nav"],function(t,e){s["show"+e.substr(0,1).toUpperCase()+e.substr(1).replace(/-/,"")]===!1&&j.moveOut(a.get(e.toLowerCase()))}),this.load(),s.keepSource||y||(this._target.innerHTML=""),this.get("errors")&&this.appendChild("target","errors"),this.appendChild("target","container"),s.carousel){var l=0,d=s.show;this.bind(i.THUMBNAIL,function(){this.updateCarousel(),++l==this.getDataLength()&&"number"==typeof d&&d>0&&this._carousel.follow(d)})}return s.responsive&&o.on("resize",function(){a.isFullscreen()||a.resize()}),s.fullscreenDoubleTap&&this.$("stage").on("touchstart",function(){var t,e,i,n,r,o,s=function(t){return t.originalEvent.touches?t.originalEvent.touches[0]:t};return a.$("stage").on("touchmove",function(){t=0}),function(l){if(!/(-left|-right)/.test(l.target.className)){if(o=j.timestamp(),e=s(l).pageX,i=s(l).pageY,l.originalEvent.touches.length<2&&o-t<300&&e-n<20&&i-r<20)return a.toggleFullscreen(),void l.preventDefault();t=o,n=e,r=i}}}()),t.each(i.on.binds,function(e,i){t.inArray(i.hash,a._binds)==-1&&a.bind(i.type,i.callback)}),this},addTimer:function(){return this._timer.add.apply(this._timer,j.array(arguments)),this},clearTimer:function(){return this._timer.clear.apply(this._timer,j.array(arguments)),this},_getWH:function(){var e,i=this.$("container"),n=this.$("target"),r=this,a={};return t.each(["width","height"],function(t,o){r._options[o]&&"number"==typeof r._options[o]?a[o]=r._options[o]:(e=[j.parseValue(i.css(o)),j.parseValue(n.css(o)),i[o](),n[o]()],r["_"+o]||e.splice(e.length,j.parseValue(i.css("min-"+o)),j.parseValue(n.css("min-"+o))),a[o]=m.max.apply(m,e))}),r._userRatio&&(a.height=a.width*r._userRatio),a},_createThumbnails:function(n){this.get("total").innerHTML=this.getDataLength();var a,o,s,l,d=this,h=this._options,c=n?this._data.length-n.length:0,u=c,p=[],f=0,m=y<8?"http://upload.wikimedia.org/wikipedia/commons/c/c0/Blank.gif":"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw%3D%3D",g=function(){var t=d.$("thumbnails").find(".active");return!!t.length&&t.find("img").attr("src")}(),_="string"==typeof h.thumbnails?h.thumbnails.toLowerCase():null,v=function(t){return r.defaultView&&r.defaultView.getComputedStyle?r.defaultView.getComputedStyle(o.container,null)[t]:l.css(t)},b=function(e,n,r){return function(){t(r).append(e),d.trigger({type:i.THUMBNAIL,thumbTarget:e,index:n,galleriaData:d.getData(n)})}},w=function(e){h.pauseOnInteraction&&d.pause();var i=t(e.currentTarget).data("index");d.getIndex()!==i&&d.show(i),e.preventDefault()},x=function(e,n){t(e.container).css("visibility","visible"),d.trigger({type:i.THUMBNAIL,thumbTarget:e.image,index:e.data.order,galleriaData:d.getData(e.data.order)}),"function"==typeof n&&n.call(d,e)},k=function(e,i){e.scale({width:e.data.width,height:e.data.height,crop:h.thumbCrop,margin:h.thumbMargin,canvas:h.useCanvas,position:h.thumbPosition,complete:function(e){var n,r,a=["left","top"],o=["Width","Height"];d.getData(e.index);t.each(o,function(i,o){n=o.toLowerCase(),h.thumbCrop===!0&&h.thumbCrop!==n||(r={},r[n]=e[n],t(e.container).css(r),r={},r[a[i]]=0,t(e.image).css(r)),e["outer"+o]=t(e.container)["outer"+o](!0)}),j.toggleQuality(e.image,h.thumbQuality===!0||"auto"===h.thumbQuality&&e.original.width<3*e.width),h.thumbDisplayOrder&&!e.lazy?t.each(p,function(t,e){if(t===f&&e.ready&&!e.displayed)return f++,e.displayed=!0,void x(e,i)}):x(e,i)}})};for(n||(this._thumbnails=[],this.$("thumbnails").empty());this._data[c];c++)s=this._data[c],a=s.thumb||s.image,h.thumbnails!==!0&&"lazy"!=_||!s.thumb&&!s.image?s.iframe&&null!==_||"empty"===_||"numbers"===_?(o={container:j.create("galleria-image"),image:j.create("img","span"),ready:!0,data:{order:c}},"numbers"===_&&t(o.image).text(c+1),s.iframe&&t(o.image).addClass("iframe"),this.$("thumbnails").append(o.container),e.setTimeout(b(o.image,c,o.container),50+20*c)):o={container:null,image:null}:(o=new i.Picture(c),o.index=c,o.displayed=!1,o.lazy=!1,o.video=!1,this.$("thumbnails").append(o.container),l=t(o.container),l.css("visibility","hidden"),o.data={width:j.parseValue(v("width")),height:j.parseValue(v("height")),order:c,src:a},h.thumbCrop!==!0?l.css({width:"auto",height:"auto"}):l.css({width:o.data.width,height:o.data.height}),"lazy"==_?(l.addClass("lazy"),o.lazy=!0,o.load(m,{height:o.data.height,width:o.data.width})):o.load(a,k),"all"===h.preload&&o.preload(s.image)),t(o.container).add(h.keepSource&&h.linkSourceImages?s.original:null).data("index",c).on(h.thumbEventType,w).data("thumbload",k),g===a&&t(o.container).addClass("active"),this._thumbnails.push(o);return p=this._thumbnails.slice(u),this},lazyLoad:function(e,i){var n=e.constructor==Array?e:[e],r=this,a=0;return t.each(n,function(e,o){if(!(o>r._thumbnails.length-1)){var s=r._thumbnails[o],l=s.data,d=function(){++a==n.length&&"function"==typeof i&&i.call(r)},h=t(s.container).data("thumbload");s.video?h.call(r,s,d):s.load(l.src,function(t){h.call(r,t,d)})}}),this},lazyLoadChunks:function(t,i){var n=this.getDataLength(),r=0,a=0,o=[],s=[],l=this;for(i=i||0;r<n;r++)s.push(r),++a!=t&&r!=n-1||(o.push(s),a=0,s=[]);var d=function(t){var n=o.shift();n&&e.setTimeout(function(){l.lazyLoad(n,function(){d(!0)})},i&&t?i:0)};return d(!1),this},_run:function(){var r=this;r._createThumbnails(),j.wait({timeout:1e4,until:function(){return i.OPERA&&r.$("stage").css("display","inline-block"),r._stageWidth=r.$("stage").width(),r._stageHeight=r.$("stage").height(),r._stageWidth&&r._stageHeight>50},success:function(){if(P.push(r),r._options.swipe){var a=r.$("images").width(r.getDataLength()*r._stageWidth);t.each(new Array(r.getDataLength()),function(e){var n=new i.Picture,o=r.getData(e);t(n.container).css({position:"absolute",top:0,left:r._stageWidth*e}).prepend(r._layers[e]=t(j.create("galleria-layer")).css({position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:2})[0]).appendTo(a),o.video&&A(n.container),r._controls.slides.push(n);var s=new i.Picture;s.isIframe=!0,t(s.container).attr("class","galleria-frame").css({position:"absolute",top:0,left:0,zIndex:4,background:"#000",display:"none"}).appendTo(n.container),r._controls.frames.push(s)}),r.finger.setup()}return j.show(r.get("counter")),r._options.carousel&&r._carousel.bindControls(),r._options.autoplay&&(r.pause(),"number"==typeof r._options.autoplay&&(r._playtime=r._options.autoplay),r._playing=!0),r._firstrun?(r._options.autoplay&&r.trigger(i.PLAY),void("number"==typeof r._options.show&&r.show(r._options.show))):(r._firstrun=!0,i.History&&i.History.change(function(t){isNaN(t)?e.history.go(-1):r.show(t,n,!0)}),r.trigger(i.READY),r.theme.init.call(r,r._options),t.each(i.ready.callbacks,function(t,e){"function"==typeof e&&e.call(r,r._options)}),r._options.extend.call(r,r._options),/^[0-9]{1,4}$/.test(p)&&i.History?r.show(p,n,!0):r._data[r._options.show]&&r.show(r._options.show),void(r._options.autoplay&&r.trigger(i.PLAY)))},error:function(){i.raise("Stage width or height is too small to show the gallery. Traced measures: width:"+r._stageWidth+"px, height: "+r._stageHeight+"px.",!0)}})},load:function(e,n,r){var a=this,o=this._options;return this._data=[],this._thumbnails=[],this.$("thumbnails").empty(),"function"==typeof n&&(r=n,n=null),e=e||o.dataSource,n=n||o.dataSelector,r=r||o.dataConfig,t.isPlainObject(e)&&(e=[e]),t.isArray(e)?this.validate(e)?this._data=e:i.raise("Load failed: JSON Array not valid."):(n+=",.video,.iframe",t(e).find(n).each(function(e,i){i=t(i);var n={},o=i.parent(),s=o.attr("href"),l=o.attr("rel");s&&("IMG"==i[0].nodeName||i.hasClass("video"))&&$(s)?n.video=s:s&&i.hasClass("iframe")?n.iframe=s:n.image=n.big=s,l&&(n.big=l),t.each("big title description link layer image".split(" "),function(t,e){i.data(e)&&(n[e]=i.data(e).toString())}),n.big||(n.big=n.image),a._data.push(t.extend({title:i.attr("title")||"",thumb:i.attr("src"),image:i.attr("src"),big:i.attr("src"),description:i.attr("alt")||"",link:i.attr("longdesc"),original:i.get(0)},n,r(i)))})),"function"==typeof o.dataSort?s.sort.call(this._data,o.dataSort):"random"==o.dataSort&&this._data.sort(function(){return m.round(m.random())-.5}),this.getDataLength()&&this._parseData(function(){this.trigger(i.DATA)}),this},_parseData:function(e){var i,r=this,a=!1,o=function(){var i=!0;t.each(r._data,function(t,e){if(e.loading)return i=!1,!1}),i&&!a&&(a=!0,e.call(r))};return t.each(this._data,function(e,a){if(i=r._data[e],"thumb"in a==!1&&(i.thumb=a.image),a.big||(i.big=a.image),"video"in a){var s=$(a.video);s&&(i.iframe=new T(s.provider,s.id).embed()+function(){if("object"==typeof r._options[s.provider]){var e="?",i=[];return t.each(r._options[s.provider],function(t,e){i.push(t+"="+e)}),"youtube"==s.provider&&(i=["wmode=opaque"].concat(i)),e+i.join("&")}return""}(),i.thumb&&i.image||t.each(["thumb","image"],function(t,e){if("image"==e&&!r._options.videoPoster)return void(i.image=n);var a=new T(s.provider,s.id);i[e]||(i.loading=!0,a.getMedia(e,function(t,e){return function(i){t[e]=i,"image"!=e||t.big||(t.big=t.image),delete t.loading,o()}}(i,e)))}))}}),o(),this},destroy:function(){return this.$("target").data("galleria",null),this.$("container").off("galleria"),this.get("target").innerHTML=this._original.html,this.clearTimer(),j.removeFromArray(D,this),j.removeFromArray(P,this),i._waiters.length&&t.each(i._waiters,function(t,i){i&&e.clearTimeout(i)}),this},splice:function(){var t=this,i=j.array(arguments);return e.setTimeout(function(){s.splice.apply(t._data,i),t._parseData(function(){t._createThumbnails()})},2),t},push:function(){var t=this,i=j.array(arguments);return 1==i.length&&i[0].constructor==Array&&(i=i[0]),e.setTimeout(function(){s.push.apply(t._data,i),t._parseData(function(){t._createThumbnails(i)})},2),t},_getActive:function(){return this._controls.getActive()},validate:function(){return!0},bind:function(t,e){return t=L(t),this.$("container").on(t,this.proxy(e)),this},unbind:function(t){return t=L(t),this.$("container").off(t),this},trigger:function(e){return e="object"==typeof e?t.extend(e,{scope:this}):{type:L(e),scope:this},this.$("container").trigger(e),this},addIdleState:function(){return this._idle.add.apply(this._idle,j.array(arguments)),this},removeIdleState:function(){return this._idle.remove.apply(this._idle,j.array(arguments)),this},enterIdleMode:function(){return this._idle.hide(),this},exitIdleMode:function(){return this._idle.showAll(),this},enterFullscreen:function(){return this._fullscreen.enter.apply(this,j.array(arguments)),this},exitFullscreen:function(){return this._fullscreen.exit.apply(this,j.array(arguments)),this},toggleFullscreen:function(){return this._fullscreen[this.isFullscreen()?"exit":"enter"].apply(this,j.array(arguments)),this},bindTooltip:function(){return this._tooltip.bind.apply(this._tooltip,j.array(arguments)),this},defineTooltip:function(){return this._tooltip.define.apply(this._tooltip,j.array(arguments)),this},refreshTooltip:function(){return this._tooltip.show.apply(this._tooltip,j.array(arguments)),this},openLightbox:function(){return this._lightbox.show.apply(this._lightbox,j.array(arguments)),this},closeLightbox:function(){return this._lightbox.hide.apply(this._lightbox,j.array(arguments)),this},hasVariation:function(e){return t.inArray(e,this._options.variation.split(/\s+/))>-1},getActiveImage:function(){var t=this._getActive();return t?t.image:n},getActiveThumb:function(){return this._thumbnails[this._active].image||n},getMousePosition:function(t){return{x:t.pageX-this.$("container").offset().left,y:t.pageY-this.$("container").offset().top}},addPan:function(e){if(this._options.imageCrop!==!1){e=t(e||this.getActiveImage());var i=this,n=e.width()/2,r=e.height()/2,a=parseInt(e.css("left"),10),o=parseInt(e.css("top"),10),s=a||0,l=o||0,d=0,h=0,c=!1,u=j.timestamp(),p=0,f=0,g=function(t,i,n){if(t>0&&(f=m.round(m.max(t*-1,m.min(0,i))),p!==f))if(p=f,8===y)e.parent()["scroll"+n](f*-1);else{var r={};r[n.toLowerCase()]=f,e.css(r)}},_=function(t){j.timestamp()-u<50||(c=!0,n=i.getMousePosition(t).x,r=i.getMousePosition(t).y)},v=function(){c&&(d=e.width()-i._stageWidth,h=e.height()-i._stageHeight,a=n/i._stageWidth*d*-1,o=r/i._stageHeight*h*-1,s+=(a-s)/i._options.imagePanSmoothness,l+=(o-l)/i._options.imagePanSmoothness,g(h,l,"Top"),g(d,s,"Left"))};return 8===y&&(e.parent().scrollTop(l*-1).scrollLeft(s*-1),e.css({top:0,left:0})),this.$("stage").off("mousemove",_).on("mousemove",_),this.addTimer("pan"+i._id,v,50,!0),this}},proxy:function(t,e){return"function"!=typeof t?g:(e=e||this,function(){return t.apply(e,j.array(arguments))})},getThemeName:function(){return this.theme.name},removePan:function(){return this.$("stage").off("mousemove"),this.clearTimer("pan"+this._id),this},addElement:function(){var e=this._dom;return t.each(j.array(arguments),function(t,i){e[i]=j.create("galleria-"+i)}),this},attachKeyboard:function(){return this._keyboard.attach.apply(this._keyboard,j.array(arguments)),this},detachKeyboard:function(){return this._keyboard.detach.apply(this._keyboard,j.array(arguments)),this},appendChild:function(t,e){return this.$(t).append(this.get(e)||e),this},prependChild:function(t,e){return this.$(t).prepend(this.get(e)||e),this},remove:function(){return this.$(j.array(arguments).join(",")).remove(),this},append:function(t){var e,i;for(e in t)if(t.hasOwnProperty(e))if(t[e].constructor===Array)for(i=0;t[e][i];i++)this.appendChild(e,t[e][i]);else this.appendChild(e,t[e]);return this},_scaleImage:function(e,i){if(e=e||this._controls.getActive()){var n,r=function(e){t(e.container).children(":first").css({top:m.max(0,j.parseValue(e.image.style.top)),left:m.max(0,j.parseValue(e.image.style.left)),width:j.parseValue(e.image.width),height:j.parseValue(e.image.height)})};return i=t.extend({width:this._stageWidth,height:this._stageHeight,crop:this._options.imageCrop,max:this._options.maxScaleRatio,min:this._options.minScaleRatio,margin:this._options.imageMargin,position:this._options.imagePosition,iframelimit:this._options.maxVideoSize},i),this._options.layerFollow&&this._options.imageCrop!==!0?"function"==typeof i.complete?(n=i.complete,i.complete=function(){n.call(e,e),r(e)}):i.complete=r:t(e.container).children(":first").css({top:0,left:0}),e.scale(i),this}},updateCarousel:function(){return this._carousel.update(),this},resize:function(e,i){"function"==typeof e&&(i=e,e=n),e=t.extend({width:0,height:0},e);var r=this,a=this.$("container");return t.each(e,function(t,i){i||(a[t]("auto"),e[t]=r._getWH()[t])}),t.each(e,function(t,e){a[t](e)}),this.rescale(i)},rescale:function(e,r,a){var o=this;"function"==typeof e&&(a=e,e=n);var s=function(){o._stageWidth=e||o.$("stage").width(),o._stageHeight=r||o.$("stage").height(),o._options.swipe?(t.each(o._controls.slides,function(e,i){o._scaleImage(i),t(i.container).css("left",o._stageWidth*e)}),o.$("images").css("width",o._stageWidth*o.getDataLength())):o._scaleImage(),o._options.carousel&&o.updateCarousel();var n=o._controls.frames[o._controls.active];n&&o._controls.frames[o._controls.active].scale({width:o._stageWidth,height:o._stageHeight,iframelimit:o._options.maxVideoSize}),o.trigger(i.RESCALE),"function"==typeof a&&a.call(o)};return s.call(o),this},refreshImage:function(){return this._scaleImage(),this._options.imagePan&&this.addPan(),this},_preload:function(){if(this._options.preload){var t,e,n,r=this.getNext();try{for(e=this._options.preload;e>0;e--)t=new i.Picture,n=this.getData(r),t.preload(this.isFullscreen()&&n.big?n.big:n.image),r=this.getNext(r)}catch(t){}}},show:function(n,r,a){var o=this._options.swipe;if(o||!(this._queue.length>3||n===!1||!this._options.queue&&this._queue.stalled)){if(n=m.max(0,m.min(parseInt(n,10),this.getDataLength()-1)),r="undefined"!=typeof r?!!r:n<this.getIndex(),a=a||!1,!a&&i.History)return void i.History.set(n.toString());if(this.finger&&n!==this._active&&(this.finger.to=-(n*this.finger.width),this.finger.index=n),this._active=n,o){var l=this.getData(n),d=this;if(!l)return;var h=this.isFullscreen()&&l.big?l.big:l.image||l.iframe,c=this._controls.slides[n],u=c.isCached(h),p=this._thumbnails[n],f={cached:u,index:n,rewind:r,imageTarget:c.image,thumbTarget:p.image,galleriaData:l};this.trigger(t.extend(f,{type:i.LOADSTART})),d.$("container").removeClass("videoplay");var g=function(){d._layers[n].innerHTML=d.getData().layer||"",d.trigger(t.extend(f,{type:i.LOADFINISH})),d._playCheck()};d._preload(),e.setTimeout(function(){c.ready&&t(c.image).attr("src")==h?(d.trigger(t.extend(f,{type:i.IMAGE})),g()):(l.iframe&&!l.image&&(c.isIframe=!0),c.load(h,function(e){f.imageTarget=e.image,d._scaleImage(e,g).trigger(t.extend(f,{type:i.IMAGE})),g()}))},100)}else s.push.call(this._queue,{index:n,rewind:r}),this._queue.stalled||this._show();return this}},_show:function(){var r=this,a=this._queue[0],o=this.getData(a.index);if(o){var l=this.isFullscreen()&&o.big?o.big:o.image||o.iframe,d=this._controls.getActive(),h=this._controls.getNext(),c=h.isCached(l),u=this._thumbnails[a.index],p=function(){t(h.image).trigger("mouseup")};r.$("container").toggleClass("iframe",!!o.isIframe).removeClass("videoplay");var f=function(a,o,l,d,h){return function(){var c;z.active=!1,j.toggleQuality(o.image,r._options.imageQuality),r._layers[r._controls.active].innerHTML="",t(l.container).css({zIndex:0,opacity:0}).show(),t(l.container).find("iframe, .galleria-videoicon").remove(),t(r._controls.frames[r._controls.active].container).hide(),t(o.container).css({zIndex:1,left:0,top:0}).show(),r._controls.swap(),r._options.imagePan&&r.addPan(o.image),(a.iframe&&a.image||a.link||r._options.lightbox||r._options.clicknext)&&t(o.image).css({cursor:"pointer"}).on("mouseup",function(o){if(!("number"==typeof o.which&&o.which>1)){if(a.iframe){r.isPlaying()&&r.pause();var s=r._controls.frames[r._controls.active],l=r._stageWidth,d=r._stageHeight;return t(s.container).css({width:l,height:d,opacity:0}).show().animate({opacity:1},200),void e.setTimeout(function(){s.load(a.iframe+(a.video?"&autoplay=1":""),{width:l,height:d},function(t){r.$("container").addClass("videoplay"),t.scale({width:r._stageWidth,height:r._stageHeight,iframelimit:a.video?r._options.maxVideoSize:n})})},100)}return r._options.clicknext&&!i.TOUCH?(r._options.pauseOnInteraction&&r.pause(),void r.next()):a.link?void(r._options.popupLinks?c=e.open(a.link,"_blank"):e.location.href=a.link):void(r._options.lightbox&&r.openLightbox())}}),r._playCheck(),r.trigger({type:i.IMAGE,index:d.index,imageTarget:o.image,thumbTarget:h.image,galleriaData:a}),s.shift.call(r._queue),r._queue.stalled=!1,r._queue.length&&r._show()}}(o,h,d,a,u);this._options.carousel&&this._options.carouselFollow&&this._carousel.follow(a.index),r._preload(),j.show(h.container),h.isIframe=o.iframe&&!o.image,t(r._thumbnails[a.index].container).addClass("active").siblings(".active").removeClass("active"),r.trigger({type:i.LOADSTART,cached:c,index:a.index,rewind:a.rewind,imageTarget:h.image,thumbTarget:u.image,galleriaData:o}),r._queue.stalled=!0,h.load(l,function(e){var s=t(r._layers[1-r._controls.active]).html(o.layer||"").hide();
r._scaleImage(e,{complete:function(e){"image"in d&&j.toggleQuality(d.image,!1),j.toggleQuality(e.image,!1),r.removePan(),r.setInfo(a.index),r.setCounter(a.index),o.layer&&(s.show(),(o.iframe&&o.image||o.link||r._options.lightbox||r._options.clicknext)&&s.css("cursor","pointer").off("mouseup").mouseup(p)),o.video&&o.image&&A(e.container);var l=r._options.transition;if(t.each({initial:null===d.image,touch:i.TOUCH,fullscreen:r.isFullscreen()},function(t,e){if(e&&r._options[t+"Transition"]!==n)return l=r._options[t+"Transition"],!1}),l in z.effects==!1)f();else{var h={prev:d.container,next:e.container,rewind:a.rewind,speed:r._options.transitionSpeed||400};z.active=!0,z.init.call(r,l,h,f)}r.trigger({type:i.LOADFINISH,cached:c,index:a.index,rewind:a.rewind,imageTarget:e.image,thumbTarget:r._thumbnails[a.index].image,galleriaData:r.getData(a.index)})}})})}},getNext:function(t){return t="number"==typeof t?t:this.getIndex(),t===this.getDataLength()-1?0:t+1},getPrev:function(t){return t="number"==typeof t?t:this.getIndex(),0===t?this.getDataLength()-1:t-1},next:function(){return this.getDataLength()>1&&this.show(this.getNext(),!1),this},prev:function(){return this.getDataLength()>1&&this.show(this.getPrev(),!0),this},get:function(t){return t in this._dom?this._dom[t]:null},getData:function(t){return t in this._data?this._data[t]:this._data[this._active]},getDataLength:function(){return this._data.length},getIndex:function(){return"number"==typeof this._active&&this._active},getStageHeight:function(){return this._stageHeight},getStageWidth:function(){return this._stageWidth},getOptions:function(t){return"undefined"==typeof t?this._options:this._options[t]},setOptions:function(e,i){return"object"==typeof e?t.extend(this._options,e):this._options[e]=i,this},play:function(t){return this._playing=!0,this._playtime=t||this._playtime,this._playCheck(),this.trigger(i.PLAY),this},pause:function(){return this._playing=!1,this.trigger(i.PAUSE),this},playToggle:function(t){return this._playing?this.pause():this.play(t)},isPlaying:function(){return this._playing},isFullscreen:function(){return this._fullscreen.active},_playCheck:function(){var t=this,e=0,n=20,r=j.timestamp(),a="play"+this._id;if(this._playing){this.clearTimer(a);var o=function(){return e=j.timestamp()-r,e>=t._playtime&&t._playing?(t.clearTimer(a),void t.next()):void(t._playing&&(t.trigger({type:i.PROGRESS,percent:m.ceil(e/t._playtime*100),seconds:m.floor(e/1e3),milliseconds:e}),t.addTimer(a,o,n)))};t.addTimer(a,o,n)}},setPlaytime:function(t){return this._playtime=t,this},setIndex:function(t){return this._active=t,this},setCounter:function(t){if("number"==typeof t?t++:"undefined"==typeof t&&(t=this.getIndex()+1),this.get("current").innerHTML=t,y){var e=this.$("counter"),i=e.css("opacity");1===parseInt(i,10)?j.removeAlpha(e[0]):this.$("counter").css("opacity",i)}return this},setInfo:function(e){var i=this,n=this.getData(e);return t.each(["title","description"],function(t,e){var r=i.$("info-"+e);n[e]?r[n[e].length?"show":"hide"]().html(n[e]):r.empty().hide()}),this},hasInfo:function(t){var e,i="title description".split(" ");for(e=0;i[e];e++)if(this.getData(t)[i[e]])return!0;return!1},jQuery:function(e){var i=this,n=[];t.each(e.split(","),function(e,r){r=t.trim(r),i.get(r)&&n.push(r)});var r=t(i.get(n.shift()));return t.each(n,function(t,e){r=r.add(i.get(e))}),r},$:function(){return this.jQuery.apply(this,j.array(arguments))}},t.each(x,function(t,e){var n=/_/.test(e)?e.replace(/_/g,""):e;i[e.toUpperCase()]="galleria."+n}),t.extend(i,{IE9:9===y,IE8:8===y,IE7:7===y,IE6:6===y,IE:y,WEBKIT:/webkit/.test(u),CHROME:/chrome/.test(u),SAFARI:/safari/.test(u)&&!/chrome/.test(u),QUIRK:y&&r.compatMode&&"BackCompat"===r.compatMode,MAC:/mac/.test(navigator.platform.toLowerCase()),OPERA:!!e.opera,IPHONE:/iphone/.test(u),IPAD:/ipad/.test(u),ANDROID:/android/.test(u),TOUCH:"ontouchstart"in r}),i.addTheme=function(n){n.name||i.raise("No theme name specified"),"object"!=typeof n.defaults?n.defaults={}:n.defaults=k(n.defaults);var r,a=!1;return"string"==typeof n.css?(t("link").each(function(t,e){if(r=new RegExp(n.css),r.test(e.href))return a=!0,O(n),!1}),a||t(function(){var o=0,s=function(){t("script").each(function(t,i){r=new RegExp("galleria\\."+n.name.toLowerCase()+"\\."),r.test(i.src)&&(a=i.src.replace(/[^\/]*$/,"")+n.css,e.setTimeout(function(){j.loadCSS(a,"galleria-theme-"+n.name,function(){O(n)})},1))}),a||(o++>5?i.raise("No theme CSS loaded"):e.setTimeout(s,500))};s()})):O(n),n},i.loadTheme=function(n){if(!t("script").filter(function(){return t(this).attr("src")==n}).length){var r,a=!1;return t(e).load(function(){a||(r=e.setTimeout(function(){a||i.raise("Galleria had problems loading theme at "+n+". Please check theme path or load manually.",!0)},2e4))}),j.loadScript(n,function(){a=!0,e.clearTimeout(r)}),i}},i.get=function(t){return D[t]?D[t]:"number"!=typeof t?D:void i.raise("Gallery index "+t+" not found")},i.configure=function(e,n){var r={};return"string"==typeof e&&n?(r[e]=n,e=r):t.extend(r,e),i.configure.options=r,t.each(i.get(),function(t,e){e.setOptions(r)}),i},i.configure.options={},i.on=function(e,n){if(e){n=n||g;var r=e+n.toString().replace(/\s/g,"")+j.timestamp();return t.each(i.get(),function(t,i){i._binds.push(r),i.bind(e,n)}),i.on.binds.push({type:e,callback:n,hash:r}),i}},i.on.binds=[],i.run=function(e,n){return t.isFunction(n)&&(n={extend:n}),t(e||"#galleria").galleria(n),i},i.addTransition=function(t,e){return z.effects[t]=e,i},i.utils=j,i.log=function(){var i=j.array(arguments);if(!("console"in e&&"log"in e.console))return e.alert(i.join("<br>"));try{return e.console.log.apply(e.console,i)}catch(n){t.each(i,function(){e.console.log(this)})}},i.ready=function(e){return"function"!=typeof e?i:(t.each(P,function(t,i){e.call(i,i._options)}),i.ready.callbacks.push(e),i)},i.ready.callbacks=[],i.raise=function(e,i){var n=i?"Fatal error":"Error",r={color:"#fff",position:"absolute",top:0,left:0,zIndex:1e5},a=function(e){var a='<div style="padding:4px;margin:0 0 2px;background:#'+(i?"811":"222")+';">'+(i?"<strong>"+n+": </strong>":"")+e+"</div>";t.each(D,function(){var t=this.$("errors"),e=this.$("target");t.length||(e.css("position","relative"),t=this.addElement("errors").appendChild("target","errors").$("errors").css(r)),t.append(a)}),D.length||t("<div>").css(t.extend(r,{position:"fixed"})).append(a).appendTo(v().body)};if(d){if(a(e),i)throw new Error(n+": "+e)}else if(i){if(S)return;S=!0,i=!1,a("Gallery could not load.")}},i.version=l,i.getLoadedThemes=function(){return t.map(U,function(t){return t.name})},i.requires=function(t,e){return e=e||"You need to upgrade Galleria to version "+t+" to use one or more components.",i.version<t&&i.raise(e,!0),i},i.Picture=function(e){this.id=e||null,this.image=null,this.container=j.create("galleria-image"),t(this.container).css({overflow:"hidden",position:"relative"}),this.original={width:0,height:0},this.ready=!1,this.isIframe=!1},i.Picture.prototype={cache:{},show:function(){j.show(this.image)},hide:function(){j.moveOut(this.image)},clear:function(){this.image=null},isCached:function(t){return!!this.cache[t]},preload:function(e){t(new Image).load(function(t,e){return function(){e[t]=t}}(e,this.cache)).attr("src",e)},load:function(n,r,a){if("function"==typeof r&&(a=r,r=null),this.isIframe){var o="if"+(new Date).getTime(),s=this.image=t("<iframe>",{src:n,frameborder:0,id:o,allowfullscreen:!0,css:{visibility:"hidden"}})[0];return r&&t(s).css(r),t(this.container).find("iframe,img").remove(),this.container.appendChild(this.image),t("#"+o).load(function(i,n){return function(){e.setTimeout(function(){t(i.image).css("visibility","visible"),"function"==typeof n&&n.call(i,i)},10)}}(this,a)),this.container}this.image=new Image,i.IE8&&t(this.image).css("filter","inherit"),i.IE||i.CHROME||i.SAFARI||t(this.image).css("image-rendering","optimizequality");var l=!1,d=!1,h=t(this.container),u=t(this.image),p=function(){l?c?t(this).attr("src",c):i.raise("Image not found: "+n):(l=!0,e.setTimeout(function(t,e){return function(){t.attr("src",e+(e.indexOf("?")>-1?"&":"?")+j.timestamp())}}(t(this),n),50))},f=function(n,a,o){return function(){var s=function(){t(this).off("load"),n.original=r||{height:this.height,width:this.width},i.HAS3D&&(this.style.MozTransform=this.style.webkitTransform="translate3d(0,0,0)"),h.append(this),n.cache[o]=o,"function"==typeof a&&e.setTimeout(function(){a.call(n,n)},1)};this.width&&this.height?s.call(this):!function(e){j.wait({until:function(){return e.width&&e.height},success:function(){s.call(e)},error:function(){d?i.raise("Could not extract width/height from image: "+e.src+". Traced measures: width:"+e.width+"px, height: "+e.height+"px."):(t(new Image).load(f).attr("src",e.src),d=!0)},timeout:100})}(this)}}(this,a,n);return h.find("iframe,img").remove(),u.css("display","block"),j.hide(this.image),t.each("minWidth minHeight maxWidth maxHeight".split(" "),function(t,e){u.css(e,/min/.test(e)?"0":"none")}),u.load(f).on("error",p).attr("src",n),this.container},scale:function(e){var r=this;if(e=t.extend({width:0,height:0,min:n,max:n,margin:0,complete:g,position:"center",crop:!1,canvas:!1,iframelimit:n},e),this.isIframe){var a,o,s=e.width,l=e.height;if(e.iframelimit){var d=m.min(e.iframelimit/s,e.iframelimit/l);d<1?(a=s*d,o=l*d,t(this.image).css({top:l/2-o/2,left:s/2-a/2,position:"absolute"})):t(this.image).css({top:0,left:0})}t(this.image).width(a||s).height(o||l).removeAttr("width").removeAttr("height"),t(this.container).width(s).height(l),e.complete.call(r,r);try{this.image.contentWindow&&t(this.image.contentWindow).trigger("resize")}catch(t){}return this.container}if(!this.image)return this.container;var h,c,u,p=t(r.container);return j.wait({until:function(){return h=e.width||p.width()||j.parseValue(p.css("width")),c=e.height||p.height()||j.parseValue(p.css("height")),h&&c},success:function(){var i=(h-2*e.margin)/r.original.width,n=(c-2*e.margin)/r.original.height,a=m.min(i,n),o=m.max(i,n),s={"true":o,width:i,height:n,"false":a,landscape:r.original.width>r.original.height?o:a,portrait:r.original.width<r.original.height?o:a},l=s[e.crop.toString()],d="";e.max&&(l=m.min(e.max,l)),e.min&&(l=m.max(e.min,l)),t.each(["width","height"],function(e,i){t(r.image)[i](r[i]=r.image[i]=m.round(r.original[i]*l))}),t(r.container).width(h).height(c),e.canvas&&I&&(I.elem.width=r.width,I.elem.height=r.height,d=r.image.src+":"+r.width+"x"+r.height,r.image.src=I.cache[d]||function(t){I.context.drawImage(r.image,0,0,r.original.width*l,r.original.height*l);try{return u=I.elem.toDataURL(),I.length+=u.length,I.cache[t]=u,u}catch(t){return r.image.src}}(d));var p={},f={},g=function(e,i,n){var a=0;if(/\%/.test(e)){var o=parseInt(e,10)/100,s=r.image[i]||t(r.image)[i]();a=m.ceil(s*-1*o+n*o)}else a=j.parseValue(e);return a},_={top:{top:0},left:{left:0},right:{left:"100%"},bottom:{top:"100%"}};t.each(e.position.toLowerCase().split(" "),function(t,e){"center"===e&&(e="50%"),p[t?"top":"left"]=e}),t.each(p,function(e,i){_.hasOwnProperty(i)&&t.extend(f,_[i])}),p=p.top?t.extend(p,f):f,p=t.extend({top:"50%",left:"50%"},p),t(r.image).css({position:"absolute",top:g(p.top,"height",c),left:g(p.left,"width",h)}),r.show(),r.ready=!0,e.complete.call(r,r)},error:function(){i.raise("Could not scale image: "+r.image.src)},timeout:1e3}),this}},t.extend(t.easing,{galleria:function(t,e,i,n,r){return(e/=r/2)<1?n/2*e*e*e+i:n/2*((e-=2)*e*e+2)+i},galleriaIn:function(t,e,i,n,r){return n*(e/=r)*e+i},galleriaOut:function(t,e,i,n,r){return-n*(e/=r)*(e-2)+i}}),i.Finger=function(){var n=(m.abs,i.HAS3D=function(){var e,i,n=r.createElement("p"),a=["webkit","O","ms","Moz",""],o=0,s="transform";for(v().html.insertBefore(n,null);a[o];o++)i=a[o]?a[o]+"Transform":s,void 0!==n.style[i]&&(n.style[i]="translate3d(1px,1px,1px)",e=t(n).css(a[o]?"-"+a[o].toLowerCase()+"-"+s:s));return v().html.removeChild(n),void 0!==e&&e.length>0&&"none"!==e}()),o=function(){var t="RequestAnimationFrame";return e.requestAnimationFrame||e["webkit"+t]||e["moz"+t]||e["o"+t]||e["ms"+t]||function(t){e.setTimeout(t,1e3/60)}}(),s=function(i,r){if(this.config={start:0,duration:500,onchange:function(){},oncomplete:function(){},easing:function(t,e,i,n,r){return-n*((e=e/r-1)*e*e*e-1)+i}},this.easeout=function(t,e,i,n,r){return n*((e=e/r-1)*e*e*e*e+1)+i},i.children.length){var a=this;t.extend(this.config,r),this.elem=i,this.child=i.children[0],this.to=this.pos=0,this.touching=!1,this.start={},this.index=this.config.start,this.anim=0,this.easing=this.config.easing,n||(this.child.style.position="absolute",this.elem.style.position="relative"),t.each(["ontouchstart","ontouchmove","ontouchend","setup"],function(t,e){a[e]=function(t){return function(){t.apply(a,arguments)}}(a[e])}),this.setX=function(){var t=a.child.style;return n?void(t.MozTransform=t.webkitTransform=t.transform="translate3d("+a.pos+"px,0,0)"):void(t.left=a.pos+"px")},t(i).on("touchstart",this.ontouchstart),t(e).on("resize",this.setup),t(e).on("orientationchange",this.setup),this.setup(),!function t(){o(t),a.loop.call(a)}()}};return s.prototype={constructor:s,setup:function(){this.width=t(this.elem).width(),this.length=m.ceil(t(this.child).width()/this.width),0!==this.index&&(this.index=m.max(0,m.min(this.index,this.length-1)),this.pos=this.to=-this.width*this.index)},setPosition:function(t){this.pos=t,this.to=t},ontouchstart:function(t){var e=t.originalEvent.touches;this.start={pageX:e[0].pageX,pageY:e[0].pageY,time:+new Date},this.isScrolling=null,this.touching=!0,this.deltaX=0,a.on("touchmove",this.ontouchmove),a.on("touchend",this.ontouchend)},ontouchmove:function(t){var e=t.originalEvent.touches;e&&e.length>1||t.scale&&1!==t.scale||(this.deltaX=e[0].pageX-this.start.pageX,null===this.isScrolling&&(this.isScrolling=!!(this.isScrolling||m.abs(this.deltaX)<m.abs(e[0].pageY-this.start.pageY))),this.isScrolling||(t.preventDefault(),this.deltaX/=!this.index&&this.deltaX>0||this.index==this.length-1&&this.deltaX<0?m.abs(this.deltaX)/this.width+1.8:1,this.to=this.deltaX-this.index*this.width),t.stopPropagation())},ontouchend:function(){this.touching=!1;var t=+new Date-this.start.time<250&&m.abs(this.deltaX)>40||m.abs(this.deltaX)>this.width/2,e=!this.index&&this.deltaX>0||this.index==this.length-1&&this.deltaX<0;this.isScrolling||this.show(this.index+(t&&!e?this.deltaX<0?1:-1:0)),a.off("touchmove",this.ontouchmove),a.off("touchend",this.ontouchend)},show:function(t){t!=this.index?this.config.onchange.call(this,t):this.to=-(t*this.width)},moveTo:function(t){t!=this.index&&(this.pos=this.to=-(t*this.width),this.index=t)},loop:function(){var t=this.to-this.pos,e=1;if(this.width&&t&&(e=m.max(.5,m.min(1.5,m.abs(t/this.width)))),this.touching||m.abs(t)<=1)this.pos=this.to,t=0,this.anim&&!this.touching&&this.config.oncomplete(this.index),this.anim=0,this.easing=this.config.easing;else{this.anim||(this.anim={start:this.pos,time:+new Date,distance:t,factor:e,destination:this.to});var i=+new Date-this.anim.time,n=this.config.duration*this.anim.factor;if(i>n||this.anim.destination!=this.to)return this.anim=0,void(this.easing=this.easeout);this.pos=this.easing(null,i,this.anim.start,this.anim.distance,n)}this.setX()}},s}(),t.fn.galleria=function(e){var n=this.selector;return t(this).length?this.each(function(){t.data(this,"galleria")&&(t.data(this,"galleria").destroy(),t(this).find("*").hide()),t.data(this,"galleria",(new i).init(this,e))}):(t(function(){t(n).length?t(n).galleria(e):i.utils.wait({until:function(){return t(n).length},success:function(){t(n).galleria(e)},error:function(){i.raise('Init failed: Galleria could not find the element "'+n+'".')},timeout:5e3})}),this)},"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=i:(e.Galleria=i,"function"==typeof define&&define.amd&&define("galleria",["jquery"],function(){return i}))}(jQuery,this),$(function(){var t=0,e=0;$.fn.openHDimgs=function(){_init(),$(this).unbind("click").click(function(){e=0,t=0;var i=$(this).parent().find("img"),n=[],r=0;r=$(this).is("img")?parseInt($(this).attr("data-img"))-1:parseInt($(this).find("img").attr("data-img"))-1;for(var a=0;a<i.length;a++)n.push({image:$(i[a]).attr("data-url")});$(".show-HD-images-layout").show(),$(".show-HD-images").show(),0==Galleria.getLoadedThemes().length&&Galleria.loadTheme(oss_host+"/resource/galleria/themes/classic/galleria.classic.min.js"),Galleria.run(".images",{responsive:!0,dataSource:n,show:r,transition:"fade",imageCrop:!1,thumbCrop:!0,maxScaleRatio:1}).on("image",function(){t=0,_bindDragEvent()}),$("body").css("overflow","hidden"),$(".turn-left").unbind("click").click(function(){t-=90,$($(".images").data("galleria").getActiveImage()).rotate({animateTo:t})}),$(".turn-right").unbind("click").click(function(){t+=90,$($(".images").data("galleria").getActiveImage()).rotate({animateTo:t})}),$(".close-btn").unbind("click").click(function(){$(".show-HD-images-layout").hide(),$(".show-HD-images").hide(),$("#body").removeAttr("style")}),$(".full-img").unbind("click").click(function(){var t=$(".images").data("galleria").getActiveImage();window.open(t.src.split("@")[0])}),$(".zoom-in").unbind("click").click(function(){if(!(e>=5)){var t=$($(".images").data("galleria").getActiveImage()),i=t.width(),n=t.height();t.width(1.2*i),t.height(1.2*n);var r=t.parent(".galleria-image").width()/2-t.width()/2;t.css("left",r);var a=t.parent(".galleria-image").height()/2-t.height()/2;t.css("top",a),e++}}),$(".zoom-out").unbind("click").click(function(){if(!(e<=-5)){var t=$($(".images").data("galleria").getActiveImage()),i=t.width(),n=t.height();t.width(i/1.2),t.height(n/1.2);var r=t.parent(".galleria-image").width()/2-t.width()/2;t.css("left",r);var a=t.parent(".galleria-image").height()/2-t.height()/2;t.css("top",a),e--}})})},_bindDragEvent=function(){var t=$($(".images").data("galleria").getActiveImage());$(t).draggable()},_init=function(){if(0==$(".show-HD-images").length){var t="<div class='show-HD-images-layout' style='display: none'></div>";t+="<div class='show-HD-images' style='display: none;-moz-user-select: none;' onselectstart='return false'>",t+="<div class='show-image-layout'>",t+="<div class='image-btn'>",t+="<span class='icon-btn zoom-in' style='margin: 0;'></span>",t+="<span class='icon-btn zoom-out'></span>",t+="<span class='icon-btn turn-left'></span>",t+="<span class='icon-btn turn-right'></span>",t+="<span class='icon-btn full-img'></span>",t+="<span class='icon-btn close-btn'></span>",t+="</div>",t+="<div class='images'></div>",t+="</div></div>",$("body").append(t)}}}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery")):t(jQuery)}(function(t){function e(){for(var t=[{style:"normal",name:"\u9ed8\u8ba4","class":"normal"},{style:"weixing",name:"\u536b\u661f","class":"weixing"},{style:"light",name:"\u6e05\u65b0\u84dd","class":"light"},{style:"dark",name:"\u9ed1\u8272","class":"dark"},{style:"googlelite",name:"\u7cbe\u7b80","class":"googlelite"},{style:"grassgreen",name:"\u81ea\u7136\u7eff","class":"grassgreen"},{style:"midnight",name:"\u5348\u591c\u84dd","class":"midnight"},{style:"bluish",name:"\u6e05\u65b0\u84dd\u7eff","class":"bluish"},{style:"hardedge",name:"\u5f3a\u8fb9\u754c","class":"hardedge"}],e="<div class='custom-layer' id='customLayer' style='display:none;'><div class='dt-hidden map-style-notice'><span class='dt-f12 color99'>\u4e2a\u6027\u5316\u5e95\u56fe\u4f7f\u7528\u987b\u77e5</span><span class='glyphicon glyphicon-question-sign color99 dt-f12 dt-mar6l dt-pointer' data-toggle='modal' data-target='#mapStyleNotice'></span><span class='close-panel'>x</span></div><ul class='select-layer'>",i=0;i<t.length;i++){var n=t[i];e+="<li class='map-style'><a href='#' data-style='"+n.style+"' data-name='"+n.name+"'><div class='"+n.style+"' style='width:49px;height:51px'></div></a><span>"+n.name+"</span></li>"}return e+="</ul><div class='map-setting-line'></div><div class='layer-settings'><div class='caption'>\u5730\u56fe\u5143\u7d20\u914d\u7f6e</div><div class='setting-box'><ul><li><input type='checkbox' name='check' class='map-element' value='road' checked>\u9053\u8def</li><li><input type='checkbox' name='check' class='map-element' value='water' checked>\u6c34\u57df</li><li><input type='checkbox' name='check' class='map-element' value='poi' checked>\u5174\u8da3\u70b9</li></ul></div></div><div class='btn-list'></div></div>"}function i(t,e,i){if(s.baseLayer&&s.baseLayer.setMapStyle(t,e),!i){var n=e.toString();MapUtils.ajax2server(map_type_url,"POST",{mid:mid,base_map:t,style:n})}}function n(){var e=[];return t(".map-element:not(:checked)").each(function(i,n){e.push(t(n).val())}),e}function r(){o.click(function(e){var i=t("#customLayer");if("none"!=i.css("display"))i.hide();else{t(e.target).attr("id")!=o.attr("id")&&(e.target=o.get(0));var n=e.target.offsetParent.offsetTop;i.css("top",n-22).css("right",0).show()}}),t(".map-element").change(function(){var t=o.attr("class");i(t,n())}),t(".map-style").click(function(e){t(".select-layer").find(".panel-active").removeClass("panel-active"),t(this).find("div").addClass("panel-active");var r=t(this).find("a").attr("data-style");if(t("#styleName").parent().removeClass().addClass(r),t("#styleName").text(t(this).find("span").text()),"weixing"!=r||"normal"!=r){var a=s.getZoom();a>18&&s.setZoom(18)}var o=t(e.target).hasClass("weixing")||t(e.target).hasClass("normal");t(".map-element").attr("disabled",o),i(r,n())})}function a(a){if(a=t.extend({mapStyle:"normal"},a),o.addClass(a.mapStyle).append("<span class='style'></span><span id='styleName'></span>"),o.before(e()),t(".btn-list").click(function(){return t(".layer-settings").slideToggle("slow"),t(this).toggleClass("list-active"),!1}),t(".close-panel").click(function(){t("#customLayer").hide()}),a.style){var s=a.style.split(",");t(".map-element").each(function(e,i){s.indexOf(t(i).val())!=-1&&t(this).removeAttr("checked")})}t(".map-style").each(function(e,i){var n=t(i);n.find("a").attr("data-style")==a.mapStyle&&("weixing"!=a.mapStyle&&"normal"!=a.mapStyle||t(".map-element").attr("disabled",!0),n.find("div").addClass("panel-active"),t("#styleName").text(n.find("span").text()))}),i(a.mapStyle,n(),!0),r()}var o=null,s=null,l={init:function(e,i,n){return o=t(this),s=e,a(i),n&&n(o),o}};t.fn.DtMapStyle=function(e){return l[e]?l[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.DtMapStyle"):l.init.apply(this,arguments)}});var BInfowindow=window.BInfowindow=BInfowindow||{};$(function(){function t(t){t.getImages(get_marker_imgs_url,function(e){BInfowindow.template_opts.overlay_imgs=e,BInfowindow.updateContent(BInfowindow.template_opts,t)}),$(".leaflet-popup-close-button").click(function(){t&&t.disableEditing()}),$(".leaflet-popup-content").unbind().click(function(e){if($('[data-toggle="tooltip"]').tooltip("destroy"),$(e.target).hasClass("edit_marker")){BInfowindow.template_opts.status="edit",BInfowindow.updateContent(BInfowindow.template_opts,t);var i=BInfowindow._hashMap.get("m_"+t.layer_id);MarkerUtils.editStatus(i,t)}else if($(e.target).hasClass("save_marker")){var i=BInfowindow._hashMap.get("m_"+t.layer_id);BInfowindow._saveFeature(t,"marker",i)}else if($(e.target).hasClass("del_marker"))MarkerUtils.delMarker(t);else if($(e.target).hasClass("reply_marker"))$(document).trigger("show.reply_panel",[e,t.feature_id,t.layer_id]);else if($(e.target).hasClass("marker-set-style"))MarkerUtils.setMarkerStyle(t);else if($(e.target).hasClass("upload_imgs"))BInfowindow._uploadImages(t.feature_id,t.layer_id,"marker");else if($(e.target).hasClass("add_attr_marker"))_addAttrModel(t.layer_id,add_attrs_url,function(){BInfowindow.close()});else if($(e.target).hasClass("glyphicon-shopping-cart"))$("#select_downloadmarker_container").mselector("add",t);else if($(e.target).hasClass("marker-permission-feature")){if([0,3,4].indexOf(org_level)==-1)return void PromptInfo.xcConfirm(org_error_txt,PromptInfo.xcConfirm.typeEnum.info);$("#addMemberToFeature").attr("data-layer-type","marker").attr("data-markers",t.feature_id).attr("layer-id",t.layer_id).modal("show")}L.DomEvent.stopPropagation(e)})}function e(t){t.getImages(get_region_imgs_url,function(e){BInfowindow.template_opts.overlay_imgs=e,BInfowindow.updateContent(BInfowindow.template_opts,t)}),$(".leaflet-popup-content").unbind("click").click(function(e){if($('[data-toggle="tooltip"]').tooltip("destroy"),$(e.target).hasClass("del_region"))RegionUtils.delRegion(t);else if($(e.target).hasClass("edit_region"))BInfowindow.template_opts.status="edit",BInfowindow.updateContent(BInfowindow.template_opts,t);else if($(e.target).hasClass("save_region")){var i=BInfowindow._hashMap.get("r_"+t.layer_id);BInfowindow._saveFeature(t,"region",i)}else if($(e.target).hasClass("edit_node_region"))RegionUtils.editNodeRegion(t);else if($(e.target).hasClass("edit_style_region"))RegionUtils.setRegionStyle(t);else if($(e.target).hasClass("upload_imgs"))BInfowindow._uploadImages(t.feature_id,t.layer_id,"region");else if($(e.target).hasClass("add_attr_region"))_addAttrModel(t.layer_id,region_layer_add_attrs_url,function(){BInfowindow.close()});else if($(e.target).hasClass("region-permission-feature")){if([0,3,4].indexOf(org_level)==-1)return void PromptInfo.xcConfirm(org_error_txt,PromptInfo.xcConfirm.typeEnum.info);$("#addMemberToFeature").attr("data-layer-type","region").attr("data-regions",t.feature_id).attr("layer-id",t.layer_id).modal("show")}L.DomEvent.stopPropagation(e)})}function i(t){t.getImages(get_line_imgs_url,function(e){BInfowindow.template_opts.overlay_imgs=e,BInfowindow.updateContent(BInfowindow.template_opts,t)}),$(".leaflet-popup-content").unbind("click").click(function(e){if($('[data-toggle="tooltip"]').tooltip("destroy"),$(e.target).hasClass("del_line"))LineUtils.delLine(t);else if($(e.target).hasClass("edit_line"))BInfowindow.template_opts.status="edit",BInfowindow.updateContent(BInfowindow.template_opts,t);else if($(e.target).hasClass("save_line")){var i=BInfowindow._hashMap.get("l_"+t.layer_id);BInfowindow._saveFeature(t,"line",i)}else if($(e.target).hasClass("edit_node_line"))LineUtils.editNodeLine(t);else if($(e.target).hasClass("edit_style_line"))LineUtils.editLineStyle(t);else if($(e.target).hasClass("upload_imgs"))BInfowindow._uploadImages(t.feature_id,t.layer_id,"line");else if($(e.target).hasClass("add_attr_line"))_addAttrModel(t.layer_id,line_layer_add_attrs_url,function(){BInfowindow.close()});else if($(e.target).hasClass("line-permission-feature")){if([0,3,4].indexOf(org_level)==-1)return void PromptInfo.xcConfirm(org_error_txt,PromptInfo.xcConfirm.typeEnum.info);$("#addMemberToFeature").attr("data-layer-type","line").attr("data-lines",t.feature_id).attr("layer-id",t.layer_id).modal("show")}else $(e.target).hasClass("edit-line-direction")&&$(document).trigger("edit.line_route",[t]);L.DomEvent.stopPropagation(e)})}BInfowindow._role={"\u5730\u56fe\u7ba1\u7406\u5458":["marker-permission-feature","add_attr_marker","add_attr_region","add_attr_line","reply_marker","marker-set-style","upload_imgs","edit_marker","del_marker","view-select-marker","line-permission-feature","edit_style_line","edit_node_line","edit_line","del_line","edit-line-direction","region-permission-feature","edit_style_region","edit_node_region","edit_region","del_region"],"\u5730\u56fe\u6210\u5458":["marker-permission-feature","add_attr_marker","add_attr_region","add_attr_line","reply_marker","marker-set-style","upload_imgs","edit_marker","del_marker","view-select-marker","line-permission-feature","edit_style_line","edit_node_line","edit_line","del_line","edit-line-direction","region-permission-feature","edit_style_region","edit_node_region","edit_region","del_region"],"\u5730\u56fe\u8bbf\u5ba2":[],"\u56fe\u5c42\u6210\u5458":["marker-permission-feature","add_attr_marker","add_attr_region","add_attr_line","reply_marker","marker-set-style","upload_imgs","edit_marker","del_marker","view-select-marker","line-permission-feature","edit_style_line","edit_node_line","edit_line","del_line","edit-line-direction","region-permission-feature","edit_style_region","edit_node_region","edit_region","del_region"],"\u8bb0\u5f55\u6210\u5458":["reply_marker","marker-set-style","upload_imgs","edit_marker","view-select-marker","edit_style_line","edit_node_line","edit_line","edit-line-direction","edit_style_region","edit_node_region","edit_region"]},BInfowindow._render_style={marker_render_0:["marker-permission-feature","reply_marker","marker-set-style","upload_imgs","edit_marker","del_marker","view-select-marker","add_attr_marker"],marker_render_1:["marker-permission-feature","reply_marker","upload_imgs","edit_marker","del_marker","view-select-marker","add_attr_marker"],marker_render_2:["marker-permission-feature","reply_marker","upload_imgs","edit_marker","del_marker","view-select-marker","add_attr_marker"],marker_render_4:["marker-permission-feature","reply_marker","upload_imgs","edit_marker","del_marker","view-select-marker","add_attr_marker"],marker_render_5:["marker-permission-feature","reply_marker","marker-set-style","upload_imgs","edit_marker","del_marker","view-select-marker","add_attr_marker"],marker_render_6:["marker-permission-feature","reply_marker","upload_imgs","edit_marker","del_marker","view-select-marker","add_attr_marker"],line_render_0:["line-permission-feature","edit_style_line","edit_node_line","edit_line","del_line","upload_imgs","edit-line-direction","add_attr_line"],line_render_1:["line-permission-feature","edit_node_line","edit_line","del_line","upload_imgs","edit-line-direction","add_attr_line"],region_render_0:["region-permission-feature","edit_style_region","edit_node_region","edit_region","del_region","upload_imgs","add_attr_region"],region_render_1:["region-permission-feature","edit_node_region","edit_region","del_region","upload_imgs","add_attr_region"]},BInfowindow.init=function(t,e,i){if(BInfowindow._map=t,BInfowindow._hashMap=e,BInfowindow._init)i&&i();else{var n=["infowindow_template_show","infowindow_template_edit","infowindow_template_view","infowindow_marker_btns","infowindow_line_btns","infowindow_region_btns","infowindow_line_route","infowindow_show_content","infowindow_edit_content"];$.when($.lazyGetTemplate(n)).done(function(){$.views.settings.allowCode=!0,BInfowindow._init=!0,i&&i()})}},BInfowindow._opts=function(t){return{title:t,width:334,panel:"panel",enableSendToPhone:!1,enableAutoPan:!0,searchTypes:[]}},BInfowindow._infowindow=null,BInfowindow._initHDImgs=function(){BInfowindow._bindImagePrevClickEvent("#prevImg","#slides"),BInfowindow._bindImageNextClickEvent("#nextImg","#slides"),$(".dt-show-img").openHDimgs()},_createInfowindowSelectEnumItems=function(t,e){$(".add-enum-item").unbind().click(function(){if($(".enum-input").hasClass("dt-none"))$(".enum-input").removeClass("dt-none"),$(t).focus();else{var i=$(t).val();_addEnumItem(i,e),$(t).val("").focus()}_removeSelectEnum(),$(t).unbind().keyup(function(i){if(13==i.keyCode){var n=$(t).val();_addEnumItem(n,e),$(t).val("").focus()}})})},_addAttrModel=function(t,e,i){if(0==$("#addAttrModel").length){var n='<div class="modal fade" id="addAttrModel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">';n+='<div class="modal-dialog">',n+='<div class="modal-content">',n+='<div class="modal-header">',n+='<h4 class="modal-title" id="myModalLabel">\u6dfb\u52a0\u5b57\u6bb5</h4>',n+="</div>",n+='<div class="modal-body dt-hidden dt-line-64h">',n+='<p class="text-warning" style="margin: 3px;font-size: 10px">\u5b57\u6bb5\u540d\u79f0\u4e0d\u80fd\u4e0e\u5176\u4ed6\u76f8\u540c\uff0c\u4e0d\u80fd\u5305\u542b\u7279\u6b8a\u5b57\u7b26\u548c\u7a7a\u683c\uff1b\u5c06\u8ffd\u52a0\u5230\u6700\u540e\u4f4d\u7f6e\uff0c\u63d2\u5165\u5176\u4ed6\u4f4d\u7f6e\u8bf7\u5728\u6570\u636e\u5217\u8868\u4e2d\u64cd\u4f5c\u3002</p>',n+='<div class="dt-mar10t dt-h34">',n+='<label class="pull-left dt-line-32h dt-mar12r">\u5b57\u6bb5\u540d\u79f0\uff1a</label>',n+='<input id="attr_key" type="text" placeholder="\u8bf7\u8f93\u5165\u5b57\u6bb5\u540d\u79f0" class="form-control dt-w200 pull-left"/>',n+="</div>",n+='<div class="dt-mar10t dt-h34">',n+='<label class="pull-left dt-line-32h dt-mar12r">\u5b57\u6bb5\u7c7b\u578b\uff1a</label>',n+='<select id="attr_type" class="form-control dt-w200 pull-left">',n+='<option value="string">\u6587\u672c\u7c7b\u578b</option>',n+='<option value="number">\u6570\u503c\u7c7b\u578b</option>',n+='<option value="date">\u65e5\u671f\u7c7b\u578b</option>',n+='<option value="enum">\u4e0b\u62c9\u9009\u9879</option>',n+="</select>",n+="</div>",n+='<div class="dt-hidden dt-mar4b">',n+='<div class="infowindow-col-enum-items" style="width:486px;float:right;"></div>',n+='<div class="input-group enum-input dt-none dt-mar8t dt-mar8b dt-hidden" style="width:486px;float:right;">',
n+='<span class="glyphicon glyphicon-minus-sign dt-line12h remove-input-enum colorcc dt-pointer"></span>',n+='<input type="text" class="infowindow-enum-text" style="width:97%"/>',n+="</div>",n+="</div>",n+='<a href="###" class="add-enum-item dt-none dt-mar4t" style="margin-left:82px;">',n+='<span class="glyphicon glyphicon-plus-sign"></span>',n+="\u6dfb\u52a0\u5907\u9009\u9879",n+="</a>",n+="</div>",n+='<div class="modal-footer">',n+='<button type="button" class="btn btn-default" data-dismiss="modal">\u53d6\u6d88</button>',n+='<button type="button" class="btn btn-primary" id="add_attr_key">\u4fdd\u5b58</button>',n+="</div></div></div></div>",$("body").append(n)}else $("#addAttrModel #attr_key").val("");$("#addAttrModel").modal("show"),$("#attr_type").unbind().change(function(){"enum"==$(this).val()?($(".add-enum-item").removeClass("dt-none"),_createInfowindowSelectEnumItems(".infowindow-enum-text",".infowindow-col-enum-items")):($(".add-enum-item").addClass("dt-none"),$(".infowindow-enum-text").val(""),$(".enum-input").addClass("dt-none"))}),$("#add_attr_key").unbind().click(function(){var n=$("#attr_key").val(),r=MapUtils.check_col_name(n);if(""!=r)return void PromptInfo.xcConfirm(r,PromptInfo.xcConfirm.typeEnum.error);var a=$("#attr_type").val();if($(".enum-input").is(":visible")){var o=_valdateEnumItem($(".infowindow-enum-text").val(),".infowindow-enum-text",".infowindow-col-enum-items");if(!o)return;_addEnumItem($(".infowindow-enum-text").val(),".infowindow-col-enum-items"),$(".infowindow-enum-text").val("").focus()}if(0==$(".infowindow-col-enum-items").children().length&&"enum"==a)return void PromptInfo.xcConfirm("\u81f3\u5c11\u8f93\u5165\u4e00\u4e2a\u5907\u9009\u9879\u5728\u8fdb\u884c\u4fdd\u5b58",PromptInfo.xcConfirm.typeEnum.info);$(".enum-input").addClass("dt-none"),$(".infowindow-enum-text").val("");var s={id:t,col_index:-1,col_name:n,col_type:a,mid:mid};if("enum"==a){var l=[];$(".infowindow-col-enum-items .enum-item").each(function(){l.push($(this).text())}),s.enum_items=l}$("#addAttrModel").modal("hide").remove(),MapUtils.ajax2server(e,"POST",s,function(t){i&&i(t)})})},BInfowindow.open=function(n,r){if(!$("#correntionPanel").is(":visible")){var a="show";if(r&&r.status&&(a=r.status),n){var o,s,l,d,h,c,u=null;if($("#layerContainer").find(".active-layer").removeClass("active-layer").addClass("layer-hover"),"marker"==n.type){if($("#marker_layer_"+n.layer_id).find(".display_layer").hasClass("glyphicon-eye-close"))return;var p=n;if(current_layer_id=p.layer_id,u=BInfowindow._hashMap.get("m_"+current_layer_id),null==u)return;if(o=p.getPosition(),!o)return;l=BInfowindow._getRole(u,p),d=BInfowindow._getOverlayAttrs(p,u,a),$("#marker_layer_"+current_layer_id).find(".mlayer").removeClass("layer-hover").addClass("active-layer");var f=BInfowindow._getOverlayTitleId(p.attrs,u.uniform_title);h={overlay_type:"marker",overlay_imgs:p.imgs,overlay_attr_id:f,marker_id:p.feature_id,layer_id:p.layer_id,uniform_title:u.uniform_title,field_type:BInfowindow._getTitleFieldType(d,u.uniform_title),attrs:d,title:p.title,status:a,isViewer:isViewer,has_marker_selector:BInfowindow._map.has_marker_selector,has_reply:BInfowindow._map.has_marker_reply,has_task:BInfowindow._map.has_feature_task,cooperation:p.cooperation,btns:BInfowindow._getBtns(l,"marker",u.render_style)},"undefined"!=typeof is_advert&&is_advert===!0&&isViewer&&(h.ids=[],$(".advert-img-panel").each(function(){h.ids.push($(this).attr("marker-id"))})),s="edit"==a?$.templates.infowindow_template_edit.render(h):"view"==a?$.templates.infowindow_template_view.render(h):$.templates.infowindow_template_show.render(h),$("#select_marker_"+p.feature_id).css("background-color","#f1f1f1"),c=t,"undefined"!=typeof is_advert&&is_advert===!0&&setTimeout(function(){$(document).trigger("bind.contrast.event",[BInfowindow._hashMap])},500)}else if("region"==n.type){var m=n;if($("#region_layer_"+n.layer_id).find(".display_layer").hasClass("glyphicon-eye-close"))return;if(r&&r.infoPoint?o=r.infoPoint:m&&(o=m.getCenter()),null==o)return;if(current_layer_id=m.layer_id,u=BInfowindow._hashMap.get("r_"+current_layer_id),null==u)return;l=BInfowindow._getRole(u,m),$("#region_layer_"+current_layer_id).find(".rlayer").removeClass("layer-hover").addClass("active-layer"),d=BInfowindow._getOverlayAttrs(m,u,a);var g=BInfowindow._getOverlayTitleId(m.attrs,u.uniform_title);h={overlay_type:"region",show_fields:u.show_fields,title:m.title,layer_id:m.layer_id,field_type:BInfowindow._getTitleFieldType(d,u.uniform_title),overlay_attr_id:g,overlay_imgs:m.imgs,uniform_title:u.uniform_title,attrs:d,status:a,cooperation:m.cooperation,has_task:BInfowindow._map.has_feature_task,btns:BInfowindow._getBtns(l,"region",u.render_style)},s="edit"==a?$.templates.infowindow_template_edit.render(h):"view"==a?$.templates.infowindow_template_view.render(h):$.templates.infowindow_template_show.render(h),$("#li_region_id_"+m.feature_id).css("background-color","#f1f1f1"),c=e}else if("line"==n.type){var _=n;if($("#line_layer_"+n.layer_id).find(".display_layer").hasClass("glyphicon-eye-close"))return;if(r&&r.infoPoint?o=r.infoPoint:_&&(o=_.getCenter()),null==o)return;if(current_layer_id=_.layer_id,u=BInfowindow._hashMap.get("l_"+current_layer_id),null==u)return;l=BInfowindow._getRole(u,_),$("#line_layer_"+current_layer_id).find(".llayer").removeClass("layer-hover").addClass("active-layer"),d=BInfowindow._getOverlayAttrs(_,u,a);var y=BInfowindow._getOverlayTitleId(_.attrs,u.uniform_title);h={overlay_type:"line",overlay_imgs:_.imgs,layer_id:_.layer_id,overlay_attr_id:y,uniform_title:u.uniform_title,field_type:BInfowindow._getTitleFieldType(d,u.uniform_title),title:_.title,attrs:d,status:a,line_route:_.line_route,cooperation:_.cooperation,has_task:BInfowindow._map.has_feature_task,btns:BInfowindow._getBtns(l,"line",u.render_style)},s="edit"==a?$.templates.infowindow_template_edit.render(h):$.templates.infowindow_template_show.render(h),$("#li_line_id_"+_.feature_id).css("background-color","#f1f1f1"),c=i}$('[data-toggle="tooltip"]').tooltip("destroy").tooltip(),BInfowindow._initInfoWindow(o,s,n,h,c),"edit"==a&&BInfowindow._enableTitleEditing()}}},BInfowindow._saveFeature=function(t,e,i){var n,r,a=$("#attr_details").find(".has-error"),o=$(".dt-infowindow-title");if(a.length>0?(n=a.attr("data-field"),r=a.attr("data-field-type")):o.hasClass("has-error")&&(n=o.attr("data-field"),r=o.attr("data-field-type")),n&&r)return void PromptInfo.xcConfirm("\u201c"+n+"\u201d\u5b57\u6bb5\u9700\u8f93\u5165\u201c"+BInfowindow._getFieldTypeZh(r)+"\u201d\u5185\u5bb9\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\uff01",PromptInfo.xcConfirm.typeEnum.error);var s,l,d={},h=$("#attr_details textarea");for(s=0;s<h.length;s++){var c=$(h[s]);l=c.attr("data-attr-id"),d[l]=c.val()}var u=$(".edit-time-date");for(s=0;s<u.length;s++){var p=$(u[s]);l=p.attr("data-attr-id");var f=p.val(),m=f;d[l]=m}var g=$(".infowindow-select");for(s=0;s<g.length;s++){var _=$(g[s]);l=_.attr("data-attr-id"),d[l]=_.val()}var y=$(".dt-infowindow-title input").val()||$(".dt-infowindow-title option:selected").val();"undefined"!=typeof y&&null!=y||(y=""),o.html(y);var v=o.attr("data-attr-id");v&&(d[v]=y),BInfowindow.template_opts.status="show";var b=function(t,e){if(e){BInfowindow.template_opts.title=y;for(var i=0;i<BInfowindow.template_opts.attrs.length;i++){var n=BInfowindow.template_opts.attrs[i],r=d[n.id];"undefined"!=typeof r&&(n.value=r)}}BInfowindow.updateContent(BInfowindow.template_opts,t)};switch(e){case"marker":MarkerUtils.saveMarker(t,i,d,b);break;case"line":LineUtils.saveLine(t,i,d,b);break;case"region":RegionUtils.saveRegion(t,i,d,b)}t.disableEditing()},BInfowindow._bindImageNextClickEvent=function(t,e){$(t).unbind("click"),$(t).click(function(){for(var t=$(e),i=t.children().length,n=0;n<i;n++)if(t.children().eq(n).find("img").get(0).className.indexOf("dt-block")>=0&&n!=i){t.children().eq(n).find("img").removeClass("dt-block").addClass("dt-none"),t.children().eq(n+1).find("img").removeClass("dt-none").addClass("dt-block"),$("#currentImg").text(t.children().eq(n+1).find("img").attr("data-img")),$("#totalImg").text()==t.children().eq(n+1).find("img").attr("data-img")&&$("#nextImg").hide(),$("#prevImg").show();break}})},BInfowindow._bindImagePrevClickEvent=function(t,e){$(t).unbind("click"),$(t).click(function(){for(var t=$(e),i=t.children().length,n=0;n<i;n++)if(t.children().eq(n).find("img").get(0).className.indexOf("dt-block")>=0&&n!=i){t.children().eq(n).find("img").removeClass("dt-block").addClass("dt-none"),t.children().eq(n-1).find("img").removeClass("dt-none").addClass("dt-block"),$("#currentImg").text(t.children().eq(n-1).find("img").attr("data-img")),"1"==$("#currentImg").text()&&$("#prevImg").hide(),$("#nextImg").show();break}})},BInfowindow._addImagesHtml=function(t){for(var e="<div class='image-layer dt-bg-38 dt-mar6b'><div id='slides' class='text-center dt-h206  dt-pos-r'>",i=0;i<t.length;i++){e+="<span class='dt-show-img dt-line-206h dt-show dt-pointer'>";var n="dt-none";0==i&&(n="dt-block"),e+="<img src='"+oss_host+t[i].url+"' data-img='"+(i+1)+"' img_id='"+t[i].id+"' data-url='"+oss_host+t[i].original+"' class='"+n+"'/>",e+="</span>"}e+="</div>";var r="";return 1==t.length&&(r="dt-none"),e+="<div class='text-center white dt-pad6b imgs-bar'><span id='prevImg' class='dt-pointer dt-none'><</span>&nbsp;&nbsp;<span>\u7b2c<span id='currentImg'>1</span>\u5f20\uff0c\u5171<span id='totalImg'>"+t.length+"</span>\u5f20</span>&nbsp;&nbsp;<span id='nextImg' class='dt-pointer "+r+"'>></span></div>",e+="</div>"},BInfowindow.close=function(t){if(this._infowindow){if(t&&!BInfowindow._isCurrentOverlay(t))return;this._infowindow.remove(),delete BInfowindow.overlay}},BInfowindow._subTitle=function(t,e){return t.length>16?t.substring(0,e)+"...":t},BInfowindow._getOverlayTitleId=function(t,e){for(var i="",n=0;n<t.length;n++){var r=t[n];if(r.key==e){i=r.id;break}}return i},BInfowindow._getRole=function(t,e){var i=PermissionUtils.loginUserRole(user_phone,{mapUsers:BInfowindow._map.cooperation,layerUsers:t.cooperation,featureUsers:e.cooperation});return i||(i="\u5730\u56fe\u8bbf\u5ba2"),i},BInfowindow._getBtns=function(t,e,i){var n=BInfowindow._role[t],r=BInfowindow._render_style[e+"_render_"+i];return MapUtils.getArrayIntersect(n,r)},BInfowindow.isOpen=function(){return this._infowindow&&this._infowindow.isOpen()},BInfowindow._uploadImages=function(t,e,i){$('[data-toggle="tooltip"]').tooltip("destroy").tooltip(),$("#bind_imgs").attr("feature_id",t).attr("layer-id",e).attr("type",i),$("#uploadImgsModal").modal("show")},BInfowindow.updateContent=function(t,e){if(MapUtils.reloadTooltip(),BInfowindow._infowindow){var i,n;"marker"==e.type?n=BInfowindow._hashMap.get("m_"+e.layer_id):"line"==e.type?n=BInfowindow._hashMap.get("l_"+e.layer_id):"region"==e.type&&(n=BInfowindow._hashMap.get("r_"+e.layer_id)),t.attrs=BInfowindow._getOverlayAttrs(e,n,t.status),i="edit"==t.status?$.templates.infowindow_template_edit.render(t):$.templates.infowindow_template_show.render(t),BInfowindow._infowindow.setContent(i),$("#attr_details textarea, #attr_details input").unbind(),"edit"==t.status&&$.each($(".infowindow-date-time-picker"),function(t,e){var i=$(e),n=i.find(".edit-time-date").attr("data-value");n=moment(n,"YYYY-MM-DD HH:mm:ss"),n.isValid()||(n=null),i.datetimepicker({format:"YYYY-MM-DD HH:mm:ss",defaultDate:n,widgetParent:$("#mapContainer"),tooltips:MapUtils.getDateTimePickerTooltip()}).on("dp.show",function(t){var e=$(t.target).offset().left,i=$(t.target).offset().top;$(".usetwentyfour").hasClass("top")?BInfowindow._dateOffsetPosition(e,i,"top"):$(".usetwentyfour").hasClass("bottom pull-right")?BInfowindow._dateOffsetPosition(e,i,"bottom-right"):BInfowindow._dateOffsetPosition(e,i,"bottom-left")})}),$('[data-toggle="tooltip"]').tooltip("destroy").tooltip(),setTimeout(function(){BInfowindow._initHDImgs()},100),$(".BMapLib_SearchInfoWindow").addClass("dt-pos-r"),$("#attr_details textarea, #attr_details input").focus(function(t){$(t.target).closest("td").prev().find("span").removeClass("dt-none")}).blur(function(t){$(t.target).closest("td").prev().find("span").addClass("dt-none");var e=$(t.target).attr("data-field-type");if("date"==e){var i,n,r;i=$(t.target).val(),r=$(t.target).closest(".validate-date-panel"),n=MapUtils.validateFieldDate(i),null!=n&&r&&BInfowindow._changeValidatePanelStyle(r,n)}else if("number"==e){var a=$(t.target).val(),o=MapUtils.validateFieldNumber(a);BInfowindow._changeValidatePanelStyle($(t.target).closest(".validate-panel"),o)}else BInfowindow._changeValidatePanelStyle($(t.target).closest(".validate-panel"),1)})}},BInfowindow._changeValidatePanelStyle=function(t,e){switch(e){case 0:t.removeClass("has-success").removeClass("has-error");break;case 1:t.addClass("has-success").removeClass("has-error");break;case-1:t.addClass("has-error").removeClass("has-success")}},BInfowindow._enableTitleEditing=function(){var t=$(".dt-infowindow-title").attr("title");"undefined"!=typeof t&&null!=t||(t="");var e,i=$(".dt-infowindow-title").attr("data-field-type");if("date"==i)e="<div class='input-group infowindow-date-time-picker dt-w268'>",e+="<input type='text' class='form-control dt-h30' value='"+t+"'/>",e+="<span class='input-group-addon'>",e+="<span class='glyphicon glyphicon-calendar'></span>",e+="</span>",e+="</div>";else if("enum"==i){var n,r=$(".dt-infowindow-title").attr("data-layer-id"),a=$(".dt-infowindow-title").attr("data-layer-type");"marker"==a?n=BInfowindow._hashMap.get("m_"+r):"line"==a?n=BInfowindow._hashMap.get("l_"+r):"region"==a&&(n=BInfowindow._hashMap.get("r_"+r));var o=n.getAttrFields();e="<div class='input-group infowindow-select-title dt-w268'>",e+="<select class='form-control input-sm'>";for(var s=0;s<o.length;s++){var l=o[s];if("enum"==l.field_type&&l.field==$(".dt-infowindow-title").attr("data-field"))for(var d=0;d<l.enum_items.length;d++){var h=l.enum_items[d];e+=h==t?"<option val='"+h+"' selected>"+h+"</option>":"<option val='"+h+"'>"+h+"</option>"}}e+="</select>",e+="</div>"}else e="<input value='"+t+"' class='form-control input-sm dt-w268' />";$(".dt-infowindow-title").html(e),$(".dt-infowindow-title input").unbind().blur(function(t){var e,n=null,r=null;if("date"==i)e=$(t.target).val(),n=$(t.target).closest(".dt-infowindow-title"),r=MapUtils.validateFieldDate(e),null!=r&&n&&BInfowindow._changeValidatePanelStyle(n,r);else if("number"==i){var a=$(t.target).val(),o=MapUtils.validateFieldNumber(a);BInfowindow._changeValidatePanelStyle($(t.target).closest(".dt-infowindow-title"),o)}else BInfowindow._changeValidatePanelStyle($(t.target).closest(".dt-infowindow-title"),1)})},BInfowindow._getOverlayAttrs=function(t,e,i){for(var n,r=[],a=e.getAttrFields(),o=0;o<a.length;o++){var s=a[o],l=t.getAttr(s.id);if(l||(l={id:t.feature_id+"_"+s.id,key:s.field,value:""}),l.field_type=s.field_type,l.is_show=s.is_show,"string"==typeof l.value&&l.value.indexOf("\n")>=0&&"show"==i){n=l.value.split("\n"),l.value="";for(var d=0;d<n.length;d++)l.value+=n[d]+"<br>"}else if("string"==typeof l.value&&l.value.indexOf("br")>=0&&"edit"==i){n=l.value.split("<br>"),l.value="";for(var d=0;d<n.length;d++)l.value+=n[d]+"\n"}else"enum"==l.field_type&&"edit"==i&&(l.enum_items=s.enum_items);r.push(l)}return r},BInfowindow._dateOffsetPosition=function(t,e,i){var n=$("#mapInfoWrapper").width(),r=$(".left-slider").width(),a="-"+(n+r)+"px";if("bottom-right"==i)$(".usetwentyfour").css("left",t),$(".usetwentyfour").css("top",e),BInfowindow._initDatePosition("-40px","-396px");else if("bottom-left"==i)$(".usetwentyfour").css("left",t),$(".usetwentyfour").css("top",e),BInfowindow._initDatePosition("-40px",a);else if("top"==i){$(".usetwentyfour").css("left",t);var o=$("#mapContainer").height()-e;$(".usetwentyfour").css("bottom",o),0==$(".map-info-tab").offset().left?$(".usetwentyfour").css("margin","0 auto 86px 0px"):$(".usetwentyfour").css("margin","auto auto 86px "+a)}},BInfowindow._initDatePosition=function(t,e){0==$(".map-info-tab").offset().left?$(".usetwentyfour").css("margin","-40px auto auto 0px"):$(".usetwentyfour").css("margin",""+t+" auto auto "+e)},BInfowindow._getTitleFieldType=function(t,e){for(var i="",n=0;n<t.length;n++){var r=t[n];if(r.key==e){i=r.field_type;break}}return i},BInfowindow.refresh=function(t,e){BInfowindow.isOpen()&&BInfowindow._isCurrentOverlay(t)&&(e||t.isVisible())&&BInfowindow.open(t,{status:BInfowindow.template_opts.status})},BInfowindow._isCurrentOverlay=function(t){return t&&BInfowindow._infowindow.overlay&&t.type==BInfowindow._infowindow.overlay.type&&t.feature_id==BInfowindow._infowindow.overlay.feature_id},BInfowindow._getFieldTypeZh=function(t){return"string"==t?t="\u6587\u672c\u7c7b\u578b":"number"==t?t="\u6570\u503c\u7c7b\u578b":"date"==t?t="\u65e5\u671f\u7c7b\u578b":"enum"==t&&(t="\u4e0b\u62c9\u9009\u9879"),t},BInfowindow._initInfoWindow=function(t,e,i,n,r){BInfowindow._infowindow&&BInfowindow._infowindow.unbindPopup(),BInfowindow._infowindow=new L.Popup({autoPan:!0,autoPanPadding:L.point(100,8)}).setLatLng(t).setContent(e).openOn(BInfowindow._map),BInfowindow._infowindow.overlay=i,BInfowindow.template_opts=n,BInfowindow._infowindow.on("remove",function(t){BInfowindow._map.tempL&&BInfowindow._map.tempL.remove();var e=t.target.overlay;e&&("marker"==e.type?$("#select_marker_"+e.feature_id).removeAttr("style"):"line"==e.type?$("#li_line_id_"+e.feature_id).removeAttr("style"):"region"==e.type&&$("#li_region_id_"+e.feature_id).removeAttr("style")),$.each($(".infowindow-date-time-picker"),function(t,e){$(e).datetimepicker("destroy")})}).on("click",function(t){L.DomEvent.stopPropagation(t)}),r&&r(i)}}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery")):t(jQuery)}(function(t){var e=function(t){var e="";e+="<ul>";for(var i=0;i<t.textArray.length;i++)e+="<li class=' dt-w100 dt-h28 dt-line-24h dt-hover-gray dt-pointer'>","marker_layer"==t.type?e+="edit_layer"==t.classArray[i]?"<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"' layer-id='"+t.layerId+"' data-target='#editLayerTitle'  data-toggle='modal'>"+t.textArray[i]+"</span>":"label_setting"==t.classArray[i]?"<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"' layer-id='"+t.layerId+"' data-target='#setLabel'  data-toggle='modal'>"+t.textArray[i]+"</span>":"title_settings"==t.classArray[i]?"<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"' layer-id='"+t.layerId+"' data-target='#setTitle'  data-toggle='modal'>"+t.textArray[i]+"</span>":"infowindow_setting"==t.classArray[i]?"<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"' layer-id='"+t.layerId+"' data-target='#setShowFields'  data-toggle='modal'>"+t.textArray[i]+"</span>":"data_sort"==t.classArray[i]?"<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"' layer-id='"+t.layerId+"' data-target='#dataSort'  data-toggle='modal'>"+t.textArray[i]+"</span>":"<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"' layer-id='"+t.layerId+"'>"+t.textArray[i]+"</span>":"region_layer"==t.type?e+="edit_layer"==t.classArray[i]?"<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"' layer-id='"+t.layerId+"' data-target='#editLayerTitle'  data-toggle='modal'>"+t.textArray[i]+"</span>":"label_settings"==t.classArray[i]?"<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"' layer-id='"+t.layerId+"' data-target='#setLabel'  data-toggle='modal'>"+t.textArray[i]+"</span>":"title_settings"==t.classArray[i]?"<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"' layer-id='"+t.layerId+"' data-target='#setTitle'  data-toggle='modal'>"+t.textArray[i]+"</span>":"infowindow_setting"==t.classArray[i]?"<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"' layer-id='"+t.layerId+"' data-target='#setShowFields'  data-toggle='modal'>"+t.textArray[i]+"</span>":"<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"' layer-id='"+t.layerId+"'>"+t.textArray[i]+"</span>":"line_layer"==t.type&&(e+="edit_layer"==t.classArray[i]?"<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"' layer-id='"+t.layerId+"' data-target='#editLayerTitle' data-toggle='modal'>"+t.textArray[i]+"</span>":"label_settings"==t.classArray[i]?"<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"' layer-id='"+t.layerId+"' data-target='#setLabel' data-toggle='modal'>"+t.textArray[i]+"</span>":"title_settings"==t.classArray[i]?"<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"' layer-id='"+t.layerId+"' data-target='#setTitle' data-toggle='modal'>"+t.textArray[i]+"</span>":"infowindow_setting"==t.classArray[i]?"<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"' layer-id='"+t.layerId+"' data-target='#setShowFields' data-toggle='modal'>"+t.textArray[i]+"</span>":"<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"' layer-id='"+t.layerId+"'>"+t.textArray[i]+"</span>"),e+="</li>";return e+="</ul>"},i=function(t){var e="";e+="<ul>";for(var i=0;i<t.textArray.length;i++)e+="<li class=' dt-w100 dt-h28 dt-line-24h dt-hover-gray dt-pointer'>",e+="<span class='black dt-show dt-line-28h dt-sub dt-child "+t.classArray[i]+"'>"+t.textArray[i]+"</span>",e+="</li>";return e+="</ul>"},n=function(n){var r={id:t(this).attr("id"),style:"",textArray:"",classArray:"",isLayer:!1,layerId:"",type:"",callback:null};n=t.extend(r,n),t(".dt-panel").remove();var o="<div id='mypanel' class='text-center dt-pos-a dt-bg-white dt-z10 dt-panel' style='"+n.style+" ;box-shadow: 0 2px 4px rgba(0,0,0,0.2);'>"+a();o+=n.isLayer?e(n):i(n),o+="</div>",t("body").append(o);var s=t("#mypanel"),l=window.innerHeight-s[0].offsetTop,d=s.height();if(l<d+4){var h=window.innerHeight-d-4;s.css("top",h+"px")}null!=n.callback&&n.callback(),t(".dt-panel").click(function(){t(".dt-panel").remove(),t(".col-field-type").remove()})},r=function(){t(".dt-panel").remove()},a=function(){return"<div class='dt-hidden' style='border-bottom: 1px solid #eee;'><span class='close-btn' onclick='$(\".dt-panel\").remove()'>x</span></div>"},o={init:n,close:r};t.fn.DtPanel=function(e){return o[e]?o[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.DtFilter"):o.init.apply(this,arguments)}}),function(t){var e={init:function(t,i){return function(){e.fillHtml(t,i),e.bindEvent(t,i)}()},fillHtml:function(t,e){return function(){t.empty(),e.current>1?t.append('<a href="javascript:;" class="prevPage">\u4e0a\u4e00\u9875</a>'):(t.remove(".prevPage"),t.append('<span class="disabled">\u4e0a\u4e00\u9875</span>')),1!=e.current&&e.current>=4&&4!=e.pageCount&&t.append('<a href="javascript:;" class="tcdNumber">1</a>'),e.current-2>2&&e.current<=e.pageCount&&e.pageCount>5&&t.append("<span>...</span>");var i=e.current-2,n=e.current+2;for((i>1&&e.current<4||1==e.current)&&n++,e.current>e.pageCount-4&&e.current>=e.pageCount&&i--;i<=n;i++)i<=e.pageCount&&i>=1&&(i!=e.current?t.append('<a href="javascript:;" class="tcdNumber">'+i+"</a>"):t.append('<span class="current">'+i+"</span>"));e.current+2<e.pageCount-1&&e.current>=1&&e.pageCount>5&&t.append("<span>...</span>"),e.current!=e.pageCount&&e.current<e.pageCount-2&&4!=e.pageCount&&t.append('<a href="javascript:;" class="tcdNumber">'+e.pageCount+"</a>"),e.current<e.pageCount?t.append('<a href="javascript:;" class="nextPage">\u4e0b\u4e00\u9875</a>'):(t.remove(".nextPage"),t.append('<span class="disabled">\u4e0b\u4e00\u9875</span>'))}()},bindEvent:function(i,n){return function(){i.on("click","a.tcdNumber",function(){var r=parseInt(t(this).text());e.fillHtml(i,{current:r,pageCount:parseInt(n.pageCount)}),"function"==typeof n.backFn&&n.backFn(r)}),i.on("click","a.prevPage",function(){var t=parseInt(i.children("span.current").text());e.fillHtml(i,{current:t-1,pageCount:parseInt(n.pageCount)}),"function"==typeof n.backFn&&n.backFn(t-1)}),i.on("click","a.nextPage",function(){var t=parseInt(i.children("span.current").text());e.fillHtml(i,{current:t+1,pageCount:parseInt(n.pageCount)}),"function"==typeof n.backFn&&n.backFn(t+1)})}()}};t.fn.createPage=function(i){var n=t.extend({totalCount:null,pageShow:null,current:1,backFn:function(){}},i);n.totalCount%n.pageShow==0?n.pageCount=n.totalCount/n.pageShow:n.pageCount=((n.totalCount+n.pageShow-1)/n.pageShow).toFixed(0),e.init(this,n)}}(jQuery),Dtwy.CityList={municipalities:[{name:"\u5317\u4eac",center:"116.395645,39.929986|12"},{name:"\u4e0a\u6d77",center:"121.487899,31.249162|12"},{name:"\u5929\u6d25",center:"117.210813,39.14393|12"},{name:"\u91cd\u5e86",center:"106.530635,29.544606|12"}],provinces:[{name:"\u5b89\u5fbd",center:"117.216005,31.859252|8",cities:[{name:"\u5408\u80a5",center:"117.282699,31.866942|12"},{name:"\u5b89\u5e86",center:"117.058739,30.537898|13"},{name:"\u868c\u57e0",center:"117.35708,32.929499|13"},{name:"\u4eb3\u5dde",center:"115.787928,33.871211|13"},{name:"\u5de2\u6e56",center:"117.88049,31.608733|13"},{name:"\u6c60\u5dde",center:"117.494477,30.660019|14"},{name:"\u6ec1\u5dde",center:"118.32457,32.317351|13"},{name:"\u961c\u9633",center:"115.820932,32.901211|13"},{name:"\u6dee\u5317",center:"116.791447,33.960023|13"},{name:"\u6dee\u5357",center:"117.018639,32.642812|13"},{name:"\u9ec4\u5c71",center:"118.29357,29.734435|13"},{name:"\u516d\u5b89",center:"116.505253,31.755558|13"},{name:"\u9a6c\u978d\u5c71",center:"118.515882,31.688528|13"},{name:"\u5bbf\u5dde",center:"116.988692,33.636772|13"},{name:"\u94dc\u9675",center:"117.819429,30.94093|14"},{name:"\u829c\u6e56",center:"118.384108,31.36602|12"},{name:"\u5ba3\u57ce",center:"118.752096,30.951642|13"}]},{name:"\u798f\u5efa",center:"117.984943,26.050118|8",cities:[{name:"\u798f\u5dde",center:"119.330221,26.047125|12"},{name:"\u9f99\u5ca9",center:"117.017997,25.078685|13"},{name:"\u5357\u5e73",center:"118.181883,26.643626|13"},{name:"\u5b81\u5fb7",center:"119.542082,26.656527|14"},{name:"\u8386\u7530",center:"119.077731,25.44845|13"},{name:"\u6cc9\u5dde",center:"118.600362,24.901652|12"},{name:"\u4e09\u660e",center:"117.642194,26.270835|14"},{name:"\u53a6\u95e8",center:"118.103886,24.489231|12"},{name:"\u6f33\u5dde",center:"117.676205,24.517065|12"}]},{name:"\u7518\u8083",center:"102.457625,38.103267|6",cities:[{name:"\u5170\u5dde",center:"103.823305,36.064226|12"},{name:"\u767d\u94f6",center:"104.171241,36.546682|13"},{name:"\u5b9a\u897f",center:"104.626638,35.586056|13"},{name:"\u7518\u5357\u5dde",center:"102.917442,34.992211|14"},{name:"\u5609\u5cea\u5173",center:"98.281635,39.802397|13"},{name:"\u91d1\u660c",center:"102.208126,38.516072|13"},{name:"\u9152\u6cc9",center:"98.508415,39.741474|13"},{name:"\u4e34\u590f\u5dde",center:"103.215249,35.598514|13"},{name:"\u9647\u5357",center:"104.934573,33.39448|14"},{name:"\u5e73\u51c9",center:"106.688911,35.55011|13"},{name:"\u5e86\u9633",center:"107.644227,35.726801|13"},{name:"\u5929\u6c34",center:"105.736932,34.584319|13"},{name:"\u6b66\u5a01",center:"102.640147,37.933172|13"},{name:"\u5f20\u6396",center:"100.459892,38.93932|13"}]},{name:"\u5e7f\u4e1c",center:"113.394818,23.408004|8",cities:[{name:"\u5e7f\u5dde",center:"113.30765,23.120049|12"},{name:"\u6f6e\u5dde",center:"116.630076,23.661812|13"},{name:"\u4e1c\u839e",center:"113.763434,23.043024|12"},{name:"\u4f5b\u5c71",center:"113.134026,23.035095|13"},{name:"\u6cb3\u6e90",center:"114.713721,23.757251|12"},{name:"\u60e0\u5dde",center:"114.410658,23.11354|12"},{name:"\u6c5f\u95e8",center:"113.078125,22.575117|13"},{name:"\u63ed\u9633",center:"116.379501,23.547999|13"},{name:"\u8302\u540d",center:"110.931245,21.668226|13"},{name:"\u6885\u5dde",center:"116.126403,24.304571|13"},{name:"\u6e05\u8fdc",center:"113.040773,23.698469|13"},{name:"\u6c55\u5934",center:"116.72865,23.383908|13"},{name:"\u6c55\u5c3e",center:"115.372924,22.778731|14"},{name:"\u97f6\u5173",center:"113.594461,24.80296|13"},{name:"\u6df1\u5733",center:"114.025974,22.546054|12"},{name:"\u9633\u6c5f",center:"111.97701,21.871517|14"},{name:"\u4e91\u6d6e",center:"112.050946,22.937976|13"},{name:"\u6e5b\u6c5f",center:"110.365067,21.257463|13"},{name:"\u8087\u5e86",center:"112.479653,23.078663|13"},{name:"\u4e2d\u5c71",center:"113.42206,22.545178|12"},{name:"\u73e0\u6d77",center:"113.562447,22.256915|13"}]},{name:"\u5e7f\u897f",center:"108.924274,23.552255|7",cities:[{name:"\u5357\u5b81",center:"108.297234,22.806493|12"},{name:"\u767e\u8272",center:"106.631821,23.901512|13"},{name:"\u5317\u6d77",center:"109.122628,21.472718|13"},{name:"\u5d07\u5de6",center:"107.357322,22.415455|14"},{name:"\u9632\u57ce\u6e2f",center:"108.351791,21.617398|15"},{name:"\u6842\u6797",center:"110.26092,25.262901|12"},{name:"\u8d35\u6e2f",center:"109.613708,23.103373|13"},{name:"\u6cb3\u6c60",center:"108.069948,24.699521|14"},{name:"\u8d3a\u5dde",center:"111.552594,24.411054|14"},{name:"\u6765\u5bbe",center:"109.231817,23.741166|14"},{name:"\u67f3\u5dde",center:"109.422402,24.329053|12"},{name:"\u94a6\u5dde",center:"108.638798,21.97335|13"},{name:"\u68a7\u5dde",center:"111.305472,23.485395|13"},{name:"\u7389\u6797",center:"110.151676,22.643974|14"}]},{name:"\u8d35\u5dde",center:"106.734996,26.902826|8",cities:[{name:"\u8d35\u9633",center:"106.709177,26.629907|12"},{name:"\u5b89\u987a",center:"105.92827,26.228595|13"},{name:"\u6bd5\u8282\u5730\u533a",center:"105.300492,27.302612|14"},{name:"\u516d\u76d8\u6c34",center:"104.852087,26.591866|13"},{name:"\u94dc\u4ec1\u5730\u533a",center:"109.196161,27.726271|14"},{name:"\u9075\u4e49",center:"106.93126,27.699961|13"},{name:"\u9ed4\u897f\u5357\u5dde",center:"104.900558,25.095148|11"},{name:"\u9ed4\u4e1c\u5357\u5dde",center:"107.985353,26.583992|11"},{name:"\u9ed4\u5357\u5dde",center:"107.523205,26.264536|11"}]},{name:"\u6d77\u5357",center:"109.733755,19.180501|9",cities:[{name:"\u6d77\u53e3",center:"110.330802,20.022071|13"},{name:"\u767d\u6c99",center:"109.358586,19.216056|12"},{name:"\u4fdd\u4ead",center:"109.656113,18.597592|12"},{name:"\u660c\u6c5f",center:"109.0113,19.222483|12"},{name:"\u510b\u5dde",center:"109.413973,19.571153|13"},{name:"\u6f84\u8fc8",center:"109.996736,19.693135|13"},{name:"\u4e1c\u65b9",center:"108.85101,18.998161|13"},{name:"\u5b9a\u5b89",center:"110.32009,19.490991|13"},{name:"\u743c\u6d77",center:"110.414359,19.21483|13"},{name:"\u743c\u4e2d",center:"109.861849,19.039771|12"},{name:"\u4e50\u4e1c",center:"109.062698,18.658614|12"},{name:"\u4e34\u9ad8",center:"109.724101,19.805922|13"},{name:"\u9675\u6c34",center:"109.948661,18.575985|12"},{name:"\u4e09\u4e9a",center:"109.522771,18.257776|12"},{name:"\u5c6f\u660c",center:"110.063364,19.347749|13"},{name:"\u4e07\u5b81",center:"110.292505,18.839886|13"},{name:"\u6587\u660c",center:"110.780909,19.750947|13"},{name:"\u4e94\u6307\u5c71",center:"109.51775,18.831306|13"}]},{name:"\u6cb3\u5317",center:"115.661434,38.61384|7",cities:[{name:"\u77f3\u5bb6\u5e84",center:"114.522082,38.048958|12"},{name:"\u4fdd\u5b9a",center:"115.49481,38.886565|13"},{name:"\u6ca7\u5dde",center:"116.863806,38.297615|13"},{name:"\u627f\u5fb7",center:"117.933822,40.992521|14"},{name:"\u90af\u90f8",center:"114.482694,36.609308|13"},{name:"\u8861\u6c34",center:"115.686229,37.746929|13"},{name:"\u5eca\u574a",center:"116.703602,39.518611|13"},{name:"\u79e6\u7687\u5c9b",center:"119.604368,39.945462|12"},{name:"\u5510\u5c71",center:"118.183451,39.650531|13"},{name:"\u90a2\u53f0",center:"114.520487,37.069531|13"},{name:"\u5f20\u5bb6\u53e3",center:"114.893782,40.811188|13"}]},{name:"\u6cb3\u5357",center:"113.486804,34.157184|7",cities:[{name:"\u90d1\u5dde",center:"113.649644,34.75661|12"},{name:"\u5b89\u9633",center:"114.351807,36.110267|12"},{name:"\u9e64\u58c1",center:"114.29777,35.755426|13"},{name:"\u7126\u4f5c",center:"113.211836,35.234608|13"},{name:"\u5f00\u5c01",center:"114.351642,34.801854|13"},{name:"\u6d1b\u9633",center:"112.447525,34.657368|12"},{name:"\u6f2f\u6cb3",center:"114.046061,33.576279|13"},{name:"\u5357\u9633",center:"112.542842,33.01142|13"},{name:"\u5e73\u9876\u5c71",center:"113.300849,33.745301|13"},{name:"\u6fee\u9633",center:"115.026627,35.753298|12"},{name:"\u4e09\u95e8\u5ce1",center:"111.181262,34.78332|13"},{name:"\u5546\u4e18",center:"115.641886,34.438589|13"},{name:"\u65b0\u4e61",center:"113.91269,35.307258|13"},{name:"\u4fe1\u9633",center:"114.085491,32.128582|13"},{name:"\u8bb8\u660c",center:"113.835312,34.02674|13"},{name:"\u5468\u53e3",center:"114.654102,33.623741|13"},{name:"\u9a7b\u9a6c\u5e97",center:"114.049154,32.983158|13"}]},{name:"\u9ed1\u9f99\u6c5f",center:"128.047414,47.356592|6",cities:[{name:"\u54c8\u5c14\u6ee8",center:"126.657717,45.773225|12"},{name:"\u5927\u5e86",center:"125.02184,46.596709|12"},{name:"\u5927\u5174\u5b89\u5cad\u5730\u533a",
center:"124.196104,51.991789|10"},{name:"\u9e64\u5c97",center:"130.292472,47.338666|13"},{name:"\u9ed1\u6cb3",center:"127.50083,50.25069|14"},{name:"\u9e21\u897f",center:"130.941767,45.32154|13"},{name:"\u4f73\u6728\u65af",center:"130.284735,46.81378|12"},{name:"\u7261\u4e39\u6c5f",center:"129.608035,44.588521|13"},{name:"\u4e03\u53f0\u6cb3",center:"131.019048,45.775005|14"},{name:"\u9f50\u9f50\u54c8\u5c14",center:"123.987289,47.3477|13"},{name:"\u53cc\u9e2d\u5c71",center:"131.171402,46.655102|13"},{name:"\u7ee5\u5316",center:"126.989095,46.646064|13"},{name:"\u4f0a\u6625",center:"128.910766,47.734685|14"}]},{name:"\u6e56\u5317",center:"112.410562,31.209316|8",cities:[{name:"\u6b66\u6c49",center:"114.3162,30.581084|12"},{name:"\u9102\u5dde",center:"114.895594,30.384439|14"},{name:"\u6069\u65bd",center:"109.517433,30.308978|14"},{name:"\u9ec4\u5188",center:"114.906618,30.446109|14"},{name:"\u9ec4\u77f3",center:"115.050683,30.216127|13"},{name:"\u8346\u95e8",center:"112.21733,31.042611|13"},{name:"\u8346\u5dde",center:"112.241866,30.332591|12"},{name:"\u6f5c\u6c5f",center:"112.768768,30.343116|13"},{name:"\u795e\u519c\u67b6\u6797\u533a",center:"110.487231,31.595768|13"},{name:"\u5341\u5830",center:"110.801229,32.636994|13"},{name:"\u968f\u5dde",center:"113.379358,31.717858|13"},{name:"\u5929\u95e8",center:"113.12623,30.649047|13"},{name:"\u4ed9\u6843",center:"113.387448,30.293966|13"},{name:"\u54b8\u5b81",center:"114.300061,29.880657|13"},{name:"\u8944\u6a0a",center:"112.176326,32.094934|12"},{name:"\u5b5d\u611f",center:"113.935734,30.927955|13"},{name:"\u5b9c\u660c",center:"111.310981,30.732758|13"}]},{name:"\u6e56\u5357",center:"111.720664,27.695864|7",cities:[{name:"\u957f\u6c99",center:"112.979353,28.213478|12"},{name:"\u5e38\u5fb7",center:"111.653718,29.012149|12"},{name:"\u90f4\u5dde",center:"113.037704,25.782264|13"},{name:"\u8861\u9633",center:"112.583819,26.898164|13"},{name:"\u6000\u5316",center:"109.986959,27.557483|13"},{name:"\u5a04\u5e95",center:"111.996396,27.741073|13"},{name:"\u90b5\u9633",center:"111.461525,27.236811|13"},{name:"\u6e58\u6f6d",center:"112.935556,27.835095|13"},{name:"\u6e58\u897f\u5dde",center:"109.745746,28.317951|14"},{name:"\u76ca\u9633",center:"112.366547,28.588088|13"},{name:"\u6c38\u5dde",center:"111.614648,26.435972|13"},{name:"\u5cb3\u9633",center:"113.146196,29.378007|13"},{name:"\u5f20\u5bb6\u754c",center:"110.48162,29.124889|13"},{name:"\u682a\u6d32",center:"113.131695,27.827433|13"}]},{name:"\u6c5f\u82cf",center:"119.368489,33.013797|8",cities:[{name:"\u5357\u4eac",center:"118.778074,32.057236|12"},{name:"\u5e38\u5dde",center:"119.981861,31.771397|12"},{name:"\u6dee\u5b89",center:"119.030186,33.606513|12"},{name:"\u8fde\u4e91\u6e2f",center:"119.173872,34.601549|12"},{name:"\u5357\u901a",center:"120.873801,32.014665|12"},{name:"\u82cf\u5dde",center:"120.619907,31.317987|12"},{name:"\u5bbf\u8fc1",center:"118.296893,33.95205|13"},{name:"\u6cf0\u5dde",center:"119.919606,32.476053|13"},{name:"\u65e0\u9521",center:"120.305456,31.570037|12"},{name:"\u5f90\u5dde",center:"117.188107,34.271553|12"},{name:"\u76d0\u57ce",center:"120.148872,33.379862|12"},{name:"\u626c\u5dde",center:"119.427778,32.408505|13"},{name:"\u9547\u6c5f",center:"119.455835,32.204409|13"}]},{name:"\u6c5f\u897f",center:"115.676082,27.757258|7",cities:[{name:"\u5357\u660c",center:"115.893528,28.689578|12"},{name:"\u629a\u5dde",center:"116.360919,27.954545|13"},{name:"\u8d63\u5dde",center:"114.935909,25.845296|13"},{name:"\u5409\u5b89",center:"114.992039,27.113848|13"},{name:"\u666f\u5fb7\u9547",center:"117.186523,29.303563|12"},{name:"\u4e5d\u6c5f",center:"115.999848,29.71964|13"},{name:"\u840d\u4e61",center:"113.859917,27.639544|13"},{name:"\u4e0a\u9976",center:"117.955464,28.457623|13"},{name:"\u65b0\u4f59",center:"114.947117,27.822322|13"},{name:"\u5b9c\u6625",center:"114.400039,27.81113|13"},{name:"\u9e70\u6f6d",center:"117.03545,28.24131|13"}]},{name:"\u5409\u6797",center:"126.262876,43.678846|7",cities:[{name:"\u957f\u6625",center:"125.313642,43.898338|12"},{name:"\u767d\u57ce",center:"122.840777,45.621086|13"},{name:"\u767d\u5c71",center:"126.435798,41.945859|13"},{name:"\u5409\u6797\u5e02",center:"126.564544,43.871988|12"},{name:"\u8fbd\u6e90",center:"125.133686,42.923303|13"},{name:"\u56db\u5e73",center:"124.391382,43.175525|12"},{name:"\u677e\u539f",center:"124.832995,45.136049|13"},{name:"\u901a\u5316",center:"125.94265,41.736397|13"},{name:"\u5ef6\u8fb9",center:"129.485902,42.896414|13"}]},{name:"\u8fbd\u5b81",center:"122.753592,41.6216|8",cities:[{name:"\u6c88\u9633",center:"123.432791,41.808645|12"},{name:"\u978d\u5c71",center:"123.007763,41.118744|13"},{name:"\u672c\u6eaa",center:"123.778062,41.325838|12"},{name:"\u671d\u9633",center:"120.446163,41.571828|13"},{name:"\u5927\u8fde",center:"121.593478,38.94871|12"},{name:"\u4e39\u4e1c",center:"124.338543,40.129023|12"},{name:"\u629a\u987a",center:"123.92982,41.877304|12"},{name:"\u961c\u65b0",center:"121.660822,42.01925|14"},{name:"\u846b\u82a6\u5c9b",center:"120.860758,40.74303|13"},{name:"\u9526\u5dde",center:"121.147749,41.130879|13"},{name:"\u8fbd\u9633",center:"123.172451,41.273339|14"},{name:"\u76d8\u9526",center:"122.073228,41.141248|13"},{name:"\u94c1\u5cad",center:"123.85485,42.299757|13"},{name:"\u8425\u53e3",center:"122.233391,40.668651|13"}]},{name:"\u5185\u8499\u53e4",center:"114.415868,43.468238|5",cities:[{name:"\u547c\u548c\u6d69\u7279",center:"111.660351,40.828319|12"},{name:"\u963f\u62c9\u5584\u76df",center:"105.695683,38.843075|14"},{name:"\u5305\u5934",center:"109.846239,40.647119|12"},{name:"\u5df4\u5f66\u6dd6\u5c14",center:"107.423807,40.76918|12"},{name:"\u8d64\u5cf0",center:"118.930761,42.297112|12"},{name:"\u9102\u5c14\u591a\u65af",center:"109.993706,39.81649|12"},{name:"\u547c\u4f26\u8d1d\u5c14",center:"119.760822,49.201636|12"},{name:"\u901a\u8fbd",center:"122.260363,43.633756|12"},{name:"\u4e4c\u6d77",center:"106.831999,39.683177|13"},{name:"\u4e4c\u5170\u5bdf\u5e03",center:"113.112846,41.022363|12"},{name:"\u9521\u6797\u90ed\u52d2\u76df",center:"116.02734,43.939705|11"},{name:"\u5174\u5b89\u76df",center:"122.048167,46.083757|11"}]},{name:"\u5b81\u590f",center:"106.155481,37.321323|8",cities:[{name:"\u94f6\u5ddd",center:"106.206479,38.502621|12"},{name:"\u56fa\u539f",center:"106.285268,36.021523|13"},{name:"\u77f3\u5634\u5c71",center:"106.379337,39.020223|13"},{name:"\u5434\u5fe0",center:"106.208254,37.993561|14"},{name:"\u4e2d\u536b",center:"105.196754,37.521124|14"}]},{name:"\u9752\u6d77",center:"96.202544,35.499761|7",cities:[{name:"\u897f\u5b81",center:"101.767921,36.640739|12"},{name:"\u679c\u6d1b\u5dde",center:"100.223723,34.480485|11"},{name:"\u6d77\u4e1c\u5730\u533a",center:"102.085207,36.51761|11"},{name:"\u6d77\u5317\u5dde",center:"100.879802,36.960654|11"},{name:"\u6d77\u5357\u5dde",center:"100.624066,36.284364|11"},{name:"\u6d77\u897f\u5dde",center:"97.342625,37.373799|11"},{name:"\u9ec4\u5357\u5dde",center:"102.0076,35.522852|11"},{name:"\u7389\u6811\u5dde",center:"97.013316,33.00624|14"}]},{name:"\u5c71\u4e1c",center:"118.527663,36.09929|8",cities:[{name:"\u6d4e\u5357",center:"117.024967,36.682785|12"},{name:"\u6ee8\u5dde",center:"117.968292,37.405314|12"},{name:"\u4e1c\u8425",center:"118.583926,37.487121|12"},{name:"\u5fb7\u5dde",center:"116.328161,37.460826|12"},{name:"\u83cf\u6cfd",center:"115.46336,35.26244|13"},{name:"\u6d4e\u5b81",center:"116.600798,35.402122|13"},{name:"\u83b1\u829c",center:"117.684667,36.233654|13"},{name:"\u804a\u57ce",center:"115.986869,36.455829|12"},{name:"\u4e34\u6c82",center:"118.340768,35.072409|12"},{name:"\u9752\u5c9b",center:"120.384428,36.105215|12"},{name:"\u65e5\u7167",center:"119.50718,35.420225|12"},{name:"\u6cf0\u5b89",center:"117.089415,36.188078|13"},{name:"\u5a01\u6d77",center:"122.093958,37.528787|13"},{name:"\u6f4d\u574a",center:"119.142634,36.716115|12"},{name:"\u70df\u53f0",center:"121.309555,37.536562|12"},{name:"\u67a3\u5e84",center:"117.279305,34.807883|13"},{name:"\u6dc4\u535a",center:"118.059134,36.804685|12"}]},{name:"\u5c71\u897f",center:"112.515496,37.866566|7",cities:[{name:"\u592a\u539f",center:"112.550864,37.890277|12"},{name:"\u957f\u6cbb",center:"113.120292,36.201664|12"},{name:"\u5927\u540c",center:"113.290509,40.113744|12"},{name:"\u664b\u57ce",center:"112.867333,35.499834|13"},{name:"\u664b\u4e2d",center:"112.738514,37.693362|13"},{name:"\u4e34\u6c7e",center:"111.538788,36.099745|13"},{name:"\u5415\u6881",center:"111.143157,37.527316|14"},{name:"\u6714\u5dde",center:"112.479928,39.337672|13"},{name:"\u5ffb\u5dde",center:"112.727939,38.461031|12"},{name:"\u9633\u6cc9",center:"113.569238,37.869529|13"},{name:"\u8fd0\u57ce",center:"111.006854,35.038859|13"}]},{name:"\u9655\u897f",center:"109.503789,35.860026|7",cities:[{name:"\u897f\u5b89",center:"108.953098,34.2778|12"},{name:"\u5b89\u5eb7",center:"109.038045,32.70437|13"},{name:"\u5b9d\u9e21",center:"107.170645,34.364081|12"},{name:"\u6c49\u4e2d",center:"107.045478,33.081569|13"},{name:"\u5546\u6d1b",center:"109.934208,33.873907|13"},{name:"\u94dc\u5ddd",center:"108.968067,34.908368|13"},{name:"\u6e2d\u5357",center:"109.483933,34.502358|13"},{name:"\u54b8\u9633",center:"108.707509,34.345373|13"},{name:"\u5ef6\u5b89",center:"109.50051,36.60332|13"},{name:"\u6986\u6797",center:"109.745926,38.279439|12"}]},{name:"\u56db\u5ddd",center:"102.89916,30.367481|7",cities:[{name:"\u6210\u90fd",center:"104.067923,30.679943|12"},{name:"\u963f\u575d\u5dde",center:"102.228565,31.905763|15"},{name:"\u5df4\u4e2d",center:"106.757916,31.869189|14"},{name:"\u8fbe\u5dde",center:"107.494973,31.214199|14"},{name:"\u5fb7\u9633",center:"104.402398,31.13114|13"},{name:"\u7518\u5b5c\u5dde",center:"101.969232,30.055144|15"},{name:"\u5e7f\u5b89",center:"106.63572,30.463984|13"},{name:"\u5e7f\u5143",center:"105.819687,32.44104|13"},{name:"\u4e50\u5c71",center:"103.760824,29.600958|13"},{name:"\u51c9\u5c71\u5dde",center:"102.259591,27.892393|14"},{name:"\u6cf8\u5dde",center:"105.44397,28.89593|14"},{name:"\u5357\u5145",center:"106.105554,30.800965|13"},{name:"\u7709\u5c71",center:"103.84143,30.061115|13"},{name:"\u7ef5\u9633",center:"104.705519,31.504701|12"},{name:"\u5185\u6c5f",center:"105.073056,29.599462|13"},{name:"\u6500\u679d\u82b1",center:"101.722423,26.587571|14"},{name:"\u9042\u5b81",center:"105.564888,30.557491|12"},{name:"\u96c5\u5b89",center:"103.009356,29.999716|13"},{name:"\u5b9c\u5bbe",center:"104.633019,28.769675|13"},{name:"\u8d44\u9633",center:"104.63593,30.132191|13"},{name:"\u81ea\u8d21",center:"104.776071,29.359157|13"}]},{name:"\u897f\u85cf",center:"89.137982,31.367315|6",cities:[{name:"\u62c9\u8428",center:"91.111891,29.662557|13"},{name:"\u963f\u91cc\u5730\u533a",center:"81.107669,30.404557|11"},{name:"\u660c\u90fd\u5730\u533a",center:"97.185582,31.140576|15"},{name:"\u6797\u829d\u5730\u533a",center:"94.349985,29.666941|11"},{name:"\u90a3\u66f2\u5730\u533a",center:"92.067018,31.48068|14"},{name:"\u65e5\u5580\u5219\u5730\u533a",center:"88.891486,29.269023|14"},{name:"\u5c71\u5357\u5730\u533a",center:"91.750644,29.229027|11"}]},{name:"\u65b0\u7586",center:"85.614899,42.127001|6",cities:[{name:"\u4e4c\u9c81\u6728\u9f50",center:"87.564988,43.84038|12"},{name:"\u963f\u62c9\u5c14",center:"81.291737,40.61568|13"},{name:"\u963f\u514b\u82cf\u5730\u533a",center:"80.269846,41.171731|12"},{name:"\u963f\u52d2\u6cf0\u5730\u533a",center:"88.137915,47.839744|13"},{name:"\u5df4\u97f3\u90ed\u695e",center:"86.121688,41.771362|12"},{name:"\u535a\u5c14\u5854\u62c9\u5dde",center:"82.052436,44.913651|11"},{name:"\u660c\u5409\u5dde",center:"87.296038,44.007058|13"},{name:"\u54c8\u5bc6\u5730\u533a",center:"93.528355,42.858596|13"},{name:"\u548c\u7530\u5730\u533a",center:"79.930239,37.116774|13"},{name:"\u5580\u4ec0\u5730\u533a",center:"75.992973,39.470627|12"},{name:"\u514b\u62c9\u739b\u4f9d",center:"84.88118,45.594331|13"},{name:"\u514b\u5b5c\u52d2\u82cf\u5dde",center:"76.137564,39.750346|11"},{name:"\u77f3\u6cb3\u5b50",center:"86.041865,44.308259|13"},{name:"\u5854\u57ce\u5730\u533a",center:"82.974881,46.758684|12"},{name:"\u56fe\u6728\u8212\u514b",center:"79.198155,39.889223|13"},{name:"\u5410\u9c81\u756a\u5730\u533a",center:"89.181595,42.96047|13"},{name:"\u4e94\u5bb6\u6e20",center:"87.565449,44.368899|13"},{name:"\u4f0a\u7281\u5dde",center:"81.297854,43.922248|11"}]},{name:"\u4e91\u5357",center:"101.592952,24.864213|7",cities:[{name:"\u6606\u660e",center:"102.714601,25.049153|12"},{name:"\u4fdd\u5c71",center:"99.177996,25.120489|13"},{name:"\u695a\u96c4\u5dde",center:"101.529382,25.066356|13"},{name:"\u5927\u7406\u5dde",center:"100.223675,25.5969|14"},{name:"\u5fb7\u5b8f\u5dde",center:"98.589434,24.44124|14"},{name:"\u8fea\u5e86\u5dde",center:"99.713682,27.831029|14"},{name:"\u7ea2\u6cb3\u5dde",center:"103.384065,23.367718|11"},{name:"\u4e3d\u6c5f",center:"100.229628,26.875351|13"},{name:"\u4e34\u6ca7",center:"100.092613,23.887806|14"},{name:"\u6012\u6c5f\u5dde",center:"98.859932,25.860677|14"},{name:"\u666e\u6d31",center:"100.980058,22.788778|14"},{name:"\u66f2\u9756",center:"103.782539,25.520758|12"},{name:"\u662d\u901a",center:"103.725021,27.340633|13"},{name:"\u6587\u5c71",center:"104.089112,23.401781|14"},{name:"\u897f\u53cc\u7248\u7eb3",center:"100.803038,22.009433|13"},{name:"\u7389\u6eaa",center:"102.545068,24.370447|13"}]},{name:"\u6d59\u6c5f",center:"119.957202,29.159494|8",cities:[{name:"\u676d\u5dde",center:"120.219375,30.259244|12"},{name:"\u6e56\u5dde",center:"120.137243,30.877925|12"},{name:"\u5609\u5174",center:"120.760428,30.773992|13"},{name:"\u91d1\u534e",center:"119.652576,29.102899|12"},{name:"\u4e3d\u6c34",center:"119.929576,28.4563|13"},{name:"\u5b81\u6ce2",center:"121.579006,29.885259|12"},{name:"\u8862\u5dde",center:"118.875842,28.95691|12"},{name:"\u7ecd\u5174",center:"120.592467,30.002365|13"},{name:"\u53f0\u5dde",center:"121.440613,28.668283|13"},{name:"\u6e29\u5dde",center:"120.690635,28.002838|12"},{name:"\u821f\u5c71",center:"122.169872,30.03601|13"}]}],other:[{name:"\u9999\u6e2f",center:"114.186124,22.293586|11"},{name:"\u6fb3\u95e8",center:"113.557519,22.204118|13"},{name:"\u53f0\u6e7e",center:"120.961454,23.80406|8"}]},function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery")):t(jQuery)}(function(t){var e=null,i={map:null,map_city:null,style:null},n=["city_list"],r={init:function(r){i=t.extend(i,r),e=t(this),t.when(t.lazyGetTemplate(n)).done(function(){function n(e){var n,a,o;return"\u5168\u56fd"==e?(a=5,o=L.latLng(41.6,113.5),i.map.setZoom(a),i.map.panTo(o),t(".citylist_popup_main").hide(),void t(".Dtwy_CityListCtrl").css("width","auto")):("\u5e7f\u5dde"==e||"\u6df1\u5733"==e?n=Dtwy.CityList.provinces[3].cities:"\u6210\u90fd"==e?n=Dtwy.CityList.provinces[22].cities:"\u5357\u4eac"==e?n=Dtwy.CityList.provinces[12].cities:"\u6b66\u6c49"==e?n=Dtwy.CityList.provinces[10].cities:"\u676d\u5dde"==e&&(n=Dtwy.CityList.provinces[26].cities),void r(n,e))}function r(e,n){for(var r,a,o,s=0;s<e.length;s++){var l=e[s];if(l.name==n){r=l.center.split("|")[0].toString(),a=parseInt(l.center.split("|")[1]),o=new L.latLng(r.split(",")[1],r.split(",")[0]);break}}i.map.setZoom(a),setTimeout(function(){i.map.panTo(o)},300),t(".ui_city_change").removeClass("ui_city_change_click"),t(".citylist_popup_main").hide(),t(".Dtwy_CityListCtrl").css("width","auto")}function a(e){for(var n,r,a,o=Dtwy.CityList.municipalities,s=0;s<o.length;s++){var l=o[s];if(l.name==e){n=l.center.split("|")[0].toString(),r=parseInt(l.center.split("|")[1]),a=new L.latLng(n.split(",")[1],n.split(",")[0]);break}}i.map.setZoom(r),setTimeout(function(){i.map.panTo(a)},300),t(".ui_city_change").removeClass("ui_city_change_click"),t(".citylist_popup_main").hide(),t(".Dtwy_CityListCtrl").css("width","auto")}t.views.settings.allowCode=!0;var o=t.templates.city_list.render({settings:i});e.append(o),0==i.map_city.length?MapUtils.searchCity(MapUtils.setCurrentCity):t("#cur_city_name").text(i.map_city),t(".ui_city_change_inner").click(function(){t(".citylist_popup_main").is(":visible")?(t(".ui_city_change").removeClass("ui_city_change_click"),t(".citylist_popup_main").hide(),t(".Dtwy_CityListCtrl").css("width","auto")):(t(".ui_city_change").addClass("ui_city_change_click"),t(".citylist_popup_main").show(),t(".Dtwy_CityListCtrl").css("width","400px"))}),t("#sel_city_letter_list a").click(function(){t("#city_detail_tpl").scrollTop(0);var e,i=t(this).attr("name"),n=0;"X"==i&&(n=8),e="other"!=i?t("#ctr_tr_"+i).offset().top+n:t(".sel_city_other").offset().top+n,t("#city_detail_tpl").scrollTop(e-237)}),t("#popup_close").click(function(){t(".ui_city_change").removeClass("ui_city_change_click"),t(".citylist_popup_main").hide(),t(".Dtwy_CityListCtrl").css("width","auto")}),t(".sel_city_hotcity a").click(function(){var e=t(this).attr("name");["\u5317\u4eac","\u4e0a\u6d77","\u91cd\u5e86","\u5929\u6d25"].indexOf(e)>=0?a(e):n(e)}),t("#city_detail_table a").click(function(){var e,n,r,a,o,s=t(this).attr("name");if(["\u9999\u6e2f","\u6fb3\u95e8","\u53f0\u6e7e"].indexOf(s)>=0){e=Dtwy.CityList.other;for(var l=0;l<e.length;l++){var d=e[[l]];if(d.name==s){n=d.center.split("|")[0].toString(),r=parseInt(d.center.split("|")[1]),a=new L.latLng(n.split(",")[1],n.split(",")[0]);break}}return 8==r&&r++,i.map.getZoom()!=r&&i.map.setZoom(r),setTimeout(function(){i.map.panTo(a)},300),t(".citylist_popup_main").hide(),void t(".Dtwy_CityListCtrl").css("width","auto")}e=Dtwy.CityList.provinces;for(var h=0;h<e.length;h++){var d=e[h];if(d.name==s){n=d.center.split("|")[0].toString(),r=parseInt(d.center.split("|")[1]),a=new L.latLng(n.split(",")[1],n.split(",")[0]);break}o=d.cities;for(var c=0;c<o.length;c++){var u=o[c];if(u.name==s){n=u.center.split("|")[0].toString(),r=parseInt(u.center.split("|")[1]),a=new L.latLng(n.split(",")[1],n.split(",")[0]);break}}if(r&&a)break}8==r&&r++,i.map.getZoom()!=r&&i.map.setZoom(r),setTimeout(function(){i.map.panTo(a)},300),t(".citylist_popup_main").hide(),t(".Dtwy_CityListCtrl").css("width","auto")})})}};t.fn.createCityList=function(e){return r[e]?r[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.DtFilter"):r.init.apply(this,arguments)}});var LocalSearch=window.LocalSearch=LocalSearch||{};$(function(){var t=[],e="",i="",n=!0,r="",a=L.layerGroup([]);LocalSearch.destroy=function(){LocalSearch._clearOverlays(),$("#search-results").remove(),i.dispose()},LocalSearch.init=function(t){e=t.map,n=t.autoComplete||!0;var i='<div id="search-results" class="search-data"><div class="search-title">\u641c\u7d22\u7ed3\u679c<span id="closeRD" class="pull-right" style="margin-right:5px;">\u5173\u95ed</span></div><p class="dt-h32 dt-pad6x dt-line-32h" style="border-right: 1px solid #999;">\u672c\u5730\u641c\u7d22\u7ed3\u679c</p><div id="localResults" class="dt-pad6x" style="max-height: 300px; overflow:auto;border-right: 1px solid #999;"></div><p class="dt-h32 dt-pad6x dt-line-32h" style="border-top:1px solid #999;border-right: 1px solid #999;">\u5728\u7ebf\u641c\u7d22\u7ed3\u679c</p><div id="results" style="max-height:480px;overflow:auto;"></div></div>';$("body").append(i);var r="<input id='search_input' type='text' class='dt-form-control dt-f12' placeholder='\u641c\u7d22\u540d\u79f0\u3001\u5730\u5740\u3001\u884c\u653f\u533a\u5212\u540d\u79f0'>";$("#"+t.id).append(r),$("#closeRD").click(function(){LocalSearch._clearOverlays()}),LocalSearch._bindClick("#search_btn"),LocalSearch._bindKeyup("#search_input")},LocalSearch._clearOverlays=function(){$("#results").empty().hide(),$("#localResults").empty().hide(),$("#searchBtn .glyphicon-remove").addClass("dt-none"),BInfowindow.close(),$("#search_input").val(""),a.clearLayers(),$("#search-results").fadeOut()},LocalSearch._onMarkersSet=function(e){t=[];for(var i=0;i<e.length;i++)e[i].marker.title=e[i].title,e[i].marker.description=e[i].address,e[i].marker.uid=e[i].uid,t.push(e[i].marker)},LocalSearch._widthAnimationNarrow=function(){$("#search-results").animate({width:"-=140px",right:"-=-140px"})},LocalSearch._widthAnimationAdd=function(){$("#results").fadeIn("slow")},LocalSearch._fnAddSearchResultToMap=function(i){var n=MapUtils.canAddOverlayToMap("marker",r,e);if(n){var o=$(".layer").find(".active-layer");o.hasClass("mlayer")?0!=o.length&&(current_layer_id=o.parent().attr("layer-id")):current_layer_id=-1;var s={};if(current_layer_id!=-1){var l=MarkerUtils.layersHashMap.get("m_"+current_layer_id),d=l.getAttrFields();if(null==d||0==d.length)s["\u6807\u9898"]=$("#marker_attr_0").text(),s["\u63cf\u8ff0"]=$("#marker_attr_1").text();else for(var h=0;h<d.length;h++){var c=d[h].field;c&&(s[c]=$("#marker_attr_"+h).text())}}else s["\u6807\u9898"]=$("#marker_attr_0").text(),s["\u63cf\u8ff0"]=$("#marker_attr_1").text();var u=[];t=a.getLayers();for(var p=0;p<t.length;p++){if(i.id.split("_")[1]==t[p]._leaflet_id){var f={lng:t[p].getLatLng().lng,lat:t[p].getLatLng().lat,mid:mid,marker_layer_id:current_layer_id,marker_attrs:s};MapUtils.ajax2server(add_marker_url,"POST",f,function(t){current_layer_id=t.marker.marker_layer_id});break}u.push(t[p])}}},LocalSearch.bindEvent=function(t,e,i){"click"==t?LocalSearch._bindClick(e,i):"keyup"==t&&LocalSearch._bindKeyup(e,i)},LocalSearch._bindClick=function(t){$(t).click(function(){var t=$("#search_input").val();if(0==t.length){var e="\u641c\u7d22\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a";return void PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.error)}LocalSearch._searchPOI(e)})},LocalSearch._bindKeyup=function(t){$(t).keyup(function(t){var e=$("#cur_city_name").text(),i=$(this).val();return 0==i.length?(MapUtils.removeAutoComplete(),$("#searchBtn .glyphicon-remove").addClass("dt-none")):$("#searchBtn .glyphicon-remove").removeClass("dt-none"),13==t.keyCode?void LocalSearch._searchPOI(i):void(n&&MapUtils.autoComplete(t.target,i,e,LocalSearch._searchPOI))})},LocalSearch.setLayersHashMap=function(t){r=t},LocalSearch._searchPOI=function(t){$("#search_input").val(t),$(".btn-reset-filter").trigger("click");var i=e.getCenter(),n=t,a=i.lng+","+i.lat,o={mid:mid,address:n,city:a};MapUtils.ajax2server("/search/poi","GET",o,function(t){if(t.markers){$("#localResults").empty();for(var e in t.markers){var i=r.get("m_"+e);if(i)for(var n=i.getMarkers().values(),a=t.markers[e],o=0;o<n.length;o++){var s=n[o];if(a.indexOf(s.feature_id)>=0){s.id=s.feature_id;var l=LocalSearch._search_marker_div(s,r.get("m_"+e));delete s.id,$("#localResults").append(l)}}}}$("#rWindow").text("\u6536\u8d77"),$("#search-results").fadeIn(),$("#results").fadeIn(),$("#localResults").fadeIn().unbind().click(function(t){if($(t.target).hasClass("select_marker")){var e=$(t.target).attr("layer-id"),i=$(t.target).attr("marker-id"),n=r.get("m_"+e),a=n.getMarker(i);BInfowindow.open(a)}})});var s=$("#cur_city_name").text();LocalSearch._searchPlace(n,s,1)},LocalSearch._searchPlace=function(t,e,i){var n={q:t,region:e,page_size:10,page_num:i};MapUtils.ajax2server(search_place_url,"GET",n,function(i){$("#results").empty();var n="<div class='paginate-control'></div>";$("#results").append(n),$(".paginate-control").createPage({totalCount:i.total,pageShow:10,current:1,backFn:function(i){var n={q:t,region:e,page_size:10,page_num:i};MapUtils.ajax2server(search_place_url,"GET",n,function(t){$(".search-results").remove(),LocalSearch._addSearchMarkerToMap(t.results)})}}),LocalSearch._addSearchMarkerToMap(i.results)})},LocalSearch._createSearchMarkerWindowHtml=function(t,e){var i="";""!=r&&r.get("m_"+current_layer_id)&&"marker_layer"==r.get("m_"+current_layer_id).getType()&&(i=r.get("m_"+current_layer_id).getMarkers().values());for(var n=[{key:"\u6807\u9898",value:"title"},{key:"\u63cf\u8ff0",value:"desc"}],a=0;a<i.length;a++)if(i[a].layer_id==parseInt(current_layer_id)){i[a].attrs&&(n=i[a].attrs);break}var o=[];o.push('<div id="search_attr_details">'),o.push('<table style="margin-bottom: 1px;" class="table" border="0" cellpadding="1" cellspacing="1" >');for(var s=0;s<n.length;s++)null!=n[s]&&(o.push("<tr>"),o.push('<th align="left" class="common" style="padding:2px;font-size:13px;vertical-align:top;border-top: none">'+n[s].key+"</th>"),0==s?o.push('<td style="border-top: none;padding:2px;" colspan="2"><span  id="marker_attr_'+s+'"  rows="2" cols="15"   style="width:170px;">'+e+"</span>"):o.push('<td style="border-top: none;padding:2px;" colspan="2"><span  id="marker_attr_'+s+'"  rows="2" cols="15"   style="width:170px;"></span>'),o.push("</td>"),o.push("  </tr>"));return o.push("  </table>"),o.push("</div>"),o.push(' <div class="position: absolute;bottom: 0;left: 0;padding:3px;background-color: #fff;width: 100%;">'),o.push('          <span style="padding:2px;"><input class="btn btn-primary btn-xs" type="button" '),o.push(' id="search-marker_'),o.push(t),o.push('"'),o.push('           name="btnOK"  onclick="LocalSearch._fnAddSearchResultToMap(this)" value="\u6dfb\u52a0\u70b9">'),o.push("      </span>"),o.push("</div>"),o.join("")},LocalSearch._addSearchMarkerToMap=function(t){a.clearLayers();for(var i=new Array,n=null,r=0;r<t.length;r++){var o=new L.icon({iconUrl:oss_host+"/uploads/icons/default/f86767-s-"+(r+1)+".png",iconSize:[20,33]}),s=new L.Marker(L.latLng(t[r].location.lat,t[r].location.lng),{icon:o});a.addLayer(s),i.push(s._leaflet_id),0==r&&(n=s);var l=LocalSearch._createSearchMarkerWindowHtml(s._leaflet_id,t[r].name);s.bindPopup(l)}LocalSearch._getSearchData(t,i),a.addTo(e),n&&n.openPopup()},LocalSearch._getSearchData=function(t,e){for(var i,n="<ul class='search-results dt-pad6x'>",r=0;r<t.length;r++)n+="<li class='dt-h36 dt-mar6b dt-pointer' id='li_search_"+e[r]+"'>",n+="<img src='"+oss_host+"/uploads/icons/default/f86767-s-"+(r+1)+".png' class='pull-left' style='width:14px;margin-right:4px'/>",n+="<div class='dt-hidden dt-f12'>",n+=t[r].name,n+="</div>",n+="<div class='dt-hidden dt-f12'>",i="undefined"!=typeof t[r].address&&null!=t[r].address?t[r].address:"\u6682\u65e0",n+="\u5730\u5740\uff1a"+i,n+="</div>",n+="</li>";n+="</ul>",$(".paginate-control").before(n),$(".search-results li").unbind().click(function(t){var e=$(t.target).closest("li").attr("id").split("_")[2];a.getLayer(e).openPopup()})},LocalSearch._search_marker_div=function(t,e){var i=t.uniform_title,n="";if(null!=t.attrs)for(var r=0;r<t.attrs.length;r++)if(null!=t.attrs[r]&&t.attrs[r].key==i){n=t.attrs[r].value;break}var a="<li marker-id='"+t.feature_id+"' layer-id='"+t.layer_id+"' class='dt-truncate select_marker' id='search_marker_"+t.feature_id+"'>";if(1==e.render_style){var o=e.getCanvasConfig();a+="BMAP_POINT_SHAPE_STAR"==o.shape?'<div id="search_marker_icon_'+t.feature_id+'" class="dt-mar5 pull-left glyphicon glyphicon-star canvas-star" style="color:'+o.color+'"></div>':"BMAP_POINT_SHAPE_RHOMBUS"==o.shape?'<div id="search_marker_icon_'+t.feature_id+'" class="dt-mar5 pull-left canvas-rhombus" style="background-color:'+o.color+'"></div>':"BMAP_POINT_SHAPE_SQUARE"==o.shape?'<div id="search_marker_icon_'+t.feature_id+'" class="dt-mar5 pull-left canvas-square" style="background-color:'+o.color+'"></div>':"BMAP_POINT_SHAPE_CIRCLE"==o.shape?'<div id="search_marker_icon_'+t.feature_id+'" class="dt-mar5 pull-left canvas-circle" style="background-color:'+o.color+'"></div>':'<div id="search_marker_icon_'+t.feature_id+'" class="dt-mar5 pull-left canvas-marker"></div>'}else a+=2==e.render_style?"":"<img layer-id='"+t.layer_id+"' marker-id='"+t.feature_id+"' class='select_marker' id='search_marker_icon_"+t.feature_id+"'  src='"+t.getIcon().iconUrl+"'>";return a+="<span layer-id='"+t.layer_id+"' marker-id='"+t.feature_id+"' class='select_marker marker-title' id='searchSetMarkerTitle_"+t.feature_id+"'>"+window.spacePrefix+n+"</span>",t.imgs&&t.imgs.length>0&&(a+='<span class="glyphicon glyphicon-picture pull-right dt-line-18h" id="search_marker_img_'+t.feature_id+'" ></span>'),a+="</li>"}}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery")):t(jQuery)}(function(t){var e=null,i={map:null,search_type:2,has_button:!0,localCallback:null,onlineCallback:null},n={init:function(n){function r(){e.find(".dtwy-search-btn").unbind().click(function(){var t=e.find(".dtwy-search-input").val();return 0==t.length?void PromptInfo.xcConfirm("\u641c\u7d22\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a",PromptInfo.xcConfirm.typeEnum.error):void o(t)})}function a(){e.find(".dtwy-search-input").unbind().keyup(function(e){var i=t("#dtwyCityList span").text(),n=t(this).val();return 0==n.length&&t(".autocomplete").remove(),13==e.keyCode?void o(n):void MapUtils.autoComplete(e.target,n,i,o)})}function o(n){e.find(".dtwy-search-input").val(n);var r=i.map.getCenter(),a=r.lng+","+r.lat,o={mid:mid,address:n,city:a};if(0!=i.search_type&&1!=i.search_type||MapUtils.ajax2server("/search/poi","GET",o,function(t){i.localCallback&&i.localCallback(t)}),0==i.search_type||2==i.search_type){var l=t("#dtwyCityList span").text();s(n,l,1)}}function s(t,e,n){var r={q:t,region:e,page_size:10,page_num:n};MapUtils.ajax2server(search_place_url,"GET",r,function(t){i.onlineCallback&&i.onlineCallback(t)})}i=t.extend(i,n),e=t(this);var l='<input type="text" class="form-control dtwy-search-input input-sm pull-left" placeholder="\u641c\u7d22\u540d\u79f0\u3001\u5730\u5740">';i.has_button&&(l+='<span class="input-group-btn">',l+='<button class="btn dtwy-search-btn btn-primary" type="button">\u641c\u7d22</button>',l+="</span>"),t(e).append(l),r(),a()},destroy:function(){e&&e.empty()}};t.fn.CreateSearchControl=function(e){return n[e]?n[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.CreateSearchControl"):n.init.apply(this,arguments)}}),$(function(){function t(){$('[data-toggle="tooltip"]').tooltip("destroy"),$('[data-toggle="tooltip"]').tooltip()}var e={layer:"",map:"",style:"",type:"",select_all:!1},i=null,n=!1,r=null;$.fn.openDataList=function(t){$(".dt-data-list").remove(),$.extend(e,t),r=e.layer;var i=0;if("marker"==e.type?i=r.getMarkers().getSize():"line"==e.type?i=r.getLines().getSize():"region"==e.type&&(i=r.getRegions().getSize()),0==i){var n="\u6570\u636e\u5217\u8868\u6682\u65e0\u6570\u636e";return void PromptInfo.xcConfirm(n,PromptInfo.xcConfirm.typeEnum.info)}var o=["data_list"];$.when($.lazyGetTemplate(o)).done(function(){$.views.settings.allowCode=!0,a()})};var a=function(){var a="";a=r.cooperation?PermissionUtils.loginUserRole(user_phone,{mapUsers:e.map.cooperation,layerUsers:r.cooperation}):PermissionUtils.loginUserRole(user_phone,{mapUsers:e.map.cooperation});var s=["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458","\u56fe\u5c42\u6210\u5458"].indexOf(a)==-1,l=s?"\u9000\u51fa\u6240\u9009\u4efb\u52a1":"\u6e05\u9664\u5206\u6d3e\u7ed3\u679c",d=[{style:e.style,layerName:e.layer.title,is_logout:s,logoutTxt:l,role:a,type:e.type,is_open_task:e.map.has_feature_task}],h=$.templates.data_list.render(d);$("body").append(h),setTimeout(function(){$(".dt-h40").width($(".dt-data-list").width()-20)},0);var c=_getDataTitleList(e.layer),u=_getDataModelList(e.layer),p=_getDataList(e.layer,e.type);if("undefined"!=typeof p&&null!=p){$.jgrid.defaults.responsive=!0,$.jgrid.defaults.styleUI="Bootstrap",i=$("#dataList"),i.jqGrid({datatype:"local",data:p,colNames:c,colModel:u,gridview:!0,rownumbers:!0,height:360,rowNum:20,pager:"#jqGridPager",viewrecords:!0,forceFit:!0,cellEdit:!1,cellsubmit:"clientArray",multiselect:!0,multiboxonly:!0,shrinkToFit:!1,autowidth:!1,ondblClickRow:function(t,i,n,r){var a=$(".ui-jqgrid-labels").children().eq(n).find(".ui-jqgrid-sortable").text();if(""!=a&&"\u8bb0\u5f55\u8d1f\u8d23\u4eba"!=a&&"\u64cd\u4f5c"!=a&&"id"!=a&&"cb"!=a&&"rn"!=a){var o=$(".ui-jqgrid-labels").children().eq(n).find(".field-type"),s=o.attr("data-field-type"),l=o.attr("data-field-id"),d=$(r.target).text().trim(),h=null;"marker"==e.type?h=e.layer.getMarker(t):"region"==e.type?h=e.layer.getRegion(t):"line"==e.type&&(h=e.layer.getLine(t)),h&&$(document).trigger("dt.select."+e.type,h),_showEditPanel(t,n,l,s,d,$(r.target).offset())}},beforeSelectRow:function(t,e){return $(e.target).is("input[type=checkbox]")},onSelectRow:function(t,e,i){$("#dataList");_saveSelectedRows(t,i.target),_updateSelectedRowsCount()},onSelectAll:function(){_saveCurrentPageSelectedRows(),_updateSelectedRowsCount()},onPaging:function(){_settingSelectedRows()},gridComplete:function(){$(".ui-jqgrid ").width()>600?$(".ui-jqgrid ").removeAttr("style"):i.setGridWidth(600),_filterData(),$("#selected_rows_count").text(0),$("#dataList").jqGrid("setGridParam",{cellEdit:!1}),$(".cbox.checkbox").css("margin-left","4px"),$("#cb_dataList").css("margin-left","-4px"),_updateSelectedRowsCount(),_retrieveCurrentPageSelectedRows(),$(".ui-jqgrid-htable th").unbind().click(function(){
var t=$("#dataList"),e=$("#cb_dataList");if(t.jqGrid("getGridParam","cellEdit")){var i=e.prop("checked");t.jqGrid("setGridParam",{cellEdit:!1}).trigger("reloadGrid"),i&&e.prop("checked",!0)}e.prop("checked")||_updateSelectedRowsCount()}),$(".panel-list").remove();var t=e.layer;if(_addDropDownList(t),"marker"==e.type)for(var n=t.getMarkers().values(),r=0;r<n.length;r++){var a=n[r];"undefined"==typeof a.isError||$("#"+a.feature_id).css("background","#f2dede")}$(".field-type-settings").unbind().click(function(t){$(".data-table-edit-panel").remove();var e=$(t.target).closest(".field-type").attr("data-field-id"),i=$(t.target).closest(".field-type").attr("data-field-type"),n=$(t.target).text(),r=$(t.target).closest("th").attr("id").split("_")[1];_showFieldTypePanel(e,i,n,$(t.target).offset(),r)}),$(".ui-jqgrid-labels").unbind().click(function(t){if($(".data-table-edit-panel").remove(),!$(t.target).is("input[type=checkbox]")&&"dataList_rn"!=$(t.target).attr("id")&&t.target.offsetParent){var e=t.target.offsetParent.offsetLeft-t.target.offsetParent.offsetParent.scrollLeft+(t.target.offsetParent.offsetWidth-132),i={textArray:["\u5728\u524d\u8ffd\u52a0\u5217","\u5728\u540e\u8ffd\u52a0\u5217","\u4fee\u6539\u5217\u6807\u9898","\u5220\u9664\u5217","\u5b57\u6bb5\u5185\u5bb9\u4e0d\u53ef\u91cd\u590d"],classArray:["before-col","after-col","set-col-title","del-col","unique"],style:"top:18px;left:"+e+"px",parentId:$(t.target.offsetParent).attr("id"),field_id:$(t.target.offsetParent).attr("data-field-id")},n=$(t.target).parent().find(".ui-jqgrid-sortable").text();_initDataPanel(i,n)}}),$(".ui-jqgrid-bdiv").scroll(function(){$(".dt-panel").remove(),$(".col-field-type").remove(),$(".data-table-edit-panel").remove()})}}),i.navGrid("#jqGridPager",{add:!1,edit:!1,del:!1,refresh:!0,search:!0},{},{},{},{multipleSearch:!0,title:"\u8fc7\u6ee4",onSearch:function(){n=!1,$("#clearSelectedRows").trigger("click")},onReset:function(){$("#clearSelectedRows").trigger("click"),window.filterDatas=null,$(".glyphicon-save").closest(".ui-pg-button").hide()}});var f=635;i.setGridWidth(f),$(".ui-jqgrid-bdiv").width(f).css("overflow-x","auto"),$("#jqgh_dataList_\u64cd\u4f5c").width("auto"),$(".glyphicon-save").closest(".ui-pg-button").hide(),$("#jqGridPager_left").children().hide(),$("#refresh_dataList").hide(),$(document).on("dt.update.datatable.list",function(t,e,n){for(var r=e.split(","),a=0;a<r.length;a++){var o=i.jqGrid("getRowData",r[a]);o["\u8bb0\u5f55\u8d1f\u8d23\u4eba"]=n.nickname,i.jqGrid("setRowData",r[a],o)}}),e.select_all&&$("#cb_dataList").trigger("click"),o(),t()}},o=function(){$(".data-permission-features").unbind().click(function(){if([0,3,4].indexOf(org_level)==-1)return void PromptInfo.xcConfirm(org_error_txt,PromptInfo.xcConfirm.typeEnum.info);var t=_getSelectedValues().toString();"marker"==e.type?$("#addMemberToFeature").attr("data-markers",t):"line"==e.type?$("#addMemberToFeature").attr("data-lines",t):"region"==e.type&&$("#addMemberToFeature").attr("data-regions",t),$("#addMemberToFeature").attr("data-layer-type",e.type).attr("layer-id",current_layer_id).modal("show")}),$(".dt-data-list .repeat").unbind().click(function(){return[0,3,4].indexOf(org_level)==-1?void PromptInfo.xcConfirm(org_error_txt,PromptInfo.xcConfirm.typeEnum.info):void PromptInfo.xcConfirm("\u786e\u5b9a\u8981\u6e05\u9664\u9009\u4e2d\u8bb0\u5f55\u7684\u8d1f\u8d23\u4eba\u5417\uff1f",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){var t=_getSelectedValues().toString(),n="",r="",a=e.layer;"marker"==e.type?(n=marker_member_remove_url,r={id:current_layer_id,marker_ids:t,mid:mid}):"line"==e.type?(n=line_member_remove_url,r={id:current_layer_id,line_ids:t,mid:mid}):"region"==e.type&&(n=region_member_remove_url,r={id:current_layer_id,region_ids:t,mid:mid}),MapUtils.ajax2server(n,"DELETE",r,function(){var t,n=_getSelectedValues(),r=_getRole(a),o=a.getType();"marker_layer"==o?t=a.getMarkers():"line_layer"==o?t=a.getLines():"region_layer"==o&&(t=a.getRegions());for(var s=0;s<n.length;s++){var l=n[s],d=t.get(l);delete d.cooperation,BInfowindow.refresh(d),"undefined"==typeof r&&(t.remove(l),e.map.removeOverlay(d),"marker_layer"==o?$("#select_marker_"+d.feature_id).remove():"line_layer"==o?$("#li_line_id_"+d.feature_id).remove():"region_layer"==o&&$("#li_region_id_"+d.feature_id).remove());var h=i.jqGrid("getRowData",l);h["\u8bb0\u5f55\u8d1f\u8d23\u4eba"]="",i.jqGrid("setRowData",l,h)}$("#dataList").removeData().jqGrid("resetSelection"),_updateSelectedRowsCount(),"undefined"==typeof r&&("marker_layer"==o?$("#markerDataList_"+a.id).click():"line_layer"==o?$("#lineDataList_"+a.id).click():"region_layer"==o&&$("#regionDataList_"+a.id).click())})}})}),$("#clearSelectedRows").unbind().click(function(){$("#dataList").removeData().jqGrid("resetSelection"),_updateSelectedRowsCount()}),$("#dataListClose").unbind().click(function(){$(".tooltip").remove(),$(".data-table-edit-panel").remove(),window.filterDatas=null,$(".dt-data-list").remove(),_resetDataList()}),$("#searchDataList").unbind().keyup(function(){n=!0;var t,e,i=[],r=$("#dataList").jqGrid("getGridParam","postData"),a=$("#dataList").jqGrid("getGridParam","colModel"),o=$("#searchDataList").val(),s=a.length;for(t=0;t<s;t++)e=a[t],e.search===!1||void 0!==e.stype&&"text"!==e.stype||i.push({field:e.name,op:"cn",data:o});return r.filters=JSON.stringify({groupOp:"OR",rules:i}),$("#dataList").jqGrid("setGridParam",{search:!0}),$("#dataList").trigger("reloadGrid",[{page:1,current:!0}]),!1}),$("#refreshDataList").unbind().click(function(){$("#searchDataList").val(""),$(".data-refresh").trigger("click")}),$(".data-refresh").unbind().click(function(){$("#dataList").data("selectedRows",[]),$("#refresh_dataList").trigger("click"),$(".add-rule").trigger("click");var t=$("#dataList").jqGrid("getGridParam").data;$("#cb_dataList").prop("checked",!1);for(var e=0;e<t.length;e++)$("#jqg_dataList_"+t[e].id).prop("checked",!1);_updateSelectedRowsCount(),$(".success").removeClass("success"),$("#fbox_dataList_reset").trigger("click")}),$(".data-filter").unbind().click(function(){$("#search_dataList").trigger("click")}),$("#dataStatus").unbind().click(function(){if($("#dataStatus").hasClass("glyphicon-unchecked")){var e=parseInt($(".dt-data-list-title").attr("data-width")),i=parseInt($(".dt-data-list").attr("data-height"));$(".dt-data-list").css("min-width","600px"),$(".dt-data-list").animate({width:e+20},"fast",function(){$(".dt-data-list-title").width(e),$(".dt-data-list").animate({height:i},"fast",function(){$(".data-refresh, .data-search, .data-filter").show()}),$("#dataStatus").removeClass("glyphicon-unchecked").addClass("glyphicon-minus").attr("title","\u6700\u5c0f\u5316"),t()})}else{var e=$(".dt-data-list-title").width();$(".dt-data-list").attr("data-height",$(".dt-data-list").height()),$(".dt-data-list").animate({height:40},"fast",function(){$(".dt-data-list-title").attr("data-width",e).width(248),$(".dt-data-list").css("min-width","0px").animate({width:268},"fast"),$("#dataStatus").removeClass("glyphicon-minus").addClass("glyphicon-unchecked").attr("title","\u6700\u5927\u5316"),$(".data-refresh, .data-search, .data-filter").hide(),t()})}}),$(".close-search-layout").unbind().click(function(){$(".search-data-list-layout").parent().addClass("dt-hidden").animate({width:"24px"},"fast",function(){$(".search-data-list-layout").addClass("dt-mar24l"),$(".data-search").show(),$(".dt-search").removeClass("dt-none"),$(".data-search-control").attr("data-show",!1)})}),$(".data-search-control").unbind().click(function(){"false"==$(".data-search-control").attr("data-show")&&($(".data-search").hide(),$(".dt-search").addClass("dt-none"),$(".search-data-list-layout").removeClass("dt-mar24l"),$(".data-search").parent().removeClass("dt-hidden").animate({width:"208px"},"fast"),$(".data-search-control").attr("data-show",!0))}),$(".append-file").unbind().click(function(){$(document).trigger("dt.append.file",[e.layer.id])}),$(".move-data").unbind().click(function(){var t=_getSelectedValues();t.length<1?PromptInfo.xcConfirm("\u8bf7\u5148\u9009\u62e9\u6570\u636e",PromptInfo.xcConfirm.typeEnum.error):($("#submit_layer").attr("layer-id",e.layer.id).attr("layer-type",e.type+"_layer").attr("row-ids",t),$("#loadLayersModal").modal("show"))}),$(".destroy-data").unbind().click(function(){PromptInfo.xcConfirm("\u786e\u5b9a\u8981\u5220\u9664\u9009\u4e2d\u6570\u636e\u5417?",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){var t=_getSelectedValues(),n={layer_id:e.layer.id,ids:t},r="";"marker"==e.type?r=batch_destroy_marker_url:"line"==e.type?r=batch_destroy_line_url:"region"==e.type&&(r=batch_destroy_region_url),MapUtils.ajax2server(r,"DELETE",n,function(){for(var e=0;e<t.length;e++)i.jqGrid("delRowData",t[e]);0==$("#dataList").find(".ui-row-ltr").length&&$("#dataListClose").trigger("click")})}})}),$(".download-data").click(function(){var t="\u4f60\u786e\u5b9a\u8981\u4e0b\u8f7d\u6b64\u6570\u636e\u5417\uff1f";PromptInfo.xcConfirm(t,PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){var t=_getSelectedValues(),i="";"marker"==e.type?i=download_url:"line"==e.type?i=line_layer_download_url:"region"==e.type&&(i=region_layer_download_url),$.ajax({url:i,data:{mid:mid,id:e.layer.id,ids:t},type:"POST",dataType:"json",cache:!1,success:function(t){$("#operate-status").text("\u6570\u636e\u751f\u6210\u4e2d,\u8bf7\u7a0d\u7b49");var e=setInterval(function(){$("#operate-status").text("\u5df2\u4fdd\u5b58"),clearInterval(e)},1e3);MapUtils.download(t.url)}})}})})};_getDataTitleList=function(t){var i=[];if(i.push("id"),i.push("\u64cd\u4f5c"),"undefined"!=typeof t&&null!=t){var n=t.getAttrFields();if(n)for(var r=0;r<n.length;r++)null!=n[r]&&i.push(n[r].field)}return e.map.has_feature_task&&i.push("\u8bb0\u5f55\u8d1f\u8d23\u4eba"),i},_getRole=function(t){return t.cooperation?PermissionUtils.loginUserRole(user_phone,{mapUsers:e.map.cooperation,layerUsers:t.cooperation}):PermissionUtils.loginUserRole(user_phone,{mapUsers:e.map.cooperation})},_getFieldType=function(t){return"string"==t?t="\u6587\u672c\u7c7b\u578b":"number"==t?t="\u6570\u503c\u7c7b\u578b":"date"==t?t="\u65e5\u671f\u7c7b\u578b":"enum"==t&&(t="\u4e0b\u62c9\u9009\u9879"),t},_addFieldType=function(t,e,i){$("#dataList_"+t).find(".field-type").remove();var n=_getFieldType(e.field_type),r="<p class='field-type text-center dt-f12 coloraa dt-normal' data-field-type='"+e.field_type+"' data-field-id='"+e.id+"'>";r+=i?"<span class='dt-pointer field-type-settings'>"+n+"<span class='caret dt-none'>":"<span class='dt-pointer'>"+n+"<span>",r+="</span></span></p>",$("#dataList_"+t).append(r)},_addDropDownList=function(t){if(null!=t){var e=_getRole(t),i=["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458","\u56fe\u5c42\u6210\u5458"].indexOf(e)>=0,n=t.attr_fields,r=null;t.locate_field&&(r=t.locate_field.split(","));for(var a=null,o=0;o<n.length;o++)if(a=n[o],null!=a){var s=a.field,l=$("#dataList_"+s);l.addClass("dt-pos-r").attr("data-field-id",a.id),i&&l.append("<div class='panel-list dt-drop-list' style='position:absolute;'></div>"),r&&r.indexOf(s)>-1&&l.append("<span title='\u5b9a\u4f4d\u5217' class='glyphicon glyphicon-map-marker dt-pos-col' style='position: absolute;' aria-hidden='true'></span>"),t.uniform_title==s&&l.append("<span title='\u6807\u9898\u5217' class='glyphicon glyphicon-flag dt-title-col' style='position: absolute;' aria-hidden='true'></span>"),_addFieldType(s,a,i)}}},_getDataModelList=function(t){var i=[];if(i.push({name:"id",index:"id",width:"70",hidden:!0}),i.push({name:"\u64cd\u4f5c",index:"\u64cd\u4f5c",width:"60",align:"center",search:!1}),"undefined"!=typeof t&&null!=t){var n=t.getAttrFields();if(n)for(var r=0;r<n.length;r++)if(null!=n[r]){var a="text",o=null,s=null,l=null;"number"==n[r].field_type?(a="float",o=["eq","ne","lt","le","gt","ge","nu","nn"],s={number:!0}):"date"==n[r].field_type?(a="date",o=["eq","ne","lt","le","gt","ge","nu","nn"],s={date:!0},l=function(t){$(t).datepicker({dateFormat:"yy-mm-dd"})}):(a="text",o=["bw","bn","ew","en","cn","nc","nu","nn"]);var d={name:n[r].field,index:n[r].field,width:"168",editable:!1,sortable:!1,sorttype:a,search:!0,searchoptions:{dataInit:l,sopt:o},searchrules:s};i.push(d)}}return e.map.has_feature_task&&i.push({name:"\u8bb0\u5f55\u8d1f\u8d23\u4eba",index:"\u8bb0\u5f55\u8d1f\u8d23\u4eba",width:"140",align:"center",sortable:!1,search:!1,editable:!1}),i},_getDataList=function(t,e){return"marker"==e?_getMarkerDataList(t):"region"==e?_getRegionDataList(t):"line"==e?_getLineDataList(t):void 0},_getMarkerDataList=function(t){for(var i=[],n=t.getMarkers().values(),r=0;r<n.length;r++){var a=n[r],o={},s="glyphicon-eye-close";a.display&&(s="glyphicon-eye-open");var l="<span class='glyphicon "+s+" dt-pointer dt-gray' onclick='_displayRow(this)' title='\u663e\u793a/\u9690\u85cf'></span>&nbsp;&nbsp;";o["\u64cd\u4f5c"]=l,o.id=a.feature_id?a.feature_id:a.id;for(var d=0;d<a.attrs.length;d++){var h=a.attrs[d];if(null!=h&&(o[h.key]=h.value),a.cooperation&&e.map.has_feature_task)for(var c=0;c<a.cooperation.length;c++)o["\u8bb0\u5f55\u8d1f\u8d23\u4eba"]=a.cooperation[c].nickname}i.push(o)}return i},_getRegionDataList=function(t){for(var i=[],n=t.getRegions().values(),r=0;r<n.length;r++){var a=n[r],o={},s="glyphicon-eye-close";a.display&&(s="glyphicon-eye-open");var l="<span class='glyphicon "+s+" dt-pointer dt-gray' onclick='_displayRow(this)' title='\u663e\u793a/\u9690\u85cf'></span>&nbsp;&nbsp;";o["\u64cd\u4f5c"]=l,o.id=a.feature_id?a.feature_id:a.id;for(var d=0;d<a.attrs.length;d++){var h=a.attrs[d];if(null!=h&&(o[h.key]=h.value),a.cooperation&&e.map.has_feature_task)for(var c=0;c<a.cooperation.length;c++)o["\u8bb0\u5f55\u8d1f\u8d23\u4eba"]=a.cooperation[c].nickname}i.push(o)}return i},_getLineDataList=function(t){for(var i=[],n=t.getLines().values(),r=0;r<n.length;r++){var a=n[r],o={},s="glyphicon-eye-close";a.display&&(s="glyphicon-eye-open");var l="<span class='glyphicon "+s+" dt-pointer dt-gray' onclick='_displayRow(this)' title='\u663e\u793a/\u9690\u85cf'></span>&nbsp;&nbsp;";o["\u64cd\u4f5c"]=l,o.id=a.feature_id?a.feature_id:a.id;for(var d=0;d<a.attrs.length;d++){var h=a.attrs[d];if(null!=h&&(o[h.key]=h.value),a.cooperation&&e.map.has_feature_task)for(var c=0;c<a.cooperation.length;c++)o["\u8bb0\u5f55\u8d1f\u8d23\u4eba"]=a.cooperation[c].nickname}i.push(o)}return i},_ajax2server=function(t,e,i,n){$("#operate-status").text("\u6b63\u5728\u4fdd\u5b58..."),$(".map-refresh").addClass("rotate").removeClass("dt-none"),$.ajax({url:t,data:i,type:e,dataType:"json",cache:!1,success:function(t){if(null!=t.status&&403==t.status){var e=t.msg;PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.info)}else $("#operate-status").text("\u5df2\u4fdd\u5b58"),$(".map-refresh").removeClass("rotate").addClass("dt-none"),null!=n&&n(t)},error:function(t){if($("#operate-status").text("\u5df2\u4fdd\u5b58"),$(".map-refresh").removeClass("rotate").addClass("dt-none"),null!=t.responseJSON){var e=t.responseJSON.msg;PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.error)}}})},_addRow=function(){var t={lng:"",lat:"",mid:mid,marker_layer_id:e.layer.id};_ajax2server(add_marker_url,"POST",t,function(t){"\u6dfb\u52a0\u70b9\u6210\u529f"==t.msg&&$("#dataList").jqGrid("addRowData",t.marker.id,{},"first")})},_displayRow=function(t){var i=parseInt($(t).closest("tr").attr("id")),n=!$(t).hasClass("glyphicon-eye-open"),r={id:i,display:n,mid:mid},a="";"marker"==e.type?a=update_display_url:"line"==e.type?a=update_display_line_url:"region"==e.type&&(a=update_display_region_url),_ajax2server(a,"PUT",r,function(){BInfowindow.close();var e=parseInt($(t).closest("tr").attr("id"));n?$("#"+e).find(".glyphicon-eye-close").removeClass("glyphicon-eye-close").addClass("glyphicon-eye-open"):$("#"+e).find(".glyphicon-eye-open").removeClass("glyphicon-eye-open").addClass("glyphicon-eye-close")})},_initDataPanel=function(t,i,n){$(".dt-panel").remove();var r="<div class='text-center dt-pos-a dt-bg-white dt-z10 dt-panel' style='"+t.style+" ;box-shadow: 0 2px 4px rgba(0,0,0,0.2);'>";r+="<div class='dt-hidden' style='border-bottom: 1px solid #eee;'>",r+="<span class='close-btn' onclick='$(\".dt-panel\").remove()'>x</span></div>",r+=_addDataPanel(t,i),r+="</div>",$("#gbox_dataList").append(r),$(".dt-panel").unbind().click(function(t){$(".data-table-edit-panel").remove();var n=$(t.target).attr("data-row-id");if($(t.target).hasClass("del-col")){if($(t.target).hasClass("color66"))return;var r=$(t.target).attr("data-field-id"),a="\u5220\u9664\u8be5\u5217\u6570\u636e\u540e\u5c06\u4e0d\u53ef\u6062\u590d\uff0c\u786e\u5b9a\u5220\u9664\u8be5\u5217\u6570\u636e\uff1f";PromptInfo.xcConfirm(a,PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){var t=null;"marker"==e.type?t=remove_attrs_url:"region"==e.type?t=region_layer_remove_attrs_url:"line"==e.type&&(t=line_layer_remove_attrs_url);var i={id:e.layer.id,col_id:r,mid:mid};_ajax2server(t,"POST",i,function(t){if(null!=t.status&&403==t.status){var i=t.msg;PromptInfo.xcConfirm(i,PromptInfo.xcConfirm.typeEnum.info)}else $("#"+e.type+"DataList_"+e.layer.id).openDataList(e)})}}),$(".xcConfirm .popBox .txtBox p").css("margin-top",0)}else if($(t.target).hasClass("after-col"))_openAddColModal(n,"after"),$("#afterCol").modal("show"),$("#afterInputContent").unbind().click(function(t){_createCol(t,"after")});else if($(t.target).hasClass("before-col"))_openAddColModal(n,"before"),$("#beforeCol").modal("show"),$("#beforeInputContent").click(function(t){_createCol(t,"before")});else if($(t.target).hasClass("set-col-title"))$("#edit_col_title").val(""),null!=current_layer_id&&current_layer_id!=-1&&("marker"==e.type?$("#update_col_attr").attr("marker-layer-id",current_layer_id).attr("data-field",n.substring(9,n.length)).attr("data-type","marker"):"region"==e.type?$("#update_col_attr").attr("region-layer-id",current_layer_id).attr("data-field",n.substring(9,n.length)).attr("data-type","region"):"line"==e.type&&$("#update_col_attr").attr("line-layer-id",current_layer_id).attr("data-field",n.substring(9,n.length)).attr("data-type","line"),$("#editColTitle").modal("show"));else if($(t.target).closest("label").hasClass("unique")){var o="";"marker"==e.type?o=unique_attr_marker_layer_url:"region"==e.type?o=unique_attr_region_layer_url:"line"==e.type&&(o=unique_attr_line_layer_url);var r=$(t.target).closest("label").attr("data-field-id");$(t.target).hasClass("unique")&&($("#is_unique").is(":checked")?$("#is_unique").prop("checked",!1):$("#is_unique").prop("checked",!0));var s=$("#is_unique").is(":checked"),l={id:e.layer.id,col_id:r,mid:mid,is_unique:$("#is_unique").is(":checked")};_ajax2server(o,"POST",l,function(){$("#is_unique").prop("checked",s);for(var t=e.layer.getAttrFields(),n=0;n<t.length;n++){var r=t[n];r.field==i&&(r.is_unique=s)}})}t&&t.preventDefault?t.preventDefault():window.event.returnValue=!1}),null!=n&&n()},_addDataPanel=function(t,i){var n="";n+="<ul id='action_list'>";for(var r=0;r<t.textArray.length;r++){n+="<li class=' dt-w132 dt-h28 dt-line-28h dt-hover-gray dt-pointer' style='border-bottom:1px solid #ccc;'>";var a="";if(a="\u5220\u9664\u5217"!=t.textArray[r]||"undefined"==typeof t.parentId||t.parentId.indexOf("lng")==-1&&t.parentId.indexOf("lat")==-1?"dt-show dt-line-28h dt-sub dt-child black ":"dt-show dt-line-28h dt-sub dt-child color66 ","unique"==t.classArray[r])for(var o=e.layer.getAttrFields(),s=0;s<o.length;s++){var l=o[s];l.field==i&&l.is_unique?n+="<label class='dt-show dt-f12 dt-line-28h dt-sub dt-child black unique dt-pointer' style='font-weight: 100' for='is_unique'  data-field-id='"+t.field_id+"'><input class='dt-mar6r' id='is_unique' type='checkbox' style='margin:1px;vertical-align: text-bottom;' checked/>"+t.textArray[r]+"</label>":l.field!=i||l.is_unique||(n+="<label class='dt-show dt-f12 dt-line-28h dt-sub dt-child black unique dt-pointer' style='font-weight: 100' for='is_unique'  data-field-id='"+t.field_id+"'><input class='dt-mar6r' id='is_unique' type='checkbox' style='margin:1px;vertical-align: text-bottom;' />"+t.textArray[r]+"</label>")}else n+="<span class='"+a+t.classArray[r]+"' data-row-id='"+t.parentId+"' data-field-id='"+t.field_id+"'>"+t.textArray[r]+"</span>";n+="</li>"}return n+="</ul>"},_openAddColModal=function(t,e){var i='<div class="modal fade" id="'+e+'Col" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">';i+='<div class="modal-dialog  modal-sm">',i+='<div class="modal-content">',i+='<div class="modal-header">',i+='<h4 class="modal-title" id="myModalLabel">\u6dfb\u52a0\u5217</h4>',i+="</div>",i+='<div class="modal-body dt-hidden dt-line-64h">',i+='<span class="text-warning" style="margin: 3px;font-size: 10px;">\u540d\u79f0\u4e0d\u80fd\u4e0e\u5176\u4ed6\u5217\u76f8\u540c\uff0c\u4e5f\u4e0d\u80fd\u5305\u542b\u7279\u6b8a\u5b57\u7b26\u3002</span>',i+='<div class="dt-mar10t dt-h34">',i+='<label class="pull-left dt-line-32h dt-mar12r">\u5217\u540d\uff1a</label>',i+='<input id="'+e+'Input" type="text" placeholder="\u8bf7\u8f93\u5165\u5217\u540d" class="form-control dt-w200 pull-left"/>',i+="</div>",i+='<div class="dt-mar10t dt-h34">',i+='<label class="pull-left dt-line-32h dt-mar12r">\u7c7b\u578b\uff1a</label>',i+='<select id="'+e+'Select" class="form-control dt-w200 pull-left">',i+='<option value="string">\u6587\u672c\u7c7b\u578b</option>',i+='<option value="number">\u6570\u503c\u7c7b\u578b</option>',i+='<option value="date">\u65e5\u671f\u7c7b\u578b</option>',i+='<option value="enum">\u4e0b\u62c9\u9009\u9879</option>',i+="</select>",i+="</div>",i+='<div class="after-col-enum-items" style="width:80%;float:right;"></div>',i+='<div class="input-group enum-input dt-none dt-mar8t dt-mar12b" style="width:80%;float:right;">',i+='<span class="glyphicon glyphicon-minus-sign dt-line12h remove-input-enum colorcc dt-pointer"></span>',i+='<input type="text" class="after-enum-text dt-w90per"/>',i+="</div>",i+='<a href="###" class="add-enum-item dt-none" style="margin-left:52px;">',i+='<span class="glyphicon glyphicon-plus-sign"></span>',i+="\u6dfb\u52a0\u5907\u9009\u9879",i+="</a>",i+="</div>",i+='<div class="modal-footer">',i+='<button type="button" class="btn btn-default" data-dismiss="modal">\u53d6\u6d88</button>',i+='<button type="button" class="btn btn-primary" data-id="'+t+'" id="'+e+'InputContent">\u4fdd\u5b58</button>',i+="</div></div></div></div>",$("body").append(i),$("#"+e+"Col").on("hide.bs.modal",function(){$(this).remove()}).modal("show"),$("#afterSelect").unbind().change(function(){"enum"==$(this).val()?($(".add-enum-item").removeClass("dt-none"),_createSelectEnumItems("",".after-enum-text",".after-col-enum-items")):($(".add-enum-item").addClass("dt-none"),$(".after-enum-text").val(""),$(".enum-input").addClass("dt-none"))}),$("#beforeSelect").unbind().change(function(){"enum"==$(this).val()?($(".add-enum-item").removeClass("dt-none"),_createSelectEnumItems("",".after-enum-text",".after-col-enum-items")):($(".add-enum-item").addClass("dt-none"),$(".after-enum-text").val(""),$(".enum-input").addClass("dt-none"))})},_createCol=function(t,i){var n=$("#"+i+"Input").val(),r=MapUtils.check_col_name(n);if(""!=r)return void PromptInfo.xcConfirm(r,PromptInfo.xcConfirm.typeEnum.error);var a=$("#"+i+"Select").val();if($(".enum-input").is(":visible")){var o=_valdateEnumItem($(".after-enum-text").val(),".after-enum-text",".after-col-enum-items");if(!o)return;_addEnumItem($(".after-enum-text").val(),".after-col-enum-items"),$(".after-enum-text").val("").focus()}if(0==$(".after-col-enum-items").children().length&&"enum"==a)return PromptInfo.xcConfirm("\u81f3\u5c11\u8f93\u5165\u4e00\u4e2a\u5907\u9009\u9879\u5728\u8fdb\u884c\u4fdd\u5b58",PromptInfo.xcConfirm.typeEnum.info),!1;if($(".enum-input").addClass("dt-none"),"enum"==a){var s=[];$(".after-col-enum-items .enum-item").each(function(){s.push($(this).text())})}var l=$(t.target).attr("data-id");$("#"+i+"Col").modal("hide");var d="";$(".ui-jqgrid-labels").find("th").each(function(t){$(this).attr("id")==l&&(d="after"==i?t-1:t-2)});var h=d-2,c=null;"marker"==e.type?c=add_attrs_url:"region"==e.type?c=region_layer_add_attrs_url:"line"==e.type&&(c=line_layer_add_attrs_url);var u={id:e.layer.id,col_index:h,col_name:n,col_type:a,mid:mid};"enum"==a&&(u.enum_items=s),$(".after-enum-text").val(""),_ajax2server(c,"POST",u,function(t){if("\u6dfb\u52a0\u5217\u6210\u529f"==t.msg){$("#dataList").jqGrid("addColumn",{cm:{name:n,width:90,index:n,editable:!0},insertWithColumnIndex:d,data:{}}),$("#dataList_"+n).addClass("dt-pos-r").append("<div class='panel-list dt-drop-list' style='position: absolute;'></div>");var e=$(".dt-data-list").width();$(".dt-data-list p").css("width",e),$("#gview_dataList").css("width",e),$("#jqGridPager").css("width",e)}})},_getSelectedValues=function(){var t=$("#dataList").data(),e=[];return t&&$.each(t,function(t,i){i instanceof Array&&$.each(i,function(t,i){"string"==typeof i&&e.push(i)})}),e},_updateSelectedRowsCount=function(){var t=_getSelectedValues().length;$("#selected_rows_count").text(t.toString());var e=$("#dataList").jqGrid("getGridParam","records");t==e&&$("#cb_dataList").prop("checked",!0),t>0?($(".dt-repeat, .dt-permission-features, .cut-data, .dt-download-data, .dt-del-data").removeClass("dt-none"),$(".clear-selected-rows").removeClass("dt-none")):($(".clear-selected-rows").addClass("dt-none"),$(".dt-repeat, .dt-permission-features, .cut-data, .dt-download-data, .dt-del-data").addClass("dt-none"))},_resetDataList=function(){if("marker"==e.type)if(e.map.dt_pc&&e.map.dt_pc[e.layer.id]){var t=e.map.dt_pc[e.layer.id][1];null!=e.map.dt_pc[e.layer.id][0]&&e.map.dt_pc[e.layer.id][0].setPoints(t);for(var i=0;i<t.length;i++)$("#select_marker_"+t[i].id).show()}else for(var n=e.layer.getMarkers().values(),i=0;i<n.length;i++){var r=n[i];r.display&&(r.show(),$("#select_marker_"+r.feature_id).show())}},_saveSelectedRows=function(t,e){var i=$("#dataList"),n=i.data("selectedRows");if("undefined"==typeof n||0==n.length)n=i.getGridParam("selarrrow");else{var r=n.indexOf(t)>=0?n.indexOf(t):-1;$(e).is(":checked")?r==-1&&n.push(t):r>=0&&n.splice(r,1)}i.data("selectedRows",n)},_saveCurrentPageSelectedRows=function(){var t=$("#dataList"),e=t.data("selectedRows");if("undefined"==typeof e||0==e.length||$("#cb_dataList").is(":checked")){if(window.filterDatas)var i=window.filterDatas;else var i=t.getGridParam().data;for(var n=new Array,r=0;r<i.length;r++){var a=i[r];n.push(a.id+"")}t.data("selectedRows",n)}else t.data("selectedRows",[])},_settingSelectedRows=function(){var t=$("#dataList");t.data("selectedRows")},_retrieveCurrentPageSelectedRows=function(){var t=$("#dataList"),e=t.data("selectedRows");if(e){$.each(e,function(e,i){t.setSelection(i,!1)});var i=t.jqGrid("getGridParam","records");e.length==i&&0!=e.length&&$("#cb_dataList").prop("checked",!0)}},_validateFieldNumber=function(t){var e=/^(-?\d+)(\.\d+)?$/,i=t;0==i.length?$(".validate-panel").removeClass("has-success").removeClass("has-error"):e.test(i)?$(".validate-panel").addClass("has-success").removeClass("has-error"):$(".validate-panel").addClass("has-error").removeClass("has-success")},_validateFieldDate=function(t){var e=/^[0-3][0-9]{3}-(0?[1-9]|1[0-2])-(0?[1-9]|[1-2][0-9]|3[0-1])( ([0-1]?[0-9]|2?[0-3])(:([0-5]?[0-9])){2})?$/;0==t.length?$(".validate-date-panel").removeClass("has-success").removeClass("has-error"):e.test(t)?$(".validate-date-panel").addClass("has-success").removeClass("has-error"):$(".validate-date-panel").addClass("has-error").removeClass("has-success")},_submitFieldType=function(t,i,n){$(".col-field-type").remove();var r;if(t){"marker"==e.type?r=change_field_type_marker_layer_url:"region"==e.type?r=change_field_type_region_layer_url:"line"==e.type&&(r=change_field_type_line_layer_url);var a={id:t,field_id:i,field_type:n,mid:mid};if("enum"==n){var o=[];$(".enum-item").each(function(){o.push($(this).text())}),a.enum_items=o}$(".enum-text").val(""),MapUtils.ajax2server(r,"POST",a,function(t){if(t.status&&"403"==t.status){var e=t.msg;PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.info)}})}},_filterData=function(){if(!n&&"marker"==e.type){var t=i.jqGrid("getGridParam").records,r=i.jqGrid("getDataFilterIDs");if(t<i.jqGrid("getGridParam").data.length){if(e.map.dt_pc&&e.map.dt_pc[e.layer.id]){for(var a=e.map.dt_pc[e.layer.id][1],o=[],s=0;s<a.length;s++)r.indexOf(a[s].id)>=0?o.push(a[s]):$("#select_marker_"+a[s].id).hide();null!=e.map.dt_pc[e.layer.id][0]&&e.map.dt_pc[e.layer.id][0].setPoints(o)}else for(var l=e.layer.getMarkers().values(),d=0;d<l.length;d++){var h=l[d];r.indexOf(h.feature_id)==-1&&(h.hide(),$("#select_marker_"+h.feature_id).hide())}"marker"==e.type&&$(".glyphicon-save").closest(".ui-pg-button").show()}}},_showFieldTypePanel=function(t,i,n,r,a){if($(".col-field-type").remove(),$(".dt-panel").remove(),null!=current_layer_id&&current_layer_id!=-1){var o="<div class='dt-pos-a dt-h132 col-field-type dt-bg-white dt-border-cc' layer-id='"+current_layer_id+"' data-field-type='"+i+"' data-field-id='"+t+"' data-type='"+e.type+"'  style='top:44px;left:"+(r.left-102)+"px'>";o+="<div class='dt-hidden' style='border-bottom:1px solid #eee;'>",o+="<span class='close-field-btn'>x</span>",o+="</div>",o+="<ul id='field_list' class='text-center'>","string"==i?(o+="<li class='dt-w132 dt-pos-r field-type-setting dt-h28  dt-line-28h dt-hover-gray dt-pointer' style='border-bottom:1px solid #ccc;'>",o+="<span class='glyphicon glyphicon-ok dt-pos-a dt-green'></span>"):o+="<li class='dt-w132 dt-pos-r field-type-setting dt-h28 dt-line-28h dt-hover-gray dt-pointer' style='border-bottom:1px solid #ccc;'>",o+="<span class='dt-show dt-line-28h dt-sub dt-child black before-col' data-field-type='string'>\u6587\u672c\u7c7b\u578b</span>",o+="</li>","number"==i?(o+="<li class='dt-w132 dt-pos-r field-type-setting dt-h28 dt-line-28h dt-hover-gray dt-pointer' style='border-bottom:1px solid #ccc;'>",o+="<span class='glyphicon glyphicon-ok dt-pos-a dt-green'></span>"):o+="<li class='dt-w132 dt-pos-r field-type-setting dt-h28 dt-line-28h dt-hover-gray dt-pointer' style='border-bottom:1px solid #ccc;'>",o+="<span class='dt-show dt-line-28h dt-sub dt-child black before-col' data-field-type='number'>\u6570\u503c\u7c7b\u578b</span>",o+="</li>","date"==i?(o+="<li class='dt-w132 dt-pos-r field-type-setting dt-h28 dt-line-28h dt-hover-gray dt-pointer' style='border-bottom:1px solid #ccc;'>",o+="<span class='glyphicon glyphicon-ok dt-pos-a dt-green'></span>"):o+="number"==i?"<li class='dt-w132 dt-pos-r disabled field-type-setting dt-h28 dt-line-28h dt-hover-gray dt-pointer' style='border-bottom:1px solid #ccc;'>":"<li class='dt-w132 dt-pos-r field-type-setting dt-h28 dt-line-28h dt-hover-gray dt-pointer' style='border-bottom:1px solid #ccc;'>",o+="<span class='dt-show dt-line-28h dt-sub dt-child black before-col' data-field-type='date'>\u65e5\u671f\u7c7b\u578b</span>","enum"==i?(o+="<li class='dt-w132 dt-pos-r field-type-setting dt-h28 dt-line-28h dt-hover-gray dt-pointer'>",o+="<span class='glyphicon glyphicon-ok dt-pos-a dt-green'></span>"):o+="<li class='dt-w132 dt-pos-r field-type-setting dt-h28 dt-line-28h dt-hover-gray dt-pointer'>",o+="<span class='dt-show dt-line-28h dt-sub dt-child black before-col' data-field-type='enum'>\u4e0b\u62c9\u9009\u9879</span>",o+="</li>",o+="</ul>",o+="</div>",$("#jqGridPager").after(o),$(".close-field-btn").unbind().click(function(){$(".col-field-type").remove()}),$(".field-type-setting").unbind().click(function(e){if(!$(e.target).closest("li").hasClass("disabled")){var i=$(e.target).closest("li").find(".before-col").attr("data-field-type"),n=$(e.target).closest("li").find("span").text();if("string"!=i&&"enum"!=i){var r="\u66f4\u6539\u4e3a"+n+"\uff0c\u975e"+n+"\u5185\u5bb9\u5c06\u4f1a\u88ab\u6c38\u4e45\u6e05\u9664\uff01\u786e\u5b9a\u66f4\u6539\u5b57\u6bb5\u7c7b\u578b\uff1f";PromptInfo.xcConfirm(r,PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){_submitFieldType(current_layer_id,t,i)}}),$(".popBox p ").css("margin-top","0"),$(".xcConfirm .sgBtn").removeClass("ok").addClass("cancel")}else"enum"==i?($(".add-enum-item").removeClass("dt-none"),$("#addEnum").modal("show"),_createSelectEnumItems(a,".enum-text",".enum-items"),$("#submit_add_enum").unbind().click(function(){var r=_valdateEnumItem($(".enum-text").val(),".enum-text",".enum-items");if($(".enum-input").is(":visible")){if(!r)return;_addEnumItem($(".enum-text").val(),".enum-items"),$(".enum-text").val("").focus()}if(0==$(".enum-items").children().length)return PromptInfo.xcConfirm("\u81f3\u5c11\u8f93\u5165\u4e00\u4e2a\u5907\u9009\u9879\u5728\u8fdb\u884c\u4fdd\u5b58",PromptInfo.xcConfirm.typeEnum.info),!1;$(".enum-input").addClass("dt-none");var a=$(e.target).closest("ul").find(".glyphicon-ok").parent().text();if("\u4e0b\u62c9\u9009\u9879"!=a){var o="\u66f4\u6539\u4e3a"+n+"\uff0c\u975e"+n+"\u5185\u5bb9\u5c06\u4f1a\u88ab\u6c38\u4e45\u6e05\u9664\uff01\u786e\u5b9a\u66f4\u6539\u5b57\u6bb5\u7c7b\u578b\uff1f";
PromptInfo.xcConfirm(o,PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){_submitFieldType(current_layer_id,t,i)}}),$(".popBox p ").css("margin-top","0"),$(".xcConfirm .sgBtn").removeClass("ok").addClass("cancel")}else _submitFieldType(current_layer_id,t,i);$("#addEnum").modal("hide"),$(".add-enum-item").addClass("dt-none")})):_submitFieldType(current_layer_id,t,i)}})}},_createSelectEnumItems=function(t,i,n){var r=e.layer.getAttrFields();$(n).empty();for(var a=0;a<r.length;a++){var o=r[a];if("enum"==o.field_type&&o.field==t)for(var s=o.enum_items,l=0;l<s.length;l++)_addEnumItem(s[l],n)}$(".add-enum-item").unbind().click(function(){if($(".enum-input").hasClass("dt-none"))$(".enum-input").removeClass("dt-none"),$(i).focus();else{var t=$(i).val(),e=_valdateEnumItem(t,i,n);if(!e)return void $(i).val("").focus();_addEnumItem(t,n),$(i).val("").focus()}_removeSelectEnum(),$(i).unbind().keyup(function(t){if(13==t.keyCode){var e=$(i).val(),r=_valdateEnumItem(e,i,n);if(!r)return void $(i).val("").focus();_addEnumItem(e,n),$(i).val("").focus()}})})},_removeSelectEnum=function(){$(".remove-input-enum").unbind().click(function(){$(".enum-input").addClass("dt-none"),$(".enum-text,.after-enum-text").val("")})},_valdateEnumItem=function(t,e,i){if(0==t.length)$(".enum-input").addClass("dt-none"),$(e).val("");else if(t.trim().length<2||t.trim().length>16)return PromptInfo.xcConfirm("\u5907\u9009\u9879\u5185\u5bb9\u4e3a2~16\u4e2a\u5b57\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165...",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){$(e).focus()}}),!1;var n=!0;return $(i+" .enum-item").each(function(){if($(this).text()==t)return void(n=!1)}),!!n||(PromptInfo.xcConfirm("\u5907\u9009\u9879\u540d\u79f0\u4e0d\u80fd\u91cd\u590d\uff0c\u8bf7\u91cd\u65b0\u6dfb\u52a0...",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){$(e).focus()}}),!1)},_addEnumItem=function(t,e){if(0!=t.trim().length){var i="<p class='enum-item dt-mar4t'>";i+="<span class='glyphicon glyphicon-minus-sign remove-enum-item dt-pointer color77 dt-mar4r'></span>",i+=t.trim(),i+="</p>",$(e).append(i),$(".remove-enum-item").unbind().click(function(t){$(t.target).closest("p").remove()})}},_showEditPanel=function(t,i,n,r,a,o){$(".data-table-edit-panel").remove();var s="";if(s+="<div class='data-table-edit-panel' style='left:"+o.left+"px;top:"+o.top+"px'>","date"==r)s+="<div class='dt-h34 dt-mar12b' style='width:244px;'>",s+="<div class='validate-date-panel'>",s+="<div class='input-group'  id='dateTimePicker'>",s+="<input class='form-control' type='text'/>",s+="<span class='input-group-addon'>",s+="<span class='glyphicon glyphicon-calendar dt-pointer'></span>",s+="</span>",s+="</div>",s+="</div>",s+="</div>";else if("enum"==r){var l=e.layer.getAttrFields();s+="<select class='form-control select-enum-items' style='min-width:180px;'>";for(var d=0;d<l.length;d++){var h=l[d];if(h.id==n)for(var c=h.enum_items,u=0;u<c.length;u++){var p=c[u];s+=p==a?"<option val='"+p+"' selected>"+p+"</option>":"<option val='"+p+"'>"+p+"</option>"}}s+="</select>"}else s+="<div class='validate-panel'>",s+="<textarea class='form-control field-textarea'></textarea>",s+="</div>";s+="<div class='dt-mar8t'>",s+="<a href='###' class='pull-left btn btn-default close-field-edit dt-w72 btn-xs'>\u53d6\u6d88</a>",s+="<a href='###' class='pull-right btn btn-primary field-btn dt-w72 btn-xs'>\u786e\u8ba4</a>",s+="</div>",s+="</div>",s+="</div>",$("body").append(s),"date"==r?(a=moment(a,"YYYY-MM-DD HH:mm:ss"),a.isValid()||(a=null),$("#dateTimePicker").datetimepicker({format:"YYYY-MM-DD HH:mm:ss",defaultDate:a,tooltips:MapUtils.getDateTimePickerTooltip()}),$(".data-table-edit-panel input").blur(function(){setTimeout(function(){var t=$("#dateTimePicker input").val();t&&0!=t.length||(t=""),_validateFieldDate(t)},10)})):($(".field-textarea").text(a),setTimeout(function(){$(".data-table-edit-panel .field-textarea").focus()},10),$(".data-table-edit-panel textarea").blur(function(){"number"==r&&_validateFieldNumber($(this).val())})),$(".close-field-edit").unbind().click(function(){$(".data-table-edit-panel").remove()}),$(".field-btn").unbind().click(function(){if($(".data-table-edit-panel").find(".has-error").length>0){var o="\u8f93\u5165\u5185\u5bb9\u4e0d\u662f\u6570\u503c\u7c7b\u578b,\u8bf7\u91cd\u65b0\u8f93\u5165";return"date"==r&&(o="\u8f93\u5165\u5185\u5bb9\u4e0d\u662f\u65e5\u671f\u7c7b\u578b,\u8bf7\u91cd\u65b0\u8f93\u5165"),void PromptInfo.xcConfirm(o,PromptInfo.xcConfirm.typeEnum.error)}var s="";if(s="date"==r?$("#dateTimePicker input").val():"enum"==r?$(".select-enum-items option:selected").val():$(".field-textarea").val(),s!=a){var l=null;"marker"==e.type?l=e.layer.getMarker(t):"region"==e.type?l=e.layer.getRegion(t):"line"==e.type&&(l=e.layer.getLine(t)),l&&_updateOverlayAttr(l,n,s,i)}$(".close-field-edit").trigger("click")})},_updateOverlayAttr=function(t,e,i,n){var r,a;a=t.type,"marker"==a?r=update_marker_attrs_url:"region"==a?r=update_region_attrs_url:"line"==a&&(r=update_line_attrs_url);var o=t.feature_id+"_"+e,s={};s[o]=i,MapUtils.ajax2server(r,"put",{attrs:s,id:t.feature_id,mid:mid},function(){$("#"+t.feature_id).children().eq(n).text(i).attr("title",i)},function(){})}}),function(t){t.fn.dragsort=function(e){if("destroy"==e)return void t(this.selector).trigger("dragsort-uninit");var i=t.extend({},t.fn.dragsort.defaults,e),n=[],r=null,a=null;return this.each(function(e,o){t(o).is("table")&&1==t(o).children().size()&&t(o).children().is("tbody")&&(o=t(o).children().get(0));var s={draggedItem:null,placeHolderItem:null,pos:null,offset:null,offsetLimit:null,scroll:null,container:o,init:function(){i.tagName=0==t(this.container).children().size()?"li":t(this.container).children().get(0).tagName.toLowerCase(),""==i.itemSelector&&(i.itemSelector=i.tagName),""==i.dragSelector&&(i.dragSelector=i.tagName),""==i.placeHolderTemplate&&(i.placeHolderTemplate="<"+i.tagName+">&nbsp;</"+i.tagName+">"),t(this.container).attr("data-listidx",e).mousedown(this.grabItem).bind("dragsort-uninit",this.uninit),this.styleDragHandlers(!0)},uninit:function(){var e=n[t(this).attr("data-listidx")];t(e.container).unbind("mousedown",e.grabItem).unbind("dragsort-uninit"),e.styleDragHandlers(!1)},getItems:function(){return t(this.container).children(i.itemSelector)},styleDragHandlers:function(e){this.getItems().map(function(){return t(this).is(i.dragSelector)?this:t(this).find(i.dragSelector).get()}).css("cursor",e?"pointer":"")},grabItem:function(e){var r=n[t(this).attr("data-listidx")],a=t(e.target).closest("[data-listidx] > "+i.tagName).get(0),o=r.getItems().filter(function(){return this==a}).size()>0;if(!(1!=e.which||t(e.target).is(i.dragSelectorExclude)||t(e.target).closest(i.dragSelectorExclude).size()>0)&&o){e.preventDefault();for(var s=e.target;!t(s).is(i.dragSelector);){if(s==this)return;s=s.parentNode}t(s).attr("data-cursor",t(s).css("cursor")),t(s).css("cursor","move");var l=this,d=function(){r.dragStart.call(l,e),t(r.container).unbind("mousemove",d)};t(r.container).mousemove(d).mouseup(function(){t(r.container).unbind("mousemove",d),t(s).css("cursor",t(s).attr("data-cursor"))})}},dragStart:function(e){null!=r&&null!=r.draggedItem&&r.dropItem(),r=n[t(this).attr("data-listidx")],r.draggedItem=t(e.target).closest("[data-listidx] > "+i.tagName),r.draggedItem.attr("data-origpos",t(this).attr("data-listidx")+"-"+t(r.container).children().index(r.draggedItem));var a=parseInt(r.draggedItem.css("marginTop")),o=parseInt(r.draggedItem.css("marginLeft"));if(r.offset=r.draggedItem.offset(),r.offset.top=e.pageY-r.offset.top+(isNaN(a)?0:a)-1,r.offset.left=e.pageX-r.offset.left+(isNaN(o)?0:o)-1,!i.dragBetween){var s=0==t(r.container).outerHeight()?Math.max(1,Math.round(.5+r.getItems().size()*r.draggedItem.outerWidth()/t(r.container).outerWidth()))*r.draggedItem.outerHeight():t(r.container).outerHeight();r.offsetLimit=t(r.container).offset(),r.offsetLimit.right=r.offsetLimit.left+t(r.container).outerWidth()-r.draggedItem.outerWidth(),r.offsetLimit.bottom=r.offsetLimit.top+s-r.draggedItem.outerHeight()}var l=r.draggedItem.height(),d=r.draggedItem.width();if("tr"==i.tagName?(r.draggedItem.children().each(function(){t(this).width(t(this).width())}),r.placeHolderItem=r.draggedItem.clone().attr("data-placeholder",!0),r.draggedItem.after(r.placeHolderItem),r.placeHolderItem.children().each(function(){t(this).css({borderWidth:0,width:t(this).width()+1,height:t(this).height()+1}).html("&nbsp;")})):(r.draggedItem.after(i.placeHolderTemplate),r.placeHolderItem=r.draggedItem.next().css({height:l,width:d}).attr("data-placeholder",!0)),"td"==i.tagName){var h=r.draggedItem.closest("table").get(0);t("<table id='"+h.id+"' style='border-width: 0px;' class='dragSortItem "+h.className+"'><tr></tr></table>").appendTo("body").children().append(r.draggedItem)}var c=r.draggedItem.attr("style");r.draggedItem.attr("data-origstyle",c?c:""),r.draggedItem.css({position:"absolute",opacity:.8,"z-index":999,height:l,width:d}),r.scroll={moveX:0,moveY:0,maxX:t(document).width()-t(window).width(),maxY:t(document).height()-t(window).height()},r.scroll.scrollY=window.setInterval(function(){if(i.scrollContainer!=window)return void t(i.scrollContainer).scrollTop(t(i.scrollContainer).scrollTop()+r.scroll.moveY);var e=t(i.scrollContainer).scrollTop();(r.scroll.moveY>0&&e<r.scroll.maxY||r.scroll.moveY<0&&e>0)&&(t(i.scrollContainer).scrollTop(e+r.scroll.moveY),r.draggedItem.css("top",r.draggedItem.offset().top+r.scroll.moveY+1))},10),r.scroll.scrollX=window.setInterval(function(){if(i.scrollContainer!=window)return void t(i.scrollContainer).scrollLeft(t(i.scrollContainer).scrollLeft()+r.scroll.moveX);var e=t(i.scrollContainer).scrollLeft();(r.scroll.moveX>0&&e<r.scroll.maxX||r.scroll.moveX<0&&e>0)&&(t(i.scrollContainer).scrollLeft(e+r.scroll.moveX),r.draggedItem.css("left",r.draggedItem.offset().left+r.scroll.moveX+1))},10),t(n).each(function(t,e){e.createDropTargets(),e.buildPositionTable()}),r.setPos(e.pageX,e.pageY),t(document).bind("mousemove",r.swapItems),t(document).bind("mouseup",r.dropItem),i.scrollContainer!=window&&t(window).bind("wheel",r.wheel)},setPos:function(e,n){var a=n-this.offset.top,o=e-this.offset.left;i.dragBetween||(a=Math.min(this.offsetLimit.bottom,Math.max(a,this.offsetLimit.top)),o=Math.min(this.offsetLimit.right,Math.max(o,this.offsetLimit.left)));var s=this.draggedItem.offsetParent().not("body").offset();if(null!=s&&(a-=s.top,o-=s.left),i.scrollContainer==window)n-=t(window).scrollTop(),e-=t(window).scrollLeft(),n=Math.max(0,n-t(window).height()+5)+Math.min(0,n-5),e=Math.max(0,e-t(window).width()+5)+Math.min(0,e-5);else{var l=t(i.scrollContainer),d=l.offset();n=Math.max(0,n-l.height()-d.top)+Math.min(0,n-d.top),e=Math.max(0,e-l.width()-d.left)+Math.min(0,e-d.left)}r.scroll.moveX=0==e?0:e*i.scrollSpeed/Math.abs(e),r.scroll.moveY=0==n?0:n*i.scrollSpeed/Math.abs(n),this.draggedItem.css({top:a,left:o})},wheel:function(e){if(r&&i.scrollContainer!=window){var n=t(i.scrollContainer),a=n.offset();if(e=e.originalEvent,e.clientX>a.left&&e.clientX<a.left+n.width()&&e.clientY>a.top&&e.clientY<a.top+n.height()){var o=(0==e.deltaMode?1:10)*e.deltaY;n.scrollTop(n.scrollTop()+o),e.preventDefault()}}},buildPositionTable:function(){var e=[];this.getItems().not([r.draggedItem[0],r.placeHolderItem[0]]).each(function(i){var n=t(this).offset();n.right=n.left+t(this).outerWidth(),n.bottom=n.top+t(this).outerHeight(),n.elm=this,e[i]=n}),this.pos=e},dropItem:function(){if(null!=r.draggedItem){var e=r.draggedItem.attr("data-origstyle");if(r.draggedItem.attr("style",e),""==e&&r.draggedItem.removeAttr("style"),r.draggedItem.removeAttr("data-origstyle"),r.styleDragHandlers(!0),r.placeHolderItem.before(r.draggedItem),r.placeHolderItem.remove(),t("[data-droptarget], .dragSortItem").remove(),window.clearInterval(r.scroll.scrollY),window.clearInterval(r.scroll.scrollX),r.draggedItem.attr("data-origpos")!=t(n).index(r)+"-"+t(r.container).children().index(r.draggedItem)&&0==i.dragEnd.apply(r.draggedItem)){var a=r.draggedItem.attr("data-origpos").split("-"),o=t(n[a[0]].container).children().not(r.draggedItem).eq(a[1]);o.size()>0?o.before(r.draggedItem):0==a[1]?t(n[a[0]].container).prepend(r.draggedItem):t(n[a[0]].container).append(r.draggedItem)}return r.draggedItem.removeAttr("data-origpos"),r.draggedItem=null,t(document).unbind("mousemove",r.swapItems),t(document).unbind("mouseup",r.dropItem),i.scrollContainer!=window&&t(window).unbind("wheel",r.wheel),!1}},swapItems:function(e){if(null==r.draggedItem)return!1;r.setPos(e.pageX,e.pageY);for(var o=r.findPos(e.pageX,e.pageY),s=r,l=0;o==-1&&i.dragBetween&&l<n.length;l++)o=n[l].findPos(e.pageX,e.pageY),s=n[l];if(o==-1)return!1;var d=function(){return t(s.container).children().not(s.draggedItem)},h=d().not(i.itemSelector).each(function(){this.idx=d().index(this)});return null==a||a.top>r.draggedItem.offset().top||a.left>r.draggedItem.offset().left?t(s.pos[o].elm).before(r.placeHolderItem):t(s.pos[o].elm).after(r.placeHolderItem),h.each(function(){var e=d().eq(this.idx).get(0);this!=e&&d().index(this)<this.idx?t(this).insertAfter(e):this!=e&&t(this).insertBefore(e)}),t(n).each(function(t,e){e.createDropTargets(),e.buildPositionTable()}),a=r.draggedItem.offset(),!1},findPos:function(t,e){for(var i=0;i<this.pos.length;i++)if(this.pos[i].left<t&&this.pos[i].right>t&&this.pos[i].top<e&&this.pos[i].bottom>e)return i;return-1},createDropTargets:function(){i.dragBetween&&t(n).each(function(){var e=t(this.container).find("[data-placeholder]"),n=t(this.container).find("[data-droptarget]");e.size()>0&&n.size()>0?n.remove():0==e.size()&&0==n.size()&&("td"==i.tagName?t(i.placeHolderTemplate).attr("data-droptarget",!0).appendTo(this.container):t(this.container).append(r.placeHolderItem.removeAttr("data-placeholder").clone().attr("data-droptarget",!0)),r.placeHolderItem.attr("data-placeholder",!0))})}};s.init(),n.push(s)}),this},t.fn.dragsort.defaults={itemSelector:"",dragSelector:"",dragSelectorExclude:"input, textarea",dragEnd:function(){},dragBetween:!1,placeHolderTemplate:"",scrollContainer:window,scrollSpeed:5}}(jQuery),function(t){function e(t,e){var i=t.data("ddslick"),a=t.find(".dd-selected"),o=a.siblings(".dd-selected-value"),s=(t.find(".dd-options"),a.siblings(".dd-pointer"),t.find(".dd-option").eq(e)),l=s.closest("li"),d=i.settings,h=i.settings.data[e];t.find(".dd-option").removeClass("dd-option-selected"),s.addClass("dd-option-selected"),i.selectedIndex=e,i.selectedItem=l,i.selectedData=h,d.showSelectedHTML?a.html((h.imageSrc?'<img class="dd-selected-image'+("right"==d.imagePosition?" dd-image-right":"")+'" src="'+h.imageSrc+'" />':"")+(h.text?'<label class="dd-selected-text">'+h.text+"</label>":"")+(h.description?'<small class="dd-selected-description dd-desc'+(d.truncateDescription?" dd-selected-description-truncated":"")+'" >'+h.description+"</small>":"")):a.html(h.text),o.val(h.value),i.original.val(h.value),t.data("ddslick",i),n(t),r(t),"function"==typeof d.onSelected&&d.onSelected.call(this,i)}function i(e){var i=e.find(".dd-select"),n=i.siblings(".dd-options"),r=i.find(".dd-pointer"),o=n.is(":visible");t(".dd-click-off-close").not(n).slideUp(50),t(".dd-pointer").removeClass("dd-pointer-up"),o?(n.slideUp("fast"),r.removeClass("dd-pointer-up")):(n.slideDown("fast"),r.addClass("dd-pointer-up")),a(e)}function n(t){t.find(".dd-options").slideUp(50),t.find(".dd-pointer").removeClass("dd-pointer-up").removeClass("dd-pointer-up")}function r(t){var e=t.find(".dd-select").css("height"),i=t.find(".dd-selected-description"),n=t.find(".dd-selected-image");i.length<=0&&n.length>0&&t.find(".dd-selected-text").css("lineHeight",e)}function a(e){e.find(".dd-option").each(function(){var i=t(this),n=i.css("height"),r=i.find(".dd-option-description"),a=e.find(".dd-option-image");r.length<=0&&a.length>0&&i.find(".dd-option-text").css("lineHeight",n)})}t.fn.ddslick=function(e){return o[e]?o[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exists."):o.init.apply(this,arguments)};var o={},s={data:[],keepJSONItemsOnTop:!1,width:260,height:null,background:"#eee",selectText:"",defaultSelectedIndex:null,truncateDescription:!0,imagePosition:"left",showSelectedHTML:!0,clickOffToClose:!0,embedCSS:!0,onSelected:function(){}},l='<div class="dd-select"><input class="dd-selected-value" type="hidden" /><a class="dd-selected"></a><span class="dd-pointer dd-pointer-down"></span></div>',d='<ul class="dd-options"></ul>',h='<style id="css-ddslick" type="text/css">.dd-select{ border-radius:2px; border:solid 1px #ccc; position:relative; cursor:pointer;}.dd-desc { color:#aaa; display:block; overflow: hidden; font-weight:normal; line-height: 1.4em; }.dd-selected{ overflow:hidden; display:block; padding:10px; font-weight:bold;}.dd-pointer{ width:0; height:0; position:absolute; right:10px; top:50%; margin-top:-3px;}.dd-pointer-down{ border:solid 5px transparent; border-top:solid 5px #000; }.dd-pointer-up{border:solid 5px transparent !important; border-bottom:solid 5px #000 !important; margin-top:-8px;}.dd-options{ border:solid 1px #ccc; border-top:none; list-style:none; box-shadow:0px 1px 5px #ddd; display:none; position:absolute; z-index:2000; margin:0; padding:0;background:#fff; overflow:auto;}.dd-option{ padding:10px; display:block; border-bottom:solid 1px #ddd; overflow:hidden; text-decoration:none; color:#333; cursor:pointer;-webkit-transition: all 0.25s ease-in-out; -moz-transition: all 0.25s ease-in-out;-o-transition: all 0.25s ease-in-out;-ms-transition: all 0.25s ease-in-out; }.dd-options > li:last-child > .dd-option{ border-bottom:none;}.dd-option:hover{ background:#f3f3f3; color:#000;}.dd-selected-description-truncated { text-overflow: ellipsis; white-space:nowrap; }.dd-option-selected { background:#f6f6f6; }.dd-option-image, .dd-selected-image { vertical-align:middle; float:left; margin-right:5px; max-width:64px;}.dd-image-right { float:right; margin-right:15px; margin-left:5px;}.dd-container{ position:relative;}\u200b .dd-selected-text { font-weight:bold}\u200b</style>';o.init=function(n){var n=t.extend({},s,n);return t("#css-ddslick").length<=0&&n.embedCSS&&t(h).appendTo("head"),this.each(function(){var r=t(this),a=r.data("ddslick");if(!a){var o=[];n.data;r.find("option").each(function(){var e=t(this),i=e.data();o.push({text:t.trim(e.text()),value:e.val(),selected:e.is(":selected"),description:i.description,imageSrc:i.imagesrc})}),n.keepJSONItemsOnTop?t.merge(n.data,o):n.data=t.merge(o,n.data);var s=r,h=t('<div id="'+r.attr("id")+'"></div>');r.replaceWith(h),r=h,r.addClass("dd-container").append(l).append(d);var o=r.find(".dd-select"),c=r.find(".dd-options");c.css({width:n.width}),o.css({width:n.width,background:n.background}),r.css({width:n.width}),null!=n.height&&c.css({height:n.height,overflow:"auto"}),t.each(n.data,function(t,e){e.selected&&(n.defaultSelectedIndex=t),c.append('<li><a class="dd-option">'+(e.value?' <input class="dd-option-value" type="hidden" value="'+e.value+'" />':"")+(e.imageSrc?' <img class="dd-option-image'+("right"==n.imagePosition?" dd-image-right":"")+'" src="'+e.imageSrc+'" />':"")+(e.text?' <label class="dd-option-text">'+e.text+"</label>":"")+(e.description?' <small class="dd-option-description dd-desc">'+e.description+"</small>":"")+"</a></li>")});var u={settings:n,original:s,selectedIndex:-1,selectedItem:null,selectedData:null};if(r.data("ddslick",u),n.selectText.length>0&&null==n.defaultSelectedIndex)r.find(".dd-selected").html(n.selectText);else{var p=null!=n.defaultSelectedIndex&&n.defaultSelectedIndex>=0&&n.defaultSelectedIndex<n.data.length?n.defaultSelectedIndex:0;e(r,p)}r.find(".dd-select").on("click.ddslick",function(){i(r)}),r.find(".dd-option").on("click.ddslick",function(){e(r,t(this).closest("li").index())}),n.clickOffToClose&&(c.addClass("dd-click-off-close"),r.on("click.ddslick",function(t){t.stopPropagation()}),t("body").on("click",function(){t(".dd-click-off-close").slideUp(50).siblings(".dd-select").find(".dd-pointer").removeClass("dd-pointer-up")}))}})},o.select=function(i){return this.each(function(){void 0!==i.index&&e(t(this),i.index)})},o.open=function(){return this.each(function(){var e=t(this),n=e.data("ddslick");n&&i(e)})},o.close=function(){return this.each(function(){var e=t(this),i=e.data("ddslick");i&&n(e)})},o.destroy=function(){return this.each(function(){var e=t(this),i=e.data("ddslick");if(i){var n=i.original;e.removeData("ddslick").unbind(".ddslick").replaceWith(n)}})}}(jQuery);var ToolBar=window.ToolBar=ToolBar||{};$(function(){function t(){var t={},e=PermissionUtils.loginUserRole(user_phone,{mapUsers:ToolBar._map.cooperation});if("\u5730\u56fe\u7ba1\u7406\u5458"==e){var i=$(".map-log").length>0&&!$(".map-log").find(".tool-bar-active").hasClass("dt-none");i?ToolBar.addPlugIn("log","glyphicon-align-justify","plug-list","\u65e5\u5fd7",!1):ToolBar.removePlugIn("log"),t.map_log=i;var n=$(".data-download").length>0&&!$(".data-download").find(".tool-bar-active").hasClass("dt-none");n?ToolBar.addPlugIn("dt-data-download","glyphicon-cloud-download","plug-list","\u4e0b\u8f7d",!1):ToolBar.removePlugIn("dt-data-download"),t.download=n;var r=$(".marker-selector").length>0&&!$(".marker-selector").find(".tool-bar-active").hasClass("dt-none");r?ToolBar.addPlugIn("dt-marker-selector","glyphicon-tags","plug-list","\u6807\u6ce8",!1):ToolBar.removePlugIn("dt-marker-selector"),t.marker_selector=r;var a=$(".member-location").length>0&&!$(".member-location").find(".tool-bar-active").hasClass("dt-none");a?ToolBar.addPlugIn("dt-member-location","iconfont","plug-list","\u5b9a\u4f4d",!1):(LocationUtils.close(),ToolBar.removePlugIn("dt-member-location")),t.location=a}var o=$(".fendan-plug").length>0&&!$(".fendan-plug").find(".tool-bar-active").hasClass("dt-none");o?ToolBar.addPlugIn("fendan","fendan-icon dt-show hy-icons","plug-list","\u5206\u5355",!1):(ToolBar.removePlugIn("fendan"),ToolBar.switchLeftBar("default")),t.fendan=o;var s=$(".direction").length>0&&!$(".direction").find(".tool-bar-active").hasClass("dt-none");s?ToolBar.addPlugIn("dt-direction","glyphicon-road","plug-list","\u8def\u5f84",!1):ToolBar.removePlugIn("dt-direction"),t.direction=s;var l=$(".marker-reply-selector").length>0&&!$(".marker-reply-selector").find(".tool-bar-active").hasClass("dt-none");l?ToolBar.addPlugIn("marker-reply","glyphicon-comment","plug-list","\u52a8\u6001",!1):(ReplyPlugin.destroy(),ToolBar.removePlugIn("marker-reply")),ToolBar._map.has_marker_reply=l,t.reply=l;var d=$(".marker-task-selector").length>0&&!$(".marker-task-selector").find(".tool-bar-active").hasClass("dt-none");d?ToolBar.addPlugIn("dt-task","iconfont","plug-list","\u4efb\u52a1",!1):ToolBar.removePlugIn("dt-task"),ToolBar._map.has_feature_task=d,t.task=d;var h=$(".monitor-warning").length>0&&!$(".monitor-warning").find(".tool-bar-active").hasClass("dt-none");h?ToolBar.addPlugIn("dt-monitor-warning","glyphicon-warning-sign","plug-list","\u9884\u8b66",!1):(ToolBar.removePlugIn("dt-monitor-warning"),MonitorUtils.closeMonitorPlug()),t.message_audio=h;var c=$(".region-statistics").length>0&&!$(".region-statistics").find(".tool-bar-active").hasClass("dt-none");c?ToolBar.addPlugIn("map-total-plug","glyphicon-stats","plug-list","\u5206\u6790",!1):ToolBar.removePlugIn("map-total-plug"),t.region_statistics=c;var u=$(".filter-plug").length>0&&!$(".filter-plug").find(".tool-bar-active").hasClass("dt-none");u?ToolBar.addPlugIn("dt-filter-plug","iconfont","plug-list","\u7b5b\u9009",!1):ToolBar.removePlugIn("dt-filter-plug"),t.filter=u,MapUtils.ajax2server(update_settings_url,"POST",{mid:mid,settings:t},function(){has_message_audio=!!h})}ToolBar.tools=new DT.HashMap,ToolBar.tools.put("map-layers",{name:"map-layers",panel:"#featureListPanel"}),ToolBar.tools.put("map-cooperate",{name:"map-layers",panel:"#cooperatePanel"}),ToolBar.max_animate_pos=56,ToolBar._layersHashMap=new DT.HashMap,$(".slider-back").click(function(){ToolBar.switchLeftBar("default"),$(".map-layers").trigger("click"),FendanPlugin.reset()}),$("#toolbarBox").click(function(){$(".tool-bar-box").toggleClass("tool-bar-open")}),$(".plug-in-close").click(function(){$(".tool-bar-box").removeClass("tool-bar-open")}),$(".tool-bar-box .plug-bar").click(function(e){var i,n=$(e.target).closest("div");if(n.hasClass("direction"))i=".dt-direction";else if(n.hasClass("marker-reply-selector"))i=".marker-reply";else if(n.hasClass("region-statistics"))i=".map-total-plug";else if(n.hasClass("marker-selector"))i=".dt-marker-selector";else if(n.hasClass("marker-task-selector"))i=".dt-task";else if(n.hasClass("map-log"))i=".log";else if(n.hasClass("data-download"))i=".dt-data-download";else if(n.hasClass("filter-plug"))i=".dt-filter-plug";else if(n.hasClass("fendan-plug")){if(0!=org_level&&4!=org_level)return void PromptInfo.xcConfirm(org_error_txt,PromptInfo.xcConfirm.typeEnum.info);i=".fendan"}else if(n.hasClass("member-location")){if(0!=org_level&&4!=org_level)return void PromptInfo.xcConfirm(org_error_txt,PromptInfo.xcConfirm.typeEnum.info);i=".dt-member-location"}else if(n.hasClass("monitor-warning")){if(0!=org_level&&4!=org_level)return void PromptInfo.xcConfirm(org_error_txt,PromptInfo.xcConfirm.typeEnum.info);i=".dt-monitor-warning"}i&&(n.find(".tool-bar-active").toggleClass("dt-none"),t(),".fendan"!=i&&ToolBar.switchLeftBar("default"),$(i).trigger("click"),$(".plug-in-close").trigger("click"))}),ToolBar.switchLeftBar=function(t){"fendan"==t?($("#drawingToolbar").addClass("dt-none"),$("#reload_guide").addClass("dt-none"),$(".left-slider").addClass("dt-none"),$(".fendan-slider").removeClass("dt-none"),$(".fendan-nav-slider-bg").css("top","0")):($(".fendan-slider").addClass("dt-none"),$("#fendanToolbar").addClass("dt-none"),$("#drawingToolbar").removeClass("dt-none"),$("#reload_guide").removeClass("dt-none"),$(".left-slider").removeClass("dt-none"))},$(".dt-plug-in").on("show.bs.popover",function(t){var e,i,n=$(t.target);n.hasClass("direction")?(e='<span class="dt-line-22h">',e+="\u9009\u53d6\u4e00\u7ec4\u6807\u6ce8\u70b9\uff0c\u81ea\u52a8\u8ba1\u7b97\u4e00\u6761\u6700\u4f18\u8def\u5f84\uff0c\u540c\u65f6\u663e\u793a\u6807\u6ce8\u70b9\u7684\u5230\u8fbe\u987a\u5e8f\u3002 <br>",e+="\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u53ef\u4ee5\u7ed9\u7269\u6d41\u914d\u9001\u5b89\u6392\u9ad8\u6548\u7684\u914d\u9001\u8def\u7ebf\uff0c\u7ed9\u5de1\u68c0\u3001\u5bb6\u653f\u670d\u52a1\u3001\u5e02\u573a\u63a8\u5e7f\u7b49\u4eba\u5458\u5b89\u6392\u5408\u7406\u7684\u4efb\u52a1\u6267\u884c\u987a\u5e8f\u3002",e+="</span>",i=ToolBar.createPlugInCaptionHtml("\u667a\u80fd\u8def\u7ebf\u89c4\u5212","plug-direction","plug-direction1",e)):n.hasClass("marker-reply-selector")?(e='<span class="dt-line-22h">',e+="\u901a\u8fc7\u6587\u5b57\u3001\u56fe\u7247\u53d1\u5e03\u4e1a\u52a1\u7f51\u70b9\u7684\u52a8\u6001\u4fe1\u606f\uff08\u5982\u4ea7\u54c1\u9500\u91cf\u3001\u4ed3\u5e93\u5e93\u5b58\u3001\u9879\u76ee\u8fdb\u5ea6\u7b49\uff09\u3002<br>",e+="\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u5206\u5e97\u7ba1\u7406\u4eba\u5458\u968f\u65f6\u62a5\u544a\u8425\u6536\u6570\u636e\u3001\u9879\u76ee\u7ba1\u7406\u4eba\u5458\u5b9e\u65f6\u76d1\u63a7\u9879\u76ee\u8fdb\u5c55\u3001\u5e02\u573a\u4eba\u5458\u5b9e\u65f6\u6c47\u62a5\u5ba2\u6237\u62dc\u8bbf\u60c5\u51b5\u3002 ",e+="</span>",i=ToolBar.createPlugInCaptionHtml("\u4e1a\u52a1\u52a8\u6001","plug-reply","plug-reply1",e)):n.hasClass("region-statistics")?(e='<span class="dt-line-22h">',e+="\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u53ef\u4ee5",e+="<br>",e+="1. \u6c47\u603b\u533a\u57df\u5185\u7684\u6807\u6ce8\u70b9\u6570\u91cf\uff1b\u5982\u8ba1\u7b97A\u533a\u57df\u5185\u6709\u591a\u5c11\u9910\u9986\u3002<br>",e+="2. \u5206\u6790\u6807\u6ce8\u70b9\u4f4d\u7f6e\u6240\u5728\u533a\u57df\uff1b\u5982\u738b\u5e9c\u4e95\u5f52\u5c5e\u4e8e\u5317\u4eac\u4e1c\u57ce\u533a\u3002<br>",e+="3. \u81ea\u52a8\u751f\u6210\u6807\u6ce8\u70b9\u7684\u7f13\u51b2\u533a\uff1b\u5982\u5206\u6790\u6545\u5bab\u5468\u8fb92km\u8303\u56f4\u5185\u6709\u591a\u5c11\u5bb6\u4e94\u661f\u7ea7\u9152\u5e97\u3002",e+="</span>",i=ToolBar.createPlugInCaptionHtml("\u7edf\u8ba1\u5206\u6790","plug-statistics","plug-statistics1",e)):n.hasClass("monitor-warning")?(e='<span class="dt-line-22h">',e+="\u529f\u80fd\u8bf4\u660e\uff1a\u5bf9\u4efb\u52a1\u6307\u6807\u3001\u4efb\u52a1\u66f4\u65b0\u3001\u4efb\u52a1\u5230\u671f\u7b49\u8fdb\u884c\u76d1\u63a7\u9884\u8b66\uff0c\u6ee1\u8db3\u9884\u8b66\u6761\u4ef6\u65f6\u4f1a\u901a\u8fc7\u9ad8\u4eae\u95ea\u70c1\u3001\u8bed\u97f3\u64ad\u62a5\u3001\u6d88\u606f\u5f39\u7a97\u7b49\u65b9\u5f0f\u9884\u8b66\u63d0\u9192\u3002\u6bd4\u5982\u5e93\u5b58\u6570\u91cf\u4e0d\u80fd\u5c0f\u4e8e100\u4ef6\uff0c\u5f53\u5e93\u5b58\u91cf\u4e3a80\u65f6\u5206\u5e97\u56fe\u6807\u5c31\u4f1a\u95ea\u70c1\u63d0\u793a\u3002",e+="<span>",i=ToolBar.createPlugInCaptionHtml("\u76d1\u63a7\u9884\u8b66","plug-audio","plug-audio1",e)):n.hasClass("marker-selector")?(e='<span class="dt-line-22h">',e+="\u5f00\u542f\u6807\u6ce8\u9009\u62e9\u5668\uff0c\u6d4f\u89c8\u5730\u56fe\u7684\u4eba\u5458\u53ef\u4ee5\u5c06\u5730\u56fe\u4e0a\u611f\u5174\u8da3\u7684\u6807\u6ce8\u70b9\u6570\u636e\u4e0b\u8f7d\u4e0b\u6765\u3002<br>",e+="\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u5e7f\u544a\u516c\u53f8\u53ef\u4ee5\u5c06\u5e7f\u544a\u4f4d\u4fe1\u606f\uff08\u5982\u7167\u7247\u3001\u8054\u7cfb\u7535\u8bdd\u3001\u4ef7\u683c\u7b49\uff09\u53d1\u5e03\u5728\u5730\u56fe\u4e0a\uff0c\u4f9b\u5176\u5ba2\u6237\u67e5\u770b\u6216\u4e0b\u8f7d\u3002",e+="</span>",i=ToolBar.createPlugInCaptionHtml("\u6807\u6ce8\u9009\u62e9\u5668","plug-marker-selector","plug-marker-selector1",e)):n.hasClass("marker-task-selector")?(e='<span class="dt-line-22h">',e+="\u5f00\u542f\u4efb\u52a1\u5206\u6d3e\u540e\uff0c\u53ef\u4ee5\u5c06\u6570\u636e\u8bb0\u5f55\u5206\u6d3e\u7ed9\u4e00\u4e2a\u534f\u4f5c\u6210\u5458\uff0c\u5176\u4ed6\u6210\u5458\u65e0\u6743\u67e5\u770b\u6216\u4fee\u6539\u3002<br>",e+="\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u53ef\u4fdd\u8bc1\u7247\u533a\u8d1f\u8d23\u4eba\u4ec5\u5173\u6ce8\u81ea\u5df1\u8d1f\u8d23\u7684\u7247\u533a\uff0c\u914d\u9001\u4eba\u5458\u4ec5\u7ba1\u7406\u81ea\u5df1\u7684\u8ba2\u5355\u3002",e+="</span>",i=ToolBar.createPlugInCaptionHtml("\u4efb\u52a1\u5206\u6d3e","plug-task","plug-task1",e)):n.hasClass("map-log")?(e='<span class="dt-line-22h">\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u53ef\u4ee5\u67e5\u770b\u5730\u56fe\u4e0a\u5168\u90e8\u7684\u6570\u636e\u4fee\u6539\u65e5\u5fd7\u8bb0\u5f55\uff0c\u4ee5\u4fbf\u6570\u636e\u88ab\u6076\u610f\u6bc1\u574f\u65f6\u8ffd\u6eaf\u6838\u5b9e\u3002</span>',i=ToolBar.createPlugInCaptionHtml("\u65e5\u5fd7\u7ba1\u7406","plug-log","plug-log1",e)):n.hasClass("data-download")?(e='<span class="dt-line-22h">',e+="\u901a\u8fc7\u6570\u636e\u4e0b\u8f7d\uff0c\u53ef\u4ee5\u5c06\u6807\u6ce8\u6570\u636e\u3001\u7ebf\u8def\u548c\u533a\u57df\u7684\u5c5e\u6027\u8868\u6570\u636e\u4e0b\u8f7d\u81f3\u672c\u5730\u7f16\u8f91\u7ba1\u7406",e+="</span>",i=ToolBar.createPlugInCaptionHtml("\u6570\u636e\u4e0b\u8f7d","plug-download","plug-download1",e)):n.hasClass("fendan-plug")?(e='<span class="dt-line-22h">',e+="\u5212\u5206\u914d\u9001\u533a\u57df\u540e\uff0c\u4e0a\u4f20\u8ba2\u5355\u5730\u5740\uff0c\u5feb\u901f\u7cbe\u51c6\u5730\u5c06\u8ba2\u5355\u5206\u62e3\u81f3\u5bf9\u5e94\u914d\u9001\u533a\u57df\u3002\u901a\u8fc7\u5206\u5355\u7ed3\u679c\u7ea0\u9519\u529f\u80fd\uff0c\u4fdd\u8bc1\u4e0d\u89c4\u8303\u5730\u5740\u4e5f\u80fd\u5206\u62e3\u6b63\u786e\u3002",e+="</span>",i=ToolBar.createPlugInCaptionHtml("\u8ba2\u5355\u5206\u62e3","plug-order","plug-order1",e)):n.hasClass("member-location")?(e='<span class="dt-line-22h">',e+="\u5f00\u542f\u5b9a\u4f4d\u76d1\u63a7\uff0c\u5b9e\u65f6\u67e5\u770b\u5730\u56fe\u534f\u4f5c\u6210\u5458\u5177\u4f53\u4f4d\u7f6e\uff0c\u65b9\u4fbf\u5916\u52e4\u4eba\u5458\u7ba1\u7406\uff0c\u4e3a\u5408\u7406\u7684\u4efb\u52a1\u5206\u6d3e\u63d0\u4f9b\u652f\u6301\u3002\u6ce8\uff1a\u534f\u4f5c\u6210\u5458\u9700\u8981\u5728\u624b\u673a\u7aef\u767b\u5f55\u5730\u56fe\u65e0\u5fe7App\u5e76\u6253\u5f00\u534f\u4f5c\u5730\u56fe\u624d\u80fd\u8fdb\u884c\u5b9a\u4f4d\uff0c\u672a\u6253\u5f00\u534f\u4f5c\u5730\u56fe\u5219\u65e0\u6cd5\u5b9a\u4f4d\uff0c\u6210\u5458\u5c06\u663e\u793a\u4e3a\u79bb\u7ebf\u72b6\u6001\u3002",e+="</span>",i=ToolBar.createPlugInCaptionHtml("\u5b9a\u4f4d\u76d1\u63a7","plug-position","plug-position1",e)):n.hasClass("filter-plug")&&(e='<span class="dt-line-22h">',e+="\u81ea\u5b9a\u4e49\u7b5b\u9009\u6761\u4ef6\uff0c\u5feb\u901f\u7b5b\u9009\u6570\u636e\u3002\u5982\uff1a\u7b5b\u9009\u201c\u9500\u91cf \u5927\u4e8e 500\u201d\u7684\u95e8\u5e97\uff0c\u6216\u8005\u7b5b\u9009\u201c\u8ba2\u5355\u72b6\u6001 \u7b49\u4e8e \u5b8c\u6210\u201d\u7684\u8ba2\u5355\u7b49\u3002",e+="</span>",i=ToolBar.createPlugInCaptionHtml("\u7b5b\u9009\u5668","filter-plug-box1","filter-plug-box",e)),i&&n.attr("data-content",i)}),ToolBar.createPlugInCaptionHtml=function(t,e,i,n){var r=[{title:t,img1:e,img2:i,text:n}];return $("#plugInCaptionTemplate").render(r);
};var e=!1;ToolBar.shareInit=function(){var t=["share_template"];$.when($.lazyGetTemplate(t)).done(function(){ToolBar.createSharePanel(),$('#shareContent a[data-toggle="tab"]').click(function(){"#permission"==$(this).attr("href")?(ToolBar.createSharePanel(),$("#mapLink").removeClass("dt-none"),$("#embedLink").addClass("dt-none")):(setTimeout(function(){$("#copyLink1").zclip({path:swf_url,copy:$("#embedUrl").val(),afterCopy:function(){MapUtils.copy_after(this)}},100)}),ToolBar.createEmbedPanel(),$("#mapLink").addClass("dt-none"),$("#embedLink").removeClass("dt-none"))})})},ToolBar.createSharePanel=function(){$.views.settings.allowCode=!0;var t=$.templates.share_template.render({is_embed:!1,checked:checked});$("#embed_page").empty(),$("#permission").empty().append(t),ToolBar.bindEventHandler()},ToolBar.createEmbedPanel=function(){$.views.settings.allowCode=!0;var t=$.templates.share_template.render({is_embed:!0,checked:checked});$("#permission").empty(),$("#embed_page").empty().append(t),ToolBar.bindEventHandler()},ToolBar.bindEventHandler=function(){$("#shareContent input:radio[name=permission_radio]").change(function(){var t=$("#permission input:checked").attr("id")||$("#embed_page input:checked").attr("id");"psd"==t?$(".password-input ").removeClass("dt-none"):($(".change-password").addClass("dt-none"),$(".password-input ").addClass("dt-none"));var e={mid:mid,permission:t};checked=t,"psd"!=t&&MapUtils.ajax2server(pers_map_url,"POST",e)}),$(".change-password").click(function(){$("#pwd").val(""),$(".password-input ").removeClass("dt-none")}),$("#submitPas").unbind().click(function(){var t=null,e=$("#pwd").val();if(0==e.length?t="\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a":/^[a-zA-Z0-9]{6,16}$/.test(e)||(t="\u5bc6\u7801\u5fc5\u987b\u4e3a6-16\u4f4d\u6570\u5b57\u6216\u82f1\u6587\u5b57\u6bcd"),null==t){var i={mid:mid,permission:e};MapUtils.ajax2server(pers_map_url,"POST",i,function(){$(".password-input").addClass("dt-none"),$(".change-password").removeClass("dt-none")})}else PromptInfo.xcConfirm(t,PromptInfo.xcConfirm.typeEnum.error)})},$("#shareBox").click(function(){var t=$(".share-box").hasClass("share-box-open");t?$(".share-box").removeClass("share-box-open"):$(".share-box").addClass("share-box-open"),e||($("#copyLink").zclip({path:swf_url,copy:$("#shareUrl").val(),afterCopy:function(){MapUtils.copy_after(this)}}),e=!0)}),$(".share-box-close").click(function(){$(".share-box").removeClass("share-box-open")}),ToolBar.init=function(t,e,i){ToolBar._map=t,ToolBar._layersHashMap=e,ToolBar._monitorHashMap=i},ToolBar.getTools=function(){return this.tools},ToolBar.addPlugIn=function(t,e,i,n,r){if(!this.tools.containsKey(t)){var a=$(".plug-list").children().length,o="<li class='"+t+" slider' data-select='"+t+"' data-index='"+a+"'>";"glyphicon-tags"==e&&(e+=" dt-mar4r"),o+="dt-task"==t?"<span class='"+e+"'>&#xe61a;</span>":"dt-member-location"==t?"<span class='"+e+"'>&#xe682;</span>":"dt-filter-plug"==t?"<span class='"+e+"'>&#xe9b1;</span>":"<span class='glyphicon "+e+"'></span>",o+="<span class='pull-left'>"+n+"</span>",$("."+i).append(o);var s=this.max_animate_pos+56;this.max_animate_pos=s;var l=this._getPanelName(t);t.indexOf("total")>=0?this.addTotalPanel(l,r):t.indexOf("download")>=0?this.addDataPanel(l,r):t.indexOf("reply")>=0?this.addReplyPanel(l,r):t.indexOf("direction")>=0?DirectionUtils.init(l,r):t.indexOf("selector")>=0?this.addMarkerSelector(l,r):t.indexOf("task")>=0?this.addTask(l,r):t.indexOf("message")>=0?this.addMessageAudio(l,r):t.indexOf("fendan")>=0?(FendanPlugin.addQuickSort(l,r),"fendan"!=t||r||ToolBar.switchLeftBar("fendan")):t.indexOf("member-location")>=0?this.addMemberLocation(l,r):t.indexOf("filter")>=0?this.addFilterPlugin(l):t.indexOf("monitor-warning")>=0&&this.addMonitorWarning(l,r);var d={name:t,panel:"#"+l,animate_pos:s};this.tools.put(t,d)}},ToolBar.addTask=function(t){var e="<div id='"+t+"' class='slider-bar' style='display:none;'>";e+="<p style='height:31px;' class='dt-pad10x dt-line-30h'>",e+="<span class='iconfont dt-mar6r'>&#xe61a;</span>\u4efb\u52a1\u5206\u6d3e",e+="</p>",e+="<hr style='margin-top:0;'>",e+="<div class='dt-mar12x dt-mar12y dt-border-cc'>",e+="<p class='dt-bg-f1 dt-pad4x dt-pad4y'>",e+="&nbsp;\u4efb\u52a1\u5206\u6d3e\u8bf4\u660e",e+="</p>",e+="<div class='dt-hidden dt-pad6x dt-pad6y dt-f12'>",e+="\u53ef\u4ee5\u5c06\u5177\u4f53\u7684\u6807\u6ce8\u70b9\u3001\u533a\u57df\uff0c\u6216\u8005\u8def\u7ebf\u5206\u6d3e\u7ed9\u5bf9\u5e94\u7684\u8d1f\u8d23\u4eba\uff0c\u8be5\u8d1f\u8d23\u4eba\u53ea\u80fd\u770b\u5230\u81ea\u5df1\u8d1f\u8d23\u7684\u4efb\u52a1\uff0c\u4e0d\u80fd\u66f4\u6539\u5176\u4ed6\u5730\u56fe\u5185\u5bb9\u3002<p class='dt-mar6t'>\u5206\u6d3e\u64cd\u4f5c\u6b65\u9aa4\uff1a</p>1.\u70b9\u51fb\u56fe\u5c42\u6309\u94ae\uff0c\u770b\u5230\u5730\u56fe\u4e0a\u7684\u56fe\u5c42\u6570\u636e\uff1b<br>2.\u70b9\u51fb\u56fe\u5c42\u540d\u79f0\u65c1\u8fb9\u7684\u201c\u6570\u636e\u8bd5\u56fe&nbsp;<span class='glyphicon glyphicon-th-list'></span>&nbsp;\u6309\u94ae\uff0c\u6253\u5f00\u6570\u636e\u89c6\u56fe\uff1b<br>3.\u52fe\u9009\u9700\u8981\u8fdb\u884c\u4efb\u52a1\u5206\u6d3e\u7684\u8bb0\u5f55\uff1b<br>4.\u70b9\u51fb\u4efb\u52a1\u5206\u6d3e&nbsp;&nbsp;<span class='icons send-user'></span>&nbsp;\u6309\u94ae\uff0c\u5c06\u4efb\u52a1\u5206\u6d3e\u7ed9\u5bf9\u5e94\u4eba\u5373\u53ef\u3002",e+="</div>",e+="</div>",e+="</div>",$("#mapInfoWrapper").append(e)},ToolBar.addMonitorWarning=function(t){MonitorUtils.init(t,ToolBar._map,ToolBar._layersHashMap,ToolBar._monitorHashMap)},ToolBar.addMessageAudio=function(t){var e="<div id='"+t+"' class='slider-bar' style='display:none;'>";e+="<p style='height:31px;' class='dt-pad10x dt-line-30h'>",e+="<span class='glyphicon glyphicon-bullhorn dt-mar6r'></span>\u6d88\u606f\u63d0\u9192",e+="</p>",e+="<hr style='margin-top:0;'>",e+="<div class='dt-mar12x dt-mar12y dt-border-cc'>",e+="<p class='dt-bg-f1 dt-pad4x dt-pad4y'>",e+="&nbsp;\u6d88\u606f\u63d0\u9192",e+="</p>",e+="<div class='dt-hidden dt-pad6x dt-pad6y dt-f12'>",e+=_loadMessageAudio(),e+="<hr class='dt-mar4y'>",e+="<p class='dt-mar8t dt-mar12b dt-f14'>\u63d0\u9192\u8303\u56f4</p>",e+="<label for='createOverlay'>",e+="<input id='createOverlay' type='checkbox' name='messageAudio' checked disabled/>",e+="<span class='dt-mar6l'>\u5730\u56fe\u4e0a\u6dfb\u52a0\u8bb0\u5f55\u540e\u63d0\u9192</span>",e+="</label>",e+="</div>",e+="</div>",e+="</div>",$("#mapInfoWrapper").append(e)},ToolBar.addMarkerSelector=function(t){var e="<div id='"+t+"' class='slider-bar' style='display:none;'>";e+="<p style='height:31px;' class='dt-pad10x dt-line-30h'>",e+="<span class='glyphicon glyphicon-tags dt-mar6r'></span>\u6807\u6ce8\u9009\u62e9\u5668\u63d2\u4ef6",e+="</p>",e+="<hr style='margin-top:0;'>",e+="<div class='dt-mar12x dt-mar12y dt-border-cc'>",e+="<p class='dt-bg-f1 dt-pad4x dt-pad4y'>",e+="&nbsp;\u6807\u6ce8\u9009\u62e9\u5668\u8bf4\u660e",e+="</p>",e+="<div class='dt-hidden dt-pad6x dt-pad6y dt-f12'>",e+="\u901a\u8fc7\u6807\u6ce8\u9009\u62e9\u5668\uff0c\u53ef\u5728\u53d1\u5e03\u540e\u5730\u56fe\u4e0a\u8fdb\u884c\u6807\u6ce8\u70b9\u9009\u62e9\uff0c\u5e76\u5c06\u6240\u9009\u7684\u6807\u6ce8\u70b9\u4ee5Excel\u683c\u5f0f\u4e0b\u8f7d\u3002<br><p class='dt-mar6t' style='margin-bottom:0;'>\u4f7f\u7528\u6b65\u9aa4\uff1a</p>1.\u70b9\u51fb\u5730\u56fe\u53f3\u4e0a\u89d2\u7684\u201c\u53d1\u5e03\u201d\u6309\u94ae\uff1b<br>2.\u5728\u53d1\u5e03\u540e\u5730\u56fe\u4e0a\uff0c\u70b9\u51fb\u6807\u6ce8\u70b9\u5f39\u7a97\u4e0a\u7684\u9009\u53d6&nbsp;<span class='glyphicon glyphicon-shopping-cart'></span>&nbsp;\u6309\u94ae\uff1b<br>3.\u9009\u4e2d\u7ed3\u679c\u4f1a\u663e\u793a\u5728\u5c4f\u5e55\u53f3\u4e0b\u89d2\uff0c\u70b9\u51fb\u4e0b\u8f7d\u5373\u53ef\u5c06\u6807\u6ce8\u70b9\u6570\u636e\u4e0b\u8f7d\u4e0b\u6765\u3002",e+="</div>",e+="</div>",e+="</div>",$("#mapInfoWrapper").append(e)},ToolBar.addDataPanel=function(t){var e=this._addLayerDataDownloadHtml(),i="<div id='"+t+"' class='slider-bar' style='display:none;'>";i+="<p style='height:31px;' class='dt-pad10x dt-line-30h'>",i+="<span class='glyphicon glyphicon-cloud-download dt-mar6r'></span>\u6570\u636e\u4e0b\u8f7d",i+="</p>",i+="<hr style='margin-top:0;'>",i+=e,i+="<hr style='margin-top:0;'>",i+="</div>",$("#mapInfoWrapper").append(i),$("#start_download").unbind().click(function(){var t="\u4f60\u786e\u5b9a\u8981\u4e0b\u8f7d\u6b64\u6570\u636e\u5417\uff1f";PromptInfo.xcConfirm(t,PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){var t=$("#select_download_layer"),e=t.find("option:checked").attr("data-type"),i="";"marker_layer"==e?i=download_url:"line_layer"==e?i=line_layer_download_url:"region_layer"==e&&(i=region_layer_download_url);var n={mid:mid,id:t.val()};MapUtils.ajax2server(i,"POST",n,function(t){MapUtils.operatingNotice("\u6570\u636e\u751f\u6210\u4e2d,\u8bf7\u7a0d\u7b49",{loading:!0,expire:1e3}),MapUtils.download(t.url)})}})}),$("#"+t).unbind().click(function(t){$(t.target).hasClass("query-remove")&&($(t.target).closest("div").prev().remove(),$(t.target).closest("div").remove())})},ToolBar.addTotalPanel=function(t){function e(){var t=$("#select_cal_markers").val(),e=ToolBar._layersHashMap.get("m_"+t);n(e)}function i(){var t=$("#cal_fields option:checked").attr("data-field-type"),e=$("#cal_type");"number"==t?(e.find("option[data-type=\u6c42\u548c]").show(),e.val("\u6c42\u548c")):(e.find("option[data-type=\u6c42\u548c]").hide(),e.val().indexOf("\u6c42\u548c")>=0&&e.val("\u8ba1\u6570"))}function n(t){var e=$("#cal_fields"),n=e.parent();if(e=e.detach(),e.empty(),t){var r=t.getAttrFields();0==r.length?e.attr("disabled","disabled"):e.removeAttr("disabled");for(var a=0,o=null,s=r.length;a<s;a++)o=r[a],e.append("<option value='"+o.id+"' data-field-type='"+o.field_type+"'>"+o.field+"</option>");n.append(e),i()}}function r(t,e){MapUtils.ajax2server(bind_region_url,"post",{mid:mid,id:t,region_layer_id:e})}function a(){function t(t,e,i,n){for(var r=0;r<n.length;r++){var a=n[r],o=new Dtwy.Circle({center:a.getPosition(),radius:parseFloat(e)}),s={};s[i]="\u7f13\u51b2\u533a_"+a.getTitle();var l={mid:mid,region_layer_id:t,path:o.getPathString(),region_type:1,is_upload:!0,attrs:s};MapUtils.ajax2server(create_region_url,"POST",l)}}$("#bufferRadius .btn:first-of-type").unbind().click(function(){var t=$("#bufferRadius input"),e=MapUtils.accAdd(parseFloat(t.val()),1);isNaN(e)&&(e=1e3),e<100?e=100:e>5e4&&(e=5e4),t.val(e)}),$("#bufferRadius .btn:last-of-type").unbind().click(function(){var t=$("#bufferRadius input"),e=MapUtils.addSub(parseFloat(t.val()),1);isNaN(e)&&(e=1e3),e<100?e=100:e>5e4&&(e=5e4),t.val(e)}),$("#start_buffer_statistics").unbind().click(function(){if([0,3,4].indexOf(org_level)==-1)return void PromptInfo.xcConfirm(org_error_txt,PromptInfo.xcConfirm.typeEnum.info);var e=$("#select_buffer_markers").val(),i=ToolBar._layersHashMap.get("m_"+e).getMarkers().values(),n=$("#select_buffer_regions").val(),r=$("#bufferRadius input").val();if(0==r.trim().length)return void PromptInfo.xcConfirm("\u7f13\u51b2\u534a\u5f84\u4e0d\u80fd\u4e3a\u7a7a!",PromptInfo.xcConfirm.typeEnum.info);if(r<100)return void PromptInfo.xcConfirm("\u7f13\u51b2\u534a\u5f84\u6570\u503c\u4e0d\u80fd\u5c0f\u4e8e100\u7c73",PromptInfo.xcConfirm.typeEnum.info);if(r>5e4)return void PromptInfo.xcConfirm("\u7f13\u51b2\u534a\u5f84\u6570\u503c\u4e0d\u80fd\u5927\u4e8e50000\u7c73",PromptInfo.xcConfirm.typeEnum.info);if($("#start_buffer_statistics").attr("disabled",!0),n==-1)MapUtils.ajax2server(add_region_layer_url,"POST",{mid:mid},function(e){n=e.layer_id,$(".layer").find(".active-layer").removeClass("active-layer").addClass("layer-hover"),$("#region_layer_"+n).find(".layer-hover").removeClass("layer-hover").addClass("active-layer"),document.getElementById("featureListPanelBorder").scrollTop=document.getElementById("featureListPanelBorder").scrollHeight+140,t(n,r,"\u6807\u9898",i),$("#start_buffer_statistics").attr("disabled",!1)},function(){$("#region_statistics").is(":checked")&&$("#start_buffer_statistics").attr("disabled",!1)});else{var a=ToolBar._layersHashMap.get("r_"+n),o=a.getUniformTitle();t(n,r,o,i)}}),$("#start_relation_statistics").unbind().click(function(){if([0,3,4].indexOf(org_level)==-1)return void PromptInfo.xcConfirm(org_error_txt,PromptInfo.xcConfirm.typeEnum.info);var t=$("#select_rel_markers").val(),e=$("#select_rel_regions").val(),i=ToolBar._layersHashMap.get("m_"+t),n=ToolBar._layersHashMap.get("r_"+e),a="\u533a\u57df\uff3f"+n.title,o=i.getAttrField(a),s=null!=o;s?PromptInfo.xcConfirm("\u6240\u9009\u6807\u6ce8\u6570\u636e\u5df2\u5b58\u5728\u201c"+a+"\u201d\u5217\uff0c\u5f52\u5c5e\u533a\u57df\u5206\u6790\u7ed3\u679c\u5c06\u66ff\u6362\u5f53\u524d\u201c"+a+"\u201d\u5217\u5185\u5bb9\uff01\u662f\u5426\u7ee7\u7eed\uff1f",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){r(t,e)}}):r(t,e)}),$("#select_cal_markers").unbind().change(function(){e()}),$("#cal_fields").unbind().change(function(){i()}),$("#start_region_statistics").unbind().click(function(){if([0,3,4].indexOf(org_level)==-1)return void PromptInfo.xcConfirm(org_error_txt,PromptInfo.xcConfirm.typeEnum.info);var t=$("#select_cal_regions").val(),e=$("#select_cal_markers").val(),i=$("#cal_fields").val(),n=$("#cal_type").val();if(t&&e&&i&&n)MapUtils.ajax2server(calculation_url,"POST",{mid:mid,region_layer_id:t,marker_layer_id:e,cal_field:i,cal_type:n});else{var r="\u7f3a\u5c11\u7edf\u8ba1\u6570\u636e\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9";PromptInfo.xcConfirm(r,PromptInfo.xcConfirm.typeEnum.error)}})}var o=this._addRegionTotalPanelHtml(),s=this._addRelationTotalHtml(),l=this._addBufferHtml(),d="<div id='"+t+"' class='slider-bar' style='display:none;'>";d+="<p style='height:31px;' class='dt-pad10x dt-line-30h'>",d+="<span class='glyphicon glyphicon-stats dt-mar6r'></span>\u7edf\u8ba1\u5206\u6790",d+="</p>",d+="<div class='dt-auto analysis'>",d+="<hr style='margin-top:0;'>",d+=o,d+="<hr style='margin-top:0;'>",d+=s,d+="<hr style='margin-top:0;'>",d+=l,d+="</div>",$("#mapInfoWrapper").append(d),$(".analysis").height(window.innerHeight-31-48),this.getCurrentData(),a(),$("#select_cal_markers").first().attr("selected",!0),e(),$("#select_cal_regions").children().length>0?($("#start_region_statistics").attr("disabled",!1),$("#start_relation_statistics").attr("disabled",!1)):($("#start_region_statistics").attr("disabled",!0),$("#start_relation_statistics").attr("disabled",!0))},ToolBar._addRegionTotalPanelHtml=function(){var t="<div class='dt-mar12x dt-mar12y dt-border-cc'>";return t+="<p class='dt-bg-f1 dt-pad4x dt-pad4y'>",t+="</span>&nbsp;\u533a\u57df\u7edf\u8ba1\u5206\u6790",t+="</p>",t+="<div id='set_region_statistics'>",t+="<div class='text-center dt-h34 dt-mar4t'>",t+="<div class='col-md-4 dt-line-32h'>\u533a\u57df\u56fe\u5c42</div>",t+="<div class='col-md-8'>",t+="<select class='form-control' id='select_cal_regions'></select>",t+="</div>",t+="</div>",t+="<hr class='dt-mar4y'>",t+="<div class='text-center dt-h34'>",t+="<div class='col-md-4 dt-line-32h'>\u6807\u6ce8\u56fe\u5c42</div>",t+="<div class='col-md-8'>",t+="<select class='form-control' id='select_cal_markers'></select>",t+="</div>",t+="</div>",t+="<hr class='dt-mar4y'>",t+="<div class='text-center dt-h34'>",t+="<div class='col-md-4 dt-line-32h'>\u7edf\u8ba1\u5b57\u6bb5</div>",t+="<div class='col-md-8'>",t+="<select class='form-control' id='cal_fields'>",t+="</select>",t+="</div>",t+="</div>",t+="<hr class='dt-mar4y'>",t+="<div class='text-center dt-h34'>",t+="<div class='col-md-4 dt-line-32h'>\u7edf\u8ba1\u65b9\u5f0f</div>",t+="<div class='col-md-8'>",t+="<select class='form-control' id='cal_type'>",t+="<option data-type='\u6c42\u548c' value='\u6c42\u548c'>\u6c42\u548c</option>",t+="<option data-type='\u8ba1\u6570' value='\u8ba1\u6570'>\u8ba1\u6570</option>",t+="<option data-type='\u8ba1\u6570' value='\u5206\u7c7b\u8ba1\u6570'>\u5206\u7c7b\u8ba1\u6570</option>",t+="</select>",t+="</div>",t+="</div>",t+="<hr class='dt-mar4y'>",t+="<div class='text-center dt-h34'>",t+="<a class='btn btn-primary btn-sm' id='start_region_statistics' href='###'>\u7edf\u8ba1\u5206\u6790</a>",t+="</div>",t+="</div>",t+="<hr class='dt-mar4y'>",t+="<p class='dt-f12 dt-pad4x color99'>\u7edf\u8ba1\u5206\u6790\u529f\u652f\u6301\u533a\u57df\u9762\u5185\u7684\u6807\u6ce8\u4fe1\u606f\u7edf\u8ba1\uff0c\u7edf\u8ba1\u5b8c\u6210\u540e\u70b9\u51fb\u5404\u4e2a\u533a\u57df\u9762\u53ef\u67e5\u770b\u7edf\u8ba1\u7ed3\u679c\u3002</p>",t+="</div>"},ToolBar._addRelationTotalHtml=function(){var t="<div class='dt-mar12x dt-mar12y dt-border-cc'>";return t+="<p class='dt-bg-f1 dt-pad4x dt-pad4y'>",t+="&nbsp;\u6807\u6ce8\u70b9\u533a\u57df\u5f52\u5c5e\u5206\u6790",t+="</p>",t+="<div id='set_region_statistics'>",t+="<div class='text-center dt-h34 dt-mar4t'>",t+="<div class='col-md-4 dt-line-32h'>\u533a\u57df\u56fe\u5c42</div>",t+="<div class='col-md-8'>",t+="<select class='form-control' id='select_rel_regions'></select>",t+="</div>",t+="</div>",t+="<hr class='dt-mar4y'>",t+="<div class='text-center dt-h34'>",t+="<div class='col-md-4 dt-line-32h'>\u6807\u6ce8\u56fe\u5c42</div>",t+="<div class='col-md-8'>",t+="<select class='form-control' id='select_rel_markers'></select>",t+="</div>",t+="</div>",t+="<hr class='dt-mar4y'>",t+="<div class='text-center dt-h34'>",t+="<a class='btn btn-primary btn-sm' id='start_relation_statistics' href='###'>\u7edf\u8ba1\u5206\u6790</a>",t+="</div>",t+="<hr class='dt-mar4y'>",t+="<p class='dt-f12 dt-pad4x color99'>\u6807\u6ce8\u70b9\u533a\u57df\u5f52\u5c5e\u5206\u6790\u652f\u6301\u5efa\u7acb\u6807\u6ce8\u70b9\u548c\u533a\u57df\u9762\u7684\u5173\u8054\u5173\u7cfb\uff0c\u5206\u6790\u5b8c\u6210\u540e\u6807\u6ce8\u70b9\u7684\u5f52\u5c5e\u533a\u57df\u540d\u79f0\u5c06\u4fdd\u5b58\u5728\u6807\u6ce8\u70b9\u5c5e\u6027\u4e2d\u3002</p>",t+="</div>",t+="</div>"},ToolBar._addBufferHtml=function(){var t="<div class='dt-mar12x dt-mar12y dt-border-cc'>";return t+="<p class='dt-bg-f1 dt-pad4x dt-pad4y'>",t+="&nbsp;\u7f13\u51b2\u533a\u5206\u6790",t+="</p>",t+="<div id='set_region_statistics'>",t+="<div class='text-center dt-h34 dt-mar4t'>",t+="<div class='col-md-4 dt-line-32h'>\u6807\u6ce8\u56fe\u5c42</div>",t+="<div class='col-md-8'>",t+="<select class='form-control' id='select_buffer_markers'></select>",t+="</div>",t+="</div>",t+="<hr class='dt-mar4y'>",t+="<div class='text-center dt-h34'>",t+="<div class='col-md-4 dt-line-32h'>\u533a\u57df\u56fe\u5c42</div>",t+="<div class='col-md-8'>",t+="<select class='form-control' id='select_buffer_regions'></select>",t+="</div>",t+="</div>",t+="<hr class='dt-mar4y'>",t+="<div class='text-center dt-h34'>",t+="<div class='col-md-4 dt-line-32h'>\u7f13\u51b2\u534a\u5f84</div>",t+="<div class='col-md-8'>",t+="<div id='bufferRadius'>",t+="<div class='input-group'>",t+="<input type='text' class='form-control' value='1000' />",t+="<div class='input-group-btn-vertical'>",t+="<button class='btn btn-default' type='button'><i class='fa fa-caret-up'></i></button>",t+="<button class='btn btn-default' type='button'><i class='fa fa-caret-down'></i></button>",t+="</div>",t+="</div>",t+="<div/>",t+="</div>",t+="</div>",t+="</div>",t+="<hr class='dt-mar4y'>",t+="<div class='text-center dt-h34'>",t+="<a class='btn btn-primary btn-sm' id='start_buffer_statistics' href='###'>\u7f13\u51b2\u533a\u5206\u6790</a>",t+="</div>",t+="<hr class='dt-mar4y'>",t+="<p class='dt-f12 dt-pad4x color99'>\u57fa\u4e8e\u70b9\u6807\u6ce8\u7684\u7f13\u51b2\u533a\uff0c\u4ee5\u70b9\u6807\u6ce8\u4e3a\u5706\u5fc3\u3001\u4ee5\u4e00\u5b9a\u8ddd\u79bb\u4e3a\u534a\u5f84\uff08\u7c73\uff09\u751f\u6210\u5706\u3002<br>\u6ce8\uff1a\u7f13\u51b2\u534a\u5f84100~50000\u7c73<br>\u5efa\u8bae\u4f7f\u7528\u65b0\u5efa\u56fe\u5c42\u8fdb\u884c\u7f13\u51b2\u533a\u5206\u6790<br><span class='text-info'>\u7f13\u51b2\u533a\u5206\u6790\u4f1a\u5b58\u5728\u8bef\u5dee,\u6bcf500\u7c73\u8bef\u5dee1\u7c73\u5de6\u53f3</span></p>",t+="</div>",t+="</div>"},ToolBar._addLayerDataDownloadHtml=function(){var t="<div class='dt-mar12x dt-mar12y dt-border-cc'>";return t+="<p class='dt-bg-f1 dt-pad4x dt-pad4y'>",t+="&nbsp;\u9009\u62e9\u56fe\u5c42",t+="</p>",t+="<div class='dt-pad4x'>",t+="<div class='text-center dt-h34 dt-mar4t'>",t+="<div class='col-md-4 dt-line-32h'>\u56fe\u5c42\u540d\u79f0</div>",t+="<div class='col-md-8'>",t+="<select class='form-control' id='select_download_layer'></select>",t+="</div>",t+="</div>",t+="<hr class='dt-mar4y'>",t+="<div class='text-center dt-h34'>",t+="<a class='btn btn-primary btn-sm' id='start_download' href='###'>\u786e\u8ba4\u4e0b\u8f7d</a>",t+="</div>",t+="</div>",t+="</div>"},ToolBar._getPanelName=function(t){for(var e=t.split("-"),i=e[0],n=1;n<e.length;n++)i+=ToolBar.JSFormatName(e[n]);return i+="Panel"},ToolBar.JSFormatName=function(t){return t.replace(/(^|\s+)\w/g,function(t){return t.toUpperCase()})},ToolBar.removePlugIn=function(t){var e=this.tools.get(t);if(e){this.tools.remove(t);var i=$(".nav-slider-bg").attr("style");i&&(i.indexOf(e.animate_pos)>=0?$(".map-layers").trigger("click"):""),$("."+e.name).remove(),e.panel.indexOf("log")==-1&&$(e.panel).remove(),this.max_animate_pos=this.max_animate_pos-56,$(".map-layers").trigger("click");var n=$(".plug-list").find("li"),r=parseInt($(n).last().attr("data-index"));n.length-1<r&&$(n).last().attr("data-index",n.length-1),"dt-filter-plug"==e.name&&FilterPlugin.destroy()}},ToolBar.getCurrentData=function(){$("#select_cal_regions").empty(),$("#select_cal_markers").empty(),$("#select_rel_regions").empty(),$("#select_rel_markers").empty(),$("#select_buffer_markers").empty(),$("#select_buffer_regions").empty(),$("#select_download_layer").empty(),$("#select_start_directions").empty(),$("#select_way_directions").empty(),$("#select_end_directions").empty(),$("#select_region_directions").empty(),$("#select_reply_marker_layer").empty(),$("#select_reply_marker_layer").append("<option value='all'>\u5168\u90e8\u56fe\u5c42</option>");for(var t=ToolBar._layersHashMap.values(),e=0;e<t.length;e++){var i=t[e],n="<option value='"+i.id+"'>"+i.getTitle()+"</option>";"region_layer"==i.type?($("#select_cal_regions").append(n),$("#select_rel_regions").append(n),$("#select_region_directions").append(n),$("#select_buffer_regions").append(n)):"marker_layer"==i.type&&($("#select_reply_marker_layer").append(n),$("#select_cal_markers").append(n),$("#select_rel_markers").append(n),$("#select_start_directions").append(n),$("#select_way_directions").append(n),$("#select_end_directions").append(n),$("#select_buffer_markers").append(n)),$("#select_download_layer").append("<option data-type='"+i.type+"' value='"+i.id+"'>"+i.getTitle()+"</option>")}$("#select_buffer_regions").append("<option value='-1'>\u65b0\u5efa\u56fe\u5c42</option>"),$("#select_cal_regions").children().length>0?($("#start_region_statistics").attr("disabled",!1),$("#start_relation_statistics").attr("disabled",!1)):($("#start_region_statistics").attr("disabled",!0),$("#start_relation_statistics").attr("disabled",!0))},_getCurrentLayerRegion=function(t){var e=t.regions.values(),i="<select class='form-control direction-regions dt-mar4t dt-w132'>";i+="<option value='"+t.id+"'>\u5168\u90e8\u533a\u57df</option>";for(var n=0;n<e.length;n++)for(var r=e[n],a=0;a<r.attrs.length;a++){var o=r.attrs[a];r.uniform_title==o.key&&(i+="<option value='"+r.feature_id+"'>"+(o.value||"")+"</option>")}return i+="</select>"},_loadMessageAudio=function(){var t='<audio controls="controls" class="dt-w284">';return t+='<source src="'+oss_host+'/resource/audios/message_audio.mp3" type="audio/mp3"/>',t+="</audio>",t+="<span>\u63d0\u793a\u97f3\uff0d\u8bd5\u542c</span>"},ToolBar.addReplyPanel=function(t,e){ReplyPlugin.init(t,ToolBar._map,ToolBar._layersHashMap,function(){e||$("#"+t).show()})},ToolBar.addMemberLocation=function(t){LocationUtils.init(t,ToolBar._map)},ToolBar.addFilterPlugin=function(t){FilterPlugin.init(t,ToolBar._map,ToolBar._layersHashMap)}});var Util_List={mf_add:function(t,e,i){var n=document.createElement("option");n.appendChild(document.createTextNode(e)),n.setAttribute("value",i),t.appendChild(n)},mf_clear:function(t){for(var e=t.options.length-1;e>=0;e--)try{t.remove(e)}catch(t){}this.mf_add(t,"---","")},mf_select:function(t,e){for(var i=0;i<t.options.length&&t.options[i].value!=e;i++);if(i>=t.options.length)return!1;try{t.options[i].selected=!0}catch(t){}return t.selectedIndex=i,t.value=e,!0},mf_isempty:function(t){return t.options.length>0&&""==t.value}},XmlHttp={mf_createxmlhttp:function(){var t=!1;if(window.ActiveXObject)for(var e=["MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],i=0;i<e.length;i++)try{t=new ActiveXObject(e[i]);break}catch(e){t=!1}else try{t=new XMLHttpRequest}catch(e){t=!1}return t},mf_sendrequest:function(t,e,i){t.onreadystatechange=i,t.open("GET",e,!0),t.send(null)},mf_sendrequest_sync:function(t,e){t.open("GET",e,!1),t.send(null)},mf_postrequest:function(t,e,i,n){t.onreadystatechange=i,t.open("POST",e,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n)}},LocalList={mo_options:null,mo_countryObj:null,mo_stateObj:null,mo_cityObj:null,md_defaultCountry:"",md_defaultState:"",md_defaultCity:"",md_loadingId:"loading",md_load_completeId:"load_complete",md_http_request:!1,md_loc_xml:!1,md_bgetfailed:!1,md_bInit:!1,md_bAreaLoaded:!1,md_bUpdate:!1,mf_init:function(t){this.mo_options={country:"country",state:"state",city:"city",current:"",language:"zh_cn",path_to_xml:"",read_only:!1};for(var e in this.mo_options)t[e]&&(this.mo_options[e]=t[e]);if(this.mo_options.read_only=this.mo_options.read_only||!1,this.mo_countryObj=document.getElementById(this.mo_options.country),addEvent(this.mo_countryObj,"change",this.mf_processStateList),this.mo_stateObj=document.getElementById(this.mo_options.state),addEvent(this.mo_stateObj,"change",this.mf_processCityList),this.mo_cityObj=document.getElementById(this.mo_options.city),LocalList.mo_options.read_only&&(!this.mo_options.current||"||"==this.mo_options.current))return void(this.mo_cityObj.innerHTML="-");this.mf_getinfo(this.mo_options.language,this.mo_options.path_to_xml);var i=this.mo_options.current.split("|");this.md_defaultCountry=i[0]?i[0]:"",this.md_defaultState=i[1]?i[1]:"",this.md_defaultCity=i[2]?i[2]:"",this.md_bInit=!0},mf_getinfo:function(t,e){t||(t="zh_cn"),e||(e="");var i=e+"LocalList-"+t+".xml";return navigator.userAgent.indexOf("Opera")>-1&&(i+="?seed="+Math.random()),this.md_http_request=XmlHttp.mf_createxmlhttp(),!!this.md_http_request&&(this.md_bgetfailed=!1,XmlHttp.mf_sendrequest_sync(this.md_http_request,i),this.mf_RecvLocList(),!0)},mf_RecvLocList:function(){4==LocalList.md_http_request.readyState&&(200==LocalList.md_http_request.status?(LocalList.md_loc_xml=LocalList.md_http_request.responseXML.documentElement,LocalList.mo_options.read_only?LocalList.mf_showCity():LocalList.mf_initUpdate()):(LocalList.md_bgetfailed=!0,alert("Get area list failed, please refresh and try it again!")))},mf_initUpdate:function(){return this.md_bInit&&this.md_loc_xml?(this.mf_processCountryList(),""!=this.md_defaultCountry&&Util_List.mf_select(this.mo_countryObj,this.md_defaultCountry)&&this.mf_processStateList(),""!=this.md_defaultState&&Util_List.mf_select(this.mo_stateObj,this.md_defaultState)&&this.mf_processCityList(),""!=this.md_defaultCity&&Util_List.mf_select(this.mo_cityObj,this.md_defaultCity),this.md_bAreaLoaded=!0,!0):void setTimeout("LocalList.mf_initUpdate();",300)},mf_showCity:function(){if(!this.md_bInit||!this.md_loc_xml)return void setTimeout("LocalList.mf_showCity();",300);for(var t="",e=this.md_loc_xml.getElementsByTagName("CountryRegion"),i=0;i<e.length;i++)if(this.md_defaultCountry==e[i].getAttribute("Code")){t+=e[i].getAttribute("Name");break}var n=e[i].getElementsByTagName("State");if(n.length>1){for(i=0;i<n.length;i++)if(this.md_defaultState==n[i].getAttribute("Code")){t+=n[i].getAttribute("Name");break}if(n[i]){var r=n[i].getElementsByTagName("City");if(r.length>0)for(i=0;i<r.length;i++)if(this.md_defaultCity==r[i].getAttribute("Code")){t+=r[i].getAttribute("Name");break}}}this.mo_cityObj.innerHTML=t},mf_processCountryList:function(){var t=null;if(t=this.hasOwnProperty("md_bInit")&&this.hasOwnProperty("md_loc_xml")?this:LocalList,t.md_bInit&&t.md_loc_xml){var e=t.mo_countryObj;Util_List.mf_clear(t.mo_countryObj);for(var i=t.md_loc_xml.getElementsByTagName("CountryRegion"),n="",r="",a=0;a<i.length;a++)n=i[a].getAttribute("Name"),r=i[a].getAttribute("Code"),Util_List.mf_add(t.mo_countryObj,n,r);e.style.display="inline",t.mf_processStateList()}},mf_processStateList:function(){var t=null;if(t=this.hasOwnProperty("md_bInit")&&this.hasOwnProperty("md_loc_xml")?this:LocalList,t.md_bInit&&t.md_loc_xml){var e=t.mo_stateObj;Util_List.mf_clear(t.mo_stateObj);do{var i=t.md_loc_xml.getElementsByTagName("CountryRegion"),n=t.mo_countryObj.value,r=0;for(r=0;r<i.length&&i[r].getAttribute("Code")!=n;r++);if(r>=i.length)break;var a=i[r].getElementsByTagName("State");if(a.length<=1){e.style.display="none";break}var o="",s="";for(r=0;r<a.length;r++)o=a[r].getAttribute("Name"),s=a[r].getAttribute("Code"),Util_List.mf_add(t.mo_stateObj,o,s);e.style.display="inline",t.md_bUpdate&&Util_List.mf_isempty(t.mo_stateObj)&&t.mo_stateObj.focus()}while(!1);"none"==e.style.display,t.mf_processCityList()}},mf_processCityList:function(){var t=null;if(t=this.hasOwnProperty("md_bInit")&&this.hasOwnProperty("md_loc_xml")?this:LocalList,t.md_bInit&&t.md_loc_xml){var e=t.mo_cityObj;Util_List.mf_clear(t.mo_cityObj);do{var i=t.md_loc_xml.getElementsByTagName("CountryRegion"),n=t.mo_countryObj.value,r=0;for(r=0;r<i.length&&i[r].getAttribute("Code")!=n;r++);if(r>=i.length)break;var a=i[r].getElementsByTagName("State");if(r=0,a.length>1){for(var o=t.mo_stateObj.value;r<a.length&&a[r].getAttribute("Code")!=o;r++);if(r>=a.length)break}else if(a.length<=0)break;var s=a[r].getElementsByTagName("City");if(s.length<=0)break;var l="",d="";for(r=0;r<s.length;r++)l=s[r].getAttribute("Name"),d=s[r].getAttribute("Code"),Util_List.mf_add(t.mo_cityObj,l,d);e.style.display="inline",t.md_bUpdate&&Util_List.mf_isempty(t.mo_cityObj)&&t.mo_cityObj.focus()}while(!1);"none"==e.style.display}}};!function(t,e){"object"==typeof exports?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t)}(this,function(t){function e(t){this._targetElement=t,this._options={nextLabel:"Next &rarr;",prevLabel:"&larr; Back",skipLabel:"Skip",doneLabel:"Done",tooltipPosition:"bottom",tooltipClass:"",highlightClass:"",exitOnEsc:!0,exitOnOverlayClick:!0,showStepNumbers:!0,keyboardNavigation:!0,showButtons:!0,showBullets:!0,showProgress:!1,scrollToElement:!0,overlayOpacity:.8,positionPrecedence:["bottom","top","right","left"],disableInteraction:!1}}function i(t){var e=[],i=this;if(this._options.steps)for(var r=[],l=0,d=this._options.steps.length;l<d;l++){var h=n(this._options.steps[l]);if(h.step=e.length+1,"string"==typeof h.element&&(h.element=document.querySelector(h.element)),"undefined"==typeof h.element||null==h.element){var u=document.querySelector(".introjsFloatingElement");null==u&&(u=document.createElement("div"),u.className="introjsFloatingElement",document.body.appendChild(u)),h.element=u,h.position="floating"}null!=h.element&&e.push(h)}else{var r=t.querySelectorAll("*[data-intro]");if(r.length<1)return!1;for(var l=0,p=r.length;l<p;l++){var f=r[l],m=parseInt(f.getAttribute("data-step"),10);m>0&&(e[m-1]={element:f,intro:f.getAttribute("data-intro"),step:parseInt(f.getAttribute("data-step"),10),tooltipClass:f.getAttribute("data-tooltipClass"),highlightClass:f.getAttribute("data-highlightClass"),position:f.getAttribute("data-position")||this._options.tooltipPosition})}for(var g=0,l=0,p=r.length;l<p;l++){var f=r[l];if(null==f.getAttribute("data-step")){for(;;){if("undefined"==typeof e[g])break;g++}e[g]={element:f,intro:f.getAttribute("data-intro"),step:g+1,tooltipClass:f.getAttribute("data-tooltipClass"),highlightClass:f.getAttribute("data-highlightClass"),position:f.getAttribute("data-position")||this._options.tooltipPosition}}}}for(var y=[],v=0;v<e.length;v++)e[v]&&y.push(e[v]);if(e=y,e.sort(function(t,e){return t.step-e.step}),i._introItems=e,_.call(i,t)){a.call(i);t.querySelector(".introjs-skipbutton"),t.querySelector(".introjs-nextbutton");i._onKeyDown=function(e){if(27===e.keyCode&&1==i._options.exitOnEsc)s.call(i,t),void 0!=i._introExitCallback&&i._introExitCallback.call(i);else if(37===e.keyCode)o.call(i);else if(39===e.keyCode)a.call(i);else if(13===e.keyCode){var n=e.target||e.srcElement;n&&n.className.indexOf("introjs-prevbutton")>0?o.call(i):n&&n.className.indexOf("introjs-skipbutton")>0?s.call(i,t):a.call(i),e.preventDefault?e.preventDefault():e.returnValue=!1}},i._onResize=function(){c.call(i,document.querySelector(".introjs-helperLayer")),c.call(i,document.querySelector(".introjs-tooltipReferenceLayer"))},window.addEventListener?(this._options.keyboardNavigation&&window.addEventListener("keydown",i._onKeyDown,!0),
window.addEventListener("resize",i._onResize,!0)):document.attachEvent&&(this._options.keyboardNavigation&&document.attachEvent("onkeydown",i._onKeyDown),document.attachEvent("onresize",i._onResize))}return!1}function n(t){if(null==t||"object"!=typeof t||"undefined"!=typeof t.nodeType)return t;var e={};for(var i in t)e[i]=n(t[i]);return e}function r(t){this._currentStep=t-2,"undefined"!=typeof this._introItems&&a.call(this)}function a(){if(this._direction="forward","undefined"==typeof this._currentStep?this._currentStep=0:++this._currentStep,this._introItems.length<=this._currentStep)return"function"==typeof this._introCompleteCallback&&this._introCompleteCallback.call(this),void s.call(this,this._targetElement);var t=this._introItems[this._currentStep];"undefined"!=typeof this._introBeforeChangeCallback&&this._introBeforeChangeCallback.call(this,t.element),p.call(this,t)}function o(){if(this._direction="backward",0===this._currentStep)return!1;var t=this._introItems[--this._currentStep];"undefined"!=typeof this._introBeforeChangeCallback&&this._introBeforeChangeCallback.call(this,t.element),p.call(this,t)}function s(t){var e=t.querySelector(".introjs-overlay");if(null!=e){e.style.opacity=0,setTimeout(function(){e.parentNode&&e.parentNode.removeChild(e)},500);var i=t.querySelector(".introjs-helperLayer");i&&i.parentNode.removeChild(i);var n=t.querySelector(".introjs-tooltipReferenceLayer");n&&n.parentNode.removeChild(n);var r=t.querySelector(".introjs-disableInteraction");r&&r.parentNode.removeChild(r);var a=document.querySelector(".introjsFloatingElement");a&&a.parentNode.removeChild(a);var o=document.querySelector(".introjs-showElement");o&&(o.className=o.className.replace(/introjs-[a-zA-Z]+/g,"").replace(/^\s+|\s+$/g,""));var s=document.querySelectorAll(".introjs-fixParent");if(s&&s.length>0)for(var l=s.length-1;l>=0;l--)s[l].className=s[l].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");window.removeEventListener?window.removeEventListener("keydown",this._onKeyDown,!0):document.detachEvent&&document.detachEvent("onkeydown",this._onKeyDown),this._currentStep=void 0}}function l(t,e,i,n){var r,a,o,s="";if(e.style.top=null,e.style.right=null,e.style.bottom=null,e.style.left=null,e.style.marginLeft=null,e.style.marginTop=null,i.style.display="inherit","undefined"!=typeof n&&null!=n&&(n.style.top=null,n.style.left=null),this._introItems[this._currentStep]){r=this._introItems[this._currentStep],s="string"==typeof r.tooltipClass?r.tooltipClass:this._options.tooltipClass,e.className=("introjs-tooltip "+s).replace(/^\s+|\s+$/g,"");var s=this._options.tooltipClass;currentTooltipPosition=this._introItems[this._currentStep].position,"auto"!=currentTooltipPosition&&"auto"!=this._options.tooltipPosition||"floating"!=currentTooltipPosition&&(currentTooltipPosition=d.call(this,t,e,currentTooltipPosition));var l=y(t),h=y(e).height,c=m();switch(currentTooltipPosition){case"top":e.style.left="15px",e.style.top="-"+(h+10)+"px",i.className="introjs-arrow bottom";break;case"right":e.style.left=y(t).width+20+"px",l.top+h>c.height&&(i.className="introjs-arrow left-bottom",e.style.top="-"+(h-l.height-20)+"px"),i.className="introjs-arrow left";break;case"left":1==this._options.showStepNumbers&&(e.style.top="15px"),l.top+h>c.height?(e.style.top="-"+(h-l.height-20)+"px",i.className="introjs-arrow right-bottom"):i.className="introjs-arrow right",e.style.right=l.width+20+"px";break;case"floating":i.style.display="none",a=y(e),e.style.left="50%",e.style.top="50%",e.style.marginLeft="-"+a.width/2+"px",e.style.marginTop="-"+a.height/2+"px","undefined"!=typeof n&&null!=n&&(n.style.left="-"+(a.width/2+18)+"px",n.style.top="-"+(a.height/2+18)+"px");break;case"bottom-right-aligned":i.className="introjs-arrow top-right",e.style.right="0px",e.style.bottom="-"+(y(e).height+10)+"px";break;case"bottom-middle-aligned":o=y(t),a=y(e),i.className="introjs-arrow top-middle",e.style.left=o.width/2-a.width/2+"px",e.style.bottom="-"+(a.height+10)+"px";break;case"bottom-left-aligned":case"bottom":default:e.style.bottom="-"+(y(e).height+10)+"px",e.style.left=y(t).width/2-y(e).width/2+"px",i.className="introjs-arrow top"}}}function d(t,e,i){var n=this._options.positionPrecedence.slice(),r=m(),a=y(e).height+10,o=y(e).width+20,s=y(t),l="floating";return s.left+o>r.width||s.left+s.width/2-o<0?(h(n,"bottom"),h(n,"top")):(s.height+s.top+a>r.height&&h(n,"bottom"),s.top-a<0&&h(n,"top")),s.width+s.left+o>r.width&&h(n,"right"),s.left-o<0&&h(n,"left"),n.length>0&&(l=n[0]),i&&"auto"!=i&&n.indexOf(i)>-1&&(l=i),l}function h(t,e){t.indexOf(e)>-1&&t.splice(t.indexOf(e),1)}function c(t){if(t){if(!this._introItems[this._currentStep])return;var e=this._introItems[this._currentStep],i=y(e.element),n=10;"floating"==e.position&&(n=0),window.innerHeight==i.top&&(i.top=i.top+11),i.is_overflow?t.setAttribute("style","width: "+(i.width+n)+"px; height:"+(i.height+n)+"px; top:"+(i.top+26)+"px;left: "+(i.left-5)+"px;"):t.setAttribute("style","width: "+(i.width+n)+"px; height:"+(i.height+n)+"px; top:"+(i.top-5)+"px;left: "+(i.left-5)+"px;")}}function u(){var t=document.querySelector(".introjs-disableInteraction");null===t&&(t=document.createElement("div"),t.className="introjs-disableInteraction",this._targetElement.appendChild(t)),c.call(this,t)}function p(t){"undefined"!=typeof this._introChangeCallback&&this._introChangeCallback.call(this,t.element);var e=this,i=document.querySelector(".introjs-helperLayer"),n=document.querySelector(".introjs-tooltipReferenceLayer"),r="introjs-helperLayer";y(t.element);if("string"==typeof t.highlightClass&&(r+=" "+t.highlightClass),"string"==typeof this._options.highlightClass&&(r+=" "+this._options.highlightClass),null!=i){var d=n.querySelector(".introjs-helperNumberLayer"),h=n.querySelector(".introjs-tooltiptext"),p=n.querySelector(".introjs-arrow"),_=n.querySelector(".introjs-tooltip"),b=n.querySelector(".introjs-skipbutton"),w=n.querySelector(".introjs-prevbutton"),x=n.querySelector(".introjs-nextbutton");if(i.className=r,_.style.opacity=0,_.style.display="none",null!=d){var k=this._introItems[t.step-2>=0?t.step-2:0];(null!=k&&"forward"==this._direction&&"floating"==k.position||"backward"==this._direction&&"floating"==t.position)&&(d.style.opacity=0)}c.call(e,i),c.call(e,n);var L=document.querySelectorAll(".introjs-fixParent");if(L&&L.length>0)for(var C=L.length-1;C>=0;C--)L[C].className=L[C].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");var T=document.querySelector(".introjs-showElement");T.className=T.className.replace(/introjs-[a-zA-Z]+/g,"").replace(/^\s+|\s+$/g,""),e._lastShowElementTimer&&clearTimeout(e._lastShowElementTimer),e._lastShowElementTimer=setTimeout(function(){null!=d&&(d.innerHTML=t.step),h.innerHTML=t.intro,_.style.display="block",l.call(e,t.element,_,p,d),n.querySelector(".introjs-bullets li > a.active").className="",n.querySelector('.introjs-bullets li > a[data-stepnumber="'+t.step+'"]').className="active",n.querySelector(".introjs-progress .introjs-progressbar").setAttribute("style","width:"+v.call(e)+"%;"),_.style.opacity=1,d&&(d.style.opacity=1),x.tabIndex===-1?b.focus():x.focus()},350)}else{var $=document.createElement("div"),M=document.createElement("div"),P=document.createElement("div"),D=document.createElement("div"),S=document.createElement("div"),I=document.createElement("div"),E=document.createElement("div"),U=document.createElement("div");$.className=r,M.className="introjs-tooltipReferenceLayer",c.call(e,$),c.call(e,M),this._targetElement.appendChild($),this._targetElement.appendChild(M),P.className="introjs-arrow",S.className="introjs-tooltiptext",S.innerHTML=t.intro,I.className="introjs-bullets",this._options.showBullets===!1&&(I.style.display="none");for(var O=document.createElement("ul"),C=0,j=this._introItems.length;C<j;C++){var A=document.createElement("li"),z=document.createElement("a");z.onclick=function(){e.goToStep(this.getAttribute("data-stepnumber"))},C===t.step-1&&(z.className="active"),z.href="javascript:void(0);",z.innerHTML="&nbsp;",z.setAttribute("data-stepnumber",this._introItems[C].step),A.appendChild(z),O.appendChild(A)}I.appendChild(O),E.className="introjs-progress",this._options.showProgress===!1&&(E.style.display="none");var B=document.createElement("div");if(B.className="introjs-progressbar",B.setAttribute("style","width:"+v.call(this)+"%;"),E.appendChild(B),U.className="introjs-tooltipbuttons",this._options.showButtons===!1&&(U.style.display="none"),D.className="introjs-tooltip",D.appendChild(S),D.appendChild(I),D.appendChild(E),1==this._options.showStepNumbers){var R=document.createElement("span");R.className="introjs-helperNumberLayer",R.innerHTML=t.step,M.appendChild(R)}D.appendChild(P),M.appendChild(D);var x=document.createElement("a");x.onclick=function(){e._introItems.length-1!=e._currentStep&&a.call(e)},x.href="javascript:void(0);",x.innerHTML=this._options.nextLabel;var w=document.createElement("a");w.onclick=function(){0!=e._currentStep&&o.call(e)},w.href="javascript:void(0);",w.innerHTML=this._options.prevLabel;var b=document.createElement("a");b.className="introjs-button introjs-skipbutton",b.href="javascript:void(0);",b.innerHTML=this._options.skipLabel,b.onclick=function(){e._introItems.length-1==e._currentStep&&"function"==typeof e._introCompleteCallback&&e._introCompleteCallback.call(e),e._introItems.length-1!=e._currentStep&&"function"==typeof e._introExitCallback&&e._introExitCallback.call(e),s.call(e,e._targetElement)},U.appendChild(b),this._introItems.length>1&&(U.appendChild(w),U.appendChild(x)),D.appendChild(U),l.call(e,t.element,D,P,R)}this._options.disableInteraction===!0&&u.call(e),w.removeAttribute("tabIndex"),x.removeAttribute("tabIndex"),0==this._currentStep&&this._introItems.length>1?(w.className="introjs-button introjs-prevbutton introjs-disabled",w.tabIndex="-1",x.className="introjs-button introjs-nextbutton",b.innerHTML=this._options.skipLabel):this._introItems.length-1==this._currentStep||1==this._introItems.length?(b.innerHTML=this._options.doneLabel,w.className="introjs-button introjs-prevbutton",x.className="introjs-button introjs-nextbutton introjs-disabled",x.tabIndex="-1"):(w.className="introjs-button introjs-prevbutton",x.className="introjs-button introjs-nextbutton",b.innerHTML=this._options.skipLabel),x.focus(),t.element.className+=" introjs-showElement";var F=f(t.element,"position");"absolute"!==F&&"relative"!==F&&(t.element.className+=" introjs-relativePosition");for(var N=t.element.parentNode;null!=N&&"body"!==N.tagName.toLowerCase();){var H=f(N,"z-index"),q=parseFloat(f(N,"opacity")),G=f(N,"transform")||f(N,"-webkit-transform")||f(N,"-moz-transform")||f(N,"-ms-transform")||f(N,"-o-transform");(/[0-9]+/.test(H)||q<1||"none"!==G)&&(N.className+=" introjs-fixParent"),N=N.parentNode}if(!g(t.element)&&this._options.scrollToElement===!0){var W=t.element.getBoundingClientRect(),Z=m().height,V=W.bottom-(W.bottom-W.top),Y=W.bottom-Z;V<0||t.element.clientHeight>Z?window.scrollBy(0,V-30):window.scrollBy(0,Y+100)}"undefined"!=typeof this._introAfterChangeCallback&&this._introAfterChangeCallback.call(this,t.element)}function f(t,e){var i="";return t.currentStyle?i=t.currentStyle[e]:document.defaultView&&document.defaultView.getComputedStyle&&(i=document.defaultView.getComputedStyle(t,null).getPropertyValue(e)),i&&i.toLowerCase?i.toLowerCase():i}function m(){if(void 0!=window.innerWidth)return{width:window.innerWidth,height:window.innerHeight};var t=document.documentElement;return{width:t.clientWidth,height:t.clientHeight}}function g(t){var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom+80<=window.innerHeight&&e.right<=window.innerWidth}function _(t){var e=document.createElement("div"),i="",n=this;if(e.className="introjs-overlay","body"===t.tagName.toLowerCase())i+="top: 0;bottom: 0; left: 0;right: 0;position: fixed;",e.setAttribute("style",i);else{var r=y(t);r&&(i+="width: "+r.width+"px; height:"+r.height+"px; top:"+r.top+"px;left: "+r.left+"px;",e.setAttribute("style",i))}return t.appendChild(e),e.onclick=function(){1==n._options.exitOnOverlayClick&&void 0!=n._introExitCallback&&n._introExitCallback.call(n)},setTimeout(function(){i+="opacity: "+n._options.overlayOpacity.toString()+";",e.setAttribute("style",i)},10),!0}function y(t){x&&(k=t);var e={};e.width=t.offsetWidth,e.height=t.offsetHeight;for(var i=0,n=0;t&&!isNaN(t.offsetLeft)&&!isNaN(t.offsetTop);)i+=t.offsetLeft,n+=t.offsetTop,t=t.offsetParent;e.is_overflow=!1;var r=0,a=0;$("#layerContainer").children().each(function(t){$(this).attr("id")==$(k).closest("div").attr("id")&&(a=t)});for(var o=a;o<$("#layerContainer").children().length;o++){var s=$("#layerContainer").children()[o];o!=$("#layerContainer").children().length-1&&(r+=$(s).next().height())}return n>window.innerHeight-48?($("#featureListPanelBorder").scrollTop($("#layerContainer").height()),n=window.innerHeight-r-48-31,e.is_overflow=!0):n<$("#layerContainer").height()&&$("#featureListPanelBorder").scrollTop(0),e.top=n,e.left=i,e}function v(){var t=parseInt(this._currentStep+1,10);return t/this._introItems.length*100}function b(t,e){var i={};for(var n in t)i[n]=t[n];for(var n in e)i[n]=e[n];return i}var w="1.0.0",x=!0,k="",L=function(t){if("object"==typeof t)return new e(t);if("string"==typeof t){var i=document.querySelector(t);if(i)return new e(i);throw new Error("There is no element with given selector.")}return new e(document.body)};return L.version=w,L.fn=e.prototype={clone:function(){return new e(this)},setOption:function(t,e){return this._options[t]=e,this},setOptions:function(t){return this._options=b(this._options,t),this},start:function(){return i.call(this,this._targetElement),this},goToStep:function(t){return r.call(this,t),this},nextStep:function(){return a.call(this),this},previousStep:function(){return o.call(this),this},exit:function(){return s.call(this,this._targetElement),this},refresh:function(){return c.call(this,document.querySelector(".introjs-helperLayer")),c.call(this,document.querySelector(".introjs-tooltipReferenceLayer")),this},onbeforechange:function(t){if("function"!=typeof t)throw new Error("Provided callback for onbeforechange was not a function");return this._introBeforeChangeCallback=t,this},onchange:function(t){if("function"!=typeof t)throw new Error("Provided callback for onchange was not a function.");return this._introChangeCallback=t,this},onafterchange:function(t){if("function"!=typeof t)throw new Error("Provided callback for onafterchange was not a function");return this._introAfterChangeCallback=t,this},oncomplete:function(t){if("function"!=typeof t)throw new Error("Provided callback for oncomplete was not a function.");return this._introCompleteCallback=t,this},onexit:function(t){if("function"!=typeof t)throw new Error("Provided callback for onexit was not a function.");return this._introExitCallback=t,this}},t.introJs=L,L}),function(t){t.positionFixed=function(i){return t(i).each(function(){new e(this)}),i},t.fn.positionFixed=function(){return t.positionFixed(this)};var e=t.positionFixed.impl=function(e){var i=this;i.sts={target:t(e).css("position","fixed"),container:t(window)},i.sts.currentCss={top:i.sts.target.css("top"),right:i.sts.target.css("right"),bottom:i.sts.target.css("bottom"),left:i.sts.target.css("left")},i.ie6&&i.bindEvent()};t.extend(e.prototype,{bindEvent:function(){var t=this;t.sts.target.css("position","absolute"),t.overRelative().initBasePos(),t.sts.target.css(t.sts.basePos),t.sts.container.scroll(t.scrollEvent()).resize(t.resizeEvent()),t.setPos()},overRelative:function(){var e=this,i=e.sts.target.parents().filter(function(){if("relative"==t(this).css("position"))return this});return i.size()>0&&i.after(e.sts.target),e},initBasePos:function(){var t=this;return t.sts.basePos={top:t.sts.target.offset().top-("auto"==t.sts.currentCss.top?t.sts.container.scrollTop():0),left:t.sts.target.offset().left-("auto"==t.sts.currentCss.left?t.sts.container.scrollLeft():0)},t},setPos:function(){var t=this;t.sts.target.css({top:t.sts.container.scrollTop()+t.sts.basePos.top,left:t.sts.container.scrollLeft()+t.sts.basePos.left})},scrollEvent:function(){var t=this;return function(){t.setPos()}},resizeEvent:function(){var t=this;return function(){setTimeout(function(){t.sts.target.css(t.sts.currentCss),t.initBasePos(),t.setPos()},1)}}})}(jQuery),jQuery(function(t){t("#footer").positionFixed()});var options={delay:3e3,auto:!1};Pop.prototype={addInfo:function(){$("#popTitle a").attr("href",this.url).html(this.title),$("#popIntro").html(this.intro)},showDiv:function(){$("#pop").slideDown(this.apearTime).delay(this.delay).fadeOut(400)},closeDiv:function(){$("#popClose").click(function(){$("#pop").hide()})}};var ReplyUtils=window.ReplyUtils=ReplyUtils||{};$(function(){function t(){$("#selected_reply_imgs .selected_feature_img").each(function(){$(this).closest("li").remove()}),$(".img-num").text("0")}function e(){$("#selected_reply_imgs").dragsort({dragSelector:"div",dragBetween:!1,placeHolderTemplate:"<li><div></div></li>"}).unbind().bind("click",function(t){$(t.target).hasClass("img_del")&&($(t.target).parent().parent().remove(),$(".img-num").text(parseInt($(".img-num").text())-1),9!=$(".img-num").text()&&$("#uploadifive-upload_reply_imgs").show())})}function i(t){if(null==ReplyUtils._replies||0==ReplyUtils._replies.length)return null;for(var e=0;e<ReplyUtils._replies.length;e++){var i=ReplyUtils._replies[e];if(i&&i.id==t)return i}return null}ReplyUtils._replies=[],ReplyUtils.init=function(n,r,a){function o(t){if(t)for(var e=0;e<ReplyUtils._map.reply_templates.length;e++)if(ReplyUtils._map.reply_templates[e].id==t)return ReplyUtils._map.reply_templates[e];return null}function s(t){var i=null;if(t&&(i=o(t)),i){var n=d(i);$("#reply_fields").empty().append(n),e()}}function l(t){for(var e="",i=0;i<t.length;i++){var n=t[i];e+='<p class="dt-mar12t reply-field-row">',e+='<span class="dt-f14 dt-show dt-truncate" style="margin-top:6px;margin-bottom: 2px;" data-field-id="'+n.id+'">'+n.field+"</span>";var r="\u8bf7\u8f93\u5165\u6587\u672c";n.type==MapUtils.TemplateFieldType.NUMERIC&&(r="\u8bf7\u8f93\u5165\u6570\u503c"),e+='<textarea class="form-control" data-type="'+n.field_type+'" style="resize: none;height:34px;" placeholder="'+r+'"></textarea>',e+="</p>",e+="</div>"}return e}function d(e,i){if(null==e)return"";t(),$("#uploadifive-upload_reply_imgs").show(),$(".upload-reply-imgs").removeClass("dt-none"),$(".upload-reply-imgs").unbind().click(function(){$(".upload-panel").hasClass("dt-none")?$(".upload-panel").removeClass("dt-none"):$(".upload-panel").addClass("dt-none")}),$(".close-upload-img-panel").unbind().click(function(){$(".upload-panel").addClass("dt-none")});var n="";if(i){var r=i;if(r.attrs=[],e){var a,o={};for(a=0;a<e.fields.length;a++)o[e.fields[a].id]=e.fields[a];for(a=0;a<i.content.length;a++){var s=i.content[a].id,d=i.content[a].value,h=o[s];h&&r.attrs.push({id:h.id,field:h.field,type:h.field_type,value:d})}}n=$("#replyFields").render(r)}else e.fields?(n+='<div style="max-height:340px;overflow-y: auto;">',n+='<table class="table"><tbody>',n+=l(e.fields),n+="</tbody></table>",n+="</div>"):n+='<textarea class="reply-body form-control dt-w500" style="resize: none;" />';return n}var h=a.is_edit||!1,c=a.panelHeight||"100%";ReplyUtils._map=n,ReplyUtils._layersHashMap=r;var u=null,p=null;$(document).on("show.reply_panel",function(t,e,i,n){u=i,p=n,null!=u&&null!=p&&($("#newReplyModal").data("marker_id",u),ReplyUtils._replies=[],MapUtils.ajax2server(replies_url,"get",{mid:mid,marker_id:u,key:map_key},function(t){function e(t){!$(t.target).parents(".reply-panel").length>0&&!$(t.target).parents(".show-HD-images").length>0&&($(document).unbind("click",e),$(".reply-panel").animate({right:-600}))}$("#reply_list").empty().height($("#mapContainer").height()-76),t.replies&&f(t.replies),$(".reply-panel").animate({right:0}),$(document).on("click",e)}))}),$("#reply_close").unbind().click(function(){$(".reply-panel").animate({right:-600})});var f=function(t){if(null==t||0==t.length)return void $("#reply_list").prepend("<div class='dt-mar12t text-center img-no-reply'></div>");for(var e=ReplyUtils._map.reply_templates,i=0;i<e.length;i++)for(var n=e[i],r=0;r<t.length;r++){var a=t[r];a.template_id==n.id&&(a.currentTemplate_has_geo=n.has_geo)}ReplyUtils._replies=t;var o={};o.mapUsers=ReplyUtils._map.cooperation;var s=ReplyUtils._layersHashMap.get("m_"+p);s&&s.cooperation&&(o.layerUsers=s.cooperation);var l=PermissionUtils.loginUserRole(user_phone,o),d=["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458","\u56fe\u5c42\u6210\u5458"].indexOf(l)!=-1,u="";u="undefined"==typeof loginUser?$("#repliesTemplate").render({replies:t,is_edit:h,can_edit:d,login_user:""}):$("#repliesTemplate").render({replies:t,is_edit:h,can_edit:d,login_user:loginUser.id}),$("#reply_list").prepend(u),$(".reply-panel").height(c);for(var i=0;i<t.length;i++)$("#reply_imgs_"+i+" img").openHDimgs();$(".remove-reply").popover(),$(".remove-reply").unbind().click(function(){var t=$(this).attr("reply-id"),e=$(this).attr("marker-id");ReplyUtils._replyId=t;var i={marker_id:e,id:t};PromptInfo.xcConfirm("\u5220\u9664\u540e\u6570\u636e\u4e0d\u53ef\u6062\u590d\uff0c\u786e\u5b9a\u5220\u9664\u8be5\u52a8\u6001\uff1f",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){MapUtils.ajax2server(reply_destroy_url,"DELETE",i,function(t){200==t.status&&($("#reply_"+ReplyUtils._replyId).remove(),delete ReplyUtils._replyId)})}})}),$(".update-reply").unbind().click(function(){var t=$(this).attr("reply-id");t&&($("#saveReply").data("reply-id",parseInt(t)),$("#newReplyModal").data("type","update").modal("show"))})};if($(".reply-edit").unbind().click(function(t){var e=$(t.target).data("reply-id");e&&$("#newReplyModal").data("reply-id",e).data("type","update").modal("show")}),$("#reply_add").unbind().click(function(){$("#newReplyModal").data("type","new").modal("show")}),"undefined"!=typeof reply_upload_url){var m={width:80,height:80,buttonText:"",buttonClass:"add-reply-img pull-left dt-pointer",multi:!0,auto:!0,fileSizeLimit:"10MB",uploadScript:reply_upload_url,formData:{user_phone:user_phone}};$("#upload_reply_imgs").uploadReplyImg(m),$("#uploadifive-upload_reply_imgs input").addClass("dt-pointer")}$("#select_new_reply_template").unbind().click(function(t){var e=$(t.target).closest("li").attr("template-id");s(e)}),$("#newReplyModal").unbind().on("shown.bs.modal",function(){$("#uploadifive-upload_reply_imgs-queue").empty();var n=$("#newReplyModal").data("type"),r="",a=null;if("new"==n){$("#newReplyModal .modal-title").text("\u65b0\u589e\u52a8\u6001"),$("#select_new_reply_template").empty();$.each(ReplyUtils._map.reply_templates,function(t,e){var i="";ReplyUtils._map.default_template_id==e.id&&(i="active");var n=ReplyUtils._map.reply_templates.length;1==n?$("#select_new_reply_template").append("<li role='presentation' class='"+i+"' template-id='"+e.id+"' style='margin-bottom:0;'><a href='#template_"+e.id+"' aria-controls='template_"+e.id+"' role='tab' data-toggle='tab'>"+e.name+"</a></li>"):$("#select_new_reply_template").append("<li role='presentation' class='"+i+"' template-id='"+e.id+"' style='width:"+100/n+"%;margin-bottom:0;'><a href='#template_"+e.id+"' aria-controls='template_"+e.id+"' role='tab' data-toggle='tab'>"+e.name+"</a></li>")}),$("#reply_templates").show(),ReplyUtils._map.default_template_id&&(a=o(ReplyUtils._map.default_template_id)),null==a&&(a=ReplyUtils._map.reply_templates[0],$("#select_new_reply_template li:first-child").addClass("active")),a&&(r+=d(a))}else{$("#newReplyModal .modal-title").text("\u66f4\u65b0\u52a8\u6001"),$("#reply_templates").hide();var s=$("#saveReply").data("reply-id"),l=i(s);l&&(a=o(l.template_id),a&&(r+=d(a,l)),$.each(l.imgs,function(t,e){$(".add-reply-img").before(MapUtils.uploadImgStyle(e))}),$(".img-num").text(l.imgs.length),$("#selected_reply_imgs .selected_feature_img").length>=9&&$("#uploadifive-upload_reply_imgs").hide())}$("#reply_fields").empty().append(r),$(".upload-panel").addClass("dt-none"),e(),$("#saveReply").unbind().click(function(){for(var e={},i={},r=[],a=$(".reply-field-row"),o=0;o<a.length;o++){var s=$(a[o]),l=s.find("span").attr("data-field-id"),d=s.find("span").text(),h=s.find("textarea").val(),c=s.find("textarea").attr("data-type");if(c==MapUtils.TemplateFieldType.NUMERIC&&h.length>0&&!$.isNumeric(h))return PromptInfo.xcConfirm(" "+d+"\u5b57\u6bb5\uff0c\u53ea\u80fd\u8f93\u5165\u6570\u503c\u5185\u5bb9",PromptInfo.xcConfirm.typeEnum.error,{onOk:function(){s.find("textarea").focus()}}),!1;0==h.trim().length?r.push(!0):r.push(!1),i[l.toString()]=h}var f=r.indexOf(!1)<0;if(f)return void PromptInfo.xcConfirm("\u52a8\u6001\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a",PromptInfo.xcConfirm.typeEnum.info);var m=[];if($("#selected_reply_imgs .selected_feature_img").each(function(){m.push($(this).attr("img_id"))}),m.length>9)return void PromptInfo.xcConfirm("\u6700\u591a\u53ea\u80fd\u4e0a\u4f209\u5f20\u56fe\u7247",PromptInfo.xcConfirm.typeEnum.error);if("new"==n)e={marker_id:u,content:JSON.stringify(i),img_ids:m},e.template_id=$("#select_new_reply_template").find(".active").attr("template-id"),MapUtils.ajax2server(reply_create_url,"POST",e,function(t){$("#newReplyModal").modal("hide").find("#reply_fields").empty(),$(document).trigger("show.reply_panel",[t,u,p])},function(){PromptInfo.xcConfirm("\u65b0\u589e\u52a8\u6001\u5931\u8d25",PromptInfo.xcConfirm.typeEnum.error)});else{var g=$(this).data("reply-id");e={marker_id:u,id:g,content:JSON.stringify(i),img_ids:m},MapUtils.ajax2server(reply_update_url,"PUT",e,function(t){$("#newReplyModal").modal("hide").find("#reply_fields").empty(),$(document).trigger("show.reply_panel",[t,u,p])},function(){PromptInfo.xcConfirm("\u4fee\u6539\u52a8\u6001\u5931\u8d25",PromptInfo.xcConfirm.typeEnum.error)})}t()})})}});var FayeUtils=window.FayeUtils=FayeUtils||{};$(function(){var t=null;FayeUtils.flag_start_parse=!1,FayeUtils.flag_record_sum=100,FayeUtils.init=function(t,e,i){i=i||{},FayeUtils._map=i.map,FayeUtils._hashMap=i.hashMap,FayeUtils._allMarker=i.allMarker,new Faye.Client(t).subscribe(e,function(t){if("s"==t.status){var e=t.type;switch(e){case"createMarker":var i=FayeUtils._hashMap.get("m_"+t.marker.marker_layer_id),n=i.display,r=MarkerUtils.checkRole(i);if(!r)return;if(FayeUtils.flag_start_parse){var a=parseInt($("#loadingdataCurrent").text())+1;$("#loadingdataCurrent").text(a);var o=Math.round(a/FayeUtils.flag_record_sum*100);$("#dataparseprogress").text(o+"%").css("width",o+"%")}MapUtils.addLayerAttrs(t.marker,FayeUtils._hashMap),$("#dataListClose").trigger("click");var s=$("#upload_data_"+t.marker.marker_layer_id);if(0!=s.length&&s.remove(),t.marker.delayed||null==i)return;if(i.render_style&&2==i.render_style&&FayeUtils._map.dt_heatmap[t.marker.marker_layer_id]){var l=FayeUtils._map.dt_heatmap[t.marker.marker_layer_id][1],d=FayeUtils._map.dt_heatmap[t.marker.marker_layer_id][2],h=MarkerUtils.markerJson2Marker(t.marker,i);MarkerUtils.addMarker2HashMap(h.layer_id,h),h.display&&l.push(MarkerUtils.generateHeatmapPoint(h,d.field));var c=FayeUtils._map.dt_heatmap[t.marker.marker_layer_id][0];if(null!=c){var u={max:d.max,data:l};c.setData(u),FayeUtils._map.dt_heatmap[t.marker.marker_layer_id]=[c,l,d]}0==$("#heatmap_layer_contain_"+t.marker.marker_layer_id).length&&$("#marker_layer_"+t.marker.marker_layer_id+" ul.list-unstyled").before(MarkerUtils.heatmap_div(i))}else if(i.render_style&&4==i.render_style){for(var p=0;p<t.marker.marker_attrs.length;p++){var f=t.marker.marker_attrs[p];if(t.marker.uniform_title==f.key){t.marker.title=f.value||"";break}}var h=MarkerUtils.markerJson2Marker(t.marker,i);MarkerUtils.addMarker2HashMap(h.layer_id,h),"show"==n&&FayeUtils._map.addOverlay(h),t.marker.is_upload===!1&&user_phone==t.marker.user.phone&&(h.enableEditing(),BInfowindow.open(h,{status:"edit"})),FayeUtils._map.dt_text_overlay[t.marker.marker_layer_id]=!0}else{var h=MarkerUtils.addMarker2Map(t.marker,!1);t.marker.is_upload===!1&&user_phone==t.marker.user.phone&&(h.enableEditing(),BInfowindow.open(h,{status:"edit"})),FayeUtils._map.dt_marker[t.marker.marker_layer_id]=!0}if("-9999"!=t.marker.lng&&"-9999"!=t.marker.lat&&$("#marker_layer_"+t.marker.marker_layer_id+" ul").append(MarkerUtils.marker_div(t.marker,i)),"none"==$("#dataLoading").css("display")&&"none"==$("#commonLoading").css("display")&&($("#marker_layer_"+t.marker.marker_layer_id+" .select_marker").css("background-color","none"),$("#select_marker_"+t.marker.id).css("background-color","#f1f1f1")),$("#featureCount").text(parseInt($("#featureCount").text())+1),i.monitors){var h=i.getMarker(t.marker.id);MonitorUtils.getOverlayMonitor(i,h,"marker",!1),$("#popIntro").children().length>0&&($("#pop").slideDown(400),$("#popClose").unbind().click(function(){$("#pop").slideUp(400),$("#popIntro").children().empty()}))}break;case"createMarkers":var i=FayeUtils._hashMap.get("m_"+t.layer_id),r=MarkerUtils.checkUploadRole(i);if(!r)return;var s=$("#upload_data_"+t.layer_id);0!=s.length&&s.remove();var m=t.markers;if(i&&i.render_style&&2==i.render_style&&FayeUtils._map.dt_heatmap[t.layer_id]){for(var l=FayeUtils._map.dt_heatmap[t.layer_id][1],d=FayeUtils._map.dt_heatmap[t.layer_id][2],g=0;g<m.length;g++){var h=MarkerUtils.markerJson2Marker(m[g],i);MarkerUtils.addMarker2HashMap(h.layer_id,h),h.display&&l.push(MarkerUtils.generateHeatmapPoint(h,d.field))}var c=FayeUtils._map.dt_heatmap[t.layer_id][0];if(null!=c){var u={max:d.max,data:l};c.setData(u),FayeUtils._map.dt_heatmap[t.layer_id]=[c,l,d]}}else for(var g=0;g<m.length;g++)!m[g]||"undefined"==m[g]&&"null"==m[g]||("-9999"!=m[g].lng&&"-9999"!=m[g].lat&&$("#marker_layer_"+t.layer_id+" ul").append(MarkerUtils.marker_div(m[g],i)),MarkerUtils.addMarker2Map(m[g],!1));$("#featureCount").text(parseInt($("#featureCount").text())+m.length);break;case"updateMarker":var _=t.marker.marker_layer_id,i=FayeUtils._hashMap.get("m_"+_),r=MarkerUtils.checkUpdateRole(i,"overlay",{overlay_id:t.marker.id});if(!r)return;if(MarkerUtils.updateMarkerToMap(t.marker),t.marker.delayed)return;if(t.marker.display){$("#marker_icon_"+t.marker.id).remove(),2!=i.render_style&&$("#heatmap_layer_contain_"+_).hide();var y=MarkerUtils.markerIconHtml(t.marker,i);$("#select_marker_"+t.marker.id).prepend(y).show()}else $("#select_marker_"+t.marker.id).hide();break;case"updateMarkers":var i=FayeUtils._hashMap.get("m_"+t.layer_id),r=MarkerUtils.checkUploadRole(i);if(!r)return;if(2==i.render_style&&FayeUtils._map.dt_heatmap[t.layer_id]){for(var m=t.markers,l=FayeUtils._map.dt_heatmap[t.layer_id][1],d=FayeUtils._map.dt_heatmap[t.layer_id][2],g=0;g<m.length;g++){var h=i.getMarker(m[g].id);if(null!=l){var v=1;null!=d.field&&(v=MapUtils.get_attr_value(h.attrs,d.field)),$.isNumeric(v)||(v=1);for(var b=0;b<l.length;b++)if(l[b].id==h.id){h.display?l.push(geopoint):l.splice(b,1);break}}}var c=FayeUtils._map.dt_heatmap[t.layer_id][0];if(null!=c){var u={max:d.max,data:l};c.setData(u),FayeUtils._map.dt_heatmap[t.layer_id]=[c,l,d]}}$(".btn-reset-filter").trigger("click");break;case"destroyMarker":var i=FayeUtils._hashMap.get("m_"+t.marker.marker_layer_id);if(i&&i.isCategorized()){var w=i.vectors;if(w)for(var x=0;x<w.length;x++)t.marker.id==w[x].feature_id&&FayeUtils._map.removeOverlay(w[x])}if(i&&2==i.render_style&&FayeUtils._map.dt_heatmap[t.marker.marker_layer_id]){for(var l=FayeUtils._map.dt_heatmap[t.marker.marker_layer_id][1],d=FayeUtils._map.dt_heatmap[t.marker.marker_layer_id][2],b=0;b<l.length;b++)if(l[b].id==t.marker.id){l.splice(b,1),BInfowindow.close();break}var c=FayeUtils._map.dt_heatmap[t.marker.marker_layer_id][0];if(null!=c){var u={max:d.max,data:l};c.setData(u),FayeUtils._map.dt_heatmap[t.marker.marker_layer_id]=[c,l,d]}}else if(i&&i.isCluster()&&FayeUtils._map.dt_clusterer[t.marker.marker_layer_id]){var k=FayeUtils._map.dt_clusterer[t.marker.marker_layer_id],h=i.getMarker(t.marker.id);h&&t.marker.id==h.feature_id&&BInfowindow.close(),k.removeLayer(h)}if(MarkerUtils.deleteMarkerFromMap(t.marker),i&&i.getMarkers().getSize()>0&&(FayeUtils._allMarker.remove(t.marker.id),i.removeMarker(t.marker.id)),i&&$("#featureCount").text(parseInt($("#featureCount").text())-1),$(".dt-data-list").is(":visible")){$("#dataListClose").trigger("click");var d={layer:i,map:FayeUtils._map,type:"marker"},L="markerDataList_"+i.id;$("#"+L).openDataList(d)}$(".btn-reset-filter").trigger("click");break;case"createMarkerLayer":var C=PermissionUtils.loginUserRole(user_phone,{mapUsers:FayeUtils._map.cooperation});if(["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458"].indexOf(C)==-1)return!1;t.marker_layer.type="marker_layer";var T=MapUtils.createLayer(t.marker_layer);FayeUtils._hashMap.put("m_"+t.marker_layer.id,T),LocalSearch.setLayersHashMap(FayeUtils._hashMap),$("#layerContainer").append(MarkerUtils.marker_layer_div(t.marker_layer)),$("#layerSize").text(parseInt($("#layerSize").text())+1),
$("#marker_layer_"+t.marker_layer.id).attr("data-marker-title",t.marker_layer.uniform_title),$("#marker_layer_"+t.marker_layer.id).find(".layer-hover").removeClass("layer-hover").addClass("active-layer"),MapUtils.reloadTooltip();break;case"destroyMarkerLayer":FayeUtils._hashMap.remove("m_"+t.marker_layer.id),$("#marker_layer_"+t.marker_layer.id).remove();break;case"updateMarkerLayer":var _=t.marker_layer.id,i=FayeUtils._hashMap.get("m_"+_),M=i.render_style,r=MarkerUtils.checkUpdateRole(i,"layer"),P=i.getHeatmapConfig();if(!r)return;if($("#permission_"+t.marker_layer.id).find(".layer-title").text(t.marker_layer.title),$("#marker_layer_"+_).attr("data-show-fields",t.marker_layer.show_fields).attr("data-marker-title",t.marker_layer.uniform_title),$("#layer_title_"+_).attr("title",t.marker_layer.title).text(t.marker_layer.title),null==i)return;if(i.update(t.marker_layer),1==i.render_style)M!=i.render_style&&FayeUtils._clearMarkers(i),FayeUtils._showCanvasMarker(i);else if(2==i.render_style){var D=P.gradient!=t.marker_layer.heatmap_config.gradient||P.radius!=t.marker_layer.heatmap_config.radius||P.max!=t.marker_layer.heatmap_config.max||P.field!=t.marker_layer.heatmap_config.field;FayeUtils._showHeatmap(i,D)}else 0==i.render_style||6==i.render_style||5==i.render_style?(2==M?FayeUtils._clearHeatmap(t.marker_layer.id):M!=i.render_style&&FayeUtils._clearMarkers(i),FayeUtils._showNormalMarker(i)):4==i.render_style&&FayeUtils._showTextOverlay(i);break;case"updateMap":$("#map-title-bar").text(t.map.title),$("#map-desc-bar").text(null!=t.map.description?t.map.description:"");break;case"startParseData":var i=FayeUtils._hashMap.get("m_"+t.layer_id),r=MarkerUtils.checkUploadRole(i);if(!r)return;$("#"+t.layer_id+"_panel").hide(),FayeUtils.flag_start_parse=!0,FayeUtils.flag_record_sum=t.sum,$("#loadingdatasum").text(t.sum),$("#loadingdataCurrent").text(0),$("#dataparseprogress").text(0),$("#dataLoading").modal("show");break;case"failedParseData":PromptInfo.xcConfirm(t.msg,PromptInfo.xcConfirm.typeEnum.error),$("#dataLoading").modal("hide");break;case"finishedParseData":var i=FayeUtils._hashMap.get("m_"+t.layer_id),r=MarkerUtils.checkUploadRole(i);if(!r)return;$("#"+t.layer_id+"_panel").show(),FayeUtils.flag_start_parse=!1,$("#dataLoading").modal("hide"),$("#loadingdataCurrent").text("0"),$("#dataparseprogress").text("0%").css("width","0%"),$("#loadeddatasum").text(t.sum),$("#loadeddataCurrent").text(t.success_data),$("#loadedErrorData").text(t.error_data),0==t.error_data?$("#show_error_data_list").hide():($("#show_error_data_list").show(),$("#show_error_data_list").attr("href",t.error_file_url)),$("#show_error_data_list").attr("data-layer-id",t.layer_id),$("#dataLoaded").modal("show"),parseInt(t.imgs_sum)>1&&$("#imgs_tips").text("\u8fd8\u6709"+t.imgs_sum+"\u5f20\u56fe\u7247\u6b63\u5728\u540e\u53f0\u5bfc\u5165\uff0c\u60a8\u53ef\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\u3002").show();break;case"finishedLoadImgs":MapUtils.operatingNotice(t.msg,{expire:1e3});break;case"createRegionLayer":t.region_layer.type="region_layer";var S=MapUtils.createLayer(t.region_layer);FayeUtils._hashMap.put("r_"+t.region_layer.id,S),LocalSearch.setLayersHashMap(FayeUtils._hashMap),$("#layerSize").text(parseInt($("#layerSize").text())+1),$("#layerContainer").append(MapUtils.region_layer_div(t.region_layer)),MapUtils.reloadTooltip(),$("#select_bind_region").append("<option value='"+t.region_layer.id+"'>"+t.region_layer.title+"</option>"),$("#select_split_regions").append("<option value='"+t.region_layer.id+"'>"+t.region_layer.title+"</option>"),$("#region_layer_"+t.region_layer.id).find(".layer-hover").removeClass("layer-hover").addClass("active-layer");break;case"updateRegionLayer":var I=t.region_layer.id,i=FayeUtils._hashMap.get("r_"+I),r=RegionUtils.checkUpdateRole(i,"layer");if(!r)return;i&&i.update(t.region_layer),$("#region_layer_"+t.region_layer.id).attr("data-show-fields",t.region_layer.show_fields).attr("data-region-title",t.region_layer.uniform_title),$("#layer_title_"+t.region_layer.id).text(t.region_layer.title),$("#select_bind_region option[value="+t.region_layer.id+"]").attr("title",t.region_layer.title).text(t.region_layer.title),$("#select_split_regions option[value="+t.region_layer.id+"]").attr("title",t.region_layer.title).text(t.region_layer.title);var n=i.getLayerDisplay();if(i.isCategorized()){var E={mid:mid,id:I,field:"",is_categorized:!0};MapUtils.ajax2server(get_category_region_layer_url,"GET",E,function(t){$("#region_category_details_"+t.id).remove();var e="<ul id='region_category_details_"+t.id+"' class='dt-pad12x dt-pad12y dt-none'>";if(t.categories.length>0)for(var i=0;i<t.categories.length;i++){var r=t.categories[i];e+=CategoryUtils.getCategoryHtmlToRegionLayer(r,t.id)}else e+=MapUtils.load_region_btn_html(I);e+="</ul>",$("#region_layer_"+t.id).append(e),$("#region_category_details_"+I+" li").unbind().mouseenter(function(t){$(t.currentTarget).find(".edit_category").show()}).mouseleave(function(t){$(t.currentTarget).find(".edit_category").hide()}),CategoryUtils.handleEvent("click","#region_category_details_"+t.id),$("#region_layer_"+t.id).find("ul").hide(),"show"==n?$("#region_category_details_"+I).show():$("#region_category_details_"+I).hide()})}else{var U=i.getRegions().values();U&&0==U.length&&$("#region_layer_"+I).find("ul").html(MapUtils.load_region_btn_html(I)),$("#region_category_details_"+I).remove(),"show"==n?$("#region_layer_"+I).find("ul").show():$("#region_layer_"+I).find("ul").hide()}break;case"destroyRegionLayer":FayeUtils._hashMap.remove("r_"+t.region_layer.id),$("#region_layer_"+t.region_layer.id).remove(),$("#select_bind_region option[value="+t.region_layer.id+"]").remove(),$("#select_split_regions option[value="+t.region_layer.id+"]").remove();break;case"createRegion":var i=FayeUtils._hashMap.get("r_"+t.region.region_layer_id),r=RegionUtils.checkRole(i);if(!r)return;$("#dataListClose").trigger("click"),MapUtils.addLayerAttrs(t.region,FayeUtils._hashMap);var O=RegionUtils.addRegion2Map(t.region,i.display,!1);!t.region.is_upload&&t.region.is_add&&user_phone==t.region.user.phone&&$(document).trigger("dt.select.region",[O,{status:"edit"}]);var j="#load_region_btn_"+t.region.region_layer_id;$(j).remove();var A="#add_district_"+t.region.region_layer_id;$(A).remove();var z="#region_layer_"+t.region.region_layer_id+" ul";$(z).append(MapUtils.region_div(t.region)),$("#featureCount").text(parseInt($("#featureCount").text())+1);var B=MapUtils.RGB2Hex(t.region.region_style.fillColor.substring(1,7)),R=t.region.region_style.fillOpacity,F=t.region.region_style.strokeWeight;parseInt(F)>5&&(F="5");var N=$("#regionStyle_"+t.region.id);if(N.css("background-color","rgba("+B[0]+", "+B[1]+", "+B[2]+", "+R+")"),N.css("border",F+"px solid"+t.region.region_style.strokeColor),i.monitors){var O=i.getRegion(t.region.id);MonitorUtils.getOverlayMonitor(i,O,"line",!1),$("#popIntro").children().length>0&&($("#pop").slideDown(400),$("#popClose").unbind().click(function(){$("#pop").slideUp(400),$("#popIntro").children().empty()}))}break;case"updateRegion":var i=FayeUtils._hashMap.get("r_"+t.region.region_layer_id),r=RegionUtils.checkUpdateRole(i,"overlay",{overlay_id:t.region.id});if(!r)return;RegionUtils.updateHashMapDataRegion(t.region),MapUtils.setRegionTitle(t.region);var B=MapUtils.RGB2Hex(t.region.region_style.fillColor.substring(1,7)),R=t.region.region_style.fillOpacity,F=t.region.region_style.strokeWeight;F>5&&(F=5);var H=MapUtils.RGB2Hex(t.region.region_style.strokeColor.substring(1,7)),q=t.region.region_style.strokeOpacity,N=$("#regionStyle_"+t.region.id);N.css("background-color","rgba("+B[0]+", "+B[1]+", "+B[2]+", "+R+")"),N.css("border",F+"px solid rgba("+H[0]+", "+H[1]+", "+H[2]+", "+q+")"),RegionUtils.updateRegionInMap(t.region),$(".btn-reset-filter").trigger("click");break;case"destroyRegion":var i=RegionUtils.layersHashMap.get("r_"+t.region.region_layer_id);if(i){var O=i.getRegion(t.region.id);O["delete"](),i.monitors&&MonitorUtils.removeMonitor(O),BInfowindow.close(O),i.removeRegion(t.region.id)}$("#li_region_id_"+t.region.id).remove(),$("#featureCount").text(parseInt($("#featureCount").text())-1);var G=$("#region_layer_"+t.region.region_layer_id).find("ul");if(0==G.children().length&&G.append(MapUtils.load_region_btn_html(t.region.region_layer_id)),$(".dt-data-list").is(":visible")){$("#dataListClose").trigger("click");var d={layer:i,map:FayeUtils._map,type:"region"},L="regionDataList_"+i.id;$("#"+L).openDataList(d)}$(".btn-reset-filter").trigger("click");break;case"createLineLayer":var C=PermissionUtils.loginUserRole(user_phone,{mapUsers:FayeUtils._map.cooperation});if(["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458"].indexOf(C)==-1)return!1;t.line_layer.type="line_layer";var W=MapUtils.createLayer(t.line_layer);FayeUtils._hashMap.put("l_"+t.line_layer.id,W),LocalSearch.setLayersHashMap(FayeUtils._hashMap),$("#layerSize").text(parseInt($("#layerSize").text())+1),$("#layerContainer").append(MapUtils.line_layer_div(t.line_layer)),$("#line_layer_"+t.line_layer.id).find(".layer-hover").removeClass("layer-hover").addClass("active-layer"),MapUtils.reloadTooltip();break;case"createLine":var i=FayeUtils._hashMap.get("l_"+t.line.line_layer_id),r=LineUtils.checkRole(i);if(!r)return;$("#dataListClose").trigger("click"),MapUtils.addLayerAttrs(t.line,FayeUtils._hashMap);var Z=LineUtils.addLine2Map(t.line,i.display,!1);!t.line.is_upload&&t.line.is_add&&user_phone==t.line.user.phone&&$(document).trigger("dt.select.line",[Z,{status:"edit"}]);var j="#load_line_btn_"+t.line.line_layer_id;$(j).remove();var z="#line_layer_"+t.line.line_layer_id+" .list-unstyled";$(z).append(MapUtils.line_div(t.line));var F=t.line.line_style.strokeWeight,H=MapUtils.RGB2Hex(t.line.line_style.strokeColor.substring(1,7)),q=t.line.line_style.strokeOpacity;if($("#lineStyle_"+t.line.id).css("border","4px solid rgba("+H[0]+", "+H[1]+", "+H[2]+", "+q+")"),$("#featureCount").text(parseInt($("#featureCount").text())+1),i.monitors){var Z=i.getLine(t.line.id);MonitorUtils.getOverlayMonitor(i,Z,"line",!1),$("#popIntro").children().length>0&&($("#pop").slideDown(400),$("#popClose").unbind().click(function(){$("#pop").slideUp(400),$("#popIntro").children().empty()}))}break;case"updateLineLayer":var V=t.line_layer.id,i=LineUtils.layersHashMap.get("l_"+V),r=LineUtils.checkUpdateRole(i,"layer");if(!r)return;i&&i.update(t.line_layer),$("#line_layer_"+t.line_layer.id).attr("data-show-fields",t.line_layer.show_fields).attr("data-line-title",t.line_layer.uniform_title),$("#layer_title_"+t.line_layer.id).attr("title",t.line_layer.title).text(t.line_layer.title);var n=i.getLayerDisplay();if(i.isCategorized()){var E={mid:mid,id:V,field:"",is_categorized:!0};MapUtils.ajax2server(get_category_line_layer_url,"GET",E,function(t){$("#line_category_details_"+t.id).remove();var e="<ul id='line_category_details_"+t.id+"' class='dt-pad12x dt-pad12y dt-none'>";if(t.categories.length>0)for(var i=0;i<t.categories.length;i++){var r=t.categories[i];e+=CategoryUtils.getCategoryHtmlToLineLayer(r,t.id)}else e+=MapUtils.load_line_btn_html(V);e+="</ul>",$("#line_layer_"+t.id).append(e),$("#line_category_details_"+V+" li").unbind().mouseenter(function(t){$(t.currentTarget).find(".edit_category").show()}).mouseleave(function(t){$(t.currentTarget).find(".edit_category").hide()}),CategoryUtils.handleEvent("click","#line_category_details_"+t.id),$("#line_layer_"+t.id).find("ul").hide(),"show"==n?$("#line_category_details_"+V).show():$("#line_category_details_"+V).hide()})}else{var Y=i.getLines().values();Y&&0==Y.length&&$("#line_layer_"+V).find("ul").html(MapUtils.load_line_btn_html(V)),$("#line_category_details_"+V).remove(),"show"==n?$("#line_layer_"+V).find("ul").show():$("#line_layer_"+V).find("ul").hide()}break;case"updateLine":var i=FayeUtils._hashMap.get("l_"+t.line.line_layer_id),r=LineUtils.checkUpdateRole(i,"overlay",{overlay_id:t.line.id});if(!r)return;LineUtils.updateHashMapDataLine(t.line),MapUtils.setLineTitle(t.line);var F=t.line.line_style.strokeWeight,H=MapUtils.RGB2Hex(t.line.line_style.strokeColor.substring(1,7)),q=t.line.line_style.strokeOpacity;t.line.line_style.strokeStyle;$("#lineStyle_"+t.line.id).css("border","4px solid"+t.line.line_style.strokeColor),$("#lineStyle_"+t.line.id).css("background-color","rgba("+H[0]+", "+H[1]+", "+H[2]+", "+q+")"),LineUtils.updateLineInMap(t.line),$(".btn-reset-filter").trigger("click");break;case"destroyLineLayer":FayeUtils._hashMap.remove("l_"+t.line_layer.id),$("#line_layer_"+t.line_layer.id).remove();break;case"destroyLine":var i=LineUtils.layersHashMap.get("l_"+t.line.line_layer_id);if(i){var Z=i.getLine(t.line.id);Z&&(Z["delete"](),i.monitors&&MonitorUtils.removeMonitor(Z),BInfowindow.close(Z),i.removeLine(t.line.id))}$("#li_line_id_"+t.line.id).remove(),$("#featureCount").text(parseInt($("#featureCount").text())-1);var X=$("#line_layer_"+t.line.line_layer_id).find("ul");if(0==X.children().length&&X.append("<a id='load_line_btn_"+t.line.line_layer_id+"' class='load_line' line_layer_id='"+t.line.line_layer_id+"' href='javascript:void(0);'><span class='glyphicon glyphicon-upload'></span>\u5bfc\u5165\u7ebf\u8def\u6570\u636e</a>"),$(".dt-data-list").is(":visible")){$("#dataListClose").trigger("click");var d={layer:i,map:FayeUtils._map,type:"line"},L="lineDataList_"+i.id;$("#"+L).openDataList(d)}$(".btn-reset-filter").trigger("click");break;case"startLoading":if(t.opts&&t.opts.id){var r=!1,i=null;switch(t.opts.layer_type){case"MarkerLayer":i=FayeUtils._hashMap.get("m_"+t.opts.id),r=MarkerUtils.checkUpdateRole(i,"layer");break;case"LineLayer":i=FayeUtils._hashMap.get("l_"+t.opts.id),r=LineUtils.checkUpdateRole(i,"layer");break;case"RegionLayer":i=FayeUtils._hashMap.get("r_"+t.opts.id),r=RegionUtils.checkUpdateRole(i,"layer")}if(!r)return}$("#commonLoading").modal("show");break;case"finishedLoading":if(t.opts&&t.opts.id){var r=!1,i=null;switch(t.opts.layer_type){case"MarkerLayer":i=FayeUtils._hashMap.get("m_"+t.opts.id),r=MarkerUtils.checkUpdateRole(i,"layer");break;case"LineLayer":i=FayeUtils._hashMap.get("l_"+t.opts.id),r=LineUtils.checkUpdateRole(i,"layer");break;case"RegionLayer":i=FayeUtils._hashMap.get("r_"+t.opts.id),r=RegionUtils.checkUpdateRole(i,"layer")}if(!r)return}if($("#commonLoading").modal("hide"),null!=t.opts)switch(t.opts.flag){case"reloadDatatable":FayeUtils._reloadDatatable(t.opts.id,t.opts.layer_type);break;case"alertCalFinished":setTimeout(function(){$("#alertCalFinished").modal("show")},150)}break;case"failedLoading":$("#commonLoading").modal("hide"),t.opts&&t.opts.msg&&PromptInfo.xcConfirm(t.opts.msg,PromptInfo.xcConfirm.typeEnum.error)}}else MapUtils.operatingNotice(t.msg,{expire:1e3})})},FayeUtils._clearCluster=function(t){null!=FayeUtils._map.dt_clusterer[t]&&FayeUtils._map.dt_clusterer[t].clearLayers()},FayeUtils._clearHeatmap=function(t){null!=FayeUtils._map.dt_heatmap[t]&&(FayeUtils._map.removeOverlay(FayeUtils._map.dt_heatmap[t][0]),FayeUtils._map.dt_heatmap[t]=null)},FayeUtils._showCanvasMarker=function(t){var e=t.id,i=t.getLayerDisplay();FayeUtils._clearCluster(e),FayeUtils._clearHeatmap(e);var n=t.getMarkers().values();if(n&&n.length>0){var r=t.getCanvasConfig();r=MapUtils.getCanvasStyle(r);for(var a="",o=0;o<n.length;o++){var s=n[o];if(s.display&&(a=MarkerUtils.markerIconHtml(s,t),$("#marker_icon_"+s.feature_id).remove(),$("#select_marker_"+s.feature_id).prepend(a)),FayeUtils._map.hasLayer(s))s.setStyle(r),"show"==t.display&&s.display||s.remove();else{var l=MarkerUtils.markerJson2Marker(s.obj,t);t.setMarker(l),"show"==t.display&&s.display&&l.addTo(FayeUtils._map)}}}$("#heatmap_layer_contain_"+e).hide(),"show"==i?$("#marker_layer_"+e).find("ul").first().show():$("#marker_layer_"+e).find("ul").last().hide(),$("#marker_category_details_"+e).hide()},FayeUtils._clearMarkers=function(t){for(var e=t.getMarkers().values(),i=0;i<e.length;i++){var n=e[i];n.remove()}},FayeUtils._showHeatmap=function(t,e){var i=t.id,n=t.getLayerDisplay(),r=t.getMarkers().values();FayeUtils._clearCluster(i);var a=null,o=t.getHeatmapConfig();if("undefined"==typeof FayeUtils._map.dt_heatmap[i]||null==FayeUtils._map.dt_heatmap[i]||e){var s=o.field,l=o.max;null==l&&(l=2);var d=[];if(r&&r.length>0)for(var h=0;h<r.length;h++)FayeUtils._map.removeOverlay(r[h]),r[h].display&&d.push(MarkerUtils.generateHeatmapPoint(r[h],s));var c=MarkerUtils.heatmapConfig(o.gradient,o.radius,t.id),u={radius:c.radius,maxOpacity:.8,scaleRadius:!1,latField:"lat",lngField:"lng",valueField:"count",gradient:c.gradient},a=new HeatmapOverlay(u),p={max:l,data:d};FayeUtils._clearHeatmap(i),a.setData(p),FayeUtils._map.dt_heatmap[i]=[a,d,{max:l,field:s,config:c}],"show"==n&&a.addTo(FayeUtils._map),$(".heatmap-canvas").parent().css("height",0)}$("#marker_layer_"+i+" ul").hide(),$("#marker_category_details_"+i).hide();var f=$("#heatmap_layer_contain_"+i);"show"==n?(0==f.length&&$("#marker_layer_"+i+" ul.list-unstyled").before(MarkerUtils.heatmap_div(t)),f.show()):f.hide()},FayeUtils._showNormalMarker=function(t){var e=t.id;FayeUtils._clearCluster(e);var i=t.getLayerDisplay(),n=t.getMarkers().values();if(t.isCluster()&&FayeUtils._showCluster(t,n),t.isCategorized()){var r={id:e,field:"",is_categorized:!0};MapUtils.ajax2server(get_category_marker_layer_url,"GET",r,function(i){var n=t.getLayerDisplay();$("#marker_category_details_"+i.id).remove();var r="dt-none",a="<ul id='marker_category_details_"+i.id+"' class='dt-pad12x dt-pad12y "+r+"'>";if(i.categories.length>0)for(var o=0;o<i.categories.length;o++){var s=i.categories[o];a+=CategoryUtils.getCategoryHtmlToMarkerLayer(s,i.id)}else a+=MapUtils.add_upload_file(i.id);a+="</ul>",$("#marker_layer_"+i.id).append(a),$("#marker_category_details_"+i.id+" li").unbind().mouseenter(function(t){$(t.currentTarget).find(".edit_category").show()}).mouseleave(function(t){$(t.currentTarget).find(".edit_category").hide()}),CategoryUtils.handleEvent("click","#marker_category_details_"+i.id),$("#heatmap_layer_contain_"+e).hide(),$("#marker_layer_"+e).find("ul").hide(),"show"==n?$("#marker_category_details_"+e).show():$("#marker_category_details_"+e).hide()})}else n&&0==n.length&&0==$("#marker_layer_"+e).find("ul").length&&$("#marker_layer_"+e).find("ul").html(MapUtils.add_upload_file(e)),"show"==i?$("#marker_layer_"+e).find("ul").show():$("#marker_layer_"+e).find("ul").hide(),$("#marker_category_details_"+e).remove()},FayeUtils._showCluster=function(t,e){if(e&&0!=e.length){var i=t.id,n=L.markerClusterGroup({spiderfyOnMaxZoom:!1,disableClusteringAtZoom:18});FayeUtils._clearMarkers(t);for(var r=$("#marker_layer_"+i).find("ul").children(),a="",o=t.getLabelConfig(),s=0;s<e.length;s++){var l=e[s];l.display&&(l instanceof Dtwy.CanvasMarker?(l=MarkerUtils.markerJson2Marker(l.obj,t),t.setMarker(l)):FayeUtils._map.removeLayer(l),l.label_field=o.field,l.label_style_type=o.style_type,MapUtils.addLabelToOverlay(l,!0),n.addLayer(l),$("#marker_icon_"+l.feature_id).attr("src",l.getIcon().iconUrl),0==r.length&&(a+=MarkerUtils.marker_div(l,t)))}FayeUtils._map.dt_clusterer[i]=n,"show"==t.display&&FayeUtils._map.addLayer(n),0==r.length&&$("#marker_layer_"+i).find("ul").append(a)}},FayeUtils._addNormalMarkersToMap=function(e,i){if(i&&0!=i.length){for(var n=[],r=e.id,a=$("#marker_layer_"+r).find("ul").children(),o="",s=e.getLabelConfig(),l=0;l<i.length;l++)if(i[l].display){i[l].label_field=s.field,i[l].label_style_type=s.style_type,n.push(i[l]),$("#marker_icon_"+i[l].feature_id).remove();var d="<img class='select_marker' marker-id='"+i[l].feature_id+"' id='marker_icon_"+i[l].feature_id+"' src='"+i[l].getIcon().iconUrl+"'/>";$("#select_marker_"+i[l].feature_id).prepend(d),0==a.length&&(o+=MarkerUtils.marker_div(i[l],e))}0==a.length&&$("#marker_layer_"+r).find("ul").append(o),n.length>0&&(t&&(window.clearInterval(t),t=null),t=window.setInterval(function(){var i=n.shift();i&&e.getMarker(i.feature_id)&&"show"==e.display&&(MapUtils.addLabelToOverlay(i,!1),i.addTo(FayeUtils._map)),0==n.length&&(window.clearInterval(t),t=null,$("#operate-status").text("\u5df2\u4fdd\u5b58"))},5))}},FayeUtils._showTextOverlay=function(e){var i=e.id,n=e.getMarkers().values();FayeUtils._clearHeatmap(i),FayeUtils._clearCluster(i),n=MarkerUtils.markers2RichMarkers(n,i);var r=[],a=e.getLayerDisplay();if(n&&n.length>0&&"show"==e.display)for(var o="",s=$("#marker_layer_"+i).find("ul").children(),l=e.getTextConfig(),d=MapUtils.getTextFontFamily(l.font),h=0;h<n.length;h++)if(n[h].display&&"show"==a&&(n[h]._map&&n[h].setContent(MarkerUtils.createTextHtml(l,n[h].title,d)),n[h].remove(),r.push(n[h]),o='<img marker-id="'+n[h].feature_id+'" class="select_marker" id="marker_icon_'+n[h].feature_id+'" src="'+n[h].getIcon().iconUrl+'">',$("#marker_icon_"+n[h].feature_id).remove(),$("#select_marker_"+n[h].feature_id).prepend(o),0==s.length)){var c=MarkerUtils.marker_div(n[h],e);$("#marker_layer_"+i).find("ul").append(c)}r.length>0&&(t&&(window.clearInterval(t),t=null),t=window.setInterval(function(){var e=r.shift();FayeUtils._map.addOverlay(e),0==r.length&&(window.clearInterval(t),t=null,$("#operate-status").text("\u5df2\u4fdd\u5b58"),setTimeout(function(){$(".leaflet-text-icon").css({width:"auto",height:"auto"})},5))},5)),$("#heatmap_layer_contain_"+i).hide(),$("#marker_layer_"+i).find("ul").hide();var a=e.getLayerDisplay();"show"==a&&$("#marker_layer_"+i).find("ul").first().show()},FayeUtils._reloadDatatable=function(t,e){var i,n;switch(e){case"MarkerLayer":n=FayeUtils._hashMap.get("m_"+t),i=$("#markerDataList_"+t);break;case"LineLayer":n=FayeUtils._hashMap.get("l_"+t),i=$("#lineDataList_"+t);break;case"RegionLayer":n=FayeUtils._hashMap.get("r_"+t),i=$("#regionDataList_"+t)}n&&0==n.getFeaturesCount()||i&&i.length>0&&setTimeout(function(){i.click()},150)}}),function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define(i):e[t]=i()}("LocationUtils",window,function(){"use strict";var t=600,e=0,i=null,n=new DT.HashMap,r=null,a=null,o=0,s=null,l=null,d=function(e,n){var d=["member_location","member_position"];$.when($.lazyGetTemplate(d)).done(function(){$.views.settings.allowCode=!0;var d=$.templates.member_location.render({id:e});$("#"+e).remove(),$("#mapInfoWrapper").append(d),n&&(l=n,n.location_timeout&&(t=parseInt(n.location_timeout)));var p=($(window).height()-48-32-20)/2,f=p-48;$(".offline-member,.online-member").css("max-height",p),$("#offline_members").css("max-height",p-32),$("#online_members").css("max-height",f),t=Math.max(60,t),faye_server&&channel_map_admin&&(r=faye_server,a=channel_map_admin),null==s&&r&&a&&(s=new Faye.Client(r).subscribe(a,function(t){if(1!=o)return!1;var e=t.type;switch(e){case"updateUserPosition":t.position?($("#offline_members #member_position_"+t.uid).length>0&&$("#online_members").append($("#member_position_"+t.uid)),h(t)):($("#online_members #member_position_"+t.uid).length>0&&$("#offline_members").append($("#member_position_"+t.uid)),c(t)),_()}})),o=1,u(),clearInterval(i),i=window.setInterval(function(){u()},1e3*t)})},h=function(t){var e=t.position,i=n.get(t.uid);if(null==e||""==e)i&&(n.remove(t.uid),l.removeOverlay(i));else{e=e.split(","),e=new L.latLng(e[1],e[0]);var r="<div class='dt-hidden' style='height:32px;min-width: 140px;'>";if(r+="<img src='"+oss_host+t.uavatar+"' height='32' width='32' style='-webkit-border-radius: 16px;-moz-border-radius: 16px;border-radius: 16px;float: left;' />",r+="<div style='font-size: 12px;border: 1px solid #00a8ff;color: #3e3e3e;padding: 2px;background-color: #fff;float: left;margin-left:8px;margin-top:2px;max-width: 100px;' class='dt-truncate'>"+t.uname+"</div>",r+="</div>",i)i.setPosition(e),i.setContent(r);else{var a=new L.divIcon({html:r,className:"leaflet-position-icon"});i=new Dtwy.Marker(e,{icon:a}),i.type="user",i.uid=t.uid,n.put(i.uid,i),i.addTo(l)}}},c=function(t){var e=n.get(t.uid);e&&e.remove(),n.remove(t.uid)},u=function(){return e>10?(clearInterval(i),void(i=null)):void MapUtils.ajax2server(get_member_positions_url,"GET",{},function(t){var i=t.user_positions,n=0,r=0;if(i)for(var a=0;a<i.length;a++){var o=i[a];o.position?($("#member_position_"+o.uid).length>0?$("#offline_members #member_position_"+o.uid).length>0&&$("#online_members").append($("#member_position_"+o.uid)):m(o),h(o),n++):($("#member_position_"+o.uid).length>0?($("#online_members #member_position_"+o.uid).length>0&&$("#offline_members").append($("#member_position_"+o.uid)),c(o)):g(o),r++)}$("#online_member_count").text(n),$("#offline_member_count").text(r),e=0},function(){e++})},p=function(){o=0,clearInterval(i),i=null,f()},f=function(){for(var t=n.values();t.length>0;){var e=t.pop();l.removeOverlay(e)}n.clear(),$(".member-position").remove()},m=function(t){var e=$.templates.member_position.render(t);$("#online_members").append(e),$("#online_members").unbind().click(function(t){var e=$(t.target).closest(".member-position").attr("id").split("_")[2],i=n.get(e);if(i){var r=i.getPosition();l.panTo(r,{animate:!0})}})},g=function(t){var e=$.templates.member_position.render(t);$("#offline_members").append(e)},_=function(){var t=$("#offline_members .member-position").length;$("#offline_member_count").text(t);var e=$("#online_members .member-position").length;$("#online_member_count").text(e)};return{init:d,close:p,clearUserMarkers:f}}),$.views.viewModels("FilterItem",{getters:["id","name","field_name","filter_type","custom","conditions"],extend:{operators:function(){return[{value:"eq",label:"\u7b49\u4e8e"},{value:"gt",label:"\u5927\u4e8e"},{value:"lt",label:"\u5c0f\u4e8e"},{value:"bt",label:"\u4ecb\u4e8e"},{value:"cn",label:"\u5305\u542b"},{value:"bt_date",label:"\u65e5\u671f\u8303\u56f4"}]}}}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery")):t(jQuery)}(function(t){var e=null,i=null,n=new Array,r={filter_callback:null,error_callback:null,reset_callback:null,filter_config:null,local_search:null,search_url:null,custom_params:{},none_text:"\u5168\u90e8",reset_text:"\u6e05\u9664\u7b5b\u9009\u6761\u4ef6"},a={init:function(a){function o(t,e,i){e.put(t.id,t);var n=t.id,a=t.name,o=t.filter_type,s="",l="";i.hasClass("select-more-item")&&(l="margin-top:12px;"),s+='<div class="filter-item filter-item-'+n+'" data-filter-id="'+n+'" data-filter-name="'+a+'" data-filter-type="'+o+'" style="'+l+'">',s+='<div class="select-box fl">',s+='<div class="select-title">',s+="<span>"+a+"</span>",s+="</div>",s+='<div class="select-items" style="display: none; width: auto;">',s+='<div class="item-sublist item-sublist-min fl" style="display: none;">',s+='<div class="select-item mgt5">',s+='<a href="javascript:void(0)" class="form-input">'+r.none_text+"</a>",s+="</div>";for(var d=t.conditions,h=0;h<d.length;h++){var c=d[h],u=c.operator;if(s+='<div class="select-item">',"bt"==u||"bt_date"==u){var p=c.value[0],f=c.value[1];s+='<a href="javascript:void(0)" class="form-input" data-operator="'+u+'" data-min="'+p+'" data-max=" '+f+' " title="'+c.name+'">'+c.name+"</a>"}else{var m=c.value[0];s+='<a href="javascript:void(0)" class="form-input" data-operator="'+u+'" data-value="'+m+'" title="'+c.name+'">'+c.name+"</a>"}s+="</div>"}s+="<div class='dt-hidden'>",s+="<a href='###' style='color:#0088cc' class='custom-btn'>\u81ea\u5b9a\u4e49</a>",s+="</div>",s+='<div class="select-item mgt5 custom-panel dt-none" id="filter_item_custom_'+t.id+'">',s+='<select class="form-control pull-left dt-w40 input-sm" style="margin-top: 3px;height: 24px;padding:2px">',s+='<option value="eq">=</option>',s+='<option value="gt">></option>',s+='<option value="lt"><</option>',s+='<option value="bt">>&nbsp;<</option>',s+='<option value="cn">in</option>',s+="</select>",s+='<p class="pull-left other-text-custom">',s+='<input type="text" class="input-int form-control input-sm text-custom" style="width:64px;margin-left:6px;height: 24px;padding: 2px;" maxlength="24" data-filter-id="'+n+'" value="">',s+="</p>",s+='<p class="pull-left bt-text-custom dt-none">',s+='<input type="text" class="input-int form-control input-sm text-custom text-custom-min" style="width:40px;height:24px;margin-left:6px;padding: 2px;" maxlength="24" data-filter-id="'+n+'">',s+="~",s+='<input type="text" class="input-int form-control input-sm text-custom text-custom-max" style="width:40px;height:24px;padding: 2px;" maxlength="24" data-filter-id="'+n+'">',s+="</p>",s+='<input type="button" value="\u786e\u5b9a" class="btn btn-default bth-sm button-custom dt-f12" style="display:none;height:24px;line-height:18px;width:32px;margin-left:6px;padding:3px;margin-top: -2px">',s+="</div>",s+="</div>",s+="</div>",s+="</div>",s+="</div>",i.append(s)}function s(){for(var i=[],n=[],a=e.find(".filter-item.filter-selected"),o=0;o<a.length;o++){var s=t(a[o]);if(s){var l=s.data("data-filter"),d=s.attr("data-filter-type");"feature"==d?l.value[0]&&i.push(l):"reply"==d&&n.push(l)}}var h={return_ids:!0};return i.length>0&&(h.feature_filters=JSON.stringify(i)),n.length>0&&(h.reply_filters=JSON.stringify(n)),r.custom_params&&(h=t.extend(h,r.custom_params)),h}function l(t){i=t,n.length>0&&(t.range=n.toString()),r.search_url&&MapUtils.ajax2server(r.search_url,"post",t,function(t){r.filter_callback&&r.filter_callback(t)},function(t){r.error_callback&&r.error_callback(t)})}function d(){for(var i=e.find(".filter-item"),n=0;n<i.length;n++){var a=t(i[n]),o=a.attr("data-filter-name");a.removeClass("filter-selected").data("data-filter",null).find(".select-title span").text(o)}t(".select-more").hide(),r.reset_callback&&r.reset_callback()}r=t.extend(r,a);var h=new DT.HashMap;if(e=t(this),e.empty(),r.filter_config)for(var c=0,u=0;u<r.filter_config.length;u++){var p=r.filter_config[u];if(0!=p.conditions.length){if(c<4)o(p,h,t(this));else{if(0==t(".filter-more").length){var f="";f+='<div class="filter-more">',f+='<div class="select-more-box fl">',f+='<div class="select-title">',f+="<span>\u66f4\u591a</span>",f+="</div>",f+='<div class="select-more" style="display: none; width: auto;">',f+='<div class="item-more fl" style="display: none;">',f+='<div class="select-more-item mgt5">',f+="</div>",e.append(f)}o(p,h,t(".select-more-item"))}c++}}return e.append('<a href="javascript:void(0)" class="btn-reset-filter dt-gray fl">'+r.reset_text+"</a>"),e.show(),t(window).click(function(e){0==t(e.target).closest(".select-items").length&&(t(".select-items").hide(),t(".button-custom").hide(),t(".select-more").hide(),t(".custom-panel").addClass("dt-none"))}),e.find(".select-box").hover(function(){t(".select-items").hide(),t(this).find(".select-items").show().find(".item-sublist").show(),t(".select-more").hide().find(".item-more").hide()},function(){}),e.find(".select-more-box").hover(function(){t(".select-items").hide(),t(this).find(".select-more").show().find(".item-more").show()},function(){}),e.unbind().click(function(e){if(!t(e.target).hasClass("btn-reset-filter")){t("select").unbind().change(function(){"bt"==t(this).val()?(t(".bt-text-custom").removeClass("dt-none"),t(".other-text-custom").addClass("dt-none")):(t(".bt-text-custom").addClass("dt-none"),t(".other-text-custom").removeClass("dt-none"))}),t(e.target).hasClass("custom-btn")&&(t(".custom-panel select").children().first().prop("selected",!0),t(".other-text-custom").removeClass("dt-none"),t(".bt-text-custom").addClass("dt-none"),t(".custom-panel").removeClass("dt-none"));var i=t(e.target).hasClass("text-custom");if(i)t(e.target).closest("div").find(".button-custom").show();else if(t(e.target).closest("div").hasClass("select-item")){if(t(e.target).is("select"))return;var n=t(e.target).closest(".filter-item"),a=n.attr("data-filter-id"),o=h.get(a),d=t(e.target).text();if("\u5168\u90e8"==d&&(d=n.attr("data-filter-name")),d==r.none_text?n.removeClass("filter-selected"):n.addClass("filter-selected"),t(e.target).hasClass("button-custom")){var c=t(e.target).closest(".custom-panel").find("select").val(),u="";"eq"==c?u=t(e.target).closest(".custom-panel").find(".other-text-custom input").val():"gt"==c?u=">"+t(e.target).closest(".custom-panel").find(".other-text-custom input").val():"lt"==c?u="<"+t(e.target).closest(".custom-panel").find(".other-text-custom input").val():"bt"==c?u=t(e.target).closest(".custom-panel").find(".bt-text-custom .text-custom-min").val()+"~"+t(e.target).closest(".custom-panel").find(".bt-text-custom .text-custom-max").val():"cn"==c&&(u="\u5305\u542b "+t(e.target).closest(".custom-panel").find(".other-text-custom input").val()),n.find(".select-title span").text(u);var p=null;if("bt"==c){var f=t(e.target).closest(".custom-panel").find(".bt-text-custom .text-custom-min").val(),m=t(e.target).closest(".custom-panel").find(".bt-text-custom .text-custom-max").val();if(0==f.trim().length)return void PromptInfo.xcConfirm("\u6700\u5c0f\u503c\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165...");
if(0==m.trim().length)return void PromptInfo.xcConfirm("\u6700\u5927\u503c\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165...");if(isNaN(f))return void PromptInfo.xcConfirm("\u6700\u5c0f\u503c\u53ea\u80fd\u8f93\u5165\u6570\u503c\u7c7b\u578b");if(isNaN(m))return void PromptInfo.xcConfirm("\u6700\u5927\u503c\u53ea\u80fd\u8f93\u5165\u6570\u503c\u7c7b\u578b");p=[f,m]}else p=[t(e.target).closest(".custom-panel").find(".other-text-custom input").val()]}else{n.find(".select-title span").text(d);var c=t(e.target).attr("data-operator"),p=null;if("bt"==c||"bt_date"==c){var f=t(e.target).attr("data-min"),m=t(e.target).attr("data-max");p=[f,m]}else p=[t(e.target).attr("data-value")]}var g=o.field_name,_=o.filter_type,y={field_name:g,filter_type:_,operator:c,value:p};n.data("data-filter",y);var v=s();l(v)}}}),t(".btn-reset-filter").unbind().click(d),e},setRange:function(t){for(var i=[],r=0;r<t.length;r++)i.push(t[r].feature_id);return n=i,e},destroy:function(){e&&e.empty()}};t.fn.DtFilter=function(e){return a[e]?a[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.DtFilter"):a.init.apply(this,arguments)}});var FilterPlugin=window.FilterPlugin=FilterPlugin||{};$(function(){FilterPlugin.init=function(t,e,i){var n=["filter_plugin","filter_item","filter_items","filter_condition_modal","filter_item_modal"];$.when($.lazyGetTemplate(n)).done(function(){e&&(FilterPlugin.map=e),i&&(FilterPlugin.layersHashMap=i),$.views.settings.allowCode=!0;var n=$.templates.filter_plugin.render({id:t});$("#"+t).remove(),$("#mapInfoWrapper").append(n);var r=$.templates.filter_condition_modal.render();$("#content").append(r),MapUtils.addFilterInfoWrapper(),$("#dtFilterPlugPanel").height($(window).height()-48),FilterPlugin.getFilterConfig(function(t){var e=t.filter_items;FilterPlugin.filter_items=e,$(".filter-item-condition").remove();var i={filter_items:e},n=$.templates.filter_items.render(i);$(".filter-config").append(n),FilterPlugin._bindFilterItemHandler(),FilterPlugin.showFilterControl(FilterPlugin.filter_items),$(".filter-config").dragsort({dragBetween:!1,dragSelectorExclude:"span.remove-filter,span.edit-filter",placeHolderTemplate:"<li class='placeHolder'></li>",dragEnd:FilterPlugin.sortFilterItems})}),$("#addFilterCondition").unbind().click(function(){FilterPlugin.createFieldCondition()}),$("#filterConditionModal").on("hide.bs.modal",function(){$("#submitFilterCondition").removeAttr("disabled"),$("#filterConditionModal").find("input").val(""),$(".filter-condition-name").focus(function(){$(".filter-condition-name").autocomplete()})})})},FilterPlugin.destroy=function(){$(".fixed-filter").DtFilter("destroy"),$(".filter-container").addClass("dt-none")},FilterPlugin.sortFilterItems=function(){var t=[];$.each($(".filter-config .filter-item"),function(e,i){t.push($(i).attr("data-filter-id"))});var e={mid:mid,filter_items:t};MapUtils.ajax2server(sort_filter_items_url,"POST",e,function(t){FilterPlugin.filter_items=t.filter_items,FilterPlugin.refreshFilterControl()})},FilterPlugin.refreshFilterControl=function(){FilterPlugin.showFilterControl(FilterPlugin.filter_items)},FilterPlugin.getFilterFields=function(){var t=[];$(".select-title").find("span").each(function(){t.push($(this).text())});for(var e=FilterPlugin.layersHashMap.values(),i=0;i<e.length;i++)for(var n=e[i],r=n.getAttrFields(),a=0;a<r.length;a++){var o=r[a];o&&o.field&&t.indexOf(o.field)==-1&&t.push(o.field)}return t},FilterPlugin.getFilterConfig=function(t){MapUtils.ajax2server(get_filter_config_url,"GET",{},function(e){t&&t(e.filter_config)})},FilterPlugin.createFilterItem=function(t,e,i,n){var r={mid:mid,filter_item:{field_name:t,filter_type:e,conditions:i}};MapUtils.ajax2server(filter_item_url,"POST",r,function(t){n&&n(t.filter_item)})},FilterPlugin.updateFilterItem=function(t,e,i,n,r){var a={mid:mid,filter_item:{field_name:e,filter_type:i,conditions:n}};MapUtils.ajax2server(filter_item_url+"/"+t,"PUT",a,function(t){r&&r(t.filter_item)})},FilterPlugin.destroyFilterItem=function(t,e){var i={mid:mid,id:t};MapUtils.ajax2server(filter_item_url+"/"+t,"DELETE",i,function(t){e&&e(t)})},FilterPlugin.createFilterCondition=function(t,e,i,n){var r={};r.name=FilterPlugin.generateFilterName(e,i),r.operator=e,r.value=i,FilterPlugin.createFilterItem(t,"feature",[r],n)},FilterPlugin.generateFilterName=function(t,e){var i="";switch(t){case"eq":i=e[0];break;case"gt":i="> "+e[0];break;case"lt":i="< "+e[0];break;case"bt":i=e[0]+" ~ "+e[1];break;case"cn":i="\u5305\u542b "+e[0];break;case"bt_date":i=e[0]+" ~ "+e[1]}return i},FilterPlugin.getFilterItem=function(t){for(var e=0;t&&e<FilterPlugin.filter_items.length;e++){var i=FilterPlugin.filter_items[e];if(i&&i.id==t)return i}return null},FilterPlugin.setFilterItem=function(t,e){for(var i=0;t&&i<FilterPlugin.filter_items.length;i++){var n=FilterPlugin.filter_items[i];if(n&&n.id==t)return void(FilterPlugin.filter_items[i]=e)}FilterPlugin.filter_items.push(e)},FilterPlugin.removeFilterItem=function(t){for(var e=0;t&&e<FilterPlugin.filter_items.length;e++){var i=FilterPlugin.filter_items[e];if(i&&i.id==t){FilterPlugin.filter_items.splice(e,1);break}}},FilterPlugin.showFilterControl=function(t){var e={search_url:advanced_filter_url,filter_config:t,custom_params:{key:map_key},reset_text:"\u6e05\u9664\u7b5b\u9009",filter_callback:MapUtils.showSearchFeatures,reset_callback:MapUtils.showAllFeatures,error_callback:function(){alert("\u8bf7\u6c42\u5931\u8d25")}};$(".filter-container").removeClass("dt-none"),$(".fixed-filter").DtFilter("init",e),1==$(".fixed-filter").children().length?$(".filter-container").addClass("dt-none"):$(".filter-container").removeClass("dt-none")},FilterPlugin._bindFilterItemHandler=function(){$(".select-box").unbind().hover(function(){$(this).find(".select-items").show().find(".item-sublist").show()},function(){$(this).find(".select-items").hide().find(".item-sublist").hide(),$(".button-custom").hide()}),$(".remove-filter").unbind().click(function(t){PromptInfo.xcConfirm("\u786e\u5b9a\u5220\u9664\u5f53\u524d\u7b5b\u9009\u9879\uff1f",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){var e=$(t.target).closest(".filter-item-condition").find(".filter-item").attr("data-filter-id");FilterPlugin.destroyFilterItem(e,function(t){t.msg.indexOf("\u6210\u529f")>=0&&(FilterPlugin.removeFilterItem(e),$(".filter-item-"+e).closest(".filter-item-condition").remove(),FilterPlugin.refreshFilterControl())})}})}),$(".edit-filter").unbind().click(function(t){var e=$(t.target).closest(".filter-item-condition").find(".filter-item").attr("data-filter-id");FilterPlugin.showEditModal(e)})},FilterPlugin.showEditModal=function(t){var e=FilterPlugin.getFilterItem(t);if(e){var i=$.views.viewModels.FilterItem.map(e),n=$.templates.filter_item_modal.render(i),r=$("#filterItemModal");r.length>0?r.replaceWith(n):$("#content").append(n),$("#filterItemModal").modal("show"),FilterPlugin.bindFilterConditionHandler(),$("#filterItemModal .modal-body").dragsort({dragSelector:"div",dragBetween:!1,dragSelectorExclude:"select,input,span.remove-filter-condition",placeHolderTemplate:"<div class='placeHolder'><div></div></div>"}),$(".remove-filter-condition").unbind().click(function(t){return 1==$("#filterItemModal .dt-filter-condition").length?void PromptInfo.xcConfirm("\u81f3\u5c11\u4fdd\u7559\u4e00\u6761\u7b5b\u9009\u6761\u4ef6",PromptInfo.xcConfirm.typeEnum.info):void $(t.target).closest(".dt-filter-condition").remove()}),$("#submitFilterItem").unbind().click(function(){for(var t=[],i=$("#filterItemModal .dt-filter-condition"),n=0;n<i.length;n++){var r=$(i[n]),a=r.find(".filter-condition").val(),o=FilterPlugin._getConditionValue(r);if("lt"==a||"gt"==a){if(o&&isNaN(o[0]))return void PromptInfo.xcConfirm("\u7b5b\u9009\u6761\u4ef6\u5fc5\u987b\u4e3a\u6570\u503c\u578b\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){r.find(".filter-condition-text").focus()}})}else if("bt"==a){if(o&&0==o[0].trim().length)return void PromptInfo.xcConfirm("\u7b5b\u9009\u6761\u4ef6\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){r.find(".filter-condition-min").focus()}});if(o&&0==o[1].trim().length)return void PromptInfo.xcConfirm("\u7b5b\u9009\u6761\u4ef6\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){r.find(".filter-condition-max").focus()}});if(o&&isNaN(o[0]))return void PromptInfo.xcConfirm("\u7b5b\u9009\u6761\u4ef6\u5fc5\u987b\u4e3a\u6570\u503c\u578b\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){r.find(".filter-condition-min").focus()}});if(o&&isNaN(o[1]))return void PromptInfo.xcConfirm("\u7b5b\u9009\u6761\u4ef6\u5fc5\u987b\u4e3a\u6570\u503c\u578b\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){r.find(".filter-condition-max").focus()}})}if(null==o)return;var s=FilterPlugin.generateFilterName(a,o);t.push({name:s,operator:a,value:o})}FilterPlugin.updateFilterItem(e.id,e.field_name,e.filter_type,t,function(t){$("#filterItemModal").modal("hide"),FilterPlugin._refreshFilterItem(t)})})}},FilterPlugin.createFieldCondition=function(){$("#filterConditionModal").modal("show"),FilterPlugin.bindFilterConditionHandler(),$("#submitFilterCondition").unbind().click(function(){var t=$(".filter-condition-name").val().trim();if(0==t.length)return void PromptInfo.xcConfirm("\u7b5b\u9009\u9879\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){$(".filter-condition-name").focus()}});if(t.length<2||t.length>16)return void PromptInfo.xcConfirm("\u7b5b\u9009\u9879\u540d\u79f0\u4e3a2~16\u4e2a\u5b57",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){$(".filter-condition-name").focus()}});var e=$(".filter-condition").val();if("lt"==e||"gt"==e){if(isNaN($(".filter-condition-text").val()))return void PromptInfo.xcConfirm("\u7b5b\u9009\u6761\u4ef6\u5fc5\u987b\u4e3a\u6570\u503c\u578b\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){$(".filter-condition-text").focus()}})}else if("bt"==e){if(0==$(".filter-condition-min").val().trim().length)return void PromptInfo.xcConfirm("\u7b5b\u9009\u6761\u4ef6\u4e0d\u80fd\u4e3a\u7a7a,\u8bf7\u91cd\u65b0\u8f93\u5165",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){$(".filter-condition-min").focus()}});if(0==$(".filter-condition-max").val().length)return void PromptInfo.xcConfirm("\u7b5b\u9009\u6761\u4ef6\u4e0d\u80fd\u4e3a\u7a7a,\u8bf7\u91cd\u65b0\u8f93\u5165",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){$(".filter-condition-max").focus()}});if(isNaN($(".filter-condition-min").val()))return void PromptInfo.xcConfirm("\u7b5b\u9009\u6761\u4ef6\u5fc5\u987b\u4e3a\u6570\u503c\u578b\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){$(".filter-condition-min").focus()}});if(isNaN($(".filter-condition-max").val()))return void PromptInfo.xcConfirm("\u7b5b\u9009\u6761\u4ef6\u5fc5\u987b\u4e3a\u6570\u503c\u578b\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){$(".filter-condition-max").focus()}})}var i=$("#filterConditionModal .dt-filter-condition"),e=i.find(":selected").val(),n=FilterPlugin._getConditionValue(i);null!=n&&($("#submitFilterCondition").attr("disabled",!0),FilterPlugin.createFilterCondition(t,e,n,function(t){$("#submitFilterCondition").removeAttr("disabled"),$("#filterConditionModal").modal("hide"),FilterPlugin._refreshFilterItem(t)}))})},FilterPlugin._refreshFilterItem=function(t){var e=t.id;FilterPlugin.setFilterItem(e,t);var i=$.templates.filter_item.render(t),n=$("#filter-item-"+e);n.length>0?n.html(i):$(".filter-config").append(i),FilterPlugin._bindFilterItemHandler(),FilterPlugin.refreshFilterControl()},FilterPlugin._getConditionValue=function(t){var e=[],i=t.find(":selected").val();if("bt"==i){var n=t.find(".filter-condition-min").val(),r=t.find(".filter-condition-max").val();e.push(n),e.push(r)}else if("bt_date"==i){var a=t.find(".filter-condition-start").val(),o=t.find(".filter-condition-end").val();if(e.push(a),e.push(o),a=moment(a,"YYYY-MM-DD HH:mm:ss"),!a.isValid())return PromptInfo.xcConfirm("\u65e5\u671f\u7b5b\u9009\u6761\u4ef6\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){t.find(".filter-condition-start").focus()}}),null;if(o=moment(o,"YYYY-MM-DD HH:mm:ss"),!o.isValid())return PromptInfo.xcConfirm("\u65e5\u671f\u7b5b\u9009\u6761\u4ef6\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){t.find(".filter-condition-end").focus()}}),null}else{var s=t.find(".filter-condition-text").val();if(0==s.trim().length)return PromptInfo.xcConfirm("\u7b5b\u9009\u6761\u4ef6\u4e0d\u80fd\u4e3a\u7a7a,\u8bf7\u91cd\u65b0\u8f93\u5165",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){$(".filter-condition-text").focus()}}),null;e.push(s)}return e},FilterPlugin.bindFilterConditionHandler=function(){function t(t){var e=t.val();e&&(e=moment(e,"YYYY-MM-DD HH:mm:ss"),e.isValid()&&t.data("DateTimePicker").viewDate(e))}function e(t){var e=$(t.target).offset().left,i=$(t.target).closest(".dt-filter-condition"),n=i.offset().left,r=i.offset().top-$(t.target).closest(".modal-body").offset().top,a=i.find(".bootstrap-datetimepicker-widget");a.css("left",e-n+15).css("top",r+47)}$(".filter-condition-name").autocomplete({minLength:0,source:FilterPlugin.getFilterFields(),scrollHeight:240,focus:function(){return!1},select:function(){var t=$(this);setTimeout(function(){t.blur()},1)}}).focus(function(){return $(this).autocomplete("search"),!1}),$(".filter-condition").unbind().change(function(){var t=$(this),e=t.find(":selected").val(),i=t.closest(".dt-filter-condition");"bt"==e?(i.find(".filter-value").hide(),i.find(".filter-date-range").hide(),i.find(".filter-range").show()):"bt_date"==e?(i.find(".filter-value").hide(),i.find(".filter-range").hide(),i.find(".filter-date-range").show()):(i.find(".filter-range").hide(),i.find(".filter-date-range").hide(),i.find(".filter-value").show())});var i={format:"YYYY-MM-DD HH:mm:ss",tooltips:MapUtils.getDateTimePickerTooltip()};$.each($(".filter-condition-start"),function(n,r){var a=$(r);i.widgetParent=a.closest(".dt-filter-condition"),a.datetimepicker(i).on("dp.show",function(t){e(t)}),t(a)}),$.each($(".filter-condition-end"),function(n,r){var a=$(r);i.widgetParent=a.closest(".dt-filter-condition"),a.datetimepicker(i).on("dp.show",function(t){e(t)}),t(a)})}});var FendanInfowindow=window.FendanInfowindow=FendanInfowindow||{};$(function(){FendanInfowindow.openFeatureWord=function(t,e,i){function n(){c.last_position=c.getPosition(),$('[data-toggle="tooltip"]').tooltip(),$(".del_marker").addClass("dt-none"),$(".glyphicon-plus").removeClass("dt-none"),FendanInfowindow.openFeatureWord(t,c,{hashMap:s,is_admin:l,editable:!0}),$(".dt-infowindow-title").html(r(c.word))}function r(t){return"<input value='"+t+"' class='form-control input-sm dt-w268' style='height:24px;margin:3px 0' placeholder='\u8bf7\u8f93\u5165\u9700\u8981\u7ed1\u5b9a\u7684\u5173\u952e\u8bcd'/>"}function a(){var e={mid:mid,id:c.feature_word_id};MapUtils.ajax2server(remove_feature_word_url,"DELETE",e,function(e){e.status?(t.removeOverlay(c),FendanInfowindow.close(),s.remove(c.feature_word_id),$("#select_feature_word_"+c.feature_word_id).remove(),0==$(".select-feature-word").length&&$("#featureContainer").html("<div class='alert alert-info dt-mar-auto dt-w92per'>\u8be5\u533a\u57df\u8fd8\u6ca1\u6709\u8bcd\u5e93\uff0c\u8bf7\u624b\u52a8\u6dfb\u52a0</div>")):PromptInfo.xcConfirm(e.msg,PromptInfo.xcConfirm.typeEnum.error)})}function o(e){c.dragging.disable(),c.last_position=null;var i=$(".dt-infowindow-title input").val().trim();if(""==i)return void PromptInfo.xcConfirm("\u5173\u952e\u8bcd\u4e0d\u80fd\u4e3a\u7a7a",PromptInfo.xcConfirm.typeEnum.error);var n=c.getPosition();if(e.check_region){var r=c.region_id;if("undefined"==typeof r||null==r||""==r)return void PromptInfo.xcConfirm("\u7ed1\u5b9a\u533a\u57df\u4e0d\u80fd\u4e3a\u7a7a",PromptInfo.xcConfirm.typeEnum.error)}c.feature_word_id?MapUtils.ajax2server(update_feature_word_url,"PUT",{mid:mid,id:c.feature_word_id,word:i,location:n.lng+","+n.lat},function(e){e.feature_word&&e.feature_word.id?(c.word=e.feature_word.word,c.region_id=e.feature_word.region_id,c.region_name=e.feature_word.region_name,$("#select_feature_word_"+c.feature_word_id+" span").text(c.word),FendanInfowindow.openFeatureWord(t,c,{hashMap:s,is_admin:l,editable:!1})):PromptInfo.xcConfirm(e.msg,PromptInfo.xcConfirm.typeEnum.error),$('[data-toggle="tooltip"]').tooltip()}):MapUtils.ajax2server(add_feature_word_url,"POST",{mid:mid,word:i,location:n.lng+","+n.lat},function(e){if(e.feature_word&&e.feature_word.id){c.feature_word_id=e.feature_word.id,c.word=e.feature_word.word,c.region_id=e.feature_word.region_id,c.region_name=e.feature_word.region_name;var i=new L.Icon({iconUrl:feature_word_icon_url,iconSize:new L.Point(7,15)});c.setIcon(i),s.put(c.feature_word_id,c),s.add(c);var n=FendanPlugin._featureWordDiv(e.feature_word);$("#featureContainer").find(".alert").remove(),$("#featureContainer").append(n),FendanInfowindow.openFeatureWord(t,c,{hashMap:s,is_admin:l,editable:!1})}else PromptInfo.xcConfirm(e.msg,PromptInfo.xcConfirm.typeEnum.error);$('[data-toggle="tooltip"]').tooltip()}),$("#regionKeyword").trigger("click")}if(e){FendanInfowindow._infowindow&&FendanInfowindow._infowindow.closePopup();var s=i.hashMap,l=i.is_admin;FendanInfowindow.editable=i.editable;var d,h=e.word?e.word:"",c=e;"undefined"!=typeof c.feature_word_id&&null!=c.feature_word_id||(FendanInfowindow.editable=!0);var u={title:h,marker:c,is_admin:i.is_admin,editable:FendanInfowindow.editable};FendanInfowindow.editable&&(c.last_position=c.getPosition(),c.dragging.enable()),d=$.templates.infowindow_template_fendan.render(u),FendanInfowindow._infowindow=new L.Popup({offset:new L.Point(0,-2)}).setLatLng(c.getLatLng()).setContent(d).openOn(t),FendanInfowindow.editable&&$(".dt-infowindow-title").html(r(h)),$('[data-toggle="tooltip"]').tooltip("destroy").tooltip(),$(".leaflet-popup-close-button").unbind().click(function(){c.dragging.disable(),c.last_position=null,c&&!c.feature_word_id&&t.removeOverlay(c)}),$(".leaflet-popup-content").unbind().click(function(t){$('[data-toggle="tooltip"]').tooltip("destroy"),$(t.target).hasClass("edit_feature_word")?n():$(t.target).hasClass("save_feature_word")?o(i):$(t.target).hasClass("delete_feature_word")&&PromptInfo.xcConfirm("\u786e\u5b9a\u5c06\u6b64\u5173\u952e\u8bcd\u5220\u9664?",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:a}),L.DomEvent.stopPropagation(t)})}},FendanInfowindow.close=function(){FendanInfowindow._infowindow&&FendanInfowindow._infowindow.remove()}});var FendanPlugin=window.FendanPlugin=FendanPlugin||{};$(function(){function t(t){var e=t.getPosition();MapUtils.ajax2server(update_feature_word_url,"PUT",{mid:mid,id:t.feature_word_id,word:t.word,location:e.lng+","+e.lat},function(e){e.feature_word&&e.feature_word.id?(t.word=e.feature_word.word,t.region_id=e.feature_word.region_id,t.region_name=e.feature_word.region_name,t.last_position=null):(t.setPosition(t.last_position),PromptInfo.xcConfirm(e.msg,PromptInfo.xcConfirm.typeEnum.error)),FendanInfowindow.openFeatureWord(FendanPlugin._map,t,{hashMap:FendanPlugin.featureWordHashMap,is_admin:FendanPlugin._is_admin,editable:FendanInfowindow.editable})})}function e(t){var e=t.getPosition();MapUtils.ajax2server(search_fendan_region_url,"GET",{mid:mid,location:e.lng+","+e.lat},function(e){if(null==e.region_id)t.setPosition(t.last_position),PromptInfo.xcConfirm("\u5173\u952e\u8bcd\u5fc5\u987b\u6dfb\u52a0\u5230\u533a\u57df\u5185",PromptInfo.xcConfirm.typeEnum.error);else{t.last_position=null,t.region_id=e.region_id;var i=FendanPlugin._getRegion(t.region_id);t.region_name=FendanPlugin._getRegionName(i)}FendanInfowindow.openFeatureWord(FendanPlugin._map,t,{hashMap:FendanPlugin.featureWordHashMap,is_admin:FendanPlugin._is_admin,editable:FendanInfowindow.editable})})}FendanPlugin.featureWordHashMap=new DT.HashMap,FendanPlugin._editing_feature_word=null,FendanPlugin.init=function(t,e,i){FendanPlugin._map=t,FendanPlugin._layersHashMap=e,FendanPlugin._is_admin=i.isAdmin||!1,FendanPlugin._autoComplte=i.autoComplete||!0;var n={map:t,search_type:2,has_button:!0,onlineCallback:FendanPlugin._position};$("#fendanSearchControl").CreateSearchControl(n),FendanPlugin._featureWordHandler=new L.Draw.FeatureWord(t,{icon:new L.Icon({iconUrl:feature_word_icon_url,iconSize:new L.Point(7,15)})}),FendanPlugin._map.on(L.Draw.Event.FEATUREWORDCREATED,FendanPlugin._addFeatureWord),$(".fendan-slider ul").click(function(t){$(t.target).closest("li").hasClass("slider-back")||($(".slider-bar").hide(),$("#fendanToolbar").addClass("dt-none"),"single"==$(t.target).closest("li").attr("data-select")?($("#fendanPanel").show(),$(".fendan-nav-slider-bg").animate({top:"0"},"fast")):"batch"==$(t.target).closest("li").attr("data-select")?(FendanPlugin.openBatch(),$(".fendan-nav-slider-bg").animate({top:"56px"},"fast")):"correction"==$(t.target).closest("li").attr("data-select")?(FendanPlugin.addFendanCorrection(),$("#fendanToolbar").removeClass("dt-none"),$(".fendan-nav-slider-bg").animate({top:"168px"},"fast")):"fendan_report"==$(t.target).closest("li").attr("data-select")?(FendanPlugin.openFendanReportPanel(),$(".fendan-nav-slider-bg").animate({top:"224px"},"fast")):"fendan-api"==$(t.target).closest("li").attr("data-select")&&(FendanPlugin.openFendanApi(),$(".fendan-nav-slider-bg").animate({top:"112px"},"fast")))})},FendanPlugin.reset=function(){FendanPlugin._featureWordHandler.disable(),FendanPlugin._map.removeOverlay(FendanPlugin._map.current_overlay),FendanPlugin._clearFeatureWords(),BInfowindow.close()},FendanPlugin._selectFeatureWord=function(t){var e=FendanPlugin._getFeatureWord(t);e&&FendanInfowindow.openFeatureWord(FendanPlugin._map,e,{hashMap:FendanPlugin.featureWordHashMap,is_admin:FendanPlugin._is_admin})},FendanPlugin._getFeatureWord=function(t){var e=null;return FendanPlugin._map.eachLayer(function(i){if(i.feature_word_id==t)return void(e=i)}),e},FendanPlugin.selectRegion=function(t){var e=FendanPlugin._getRegion(t);if(e){var i=FendanPlugin._getRegionName(e);$("#regionName").text(i),BInfowindow.open(e,{is_show:!0,hashMap:FendanPlugin._layersHashMap}),FendanPlugin._getFeatureWords(e),"undefined"!=typeof FendanPlugin._map.current_overlay&&FendanPlugin._map.removeOverlay(FendanPlugin._map.current_overlay);var n=e.clone(FendanPlugin._styleEditOptions);FendanPlugin._map.addOverlay(n),FendanPlugin._map.current_overlay=n}},FendanPlugin._getRegion=function(t){var e=null;return FendanPlugin._map.eachLayer(function(i){"region"==i.type&&i.feature_id==t&&(e=i)}),e},FendanPlugin._getRegionName=function(t){var e="";if(t&&t.attrs){e="";var i=t.uniform_title;if(i)for(var n=0;n<t.attrs.length;n++)if(i==t.attrs[n].key){e=t.attrs[n].value||"";break}}return e},FendanPlugin._position=function(t){if(t.results.length>0){var e=new L.latLng(t.results[0].location.lat,t.results[0].location.lng);FendanPlugin._map.panTo(e)}else PromptInfo.xcConfirm("\u672a\u627e\u5230\u7ed3\u679c",PromptInfo.xcConfirm.typeEnum.info)},FendanPlugin._clearFeatureWords=function(){for(var t=FendanPlugin.featureWordHashMap.getArray(),e=0;e<t.length;e++)FendanPlugin._map.removeOverlay(t[e]);FendanPlugin.featureWordHashMap.clear(),FendanPlugin.featureWordHashMap.clearArray()},FendanPlugin._getFeatureWords=function(t){FendanPlugin._clearFeatureWords(),MapUtils.ajax2server(feature_words_url,"get",{mid:mid,region_id:t.feature_id},function(t){if(t.feature_words){var e="";e+="<ul>";for(var i=0;i<t.feature_words.length;i++){var n=FendanPlugin._addFeatureWord2Map(t.feature_words[i]);n&&(FendanPlugin.featureWordHashMap.put(n.feature_word_id,n),FendanPlugin.featureWordHashMap.add(n),e+=FendanPlugin._featureWordDiv(t.feature_words[i]))}e+="</ul>",$("#featureContainer").html(e),0==$(".select-feature-word").length&&$("#featureContainer").html("<div class='alert alert-info dt-mar-auto dt-w92per'>\u8be5\u533a\u57df\u8fd8\u6ca1\u6709\u8bcd\u5e93\uff0c\u8bf7\u624b\u52a8\u6dfb\u52a0</div>")}})},FendanPlugin._addFeatureWord2Map=function(e){var i=e.location;if(i&&i.indexOf(",")>-1){i=i.split(",");var n=i[0],r=i[1],a=new L.Icon({iconUrl:feature_word_icon_url,iconSize:new L.Point(7,15)}),o=new Dtwy.Marker(new L.LatLng(r,n),{icon:a});return o.feature_word_id=e.id,o.word=e.word,o.location=e.location,o.region_id=e.region_id,o.region_name=e.region_name,o.mid=e.mid,o.user_name=e.user_name,o.user_phone=e.user_phone,FendanPlugin._map.addOverlay(o),FendanPlugin._addHandler(o,{click:function(t){FendanInfowindow.openFeatureWord(FendanPlugin._map,t,{hashMap:FendanPlugin.featureWordHashMap,is_admin:FendanPlugin._is_admin})},dragend:t}),o}return null},FendanPlugin._addHandler=function(t,e){t.on("click",function(){e&&e.click&&e.click(this)}),t.on("dragstart",function(){FendanInfowindow.close()}),t.on("dragend",function(){e&&e.dragend&&e.dragend(this),$('[data-toggle="tooltip"]').tooltip()})},FendanPlugin._featureWordDiv=function(t){var e=t.id,i=t.word,n="<li class='dt-truncate dt-hover dt-pointer dt-pad12x dt-pad6b select-feature-word' id='select_feature_word_"+e+"' data-feature-word-id='"+e+"'>";return n+="<img src='"+feature_word_icon_url+"' width='8'/>",n+="<span class='dt-mar6l select-feature-word dt-f12' data-feature-word-id='"+e+"'>"+i+"</span>",n+="</li>"},FendanPlugin._styleEditOptions={strokeColor:"#ffffff",fillColor:"#ffffff",strokeWeight:2,strokeOpacity:1,fillOpacity:.1,strokeStyle:"solid"},$("#fendanAddMarkerBtn").click(function(){FendanPlugin._map.drawHandler&&FendanPlugin._map.drawHandler.disable(),FendanPlugin._map.drawHandler=FendanPlugin._featureWordHandler,FendanPlugin._map.drawHandler&&FendanPlugin._map.drawHandler.enable()}),FendanPlugin._addFeatureWord=function(t){FendanPlugin._featureWordHandler.disable(),delete FendanPlugin._map.drawHandler,$(".u-active").removeClass("u-active"),$("#panBtn").addClass("u-active");var i=t.layer,n=i.getLatLng(),r=FendanPlugin._searchRegion(n);if(null==r)return FendanPlugin._map.removeOverlay(i),void PromptInfo.xcConfirm("\u5173\u952e\u8bcd\u5fc5\u987b\u6dfb\u52a0\u5230\u533a\u57df\u5185",PromptInfo.xcConfirm.typeEnum.error);var a=new L.Icon({iconUrl:feature_word_icon_url,iconSize:new L.Point(7,15)}),o=new Dtwy.Marker(new L.LatLng(n.lat,n.lng),{icon:a});FendanPlugin._map.addOverlay(o),FendanPlugin._map.removeOverlay(t.overlay),FendanPlugin._map.action=null,FendanPlugin._map.region_id=r.feature_id,FendanPlugin._map.editing=!0,FendanPlugin._map.last_position=n,FendanPlugin._map.user_name=loginUser.nickname,FendanPlugin._map.user_phone=user_phone;var s=FendanPlugin._getRegionName(r);s&&(o.region_name=s),FendanPlugin._editing_feature_word&&!FendanPlugin._editing_feature_word.feature_word_id&&FendanPlugin._map.removeOverlay(FendanPlugin._editing_feature_word),FendanPlugin._editing_feature_word=o,FendanPlugin._addHandler(o,{click:function(t){FendanInfowindow.openFeatureWord(FendanPlugin._map,t,{hashMap:FendanPlugin.featureWordHashMap,is_admin:FendanPlugin._is_admin})},dragend:e}),FendanInfowindow.openFeatureWord(FendanPlugin._map,o,{hashMap:FendanPlugin.featureWordHashMap,is_admin:FendanPlugin._is_admin,editable:!0})},FendanPlugin._searchRegion=function(t){for(var e,i=FendanPlugin._layersHashMap.keys(),n=0;n<i.length;n++)if(i[n]&&i[n].indexOf("r_")>-1){var r=FendanPlugin._layersHashMap.get(i[n]),a=[];r&&r.regions&&(a=r.regions.values());for(var o=0;o<a.length;o++)if(e=a[o],e&&e.isVisible()&&RegionUtils.isPointInRegion(t,e))return e}return null},FendanPlugin.getFendanReports=function(t,e,i,n){var r={date_range:t,start_date:e,end_date:i};MapUtils.ajax2server(fendan_reports_url,"GET",r,function(t){n&&n instanceof Function&&n(t)},function(t){PromptInfo.xcConfirm(t.msg,PromptInfo.xcConfirm.typeEnum.error)})},FendanPlugin.getFendanReportDetails=function(t,e,i){var n={start_date:t,end_date:e};MapUtils.ajax2server(fendan_report_details_url,"GET",n,function(t){i&&i instanceof Function&&i(t)},function(t){PromptInfo.xcConfirm(t.msg,PromptInfo.xcConfirm.typeEnum.error)})},FendanPlugin._quickSort=function(t){MapUtils.removeAutoComplete(),$("#fendanSearchInput").val(t),MapUtils.ajax2server(quick_sort_url,"POST",{address:t},function(e){if($(".wb-list").empty(),e.status&&e.regions){var i=new L.Icon({iconUrl:marker_icon_url,iconSize:[32,32]}),n=new Dtwy.Marker(new L.LatLng(e.lat,e.lng),{icon:i}),r={direction:"top",offset:new L.Point(0,2)};if(n.bindPopup('<p class="dt-mar12t">'+t+"</p>",r),FendanPlugin._map.addOverlay(n),FendanPlugin._map.removeOverlay(FendanPlugin._map.search_marker),FendanPlugin._map.search_marker=n,FendanPlugin._map.panTo(n.getPosition()),FendanPlugin._map.fendan_marker=n,0==e.regions.length)return void PromptInfo.xcConfirm("\u8be5\u5730\u5740\u8d85\u51fa\u914d\u9001\u533a\u57df\u8303\u56f4\u3002",PromptInfo.xcConfirm.typeEnum.error);for(var a=0;a<e.regions.length;a++){var o=e.regions[a],s="";s=o.title?o.title:o.attrs[0].values[0],"undefined"!=typeof s&&null!=s||(s="");var l="<li class='dt-pad12y'>";l+="<span class='color99'>\u5206\u62e3\u7ed3\u679c</span>",l+="<span class='dt-mar12l black'>"+s+"</span>",l+="</li>",$(".wb-list").append(l)}}else{var d="\u65e0\u6cd5\u627e\u5230\u8be5\u5730\u5740\uff01";e.msg&&(d=e.msg),PromptInfo.xcConfirm(d,PromptInfo.xcConfirm.typeEnum.error)}},function(t){PromptInfo.xcConfirm(t.responseJSON.msg,PromptInfo.xcConfirm.typeEnum.error)})},FendanPlugin._getFendanData=function(t){"undefined"==typeof t||null==t||t<=0||MapUtils.ajax2server(fendan_data_url,"GET",{mid:mid,page:t},function(t){var e=parseInt(t.total/t.per_page),i=0;t.total%t.per_page>0&&(i=1,e+=i),t.pages=new Array(e);var n=$.templates.fendan_batch_table.render(t);$(".dt-batch-fendan").html(n),t.total>10?$(".page-control").show():$(".page-control").hide(),$(".pagination a").unbind().click(function(t){var e=$(t.target).closest("li").attr("data-page");FendanPlugin._getFendanData(e)})})},FendanPlugin.openBatch=function(){var t=["batch_fendan","fendan_batch_table"];$.when($.lazyGetTemplate(t)).done(function(){$.views.settings.allowCode=!0,$("#batchFendan").remove();var t=$.templates.batch_fendan.render();$("#content").append(t),FendanPlugin._getFendanData(1),$("#batchFendan").width(window.innerWidth-56);var e={width:120,height:34,buttonText:"\u4e0a\u4f20\u6587\u4ef6",buttonClass:"btn btn-primary pull-left dt-mar8t",multi:!1,auto:!0,fileSizeLimit:"2MB",uploadScript:precess_url,formData:{token:user_token}};$("#upload_xls").uploadifive({width:e.width,height:e.height,buttonText:e.buttonText,buttonClass:e.buttonClass,multi:e.multi,auto:e.auto,fileSizeLimit:e.fileSizeLimit,uploadScript:e.uploadScript,formData:e.formData,onSelect:function(){$(".uploadifive-queue").css("display","block")},onUploadComplete:function(t,e){var i=$.parseJSON(e);if("f"==i.status||0==i.status){var n="\u6570\u636e\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25";i.msg&&(n=i.msg),PromptInfo.xcConfirm(n,PromptInfo.xcConfirm.typeEnum.info)}setTimeout(function(){$("#uploadifive-upload_xls-queue").empty().hide()},500)},onError:function(){},onCancel:function(){$("#uploadifive-upload_xls-queue").empty().hide()}}),$("#downloadFendanData").click(function(){var t=$("#startDate").val(),e=$("#endDate").val();$.ajax({url:download_fendan_data_url,data:{start_time:t,end_time:e},type:"POST",dataType:"json",success:function(t){t.url&&t.url.length>0&&MapUtils.download(t.url)},error:function(t){var e="\u4e0b\u8f7d\u6570\u636e\u9519\u8bef";t&&t.responseJSON&&t.responseJSON.msg&&(e=t.responseJSON.msg),PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.error)}})}),setTimeout(function(){if($("#startDate").datepicker({minDate:min_date,maxDate:today}).val(yesterday),today instanceof Date){var t=today.getMonth()+1,e=today.getDate();t<10&&(t="0"+t),e<10&&(e="0"+e),today=today.getFullYear()+"-"+t+"-"+e,$("#endDate").datepicker({minDate:min_date,maxDate:today}).val(today)}else $("#endDate").datepicker({minDate:min_date,maxDate:today}).val(today)},100),new Faye.Client(faye_server).subscribe(fendan_channel,function(t){if(0==t.status){var e="<tr><td>"+t.datum.name+"</td><td>"+t.datum.num+"</td><td>"+t.datum.creator+"</td><td>"+t.datum.phone+"</td><td>"+t.datum.created_at+"</td><td id='datum_finish_time_"+t.datum.id+"'>-</td><td id='datum_id_"+t.datum.id+"'>"+t.datum.status+"</td><td><a id='datum_down_"+t.datum.id+"' href='javascript:;'>\u8bf7\u7b49\u5f85<a></td></tr>";$("#data_tbody").prepend(e)}else 1==t.status?$("#datum_id_"+t.datum_id).text(t.precess):2==t.status&&($("#datum_down_"+t.datum.id).attr("href",oss_host+"/"+t.datum.path).text("\u4e0b\u8f7d"),$("#datum_finish_time_"+t.datum.id).text(t.datum.updated_at),$("#datum_id_"+t.datum.id).text("\u89e3\u6790\u5b8c\u6210"));
})})},FendanPlugin.openFendanApi=function(){var t=["fendan_api"];$.when($.lazyGetTemplate(t)).done(function(){$("#fendanAPI").remove(),$.views.settings.allowCode=!0;var t=$.templates.fendan_api.render();$("#mapInfoWrapper").append(t)})},FendanPlugin.addQuickSort=function(t){function e(){$("#fendanSearchInput").keyup(function(t){var e=$("#dtwyCityList span").text(),i=$(this).val().trim();if(0==i.length?(MapUtils.removeAutoComplete(),$(".wb-list").empty(),$(".fendan-result-clear").addClass("dt-none"),FendanPlugin._map.removeOverlay(FendanPlugin._map.search_marker)):$(".fendan-result-clear").removeClass("dt-none"),13==t.keyCode){if(0==i.length)return void PromptInfo.xcConfirm("\u67e5\u8be2\u5173\u952e\u5b57\u4e0d\u80fd\u4e3a\u7a7a",PromptInfo.xcConfirm.typeEnum.error);FendanPlugin._quickSort(i)}else FendanPlugin._autoComplte&&MapUtils.autoComplete(t.target,i,e,FendanPlugin._quickSort)}),$("#fendanSearchBtn").unbind().click(function(){var t=$("#fendanSearchInput").val().trim();return 0==t.length?void PromptInfo.xcConfirm("\u67e5\u8be2\u5173\u952e\u5b57\u4e0d\u80fd\u4e3a\u7a7a",PromptInfo.xcConfirm.typeEnum.error):void FendanPlugin._quickSort(t)}),$(".fendan-result-clear").unbind().click(function(){$("#fendanSearchInput").val(""),$(this).addClass("dt-none"),$(".wb-list").empty(),FendanPlugin._map.fendan_marker&&FendanPlugin._map.removeOverlay(FendanPlugin._map.fendan_marker)})}var i=["fendan_quick_sort"];$.when($.lazyGetTemplate(i)).done(function(){$.views.settings.allowCode=!0;var i=$.templates.fendan_quick_sort.render({id:t});$("#mapInfoWrapper").append(i),e()})},FendanPlugin.addFendanCorrection=function(){function t(){$("#infoTool").popover({html:!0,template:'<div class="popover" style="max-width:320px;margin-left:52px;" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}).on("show.bs.popover",function(){var t="<p class='dt-f12'>1.\u5173\u952e\u8bcd\u4e3b\u8981\u6307\u5c0f\u533a\u3001\u5927\u53a6\u3001\u5b66\u6821\u7b49\u7c7b\u4f3c\u540d\u79f0\uff1b</p>";t+="<p class='dt-f12 dt-mar8t'>2.\u5173\u952e\u8bcd\u9700\u63a7\u5236\u57283~20\u4e2a\u5b57\uff0c\u4e0d\u80fd\u4e3a\u7eaf\u5b57\u6bcd\u6216\u6570\u5b57\uff1b</p>",t+="<p class='dt-f12 dt-mar8t'>3.\u5173\u952e\u8bcd\u9700\u4fdd\u8bc1\u57ce\u5e02\u5185<span class='text-danger'>\u552f\u4e00\u6027</span>\uff0c\u5f53\u5b58\u5728\u4e24\u4e2a\u5b8c\u5168\u76f8\u540c\u5730\u5740\u5173\u952e\u8bcd\u5219\u4e0d\u80fd\u505a\u7ed1\u5b9a\u3002</p>",$("#infoTool").attr("data-content",t)}),$("#regionInfoWrapper").unbind().click(function(t){if($(t.target).hasClass("layer_title")){var e=$(t.target).closest(".layer").find("ul");e.is(":visible")?e.hide():e.show()}else if($(t.target).hasClass("select_region")){var i=$(t.target).attr("region-id");FendanPlugin.selectRegion(i)}}),$("#correctionInfoWrapper").bind("click",function(t){if($(t.target).hasClass("select-feature-word")){var e=$(t.target).data("feature-word-id");FendanPlugin._selectFeatureWord(e)}})}var e=["fendan_correction","infowindow_template_fendan"];$.when($.lazyGetTemplate(e)).done(function(){$("#correctionPanel").remove(),$.views.settings.allowCode=!0;var e=$.templates.fendan_correction.render();$("#mapInfoWrapper").append(e);for(var i=RegionUtils.getRegionLayers(),n=0;n<i.length;n++){var r=i[n];RegionUtils.addCorrectionPanel(r,"#regionInfoWrapper")}$("#regionInfoWrapper").css("max-height",$(window).height()-83).css("overflow","auto"),t()})},FendanPlugin.openFendanReportPanel=function(){function t(){$(".fendan-report-btn").unbind().click(function(){var t=$(this).attr("data-range"),e=$("#fendanStartTime").val(),i=$("#fendanEndTime").val();FendanPlugin.getFendanReports(t,e,i,function(t){if($(".fendan-today").text(t.today_count),$(".fendan-month").text(t.total_count),$("#fendanStartTime").val(t.start_date),$("#fendanEndTime").val(t.end_date),0==t.report_data.length)return void PromptInfo.xcConfirm("\u6682\u65e0\u6570\u636e",PromptInfo.xcConfirm.typeEnum.info);$("#getFendanReportDetails").removeClass("dt-none").attr("data-start",t.start_date).attr("data-end",t.end_date),$("#downloadFendanReports").attr("href","javascript:void(0)").hide();var e=echarts.init(document.getElementById("fendan_chart")),i={title:{text:"\u5206\u5355\u8c03\u7528\u6b21\u6570(\u603b\u8ba1:"+t.report_sum+")"},tooltip:{trigger:"axis"},calculable:!0,xAxis:[{type:"category",boundaryGap:!0,data:t.report_dates}],yAxis:[{type:"value",axisLabel:{formatter:"{value}"}}],series:[{name:"\u8c03\u7528\u6b21\u6570",type:"line",data:t.report_data,markPoint:{data:[{type:"max",name:"\u6700\u5927\u503c"},{type:"min",name:"\u6700\u5c0f\u503c"}]},markLine:{data:[{type:"average",name:"\u5e73\u5747\u503c"}]}}]};e.setOption(i)})}),$(".close-fendan-details").unbind().click(function(){$(".fendan-report-panel").animate({right:"-100%"},"fast")}),$("#getFendanReportDetails").unbind().click(function(){var t=$("#fendanStartTime").val(),e=$("#fendanEndTime").val();FendanPlugin.getFendanReportDetails(t,e,function(t){$("#fendanReportDetailsPanel").empty(),$(".fendan-report-panel").animate({right:"0"},"fast");var e=$("#getFendanReportDetails").attr("data-start"),i=$("#getFendanReportDetails").attr("data-end"),n="<p class='dt-h32' style='margin:8px 0;'>";n+=e,n+="<span class='dt-mar12x dt-f14'>\u81f3</span>",n+=i,n+="<span class='dt-mar12x dt-f14'>\u8ba2\u5355\u5206\u62e3\u660e\u7ec6</span>",n+='<a id="downloadFendanReports" href="javascript:void(0)" target="_blank" style="display: none;">\u4e0b\u8f7d\u660e\u7ec6</a>',n+="</p>",n+="<table class='table'>",n+="<th>\u8d26\u6237\u540d\u79f0</th>",n+="<th>\u624b\u673a\u53f7</th>",n+="<th>\u65e5\u671f</th>",n+="<th>\u6279\u91cf\u5206\u62e3\u6570</th>",n+="<th>\u5355\u6761\u5206\u62e3\u6570</th>",n+="<th>\u5408\u8ba1\u6761\u6570</th>";for(var r=0;r<t.details.length;r++){var a=t.details[r];n+="<tr>",n+="<td>"+a.nickname+"</td>",n+="<td>"+a.phone+"</td>",n+="<td>"+a.date+"</td>",n+="<td>"+a.batch_count+"</td>",n+="<td>"+Math.max(0,parseInt(a.total_count-a.batch_count))+"</td>",n+="<td>"+a.total_count+"</td>",n+="</tr>"}n+="</table>",$("#fendanReportDetailsPanel").append(n),$("#downloadFendanReports").attr("href",t.url).show()})})}var e=["fendan_report"];$.when($.lazyGetTemplate(e)).done(function(){$.views.settings.allowCode=!0,$("#fendanReportPanel").remove();var e=$.templates.fendan_report.render();$("#content").after(e),$("#fendan_chart").height($(window).height()-48-60-24),$("#fendanReportPanel").width($(window).width()-56),$("#fendanStartTime").datepicker({minDate:min_date,maxDate:today}),$("#fendanEndTime").datepicker({minDate:min_date,maxDate:today}),t(),$(".fendan-report-btn[data-range=seven_days]").click()})}});var MonitorUtils=window.MonitorUtils=MonitorUtils||{};$(function(){MonitorUtils.init=function(t,e,i,n){MonitorUtils._map=e,MonitorUtils._layersHashMap=i,MonitorUtils._monitorHashMap=n;var r=["monitor_panel","add_monitor"];$.when($.lazyGetTemplate(r)).done(function(){$.views.settings.allowCode=!0;var e=$.templates.monitor_panel.render({id:t});$("#mapInfoWrapper").append(e),$("#dtMonitorWarningPanel").height($(window).height()-48),$(".monitor-items").height($("#dtMonitorWarningPanel").height()-76),MonitorUtils.initOverlayMonitor(),$("#date_monitor_eq").unbind().change(function(){"\u63d0\u524d"==$(this).find(":selected").text()?($("#date_monitor_select").hide(),$("#date_monitor_time").show()):($("#date_monitor_select").show(),$("#date_monitor_time").hide())}),$("#date_monitor_select").datetimepicker({format:"YYYY-MM-DD",widgetParent:$(".monitor-settings"),tooltips:MapUtils.getDateTimePickerTooltip()}).on("dp.show",function(){$(".usetwentyfour").css({left:"14px",top:"-24px",bottom:"auto"}).removeClass("bottom top")}),MonitorUtils.getLayersData(),MonitorUtils.removeMonitorItem(),$(".monitor-btns a").unbind().click(function(){$(".monitor-btns").find(".active").removeClass("active"),$(this).addClass("active"),$(this).hasClass("target")?($(".become-warning").addClass("dt-none"),$(".update-data-warning").addClass("dt-none"),$(".target-warning").removeClass("dt-none")):$(this).hasClass("become")?($(".target-warning").addClass("dt-none"),$(".update-data-warning").addClass("dt-none"),$(".become-warning").removeClass("dt-none")):$(this).hasClass("update-data")&&($(".target-warning").addClass("dt-none"),$(".update-data-warning").removeClass("dt-none"),$(".become-warning").addClass("dt-none"))}),$(".add-monitor").unbind().click(function(){$(".monitor-settings").is(":visible")?$(".monitor-settings").addClass("dt-none"):$(".monitor-settings").removeClass("dt-none")}),$("#select_monitor_warning").unbind().change(function(){var t,e=$("#select_monitor_warning :selected").val(),i=$("#select_monitor_warning :selected").attr("data-layer-type");"marker_layer"==i?t=MonitorUtils._layersHashMap.get("m_"+e):"line_layer"==i?t=MonitorUtils._layersHashMap.get("l_"+e):"region_layer"==i&&(t=MonitorUtils._layersHashMap.get("r_"+e)),MonitorUtils.getLayerFields(t,0)}),$("#monitor_field").unbind().change(function(){var t=$(this).find(":selected").attr("data-field-type");MonitorUtils.getCurrentFields(t)}),$("#closeMonitorPanel").unbind().click(function(){$(".monitor-settings").addClass("dt-none")}),$("#submitMonitorSettings").unbind().click(function(){var t=$("[data-monitor-name]").val();if(0==t.trim().length)return void PromptInfo.xcConfirm("\u9884\u8b66\u540d\u79f0\u4e0d\u4e3a\u7a7a!",PromptInfo.xcConfirm.typeEnum.info);var e=$("#select_monitor_warning").find(":selected").attr("data-layer-type"),i=$("#select_monitor_warning").val(),n="";$("[data-monitor-condition]").each(function(){$(this).hasClass("active")&&(n=$(this).attr("data-monitor-condition"))});var r=$("#monitor_field").find(":selected").attr("data-field-type");if(!r)return void PromptInfo.xcConfirm("\u5f53\u524d\u6682\u65e0\u6709\u6548\u7684\u53ef\u76d1\u63a7\u5b57\u6bb5",PromptInfo.xcConfirm.typeEnum.info);var a;if("0"==n){if(a=$("#monitor_text").val(),"string"==r);else if("number"==r){var o=/^(-?\d+)(\.\d+)?$/;if(!o.test(a))return void PromptInfo.xcConfirm("\u76d1\u63a7\u6307\u6807\u5185\u5bb9\u4e3a\u6570\u503c\u7c7b\u578b,\u8bf7\u91cd\u65b0\u8f93\u5165",PromptInfo.xcConfirm.typeEnum.info)}}else if("1"==n&&"\u7b49\u4e8e"==$("#date_monitor_eq").val()&&(a=$("#date_monitor_select").val(),0==a.length||0==$("#date_monitor_field").val().length))return void PromptInfo.xcConfirm("\u76d1\u63a7\u6307\u6807\u4e0d\u80fd\u4e3a\u7a7a",PromptInfo.xcConfirm.typeEnum.info);var s={};"2"==n?(s.create=$("#create_monitor").is(":checked"),s.destroy=$("#remove_monitor").is(":checked"),s.update=$("#update_monitor").is(":checked")):"1"==n?(s.field=$("#date_monitor_field").val(),s.operate=$("#date_monitor_eq").val(),"\u63d0\u524d"==s.operate?s.val=$("#date_monitor_time").val():s.val=$("#date_monitor_select").val()):(s.field=$("#monitor_field").val(),s.operate=$("#monitor_eq").val(),s.val=a);var l={};l.highlight=$("#light_heigh_warning").is(":checked"),l.voice=$("#audio_warning").is(":checked"),l.alert=$("#infowindow_warning").is(":checked");var d={name:t,layer_id:i,layer_type:e,mtype:n,conditions:s,notice:l};MapUtils.ajax2server(create_monitor_url,"POST",d,function(t){$(".monitor-settings").addClass("dt-none"),MonitorUtils.createMonitorPanel(t.monitor);"marker_layer"==e?MonitorUtils.addMonitorItem(i,t,"marker_layer"):"region_layer"==e?MonitorUtils.addMonitorItem(i,t,"region_layer"):"line_layer"==e&&MonitorUtils.addMonitorItem(i,t,"line_layer");var n=parseInt($(".monitor-warning-count").text())+1;$(".monitor-warning-count").text(n)})}),$("#dtMonitorWarningPanel .chk_4").unbind().click(function(){MonitorUtils.isShowMonitor($(this))})})},MonitorUtils.isShowMonitor=function(t){var e=t.closest(".monitor-item").attr("data-monitor-id"),i=!!t.is(":checked");MapUtils.ajax2server(status_monitor_url,"POST",{monitor_id:e,open:i},function(t){if("\u4fee\u6539\u9884\u8b66\u72b6\u6001\u6210\u529f"==t.msg&&MonitorUtils._monitorHashMap.containsKey("monitor_"+e)){var n,r=MonitorUtils._monitorHashMap.get("monitor_"+e);if("marker_layer"==r.layer_type?n=MonitorUtils._layersHashMap.get("m_"+r.layer_id):"line_layer"==r.layer_type?n=MonitorUtils._layersHashMap.get("l_"+r.layer_id):"region_layer"==r.layer_type&&(n=MonitorUtils._layersHashMap.get("r_"+r.layer_id)),"hide"==n.display)return;r.open=t.monitor.open;for(var a=r.overlays.values(),o=0;o<a.length;o++){var s=a[o];if("true"==r.notice.highlight&&(i?s.show():s.hide()),"true"==r.notice.alert&&r.open){var l;l=r.conditions.field?"<p class='monitor' data-id='"+s.feature_id+"'>"+s.title+"&nbsp;"+r.conditions.field+"&nbsp;"+r.conditions.operate+"&nbsp;"+r.conditions.val+"</p>":"<p class='monitor' data-id='"+s.feature_id+"'>"+s.title+"&nbsp;\u88ab\u521b\u5efa/\u4fee\u6539</p>","undefined"!=typeof l&&l&&$("#popIntro").append(l)}}$("#popIntro").children().length>0&&r.open?($("#pop").slideDown(400),$("#popClose").unbind().click(function(){$("#pop").slideUp(400),$("#popIntro").empty()})):($("#pop").slideUp(400),$("#popIntro").empty())}})},MonitorUtils.getLayersData=function(){$("#select_monitor_warning").empty();for(var t=MonitorUtils._layersHashMap.values(),e="",i=0;i<t.length;i++){var n=t[i];0==i&&MonitorUtils.getLayerFields(n,0),e+="<option value='"+n.id+"' data-layer-type='"+n.type+"'>"+n.title+"</option>"}$("#select_monitor_warning").append(e)},MonitorUtils.getLayerFields=function(t,e){$("#monitor_field, #monitor_eq, #date_monitor_field,#date_monitor_field").empty();var i=t.getAttrFields();if(0!=i.length){for(var n="",r="",a="",o=[],s=0;s<i.length;s++){var l=i[s];l.is_show&&("date"!=l.field_type?(n+="<option data-field-type='"+l.field_type+"'>"+l.field+"</option>",o.push(l)):a+="<option data-field-type='"+l.field_type+"'>"+l.field+"</option>")}"string"==o[e].field_type?(r+="<option>\u7b49\u4e8e</option>",r+="<option>\u5305\u542b</option>",r+="<option>\u4e0d\u5305\u542b</option>"):"number"==o[e].field_type&&(r+="<option>\u7b49\u4e8e</option>",r+="<option>\u5927\u4e8e</option>",r+="<option>\u5c0f\u4e8e</option>",r+="<option>\u4e0d\u7b49\u4e8e</option>",r+="<option>\u5305\u542b</option>"),$("#monitor_field").append(n),$("#date_monitor_field").append(a),0==a.length?$("#date_monitor_field").attr("disabled",!0):$("#date_monitor_field").attr("disabled",!1),$("#monitor_eq").append(r)}},MonitorUtils.getCurrentFields=function(t){var e="";$("#monitor_eq").empty(),"number"==t?(e+="<option>\u7b49\u4e8e</option>",e+="<option>\u5927\u4e8e</option>",e+="<option>\u5c0f\u4e8e</option>",e+="<option>\u4e0d\u7b49\u4e8e</option>",e+="<option>\u5305\u542b</option>"):(e+="<option>\u7b49\u4e8e</option>",e+="<option>\u5305\u542b</option>",e+="<option>\u4e0d\u5305\u542b</option>"),$("#monitor_eq").append(e)},MonitorUtils.createMonitorPanel=function(t){var e="";"marker_layer"==t.layer_type?e=MonitorUtils._layersHashMap.get("m_"+t.layer_id):"line_layer"==t.layer_type?e=MonitorUtils._layersHashMap.get("l_"+t.layer_id):"region_layer"==t.layer_type&&(e=MonitorUtils._layersHashMap.get("r_"+t.layer_id)),t.layer_name=e.title,$.views.settings.allowCode=!0;var i=$.templates.add_monitor.render(t);$(".monitor-settings").after(i),MonitorUtils.removeMonitorItem()},MonitorUtils.getOverlayMonitor=function(t,e,i,n){if(MonitorUtils._monitorHashMap||(MonitorUtils._monitorHashMap=new DT.HashMap),t.monitors&&e){e.monitors=new Array;for(var r=0;r<t.monitors.length;r++){var a=t.monitors[r],o=MonitorUtils.validateMonitor(a,e.attrs,a.conditions.operate,n);if(o)MonitorUtils.overlayMonitor(o,e,n);else if(a.overlays){var s,l=e.feature_id;s=a.overlays.get(l),s&&(MonitorUtils._map.removeOverlay(s),a.overlays.remove(e.feature_id),$("[data-id='"+l+"']").remove())}}}},MonitorUtils.validateMonitor=function(t,e,i,n){var r;if("2"==t.mtype&&!n)return r=t;for(var a=0;a<e.length;a++){var o=e[a];if(o.key==t.conditions.field)if("\u5305\u542b"==i){if(o.value&&o.value.indexOf(t.conditions.val)>=0){r=t;break}}else if("\u4e0d\u5305\u542b"==i){if(o.value&&o.value.indexOf(t.conditions.val)==-1){r=t;break}}else if("\u7b49\u4e8e"==i){if("1"==t.mtype){if(o.value&&o.value.split(" ")[0]==t.conditions.val){r=t;break}}else if(o.value&&o.value==t.conditions.val){r=t;break}}else if("\u4e0d\u7b49\u4e8e"==i){if(o.value&&o.value!=t.conditions.val){r=t;break}}else if("\u5927\u4e8e"==i){if(o.value&&parseFloat(o.value)>parseFloat(t.conditions.val)){r=t;break}}else if("\u5c0f\u4e8e"==i){if(o.value&&parseFloat(o.value)<parseFloat(t.conditions.val)){r=t;break}}else if("\u63d0\u524d"==i){var s=MonitorUtils.getMonitorDate(t.conditions.val);if(o.value&&o.value.split(" ")[0]==s){r=t;break}}}return r},MonitorUtils.overlayMonitor=function(t,e,i){if("true"==t.notice.highlight&&("marker"==e.type?MonitorUtils.markerMonitor(t,e):"line"==e.type?MonitorUtils.lineMonitor(t,e):"region"==e.type&&MonitorUtils.regionMonitor(t,e)),"true"==t.notice.voice&&!i&&t.open){if(0==$("audio").length){var n='<audio controls="controls" autoplay="false" class="dt-w284 dt-none"><source src="'+oss_host+'/resource/audios/message_audio.mp3" type="audio/mp3"></audio>';$("body").append(n)}MapUtils.isLoadMessageAudio()}if("true"==t.notice.alert&&t.open){var r;if(r=t.conditions.field?"<p class='monitor' data-id='"+e.feature_id+"'>"+e.title+"&nbsp;"+t.conditions.field+"&nbsp;"+t.conditions.operate+"&nbsp;"+t.conditions.val+"</p>":"<p class='monitor' data-id='"+e.feature_id+"'>"+e.title+"&nbsp;\u88ab\u521b\u5efa/\u4fee\u6539</p>","undefined"!=typeof r&&r&&$("#popIntro").append(r),MonitorUtils._monitorHashMap&&!MonitorUtils._monitorHashMap.containsKey("monitor_"+t.id)){var a=new DT.HashMap;t.overlays=a,MonitorUtils._monitorHashMap.put("monitor_"+t.id,t)}}},MonitorUtils.regionMonitor=function(t,e){var i=t.open,n=e.clone();if(n.setStrokeColor("#e31a1c"),n.setStrokeOpacity(1),n.setFillOpacity(1),n.setFillColor("#e31a1c"),n.monitor_id=e.feature_id,n.title=e.title,n.type="region",setTimeout(function(){MonitorUtils._map.addOverlay(n),n.addEventListener("click",RegionUtils.clickRegion),i&&has_message_audio?(n.show(),"2"==t.mtype&&setTimeout(function(){n.hide()},5e3)):n.hide()},100),MonitorUtils._monitorHashMap&&MonitorUtils._monitorHashMap.containsKey("monitor_"+t.id)){var r=MonitorUtils._monitorHashMap.get("monitor_"+t.id).overlays;r.put(n.monitor_id,n)}else{var a=new DT.HashMap;a.put(n.monitor_id,n),t.overlays=a,MonitorUtils._monitorHashMap.put("monitor_"+t.id,t)}},MonitorUtils.lineMonitor=function(t,e){var i=t.open,n=e.clone();if(n.setStrokeColor("#e31a1c"),n.setStrokeOpacity(1),n.monitor_id=e.feature_id,n.title=e.title,n.type="line",setTimeout(function(){MonitorUtils._map.addOverlay(n),n.addEventListener("click",LineUtils.clickLine),i&&has_message_audio?(n.show(),"2"==t.mtype&&setTimeout(function(){n.hide()},5e3)):n.hide()},100),MonitorUtils._monitorHashMap&&MonitorUtils._monitorHashMap.containsKey("monitor_"+t.id)){var r=MonitorUtils._monitorHashMap.get("monitor_"+t.id).overlays;r.put(n.monitor_id,n)}else{var a=new DT.HashMap;a.put(n.monitor_id,n),t.overlays=a,MonitorUtils._monitorHashMap.put("monitor_"+t.id,t)}},MonitorUtils.markerMonitor=function(t,e){var i,n=t.open,r=("<div class='monitor-marker' data-monitor-marker-id='"+e.feature_id+"'></div>",L.icon.pulse({iconSize:[14,14],color:"red"}));if(i=L.marker(e.getLatLng(),{icon:r}),i.monitor_id=e.feature_id,i.title=e.title,i.type="marker",i.addTo(MonitorUtils._map),n&&has_message_audio?(i.show(),"2"==t.mtype&&setTimeout(function(){i.hide()},5e3)):i.hide(),MonitorUtils._monitorHashMap.containsKey("monitor_"+t.id)){var a=MonitorUtils._monitorHashMap.get("monitor_"+t.id).overlays;a.put(i.monitor_id,i)}else{var o=new DT.HashMap;o.put(i.monitor_id,i),t.overlays=o,MonitorUtils._monitorHashMap.put("monitor_"+t.id,t)}},MonitorUtils.removeMonitor=function(t){if(MonitorUtils._monitorHashMap)for(var e=MonitorUtils._monitorHashMap.values(),i=0;i<e.length;i++){var n=e[i],r=n.overlays.get(t.feature_id);r&&(MonitorUtils._map.removeOverlay(r),n.overlays.remove(t.feature_id),$("[data-id='"+t.feature_id+"']").remove())}$("[data-id='"+t.feature_id+"']").remove()},MonitorUtils.removeMonitorItem=function(){$(".destroy-monitor").unbind().click(function(t){var e=$(t.target).attr("data-monitor-id");PromptInfo.xcConfirm("\u786e\u5b9a\u8981\u5220\u9664\u9884\u8b66\u8bbe\u7f6e\u4e48?",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){MapUtils.ajax2server(destroy_monitor_url,"DELETE",{monitor_id:e},function(){var i,n=MonitorUtils._monitorHashMap.get("monitor_"+e),r=$("#monitor_has_bubble_"+e).is(":checked");if($(t.target).closest(".dt-border-cc").remove(),n){if("marker_layer"==n.layer_type?i=MonitorUtils._layersHashMap.get("m_"+n.layer_id):"line_layer"==n.layer_type?i=MonitorUtils._layersHashMap.get("l_"+n.layer_id):"region_layer"==n.layer_type&&(i=MonitorUtils._layersHashMap.get("r_"+n.layer_id)),r&&MonitorUtils._monitorHashMap.containsKey("monitor_"+e)){for(var a=MonitorUtils._monitorHashMap.get("monitor_"+e).overlays.values(),o=0;o<a.length;o++){var s=a[o];MonitorUtils._map.removeOverlay(s),$("#pop").slideUp(400)}MonitorUtils._monitorHashMap.remove("monitor_"+e)}var l=parseInt($(".monitor-warning-count").text()-1);$(".monitor-warning-count").text(l);for(var d=0;d<i.monitors.length;d++){var n=i.monitors[d];n.id==e&&i.monitors.splice(d,1)}}})}})})},MonitorUtils.getMonitorDate=function(t){return"\u4e00\u5929"==t?moment().add(1,"day").format("YYYY-MM-DD"):"\u4e24\u5929"==t?moment().add(2,"day").format("YYYY-MM-DD"):"\u4e09\u5929"==t?moment().add(3,"day").format("YYYY-MM-DD"):"\u4e00\u5468"==t?moment().add(7,"day").format("YYYY-MM-DD"):"\u4e24\u5468"==t?moment().add(14,"day").format("YYYY-MM-DD"):"\u4e00\u4e2a\u6708"==t?moment().add(30,"day").format("YYYY-MM-DD"):void 0},MonitorUtils.addMonitorItem=function(t,e,i){MonitorUtils.clearMonitor(t),$("#popIntro").empty();var n,r,a;"marker_layer"==i?(n=MonitorUtils._layersHashMap.get("m_"+t),r=n.getMarkers().values(),a="marker"):"region_layer"==i?(n=MonitorUtils._layersHashMap.get("r_"+t),r=n.getRegions().values(),a="region"):"line_layer"==i&&(n=MonitorUtils._layersHashMap.get("l_"+t),r=n.getLines().values(),a="line"),e.monitor.overlays=new DT.HashMap,MonitorUtils._monitorHashMap.put("monitor_"+e.monitor.id,e.monitor),n.monitors?n.monitors.push(e.monitor):(n.monitors=new Array,n.monitors.push(e.monitor));for(var o=0;o<r.length;o++){var s=r[o];MonitorUtils.getOverlayMonitor(n,s,a,!0),$("#dtMonitorWarningPanel .chk_4").unbind().click(function(){MonitorUtils.isShowMonitor($(this))})}$("#popIntro").children().length>0&&e.monitor.open&&($("#pop").slideDown(400),$("#popClose").unbind().click(function(){$("#pop").slideUp(400),$("#popIntro").empty()}))},MonitorUtils.closeMonitorPlug=function(){if(MonitorUtils._monitorHashMap){var t=MonitorUtils._monitorHashMap.values();$("#pop").slideUp(400),$("#popIntro").empty();for(var e=0;e<t.length;e++)for(var i=t[e],n=i.overlays.values(),r=0;r<n.length;r++){var a=n[r];MonitorUtils._map.removeOverlay(a)}}},MonitorUtils.initOverlayMonitor=function(){for(var t=MonitorUtils._layersHashMap.values(),e=0;e<t.length;e++){var i=t[e];if(i.monitors){var n=parseInt($(".monitor-warning-count").text());$(".monitor-warning-count").text(n+i.monitors.length);var r=PermissionUtils.loginUserRole(user_phone,{mapUsers:MonitorUtils._map.cooperation});if(["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458"].indexOf(r)>=0)for(var a=0;a<i.monitors.length;a++){var o=i.monitors[a];MonitorUtils.createMonitorPanel(o)}if("marker_layer"==i.type)for(var s=i.getMarkers().values(),l=0;l<s.length;l++){var d=s[l];MonitorUtils.getOverlayMonitor(i,d,"marker",!0)}else if("region_layer"==i.type)for(var h=i.getRegions().values(),c=0;c<h.length;c++){var u=h[c];MonitorUtils.getOverlayMonitor(i,u,"region",!0)}else if("line_layer"==i.type)for(var p=i.getLines().values(),f=0;f<p.length;f++){var m=p[f];MonitorUtils.getOverlayMonitor(i,m,"line",!0)}}}if("undefined"!=typeof MonitorUtils._monitorHashMap&&MonitorUtils._monitorHashMap)for(var g=MonitorUtils._monitorHashMap.values(),_=0;_<g.length;_++){var y=g[_];$("#popIntro").children().length>0&&y.open&&has_message_audio&&($("#pop").slideDown(400),$("#popClose").unbind().click(function(){$("#pop").slideUp(400),$("#popIntro").empty()}))}},MonitorUtils.clearMonitor=function(t){if(MonitorUtils._monitorHashMap)for(var e=MonitorUtils._monitorHashMap.values(),i=0;i<e.length;i++){var n=e[i];if(n.layer_id==t)for(var r=n.overlays.values(),a=0;a<r.length;a++){var o=r[a];MonitorUtils._map.removeOverlay(o)}}},MonitorUtils.showMonitors=function(t,e){if(t)for(var i=t.monitors,n=0;i&&n<i.length;n++){var r=i[n];if(r&&r.overlays&&r.open)for(var a=r.overlays.values(),o=0;o<a.length;o++){var s=a[o];e?0==e.length?s.hide():e.indexOf(s.monitor_id)==-1?s.hide():s.show():s.show()}}}});var DirectionUtils=window.DirectionUtils=DirectionUtils||{};$(function(){function t(t,e){$(".start-point").remove(),$(".end-point").remove(),$(".path-position").empty(),$("#dtDirectionPanel").attr("type","edit").data("line",e);var i={name:e.line_route.origin_point.name,lnglat:e.line_route.origin_point.lnglat,layer_id:e.line_route.origin_point.layer_id,marker_id:e.line_route.origin_point.marker_id};$(".start-position").data("start",i);var n={name:e.line_route.destination_point.name,lnglat:e.line_route.destination_point.lnglat,layer_id:e.line_route.destination_point.layer_id,marker_id:e.line_route.destination_point.marker_id};$(".end-position").data("end",n);for(var r=[],a="",o=0;o<e.line_route.way_points.length;o++){var s=e.line_route.way_points[o];a+=o<e.line_route.way_points.length-1?s.marker_id+",":s.marker_id;var l={name:s.name,lnglat:s.lnglat,layer_id:s.layer_id,marker_id:s.marker_id};r.push(l);var d='<p class="dt-mar4y dt-hidden">';d+='<span class="dt-mar2t pull-left">\u7ecf:</span>',d+='<input value="'+s.name+'" placeholder="\u9014\u7ecf\u70b9" class="input-path-point dt-w168 dt-mar12l" style="display:none;"/>',d+='<span class="path-point">',d+='<span class="dt-mar12l dt-show dt-w210 pull-left">'+s.name+"</span>",d+="</span>",d+='<span class="remove-path-point dt-line-18h dt-pointer glyphicon glyphicon-minus-sign pull-right" marker-id="'+s.marker_id+'"></span>',d+="</p>",$(".path-position").append(d)}$(".path-position").attr("markers",a).data("markers",r),$(".direction-layer-panel").addClass("dt-none"),$(".direction-layer-panel").next().addClass("dt-none"),$(".input-path-point").unbind().focus(function(t){$(t.target).closest("p").css("border-bottom","1px solid #0088cc");for(var e=ToolBar.allMarker.values(),i=[],n=0;n<e.length;n++)i.push(e[n].getTitle());$(this).autocomplete({source:i,scrollHeight:240})}).blur(function(t){$(t.target).closest("p").css("border-bottom","1px solid #ccc"),$(t.target).css("display","none"),$(t.target).closest("p").find(".path-point").show()}),$(".dt-direction").trigger("click"),$("#dtDirectionPanel").find("#simple_direction_settings").trigger("click")}DirectionUtils.init=function(e){has_direction=!0;var i="<div id='"+e+"' class='slider-bar' style='display:none;'>";i+="<p style='height:31px;' class='dt-pad10x dt-line-30h'>",i+="<span class='glyphicon glyphicon-road dt-mar6r'></span>\u667a\u80fd\u8def\u7ebf\u89c4\u5212",i+="</p>",i+="<hr style='margin-top:0;margin-bottom:0;'>",i+="<ul class='nav nav-tabs'>",i+="</ul>",i+="<div class='tab-content'>",i+="<div role='tabpanel' class='tab-pane' id='direction_settings'>",i+="</div>",i+="<div role='tabpanel' class='tab-pane active' id='simple_direction_settings'>",i+="<div class='dt-mar12x dt-mar12y dt-border-cc direction-style'>",i+="<p class='dt-bg-f1 dt-pad4x dt-pad4y'>\u8def\u5f84\u89c4\u5212</p>",i+='<div class="dt-pad6x direction-overlay-panel">',i+='<div class="start-position dt-mar8t dt-hidden">',i+="<span id='startPoint' class='pull-left dt-mar2t'>\u8d77:</span>",i+="<input value='' type='text' placeholder='\u8bf7\u8f93\u5165\u8d77\u59cb\u70b9' class='input-start-point dt-w168 dt-mar12l' style='display:none'/>",i+="<span class='glyphicon glyphicon-plus-sign dt-pointer add-path-point pull-right dt-line-18h'></span>",i+="</div>",i+="<div class='path-position dt-hidden'>",i+="</div>",i+="<div class='end-position dt-hidden'>",i+="<span id='endPoint' class='pull-left dt-mar2t'>\u7ec8:</span>",i+='<input type="text" value="" placeholder="\u8bf7\u8f93\u5165\u7ec8\u6b62\u70b9,\u7ec8\u6b62\u70b9\u53ef\u4e3a\u7a7a" class="input-end-point dt-w168 dt-mar12l" style="display:none"/>',i+="</div>",i+="</div>",i+="<div class='text-center dt-mar8t dt-mar6b'>",i+="<a href='###' id='PlanningLine' class='btn btn-primary'>\u89c4\u5212\u8def\u7ebf</a>",i+="<a href='###' id='saveDirectionLine' class='btn btn-primary dt-mar24l'>\u4fdd\u5b58\u8def\u7ebf</a>",i+="</div>",i+="</div>",i+="</div>",i+="</div>",i+="<div class='dt-mar12x dt-mar12y dt-hidden'>",i+="<p class='color77 dt-mar12b'>\u529f\u80fd\u8bf4\u660e\uff1a<br> <span>\u9009\u53d6\u591a\u4e2a\u6807\u6ce8\u70b9\uff0c\u5c06\u81ea\u52a8\u89c4\u5212\u4e00\u6761\u6700\u4f18\u7684\u4e32\u8054\u8def\u5f84\u3002</span></p>",i+="<span class='dt-show dt-mar4t color77'>\u9009\u53d6\u8d77\u70b9\u3001\u9014\u7ecf\u70b9\u548c\u7ec8\u70b9\u7684\u65b9\u5f0f\uff1a</span>",i+="<span class='dt-show dt-mar4t color77'>\u65b9\u5f0f\u4e00\uff1a\u8f93\u5165\u6846\u4e2d\u76f4\u63a5\u8f93\u5165\u6807\u6ce8\u540d\u79f0</span>",i+="<span class='dt-show dt-mar4t color77'>\u65b9\u5f0f\u4e8c\uff1a\u9009\u4e2d\u8f93\u5165\u6846\u540e\uff0c\u5728\u5730\u56fe\u4e0a\u70b9\u51fb\u6807\u6ce8\u70b9</span>",i+="</div>",i+="</div>",$("#mapInfoWrapper").append(i),$(document).on("edit.line_route",t),$(".add-path-point").click(function(t,e){if($(".path-position").find("p").length>=20){if($(".popBox").is(":visible"))return;return void PromptInfo.xcConfirm("\u9014\u7ecf\u70b9\u4e0d\u80fd\u8d85\u8fc720\u4e2a",PromptInfo.xcConfirm.typeEnum.info)}if("batch"!=e){var i='<p class="dt-mar4y dt-hidden">';i+='<span class="pull-left dt-mar2t">\u7ecf:</span>',i+="<input value='' placeholder='\u8bf7\u8f93\u5165\u9014\u7ecf\u70b9' class='input-path-point dt-w168 dt-mar12l'/>",i+='<span class="remove-path-point dt-line-18h dt-pointer glyphicon glyphicon-minus-sign pull-right"></span>',i+="</p>",$(".path-position").append(i)}$(".input-path-point").unbind().focus(function(t){$(t.target).closest("p").css("border-bottom","1px solid #0088cc"),$(".path-position").find(".path-point-active").removeClass("path-point-active"),$(t.target).closest("p").addClass("path-point-active");for(var e=ToolBar.allMarker.values(),i=new Array,r=0;r<e.length;r++)i.push(e[r].getTitle());$(this).autocomplete({source:i,select:function(t,e){for(var i=ToolBar.allMarker.values(),r=0;r<i.length;r++)if(i[r].getTitle()==e.item.value){var a=i[r];break}a&&(n=!0,DirectionUtils.addPathPoint(a,t.target))}})}).blur(function(t){$(t.target).closest("p").css("border-bottom","1px solid #ccc"),$(t.target).css("display","none"),$(t.target).closest("p").find(".path-point").show()}),$(".input-path-point").focus()}),$(".path-position").click(function(t){if(!($(t.target).hasClass("path-position")||$(t.target).is("input")||$(t.target).hasClass("path-point")))if($(t.target).hasClass("remove-path-point")){var e=$(t.target).attr("marker-id");if($(t.target).closest("p").remove(),e){var i=$(".path-position").attr("markers").split(","),n=$(".path-position").data("markers"),r="";i.indexOf(e)>=0&&(r=n.splice(i.indexOf(e),1),i.splice(i.indexOf(e),1),$(".path-position").data("markers",n)),$(".path-position").attr("markers",i.join(","))}}else $(".remove-path-point").each(function(){$(this).prev().hasClass("path-point")||$(this).closest("p").find(".remove-path-point").addClass("dt-none")}),$(".path-position").find("p").removeClass("path-point-active"),$(".input-path-point").hide(),$(".end-position").find("input").hide(),$(".start-position").find("input").hide(),$(".end-point").show(),$(".start-point").show(),$(".path-point").show(),$(t.target).closest("p").addClass("path-point-active"),$(".path-point-active").find(".path-point").hide(),$(t.target).closest("p").find("input").show(),$(t.target).closest("p").find(".path-point").hide(),$(t.target).closest("p").find("input").focus(),$(t.target).closest("p").find(".remove-path-point").removeClass("dt-none")}),$(".path-position").keyup(function(t){if(13==t.keyCode&&0==$(t.target).val().length)$(t.target).hide(),$(t.target).closest("p").find(".path-point").remove(),$(t.target).next().hide();else if(13==t.keyCode){if(n)return void(n=!1);$(t.target).closest("p").find(".path-point").remove();for(var e=ToolBar.allMarker.values(),i=0;i<e.length;i++)if(e[i].getTitle()==$(t.target).val()){var r=e[i];break}r?DirectionUtils.addPathPoint(r,t.target):(PromptInfo.xcConfirm("\u8f93\u5165\u7684\u6807\u6ce8\u4e0d\u5b58\u5728\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165!",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){$(t.target).focus()}}),$(t.target).val(""),$(t.target).trigger("click"))}}),$(".start-position").click(function(t){return $(t.target).hasClass("remove-start-point")?($(".start-point").remove(),$(".start-position").find("input").val(""),
$(".start-position").data("start",""),void window.localStorage.removeItem(mid+"_startPoint")):void($(t.target).hasClass("add-path-point")||($(".remove-path-point").each(function(){$(this).prev().hasClass("path-point")||$(this).closest("p").find(".remove-path-point").addClass("dt-none")}),$(".remove-path-point").removeAttr("style"),$(".end-position").find("input").hide(),$(".path-position").find("input").hide(),$(".end-point").show(),$(".path-point").show(),$(this).find("input").show(),$(this).find("input").focus(),$(".start-point").hide()))}),$(".end-position").click(function(t){return $(t.target).hasClass("remove-end-point")?($(".end-point").remove(),$(".end-position").find("input").val(""),$(".end-position").data("end",""),void window.localStorage.removeItem(mid+"_endPoint")):($(".remove-path-point").each(function(){$(this).prev().hasClass("path-point")||$(this).closest("p").find(".remove-path-point").addClass("dt-none")}),$(".remove-path-point").removeAttr("style"),$(".start-position").find("input").hide(),$(".path-position").find("input").hide(),$(".start-point").show(),$(".path-point").show(),$(this).find("input").show(),$(this).find("input").focus(),void $(".end-point").hide())});var n=!1;$(".input-start-point").unbind().focus(function(){$(".start-position").css("border-bottom","1px solid #0088cc");for(var t=ToolBar.allMarker.values(),e=new Array,i=0;i<t.length;i++)e.push(t[i].getTitle());$(this).autocomplete({source:e,scrollHeight:240,select:function(t,e){for(var i=ToolBar.allMarker.values(),r=0;r<i.length;r++)if(i[r].getTitle()==e.item.value){var a=i[r];break}a&&(n=!0,DirectionUtils.addStartPoint(a))}})}),$(".input-start-point").blur(function(){setTimeout(function(){$(".start-position").css("border-bottom","1px solid #ccc"),$(this).css("display","none"),$(".start-point").show()},100)}),$(".input-start-point").keyup(function(t){if(13==t.keyCode&&0==$(".input-start-point").val().length)$(".input-start-point").hide();else if(13==t.keyCode){if(n)return void(n=!1);$(".start-point").remove();for(var e=ToolBar.allMarker.values(),i=0;i<e.length;i++)if(e[i].getTitle()==$(".input-start-point").val()){var r=e[i];break}r?DirectionUtils.addStartPoint(r):(PromptInfo.xcConfirm("\u8f93\u5165\u7684\u6807\u6ce8\u4e0d\u5b58\u5728\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165!",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){$(".input-start-point").focus()}}),$(".input-start-point").val("").trigger("click"))}}),$(".input-end-point").unbind().focus(function(){$(".end-position").css("border-bottom","1px solid #0088cc");for(var t=ToolBar.allMarker.values(),e=new Array,i=0;i<t.length;i++)e.push(t[i].getTitle());$(this).autocomplete({source:e,select:function(t,e){for(var i=ToolBar.allMarker.values(),r=0;r<i.length;r++)if(i[r].getTitle()==e.item.value){var a=i[r];break}a&&(n=!0,DirectionUtils.addEndPoint(a))}})}),$(".input-end-point").blur(function(){setTimeout(function(){$(".end-position").css("border-bottom","1px solid #ccc"),$(this).css("display","none"),$(".end-point").show()},100)}),$(".input-end-point").keyup(function(t){if(13==t.keyCode&&0==$(".input-end-point").val().length)$(".input-end-point").hide();else if(13==t.keyCode){if(n)return void(n=!1);$(".end-point").remove();for(var e=ToolBar.allMarker.values(),i=0;i<e.length;i++)if(e[i].getTitle()==$(".input-end-point").val()){var r=e[i];break}r?DirectionUtils.addEndPoint(r):(PromptInfo.xcConfirm("\u8f93\u5165\u7684\u6807\u6ce8\u4e0d\u5b58\u5728\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165!",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){$(".input-end-point").focus()}}),$(".input-end-point").val(""),$(".input-end-point").trigger("click"))}}),$("#PlanningLine").click(function(){if([0,4].indexOf(org_level)==-1)return void PromptInfo.xcConfirm(org_error_txt,PromptInfo.xcConfirm.typeEnum.info);DirectionUtils.removeDirectionOverlay();var t=$(".start-position").data("start");if(!t)return void PromptInfo.xcConfirm("\u8d77\u59cb\u70b9\u4e0d\u80fd\u4e3a\u7a7a",PromptInfo.xcConfirm.typeEnum.info);var e=$(".end-position").data("end");e||(e=t);var i=$(".path-position").data("markers"),n=t.lnglat,r=e.lnglat,a=new Array;if(i)for(var o=0;o<i.length;o++){var s=i[o];a.push(s.lnglat)}else if(e.marker_id==t.marker_id&&!i)return void PromptInfo.xcConfirm("\u8bf7\u8f93\u5165\u7ec8\u70b9",PromptInfo.xcConfirm.typeEnum.info);var l={origin:n,waypoints:a,destination:r,mid:mid},d="\u8def\u5f84\u89c4\u5212\u5931\u8d25\uff01\u90e8\u5206\u8def\u5f84\u8282\u70b9\u65e0\u53ef\u8fde\u63a5\u9053\u8def\uff0c\u8bf7\u91cd\u65b0\u786e\u8ba4\u8d77\u59cb\u70b9\u3001\u9014\u7ecf\u70b9\u6216\u7ec8\u6b62\u70b9\u3002";MapUtils.ajax2server(direction_url,"POST",l,function(o){if($(".direction-panel").remove(),DirectionUtils.removeDirectionOverlay(),"undefined"==typeof o.path||null==o.path||""==o.path)return void PromptInfo.xcConfirm(d,PromptInfo.xcConfirm.typeEnum.error);var s=new Dtwy.Polyline(MapUtils.convertStr2LeafletPath(o.path));s.attrs=[{key:"\u7ad9\u70b9\u6570",value:o.waypoints_order.length},{key:"\u8ddd\u79bb",value:""},{key:"\u8d1f\u8d23\u4eba",value:""}];var l={marker_id:t.marker_id,name:t.name,lnglat:n},h={marker_id:e.marker_id,name:e.name,lnglat:r},c=[],u=new L.divIcon({html:"<div class='way-points'>\u8d77</div>",className:"leaflet-direction-icon"}),p=new Dtwy.Marker(MarkerUtils.strLngLat2Point(t.lnglat),{icon:u});s.layerGroup=new L.LayerGroup([p]);for(var f=0;f<o.waypoints_order.length;f++){var m=o.waypoints_order[f],g=i[m],_=MarkerUtils.strLngLat2Point(g.lnglat),y=new L.divIcon({html:"<div class='way-points'>"+(f+1)+"</div>",className:"leaflet-direction-icon"}),v=new Dtwy.Marker(_,{icon:y});s.layerGroup.addLayer(v),c.push({marker_id:g.marker_id,name:g.name,lnglat:a[m]})}var b=new L.divIcon({html:"<div class='way-points'>\u7ec8</div>",className:"leaflet-direction-icon"}),w=new Dtwy.Marker(MarkerUtils.strLngLat2Point(e.lnglat),{icon:b});s.layerGroup.addLayer(w),s.title=t.name+"-"+e.name,s.line_route={origin_point:l,destination_point:h,way_points:c,distance:o.distance},s.addTo(ToolBar._map),ToolBar._map.dt_direction=s;var x='<div class="direction-panel dt-pad6x dt-mar12t">';x+='<span class="glyphicon glyphicon-eye-open dt-pointer direction-line pull-left dt-mar4t dt-mar12r"></span>',x+='<span class="dt-f14 dt-show dt-w210 pull-left dt-truncate">'+t.name+"\u2014"+e.name+"</span>",x+='<span class="remove-direction-line dt-pointer pull-right glyphicon glyphicon-minus-sign"></span><br>',x+='<p class="dt-mar24l dt-f12">\u5171<span class="num">'+(o.waypoints_order.length+2)+'</span>\u4e2a\u70b9 <span class="dt-mar12l">'+(o.distance/1e3).toFixed(2)+"\u516c\u91cc</span></p>","edit"!=$("#dtDirectionPanel").attr("type")&&(x+="<div class='dt-pad6x direction-layer-panel dt-mar12t'>",x+="<span>\u4fdd\u5b58\u81f3\uff1a</span>",x+="<select class='select-direction-layer form-control dt-w168 dt-mar12l'>",x+="</select>",x+="</div>"),x+='<hr class="dt-mar4y">',x+="</div>",$("#PlanningLine").parent().before(x),"edit"!=$("#dtDirectionPanel").attr("type")&&(DirectionUtils.getLineLayer(DirectionUtils.layersHashMap),$(".direction-layer-panel").removeClass("dt-none").next().removeClass("dt-none")),$(".select-direction-layer").unbind().change(function(){var t=$(this).val();MapUtils.ajax2server(update_routing_layer_url,"PUT",{routing_layer_id:t},function(){ToolBar._map.routing_layer_id=t})}),$(".remove-direction-line").unbind().click(function(){PromptInfo.xcConfirm("\u662f\u5426\u5220\u9664\u5f53\u524d\u89c4\u5212\u8def\u7ebf\uff1f",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){$(".direction-panel").remove(),DirectionUtils.removeRichMarkers(),DirectionUtils.removeDirectionOverlay()}})}),$(".direction-line").click(function(){if(ToolBar._map.dt_direction.isVisible()){if($(".direction-panel").find(".glyphicon-eye-open").removeClass("glyphicon-eye-open").addClass("glyphicon-eye-close"),ToolBar._map.richMarkers&&ToolBar._map.richMarkers.length>0)for(var t=0;t<ToolBar._map.richMarkers.length;t++)ToolBar._map.richMarkers[t].hide();ToolBar._map.dt_direction.hide()}else{if($(".direction-panel").find(".glyphicon-eye-close").removeClass("glyphicon-eye-close").addClass("glyphicon-eye-open"),ToolBar._map.richMarkers&&ToolBar._map.richMarkers.length>0)for(var t=0;t<ToolBar._map.richMarkers.length;t++)ToolBar._map.richMarkers[t].show();ToolBar._map.dt_direction.show()}})},function(t){t.responseJSON&&t.responseJSON.msg&&(d=t.responseJSON.msg),PromptInfo.xcConfirm(d,PromptInfo.xcConfirm.typeEnum.warning)})}),$("#saveDirectionLine").unbind().click(function(){if(!ToolBar._map.dt_direction)return void PromptInfo.xcConfirm("\u8bf7\u5148\u89c4\u5212\u8def\u5f84\u540e\uff0c\u518d\u8fdb\u884c\u4fdd\u5b58\u3002",PromptInfo.xcConfirm.typeEnum.info);var t=ToolBar._map.dt_direction.line_route;if("edit"==$("#dtDirectionPanel").attr("type")){var e=$("#dtDirectionPanel").data("line");if(e&&1==e.line_type&&t){var i={mid:mid,id:e.feature_id,line_route:JSON.stringify(t),path:ToolBar._map.dt_direction.getPathString()};MapUtils.ajax2server(update_line_route_url,"PUT",i,function(){DirectionUtils.removeDirectionOverlay(),DirectionUtils.reloadControl()})}}else{DirectionUtils.removeRichMarkers();var n=$(".select-direction-layer").val(),r=ToolBar._map.dt_direction.getPathString(),a=ToolBar._map.dt_direction.title,o=ToolBar._layersHashMap.get("l_"+n),s={};if(o){var l=o.getUniformTitle();if(l)s[l]=a;else{var d=o.getAttrFields();d&&d[0]?s[d[0].field]=a:s["\u6807\u9898"]=a}}else s["\u6807\u9898"]=a;var i={mid:mid,line_layer_id:n,attrs:s,line_type:1,line_route:JSON.stringify(t),path:r};MapUtils.ajax2server(add_line_url,"POST",i,function(){DirectionUtils.reloadControl()})}})},DirectionUtils.restore=function(){if(localStorage){var t,e=localStorage.getItem(mid+"_startPoint");if(e){var i=e.split(",")[0],n=e.split(",")[1],r=DirectionUtils.layersHashMap.get("m_"+i);r&&(t=r.getMarker(n),t&&t.getTitle()&&t.getTitle().length>0&&DirectionUtils.addStartPoint(t))}var a=localStorage.getItem(mid+"_endPoint");if(a){var o=a.split(",")[0],s=a.split(",")[1],l=DirectionUtils.layersHashMap.get("m_"+o);l&&(t=l.getMarker(s),t&&t.getTitle()&&t.getTitle().length>0&&DirectionUtils.addEndPoint(t))}}},DirectionUtils.removeRichMarkers=function(){if(ToolBar._map.richMarkers&&ToolBar._map.richMarkers.length>0){for(var t=0;t<ToolBar._map.richMarkers.length;t++)ToolBar._map.removeOverlay(ToolBar._map.richMarkers[t]);ToolBar._map.richMarkers.length=0,delete ToolBar._map.richMarkers}},DirectionUtils.removeDirectionOverlay=function(){ToolBar._map.dt_direction&&(ToolBar._map.removeOverlay(ToolBar._map.dt_direction),delete ToolBar._map.dt_direction)},DirectionUtils.addStartPoint=function(t){if(t){$(".start-point").remove(),$(".input-start-point").val(t.getTitle());var e=($(".end-position").data("end"),$(".path-position").attr("markers"));e&&e.indexOf(t.feature_id)>=0?$(".path-position").children().each(function(){var e=$(this).find(".remove-path-point").attr("marker-id"),i=$(this);e==t.feature_id&&PromptInfo.xcConfirm("\u5f53\u524d\u6807\u6ce8\u5df2\u7ecf\u88ab\u8bbe\u7f6e\u4e3a\u9014\u7ecf\u70b9\uff0c\u662f\u5426\u66ff\u6362\u6210\u8d77\u70b9\uff1f",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){i.find(".remove-path-point").trigger("click"),DirectionUtils.createStartPointHtml(t)},onCancel:function(){$(".input-start-point").val("")}})}):($(".path-position").find("p").length<20&&$(".add-path-point").trigger("click"),t&&t.getTitle()&&t.getTitle().length>0?DirectionUtils.createStartPointHtml(t):PromptInfo.xcConfirm("\u6807\u6ce8\u70b9\u6807\u9898\u4e3a\u7a7a\uff0c\u8bf7\u5148\u7f16\u8f91\u6807\u9898\u540e\u518d\u8fdb\u884c\u9009\u62e9",PromptInfo.xcConfirm.typeEnum.info)),window.localStorage&&window.localStorage.setItem(mid+"_startPoint",[t.layer_id,t.feature_id])}},DirectionUtils.addEndPoint=function(t){if("undefined"!=typeof t&&null!=t){$(".end-point").remove(),$(".input-end-point").val(t.getTitle());var e=($(".start-position").data("start"),$(".path-position").attr("markers"));e&&e.indexOf(t.feature_id)>=0?$(".path-position").children().each(function(){var e=$(this).find(".remove-path-point").attr("marker-id"),i=$(this);e==t.feature_id&&PromptInfo.xcConfirm("\u5f53\u524d\u6807\u6ce8\u5df2\u7ecf\u88ab\u8bbe\u7f6e\u4e3a\u9014\u7ecf\u70b9\uff0c\u662f\u5426\u66ff\u6362\u6210\u7ec8\u70b9\uff1f",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){i.find(".remove-path-point").trigger("click"),DirectionUtils.createEndPointHtml(t)},onCancel:function(){$(".input-end-point").val("")}})}):t&&t.getTitle()&&t.getTitle().length>0?DirectionUtils.createEndPointHtml(t):PromptInfo.xcConfirm("\u6807\u6ce8\u70b9\u6807\u9898\u4e3a\u7a7a\uff0c\u8bf7\u5148\u7f16\u8f91\u6807\u9898\u540e\u518d\u8fdb\u884c\u9009\u62e9",PromptInfo.xcConfirm.typeEnum.info),window.localStorage&&window.localStorage.setItem(mid+"_endPoint",[t.layer_id,t.feature_id])}},DirectionUtils.createStartPointHtml=function(t){var e='<span class="start-point">';e+='<span class="dt-mar12l dt-show dt-w200 pull-left">'+t.getTitle()+"</span>",e+='<span class="remove-start-point dt-line-18h dt-mar6r dt-pointer glyphicon glyphicon-minus-sign pull-right" marker-id="'+t.feature_id+'"></span>',e+="</span>",$(".input-start-point").hide(),$(".add-path-point").after(e);var i=t.getPosition(),n={name:t.getTitle(),lnglat:i.lng+","+i.lat,layer_id:t.layer_id,marker_id:t.feature_id};$(".start-position").data("start",n),$(".remove-start-point").unbind().click(function(){$(".start-point").remove(),$(".start-position").data("start","")})},DirectionUtils.createEndPointHtml=function(t){var e='<span class="end-point">';e+='<span class="dt-mar12l pull-left dt-show dt-w210">'+t.getTitle()+"</span>",e+='<span class="remove-end-point dt-line-18h dt-pointer glyphicon glyphicon-minus-sign pull-right" marker-id="'+t.feature_id+'"></span>',e+="</span>",$(".input-end-point").hide(),$("#endPoint").after(e);var i=t.getPosition(),n={name:t.getTitle(),lnglat:i.lng+","+i.lat,layer_id:t.layer_id,marker_id:t.feature_id};$(".end-position").data("end",n),$(".remove-end-point").unbind().click(function(){$(".end-point").remove(),$(".end-position").data("end","")})},DirectionUtils.createPathPointHtml=function(t,e){if($(".path-position").data("markers")&&$(".path-position").attr("markers")){var i=$(".path-position").attr("markers").split(","),n=$(".path-position").data("markers"),r=$(e).next().attr("marker-id");if($(".path-position").attr("markers").indexOf(t.feature_id)>=0){if(t.feature_id==$(e).next().attr("marker-id")){var a='<span class="path-point">';a+='<span class="dt-mar12l pull-left dt-w210 dt-show">'+t.getTitle()+"</span>",a+="</span>",$(e).val(t.getTitle()),$(e).next().removeClass("dt-none").removeAttr("style").attr("marker-id",t.feature_id),$(e).after(a),$(e).hide()}else 0==$(".popBox").length&&PromptInfo.xcConfirm("\u60a8\u5df2\u7ecf\u6dfb\u52a0\u8fc7\u8be5\u9014\u7ecf\u70b9",PromptInfo.xcConfirm.typeEnum.info,{onOk:function(){$(e).val("")}});return}if(r)for(var o=0;o<n.length;o++){var s=n[o];if(s.marker_id==r){i.splice(i.indexOf(r),1),n.splice(o,1);break}}i.length>0?$(".path-position").attr("markers",i.join(",")+","+t.feature_id):$(".path-position").attr("markers",t.feature_id);var l={name:t.getTitle(),lnglat:t.getPosition().lng+","+t.getPosition().lat,layer_id:t.layer_id,marker_id:t.feature_id};n.push(l)}else{$(".path-position").attr("markers",t.feature_id);var l={name:t.getTitle(),lnglat:t.getPosition().lng+","+t.getPosition().lat,layer_id:t.layer_id,marker_id:t.feature_id};$(".path-position").data("markers",[l])}if($(".path-point-active").find(".path-point").length>0){$(".path-point-active").find(".remove-path-point").removeAttr("style");var d=$(".path-point-active").find(".remove-path-point").attr("marker-id"),i=$(".path-position").attr("markers").split(","),h=$(".path-position").data("markers");i.indexOf(d)>=0&&(i.splice(i.indexOf(d),1),h.splice(i.indexOf(d),1)),$(".path-position").attr("markers",i.join(",")),$(".path-point-active").find(".path-point").children().first().text(t.getTitle()),$(".path-point-active").find(".remove-path-point").attr("marker-id",t.feature_id),$(".path-point-active").find("input").val(t.getTitle()),$(".path-point-active").find("input").hide(),$(".path-point-active").find(".path-point").show()}else{var a='<span class="path-point">';a+='<span class="dt-mar12l pull-left dt-w210 dt-show">'+t.getTitle()+"</span>",a+="</span>",$(e).val(t.getTitle()),$(e).next().removeClass("dt-none").removeAttr("style").attr("marker-id",t.feature_id),$(e).after(a),$(e).hide()}return $(".path-position").find(".path-point-active").removeClass("path-point-active"),i&&i.length>=20?void(0==$(".popBox").length&&PromptInfo.xcConfirm("\u9014\u7ecf\u70b9\u6570\u91cf\u8d85\u8fc7\u4e0a\u9650(\u6700\u591a\u652f\u630120\u4e2a)",PromptInfo.xcConfirm.typeEnum.info)):void $(".add-path-point").trigger("click")},DirectionUtils.addPathPoint=function(t,e){$(e).parent().find(".path-point").remove();var i=$(".start-position").data("start"),n=$(".end-position").data("end");i&&t.feature_id==i.marker_id&&n&&t.feature_id==n.marker_id?0==$(".popBox").length&&PromptInfo.xcConfirm("\u5f53\u524d\u6807\u6ce8\u5df2\u7ecf\u88ab\u8bbe\u7f6e\u4e3a\u8d77\u70b9\u548c\u7ec8\u70b9\uff0c\u662f\u5426\u66ff\u6362\u6210\u9014\u7ecf\u70b9\uff1f",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){$(".remove-start-point").trigger("click"),$(".remove-end-point").trigger("click"),DirectionUtils.createPathPointHtml(t,e)},onCancel:function(){}}):i&&t.feature_id==i.marker_id?0==$(".popBox").length&&PromptInfo.xcConfirm("\u5f53\u524d\u6807\u6ce8\u5df2\u7ecf\u88ab\u8bbe\u7f6e\u4e3a\u8d77\u70b9\uff0c\u662f\u5426\u66ff\u6362\u6210\u9014\u7ecf\u70b9\uff1f",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){$(".remove-start-point").trigger("click"),DirectionUtils.createPathPointHtml(t,e)},onCancel:function(){}}):n&&t.feature_id==n.marker_id?0==$(".popBox").length&&PromptInfo.xcConfirm("\u5f53\u524d\u6807\u6ce8\u5df2\u7ecf\u88ab\u8bbe\u7f6e\u4e3a\u7ec8\u70b9\uff0c\u662f\u5426\u66ff\u6362\u6210\u9014\u7ecf\u70b9\uff1f",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){$(".remove-end-point").trigger("click"),DirectionUtils.createPathPointHtml(t,e)},onCancel:function(){}}):t&&t.getTitle()&&t.getTitle().length>0?DirectionUtils.createPathPointHtml(t,e):PromptInfo.xcConfirm("\u6807\u6ce8\u70b9\u6807\u9898\u4e3a\u7a7a\uff0c\u8bf7\u5148\u7f16\u8f91\u6807\u9898\u540e\u518d\u8fdb\u884c\u9009\u62e9",PromptInfo.xcConfirm.typeEnum.info)},DirectionUtils.reloadControl=function(){$(".start-position").data("start",""),$(".input-start-point").val(""),$(".input-end-point").val(""),$(".end-position").data("end",""),$(".path-position").removeAttr("markers").data("markers","").empty(),$(".start-point").remove(),$(".end-point").remove(),$(".direction-panel").remove(),DirectionUtils.removeRichMarkers(),DirectionUtils.removeDirectionOverlay()},DirectionUtils.getLineLayer=function(t){$(".select-direction-layer").empty().append("<option value='-1'>\u65b0\u5efa\u56fe\u5c42</option>");for(var e=t.values(),i=0;i<e.length;i++){var n=e[i];"line_layer"==n.type&&(ToolBar._map.routing_layer_id==n.id?$(".select-direction-layer").append('<option value="'+n.id+'" selected>'+n.title+"</option>"):$(".select-direction-layer").append('<option value="'+n.id+'">'+n.title+"</option>"))}};DirectionUtils.isOpen=function(){return $("#dtDirectionPanel").is(":visible")},DirectionUtils.addPoint=function(t){if("undefined"!=typeof t&&null!=t){if($(".input-start-point").length>0&&"none"!=$(".input-start-point").css("display"))return DirectionUtils.addStartPoint(t),!0;if($(".input-end-point").length>0&&"none"!=$(".input-end-point").css("display"))return DirectionUtils.addEndPoint(t),!0;if($(".path-point-active").length>0){var e=$(".path-point-active").find("input");return DirectionUtils.addPathPoint(t,e),!0}return!1}},DirectionUtils.addBatchMarkers=function(t){var e=t.values();if(e)for(var i=0;i<e.length;i++){var n=e[i];if(0==i&&$(".add-path-point").trigger("click"),0==$(".popBox").length){var r=$(".path-point-active").find("input");DirectionUtils.addPathPoint(n,r)}}}}),$(function(){function t(t){j=t,j.on("click",function(){var t=BInfowindow.isOpen();if(!t)for(var e=A.values(),i=0;i<e.length;i++){var n=e[i];n.isCategorized()&&(CategoryUtils.removeVectors(n),window.clearInterval(W),addOverlays=null)}}),j.on("zoomend",function(){setInterval(y,100),$(".heatmap-canvas").parent().css("height",0),clearTimeout(j.searchCityTimer),j.searchCityTimer=setTimeout(function(){MapUtils.searchCity(MapUtils.setCurrentCity)},200)}),j.on("moveend",function(){$(".heatmap-canvas").parent().css("height",0),clearTimeout(j.searchCityTimer),j.searchCityTimer=setTimeout(function(){MapUtils.searchCity(MapUtils.setCurrentCity)},200)}),$("#mapContainer").css("z-index",0),$(".layer-style-panel").removeClass("dt-none"),j.baseLayer instanceof L.TileLayer.BaiduLayer&&($(".map-style-panel").show(),$("#bdPanel").DtMapStyle(j,{mapStyle:base_map,style:style})),j.has_marker_reply=has_marker_reply,j.has_feature_task=has_feature_task,j.searchCityTimer=null,FayeUtils.init(faye_server,chanel_map,{map:j,hashMap:A,allMarker:N}),MarkerUtils.map=j,LineUtils.map=j,RegionUtils.map=j,MapUtils.map=j,MonitorUtils._map=j,BInfowindow.init(j,A),ToolBar.init(j,A,z),showToolbox&&$("#toolbarBox").show(),M(),P(),FendanPlugin.init(j,A,{isAdmin:is_map_admin}),CategoryUtils.init(j,A),ReplyUtils.init(j,A,{is_edit:!0,panelHeight:$(window).height()-48}),LocalSearch.init({map:j,id:"searchControl"});var e={map:j,map_city:map_city,style:"top:4px;left:10px;z-index:10;"};$("#dtwyCityList").createCityList("init",e)}function e(t){j.flyTo(new L.latLng(t.coords.latitude,t.coords.longitude),15)}function i(){var t="\u5b9a\u4f4d\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5...";0==$(".popBox").length&&PromptInfo.xcConfirm(t,PromptInfo.xcConfirm.typeEnum.info)}function n(){var t={mid:mid,province:$("#cur_city_name").text(),level:j.getZoom(),center:j.getCenter().lng.toString()+","+j.getCenter().lat.toString()};MapUtils.ajax2server(publish_map_url,"POST",t,function(){self.location="/map/viewer?mid="+mid})}function r(){j.drawHandler&&j.drawHandler.disable()}function a(t){j.drawHandler&&j.drawHandler.disable(),j.drawHandler=j.drawHandlers[t],j.drawHandler&&(j.drawHandler.enable(),"none"==$("#dtDirectionPanel").css("display")&&$(".map-layers").trigger("click"))}function o(t){var e=A.get("m_"+current_layer_id);if("hide"==e.display)return PromptInfo.xcConfirm("\u8be5\u56fe\u5c42\u5df2\u88ab\u9690\u85cf\uff0c\u65e0\u6cd5\u5b8c\u6210\u64cd\u4f5c",PromptInfo.xcConfirm.typeEnum.info),void j.removeOverlay(t);for(var i=e.getMarkers().values(),n=new DT.HashMap,r=0;r<i.length;r++){var a=RegionUtils.isPointInRegion(i[r].getPosition(),t);a&&(n.put(i[r].feature_id,i[r]),n.add(i[r]))}var o=e.getType();if("marker_layer"==o){var s=new DT.HashMap,l=new DT.MarkerLayer,d=e;l.id=current_layer_id,l.setUniformTitle(d.uniform_title),l.setAttrs(d.getAttrs()),l.setAttrFields(d.getAttrFields()),l.render_style=d.render_style,l.setUniformConfig(d.getUniformConfig()),l.setCanvasConfig(d.getCanvasConfig()),l.setHeatmapConfig(d.getHeatmapConfig()),l.setCategoryConfig(d.getCategoryConfig()),l.setTextConfig(d.getTextConfig()),l.setSortConfig(d.getSortConfig()),l.setLabelConfig(d.getLabelConfig()),l.setCategories(d.getCategories()),l.markers=n,d.cooperation&&(l.is_permission_layer=!0),s.put("m_"+l.id,l);var h={layer:l,map:j,type:"marker",select_all:!0};delete s,delete d,delete l;var c="markerDataList_"+current_layer_id;has_direction&&$("#dtDirectionPanel").is(":visible")?(0==$(".path-position").children().length&&$(".path-position").removeAttr("markers"),DirectionUtils.addBatchMarkers(n)):$("#"+c).openDataList(h)}j.removeOverlay(t)}function s(t){var e,i=t.layerType,n=t.layer,r={};if(n.options.customParam&&"filter"==n.options.customParam)return void o(n);if("polygon"==i){if(e=MapUtils.canAddOverlayToMap("region",A,j),!e)return;$(".layer").find(".active-layer").hasClass("rlayer")?current_layer_id=$(".layer").find(".active-layer").parent().attr("layer-id"):current_layer_id=-1,n=new Dtwy.Polygon(n.getLatLngs()),r={mid:mid,region_layer_id:current_layer_id,path:n.getPathString(),region_type:0},MapUtils.ajax2server(create_region_url,"POST",r,function(t){current_layer_id=t.region.region_layer_id})}else if("polyline"==i){if(e=MapUtils.canAddOverlayToMap("line",A,j),!e)return;$(".layer").find(".active-layer").hasClass("llayer")?current_layer_id=$(".layer").find(".active-layer").parent().attr("layer-id"):current_layer_id=-1,n=new Dtwy.Polyline(n.getLatLngs()),r={mid:mid,line_layer_id:current_layer_id,path:n.getPathString()},MapUtils.ajax2server(add_line_url,"POST",r,function(t){current_layer_id=t.line.line_layer_id})}else if("circle"==i){if(e=MapUtils.canAddOverlayToMap("region",A,j),!e)return;$(".layer").find(".active-layer").hasClass("rlayer")?current_layer_id=$(".layer").find(".active-layer").parent().attr("layer-id"):current_layer_id=-1,n=new Dtwy.Circle({center:n.getLatLng(),radius:n.getRadius()}),r={mid:mid,region_layer_id:current_layer_id,path:n.getPathString(),region_type:1},MapUtils.ajax2server(create_region_url,"POST",r,function(t){current_layer_id=t.region.region_layer_id})}else"marker"==i&&f(n);j.removeOverlay(n)}function l(t){var e=t.layer;e instanceof Dtwy.Marker?e.updateToServer({mid:mid}):e instanceof Dtwy.Circle?(clearTimeout(j.editingCircleTimer),j.editingCircleTimer=setTimeout(function(){e.updateToServer({mid:mid})},200)):e instanceof Dtwy.CanvasMarker&&(clearTimeout(j.editingCanvasTimer),j.editingCanvasTimer=setTimeout(function(){e.updateToServer({mid:mid})},200))}function d(){var t=j.editingOverlay;t&&(t instanceof Dtwy.Polyline?t.updateToServer({mid:mid}):t instanceof Dtwy.Polygon&&t.updateToServer({mid:mid}))}function h(t){var e=t.layer;e instanceof Dtwy.Circle&&(clearTimeout(j.editingCircleTimer),j.editingCircleTimer=setTimeout(function(){e.updateToServer({mid:mid})},200))}function c(t){var e=t.strokeOpacity,i=t.strokeWeight,n=t.strokeColor.substring(1,7),r=t.strokeStyle;$("#setCategoryLineStyle").attr("data-strokeweight",i).attr("data-strokeOpacity",e).attr("data-strokeColor",t.strokeColor).attr("data-strokeStyle",r),$("#category_line_opacity input").attr("data-opacity"),$("#category_line_stroke input").val(i),$("#category_line_selected_color").val(n);var a=0;$("#category_line_stroke_style .dd-option-value").each(function(t,e){if($(e).attr("value")==r)return void(a=t)}),$("#category_line_stroke_style_select").ddslick("select",{index:a}),w()}function u(t){var e=t.strokeOpacity,i=t.strokeWeight,n=t.strokeColor.substring(1,7),r=MapUtils.RGB2Hex(n),a=t.fillOpacity,o=t.fillColor.substring(1,7),s=MapUtils.RGB2Hex(o),l=$("#edit_category_region .region_sets.active").attr("data-type");"fill"==l?($("#category_region_opacity input").attr("data-opacity"),$("#category_region_selected_color").val(o)):($("#category_region_opacity input").attr("data-opacity"),$("#category_region_stroke input").val(i),$("#category_region_selected_color").val(n)),$("#setCategoryRegionStyle").attr("data-strokeweight",i).attr("data-strokeOpacity",e).attr("data-strokeColor",t.strokeColor).attr("data-fillOpacity",a).attr("data-fillColor",t.fillColor),$("#category_region_swatch").css("background","rgba("+s[0]+","+s[1]+","+s[2]+","+a+")").css("border",i+"px solid rgba("+r[0]+","+r[1]+","+r[2]+","+e+")")}function p(t,e){DirectionUtils.isOpen()&&t instanceof Dtwy.Marker?DirectionUtils.addPoint(t):BInfowindow.open(t,e)}function f(t){$(".map-layers").trigger("click"),$(".upload_file").popover("hide");var e=MapUtils.canAddOverlayToMap("marker",A,j);if(e){$(".layer").find(".active-layer").hasClass("mlayer")?current_layer_id=$(".layer").find(".active-layer").parent().attr("layer-id"):current_layer_id=-1;var i=t.getLatLng(),n={lng:i.lng.toFixed(6),lat:i.lat.toFixed(6),mid:mid,marker_layer_id:current_layer_id};MapUtils.ajax2server(add_marker_url,"POST",n,function(t){current_layer_id=t.marker.marker_layer_id}),j.action=null}}function m(t,e,i){var n,r,a;if("marker"==i)if(n=A.get("m_"+t),2==n.render_style)null!=j.dt_heatmap[t]&&null!=j.dt_heatmap[t][0]&&(e?j.dt_heatmap[t][0].show():j.dt_heatmap[t][0].hide(),BInfowindow.close());else{if(e&&n&&4!=n.render_style&&R.containsKey(t))return r=R.get(t).markers,void(r.length>0&&(Z=window.setInterval(function(){var e=r.shift();!e||"undefined"==e&&"null"==e||MarkerUtils.addMarker2Map(e,!1),0==r.length&&(has_message_audio&&MonitorUtils.initOverlayMonitor(),R.remove(t),window.clearInterval(Z),Z=null)},20)));r=n.getMarkers().values();for(var o=0;o<r.length;o++)a=r[o],a.layer_id==t&&(e&&a.display?(j.hasLayer(a)?a.show():n.isCluster()||a.addTo(j),n.monitors&&has_message_audio&&MonitorUtils.getOverlayMonitor(n,a,"marker",!1)):(a.hide(),n.monitors&&has_message_audio&&MonitorUtils.removeMonitor(a)),BInfowindow.close());if(null!=j.dt_clusterer[t]){var s=j.dt_clusterer[t];e?j.addOverlay(s):s.clearLayers(),BInfowindow.close()}}else if("region"==i){if(n=A.get("r_"+t),R.containsKey(t)){var r=R.get(t).regions;return void(r.length>0&&(Z=window.setInterval(function(){RegionUtils.addRegion2Map(r.shift(),"show",!1),0==r.length&&(has_message_audio&&MonitorUtils.initOverlayMonitor(),window.clearInterval(Z),Z=null,R.remove(t))},20)))}r=n.getRegions().values();for(var o=0;o<r.length;o++)a=r[o],a.layer_id==t&&(e&&a.display?(j.hasLayer(a)?a.show():a.addTo(j),n.monitors&&has_message_audio&&MonitorUtils.getOverlayMonitor(n,a,"region",!1)):(a.hide(),n.monitors&&has_message_audio&&MonitorUtils.removeMonitor(a)),BInfowindow.close())}else if("line"==i){if(n=A.get("l_"+t),R.containsKey(t)){var r=R.get(t).lines;return void(r.length>0&&(Z=window.setInterval(function(){var e=r.shift();e&&LineUtils.addLine2Map(e,"show",!1),0==r.length&&(has_message_audio&&MonitorUtils.initOverlayMonitor(),window.clearInterval(Z),Z=null,R.remove(t))},20)))}r=n.getLines().values();for(var o=0;o<r.length;o++)a=r[o],a.layer_id==t&&(e&&a.display?(j.hasLayer(a)?a.show():a.addTo(j),n.monitors&&has_message_audio&&MonitorUtils.getOverlayMonitor(n,a,"marker",!1)):(a.hide(),n.monitors&&has_message_audio&&MonitorUtils.removeMonitor(a)),BInfowindow.close())}}function g(){var t=$(".select-color.active").attr("data-color"),e="";if("block"==$("#myModalLayerStyle").css("display"))var i=$("input[name='icon_size_radio']");else var i=$("input[name='marker_icon_size_radio']");for(var n=0;n<i.length;n++)$(i[n]).is(":checked")&&(e=$(i[n]).attr("data-size"));var r=$(".select-shape.active").attr("data-symbol");"undefined"==typeof r&&(r="null");var a,o;a="false"==$("#editCategoryMarkerIcon").attr("aria-hidden")?$("#editCategoryMarkerIcon").find(".has-bubble").is(":checked"):$(".in").find(".has-bubble").is(":checked"),o=a?"/uploads/icons/default/"+t+"-"+e+"-"+r+".png":"/uploads/icons/svg/"+t+"-"+e+"-"+r+".svg",$(".icon_preview").attr("color",t).attr("size",e).attr("symbol",r).attr("bubble",a).attr("src",oss_host+o)}function _(t,e){var i=[];$(".layer-infowindow-setting").find("input:checked").each(function(){var t=$(this).attr("data-name");t&&""!=t&&i.push(t)}),MapUtils.ajax2server(t,"POST",{fields:i.join(","),mid:mid,id:e},function(t){$("#infowindowSetting").modal("hide"),t.msg.indexOf("\u5931\u8d25")>=0&&PromptInfo.xcConfirm(t.msg,PromptInfo.xcConfirm.typeEnum.info)})}function y(){for(var t=A.values(),e=0;e<t.length;e++){var i=t[e];if(i&&i.vectors)for(var n=0;n<i.vectors.length;n++){var r=i.vectors[n];if(r&&r.feature_id){var a=i.getMarker(r.feature_id);a&&a.isVisible()?r.show():r.hide()}}}}function v(){var t=$("#edit_region .region_sets.active").attr("data-type"),e=$("#region_stroke input").val(),i=$("#region_selected_color").val(),n=MapUtils.RGB2Hex(i),r=$("#region_opacity input").attr("data-opacity");isNaN(r)||""==r||r<0?r=0:isNaN(e)?r=.1:r>1&&(r=1),isNaN(e)||""==e||e<0?e=0:isNaN(r)?e=1:e>10&&(e=10),"fill"!=t&&0==e&&0==r?(r=.1,e=1):"fill"!=t&&0==r&&(r=.1);var a=$("#set_region_style");a.attr("data-strokeWeight",e),$("#region_selected_color").val(i),"fill"==t?(i?a.attr("data-fillColor","#"+i):a.attr("data-fillColor","#f86767"),a.attr("data-fillOpacity",r),$("#region_swatch").css("background-color","rgba("+n[0]+", "+n[1]+", "+n[2]+", "+r+")")):"stroke"==t&&(i?a.attr("data-strokeColor","#"+i):a.attr("data-strokeColor","#f86767"),a.attr("data-strokeOpacity",r),$("#region_swatch").css("border",e+"px solid rgba("+n[0]+", "+n[1]+", "+n[2]+", "+r+")"))}function b(){var t=$("#line_stroke input").val(),e=$("#line_selected_color").val(),i=MapUtils.RGB2Hex(e),n=$("#line_opacity input").attr("data-opacity"),r=$("#line_stroke_style .dd-selected-value").val();isNaN(n)||""==n||n<0||0==n?n=.1:n>1&&(n=1),isNaN(t)||""==t||t<0||0==t?t=1:t>10&&(t=10);var a=$("#set_line_style");a.attr("data-strokeWeight",t),a.attr("data-strokeOpacity",n),a.attr("data-strokeStyle",r),a.attr("data-strokeColor","#"+e),$("#line_selected_color").val(e),"arrow"==r?($(".line_arrow_node_swatch").hide(),$("#line_swatch").css("height",138-4*t+"px").css("border",t+"px solid rgba("+i[0]+","+i[1]+","+i[2]+","+n+")"),
$(".line_arrow_swatch").css("border",4*t+"px solid transparent").css("border-bottom","0 solid transparent").css("border-top",4*t+"px solid rgba("+i[0]+","+i[1]+","+i[2]+","+n+")").show()):"arrow_node"==r?($("#line_swatch").css("height",138-4*t+"px").css("border",t+"px solid rgba("+i[0]+","+i[1]+","+i[2]+","+n+")"),$(".line_arrow_swatch").css("border",4*t+"px solid transparent").css("border-bottom","0 solid transparent").css("border-top",4*t+"px solid rgba("+i[0]+","+i[1]+","+i[2]+","+n+")").show(),$(".line_arrow_node_swatch").css("top",(138-8*t)/2+"px").css("left",4*-t+"px").css("border",4*t+"px solid transparent").css("border-bottom","0 solid transparent").css("border-top",4*t+"px solid rgba("+i[0]+","+i[1]+","+i[2]+","+n+")").show()):($("#line_swatch").css("height","138px").css("border",t+"px "+r+" rgba("+i[0]+","+i[1]+","+i[2]+","+n+")"),$(".line_arrow_swatch").hide(),$(".line_arrow_node_swatch").hide())}function w(){var t=$("#category_line_stroke input").val(),e=$("#category_line_selected_color").val(),i=MapUtils.RGB2Hex(e),n=$("#category_line_opacity input").attr("data-opacity"),r=$("#category_line_stroke_style .dd-selected-value").val();isNaN(n)||""==n||n<0||0==n?n=.1:n>1&&(n=1),isNaN(t)||""==t||t<0||0==t?t=1:t>10&&(t=10),$("#setCategoryLineStyle").attr("data-strokeWeight",t).attr("data-strokeOpacity",n).attr("data-strokeColor","#"+e).attr("data-strokeStyle",r),$("#category_line_selected_color").val(e),"arrow"==r?($(".line_arrow_node_swatch").hide(),$("#category_line_swatch").css("height",138-4*t+"px").css("border",t+"px solid rgba("+i[0]+","+i[1]+","+i[2]+","+n+")"),$(".line_arrow_swatch").css("border",4*t+"px solid transparent").css("border-bottom","0 solid transparent").css("border-top",4*t+"px solid rgba("+i[0]+","+i[1]+","+i[2]+","+n+")").show()):"arrow_node"==r?($("#category_line_swatch").css("height",138-4*t+"px").css("border",t+"px solid rgba("+i[0]+","+i[1]+","+i[2]+","+n+")"),$(".line_arrow_swatch").css("border",4*t+"px solid transparent").css("border-bottom","0 solid transparent").css("border-top",4*t+"px solid rgba("+i[0]+","+i[1]+","+i[2]+","+n+")").show(),$(".line_arrow_node_swatch").css("top",(138-8*t)/2+"px").css("left",4*-t+"px").css("border",4*t+"px solid transparent").css("border-bottom","0 solid transparent").css("border-top",4*t+"px solid rgba("+i[0]+","+i[1]+","+i[2]+","+n+")").show()):($("#category_line_swatch").css("height","138px").css("border",t+"px "+r+" rgba("+i[0]+","+i[1]+","+i[2]+","+n+")"),$(".line_arrow_swatch").hide(),$(".line_arrow_node_swatch").hide())}function x(){var t=$("#category_region_stroke input").val(),e=$("#category_region_selected_color").val(),i=MapUtils.RGB2Hex(e),n=$("#category_region_opacity input").attr("data-opacity");isNaN(n)||""==n||n<0||0==n?n=.1:n>1&&(n=1),isNaN(t)||""==t||t<0||0==t?t=1:t>10&&(t=10);var r=$("#edit_category_region .region_sets.active").attr("data-type");"fill"==r?($("#setCategoryRegionStyle").attr("data-fillOpacity",n).attr("data-fillColor","#"+e),$("#category_region_swatch").css("background","rgba("+i[0]+","+i[1]+","+i[2]+","+n+")")):($("#setCategoryRegionStyle").attr("data-strokeWeight",t).attr("data-strokeOpacity",n).attr("data-strokeColor","#"+e),$("#category_region_swatch").css("border",t+"px solid rgba("+i[0]+","+i[1]+","+i[2]+","+n+")")),$("#category_region_selected_color").val(e)}function k(t,e){var i,n="";if("marker"==e){if(i=A.get("m_"+t),0==i.getMarkers().values().length)return void $(".layer-infowindow-setting").empty().append("<span class='coloraa' style='line-height:100px;font-size:16px;'>\u8bf7\u6dfb\u52a0\u6807\u6ce8\u540e\u518d\u8fdb\u884c\u8bbe\u7f6e</span>")}else if("line"==e){if(i=A.get("l_"+t),0==i.getLines().values().length)return void $(".layer-infowindow-setting").empty().append("<span class='coloraa' style='line-height:100px;font-size:16px;'>\u8bf7\u6dfb\u52a0\u7ebf\u8def\u540e\u518d\u8fdb\u884c\u8bbe\u7f6e</span>")}else if("region"==e&&(i=A.get("r_"+t),0==i.getRegions().values().length))return void $(".layer-infowindow-setting").empty().append("<span class='coloraa' style='line-height:100px;font-size:16px;'>\u8bf7\u6dfb\u52a0\u533a\u57df\u540e\u518d\u8fdb\u884c\u8bbe\u7f6e</span>");var r=i.getAttrFields();if(null!=r){$("#"+e+"_layer_"+t).attr("data-show-fields")&&(n=$("#"+e+"_layer_"+t).attr("data-show-fields").split(","));for(var a="",o=$("#"+e+"_layer_"+t).attr("data-"+e+"-title"),s=0;s<r.length;s++)if(null!=r[s]){var l=r[s].field;a+=0==n.length||n.indexOf(l)!=-1?l==o?"<span class='dt-show'><input class='dt-checkbox' type='checkbox' data-name='"+l+"' checked disabled style='margin-right:4px;margin-left:4px;'/><span class='dt-f14'>"+l+"</span><span class='dt-f12 color99'>\uff08\u8be5\u5b57\u6bb5\u5df2\u88ab\u8bbe\u7f6e\u4e3a\u6807\u9898\uff0c\u4e0d\u80fd\u88ab\u9690\u85cf\uff09</span></span>":"<span class='dt-show'><input class='dt-checkbox' type='checkbox' data-name='"+l+"' checked style='margin-right:4px;margin-left:4px;'/><span class='dt-f14'>"+l+"</span></span>":"<span class='dt-show dt-mar4b'><input class='dt-checkbox' type='checkbox' data-name='"+l+"'  style='margin-right:4px;margin-left:4px;'/><span class='dt-f14'>"+l+"</span></span>"}$(".layer-infowindow-setting").empty().append(a)}}function C(t){var e=$(t).attr("layer-id");$(t).prev().hasClass("rglayer")?T(e,"region_layer_"):$(t).prev().hasClass("mklayer")?T(e,"marker_layer_"):$(t).prev().hasClass("lelayer")&&T(e,"line_layer_")}function T(t,e){var i;if(e.indexOf("marker")>=0?i=A.get("m_"+t):e.indexOf("line")>=0?i=A.get("l_"+t):e.indexOf("region")>=0&&(i=A.get("r_"+t)),i)if("marker_layer"==i.getType()&&2==i.render_style)$("#heatmap_layer_contain_"+t).toggle();else{var n=$("#"+e+t+" ul"),r=n.length;1==r?n.toggle():"block"!=n.first().css("display")&&"block"!=n.last().css("display")?i.isCategorized()?"marker_layer_"==e?$("#marker_category_details_"+t).show():"line_layer_"==e?$("#line_category_details_"+t).show():"region_layer_"==e&&$("#region_category_details_"+t).show():n.first().show():n.each(function(){$(this).hide()})}}function M(){L.drawLocal.draw.handlers={circle:{tooltip:{start:"\u70b9\u51fb\u5e76\u62d6\u62fd\u7ed8\u5236\u5706\u5f62."},radius:"\u534a\u5f84"},marker:{tooltip:{start:"\u70b9\u51fb\u7ed8\u5236\u6807\u6ce8."}},polygon:{tooltip:{start:"\u70b9\u51fb\u5f00\u59cb\u7ed8\u5236\u533a\u57df.",cont:"\u70b9\u51fb\u7ee7\u7eed\u7ed8\u5236.",end:"\u53cc\u51fb\u5b8c\u6210\u7ed8\u5236."}},polyline:{error:"<strong>\u9519\u8bef:</strong> \u7ebf\u8def\u4e0d\u80fd\u76f8\u4ea4!",tooltip:{start:"\u70b9\u51fb\u5f00\u59cb\u7ed8\u5236\u7ebf\u8def.",cont:"\u70b9\u51fb\u7ee7\u7eed\u7ed8\u5236.",end:"\u53cc\u51fb\u5b8c\u6210\u7ed8\u5236."}},rectangle:{tooltip:{start:"\u70b9\u51fb\u5e76\u62d6\u62fd\u7ed8\u5236\u77e9\u5f62."}},simpleshape:{tooltip:{end:"\u91ca\u653e\u9f20\u6807\u5b8c\u6210\u7ed8\u5236."}}},j.drawHandlers={marker:new L.Draw.Marker(j,{icon:new L.Icon({iconUrl:default_marker_icon_url,iconAnchor:[10,28],iconSize:[20,33]})}),polyline:new L.Draw.Polyline(j,{}),polygon:new L.Draw.Polygon(j,{}),circle:new L.Draw.Circle(j,{}),measure:new L.Polyline.Measure(j,{}),polygonFilter:new L.Draw.Polygon(j,{shapeOptions:{customParam:"filter"}}),circleFilter:new L.Draw.Circle(j,{shapeOptions:{customParam:"filter"}})},j.editingOverlay=null,j.drawHandler=null,j.editingCircleTimer=null,j.editingCanvasTimer=null,j.on(L.Draw.Event.CREATED,s),j.on(L.Draw.Event.EDITMOVE,l),j.on(L.Draw.Event.EDITVERTEX,d),j.on(L.Draw.Event.EDITRESIZE,h),j.on(L.Draw.Event.EDITSTART,function(t){j.editingOverlay=t.overlay}),j.on(L.Draw.Event.EDITSTOP,function(){j.editingOverlay=null})}function P(){j.dt_heatmap={},j.dt_clusterer={},j.dt_marker={},j.dt_text_overlay={},MapUtils.operatingNotice("\u6570\u636e\u88c5\u8f7d\u4e2d...",{loading:!0}),MapUtils.ajax2server(details_url,"GET",{mid:mid},function(t){j.cooperation=t.map.cooperation,j.routing_layer_id=t.map.routing_layer_id,j.default_template_id=t.map.default_template_id,j.reply_templates=t.map.reply_templates,j.location_timeout=t.map.location_timeout,$("#layerSize").text(t.map.layers.length);for(var e=0,i=!0,n=!0,r=t.map,a=0;a<r.layers.length;a++){var o=r.layers[a],s=MapUtils.createLayer(o);if(o.eye_icon="hide"==o.display?"glyphicon-eye-close":"glyphicon-eye-open",i?(i=!1,o.active="active-layer"):o.active="layer-hover","region_layer"==o.type){A.put("r_"+o.id,s),o.cooperation&&(A.get("r_"+o.id).cooperation=o.cooperation,MapUtils.setOverlayPermission(o,o.type,j)),e+=o.regions.length,"hide"==o.display&&R.put(o.id,o),MapUtils.initRegionLayerToPanel(o,j),n=!1;for(var l=0;l<o.regions.length;l++){var d=o.regions[l];if(d=MapUtils.refactorRegionJSON(d,o),RegionUtils.addRegion2Map(d,o.display,!0),d.cooperation)for(var h=0;h<d.cooperation.length;h++){var c=d.cooperation[h];c.dataContent=PermissionUtils.setFeaturePermissionPanelHtml(c,"\u6210\u5458"),F.put(c.id,c)}}s.sort("area")}else if("marker_layer"==o.type){A.put("m_"+o.id,s),e+=o.markers.length,o.cooperation&&(A.get("m_"+o.id).cooperation=o.cooperation,MapUtils.setOverlayPermission(o,o.type,j));for(var u=0;u<o.markers.length;u++){var p=o.markers[u];if(p.cooperation)for(var h=0;h<p.cooperation.length;h++){var c=p.cooperation[h];c.dataContent=PermissionUtils.setFeaturePermissionPanelHtml(c,"\u6210\u5458"),F.put(c.id,c)}}"hide"==o.display&&R.put(o.id,o),1==o.render_style?MarkerUtils.showCanvasMarker(o):2==o.render_style?MarkerUtils.showHeatmap(o):4==o.render_style?MarkerUtils.showTextOverlay(o):s.isCluster()?MarkerUtils.showClusterer(o):MarkerUtils.showNormalMarker(o),MarkerUtils.initMarkerLayerToPanel(o,j),n=!1}else if("line_layer"==o.type){A.put("l_"+o.id,s),o.cooperation&&(A.get("l_"+o.id).cooperation=o.cooperation,MapUtils.setOverlayPermission(o,o.type,j)),e+=o.lines.length,"hide"==o.display&&R.put(o.id,o),MapUtils.initLineLayerToPanel(o,j,A),n=!1;for(var l=0;l<o.lines.length;l++)if(o.lines[l]=MapUtils.refactorLineJSON(o.lines[l],o),LineUtils.addLine2Map(o.lines[l],o.display,!0),o.lines[l].cooperation)for(var h=0;h<o.lines[l].cooperation.length;h++){var c=o.lines[l].cooperation[h];c.dataContent=PermissionUtils.setFeaturePermissionPanelHtml(c,"\u6210\u5458"),F.put(c.id,c)}}}$("#featureCount").text(e),F.values().length>0&&loginUser.id==F.values()[0].id&&(loginUser.is_logout=!0);var f=[{users:F.values()}],m=$("#featurePermissionTemplate").render(f);if($(".feature-panel").append(m),PermissionUtils.reloadPopover(),PermissionUtils.initPopover(),LocalSearch.setLayersHashMap(A),$(".loading-layout").hide(),$(".loading").hide(),$('[data-toggle="tooltip"]').tooltip(),$.cookie("advert")||is_advert&&(S(),$.cookie("advert",!0,{expires:365})),$.cookie("edit_map")||(I(),$.cookie("edit_map",!0,{expires:365})),MarkerUtils.overlays.length>0)for(var g=MapUtils.getSplitArray(MarkerUtils.overlays,100),_=g.length,u=0;u<_;u++)MarkerUtils.addMarkersToMap(g.shift());else MarkerUtils.markerTimer=!0;if(LineUtils.overlays.length>0)var y=setInterval(function(){if(RegionUtils.regionTimer){for(var t=MapUtils.getSplitArray(LineUtils.overlays,50),e=t.length,i=0;i<e;i++)LineUtils.addLinesToMap(t.shift());clearInterval(y)}},500);else LineUtils.lineTimer=!0;if(RegionUtils.overlays.length>0)for(var v=MapUtils.getSplitArray(RegionUtils.overlays,50),b=v.length,w=0;w<b;w++)RegionUtils.addRegionsToMap(v.shift());else RegionUtils.regionTimer=!0;var x=PermissionUtils.loginUserRole(user_phone,{mapUsers:j.cooperation}),k=window.setInterval(function(){MapUtils.operatingNotice("\u6570\u636e\u88c5\u8f7d\u4e2d...",{loading:!0}),MarkerUtils.markerTimer&&LineUtils.lineTimer&&RegionUtils.regionTimer&&(window.clearInterval(k),["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458"].indexOf(x)>=0&&has_message_audio&&ToolBar.addPlugIn("dt-monitor-warning","glyphicon-warning-sign","plug-list","\u9884\u8b66",!0),["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458"].indexOf(x)==-1&&has_filter&&"undefined"!=typeof has_filter&&has_filter&&MapUtils.ajax2server(get_filter_config_url,"GET",{},function(t){var e={search_url:advanced_filter_url,filter_config:t.filter_config.filter_items,custom_params:{key:map_key},reset_text:"\u6e05\u9664",filter_callback:MapUtils.showSearchFeatures,reset_callback:MapUtils.showAllFeatures,error_callback:function(){alert("\u8bf7\u6c42\u5931\u8d25")}};$(".filter-container").removeClass("dt-none"),$(".fixed-filter").DtFilter("init",e),1==$(".fixed-filter").children().length?$(".filter-container").addClass("dt-none"):$(".filter-container").removeClass("dt-none"),MapUtils.addFilterInfoWrapper()}),MapUtils.operatingNotice("\u52a0\u8f7d\u5b8c\u6210",{expire:1e3}),$(".leaflet-text-icon").css({width:"auto",height:"auto"}),$("svg").css("z-index","10"))},1e3);["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458"].indexOf(x)==-1&&has_message_audio&&MonitorUtils.initOverlayMonitor(),D(x)})}function D(t){["\u5730\u56fe\u7ba1\u7406\u5458","\u5730\u56fe\u6210\u5458"].indexOf(t)>=0&&(has_reply&&ToolBar.addPlugIn("marker-reply","glyphicon-comment","plug-list","\u52a8\u6001",!0),has_direction&&ToolBar.addPlugIn("dt-direction","glyphicon-road","plug-list","\u8def\u5f84",!0),has_feature_task&&ToolBar.addPlugIn("dt-task","iconfont","plug-list","\u4efb\u52a1",!0),has_fendan&&!is_advert&&ToolBar.addPlugIn("fendan","fendan-icon dt-show hy-icons","plug-list","\u5206\u5355",!0),has_filter&&ToolBar.addPlugIn("dt-filter-plug","iconfont","plug-list","\u7b5b\u9009",!0),has_region_statistics&&ToolBar.addPlugIn("map-total-plug","glyphicon-stats","plug-list","\u5206\u6790",!0),has_location&&ToolBar.addPlugIn("dt-member-location","iconfont","plug-list","\u5b9a\u4f4d",!0),"\u5730\u56fe\u7ba1\u7406\u5458"==t&&(has_download&&ToolBar.addPlugIn("dt-data-download","glyphicon-cloud-download","plug-list","\u4e0b\u8f7d",!0),has_marker_selector&&ToolBar.addPlugIn("dt-marker-selector","glyphicon-tags","plug-list","\u6807\u6ce8",!0),has_map_log&&ToolBar.addPlugIn("log","glyphicon-align-justify","plug-list","\u65e5\u5fd7",!0)))}function S(){var t=[];t.push({element:"#addMarkerBtn",intro:"\u70b9\u51fb\u6dfb\u52a0\u6237\u5916\u5e7f\u544a",position:"right"}),t.push({element:"#select_layer_type",intro:'\u65b0\u5efa\u5730\u56fe\u56fe\u5c42<div class="guide1"></div>',position:"right"}),introJs().setOptions({tooltipPosition:"right",showStepNumbers:!1,skipLabel:"\u8df3\u8fc7",nextLabel:"\u4e0b\u4e00\u6b65",prevLabel:"\u4e0a\u4e00\u6b65",doneLabel:"\u5f00\u59cb\u5236\u56fe",steps:t}).onafterchange(function(t){"toolbarBox"==$(t).attr("id")?$(".introjs-helperLayer ").css("background-color","#00a2ca"):$(".introjs-helperLayer ").css("background-color","rgba(255, 255, 255, 0.901961)")}).start()}function I(){var t=$("#layerContainer").children().first().attr("id"),e=[];e.push({element:"#drawingToolbar",intro:'\u7ed8\u5236\u5de5\u5177\u680f<div class="guide2"></div>',position:"right"}),e.push({element:"#select_layer_type",intro:'\u65b0\u5efa\u5730\u56fe\u56fe\u5c42<div class="guide1"></div>',position:"right"}),e.push({element:"#toolbarBox",intro:'\u5de5\u5177\u7bb1<div class="guide3"></div>',position:"right"}),t&&e.push({element:"#"+t,intro:'\u56fe\u5c42\u8bbe\u7f6e<div class="guide4"></div>',position:"right"}),introJs().setOptions({tooltipPosition:"right",showStepNumbers:!1,skipLabel:"\u8df3\u8fc7",nextLabel:"\u4e0b\u4e00\u6b65",prevLabel:"\u4e0a\u4e00\u6b65",doneLabel:"\u5f00\u59cb\u5236\u56fe",steps:e}).onafterchange(function(t){"toolbarBox"==$(t).attr("id")?$(".introjs-helperLayer ").css("background-color","#00a2ca"):$(".introjs-helperLayer ").css("background-color","rgba(255, 255, 255, 0.901961)")}).start()}function E(t){var e,i="hide",n=t.attr("layer-id");if(t.hasClass("glyphicon-eye-open")){if(i="hide",t.removeClass("glyphicon-eye-open").addClass("glyphicon-eye-close"),t.hasClass("mklayer")){e="marker";var r=A.get("m_"+n);CategoryUtils.removeVectors(r),$("#marker_layer_"+n+" ul").hide(),$("#marker_layer_"+n+" .layer_action").hide()}else t.hasClass("rglayer")?(e="region",$("#region_layer_"+n+" ul").hide(),$("#region_layer_"+n+" .layer_action").hide()):t.hasClass("lelayer")&&(e="line",$("#line_layer_"+n+" .list-unstyled").hide(),$("#line_layer_"+n+" .layer_action").hide());window.clearInterval(Z),Z=null}else i="show",t.removeClass("glyphicon-eye-close").addClass("glyphicon-eye-open"),t.hasClass("mklayer")?(e="marker",$("#marker_layer_"+n+" .layer_action").show()):t.hasClass("rglayer")?(e="region",$("#region_layer_"+n+" .layer_action").show()):t.hasClass("lelayer")&&(e="line",$("#line_layer_"+n+" .layer_action").show());U(n,e,i)}function U(t,e,i){var n,r;"marker"==e?(n=display_url,r=A.get("m_"+t)):"line"==e?(n=line_layer_display_url,r=A.get("l_"+t)):"region"==e&&(n=region_layer_display_url,r=A.get("r_"+t)),r.display=i,MapUtils.ajax2server(n,"post",{mid:mid,id:t,display:i},function(){if("marker"==e)if(r.isCategorized())"show"==i?$("#marker_category_details_"+t).show():$("#marker_category_details_"+t).hide();else if(2==r.render_style){var n=$("#heatmap_layer_contain_"+t);"show"==i?(0==n.length&&$("#marker_layer_"+t+" ul.list-unstyled").before(MarkerUtils.heatmap_div(r)),n.show()):n.hide()}else 4==r.render_style?"show"==i?$("#marker_layer_"+t).find("ul").show():$("#marker_layer_"+t).find("ul").hide():"show"==i?$("#marker_layer_"+t).find("ul").show():$("#marker_layer_"+t).find("ul").hide();r&&"undefined"!=typeof MonitorUtils&&has_message_audio&&MonitorUtils.showMonitors(r),m(t,"show"==i,e)})}function O(t,e){current_layer_id=t;var i=upload_file_url;if($(".upload-caption").remove(),e){i=append_file_url,$("#isAppend").val(!0),$("#uploadFileModal").find(".modal-title").text("\u6570\u636e\u66f4\u65b0");var n="<p class='upload-caption dt-mar4t'>\u66f4\u65b0\u8bf4\u660e\uff1a\u6570\u636e\u66f4\u65b0\u540e\uff0c\u539f\u6709\u5c5e\u6027\u5185\u5bb9\u4f1a\u88ab\u66f4\u6539\u4e3a\u65b0\u7684\u5c5e\u6027\u5185\u5bb9\uff0c\u66f4\u65b0\u540e\u6570\u636e\u4e0d\u53ef\u64a4\u9500\u6216\u6062\u590d\u3002</p><p class='upload-caption' style='margin-left:60px;'>\u5982\u6709\u5fc5\u8981\uff0c\u8bf7\u5148\u5907\u4efd\u6570\u636e\u3002</p>";$("#localUpload").find(".dt-mar4t").first().before(n)}else $("#isAppend").val(!1),$("#uploadFileModal").find(".modal-title").text("\u6279\u91cf\u6dfb\u52a0\u6570\u636e"),$("#localUpload").find(".upload-caption").remove();var r="file_upload_"+current_layer_id,a={id:r,width:120,height:36,buttonText:"\u9009\u62e9\u6570\u636e",buttonClass:"btn btn-primary dt-mar12t",multi:!1,auto:!0,fileSizeLimit:"10MB",uploadScript:i,formData:{user_phone:user_phone,mid:mid,id:current_layer_id}};$("#uploadFileModal").modal("show"),$("#file_upload_desc").empty(),$("#file_upload_desc").html("<input id='"+r+"' type='file' name='file_upload' />"),$(".upload_file").uploadFile(a)}$("#mapContainer").height(window.innerHeight-80).width(window.innerWidth-380),$("#cooperatePanel").width(window.innerWidth-56),$.views.settings.allowCode=!0,$.datepicker.regional["zh-CN"]={clearText:"\u6e05\u9664",clearStatus:"\u6e05\u9664\u5df2\u9009\u65e5\u671f",closeText:"\u5173\u95ed",closeStatus:"\u4e0d\u6539\u53d8\u5f53\u524d\u9009\u62e9",prevText:"<\u4e0a\u6708",prevStatus:"\u663e\u793a\u4e0a\u6708",nextText:"\u4e0b\u6708>",nextStatus:"\u663e\u793a\u4e0b\u6708",currentText:"\u4eca\u5929",currentStatus:"\u663e\u793a\u672c\u6708",monthNames:["\u4e00\u6708","\u4e8c\u6708","\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708"],monthNamesShort:["\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d","\u5341","\u5341\u4e00","\u5341\u4e8c"],monthStatus:"\u9009\u62e9\u6708\u4efd",yearStatus:"\u9009\u62e9\u5e74\u4efd",weekHeader:"\u5468",weekStatus:"\u5e74\u5185\u5468\u6b21",dayNames:["\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],dayNamesShort:["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"],dayNamesMin:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],dayStatus:"\u8bbe\u7f6e DD \u4e3a\u4e00\u5468\u8d77\u59cb",dateStatus:"\u9009\u62e9 m\u6708 d\u65e5, DD",dateFormat:"yy-m-dd",firstDay:1,initStatus:"\u8bf7\u9009\u62e9\u65e5\u671f",isRTL:!1},$.datepicker.setDefaults($.datepicker.regional["zh-CN"]),moment.locale("zh-cn");var j=null,A=new DT.HashMap,z=new DT.HashMap,B=new DT.HashMap;MarkerUtils.layersHashMap=A,MapUtils.layersHashMap=A,StyleUtils.layersHashMap=A,LineUtils.layersHashMap=A,RegionUtils.layersHashMap=A,DirectionUtils.layersHashMap=A,MonitorUtils._layersHashMap=A;var R=new DT.HashMap,F=new DT.HashMap,N=new DT.HashMap;ToolBar.allMarker=N,MarkerUtils.all=N,mapConfig.init_level=init_level,mapConfig.init_center=init_center,mapConfig.baseLayer.style=base_map,Dtwy.MapUtils.init(mapConfig,t),$("#select_title_city").change(function(){LocalList.mf_RecvLocList()}),$("#province").change(function(){$("#select_title_city").find("option[value='null']").attr("selected",!0)}),$(".map-member, #member_admin").popover({html:!0,template:'<div class="popover" role="tooltip"><div class="popover-content"></div></div>'}),$(".dt-plug-in").popover({html:!0,template:'<div class="popover" role="tooltip" style="margin-left:-4px;width: 350px;max-width:350px;"><div class="arrow"></div><div class="popover-content"></div></div>'}),$(".more-label-img").popover({html:!0,template:'<div class="popover" role="tooltip"><div class="arrow"></div><div class="popover-content"></div></div>'}),PermissionUtils.initPopover(),$("#searchBtn").click(function(t){$(".map-layers").trigger("click"),$(t.target).hasClass("dt-form-control")||$(t.target).closest("table").length>0||($(t.target).hasClass("glyphicon-remove")?($("#searchBtn").find(".glyphicon-remove").addClass("dt-none"),$("#search_input").val(""),$("#search_input").focus()):$("#search_input").hasClass("search-active")?($("#search_input").removeClass("search-active"),$("#searchBtn .glyphicon-remove").addClass("dt-none")):($("#search_input").focus(),$("#search_input").val(""),$("#search_input").addClass("search-active")))}),$("#distanceBtn").click(function(){r()}),$(".position").click(function(){navigator.geolocation.getCurrentPosition(e,i,{enableHighAcuracy:!0,timeout:5e3,maximumAge:3e3})}),$(".upload_file").popover(),$(".mapinfo-but-con").click(function(){0!=parseInt($(".map-info").css("left"))?($(".map-info").animate({left:"0"},"fast"),$(".map-info-tab").animate({left:"380px"},"fast"),$(".layer-style-panel").animate({left:"56px"},"fast"),$(".map-show").animate({"margin-left":"380px"},"fast",function(){$(".reply-panel").removeClass("hide-data-list").removeAttr("style")}),$("#mapContainer").animate({width:window.innerWidth-380},"fast"),$(".classify-result-panel").length>0&&$(".classify-result-panel").animate({left:"380px"},"fast"),$(this).find("span").removeAttr("style")):($(".reply-panel").addClass("hide-data-list").removeAttr("style"),$(".map-info").animate({left:"-380px"},"fast"),$(".map-info-tab").animate({left:"0"},"fast"),$(".layer-style-panel").animate({left:"-380px"},"fast"),$(".map-show").animate({"margin-left":"0"},"fast"),$("#mapContainer").animate({width:window.innerWidth},"fast"),$(".classify-result-panel").length>0&&$(".classify-result-panel").animate({left:"0"},"fast"),$(this).find("span").css("background-position","-139px -167px"))}),$(".left-slider").click(function(t){$(".dt-data-list").remove(),$(".map-member, #member_admin").popover("hide"),$(".style-back").trigger("click"),$(".plug-in-close").trigger("click"),$(".slider-active").removeClass("slider-active").addClass("slider"),$(t.target).hasClass("left-slider")||$(".slider-bar").hide();for(var e=ToolBar.getTools(),i=$(t.target).closest("li").attr("data-select"),n="",r=$(".plug-list").find("li"),a=0;a<r.length;a++)$(r[a]).hasClass(i)&&(n=a);var o=56*n,s=e.get(i);s&&($(".nav-slider-bg").animate({top:o+"px"},"fast"),$(s.panel).show(),"dt-monitor-warning"==s.name&&MonitorUtils.getLayersData(),"dt-data-download"==s.name||"marker-reply"==s.name||"dt-direction"==s.name||"map-total-plug"==s.name?ToolBar.getCurrentData():"map-layers"==s.name?$(".style-back").trigger("click"):"log"==s.name?($(".map-logs-details").empty(),$(document).trigger("dt.init.maplog",1)):"marker-reply"==s.name?ReplyPlugin.showReplyPanel():"fendan"==s.name&&ToolBar.switchLeftBar("fendan"),"dt-direction"==s.name?DirectionUtils.restore():$("#dtDirectionPanel").removeAttr("type").data("line",null))}),ToolBar.shareInit(),$("#panBtn").click(function(){r()}),$("#editMapInfoModal").on("show.bs.modal",function(){var t=$("#editMapInfoModal").attr("type");"edit"==t?($(".edit-map-info").removeClass("dt-none"),$(".edit-map-info-msg").removeClass("dt-none"),$(".edit-map-info-btn").removeClass("dt-none")):($(".public-map-info").removeClass("dt-none"),$(".public-map-info-msg").removeClass("dt-none"),$(".public-map-info-btn").removeClass("dt-none"))}).on("hide.bs.modal",function(){var t=$("#editMapInfoModal").attr("type");"edit"==t?($(".edit-map-info").addClass("dt-none"),$(".edit-map-info-msg").addClass("dt-none"),$(".edit-map-info-btn").addClass("dt-none")):($(".public-map-info").addClass("dt-none"),$(".public-map-info-msg").addClass("dt-none"),$(".public-map-info-btn").addClass("dt-none")),$("#editMapInfoModal").removeAttr("type")}),$("#public_map").click(function(){return $("#map-title-bar").text().indexOf("\u672a\u547d\u540d")>-1?($("#editMapInfoModal").modal(),$("#editMapInfoModal").addClass("nextStepPublish"),void $("#public_map_title").val($("#map-title-bar").text().trim())):void n()}),$("#publish_map").click(function(){var t=$("#public_map_title").val();if(t.indexOf("\u672a\u547d\u540d")>-1)return void PromptInfo.xcConfirm("\u8bf7\u8f93\u5165\u6709\u610f\u4e49\u7684\u540d\u79f0",PromptInfo.xcConfirm.typeEnum.info);if(t.length>1&&t.length<61){var e={mid:mid,title:t,desc:$("#public_map_desc").val()};MapUtils.ajax2server(edit_info_url,"PUT",e,function(){n()})}else PromptInfo.xcConfirm("\u6807\u9898\u4e0d\u80fd\u5c11\u4e8e4\u4e2a\u5b57\u6bcd(2\u4e2a\u6c49\u5b57)\u6216\u8d85\u8fc760\u4e2a\u5b57\u6bcd(30\u4e2a\u6c49\u5b57)",PromptInfo.xcConfirm.typeEnum.error,{onOk:function(){$(".txtBox p").removeAttr("style")}}),$(".txtBox p").css("margin-top","0")}),$("#save_map_info").click(function(){var t=$("#edit_map_title").val();if(t.length>1&&t.length<61){var e={mid:mid,title:t,desc:$("#edit_map_desc").val()};$("title").text(t+"-\u5730\u56fe\u65e0\u5fe7"),MapUtils.ajax2server(edit_info_url,"PUT",e,function(){$("#editMapInfoModal").modal("hide")}),$("#editMapInfoModal").hasClass("nextStepPublish")&&$("#map-title-bar").text().indexOf("\u672a\u547d\u540d")==-1&&(n(),$("#editMapInfoModal").removeClass("nextStepPublish"))}else alert("\u6807\u9898\u4e0d\u7b26\u5408\u89c4\u5b9a")}),$("#select_layer_type").click(function(){$("#selectLayerType").modal("show")}),$("#addLayerList").on("shown.bs.tab",function(t){"#marker_layer"==t.target.hash?$("#add_layer").attr("data-layer-type","markerLayer"):"#region_layer"==t.target.hash?$("#add_layer").attr("data-layer-type","regionLayer"):"#line_layer"==t.target.hash&&$("#add_layer").attr("data-layer-type","lineLayer")}),$("#add_layer").click(function(){var t=$("#add_layer").attr("data-layer-type"),e={markerLayer:add_marker_layer_url,lineLayer:add_line_layer_url,regionLayer:add_region_layer_url},i=e[t];i&&MapUtils.ajax2server(i,"POST",{mid:mid},function(t){current_layer_id=t.layer_id,$(".layer").find(".active-layer").removeClass("active-layer").addClass("layer-hover"),$("#line_layer_"+current_layer_id).find(".layer-hover").removeClass("layer-hover").addClass("active-layer"),document.getElementById("featureListPanelBorder").scrollTop=document.getElementById("featureListPanelBorder").scrollHeight+140})});$("#pullBoxPanel").hover(function(){"0px"!=$(".map-info").css("left")?$(".pull-box-control").css("left","199px"):$(".pull-box-control").removeAttr("style"),$(".pull-box-control").slideDown()},function(t){$(t.toElement).closest(".pull-box-control").length<=0&&$(".pull-box-control").slideUp()}),$(".pull-box-control").on("mouseleave",function(t){$(t.toElement).closest("#pullBoxPanel").length<=0&&$(".pull-box-control").slideUp()}),$("#pullBoxSearch").click(function(t){if($(".pull-box-control").addClass("dt-none"),current_layer_id==-1)return void PromptInfo.xcConfirm("\u5f53\u524d\u5e76\u672a\u9009\u4e2d\u56fe\u5c42...",PromptInfo.xcConfirm.typeEnum.info);var e;if(A.get("m_"+current_layer_id)?e=A.get("m_"+current_layer_id):A.get("l_"+current_layer_id)?e=A.get("l_"+current_layer_id):A.get("r_"+current_layer_id)&&(e=A.get("r_"+current_layer_id)),"marker_layer"!=e.getType())return void PromptInfo.xcConfirm("\u8be5\u529f\u80fd\u76ee\u524d\u53ea\u652f\u6301\u6807\u6ce8\u56fe\u5c42\u4f7f\u7528...",PromptInfo.xcConfirm.typeEnum.info);r();var i=$(t.target).attr("data-type");a(i)}),$("#pullBoxCircle").click(function(t){if($(".pull-box-control").addClass("dt-none"),current_layer_id==-1)return void PromptInfo.xcConfirm("\u5f53\u524d\u5e76\u672a\u9009\u4e2d\u56fe\u5c42...",PromptInfo.xcConfirm.typeEnum.info);var e;if(A.get("m_"+current_layer_id)?e=A.get("m_"+current_layer_id):A.get("l_"+current_layer_id)?e=A.get("l_"+current_layer_id):A.get("r_"+current_layer_id)&&(e=A.get("r_"+current_layer_id)),"marker_layer"!=e.getType())return void PromptInfo.xcConfirm("\u8be5\u529f\u80fd\u76ee\u524d\u53ea\u652f\u6301\u6807\u6ce8\u56fe\u5c42\u4f7f\u7528...",PromptInfo.xcConfirm.typeEnum.info);r();var i=$(t.target).attr("data-type");a(i)}),$("#distanceBtn").click(function(t){r();var e=$(t.target).attr("data-type");a(e)}),$("#drawingToolbar").find(".draw-btn").click(function(t){r();var e=$(t.target).attr("data-type");a(e)}),$("#save_layer_title").click(function(){var t=$("#edit_layer_title").val();if(0==t.length){var e="\u56fe\u5c42\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a";return void PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.error)}var i={title:t,id:current_layer_id,mid:mid};$("#editLayerTitle").modal("hide");var n=$(this).attr("data-type"),r=update_marker_layer_url;"region_layer"==n?r=update_region_layer_url:"line_layer"==n&&(r=update_line_layer_url),MapUtils.ajax2server(r,"PUT",i,function(){})}),$("#update_col_attr").click(function(){var t=$("#edit_col_title").val(),e=MapUtils.check_col_name(t);if(""!=e)return void PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.error);$("#editColTitle").modal("hide");var i,n;i=$(this).attr("data-type");var r=$(this).attr(i+"-layer-id");if(r){"marker"==i?n=update_attrs_marker_url:"region"==i?n=update_attrs_region_layer_url:"line"==i&&(n=update_attrs_line_layer_url);var a={id:r,ofield:$(this).attr("data-field"),nfield:t,mid:mid};MapUtils.ajax2server(n,"POST",a,function(t){if(t.status&&"403"==t.status){var e=t.msg;PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.info)}else $("#update_col_attr").removeAttr(i+"-layer-id"),$("#dataListClose").trigger("click")})}}),$("#sort_style .icon_size").bind("click",function(){$("#sort_style .icon_size").removeClass("active"),$(this).addClass("active")}),$("#sort_style .sort_type").bind("click",function(){$("#sort_style .sort_type").removeClass("active"),$(this).addClass("active")}),$("#sort_style .select-color").bind("click",function(){$("#sort_style .select-color").removeClass("active"),$(this).addClass("active")}),$("#editCategoryMarkerIcon").on("show.bs.modal",function(t){if(t.relatedTarget){var e=$(t.relatedTarget).attr("data-id");$("#setCategoryMarkerIcon").attr("data-id",e).attr("data-category",!1)}var i=$("#category_field_id_"+e).data("category");i&&$("#edit_category_icon .icon_preview").attr("src",i.icon_url)}),$("#editCategoryMarkerIcon").on("hide.bs.modal",function(){$("#setCategoryMarkerIcon").removeAttr("data-id").removeAttr("data-category")}),$("#setCategoryMarkerIcon").click(function(){var t=$(this).attr("data-id"),e=$("#edit_category_icon .icon_preview").attr("src"),i=$(this).attr("data-category");if("true"==i){var n=$("#marker_layer_"+current_layer_id+"_category_field_"+t).attr("data-features"),r={id:current_layer_id,ids:n,url:e,category_id:t};MapUtils.ajax2server(update_category_style_marker_layer_url,"POST",r)}$("#category_img_id_"+t).attr("src",e);var a=$("#category_field_id_"+t).data("category");a&&(a.icon_url=e,$("#category_field_id_"+t).data("category",a))}),$("#editCategoryLineStyle").on("show.bs.modal",function(t){if(t.relatedTarget){var e=$(t.relatedTarget).attr("data-id");$("#setCategoryLineStyle").attr("data-id",e).attr("data-category",!1)}var i=$("#category_field_id_"+e).data("category");i&&c(i)}),$("#editCategoryLineStyle").on("hide.bs.modal",function(){$("#setCategoryLineStyle").removeAttr("data-id").removeAttr("data-category")}),$("#setCategoryLineStyle").click(function(){var t=$(this).attr("data-id"),e=$(this).attr("data-strokeweight"),i=$(this).attr("data-strokecolor"),n=$(this).attr("data-strokeopacity"),r=MapUtils.RGB2Hex(i.substring(1,7)),a=$(this).attr("data-strokestyle"),o=$(this).attr("data-category");
if("true"==o){var s=$("#line_layer_"+current_layer_id+"_category_field_"+t).attr("data-features"),l={mid:mid,id:current_layer_id,ids:s,strokeColor:i,strokeWeight:e,strokeOpacity:n,strokeStyle:a,category_id:t};MapUtils.ajax2server(update_category_style_line_layer_url,"POST",l)}$("#category_style_"+t).css("border","4px solid "+i).css("background-color","rgba("+r[0]+","+r[1]+","+r[2]+","+n+")");var d=$("#category_field_id_"+t).data("category");d&&(d.strokeWeight=e,d.strokeColor=i,d.strokeOpacity=n,d.strokeStyle=a,$("#category_field_id_"+t).data("category",d))}),$("#editCategoryRegionStyle").on("show.bs.modal",function(t){if(t.relatedTarget){var e=$(t.relatedTarget).attr("data-id");$("#setCategoryRegionStyle").attr("data-id",e).attr("data-category",!1)}var i=$("#category_field_id_"+e).data("category");i&&u(i)}),$("#editCategoryRegionStyle").on("hide.bs.modal",function(){$("#editCategoryRegionStyle li").removeClass("active"),$("#editCategoryRegionStyle li:first").addClass("active"),$("#setCategoryRegionStyle").removeAttr("data-id").removeAttr("data-category")}),$("#setCategoryRegionStyle").click(function(){var t=$(this).attr("data-id"),e=$(this).attr("data-strokeweight"),i=$(this).attr("data-strokecolor"),n=$(this).attr("data-strokeopacity"),r=$(this).attr("data-fillcolor"),a=$(this).attr("data-fillopacity"),o=MapUtils.RGB2Hex(r.substring(1,7)),s=$(this).attr("data-category");if("true"==s){var l=$("#region_layer_"+current_layer_id+"_category_field_"+t).attr("data-features"),d={mid:mid,id:current_layer_id,ids:l,strokeColor:i,strokeWeight:e,strokeOpacity:n,fillColor:r,fillOpacity:a,category_id:t};MapUtils.ajax2server(update_category_style_region_layer_url,"POST",d)}$("#category_style_"+t).css("border","1px solid "+i).css("background-color","rgba("+o[0]+","+o[1]+","+o[2]+","+a+")");var h=$("#category_field_id_"+t).data("category");h&&(h.strokeWeight=e,h.strokeColor=i,h.strokeOpacity=n,h.fillColor=r,h.fillOpacity=a,$("#category_field_id_"+t).data("category",h))}),$("#next_start_locate").bind("click",function(){$("#uploadFileModal").modal("hide");var t=$("#select_title_field").val(),e=$(".select_locate_type.active").attr("data-type");if("lnglat"!=e&&"address"!=e)return void PromptInfo.xcConfirm("\u5b9a\u4f4d\u65b9\u5f0f\u9519\u8bef",PromptInfo.xcConfirm.typeEnum.error);"address"==e&&(t=$("#select_title_field_address").val());var i=$("#isAppend").val(),n={mid:mid,id:current_layer_id,type:e,lng:$("#select_lng_field").val(),lat:$("#select_lat_field").val(),coord_type:$("#select_coordinate_field").val(),title:t,address:$("#select_title_address").val(),center:j.getCenter().lng.toString()+","+j.getCenter().lat.toString(),level:j.getZoom(),isAppend:i};if("null"!=$("#select_title_city").val())n.city=$("#select_title_city").val();else if("---"!=$("#province :selected").text()){var r=$("#province :selected").text(),a=$("#city :selected").text();"---"!=$("#city :selected").text()?n.city=r+"\u7701"+a:n.city=r+"\u7701"}MapUtils.ajax2server(locate_url,"POST",n,function(){$("#prevBtn").addClass("dt-none"),$("#next_start_locate").addClass("dt-none"),$("#uploadFileModal").find(".modal-dialog").addClass("modal-sm").removeAttr("style"),$("#upload_body").removeClass("dt-none"),$("#select_data_field").addClass("dt-none"),$(".uploadifive-queue").children().remove()},function(){$("#prevBtn").addClass("dt-none"),$("#next_start_locate").addClass("dt-none"),$("#uploadFileModal").find(".modal-dialog").addClass("modal-sm").removeAttr("style"),$("#upload_body").removeClass("dt-none"),$("#select_data_field").addClass("dt-none"),$(".uploadifive-queue").children().remove(),$("#dataLoading").modal("hide")})}),$("#token_import_btn").click(function(){var t=$("#token_value").val();if(t.length<20){var e="\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u6570\u636e\u5bc6\u94a5";return void PromptInfo.xcConfirm(e,PromptInfo.xcConfirm.typeEnum.error)}$("#loadTokenImport").show();var i,n,r={mid:mid,id:current_layer_id};n=$(this).attr("data-type"),"marker"==n?(i=marker_layer_copy_url,r.token=t):"region"==n?(i=region_api_url,r.token=t):"line"==n&&(i=line_layer_copy_url,r.token=t),MapUtils.ajax2server(i,"POST",r,function(){$("#loadTokenImport").hide(),$("#token_value").removeAttr("disabled").val(""),$("#token_import_btn").removeAttr("disabled"),$("#tokenImportModal").modal("hide")},function(){$("#loadTokenImport").hide(),$("#token_value").removeAttr("disabled").val(""),$("#token_import_btn").removeAttr("disabled"),$("#tokenImportModal").modal("hide")})}),$("#uploadImgsModal").on("show.bs.modal",function(){$('#imgs_tab a[href="#localImg"]').tab("show"),$("#selected_imgs").empty();var t=$("#bind_imgs");t.data("unbind-img-ids",[]);var e=t.attr("feature_id"),i=t.attr("type"),n=null;switch(i){case"marker":n=get_marker_imgs_url;break;case"line":n=get_line_imgs_url;break;case"region":n=get_region_imgs_url}n&&MapUtils.ajax2server(n+"?id="+e,"GET","",function(t){for(var e="",i=0;i<t.imgs.length;i++)e+=MapUtils.uploadImgStyle(t.imgs[i]);$("#selected_imgs").append(e)})});var H={width:84,height:32,buttonText:"\u9009\u62e9\u56fe\u7247",buttonClass:"btn btn-primary dt-pointer dt-mar12t",multi:!0,auto:!0,fileSizeLimit:"5MB",uploadScript:upload_img_url,formData:{user_phone:user_phone}};$("#upload_imgs").uploadImg(H),$("#loadAllImgs").click(function(){$("#imgs_container").empty();var t=[];$("#selected_imgs .selected_feature_img").each(function(){t.push($(this).attr("img_id"))}),MapUtils.ajax2server(user_imgs_url,"GET",{},function(e){for(var i=0;i<e.imgs.length;i++)$("#imgs_container").append(MapUtils.myImgs(e.imgs[i],t.indexOf(e.imgs[i].id.toString())>-1))})}),$("#get_img_from_url").bind("click",function(){$("#get_img_from_url").attr("disabled","disabled"),MapUtils.ajax2server(add_img_from_url,"POST",{url:$("#img_url").val()},function(t){$("#get_img_from_url").removeAttr("disabled"),$("#selected_imgs").append(MapUtils.uploadImgStyle(t.img))},function(){PromptInfo.xcConfirm("\u7f51\u7edc\u56fe\u7247\u83b7\u53d6\u5931\u8d25\uff01",PromptInfo.xcConfirm.typeEnum.error),$("#get_img_from_url").removeAttr("disabled")}),$("#img_url").val("")}),$("#selected_imgs").dragsort({dragSelector:"div",dragBetween:!1,placeHolderTemplate:"<li class='placeHolder'><div></div></li>"}),$("#selected_imgs").bind("click",function(t){if($(t.target).hasClass("img_del")){$(t.target).parent().parent().remove();var e=$(t.target).attr("img_id"),i=$("#bind_imgs").data("unbind-img-ids");i?i.push(e):i=[e],$("#bind_imgs").data("unbind-img-ids",i)}}),$("#imgs_container").bind("click",function(t){var e=$(t.target);if($(t.target).hasClass("single_img"))if(e.hasClass("active")){e.removeClass("active"),e.next().remove();var i="#my_img_"+$(t.target).attr("img_id");$(i).remove()}else{e.addClass("active");var n={};n.id=$(t.target).attr("img_id"),n.snapshot=$(t.target).attr("src"),$("#selected_imgs").append(MapUtils.uploadImgStyle(n));var r="<div title='\u5df2\u7ecf\u7ed1\u5b9a' class='selected-img'></div>";e.after(r)}else $(t.target).hasClass("img_del")&&PromptInfo.xcConfirm("\u4f60\u786e\u5b9a\u8981\u5220\u9664\u5417?",PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){MapUtils.ajax2server(destroy_img_url,"DELETE",{id:$(t.target).attr("img_id")},function(){$(t.target).parent().remove();var e="#my_img_"+$(t.target).attr("img_id");$(e).remove()})}})}),$("#bind_imgs").bind("click",function(){BInfowindow.close();var t,e=$(this).attr("feature_id"),i=$(this).attr("layer-id"),n=$(this).attr("type"),r=$(this).data("unbind-img-ids"),a=[],o=null;switch(n){case"marker":o="#setMarkerTitle_"+e,t=A.get("m_"+i);break;case"line":o="#setLineTitle_"+e,t=A.get("l_"+i);break;case"region":o="#setRegionTitle_"+e,t=A.get("r_"+i)}$("#selected_imgs .selected_feature_img").each(function(){a.push($(this).attr("img_id"))});var s={mid:mid,layer_id:i,id:e,img_ids:a,unbind_img_ids:r};switch(o&&0==$(o).parent().find(".glyphicon-picture").length&&a.length>0?$(o).after('<span class="glyphicon glyphicon-picture pull-right dt-line-18h" id="'+n+"_img_"+e+'"></span>'):0==a.length&&$("#"+n+"_img_"+e).remove(),n){case"marker":MapUtils.ajax2server(update_imgs_marker_url,"POST",s,function(){$("#uploadImgsModal").modal("hide");var i=t.getMarker(e);BInfowindow.open(i,{status:BInfowindow.template_opts.status})},function(t){PromptInfo.xcConfirm(t.responseJSON.msg,PromptInfo.xcConfirm.typeEnum.info)});break;case"line":MapUtils.ajax2server(update_imgs_line_url,"POST",s,function(){$("#uploadImgsModal").modal("hide");var i=t.getLine(e);BInfowindow.open(i)},function(t){PromptInfo.xcConfirm(t.responseJSON.msg,PromptInfo.xcConfirm.typeEnum.info)});break;case"region":MapUtils.ajax2server(update_imgs_region_url,"POST",s,function(){$("#uploadImgsModal").modal("hide");var i=t.getRegion(e);BInfowindow.open(i)},function(t){PromptInfo.xcConfirm(t.responseJSON.msg,PromptInfo.xcConfirm.typeEnum.info)})}});var q={width:46,height:46,buttonText:"+",buttonClass:"upload-custom-img pull-left",multi:!1,auto:!0,fileSizeLimit:"5MB",uploadScript:create_icons_url,formData:{user_phone:user_phone}};$(document).on("upload.custom.icon.init",function(){$("#user_upload_icon").uploadIcon(q)}),$("#upload_icon").uploadIcon(q),$("#upload_icon1").uploadIcon(q),$("#upload_icon2").uploadIcon(q),$(".custom_icons").click(function(t){var e=$(t.target);if(e.hasClass("custom_icon_remove")){var i="\u5220\u9664\u56fe\u6807\u540e\u5176\u4ed6\u5730\u56fe\u5c06\u4e0d\u80fd\u518d\u91cd\u590d\u4f7f\u7528\uff0c\u786e\u8ba4\u7ee7\u7eed\u5220\u9664\uff1f";PromptInfo.xcConfirm(i,PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){$(".icon_preview").attr("src",oss_host+"/uploads/icons/default/f86767-s-null.png").attr("color","f86767").attr("size","s").attr("symbol","null").attr("bubble","true");var t=e.attr("data-id");MapUtils.ajax2server(destroy_icons_url,"delete",{id:t},function(){$(".myicon").each(function(){$(this).attr("data-id")==t&&$(this).parent().remove()})})}})}else $(t.target).hasClass("myicon")&&$(".icon_preview").attr("src",e.attr("src")).css("max-width","60px").css("max-height","60px").attr("data-id",e.attr("data-id"))}),$("#layer_admin_list").click(function(t){$(".permission-layer").removeClass("layer-active"),$(t.target).find(".permission-layer").addClass("layer-active")}),$(".member-list").click(function(t){$(t.target).hasClass("send-phone")?$(document).trigger("dt.map.invite.member","#send_mobile_input"):$(t.target).parent().hasClass("member")&&$(document).trigger("dt.add.member.to.map",t.target)}),$(".layer-member-list").click(function(t){$(t.target).hasClass("send-phone")?$(document).trigger("dt.layer.invite.member","#send_layer_invite"):$(t.target).closest("div").hasClass("layer-member")&&$(document).trigger("dt.add-member-to-layer",t.target)}),$(".feature-member-list").click(function(t){$(t.target).hasClass("send-phone")?$(document).trigger("dt.feature.invite.member",["#send_feature_invite",A]):$(t.target).closest("div").hasClass("feature-member")&&$(document).trigger("dt.add-member-to-feature",[t.target,$("#addMemberToFeature").attr("layer-id"),A])}),$("#uploadFileModal").on("shown.bs.modal",function(){$('#uploadFileModal a[href="#localUpload"]').tab("show"),$("#lnglatRadio").trigger("click")}),$("#layerContainer").bind("click",function(t){$(".layer").find(".active-layer").removeClass("active-layer").addClass("layer-hover"),$(t.target).closest(".layer").find(".layer-hover").removeClass("layer-hover").addClass("active-layer"),current_layer_id=$(t.target).closest(".layer").attr("layer-id");var e=$(t.target).closest(".layer").attr("layer-type"),i="";if("marker_layer"==e?i=A.get("m_"+current_layer_id):"line_layer"==e?i=A.get("l_"+current_layer_id):"region_layer"==e&&(i=A.get("r_"+current_layer_id)),$(t.target).hasClass("layer_title"))C(t.target);else if($(t.target).hasClass("display_layer"))E($(t.target));else if($(t.target).hasClass("data-marker-list")){var n={layer:i,map:j,type:"marker"},r=$(t.target).attr("id");$("#"+r).openDataList(n)}else if($(t.target).hasClass("data-region-list")){var n={layer:i,map:j,type:"region"},r=$(t.target).attr("id");$("#"+r).openDataList(n)}else if($(t.target).hasClass("data-line-list")){var n={layer:i,map:j,type:"line"},r=$(t.target).attr("id");$("#"+r).openDataList(n)}else if($(t.target).hasClass("dt-marker-layer"))MarkerUtils.setMarkerLayerPanel(t.target);else if($(t.target).hasClass("dt-region-layer"))RegionUtils.setRegionLayerPanel(t.target);else if($(t.target).hasClass("dt-line-layer"))LineUtils.setLineLayerPanel(t.target);else if($(t.target).hasClass("edit_layer"))$("#save_layer_title").attr("layer-id",$(t.target).attr("layer-id"));else if($(t.target).hasClass("select_marker")){var a=$(t.target).attr("marker-id"),o=i.getMarker(a);6==i.render_style&&j.setZoom(15),L.DomEvent.stopPropagation(t),$(document).trigger("dt.select.marker",o)}else if($(t.target).hasClass("select_region")){var s=$(t.target).attr("region-id"),l=i.getRegion(s);$(document).trigger("dt.select.region",l)}else if($(t.target).hasClass("select_line")){var d=$(t.target).attr("line-id"),h=i.getLine(d);h&&h.line_route&&($(t.target).closest("li").find(".direction-info").hasClass("direction-animate")?$(t.target).closest("li").find(".direction-info").removeClass("direction-animate"):($(t.target).closest("li").find(".direction-info").addClass("direction-animate"),$(t.target).closest("li").find(".direction-info").find("ul").show())),h&&$(document).trigger("dt.select.line",h)}else if($(t.target).hasClass("del_marker")){var c="\u786e\u8ba4\u5c06\u6b64\u6570\u636e\u4ece\u56fe\u5c42\u4e0a\u5220\u9664\uff1f";PromptInfo.xcConfirm(c,PromptInfo.xcConfirm.typeEnum.confirm,{onOk:function(){var e=$(t.target).closest("ul"),i=$(t.target).closest(".marker_layer").attr("layer-id"),n={mid:mid,id:$(t.target).attr("marker-id")};MapUtils.ajax2server(destroy_marker_url,"DELETE",n,function(){0==e.children().length&&e.append(MapUtils.add_upload_file(i))})}})}else if($(t.target).hasClass("load_region"))current_layer_id=$(t.target).attr("region_layer_id"),$("#token_import_btn").attr("layer-id",current_layer_id),$("#token_import_btn").attr("data-type","region"),$("#tokenImportModal").modal("show"),$("#token_value").val("");else if($(t.target).hasClass("load_district"))current_layer_id=$(t.target).attr("region_layer_id"),$("#loadDistrict").modal("show"),$("#submitDistrict").attr("layer-id",current_layer_id);else if($(t.target).hasClass("load_line"))current_layer_id=$(t.target).attr("line_layer_id"),$("#token_import_btn").attr("layer-id",current_layer_id),$("#token_import_btn").attr("data-type","line"),$("#tokenImportModal").modal("show"),$("#token_value").val("");else if($(t.target).hasClass("marker-layer-style")){var u=A.get("m_"+current_layer_id).getStyleSetting();StyleUtils.openLayerStylePanel(u)}else if($(t.target).hasClass("edit_region_layer_style")){var u=A.get("r_"+current_layer_id).getStyleSetting();StyleUtils.openLayerStylePanel(u)}else if($(t.target).hasClass("edit_line_layer_style")){var u=A.get("l_"+ +current_layer_id).getStyleSetting();StyleUtils.openLayerStylePanel(u)}else if($(t.target).hasClass("upload_file")){var p=$(t.target).attr("layer-id");O(p,!1)}else if($(t.target).hasClass("edit_category")){var r=$(t.target).attr("data-id");$("#setCategoryMarkerIcon").attr("data-id",r),$("#setCategoryLineStyle").attr("data-id",r),$("#setCategoryRegionStyle").attr("data-id",r)}else if($(t.target).closest("div").hasClass("direction-info")){var d=$(t.target).closest(".select_line").attr("line-id"),h=i.getLines().get(d);$(document).trigger("dt.select.line",h)}}),$(document).on("dt.select.region",function(t,e,i){if($("#fendanToolbar").is(":visible"))FendanPlugin.selectRegion(e.feature_id);else{var n=$.extend({status:"show"},i);p(e,n)}}),$(document).on("dt.select.marker",function(t,e){var i=A.get("m_"+e.layer_id);if(i.isCluster()&&j.getZoom()<15&&j.flyTo(e.getPosition(),15,{animate:!1}),e.display){var n={status:"show"};p(e,n)}}),$(document).on("dt.select.line",function(t,e,i){var n=$.extend({status:"show"},i);p(e,n)}),$("#set_line_style").click(function(){var t=$(this).data("data-line"),e=$(this).attr("data-line-id"),i=$(this).attr("data-strokeweight"),n=$(this).attr("data-strokecolor"),r=$(this).attr("data-strokeopacity"),a=$(this).attr("data-strokestyle");if(t.getStrokeWeight()!=i||t.getStrokeColor()!=n||t.getStrokeOpacity()!=r||t.getStrokeStyle()!=a){var o={mid:mid,id:e,strokeWeight:i,strokeColor:n,strokeOpacity:r,strokeStyle:a};MapUtils.ajax2server(update_line_style_url,"PUT",o,function(){})}}),$("#editLineStyle").on("shown.bs.modal",function(){var t=A.get("l_"+$("#editLineStyle").attr("line-layer-id")).getLines().get($("#editLineStyle").attr("line-id")),e=t.getStrokeOpacity(),i=t.getStrokeWeight(),n=t.getStrokeColor().substring(1,7),r=t.getStrokeStyle();$("#line_opacity input").attr("data-opacity",e).val(100-100*e),$("#line_stroke input").val(i),$("#line_selected_color").val(n);var a=0;$("#line_stroke_style .dd-option-value").each(function(t,e){if($(e).attr("value")==r)return void(a=t)}),$("#line_stroke_style_select").ddslick("select",{index:a}),b()}),$("#set_region_style").click(function(){var t=$(this).data("data-region"),e=$(this).attr("data-region-id"),i=$("#set_region_style"),n=i.attr("data-strokeweight"),r=i.attr("data-strokecolor"),a=i.attr("data-strokeopacity"),o=i.attr("data-fillcolor"),s=i.attr("data-fillopacity");if(t.getStrokeWeight()!=n||t.getStrokeColor()!=r||t.getStrokeOpacity()!=a||t.getFillColor()!=o||t.getFillOpacity()!=s){var l={mid:mid,id:e,fillColor:o,strokeWeight:n,fillOpacity:s,strokeColor:r,strokeOpacity:a};MapUtils.ajax2server(update_region_style_url,"PUT",l,function(){})}});var G=function(t){var e,i,n,r,a,o=$("#set_region_style");if(t){var s=$("#editRegionStyle"),l=s.attr("region-layer-id"),d=s.attr("region-id"),h=A.get("r_"+l).getRegions().get(d);e=h.getStrokeOpacity(),i=h.getStrokeWeight(),n=h.getStrokeColor(),r=h.getFillOpacity(),a=h.getFillColor(),o.attr("data-strokeOpacity",e),o.attr("data-strokeWeight",i),o.attr("data-strokeColor",n),o.attr("data-fillOpacity",r),o.attr("data-fillColor",a)}else a=o.attr("data-fillcolor"),i=o.attr("data-strokeweight"),r=o.attr("data-fillopacity"),n=o.attr("data-strokecolor"),e=o.attr("data-strokeopacity");var c=$("#edit_region .region_sets.active").attr("data-type");"fill"==c?($("#region_opacity input").attr("data-opacity",r).val(100-100*r),$("#region_selected_color").val(a.substring(1,7))):($("#region_opacity input").attr("data-opacity",r).val(100-100*r),$("#region_stroke input").val(i),$("#region_selected_color").val(n.substring(1,7)));var u=MapUtils.RGB2Hex(n.substring(1,7)),p=MapUtils.RGB2Hex(a.substring(1,7));$("#region_swatch").css("background","rgba("+p[0]+","+p[1]+","+p[2]+","+r+")").css("border",i+"px solid rgba("+u[0]+","+u[1]+","+u[2]+","+e+")")};$("#editRegionStyle").on("shown.bs.modal",function(){G(!0)}),$(".marker-icon-style .select-color").bind("click",function(){$(".select-color").removeClass("active"),$(this).addClass("active"),g()}),$(".marker-icon-style .marker-icon-size").bind("click",function(){g()}),$(".marker-icon-style .select-shape").bind("click",function(){$(".select-shape").removeClass("active"),$(this).addClass("active"),g()}),$("input[name='radio_bubble'], input[name='radio_category_bubble'], input[name='radio_marker_bubble']").click(function(t){$(".select-shape").removeClass("active"),$(".icon_size").removeClass("active"),$(".select-color").removeClass("active"),$("[data-color='f86767']").addClass("active");var e="";"not_bubble"==$(t.target).attr("id")||"category_not_bubble"==$(t.target).attr("id")||"marker_set_not_bubble"==$(t.target).attr("id")?($(".icon.num").closest("li").hide(),$("[data-size='l']").addClass("active"),$("[data-symbol='embassy']").addClass("active"),e="/uploads/icons/svg/f86767-l-embassy.svg"):($(".icon.num").closest("li").show(),$("[data-size='s']").addClass("active"),$("[data-symbol='null']").addClass("active"),e="/uploads/icons/default/f86767-s-null.png"),$(".icon_preview").attr("src",oss_host+e)}),$(document).on("dt.category.style",function(t,e){var i=$(e).data("target");$(i).modal("show");var n=null;$(e).closest("li").find(".category_style").length>0?(n=$(e).closest("li").find(".category_style").attr("data-id"),$("#setCategoryLineStyle").attr("data-id",n).attr("data-category",!0),$("#setCategoryRegionStyle").attr("data-id",n).attr("data-category",!0)):(n=$(e).closest("li").find("img").attr("id").split("_")[5],$("#setCategoryMarkerIcon").attr("data-id",n).attr("data-category",!0));var r,a=$(e).closest(".layer").attr("layer-id"),o=$(e).closest("li").find(".layer_category_field").attr("id");if(o.indexOf("marker")>=0?r=A.get("m_"+a):o.indexOf("line")>=0?r=A.get("l_"+a):o.indexOf("region")>=0&&(r=A.get("r_"+a)),r){var s=r.getType(),l=r.getCategory(n);"marker_layer"==s?$("#edit_category_icon .icon_preview").attr("src",l.icon_url):"line_layer"==s?c(l):"region_layer"==s&&u(l)}});var W=null;$(document).on("dt.category.selected",function(t,e){if(!$(e).is("ul")){e=$(e).closest("li");for(var i=e.attr("data-layer-id"),n=A.values(),r=0;r<n.length;r++){var a=n[r];a.isCategorized()&&(CategoryUtils.removeVectors(a),window.clearInterval(W),addOverlays=null)}var o,s=$(e).find(".layer_category_field").attr("id");if(s.indexOf("marker")>=0?o=A.get("m_"+i):s.indexOf("line")>=0?o=A.get("l_"+i):s.indexOf("region")>=0&&(o=A.get("r_"+i)),o){var l=o.getType();if("marker_layer"==l&&6==o.render_style){for(var d=o.getMarkers(),h=$(e).closest("li").find(".layer_category_field").attr("data-features").split(","),c=new Array,u=new L.latLngBounds,r=0;r<h.length;r++){var p=d.get(h[r]);if(p&&(u.extend(p.getPosition()),p.display)){var f=p.getIcon().iconSize,m="";m=f[0]>f[1]?f[0]/2+4:f[1]/2+4;var g=new L.circleMarker(p.getPosition(),{fillOpacity:0,radius:m,color:"#00A2CA"});g.feature_id=p.feature_id,g.layer_id=p.layer_id,c.push(g)}}o.vectors=[],W=window.setInterval(function(){var t=c.shift();if(t){var e=A.get("m_"+t.layer_id),i=e.getMarker(t.feature_id);if(e.vectors.push(t),i.getElement()){var n=i.getElement();$(n).is(":visible")&&t.addTo(j)}}0==c.length&&(window.clearInterval(W),addOverlays=null,j.fitBounds(u))},1)}}}}),$("#edit_region .region_sets").click(function(){$("#edit_region li").removeClass("active"),$(this).addClass("active"),"stroke"==$(this).attr("data-type")?($("#region_stroke_text").show(),$("#region_stroke").show()):($("#region_stroke_text").hide(),$("#region_stroke").hide()),G(!1)}),$("#edit_region .select-color").click(function(){$("#edit_region .select-color").removeClass("active"),$(this).addClass("active");var t=$("#edit_region .select-color.active").attr("data-color");$("#region_selected_color").val(t),v()}),$("#region_selected_color").keyup(function(){var t=this,e=$(t).val();6==e.length&&v()}),$("#region_opacity .spinner input").keyup(function(){var t=$(this).val();isNaN(t)?t=20:t<0?t=0:t>100&&(t=100),$("#region_opacity input").attr("data-opacity",(100-t)/100).val(t),v()}),$("#region_opacity .spinner .btn:first-of-type").on("click",function(){var t=MapUtils.accAdd(parseFloat($("#region_opacity input").val()),1);isNaN(t)?t=20:t<0?t=0:t>100&&(t=100),$("#region_opacity input").attr("data-opacity",(100-t)/100).val(t),v()}),$("#region_opacity .spinner .btn:last-of-type").on("click",function(){var t=MapUtils.addSub(parseFloat($("#region_opacity input").val()),1);isNaN(t)?t=20:t<0?t=0:t>100&&(t=100),$("#region_opacity input").attr("data-opacity",(100-t)/100).val(t),v()}),$("#region_stroke .spinner .btn:first-of-type").on("click",function(){var t=MapUtils.accAdd(parseInt($("#region_stroke input").val()),1);isNaN(t)&&(t=0),t>10||($("#region_stroke input").val(t),v())}),$("#region_stroke .spinner .btn:last-of-type").on("click",function(){var t=MapUtils.addSub(parseInt($("#region_stroke input").val()),1);isNaN(t)&&(t=0),t<1||t>10||($("#region_stroke input").val(t),v())}),$("#region_stroke input").keyup(function(){v()}),$("#edit_line .select-color").click(function(){$("#edit_line .select-color").removeClass("active"),$(this).addClass("active");var t=$("#edit_line .select-color.active").attr("data-color");$("#line_selected_color").val(t),b()}),$("#line_selected_color").keyup(function(){var t=$(this).val();6==t.length&&b()}),$("#line_opacity .spinner input").keyup(function(){var t=$(this).val();isNaN(t)?t=20:t<0?t=0:t>100&&(t=100),$("#line_opacity input").attr("data-opacity",(100-t)/100).val(t),$("#line_opacity input").val(t),b()}),$("#line_opacity .spinner .btn:first-of-type").on("click",function(){var t=MapUtils.accAdd(parseInt($("#line_opacity input").val()),1);isNaN(t)?t=20:t<0?t=0:t>100&&(t=100),$("#line_opacity input").attr("data-opacity",(100-t)/100).val(t),$("#line_opacity input").val(t),b()}),$("#line_opacity .spinner .btn:last-of-type").on("click",function(){var t=MapUtils.addSub(parseFloat($("#line_opacity input").val()),1);isNaN(t)?t=20:t<0?t=0:t>100&&(t=100),$("#line_opacity input").attr("data-opacity",(100-t)/100).val(t),$("#line_opacity input").val(t),b()}),$("#line_stroke .spinner .btn:first-of-type").on("click",function(){var t=MapUtils.accAdd(parseFloat($("#line_stroke input").val()),1);isNaN(t)&&(t=1),t>10||($("#line_stroke input").val(t),b())}),$("#line_stroke .spinner .btn:last-of-type").on("click",function(){var t=MapUtils.addSub(parseFloat($("#line_stroke input").val()),1);isNaN(t)&&(t=1),t<1||t>10||($("#line_stroke input").val(t),b())}),$("#line_stroke input").keyup(function(){b()}),$("#line_stroke_style_select").ddslick({width:128,onSelected:function(){b()}}),$("#edit_category_line .select-color").click(function(){$("#edit_category_line .select-color").removeClass("active"),$(this).addClass("active");var t=$("#edit_category_line .select-color.active").attr("data-color");$("#category_line_selected_color").val(t),w()}),$("#category_line_selected_color").keyup(function(){var t=$(this).val();6==t.length&&w()}),$("#category_line_opacity .spinner .btn:first-of-type").on("click",function(){var t=MapUtils.accAdd(parseFloat($("#category_line_opacity input").val()),1);isNaN(t)?t=20:t<0?t=0:t>100&&(t=100),$("#category_line_opacity input").attr("data-opacity",(100-t)/100).val(t),w()}),$("#category_line_opacity input, #category_line_stroke input").keyup(function(){var t=$(this).val();isNaN(t)?t=20:t<0?t=0:t>100&&(t=100),$("#category_line_opacity input").attr("data-opacity",(100-t)/100).val(t),w()}),$("#category_line_opacity .spinner .btn:last-of-type").on("click",function(){var t=MapUtils.addSub(parseFloat($("#category_line_opacity input").val()),1);isNaN(t)?t=20:t<0?t=0:t>100&&(t=100),$("#category_line_opacity input").attr("data-opacity",(100-t)/100).val(t),w()}),$("#category_line_stroke .spinner .btn:first-of-type").on("click",function(){var t=MapUtils.accAdd(parseFloat($("#category_line_stroke input").val()),1);isNaN(t)&&(t=1),t>10||($("#category_line_stroke input").val(t),w())}),$("#category_line_stroke .spinner .btn:last-of-type").on("click",function(){var t=MapUtils.addSub(parseFloat($("#category_line_stroke input").val()),1);isNaN(t)&&(t=1),t<1||t>10||($("#category_line_stroke input").val(t),w())}),$("#category_line_stroke_style_select").ddslick({width:128,onSelected:function(){w()}}),$("#edit_category_region .region_sets").click(function(){$("#edit_category_region li").removeClass("active"),$(this).addClass("active");var t=$("#setCategoryRegionStyle").attr("data-strokeweight"),e=($("#setCategoryRegionStyle").attr("data-strokeopacity"),$("#setCategoryRegionStyle").attr("data-strokecolor")),i=($("#setCategoryRegionStyle").attr("data-fillopacity"),$("#setCategoryRegionStyle").attr("data-fillcolor"));"stroke"==$(this).attr("data-type")?($("#category_region_stroke_text").show(),$("#category_region_stroke").show(),$("#category_region_selected_color").val(e.substring(1,7)),$("#category_region_opacity input").attr("data-opacity"),$("#category_region_stroke input").val(t)):($("#category_region_stroke_text").hide(),$("#category_region_stroke").hide(),$("#category_region_selected_color").val(i.substring(1,7)),$("#category_region_opacity input").attr("data-opacity"))}),$("#edit_category_region .select-color").click(function(){$("#edit_category_region .select-color").removeClass("active"),$(this).addClass("active");var t=$("#edit_category_region .select-color.active").attr("data-color");$("#category_region_selected_color").val(t),x()}),$("#category_region_selected_color").keyup(function(){var t=$(this).val();6==t.length&&x()}),$("#category_region_opacity .spinner .btn:first-of-type").on("click",function(){var t=MapUtils.accAdd(parseInt($("#category_region_opacity input").val()),1);isNaN(t)?t=20:t<0?t=0:t>100&&(t=100),$("#category_region_opacity input").attr("data-opacity",(100-t)/100).val(t),x()}),$("#category_region_opacity input, #category_region_stroke input").keyup(function(t){if($(t.target).closest("div").parent().attr("id").indexOf("stroke")==-1){var e=$(this).val();isNaN(e)?e=20:e<0?e=0:e>100&&(e=100),$("#category_region_opacity input").attr("data-opacity",(100-e)/100).val(e)}x()}),$("#category_region_opacity .spinner .btn:last-of-type").on("click",function(){var t=MapUtils.addSub(parseFloat($("#category_region_opacity input").val()),1);isNaN(t)?t=20:t<0?t=0:t>100&&(t=100),$("#category_region_opacity input").attr("data-opacity",(100-t)/100).val(t),x()}),$("#category_region_stroke .spinner .btn:first-of-type").on("click",function(){var t=MapUtils.accAdd(parseFloat($("#category_region_stroke input").val()),1);isNaN(t)&&(t=1),t>10||($("#category_region_stroke input").val(t),x())}),$("#category_region_stroke .spinner .btn:last-of-type").on("click",function(){var t=MapUtils.addSub(parseFloat($("#category_region_stroke input").val()),1);isNaN(t)&&(t=1),t<1||t>10||($("#category_region_stroke input").val(t),x())}),$("#reload_guide").click(function(){$(".map-layers").trigger("click"),I()});var Z;$(window).resize(function(){window.innerHeight-96<8?($("#featureListPanelBorder").css("max-height",8),$(".map-logs-details").css("max-height",8),$("#pluginPanelBorder").css("max-height",8),$(".analysis").css("max-height",8)):($("#featureListPanelBorder").css("max-height",window.innerHeight-83),$(".map-logs-details").css("max-height",window.innerHeight-83),$("#pluginPanelBorder").css("max-height",window.innerHeight-83),$(".analysis").css("max-height",window.innerHeight-83-31)),"0px"!=$(".map-show").css("margin-left")?$("#mapContainer").height(window.innerHeight-80).width(window.innerWidth-380):$("#mapContainer").height(window.innerHeight-80).width(window.innerWidth),$(".marker-layer, .line-layer, .region-layer").height($(".layer-style-panel").height()-$(".marker-layer-style-setting").height()-32-8-96).css("overflow-y","auto"),$("#cooperatePanel,#markerReplyPanel,#batchFendan").width(window.innerWidth-56),$(".map-invite-member, .map-layer-role,.map-feature-role").height($(window).height()-48-32-24-24),$(".dt-batch-fendan").height($(window).height()-24-160-60);var t=($(window).height()-48-32-20)/2,e=t-48;$(".offline-member,.online-member").css("max-height",t),$("#offline_members").css("max-height",t-32),$("#online_members").css("max-height",e)}),$("#featureListPanelBorder").scroll(function(){$(".dt-panel").remove()}),$("#featureListPanelBorder").css("max-height",window.innerHeight-83),$("#pluginPanelBorder").css("max-height",window.innerHeight-83),$(".map-logs-details").css("max-height",window.innerHeight-83),$("#editLayerTitle").on("shown.bs.modal",function(){$("#edit_layer_title").val($("#layer_title_"+current_layer_id).html())}),$("#pub").is(":checked")?$(".all-user").show():"",$("#permission input:checkbox").click(function(){if($(this).is(":checked"))$(".password-input").show();else{$(".password-input").hide();var t=$("#permission input:checked").attr("id"),e={mid:mid,permission:t};MapUtils.ajax2server(pers_map_url,"POST",e),$(".share-rqcode").removeClass("dt-none"),$(".share-text").addClass("dt-none")}}),$("#themePanel input").click(function(){MapUtils.ajax2server(update_settings_url,"POST",{mid:mid,datalist:$("#datalist").is(":checked"),searchlist:$("#searchlist").is(":checked")})}),$("#dataTokenModal").on("shown.bs.modal",function(){$("#copyDataToken").zclip({path:swf_url,copy:$("#data_token_container").val(),afterCopy:function(){MapUtils.copy_after(this)}})}),$("#invite_members").click(function(){if(1==org_level)return void PromptInfo.xcConfirm(org_error_txt,PromptInfo.xcConfirm.typeEnum.info);var t=0==parseInt($(this).attr("data-role"));return t?void $("#inviteModal").modal("show"):(PromptInfo.xcConfirm("\u60a8\u8fd8\u4e0d\u662f\u7ba1\u7406\u5458\uff0c\u4e0d\u80fd\u9080\u8bf7\u6210\u5458",PromptInfo.xcConfirm.typeEnum.info),!1)}),$("#inviteModal").on("shown.bs.modal",function(){$("#members_container").empty(),MapUtils.ajax2server(relatives_url,"get",{},function(t){for(var e=0;e<t.users.length;e++){var i='<div id="user_'+t.users[e].id+'" class="member" data-user="'+t.users[e].id+'">';i+='<img  class="img-circle" height="32" src="'+oss_host+t.users[e].avatar+'" width="32">',
i+='<p class="user-name">'+t.users[e].nickname+"</p>",i+="</div>",$("#members_container").append(i)}})}),$("#loadLayersModal").on("shown.bs.modal",function(){$("#select_layer").empty().append("<option value='new_layer'>\u65b0\u5efa\u56fe\u5c42</option>");var t=$("#submit_layer").attr("layer-id"),e=$("#submit_layer").attr("layer-type"),i=[];switch(e){case"marker_layer":i=MarkerUtils.getMarkerLayers();break;case"line_layer":i=LineUtils.getLineLayers();break;case"region_layer":i=RegionUtils.getRegionLayers()}for(var n=0;n<i.length;n++)if(i[n].type==e&&i[n].id!=t){var r="<option value='"+i[n].id+"'>"+i[n].title+"</option>";$("#select_layer").append(r)}}),$("#submit_layer").click(function(){var t=$("#select_layer").val();if(null==t||""==t)return void PromptInfo.xcConfirm("\u8bf7\u5148\u9009\u62e9\u56fe\u5c42",PromptInfo.xcConfirm.typeEnum.error);$("#loadLayersModal").modal("hide");var e,i=$("#submit_layer"),n=i.attr("layer-id"),r=i.attr("layer-type"),a=i.attr("row-ids").split(",");"marker_layer"==r?e=marker_layer_move_data_url:"line_layer"==r?e=line_layer_move_data_url:"region_layer"==r&&(e=region_layer_move_data_url);var o={id:n,mid:mid,to_layer_id:t,ids:a};MapUtils.ajax2server(e,"POST",o,function(t){404==t.status||403==t.status?$(".notice1").html(res.msg).fadeIn(500).delay(1500).fadeOut(500):200==t.status&&MapUtils.operatingNotice("\u6570\u636e\u79fb\u52a8\u4e2d,\u8bf7\u7a0d\u7b49",{loading:!0,expire:1e3})})}),$("#editMapInfo").click(function(){$("#editMapInfoModal").attr("type","edit").modal("show")}),$(document).click(function(t){0!=$(t.target).closest(".dt-panel").length||$(t.target).hasClass("more-icon")||0!=$(t.target).closest(".panel-list").length||$(".dt-panel").remove(),0==$(t.target).closest(".field-type-settings").length&&$(".col-field-type").remove();var e=$(".infowindow-date-time-picker");!$(t.target).hasClass("infowindow-date-time-picker")&&e.data("DateTimePicker")&&e.datetimepicker("hide")}),$(".add-layer-layout").click(function(){return 1==org_level?void PromptInfo.xcConfirm(org_error_txt,PromptInfo.xcConfirm.typeEnum.info):void $("#layerListPanel").modal("show")}),$("#layerListPanel").on("show.bs.modal",function(){$(document).trigger("dt.add.layer",A)}),$("#addMemberToLayer").on("show.bs.modal",function(){$(document).trigger("dt.get.layer.members")}),$(".permission-layers").click(function(t){if($(t.target).hasClass("layer-add-members")){var e=$(t.target).attr("data-layer-id"),i=$(t.target).attr("data-layer-type");$("#layer_members_container").attr("data-layer-id",e),$("#layer_members_container").attr("data-layer-type",i)}}),$(document).on("dt.append.file",function(t,e){O(e,!0)}),$("#addMemberToFeature").on("show.bs.modal",function(){var t=$(this).attr("layer-id"),e=$(this).attr("data-layer-type");$(document).trigger("dt.get.feature.members",[t,e])}),$(document).on("dt.infowindow.setting",function(t,e,i,n){k(i,n),$("#submitInfowindowSetting").unbind().click(function(){var t;"marker"==n?t=show_fields_url:"line"==n?t=line_layer_show_fields_url:"region"==n&&(t=region_layer_show_fields_url),_(t,i)})}),$(document).on("dt.change.directions.select",function(t,e){for(var i=A.get("r_"+e).regions.values(),n="<option value='"+e+"'>\u5168\u90e8\u533a\u57df</option>",r=0;r<i.length;r++)for(var a=i[r],o=0;o<a.attrs.length;o++){var s=a.attrs[o];a.uniform_title==s.key&&(n+="<option value='"+a.feature_id+"'>"+(s.value||"")+"</option>")}$(".direction-regions").append(n)}),$("#chooseDistrict").change(function(){$(".district-panel").empty();var t=B.values(),e=$(this).val();"province"==e?RegionUtils.loadProvince(t):"city"==e?RegionUtils.loadCity(t):"county"==e&&RegionUtils.loadCounty(t)}),$("#loadDistrict").on("show.bs.modal",function(){if($(".district-panel").empty(),B.values().length>0){var t=B.values();RegionUtils.loadProvince(t)}else MapUtils.ajax2server(districts_url,"GET",{parent_code:0},function(t){if(t){for(var e=0;e<t.length;e++){var i=t[e];B.put(i.code,i)}RegionUtils.loadProvince(t)}})}),$("#loadDistrict").on("hidden.bs.modal",function(){$("#chooseDistrict").children().first().prop("selected",!0),$(".district-keyword").val("")}),$("#submitDistrict").click(function(){for(var t=$(this).attr("layer-id"),e=$("#selectedDistrict option"),i=[],n=0;n<e.length;n++){var r=$(e[n]);r&&i.push(parseInt(r.val()))}if(0==i.length)return void PromptInfo.xcConfirm("\u5df2\u9009\u884c\u653f\u533a\u5212\u4e0d\u80fd\u4e3a\u7a7a\uff01",PromptInfo.xcConfirm.typeEnum.info);var a={mid:mid,region_layer_id:t,codes:i};MapUtils.ajax2server(create_regions_with_districts_url,"POST",a,function(){$("#loadDistrict").modal("hide")})}),$(".district-keyword").keyup(function(t){var e=$(".district-keyword").val();if(13==t.keyCode){if(0==e.trim().length)return void PromptInfo.xcConfirm("\u8bf7\u8f93\u5165\u8981\u67e5\u627e\u7684\u884c\u653f\u533a\u5212",PromptInfo.xcConfirm.typeEnum.info);MapUtils.ajax2server(districts_url,"GET",{keyword:e},function(t){if(t&&t.length>0)if($(".district-panel").text().indexOf("\u641c\u7d22\u7ed3\u679c")>=0){$("#resultList").empty();for(var e=0;e<t.length;e++){var i="<option value='"+t[e].code+"'' parent-code='"+t[e].parent_code+"'>"+t[e].full_name+"</option>";$("#resultList").append(i)}}else $(".district-panel").empty(),RegionUtils.loadSearchDistrict(t);else PromptInfo.xcConfirm("\u6682\u65e0\u6570\u636e\uff01",PromptInfo.xcConfirm.typeEnum.info)})}})});